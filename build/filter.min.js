/**
*
*   FILTER.js
*   @version: 1.5.0
*   @built on 2023-08-08 21:21:02
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function q(){"use strict";var o,F,D,N,B,H,U,tt,et,nt,Y,P,X,k,$,E,rt,Z,it,J,z,j,W,K,Q,ot,at,u,st,lt,ut,ct,ft,ht,mt,pt,dt,gt,_t,vt,Ct,At,Rt,bt,c,xt,a,It,Et,h,Lt,St,Tt,Gt,Mt,m,p,Ft,Ot,Dt,d,Nt,Bt,Ht,Ut,Yt,Pt,Xt,kt,$t,zt,jt,Wt,qt,Vt,g,Kt,Qt,Zt,Jt,_,te,ee,ne,re,ie,oe,l,ae,se,v,C,le,ue,ce,fe,he,me,y,pe,de,ge,_e,ve,Ce,ye,we,Ae,Re,be,xe,Ie,Ee,Le,Se,Te,Ge,Me,Fe,Oe,De,Ne,V,t,Be,He,Ue,Ye,Pe,Xe,ke,$e,ze,je,We,qe,Ve,Ke,Qe,Ze,Je,tn,en,nn,rn,on,an,sn,ln,un,cn,w,fn,hn,mn,e,pn,dn,gn,_n,vn,Cn,yn,wn,An,Rn,bn,xn,In,n,En,r,Ln,Sn,A,i,Tn,Gn,Mn,Fn,On,Dn,Nn,Bn,Hn,Un,Yn,R,Pn,O,Xn,kn,$n,zn,jn,Wn,qn,Vn,Kn,Qn,Zn,Jn,tr,er,nr,rr,ir,or,ar,sr,lr,b,ur,cr,fr,hr,mr,pr,dr,x,gr,_r,vr,Cr,yr,wr,Ar,Rr,br,xr,Ir,Er,I,Lr,yt,wt,Sr,Tr,Gr,Mr,L={VERSION:"1.5.0"};function Fr(t,e,n){arguments.length<2&&(e=t,t=null),D.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var r,i,o,a=D.call(e,"constructor")?e.constructor:function(){};for(r in t?(a[F]=Object.create(t[F]),a[F].$super=(i=t,o={},function(t,e){var n=":"+t;return 1===o[n]?(i[F].$super||N).call(this,t,e):(o[n]=1,t=("constructor"===t?i:i[F][t]||N).apply(this,e||[]),o[n]=0,t)})):a[F].$super=N,a[F].constructor=a,e)D.call(e,r)&&"constructor"!==r&&(a[F][r]=e[r]);if(n)for(r in n)D.call(n,r)&&(a[r]=n[r]);return a}function Or(t,e,n){return n<t?n:t<e?e:t}function Dr(t,e,n,r,i){n=n||0,r=r||0;for(var o,a=i?i-r+1:e.length,s=31&a,l=0;l<s;++l)t[l+n]=e[r+l];for(o=s;o<a;o+=32)t[(l=o)+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],++l}function Nr(t,e,n,r,N,i,B,H,U,o,Y,P){null==o&&(P=(o=1)*(Y=510));for(var a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,X,k,b,x,$,I,E,z,L,j,S,W,T,G,q=n.length,V=q>>>i,K=r-1,Q=N-1,M=new nt(V),F=1,O=1,D=r;O<Q&&!(K<=F&&(F=1,D+=r,Q<=++O));++F)_=(l=F+D)-1,v=l+1,A=(d=l-r)-1,C=1+d,w=(g=l+r)-1,y=g+1,u=t[l],c=e[l],f=J(u),h=J(c),G=it(f,h),T=Z(f,h),m=G?G*(1+.43*T/G*T/G):0,G=it(J(t[d]),J(e[d])),T=Z(J(t[d]),J(e[d])),d=G?G*(1+.43*T/G*T/G):0,G=it(J(t[g]),J(e[g])),T=Z(J(t[g]),J(e[g])),g=G?G*(1+.43*T/G*T/G):0,G=it(J(t[_]),J(e[_])),T=Z(J(t[_]),J(e[_])),_=G?G*(1+.43*T/G*T/G):0,G=it(J(t[v]),J(e[v])),T=Z(J(t[v]),J(e[v])),v=G?G*(1+.43*T/G*T/G):0,G=it(J(t[C]),J(e[C])),T=Z(J(t[C]),J(e[C])),C=G?G*(1+.43*T/G*T/G):0,G=it(J(t[y]),J(e[y])),T=Z(J(t[y]),J(e[y])),y=G?G*(1+.43*T/G*T/G):0,G=it(J(t[w]),J(e[w])),T=Z(J(t[w]),J(e[w])),w=G?G*(1+.43*T/G*T/G):0,G=it(J(t[A]),J(e[A])),T=Z(J(t[A]),J(e[A])),A=G?G*(1+.43*T/G*T/G):0,T=u*c<=0?h<=f?(p=f*m)>=J(c*C-(u+c)*v)&&p>J(c*w-(u+c)*_):(p=h*m)>=J(u*C-(c+u)*d)&&p>J(u*w-(c+u)*g):h<=f?(p=f*m)>=J(c*y+(u-c)*v)&&p>J(c*A+(u-c)*_):(p=h*m)>=J(u*y+(c-u)*g)&&p>J(u*A+(c-u)*d),M[l]=T?Y<=m?P:rt(o*m):0;if(B){for(s=F=0;F<r;++F)s+=M[F],M[F]=s;for(F=r,s=D=0;F<V;++F,++D)r<=D&&(s=D=0),s+=M[F],M[F]=M[F-r]+s;return M}if(i)for(F=0;F<q;F+=4)n[F]=n[F+1]=n[F+2]=0;else for(F=0;F<q;++F)n[F]=0;for(D=a=O=F=0;a<V;D=++a<<i,++F)if(r<=F&&(F=0,++O),!(0!==n[D]||M[a]<U)){R=F,b=O,S=D;do{for(n[S]=i?n[S+1]=n[S+2]=255:255,k=R===K?R:R+1,$=b===Q?b:b+1,I=X=0===R?R:R-1,E=x=0===b?b:b-1,L=z=x*r,W=0;I<=k&&E<=$;){if(S=(j=I+L)<<i,(E!==x||I!==X)&&0===n[S]&&M[j]>=H){R=I,b=E,W=1;break}L+=r,$<++E&&(E=b,L=z,++I)}}while(W)}return n}function Br(t,e,n){e=new RegExp("\\b"+e+"\\s+\\w+\\s+(\\w+)","ig");t.replace(e,function(t,e){return n[e]=0,t})}function Hr(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(K.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)}function Ur(t,e){var n,r,i,o=this;if(o.vertexSource=at,o.fragmentSource=t,o.uniform={},o.attribute={},Br(o.vertexSource,"attribute",o.attribute),Br(o.vertexSource,"uniform",o.uniform),Br(o.fragmentSource,"uniform",o.uniform),n=(t=Hr(e,o.vertexSource,e.VERTEX_SHADER))?Hr(e,o.fragmentSource,e.FRAGMENT_SHADER):null,t&&n)if(o.id=e.createProgram(),e.attachShader(o.id,t),e.attachShader(o.id,n),e.linkProgram(o.id),e.getProgramParameter(o.id,e.LINK_STATUS)){for(r in o.attribute)o.attribute[r]=e.getAttribLocation(o.id,r);for(i in o.uniform)o.uniform[i]=e.getUniformLocation(o.id,i)}else K.error(e.getProgramInfoLog(o.id)),e.deleteProgram(o.id),o.id=null}function Yr(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),r}function Pr(t,e){e&&t.deleteTexture(e)}function Xr(t,e,n){e=Yr(t,e,n),n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{fbo:n,tex:e}}function kr(t,e){var n,r;e&&(n=t,(r=e.fbo)&&n.deleteFramebuffer(r),Pr(t,e.tex))}function $r(t,e,n,r,i,o,a){return a=a||Yr(t,n,r),null!=i&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,a)),o?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,e),a}function zr(t,e,n,r){return r=r||new K.ImArray(e*n<<2),t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,r),r}function jr(){}function Wr(t){return t&&t.instance&&t.instance.isOn()}function qr(t,e,n){var r,i,o;return e/=100,e=(1-c.abs(2*(n/=100)-1))*e,r=c.floor((t=t/60)/2),r=e*(1-c.abs(t-2*r-1)),n=n-e/2,t=0<=t&&t<1?(i=e+n,o=r+n,0+n):1<=t&&t<2?(i=r+n,o=e+n,0+n):2<=t&&t<3?(i=0+n,o=e+n,r+n):3<=t&&t<4?(i=0+n,o=r+n,e+n):4<=t&&t<5?(i=r+n,o=0+n,e+n):(i=e+n,o=0+n,r+n),[h(c.round(255*i),0,255),h(c.round(255*o),0,255),h(c.round(255*t),0,255)]}function Vr(t,e,n){var e=(n/=100)*(1-e/200),r=c.min(e,1-e);return qr(t,0===r?0:100*(n-e)/r,100*e)}function Kr(t,e,n){n=1-n/100;return Vr(t,100-e/n,100*n)}function Qr(t,e,n,r,i){var o,a,s,l,u;return r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),o=r=c.max(t,e,n),l=s=c.min(t,e,n),u=1-r,n=0==(a=r-s)?0:o===t?60*(0+(e-n)/a):o===e?60*(2+(n-t)/a):60*(4+(t-e)/a),e=0==(t=(r+s)/2)||1==t?0:(o-t)/c.min(t,1-t),r=0===o?0:a/o,"hwb"===i?[h(c.round(n),0,360),h(100*l,0,100),h(100*u,0,100)]:"hsv"===i?[h(c.round(n),0,360),h(100*r,0,100),h(100*o,0,100)]:[h(c.round(n),0,360),h(100*e,0,100),h(100*t,0,100)]}function Zr(t,e,n,r){return Qr(t,e,n,r,"hsl")}function Jr(t,e,n,r){return Qr(t,e,n,r,"hsv")}function ti(t,e,n,r){return Qr(t,e,n,r,"hwb")}function ei(t,e,n,r){return r&&(t=h(a(t*Mt),0,255),e=h(a(e*Mt),0,255),n=h(a(n*Mt),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((r=1-t*Tt)-(e=It(r,t=1-e*Tt,r=1-n*Tt)))*(n=1/(1-e)),(t-e)*n,(r-e)*n,e]}function ni(t,e,n,r){var i;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(i=1-r)+r)),n=255*(1-(n=n*i+r)),[h(a(255*(1-(t=t*i+r))),0,255),h(a(e),0,255),h(a(n),0,255)])}function ri(t,e,n,r){2&(r=r||6)&&t.width!==e&&(t.width=e,t.oCanvas.width=+e,t._restorable)&&(t.iCanvas.width=t.oCanvas.width),4&r&&t.height!==n&&(t.height=n,t.oCanvas.height=+n,t._restorable)&&(t.iCanvas.height=t.oCanvas.height)}function ii(t,e){var n=t.oCanvas.width,r=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d").getImageData(0,0,n,r),t.iData||(t.iData=t.iCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d").getImageData(0,0,n,r),t.oData||(t.oData=t.oCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-3)}function oi(t,e){var n,r,i,o,a,s,l;t.selection&&(n=t.selection,l=t.width-1,s=t.height-1,r=n[0],i=n[1],o=n[2],a=n[3],l=n[4]?l:1,n=n[4]?s:1,r=+d(r*l),i=+d(i*n),s=(o=+d(o*l))-r+1,l=(a=+d(a*n))-i+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d").getImageData(r,i,s,l),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d").createImageData(0,0,s,l)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d").getImageData(r,i,s,l),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d").createImageData(0,0,s,l)),t._refresh&=-9)}function ai(t,e){var e=e?we(e):"",t=we(t),n=ye?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(_e)}!function(t,N,y){function e(){}function n(t,e){return t&&X?X.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t}function r(t){var e;return R?{file:__filename,path:__dirname}:x||I?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:H&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:E&&(e=document.getElementsByTagName("script"))&&e.length?((r.link=r.link?r.link:document.createElement("a")).href=e[e.length-1].src,{file:e=r.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var s,i="prototype",o=Object,a=Array,l=Function[i],o=o[i],a=a[i],B=(JSON.parse,JSON.stringify),u=o.hasOwnProperty,c=function(t,e){return function(){return t(e)}},f=l.call.bind(a.slice),l=o.toString,w=function(t){return"function"==typeof t},h=function(t,e){return t instanceof e},m=setTimeout,p=clearTimeout,a=y,d=60,g=0,_=1,v=2,C=3,A=4,o="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,R="undefined"!=typeof global&&"[object global]"===l.call(global),b=R&&void 0!==process.send,x=!o&&!R&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,I=!o&&!R&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,E=!(o||R||I||x||"undefined"==typeof navigator||"undefined"==typeof document),H=(E&&window.opener,E&&(window.self,window.top),"function"==typeof define&&define.amd),U=R||"function"==typeof Worker||"function"==typeof SharedWorker,L=R?t:x||I?self||t:window||t,Y=R?module.$deps:x||I?self||this:window||this,P=(R?global:x||I?self:window,b||x||I),S=b&&0===process.listenerCount("message")||x&&!L.onconnect||I&&!L.onmessage,T=S?function t(e){t.handler&&t.handler(b?e:e.data)}:e,G=null,M={},X=(R&&require("os").cpus().length,R?null:void 0!==L.webkitURL?L.webkitURL:void 0!==L.URL?L.URL:null),k=r(q.moduleUri).file,$=function(t,e){if(t=t||{},e)for(var n in e)u.call(e,n)&&(t[n]=e[n]);return t},z=0;M[k]=1,R?((s=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=s)[i]={constructor:s,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((s=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=s)[i]={constructor:s,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(s.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},s.Shared[i]={constructor:s.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),S&&(x?(L.close=e,L.postMessage=e,L.onconnect=function(t){var e=t.ports[0];L.close=function(){e.close()},L.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",T),e.start()}):I?L.onmessage=T:b&&(L.close=function(){process.exit()},L.postMessage=function(t){process.send(t)},L.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(Y)}catch(t){throw t}},process.on("message",T)));function F(t){if(!(this instanceof F))return new F(t);this.$id=(++z).toString(16),this.options=$({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},t)}F[i]={constructor:F,options:null,$id:null,$window:null,dispose:function(){var t=this;return t.$window&&t.close(),t.$window=null,t.$id=null,t.options=null,t},close:function(){var t=this;return t.$window&&(t.$window.closed||t.$window.close(),t.$window=null),t},ready:function(e,n){var r=this;return setTimeout(function t(){!r.$window||e&&!r.$window[e]?setTimeout(t,60):n()},0),r},open:function(t){var e=this;return!e.$window&&t&&(e.$window=window.open(t.push?n(["\ufeff"].concat(t),{type:"text/html;charset=utf-8"}):t,e.$id,function(t){var e,n=[];if(t)for(e in t)u.call(t,e)&&n.push(e+"="+(!0===t[e]||1===t[e]?"yes":!1===t[e]||0===t[e]?"no":t[e]));return n.join(",")}(e.options))),e},write:function(t){return this.$window&&t&&this.$window.document.write(t),this}};var O=function t(e){var r,n,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C;return e instanceof t?e:this instanceof t?(f=c=u=l=s=a=!1,m=0,p=1,_=g=d=h=o=i=n=null,v=y,(r=this).queue=function(t){return arguments.length?(n=t,r):n},r.jumpNext=function(t){n&&n.jumpNext(!1,t)},r.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},r.dispose=function(){n&&(n.dispose(),n=null)},r.task=function(t){return i=t,r},e&&r.task(e),r.run=C=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,v=i(),a=!0,i.jumpNext=null,i.abort=null,i.dispose=null,v},r.runWithArgs=function(t){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,v=i.apply(null,t),a=!0,i.jumpNext=null,i.abort=null,i.dispose=null,v},r.canRun=function(){return!!i&&!!(!a||s||l||u||c||f)&&!((s||l)&&d<=m||l&&!h||(u||c)&&v===g)},r.iif=function(t,e,n){return(t=w(t)?t():t)?r.task(e):2<arguments.length&&r.task(n),r},r.until=function(t){return v=y,g=t,u=l=s=f=!(c=!(h=null)),r.run=C,r},r.untilNot=function(t){return v=y,_=t,u=l=s=c=!(f=!(h=null)),r.run=C,r},r.loop=function(t,e,n){return v=y,m=e||0,p=n||1,d=t,u=l=f=c=!(s=!(h=null)),r.run=function(){var t=i(m);return m+=p,a=!0,v=t},r},r.each=function(t){return v=y,m=0,p=1,d=(h=t)&&t.length||0,u=s=f=c=!(l=!0),r.run=function(){var t=i(h[m],m);return++m,a=!0,v=t},r},r.recurse=function(t,e){return v=t,g=e,l=s=f=c=!(u=!(h=null)),r.run=function(){var t=i(v);return a=!0,v=t},r},r.isFinished=function(){var t=!a||f||c||s||l||u;return!(t=(t=(t=t&&(c||u)&&v===g?!1:t)&&f&&v!==_?!1:t)&&(s||l)&&d<=m?!1:t)},r.onComplete=function(t){return o=t||null,r},void(r.complete=function(){return o&&w(o)&&o(),r})):new t(e)};function j(t,e){var n,r=t.$queue,i=0;if(t.$runmode=_,r&&r.length){for(t.$running=!0;i<r.length;)(n=r[i])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(r.shift(),n.complete()):++i):r.shift();t.$running=!1,t.$timer=m(c(j,t),t.$interval)}}function W(t,e){var n,r=t.$queue;t.$runmode=A,r&&r.length&&((n=r[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(r.shift(),n.complete())):r.shift(),t.$running=!1,t.$timer=m(c(W,t),t.$interval))}function D(t,e){var n;return h(t,O)?t:w(t)?new O(t):h(this,D)?((n=this).$interval=arguments.length&&parseInt(t,10)||d,n.$timer=null,n.$runmode=g,n.$running=!1,n.$queue=[],void(S&&!1!==e&&n.initThread())):new D(t,e)}D.VERSION="0.5.2",D.Thread=s,D.Task=O,D.BrowserWindow=F,D.MODE={NONE:g,INTERLEAVE:_,LINEAR:v,PARALLEL:C,SEQUENCE:A},D.Platform={UNDEFINED:a,UNKNOWN:0,NODE:1,BROWSER:2},D.supportsMultiThreading=function(){return U},D.isPlatform=function(t){return 1===t?R:2===t?E:void 0},D.isThread=function(t,e){return e=!0!==e||S,1===t?e&&b:2===t?e&&(x||I):e&&P},D.path=r,D.blob=n,D.load=function(t,e,n){if(t){e&&e.length&&D.importScripts(e.join?e.join(","):e),t=t.split(".");for(var r=Y;t.length;)t[0]&&t[0].length&&r[t[0]]&&(r=r[t[0]]),t.shift();return r&&L!==r?w(r)?!1!==n?new r:r():r:void 0}return null},D.listen=S?function(t){T.handler=t}:e,D.send=S?function(t){L.postMessage(t)}:e,D.importScripts=S?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var r=t[e];r&&r.length&&1!==M[r]&&(L.importScripts(r),M[r]=1)}}:e,D.close=S?function(){L.close()}:e,D.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,D.serialize=function(r){r=r||new D(0,!1);function t(n){function t(){var t=this,e=arguments;r.step(function(){n.apply(t,e)}),r.$running||r.run(v)}return t.free=function(){return n},t}return t.free=function(){r&&r.dispose(),r=null},t},D[i]={constructor:D,$interval:d,$timer:null,$queue:null,$thread:null,$events:null,$runmode:g,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&p(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=g,e.$running=!1,S&&!0===t&&D.close(),e},empty:function(){var t=this;return t.$timer&&p(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=g,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,r){var i,o,a=this;if(!a.$thread){if(!U)throw a.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");o=R?(i="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),a.$events=a.$events||{},(r=a.$thread=new(!0===r?s.Shared:s)(k)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,a.$events&&a.$events[e]?a.$events[e](t):"console.log"!==e&&"console.error"!==e||D.log(("console.error"===e?o:i)+(t||"")))},r.onerror=function(t){if(!a.$events||!a.$events.error)throw new Error(o+t.toString());a.$events.error(t)},a.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return a},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return S&&(n.$events={},D.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),D.close())})),n},listen:function(t,e){return t&&w(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(S?D.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return h(t,O)?t:w(t)?O(t):void 0},iif:function(){var t=arguments,e=new O;return e.iif.apply(e,t)},until:function(){var t=f(arguments),e=new O(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=f(arguments),e=new O(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=f(arguments),e=new O(t.pop());return e.loop.apply(e,t)},each:function(){var t=f(arguments),e=new O(t.pop());return e.each.apply(e,t)},recurse:function(){var t=f(arguments),e=new O(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,r=n.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n}:(e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var r=this,i=r.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,n)),r)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?m(function(){n.empty()},e):n.empty(),n}:(e&&0<e?m(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,A===t)W(n,e);else if(_===t)j(n,e);else if(v===t){var r,i=n,o=i.$queue;if(i.$runmode=v,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(i.$running=!0,r=o.shift(),e?r.runWithArgs(e):r.run(),r.complete()):i.$running=!1}}else C===t&&((e=n).$runmode=C,e.$running=!1);return n}},S&&(D.log=function(t){D.send({event:"console.log",data:"string"!=typeof t?B(t):t})},D.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(G&&(w(G.dispose)&&G.dispose(),G=null),G=D.load(n.component,n.imports,n.asInstance));break;case"dispose":G&&(w(G.dispose)&&G.dispose(),G=null),D.close()}})),N.Asynchronous=D}(this,L),o=L,F="prototype",D=Object[F].hasOwnProperty,Object[F].toString,Object.defineProperty,b=Math,N=function(){},B=0,Fr.Merge=function(){for(var t,e,n=arguments.length,r=n?arguments[0]:null,i=1;i<n;++i)for(t in e=arguments[i])D.call(e,t)&&(r[t]=e[t]);return r},o.Class=Fr,o.Path=o.Asynchronous.path(q.moduleUri),o.uuid=function(t){return[t||"filter",(new Date).getTime(),++B].join("_")},o.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},e=o.Asynchronous,i=e.isPlatform(e.Platform.NODE),r=e.isPlatform(e.Platform.BROWSER),S=e.supportsMultiThreading(),I=e.isThread(null,!0),R=e.isThread(),t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",M="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",n="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",(i=o.Browser={isNode:i,isBrowser:r,isWorker:I,isInsideWorker:R,supportsWorker:S,isPhantom:/PhantomJS/.test(t),isOpera:r&&/Opera|OPR\//.test(t),isFirefox:r&&/Firefox\//.test(t),isChrome:r&&/Chrome\//.test(t),isSafari:r&&/Apple Computer/.test(n),isKhtml:r&&/KHTML\//.test(t),isIE:r&&(/MSIE \d/.test(t)||/Trident\/\d/.test(t)),isGecko:r&&/gecko\/\d/i.test(t),isWebkit:r&&/WebKit\//.test(t),isMac_geLion:r&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(t),isMac_geMountainLion:r&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),isMobile:!1,isIOS:/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t),isWin:/windows/i.test(M),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=i.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),i.isMac=i.isIOS||/Mac/.test(M),i.isIE_lt8=i.isIE&&!R&&(null==document.documentMode||document.documentMode<8),i.isIE_lt9=i.isIE&&!R&&(null==document.documentMode||document.documentMode<9),i.isQtWebkit=i.isWebkit&&/Qt\/\d+\.\d+/.test(t),o.getPath=e.path,o.log=I?e.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},o.warning=function(t){o.log("WARNING: "+t)},o.error=function(t,e){if(o.log("ERROR: "+t),e)throw new Error(String(t))},o.devicePixelRatio=(r&&!R?window.devicePixelRatio:1)||1,o._notSupportClamp="undefined"==typeof Uint8ClampedArray||i.isOpera,o.Array=Array,o.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,o.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,o.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,o.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,o.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,o.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,o.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,o.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,o.ColorTable=o.ImArray=o._notSupportClamp?o.Array8U:Uint8ClampedArray,o.AffineMatrix=o.ColorMatrix=o.ConvolutionMatrix=o.Array32F,o.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26},o.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},o.POS={X:0,Y:1},o.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},o.LUMA=o.LUMA_YUV=o.LUMA_YIQ=new o.Array32F([.2126,.7152,.0722]),o.LUMA_YCbCr=new o.Array32F([.299,.587,.114]),o.LUMA_GREEN=new o.Array32F([0,1,0]),o.CONSTANTS=o.CONST={X:0,Y:1,Z:2,PI:b.PI,PI2:2*b.PI,PI_2:b.PI/2,toRad:b.PI/180,toDeg:180/b.PI},o.FORMAT={IMAGE:1024,DATA:2048},o.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[F].set,hasSubarray:"function"==typeof o.Array32F[F].subarray},Math:{},Filter:{},Image:{},GLSL:{}},o.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n},o.Canvas.Image=function(){return new Image},o.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},U=H=null,o.supportsGLSL=function(){if(null==H){var t,e=null,n=null,r=["webgl","experimental-webgl"],i=null;try{e=o.Canvas(1,1)}catch(t){e=null}if(e)for(t=0;t<r.length;++t){i=r[t],n=null;try{n=e.getContext(i)}catch(t){n=null}if(n)break}(H=!!n)&&(U=i)}return H},o.getGL=function(t){if(t&&o.supportsGLSL())return t.getContext(U)},tt=(S=L).MODE,n=S._notSupportClamp,et=S.ImArray,nt=S.Array32F,S.Array64F,S.Array32I,Y=S.Array16I,P=S.Array8U,X=S.ColorTable,k=S.ColorMatrix,$=S.AffineMatrix,S.ConvolutionMatrix,M=S.Util.Array=S.Util.Array||{},t=S.Util.String=S.Util.String||{},I=S.Util.Math=S.Util.Math||{},e=S.Util.Image=S.Util.Image||{},r=S.Util.Filter=S.Util.Filter||{},(E=Math).exp,E.sqrt,E.pow,E.ceil,rt=E.floor,E.log,E.sin,E.cos,Z=E.min,it=E.max,J=E.abs,E.PI,E.log2,z=/([.*+?^${}()|\[\]\/\\\-])/g,j=/^\s+|\s+$/g,W=/^function[^{]+{([\s\S]*)}$/,M.copy=M.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return Dr(e,t,0,0,t.length-1),e},M.typed=S.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},M.typed_obj=S.Browser.isNode?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t},M.arrayset_shim=Dr,M.arrayset=M.hasArrayset?function(t,e,n){t.set(e,n||0)}:Dr,M.subarray=M.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},I.clamp=Or,t.esc=function(t){return t.replace(z,"\\$1")},t.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(j,"")},t.function_body=function(t){return t.toString().match(W)[1]||""},e.crop=M.hasArrayset?function(t,e,n,r,i,o,a){o=Z(o,e-1),a=Z(a,n-1);for(var s,l=new et((n=o-r+1)*(a-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=a;++c,f+=e,h+=u)l.set(t.subarray(s=f+r<<2,s+u),h);return l}:function(t,e,n,r,i,o,a){o=Z(o,e-1),a=Z(a,n-1);for(var s,l=new et((n=o-r+1)*(a-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=a;++c,f+=e,h+=u)Dr(l,t,h,s=f+r<<2,s+u);return l},e.pad=M.hasArrayset?function(t,e,n,r,i,o,a){for(var s,r=e+(o=o||0)+(r=r||0),l=new et(r*(n+(a=a||0)+(i=i||0))<<2),u=e<<2,c=r<<2,f=o<<2,h=0,m=0,p=a*c;h<n;++h,m+=e,p+=c)l.set(t.subarray(s=m<<2,s+u),f+p);return l}:function(t,e,n,r,i,o,a){for(var s,r=e+(o=o||0)+(r=r||0),l=new et(r*(n+(a=a||0)+(i=i||0))<<2),u=e<<2,c=r<<2,f=o<<2,h=0,m=0,p=a*c;h<n;++h,m+=e,p+=c)Dr(l,t,f+p,s=m<<2,s+u);return l},e.interpolate=function(t,e,n,r,i){for(var o,a,s,l,u,c,f,h,m,p,d=r*i<<2,g=new et(d),_=(e-1)/r,v=(n-1)/i,C=e<<2,y=E.round,w=0,A=0,R=0,b=0,x=0,I=0;I<d;I+=4,++w,A+=_)r<=w&&(x=(R+=v)-(p=(A=w=0)|R),b=p*e),o=t[h=b+(p=0|A)<<2],a=t[4+h],s=t[h+C],l=t[h+C+4],g[I]=Or(y(o*(u=(1-(m=A-p))*(1-x))+a*(c=m*(1-x))+s*(f=x*(1-m))+l*(m=m*x)),0,255),o=t[1+h],a=t[5+h],s=t[h+C+1],l=t[h+C+5],g[I+1]=Or(y(o*u+a*c+s*f+l*m),0,255),o=t[2+h],a=t[6+h],s=t[h+C+2],l=t[h+C+6],g[I+2]=Or(y(o*u+a*c+s*f+l*m),0,255),o=t[3+h],a=t[7+h],s=t[h+C+3],l=t[h+C+7],g[I+3]=Or(y(o*u+a*c+s*f+l*m),0,255);return g},r.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,r=new X(256);if("function"==typeof t)for(n=0;n<256;++n)r[n]=0|Or(t(n),0,255);else for(n=0;n<256;++n)r[n]=0|Or(e+t*n,0,255);return r},r.ct_multiply=function(t,e){for(var n=new X(256),r=0;r<256;++r)n[r]=Or(t[Or(e[r],0,255)],0,255);return n},r.cm_eye=function(){return new k([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},r.cm_multiply=function(t,e){for(var n=new k(20),r=0;r<20;r+=5)n[r+0]=e[r]*t[0]+e[r+1]*t[5]+e[r+2]*t[10]+e[r+3]*t[15],n[r+1]=e[r]*t[1]+e[r+1]*t[6]+e[r+2]*t[11]+e[r+3]*t[16],n[r+2]=e[r]*t[2]+e[r+1]*t[7]+e[r+2]*t[12]+e[r+3]*t[17],n[r+3]=e[r]*t[3]+e[r+1]*t[8]+e[r+2]*t[13]+e[r+3]*t[18],n[r+4]=e[r]*t[4]+e[r+1]*t[9]+e[r+2]*t[14]+e[r+3]*t[19]+e[r+4];return n},r.cm_rechannel=function(t,e,n,r,i,o,a,s,l){var u=new k(20),a=5*a,s=5*s,l=5*l;return u[(o=5*o)+e]=t[0],u[o+n]=t[1],u[o+r]=t[2],u[o+i]=t[3],u[4+o]=t[4],u[a+e]=t[5],u[a+n]=t[6],u[a+r]=t[7],u[a+i]=t[8],u[4+a]=t[9],u[s+e]=t[10],u[s+n]=t[11],u[s+r]=t[12],u[s+i]=t[13],u[4+s]=t[14],u[l+e]=t[15],u[l+n]=t[16],u[l+r]=t[17],u[l+i]=t[18],u[4+l]=t[19],u},r.am_eye=function(){return new $([1,0,0,0,0,1,0,0])},r.am_multiply=function(t,e){var n=new $(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},r.cm_combine=function(t,e,n,r,i){i=i||Array,n=n||1,r=r||1;for(var o=0,a=t.length,s=new i(a);o<a;++o)s[o]=n*t[o]+r*e[o];return s},r.cm_convolve=function(t,e,n){n=n||Array;for(var r=t.length,i=(e=e===+e?[e]:e).length,o=new n(r*i),a=0,s=0;a<r;)o[a*i+s]=t[a]*e[s],++s>=i&&(s=0,++a);return o},r.integral_convolution=n?function(N,t,e,B,n,r,H,U,Y,i,o,P){var a,s,l,u,c,f,h,m,p,d,g,_,X,v,C,y,w,A,R,b,x,I,E,L,S,k,$,z,T,G,M=t.length,j=M>>>n,W=e<<n,F=1<<n,n=U*Y,q=-(U=U>>>1)-1,V=-(Y=e*(Y>>>1))-e,K=U,Q=Y,O=e-1,Z=j-e,D=t;if(t=new et(M),P=P||1,tt.GRAY===N)if(c=e,a=new nt(j),H)for(d=r[0],g=r[n>>>1]-d,_=H[0],X=H[n>>>1]-_,T=0;T<P;++T){for(G=t,t=D,D=G,m=s=h=f=0;m<e;m++,f+=F,++h)s+=t[f],a[h]=s;for(s=m=h=0,f=W;f<M;f+=F,++h,++m)e<=m&&(s=m=0),s+=t[f],a[h+c]=a[h]+s;for(f=p=m=0;f<M;f+=F,++m)e<=m&&(m=0,p+=e),S=d*(a[x=(y=O<(y=m+K)?O:y)+(w=Z<(w=p+Q)?Z:w)]-a[R=y+(C=(C=p+V)<0?0:C)]-a[b=(v=(v=m+q)<0?0:v)+w]+a[A=v+C])+g*t[f],z=_*(a[x]-a[R]-a[b]+a[A])+X*t[f],D[f]=0|(I=(I=i*S+o*z)<0?0:255<I?255:I),D[f+1]=0|I,D[f+2]=0|I,D[f+3]=t[f+3]}else for(d=r[0],g=r[n>>>1]-d,T=0;T<P;++T){for(G=t,t=D,D=G,m=s=h=f=0;m<e;m++,f+=F,++h)s+=t[f],a[h]=s;for(s=m=h=0,f=W;f<M;f+=F,++h,++m)e<=m&&(s=m=0),s+=t[f],a[h+c]=a[h]+s;for(f=p=m=0;f<M;f+=F,++m)e<=m&&(m=0,p+=e),S=d*(a[x=(y=O<(y=m+K)?O:y)+(w=Z<(w=p+Q)?Z:w)]-a[R=y+(C=(C=p+V)<0?0:C)]-a[b=(v=(v=m+q)<0?0:v)+w]+a[A=v+C])+g*t[f],D[f]=0|(I=(I=i*S+o)<0?0:255<I?255:I),D[f+1]=0|I,D[f+2]=0|I,D[f+3]=t[f+3]}else if(c=(e<<1)+e,a=new nt((j<<1)+j),H)for(d=r[0],g=r[n>>>1]-d,_=H[0],X=H[n>>>1]-_,T=0;T<P;++T){for(G=t,t=D,D=G,m=s=l=u=h=f=0;m<e;++m,f+=F,h+=3)s+=t[f],l+=t[f+1],u+=t[f+2],a[h]=s,a[h+1]=l,a[h+2]=u;for(s=l=u=m=h=0,f=W;f<M;f+=F,h+=3,++m)e<=m&&(s=l=u=m=0),s+=t[f],l+=t[f+1],u+=t[f+2],a[h+c]=a[h]+s,a[h+c+1]=a[h+1]+l,a[h+c+2]=a[h+2]+u;for(f=p=m=0;f<M;f+=F,++m)e<=m&&(m=0,p+=e),S=d*(a[x=((x=(y=O<(y=m+K)?O:y)+(w=Z<(w=p+Q)?Z:w))<<1)+x]-a[R=((R=y+(C=(C=p+V)<0?0:C))<<1)+R]-a[b=((b=(v=(v=m+q)<0?0:v)+w)<<1)+b]+a[A=((A=v+C)<<1)+A])+g*t[f],k=d*(a[x+1]-a[R+1]-a[b+1]+a[A+1])+g*t[f+1],$=d*(a[x+2]-a[R+2]-a[b+2]+a[A+2])+g*t[f+2],z=_*(a[x]-a[R]-a[b]+a[A])+X*t[f],E=(E=i*k+o*(_*(a[x+1]-a[R+1]-a[b+1]+a[A+1])+X*t[f+1]))<0?0:255<E?255:E,L=(L=i*$+o*(_*(a[x+2]-a[R+2]-a[b+2]+a[A+2])+X*t[f+2]))<0?0:255<L?255:L,D[f]=0|(I=(I=i*S+o*z)<0?0:255<I?255:I),D[f+1]=0|E,D[f+2]=0|L,D[f+3]=t[f+3]}else for(d=r[0],g=r[n>>>1]-d,T=0;T<P;++T){for(G=t,t=D,D=G,m=s=l=u=h=f=0;m<e;++m,f+=F,h+=3)s+=t[f],l+=t[f+1],u+=t[f+2],a[h]=s,a[h+1]=l,a[h+2]=u;for(s=l=u=m=h=0,f=W;f<M;f+=F,h+=3,++m)e<=m&&(s=l=u=m=0),s+=t[f],l+=t[f+1],u+=t[f+2],a[h+c]=a[h]+s,a[h+c+1]=a[h+1]+l,a[h+c+2]=a[h+2]+u;for(f=p=m=0;f<M;f+=F,++m)e<=m&&(m=0,p+=e),S=d*(a[x=((x=(y=O<(y=m+K)?O:y)+(w=Z<(w=p+Q)?Z:w))<<1)+x]-a[R=((R=y+(C=(C=p+V)<0?0:C))<<1)+R]-a[b=((b=(v=(v=m+q)<0?0:v)+w)<<1)+b]+a[A=((A=v+C)<<1)+A])+g*t[f],E=(E=i*(k=d*(a[x+1]-a[R+1]-a[b+1]+a[A+1])+g*t[f+1])+o)<0?0:255<E?255:E,L=(L=i*($=d*(a[x+2]-a[R+2]-a[b+2]+a[A+2])+g*t[f+2])+o)<0?0:255<L?255:L,D[f]=0|(I=(I=i*S+o)<0?0:255<I?255:I),D[f+1]=0|E,D[f+2]=0|L,D[f+3]=t[f+3]}return D}:function(N,t,e,B,n,r,i,H,U,o,a,Y){var s,l,u,c,f,h,m,p,d,g,_,v,P,C,y,w,A,R,b,x,I,E,X,k,L,$,z,j,S,T,G=t.length,W=G>>>n,q=e<<n,M=1<<n,n=H*U,V=-(H=H>>>1)-1,K=-(U=e*(U>>>1))-e,Q=H,Z=U,F=e-1,O=W-e,D=t;if(t=new et(G),Y=Y||1,tt.GRAY===N)if(f=e,s=new nt(W),i)for(g=r[0],_=r[n>>>1]-g,v=i[0],P=i[n>>>1]-v,S=0;S<Y;++S){for(T=t,t=D,D=T,p=l=m=h=0;p<e;++p,h+=M,++m)l+=t[h],s[m]=l;for(l=p=m=0,h=q;h<G;h+=M,++m,++p)e<=p&&(l=p=0),l+=t[h],s[m+f]=s[m]+l;for(h=d=p=0;h<G;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(s[I=(w=F<(w=p+Q)?F:w)+(A=O<(A=d+Z)?O:A)]-s[b=w+(y=(y=d+K)<0?0:y)]-s[x=(C=(C=p+V)<0?0:C)+A]+s[R=C+y])+_*t[h],j=v*(s[I]-s[b]-s[x]+s[R])+P*t[h],D[h]=0|(E=o*L+a*j),D[h+1]=0|E,D[h+2]=0|E,D[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,S=0;S<Y;++S){for(T=t,t=D,D=T,p=l=m=h=0;p<e;p++,h+=M,++m)l+=t[h],s[m]=l;for(l=p=m=0,h=q;h<G;h+=M,++m,++p)e<=p&&(l=p=0),l+=t[h],s[m+f]=s[m]+l;for(h=d=p=0;h<G;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(s[I=(w=F<(w=p+Q)?F:w)+(A=O<(A=d+Z)?O:A)]-s[b=w+(y=(y=d+K)<0?0:y)]-s[x=(C=(C=p+V)<0?0:C)+A]+s[R=C+y])+_*t[h],D[h]=0|(E=o*L+a),D[h+1]=0|E,D[h+2]=0|E,D[h+3]=t[h+3]}else if(f=(e<<1)+e,s=new nt((W<<1)+W),i)for(g=r[0],_=r[n>>>1]-g,v=i[0],P=i[n>>>1]-v,S=0;S<Y;++S){for(T=t,t=D,D=T,p=l=u=c=m=h=0;p<e;++p,h+=M,m+=3)l+=t[h],u+=t[h+1],c+=t[h+2],s[m]=l,s[m+1]=u,s[m+2]=c;for(l=u=c=p=m=0,h=q;h<G;h+=M,m+=3,++p)e<=p&&(l=u=c=p=0),l+=t[h],u+=t[h+1],c+=t[h+2],s[m+f]=s[m]+l,s[m+f+1]=s[m+1]+u,s[m+f+2]=s[m+2]+c;for(h=d=p=0;h<G;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(s[I=((I=(w=F<(w=p+Q)?F:w)+(A=O<(A=d+Z)?O:A))<<1)+I]-s[b=((b=w+(y=(y=d+K)<0?0:y))<<1)+b]-s[x=((x=(C=(C=p+V)<0?0:C)+A)<<1)+x]+s[R=((R=C+y)<<1)+R])+_*t[h],$=g*(s[I+1]-s[b+1]-s[x+1]+s[R+1])+_*t[h+1],z=g*(s[I+2]-s[b+2]-s[x+2]+s[R+2])+_*t[h+2],j=v*(s[I]-s[b]-s[x]+s[R])+P*t[h],X=o*$+a*(v*(s[I+1]-s[b+1]-s[x+1]+s[R+1])+P*t[h+1]),k=o*z+a*(v*(s[I+2]-s[b+2]-s[x+2]+s[R+2])+P*t[h+2]),D[h]=0|(E=o*L+a*j),D[h+1]=0|X,D[h+2]=0|k,D[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,S=0;S<Y;++S){for(T=t,t=D,D=T,p=l=u=c=m=h=0;p<e;++p,h+=M,m+=3)l+=t[h],u+=t[h+1],c+=t[h+2],s[m]=l,s[m+1]=u,s[m+2]=c;for(l=u=c=p=m=0,h=q;h<G;h+=M,m+=3,++p)e<=p&&(l=u=c=p=0),l+=t[h],u+=t[h+1],c+=t[h+2],s[m+f]=s[m]+l,s[m+f+1]=s[m+1]+u,s[m+f+2]=s[m+2]+c;for(h=d=p=0;h<G;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(s[I=((I=(w=F<(w=p+Q)?F:w)+(A=O<(A=d+Z)?O:A))<<1)+I]-s[b=((b=w+(y=(y=d+K)<0?0:y))<<1)+b]-s[x=((x=(C=(C=p+V)<0?0:C)+A)<<1)+x]+s[R=((R=C+y)<<1)+R])+_*t[h],X=o*($=g*(s[I+1]-s[b+1]-s[x+1]+s[R+1])+_*t[h+1])+a,k=o*(z=g*(s[I+2]-s[b+2]-s[x+2]+s[R+2])+_*t[h+2])+a,D[h]=0|(E=o*L+a),D[h+1]=0|X,D[h+2]=0|k,D[h+3]=t[h+3]}return D},r.separable_convolution=n?function(N,t,e,B,n,H,r,i,o,U,a){for(var s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I,E,L,S=t.length,T=1<<n,G=e-1,M=(S>>>n)-e,F=new Y(i),O=0,D=i.length;O<D;O+=2)F[O+1]*=e;for(h=new Y(o),O=0,D=o.length;O<D;O+=2)h[O+1]*=e;if(E=2,l=H,u=i,I=U,f=F,c=t,t=new et(S),tt.GRAY===N)for(;E--;){for(L=t,t=c,c=L,s=l.length,D=u.length,m=g=d=0;m<S;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=R=b=x=0;O<s;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=G&&0<=v&&v<=M&&(srcOff=_+v<<2,A=l[O],R+=t[srcOff]*A);c[m]=0|(C=(C=I*R)<0?0:255<C?255:C),c[m+1]=0|C,c[m+2]=0|C,c[m+3]=t[m+3]}l=r,u=o,I=a,f=h}else for(;E--;){for(L=t,t=c,c=L,s=l.length,D=u.length,m=g=d=0;m<S;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=R=b=x=0;O<s;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=G&&0<=v&&v<=M&&(srcOff=_+v<<2,A=l[O],R+=t[srcOff]*A,b+=t[srcOff+1]*A,x+=t[srcOff+2]*A);y=(y=I*b)<0?0:255<y?255:y,w=(w=I*x)<0?0:255<w?255:w,c[m]=0|(C=(C=I*R)<0?0:255<C?255:C),c[m+1]=0|y,c[m+2]=0|w,c[m+3]=t[m+3]}l=r,u=o,I=a,f=h}return c}:function(N,t,e,B,n,H,r,i,o,U,a){for(var s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I,E,L,S=t.length,T=1<<n,G=e-1,M=(S>>>n)-e,F=new Y(i),O=0,D=i.length;O<D;O+=2)F[O+1]*=e;for(h=new Y(o),O=0,D=o.length;O<D;O+=2)h[O+1]*=e;if(E=2,l=H,u=i,I=U,f=F,c=t,t=new et(S),tt.GRAY===N)for(;E--;){for(L=t,t=c,c=L,s=l.length,D=u.length,m=g=d=0;m<S;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=R=b=x=0;O<s;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=G&&0<=v&&v<=M&&(srcOff=_+v<<2,A=l[O],R+=t[srcOff]*A);c[m]=0|(C=I*R),c[m+1]=0|C,c[m+2]=0|C,c[m+3]=t[m+3]}l=r,u=o,I=a,f=h}else for(;E--;){for(L=t,t=c,c=L,s=l.length,D=u.length,m=g=d=0;m<S;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=R=b=x=0;O<s;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=G&&0<=v&&v<=M&&(srcOff=_+v<<2,A=l[O],R+=t[srcOff]*A,b+=t[srcOff+1]*A,x+=t[srcOff+2]*A);y=I*b,w=I*x,c[m]=0|(C=I*R),c[m+1]=0|y,c[m+2]=0|w,c[m+3]=t[m+3]}l=r,u=o,I=a,f=h}return c},r.gradient=function(t,e,n,r,i,o,a,s,l,u,c,f){var h,m,p,d,g,_,v,C,y,w,A,R=r,b=t.length,x=e-1,I=n-1,E=1<<r,L=E<<1,S=e<<r,T=new nt(b=b>>>r),G=new nt(b);if(o){for(g=e-2,_=n-2,o=e<<1,A=new P(b),p=m=2,d=o;p<_&&!(g<=m&&(m=2,d+=e,_<=++p));++m)A[h=m+d]=(103*(2*t[(w=(y=(v=(h<<r)+i)-S)-S)-L]+4*t[w-E]+5*t[w]+4*t[w+E]+2*t[w+L]+4*t[y-L]+9*t[y-E]+12*t[y]+9*t[y+E]+4*t[y+L]+5*t[v-L]+12*t[v-E]+15*t[v]+12*t[v+E]+5*t[v+L]+4*t[(C=v+S)-L]+9*t[C-E]+12*t[C]+9*t[C+E]+4*t[C+L]+2*t[(w=C+S)-L]+4*t[w-E]+5*t[w]+4*t[w+E]+2*t[w+L])+8192&4294967295)>>>14&255;E=1,L=2,S=e,i=r=0}else A=t;for(p=m=1,d=e;p<I&&!(x<=m&&(m=1,d+=e,I<=++p));++m)T[h=d+m]=A[(y=(v=(h<<r)+i)-S)+E]-A[y-E]+(A[v+E]<<1)-(A[v-E]<<1)+A[(C=v+S)+E]-A[C-E],G[h]=A[y-E]-A[C-E]+(A[y]<<1)-(A[C]<<1)+A[y+E]-A[C+E];return Nr(T,G,t,e,n,R,a,s,l,u,c,f)},r.optimum_gradient=Nr,r.sat=function(t,e,n,r,i,o,a,s){for(var l,u,c,f,h,m=t.length,p=e<<r,d=(31&e)<<r,g=32<<r,_=1<<r,v=l=0,C=0,y=i;y<d;y+=_)v+=u=t[y],o[C]=v,l+=(s[C]=u)*u,a[C]=l,++C;for(c=d+i;c<p;c+=g)v+=u=t[y=c],o[C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,v+=u=t[y+=_],o[++C]=v,l+=(s[C]=u)*u,a[C]=l,++C;for(h=1,l=v=C=f=0,d+=p,y=p+i;y<d;y+=_)v+=u=t[y],o[C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++C,++f>=e&&(++h,v=l=f=0);for(c=d+i;c<m;c+=g)v+=u=t[y=c],o[C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++f>=e&&(++h,v=l=f=0),v+=u=t[y+=_],o[++C+e]=o[C]+v,a[C+e]=a[C]+(l+=u*u),s[C+e]=s[C+1-e]+(u+t[C-e<<r])+(1<h?s[C-e-e]:0)+(0<f?s[C-1-e]:0),++C,++f>=e&&(++h,v=l=f=0)},K=L,Q=Math,ot=K.Util.String.trim,R=K.Util.GLSL||{},at=ot(["precision highp float;","attribute vec2 pos;","attribute vec2 uv;","uniform vec2 resolution;","uniform float flipY;","varying vec2 pix;","void main(void) {","vec2 zeroToOne = pos / resolution;","vec2 zeroToTwo = zeroToOne * 2.0;","vec2 clipSpace = zeroToTwo - 1.0;","gl_Position = vec4(clipSpace * vec2(1.0, flipY), 0.0, 1.0);","/*gl_Position = vec4(pos.x, pos.y*flipY, 0.0, 1.0);*/","pix = uv;","}"].join("\n")),i=ot(["precision highp float;","varying vec2 pix;","uniform sampler2D img;","void main(void) {","gl_FragColor = texture2D(img, pix);","}"].join("\n")),R.DEFAULT=i,Ur.prototype={constructor:Ur,id:null,uniform:null,attribute:null,vertexSource:null,fragmentSource:null},R.run=function(t,e,n,N){var r,i,o,a,s,l,u,c,f,B,H,h,m,p,d,g,_,v,C,y,w=function(t){var e,n,r,i,o,a,s;if(t.glCanvas)return s=t.selection?(e=t.selection,s=t.width-1,a=t.height-1,n=e[0],r=e[1],i=e[2],o=e[3],s=e[4]?s:1,e=e[4]?a:1,n=+Q.floor(n*s),r=+Q.floor(r*e),a=(i=+Q.floor(i*s))-n+1,(o=+Q.floor(o*e))-r+1):(a=t.oCanvas.width,t.oCanvas.height),t.glCanvas.width!==a&&(t.glCanvas.width=a),t.glCanvas.height!==s&&(t.glCanvas.height=s),i=K.getGL(t.glCanvas),t.glVex?(i.bindBuffer(i.ARRAY_BUFFER,t.glPos),i.bindBuffer(i.ARRAY_BUFFER,t.glVex)):(t.glPos=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,t.glPos),i.bufferData(i.ARRAY_BUFFER,new K.Array32F([0,0,t.glCanvas.width,0,0,t.glCanvas.height,0,t.glCanvas.height,t.glCanvas.width,0,t.glCanvas.width,t.glCanvas.height]),i.STATIC_DRAW),t.glVex=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,t.glVex),i.bufferData(i.ARRAY_BUFFER,new K.Array32F([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW)),i.viewport(0,0,t.glCanvas.width,t.glCanvas.height),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i}(t),A=e.length,R=[null,null],U=[null,null],b=-1,Y=-1,x=!1;if(w){for(u=n[0],c=n[1],f=n[2],B=t.cache,r=$r(w,u,c,f,0),i=Xr(w,c,f),o=0;o<A;++o)e[o].shader&&b<0&&(b=o),e[A-1-o].shader&&Y<0&&(Y=A-1-o);for(o=0;o<A;++o)if(H=!1,H=(a=e[o]).shader&&(h=w,m=a,p=c,d=f,g=B,_=t.glPos,v=t.glVex,y=C=void 0,v=(y=m.shader)?(y=ot(y),(C=(C=g[y])||(g[y]=new Ur(y,h))).id&&(g=h,y=m,h=p,m=d,p=_,d=v,(_=C).id)&&(g.useProgram(_.id),g=g,y=y,h=h,m=m,p=p,d=d,(_=_).id)&&("pos"in _.attribute&&(g.enableVertexAttribArray(_.attribute.pos),g.bindBuffer(g.ARRAY_BUFFER,p),g.vertexAttribPointer(_.attribute.pos,2,g.FLOAT,!1,0,0)),"uv"in _.attribute&&(g.enableVertexAttribArray(_.attribute.uv),g.bindBuffer(g.ARRAY_BUFFER,d),g.vertexAttribPointer(_.attribute.uv,2,g.FLOAT,!1,0,0)),y.textures&&y.textures(g,h,m,_),"resolution"in _.uniform&&g.uniform2f(_.uniform.resolution,h,m),"dp"in _.uniform&&g.uniform2f(_.uniform.dp,1/h,1/m),y.instance&&"mode"in _.uniform&&g.uniform1i(_.uniform.mode,y.instance.mode),y.vars)&&y.vars(g,h,m,_),C):null)?!0:H){p=o===b?{fbo:r,tex:r}:s=s||Xr(w,c,f),d=o===Y?i:l=l||Xr(w,c,f),!x&&b<o&&$r(w,u,c,f,0,0,p.tex),z=O=I=E=D=$=F=M=k=X=G=T=P=S=L=void 0;for(var I,E,L=w,S=v,P=a.iterations||1,T=c,G=f,X=p,k=d,M=R,F=U,$=!1,O=!1,z=P-1,D=0;D<P;++D)E=0===D?X:(F[0]=F[0]||Xr(L,T,G),F[0]),D===z?(I=k,O=$):(F[1]=F[1]||Xr(L,T,G),I=F[1]),L.bindFramebuffer(L.FRAMEBUFFER,I.fbo),L.viewport(0,0,T,G),"img_prev_prev"in S.uniform&&("img"in S.uniform||"img_prev"in S.uniform?M[1]&&(L.activeTexture(L.TEXTURE0+1+1),L.bindTexture(L.TEXTURE_2D,M[1]),L.uniform1i(S.uniform.img_prev_prev,2)):(L.activeTexture(L.TEXTURE0+0),L.bindTexture(L.TEXTURE_2D,E.tex),L.uniform1i(S.uniform.img_prev_prev,0))),"img_prev"in S.uniform&&("img"in S.uniform?M[0]&&(L.activeTexture(L.TEXTURE0+1+0),L.bindTexture(L.TEXTURE_2D,M[0]),L.uniform1i(S.uniform.img_prev,1)):(L.activeTexture(L.TEXTURE0+0),L.bindTexture(L.TEXTURE_2D,E.tex),L.uniform1i(S.uniform.img_prev,0))),"img"in S.uniform&&(L.activeTexture(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,E.tex),L.uniform1i(S.uniform.img,0)),L.uniform1f(S.uniform.flipY,O?-1:1),L.drawArrays(L.TRIANGLES,0,6),E=F[0],F[0]=F[1],F[1]=E,O=!1;y=s,s=l,l=y,Pr(w,R[1]),R[1]=R[0],R[0]=(g=void 0,g=Yr(h=w,m=c,_=f),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,0,0,m,_,0),g),x=!0}else a.instance&&a.instance._apply&&(C=x?zr(w,c,f):u,u=a.instance._apply(C,c,f,N),x=!1);return x&&zr(w,c,f,u),Pr(w,r),kr(w,i),Pr(w,R[1]),Pr(w,R[0]),kr(w,U[0]),kr(w,U[1]),kr(w,s),kr(w,l),u}},R.uploadTexture=$r,R.getPixels=zr,R.formatFloat=function(t,e){var n=t.toString();return(!e||t<0?"":"+")+n+(-1===n.indexOf(".")?".0":"")},R.formatInt=function(t,e){return t=Q.floor(t),(!e||t<0?"":"+")+t.toString()},K.Util.GLSL=R,u=L,st="prototype",b=Object[st],lt=Function[st],ut=Array[st],ct=b.hasOwnProperty,ft=Object.keys,b=Math,ht=u.Asynchronous,mt=ht.isPlatform(ht.Platform.NODE),ht.isPlatform(ht.Platform.BROWSER),ht.supportsMultiThreading(),pt=ht.isThread(null,!0),dt=ht.isThread(),gt=u.Path,_t=u.Class.Merge,vt=u.Util.GLSL,u._notSupportClamp,u.log,Ct=b.min,At=b.max,Rt=0,b=u.FilterThread=u.Class(ht,{path:gt,name:null,_listener:null,_rand:null,constructor:function(){var n=this,r=null;pt&&n.initThread().listen("load",function(t){t&&t.filter&&(r&&(r.dispose(!0),r=null),r=ht.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&ht.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(t){var e;r&&t&&t.im?((e=t.im)[0]=u.Util.Array.typed(e[0],u.ImArray),t.params&&r.unserializeFilter(t.params),t.inputs&&r.unserializeInputs(t.inputs,e),e=r._apply(e[0],e[1],e[2]),n.send("apply",{im:!!r._update&&e,meta:r.hasMeta?r.metaData(!0):null})):n.send("apply",{im:null})}).listen("dispose",function(t){r&&(r.dispose(!0),r=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=mt?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",gt.file!==n.path.file?[gt.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:ut.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(ht.blob("function"==typeof t[n]?lt.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:ut.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),bt=u.Filter=u.Class(b,{name:"Filter",constructor:function(){this.id=++Rt,this.inputs={},this.meta=null},_isOn:!0,_isGLSL:!1,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._isGLSL=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t.$super("dispose"),t},worker:b[st].thread,metaData:function(t,e){return this.meta},getMetaData:null,setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){return t=String(t),null===e?this.inputs[t]&&delete this.inputs[t]:this.inputs[t]=[null,e,e.nref],this},unsetInput:function(t){return t=String(t),this.inputs[t]&&delete this.inputs[t],this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,r,i=this.inputs,o=ft(i),a=o.length;if(!a)return null;for(r={},n=0;n<a;++n)(null==(e=i[o[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(e[2]=e[1].nref,r[o[n]]=t===e[1]||e[1].getSelectedData(1));return r},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,r=this.inputs,i=ft(t),o=i.length,a=u.ImArray,s=u.Util.Array.typed,l=0;l<o;++l)(n=t[i[l]])&&(!0===n?n=e:n[0]=s(n[0],a),r[i[l]]=[n,null,0]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,r,i){return this.selection=!1===t?null:i?[At(0,t||0),At(0,e||0),At(0,n||0),At(0,r||0),0]:[Ct(1,At(0,t||0)),Ct(1,At(0,e||0)),Ct(1,At(0,n||0)),Ct(1,At(0,r||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},isGLSL:function(){return this._isGLSL},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},makeGLSL:function(t){return this._isGLSL=!!(t=arguments.length?t:!0),this},getGLSL:function(){return{instance:this}},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply:function(t,e,n,r){return t},apply:function(t,e,n){var r,i,o,a,s,l=this;return l.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||l.onComplete,r=t.getSelectedData(),o=r[1],a=r[2],l.$thread?(l._listener.cb=function(t){l._listener.cb=null,t&&(t.meta&&l.setMetaData(t.meta,!0),t.im)&&l._update&&(l.hasMeta&&(null!=l.meta._IMG_WIDTH&&o!==l.meta._IMG_WIDTH||null!=l.meta._IMG_HEIGHT&&a!==l.meta._IMG_HEIGHT)&&e.dimensions(l.meta._IMG_WIDTH,l.meta._IMG_HEIGHT),e.setSelectedData(u.Util.Array.typed(t.im,u.ImArray))),n&&n.call(l)},l.send("apply",{im:r,params:l.serializeFilter(),inputs:l.serializeInputs(t)})):(!dt&&l.isGLSL()?e.glCanvas&&(s=l.getGLSL())&&(s=(s=s.push||s.pop?s:[s]).filter(Wr)).length&&(i=vt.run(e,s,t.getSelectedData(),{src:t,dst:e}))&&e.setSelectedData(i):(i=l._apply(r[0],o,a,{src:t,dst:e}),l._update&&(l.hasMeta&&(null!=l.meta._IMG_WIDTH&&o!==l.meta._IMG_WIDTH||null!=l.meta._IMG_HEIGHT&&a!==l.meta._IMG_HEIGHT)&&e.dimensions(l.meta._IMG_WIDTH,l.meta._IMG_HEIGHT),e.setSelectedData(i))),n&&n.call(l))),t},toString:function(){return"[FILTER: "+this.name+"("+this.id+")]"}}),u.Filter[st].getMetaData=u.Filter[st].metaData,u.Filter[st].getInput=u.Filter[st].input,u.Filter[st].delInput=u.Filter[st].unsetInput,u.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,r=u,i=0;i<n;++i){if(!r[e=t[i]])return null;r=r[e]}return r}return u[t]||null},u.Create=function(t){var e,n=(t=_t({init:jr,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==bt[st].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==bt[st].getMetaData&&(t.metaData=t.getMetaData),delete t.init,ct.call(t,"apply")&&delete t.apply,u[n]=u.Class(bt,t)},c=Math,xt=c.sqrt,a=c.round,c.floor,It=c.min,Et=c.max,c.abs,c.sin,c.cos,c.PI,h=L.Util.Math.clamp,S=L.Util.String.esc,Lt=L.Util.String.trim,St=L.LUMA,(m=L.Color=L.Class({__static__:{clamp:h,clampPixel:function(t){return It(255,Et(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,r){return(255&r)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},intensity:function(t,e,n){return~~(St[0]*t+St[1]*e+St[2]*n)},hue:function(t,e,n){return t=t,e=e,n=n,r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),i=r=c.max(t,e,n),o=c.min(t,e,n),h(c.round(0==(r=r-o)?0:i===t?60*(0+(e-n)/r):i===e?60*(2+(n-t)/r):60*(4+(t-e)/r)),0,360);var r,i,o},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(r=!(i="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),o=r=c.max(t,e,n),e=r-(t=c.min(t,e,n)),r=0==(n=(r+t)/2)||1==n?0:(o-n)/c.min(n,1-n),t=0===o?0:e/o,h("hsv"===i?100*t:100*r,0,100));var r,i,o},dist:function(t,e,n,r){var i=t[n+0]-e[r+0],o=t[n+1]-e[r+1],t=t[n+2]-e[r+2];return xt(i*i+o*o+t*t)},RGB2Gray:function(t,e){var n=St[0]*t[e+0]+St[1]*t[e+1]+St[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=.412453*n+.35758*r+.180423*i|0,t[e+1]=.212671*n+.71516*r+.072169*i|0,t[e+2]=.019334*n+.119193*r+.950227*i|0,t},XYZ2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,r=t[e+1]/255,i=t[e+2]/255,o=Math.log,a=.412453*n+.35758*r+.180423*i,s=.212671*n+.71516*r+.072169*i,n=.019334*n+.119193*r+.950227*i,r=o(.9465229*a+.2946927*s-.1313419*n),i=o(-.1179179*a+.992996*s+.007371554*n),o=o(.09230461*a-.04645794*s+.9946464*n);return t[e+0]=27.07439*r-22.80783*i-1.806681*o,t[e+1]=-5.646736*r-7.722125*i+12.86503*o,t[e+2]=-4.163133*r-4.579428*i-4.576049*o,t},ILL2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2],o=Math.exp,a=o(.021547742011105847*n-.021969518919866274*r-.07027206572176435*i),s=o(-.018152109501074376*n-.03004415376911152*r-.07729896865586937*i),o=o(-.0014378861182725712*n+.050053456205559545*r-.07724195758868482*i),n=1.0068824301911365*a-.2924918682640871*s+.13512537828457516*o,r=.12021888110585245*a+.9717816461525606*s+.008672665360769691*o,i=-.08782494811157235*a+.07253363731909634*s+.9932476695469974*o;return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=0+.299*n+.587*r+.114*i|0,t[e+1]=128-.168736*n-.331264*r+.5*i|0,t[e+2]=128+.5*n-.418688*r-.081312*i|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=n+1.402*(i-128)|0,t[e+1]=n-.34414*(r-128)-.71414*(i-128)|0,t[e+2]=n+1.772*(r-128)|0,t},RGB2HSV:function(t,e,n){var r=Jr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HSL:function(t,e,n){var r=Zr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HWB:function(t,e,n){var r=ti(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},HSV2RGB:function(t,e,n){n=Vr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=qr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=Kr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,r=t[e+0],i=t[e+1],o=t[e+2];return 0===r&&0===i&&0===o||(n=It(r=255-r,i=255-i,o=255-o),t[e+0]=(r-n)*(r=255===n?0:255/(255-n)),t[e+1]=(i-n)*r,t[e+2]=(o-n)*r),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:Tt=1/255,C2P:Gt=100/255,P2C:Mt=2.55,Keywords:I={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(I).map(S).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*Gt+(e||"")},per2col:function(t){return t*Mt},rgb2hex:function(t,e,n,r,i){return i&&(t=h(a(t*Mt),0,255),e=h(a(e*Mt),0,255),n=h(a(n*Mt),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),r&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,r,i){return i&&(t=h(a(t*Mt),0,255),e=h(a(e*Mt),0,255),n=h(a(n*Mt),0,255),r=h(a(r*Mt),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(r=r<16?"0"+r.toString(16):r.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[h(parseInt(t[0]+t[0],16),0,255),h(parseInt(t[1]+t[1],16),0,255),h(parseInt(t[2]+t[2],16),0,255)]:[h(parseInt(t[0]+t[1],16),0,255),h(parseInt(t[2]+t[3],16),0,255),h(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:qr,hsv2rgb:Vr,hwb2rgb:Kr,rgb2hsl:Zr,rgb2hsv:Jr,rgb2hwb:ti,rgb2cmyk:ei,cmyk2rgb:ni,parse:function(t,e,n){var r,i,o,a,s,l,u,c,f=0,h=0;return"hsl"===e||!e&&(r=t.match(m.hslRE))?(u=(c=("hsl"===e?(o="hsla"===t[0].toLowerCase(),t[1]):(f=r[0].length,h=0,o="hsla"===r[1].toLowerCase(),r[2])).split(",").map(Lt))[0]||"0",t=c[1]||"0",a=c[2]||"0",l=o&&null!=c[3]?c[3]:"1",u=parseFloat(u,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*Gt,a="%"===a.slice(-1)?parseFloat(a,10):parseFloat(a,10)*Gt,l=parseFloat(l,10),u=(new m).fromHSL([u,t,a,l]),n?u:[u,0,f+h]):"rgb"===e||!e&&(r=t.match(m.rgbRE))?(a=(c=("rgb"===e?(o="rgba"===t[0].toLowerCase(),t[1]):(f=r[0].length,h=0,o="rgba"===r[1].toLowerCase(),r[2])).split(",").map(Lt))[0]||"0",s=c[1]||"0",i=c[2]||"0",l=o&&null!=c[3]?c[3]:"1",a="%"===a.slice(-1)?2.55*parseFloat(a,10):parseFloat(a,10),s="%"===s.slice(-1)?2.55*parseFloat(s,10):parseFloat(s,10),i="%"===i.slice(-1)?2.55*parseFloat(i,10):parseFloat(i,10),l=parseFloat(l,10),u=(new m).fromRGB([a,s,i,l]),n?u:[u,0,f+h]):"hex"===e||!e&&(r=t.match(m.hexRE))?(o=(c="hex"===e?m.hex2rgb(t[0]):(f=r[0].length,h=0,m.hex2rgb(r[1])))[0]||0,a=c[1]||0,s=c[2]||0,l=null!=c[3]?c[3]:255,u=(new m).fromHEX([o,a,s,l]),n?u:[u,0,f+h]):"keyword"===e||!e&&(r=t.match(m.keywordRE))?(c="keyword"===e?t[0]:(f=r[0].length,h=0,r[1]),u=(new m).fromKeyword(c),n?u:[u,0,f+h]):null},fromString:function(t,e){return m.parse(t,e,1)},fromRGB:function(t){return(new m).fromRGB(t)},fromHSL:function(t){return(new m).fromHSL(t)},fromHSV:function(t){return(new m).fromHSV(t)},fromHWB:function(t){return(new m).fromHWB(t)},fromCMYK:function(t){return(new m).fromCMYK(t)},fromHEX:function(t){return(new m).fromHEX(t)},fromKeyword:function(t){return(new m).fromKeyword(t)},fromPixel:function(t){return(new m).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new m;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=h(t[0],0,255)),null!=t[1]&&(this.col[1]=h(t[1],0,255)),null!=t[2]&&(this.col[2]=h(t[2],0,255)),null!=t[3]?this.col[3]=h(t[3],0,1):this.col[3]=1,this.kword=null),this},isTransparent:function(){return this.col[3]<1},isKeyword:function(){return!!this.kword},fromPixel:function(t){return this.col=[h((t=t||0)>>16&255,0,255),h(t>>8&255,0,255),h(255&t,0,255),h((t>>24&255)*Tt,0,1)],this.kword=null,this},fromKeyword:function(t){return t=t.toLowerCase(),m.Keywords[t]&&(this.col=m.Keywords[t].slice(),this.kword=t),this},fromHEX:function(t){return this.col[0]=t[0]?h(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?h(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?h(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?h(parseInt(t[3],10)*Tt,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?h(a(t[0]),0,255):0,this.col[1]=t[1]?h(a(t[1]),0,255):0,this.col[2]=t[2]?h(a(t[2]),0,255):0,this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=ni(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?h(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=qr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=Vr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=Kr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?h(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var r=ei(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(t,e,n){return this.kword||this.toHEX(1,e,n)},toHEX:function(t,e,n){return n?m.rgb2hexIE(this.col[0],this.col[1],this.col[2],h(a(255*this.col[3]),0,255)):m.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var r=this.col[3];return t?(e&&(r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var r=this.col[3],i=Zr(this.col[0],this.col[1],this.col[2]);return t?(e&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toString:function(t,e){return"rgb"==(t=t?t.toLowerCase():"hex")||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):"keyword"==t?this.toKeyword(1):this.toHEX(1,!1!==e,"hexie"==t)}})).toGray=m.intensity,t="prototype",p=L,M=p.CHANNEL,p.Color,Ft=p.Util.Array.copy,p.Util.Array.subarray,Ot=p.Util.Math.clamp,(Dt=Math).min,d=Dt.floor,Nt=0,M.R,M.G,M.B,M.A,(Bt=p.Image=p.Class({name:"Image",constructor:function t(e){var n=this;if(!(n instanceof t))return new t(e);n.id=++Nt,n.width=0,n.height=0,n.iCanvas=p.Canvas(0,0),n.oCanvas=p.Canvas(0,0),n.glCanvas=p.supportsGLSL()?p.Canvas(0,0):null,n.domElement=n.oCanvas,n.iData=null,n.iDataSel=null,n.oData=null,n.oDataSel=null,n._restorable=!0,n.gray=!1,n.selection=null,n._refresh=0,n.nref=0,n.cache={},n._refresh|=15,e&&n.image(e)},id:null,width:0,height:0,gray:!1,selection:null,iCanvas:null,oCanvas:null,glCanvas:null,iData:null,iDataSel:null,oData:null,oDataSel:null,glPos:null,glVex:null,domElement:null,_restorable:!0,_refresh:0,nref:0,cache:null,dispose:function(){var t=this;return t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=t.glCanvas=null,t._restorable=null,t._refresh=t.nref=null,t.cache=null,t.glPos=t.glVex=null,t},clone:function(t){return new Bt(!0===t?this.iCanvas:this.oCanvas)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,r,i){var o=this,a=arguments.length;return!1===t?(o.selection=null,o.iDataSel=null,o.oDataSel=null,o._refresh&=-13):(a<1&&(t=0),a<2&&(e=0),a<3&&(n=1),a<4&&(r=1),o.selection=i?[t<0?0:t,e<0?0:e,n<0?0:n,r<0?0:r,0]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,r<0?0:1<r?1:r,1],o._refresh|=12),o.nref=(o.nref+1)%1e3,o},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d").drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),t.nref=(t.nref+1)%1e3),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d").drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),t.nref=(t.nref+1)%1e3),t},dimensions:function(t,e){var n=this;return t===n.width&&e===n.height||(ri(n,t,e,6),n._refresh|=3,n.selection&&(n._refresh|=12),n.nref=(n.nref+1)%1e3),n},setDimensions:null,scale:function(t,e){var n,r,i=this,o=i.width,a=i.height;return t=t||1,e=e||t,1===t&&1===e||((r=(n=p.Canvas(+o,+a)).getContext("2d")).scale(t,e),o=i.width=Dt.round(t*o),a=i.height=Dt.round(e*a),r.drawImage(i.oCanvas,0,0),i.oCanvas.width=+o,i.oCanvas.height=+a,i.oCanvas.getContext("2d").drawImage(n,0,0),i._restorable&&(r.drawImage(i.iCanvas,0,0),i.iCanvas.width=i.oCanvas.width,i.iCanvas.height=i.oCanvas.height,i.iCanvas.getContext("2d").drawImage(n,0,0)),i._refresh|=3,i.selection&&(i._refresh|=12),i.nref=(i.nref+1)%1e3),i},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=p.Canvas(e,n),r=n.getContext("2d");return r.translate(e,0),r.scale(-1,1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(n,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=p.Canvas(e,n),r=e.getContext("2d");return r.translate(0,n),r.scale(1,-1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(e,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d").clearRect(0,0,e,n),t.oCanvas.getContext("2d").clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3),t},crop:function(t,e,n,r){var i,o,a,s,l,u=this,c=u.selection,f=u.width,h=u.height;if(arguments.length)s=n-(o=t)+1,l=r-(a=e)+1;else{if(!c)return u;n=c[4]?(i=f-1,h-1):i=1,o=d(c[0]*i),a=d(c[1]*n),s=d(c[2]*i)-o+1,l=d(c[3]*n)-a+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}u.width=s,u.height=l,o*=1,a*=1;t=p.Canvas(s*=1,l*=1),r=t.getContext("2d");return r.drawImage(u.oCanvas,o,a,s,l,0,0,s,l),u.oCanvas.width=s,u.oCanvas.height=l,u.oCanvas.getContext("2d").drawImage(t,0,0),u._restorable&&(r.drawImage(u.iCanvas,o,a,s,l,0,0,s,l),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.getContext("2d").drawImage(t,0,0)),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},fill:function(t,e,n,r,i){var o,a,s,l,u=this,c=u.selection,f=u.width,h=u.height,f=((r&&!f||i&&!h)&&(ri(u,e+r,n+i,6),f=u.width,h=u.height),l=c?(l=c[4]?(s=f-1,h-1):s=1,o=d(c[0]*s),a=d(c[1]*l),s=d(c[2]*s)-o+1,d(c[3]*l)-a+1):(a=o=0,s=f,h),null==n&&(n=a),s<(r=null==r?s:r)&&(r=s),l<(i=null==i?l:i)&&(i=l),e=Ot(e=null==e?o:e,o,s),n=Ot(n,a,l),u.oCanvas.getContext("2d")),h=u.iCanvas.getContext("2d");return e*=1,n*=1,r*=1,i*=1,t=t||0,u._restorable&&(h.fillStyle=t,h.fillRect(e,n,r,i)),f.fillStyle=t,f.fillRect(e,n,r,i),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&ii(e,1),e.iData):(2&e._refresh&&ii(e,2),e.oData);return Ft(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&oi(e,4),e.iDataSel):(8&e._refresh&&oi(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&ii(e,1),e.iData):(2&e._refresh&&ii(e,2),e.oData);return[Ft(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),e.nref=(e.nref+1)%1e3,e},setSelectedData:function(t){var e,n,r,i,o=this,a=o.selection,s=o.width,l=o.height;return a?(i=a[4]?(r=s-1,l-1):r=1,e=d(a[0]*r),n=d(a[1]*i),r=d(a[2]*r)-e+1,a=d(a[3]*i)-n+1,o.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,r,a),+e,+n)):o.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,+s,+l),0,0),o._refresh|=2,o.selection&&(o._refresh|=8),o.nref=(o.nref+1)%1e3,o},image:function(t){var e,n,r,i,o,a;return t?(e=this,t instanceof Bt&&(t=t.oCanvas),i="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,o=t instanceof e.oCanvas.constructor,a=t instanceof p.Canvas.Image().constructor,r=i?(n=t.videoWidth,t.videoHeight):(n=t.width,t.height),ri(e,n,r,6),a||o||i?(e._restorable&&e.iCanvas.getContext("2d").drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d").drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d").putImageData(t,0,0),e.oCanvas.getContext("2d").putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),e.nref=(e.nref+1)%1e3,e):this},setImage:null,toImage:function(n,r){function t(t){var e;"uri"!==r?((e=p.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"("+this.id+")]"}})).load=function(t,e){var n=p.Canvas.Image(),r=new Bt;return"onload"in n&&(n.onload=function(){r.image(n),"function"==typeof e&&e(r)}),n.src=t,r},Bt[t].setImage=Bt[t].image,Bt[t].setDimensions=Bt[t].dimensions,Ht=L,Object.prototype,Function.prototype,e=Array.prototype,Ut=e.slice,Yt=e.splice,Pt=e.push,(e=Ht.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:Ht.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,r=[],i=!1,o=0,a=n.length;o<a;++o)r.push(e=n[o].serializeInputs(t)),e&&(i=!0);return i?r:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,r=0,i=n.length;r<i;++r)t[r]&&n[r].unserializeInputs(t[r],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,r=t.length;n<r;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,r,i,o,a=this,s=a.filters;if(a._stable=t._stable,(n=(i=t.filters||[]).length)===(r=s.length)&&a._stable)for(e=0;e<n;++e)s[e].unserializeFilter(i[e]);else{for(e=0;e<r;++e)s[e]&&s[e].dispose(!0),s[e]=null;for(s=[],e=0;e<n;++e){if(!(o=i[e]&&i[e].filter?Ht.Filter.get(i[e].filter):null))throw new Error('Filter "'+i[e].filter+'" could not be created');s.push((new o).unserializeFilter(i[e]))}a.filters=s}return a},setMetaData:function(t,e){var n,r,i=this.filters;if(t&&t.filters&&(r=t.filters.length)&&i.length)for(n=0;n<r;++n)i[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&Pt.apply(this.filters,arguments),this},concat:null,pop:function(){return this.filters.pop()},shift:function(){return this.filters.shift()},unshift:function(){return arguments.length&&Yt.apply(this.filters,Pt.apply([0,0],arguments)),this},insertAt:function(t){var e=Ut.call(arguments);e.length;return 1<argslen&&(e.shift(),Yt.apply(this.filters,[t,0].concat(e))),this},removeAt:function(t){return this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this},reset:function(){return this.filters.length=0,this},empty:null,getGLSL:function(){for(var t,e,n=this.filters,r=[],i=n.length,o=0;o<i;++o)(t=n[o])&&((e=t.getGLSL?t.getGLSL():null)?e.push?r.push.apply(r,e):r.push(e):t._apply&&r.push({instance:t}));return r},_apply:function(t,e,n,r){var i=this,o=null,a=0,s=null,l=null;if(i.filters.length){r=r||{};for(var u,c=i.filters,f=c.length,o=new Array(f),h=0;h<f;++h)(u=c[h])&&u._isOn&&(r.container=i,r.index=h,t=u._apply(t,e,n,r),u.hasMeta)&&(o[a++]=[h,u=u.metaData()],null!=u._IMG_WIDTH)&&(s=e=u._IMG_WIDTH,l=n=u._IMG_HEIGHT)}return 0<a?(o.length>a&&(o.length=a),i.hasMeta=!0,i.meta={filters:o},null!=s&&(i.meta._IMG_WIDTH=s,i.meta._IMG_HEIGHT=l)):(i.hasMeta=!1,i.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,r=0;r<n;++r)e.push("\t"+t[r].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=e.prototype.filter,e.prototype.empty=e.prototype.reset,e.prototype.concat=e.prototype.push,Ht.CompositionFilter=Ht.CompositeFilter,n=L,Xt=n.Util.Array.copy,kt=Math,$t=kt.min,zt=kt.round,jt=n._notSupportClamp,Wt=n.Color.clampPixel,n.Create({name:"BlendFilter",init:function(t){this.set(t)},path:n.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),void 0!==e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this},_apply:function(t,e,n){var r=this.matrix;if(!r||!r.length)return t;for(var i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I,E,L,S,T,G,M,F,N=r.length,O=(t.length,Xt(t)),D=0,B=1;D<N;D+=4,++B)if(r[D+3]&&(b=r[D]||"normal",R=qt[b])&&(p=this.input(B))&&(h=p[0],m=p[1],p=p[2],(a=r[D+1]||0)<(u=l=0)&&(l=-a,a=0),(s=r[D+2]||0)<0&&(u=-s,s=0),!(e<=a||n<=s||m<=l||p<=u||(a=zt(a),s=zt(s),l=zt(l),u=zt(u),c=$t(e-a,m-l),f=$t(n-s,p-u),c<=0)||f<=0)))if(y=s*e,A=u*m,d=(C=a)+c,g=(w=l)+c,jt)for(_=0,v=f*c;_<v;++_)x=O[i=C+y<<2],I=O[i+1],E=O[i+2],L=O[i+3]/255,S=h[o=w+A<<2],T=h[o+1],G=h[o+2],M=h[o+3]/255,0<(F="normal"===b?M+L*(1-M):M+L-M*L)?(O[i]=Wt(zt(255*R(L*x/255,L,M*S/255,M)/F)),O[i+1]=Wt(zt(255*R(L*I/255,L,M*T/255,M)/F)),O[i+2]=Wt(zt(255*R(L*E/255,L,M*G/255,M)/F)),O[i+3]=Wt(zt(255*F))):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++C>=d&&(C=a,y+=e),++w>=g&&(w=l,A+=m);else for(_=0,v=f*c;_<v;++_)x=O[i=C+y<<2],I=O[i+1],E=O[i+2],L=O[i+3]/255,S=h[o=w+A<<2],T=h[o+1],G=h[o+2],M=h[o+3]/255,0<(F="normal"===b?M+L*(1-M):M+L-M*L)?(O[i]=zt(255*R(L*x/255,L,M*S/255,M)/F),O[i+1]=zt(255*R(L*I/255,L,M*T/255,M)/F),O[i+2]=zt(255*R(L*E/255,L,M*G/255,M)/F),O[i+3]=zt(255*F)):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++C>=d&&(C=a,y+=e),++w>=g&&(w=l,A+=m);return O}}),n.CombineFilter=n.BlendFilter,(qt=n.Color.Blend={normal:function(t,e,n,r){return n+t*(1-r)},multiply:function(t,e,n,r){return n*t+n*(1-e)+t*(1-r)},screen:function(t,e,n,r){return n+t-n*t},overlay:function(t,e,n,r){return 2*t<=e?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-2*t*n-e*r},darken:function(t,e,n,r){return kt.min(n*e,t*r)+n*(1-e)+t*(1-r)},lighten:function(t,e,n,r){return kt.max(n*e,t*r)+n*(1-e)+t*(1-r)},"color-dodge":function(t,e,n,r){return n===r&&0===t?n*(1-e):n===r?r*e+n*(1-e)+t*(1-r):r*e*kt.min(1,t/e*r/(r-n))+n*(1-e)+t*(1-r)},"color-burn":function(t,e,n,r){return 0===n&&t===e?r*e+t*(1-r):0===n?t*(1-r):r*e*(1-kt.min(1,(1-(e?t/e:0))*r/n))+n*(1-e)+t*(1-r)},"hard-light":function(t,e,n,r){return 2*n<=r?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-r*e-2*n*t},"soft-light":function(t,e,n,r){var i=e?t/e:0;return 2*n<=r?t*(r+(2*n-r)*(1-i))+n*(1-e)+t*(1-r):r<2*n&&4*t<=e?e*(2*n-r)*(16*kt.pow(i,3)-12*kt.pow(i,2)-3*i)+n-n*e+t:e*(2*n-r)*(kt.pow(i,.5)-i)+n-n*e+t},difference:function(t,e,n,r){return n+t-2*kt.min(n*e,t*r)},exclusion:function(t,e,n,r){return n*e+t*r-2*n*t+n*(1-e)+t*(1-r)},average:function(t,e,n,r){return(n+t)/2},add:function(t,e,n,r){return kt.min(1,n+t)},subtract:function(t,e,n,r){return kt.max(0,t+n-1)},negation:function(t,e,n,r){return 1-kt.abs(1-n-t)},"linear-light":function(t,e,n,r){return n<.5?qt.subtract(t,e,2*n,r):qt.add(t,e,2*(1-n),r)}})["linear-dodge"]=qt.add,qt["linear-burn"]=qt.subtract,Vt=L,g=Math,Kt=Vt.Util.Image.crop,Qt=Vt.Util.Image.pad,Zt=Vt.Util.Image.interpolate,Vt.Create({name:"DimensionFilter",init:function(t,e,n,r,i){this.set(t,e,n,r,i)},path:Vt.Path,mode:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!1,dispose:function(){return this.mode=null,this.$super("dispose"),this},serialize:function(){var t=this;return{mode:t.mode,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.mode,t.a,t.b,t.c,t.d),this},metaData:function(t){return this.meta},setMetaData:function(t,e){return this},set:function(t,e,n,r,i){var o=this;return t?(o.mode=String(t||"scale").toLowerCase(),o.a=e||0,o.b=n||0,o.c=r||0,o.d=i||0):(o.mode=null,o.a=0,o.b=0,o.c=0,o.d=0),o},reset:function(){return this.set(null)},_apply:function(t,e,n,r){var i=this,o=i.mode,a=i.a,s=i.b,l=i.c,u=i.d;if(i.meta=null,i.hasMeta=!1,o)switch(o){case"set":s=l&&u?(a=g.round(l*e),g.round(u*n)):(a=g.round(a),g.round(s)),t=new Vt.ImArray(a*s<<2),i.meta={_IMG_WIDTH:a,_IMG_HEIGHT:s},i.hasMeta=!0;break;case"pad":a=g.round(a),s=g.round(s),l=g.round(l),u=g.round(u),t=Qt(t,e,n,l,u,a,s),i.meta={_IMG_WIDTH:s+u+n,_IMG_HEIGHT:a+l+e},i.hasMeta=!0;break;case"crop":a=g.round(a),s=g.round(s),l=g.round(l),u=g.round(u),t=Kt(t,e,n,a,s,a+l-1,s+u-1),i.meta={_IMG_WIDTH:l,_IMG_HEIGHT:u},i.hasMeta=!0;break;default:s=l&&u?(a=g.round(l*e),g.round(u*n)):(a=g.round(a),g.round(s)),t=Zt(t,e,n,a,s),i.meta={_IMG_WIDTH:a,_IMG_HEIGHT:s},i.hasMeta=!0}return t}}),_=(Jt=L).CHANNEL,te=Jt.ColorTable,ee=Jt.Color.clampPixel,(r=Math).floor,ne=r.pow,re=r.exp,ie=1/255,oe=Jt.Util.Array.typed,l=Jt.Util.Filter.ct_eye,ae=Jt.Util.Filter.ct_multiply,se=Jt.Util.GLSL,(r=Jt.Create({name:"ColorTableFilter",init:function(t,e,n,r){var i=this;i.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,i.table[_.R]=t,i.table[_.G]=e,i.table[_.B]=n,i.table[_.A]=r},path:Jt.Path,table:null,dispose:function(){return this.table=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[_.R],tableG:this.table[_.G],tableB:this.table[_.B],tableA:this.table[_.A]}},unserialize:function(t){var e=this;return e.table[_.R]=oe(t.tableR,te),e.table[_.G]=oe(t.tableG,te),e.table[_.B]=oe(t.tableB,te),e.table[_.A]=oe(t.tableA,te),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=l(t),e=e?l(e):t,n=n?l(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=l(0,0),n=l(0,0),r=l();break;case _.G:e=l(0,0),n=l(),r=l(0,0);break;default:_.R;e=l(),n=l(0,0),r=l(0,0)}return this.set(e,n,r)},redChannel:function(){return this.channel(_.R)},greenChannel:function(){return this.channel(_.G)},blueChannel:function(){return this.channel(_.B)},channelInvert:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=l(),n=l(),r=l(-1,255);break;case _.G:e=l(),n=l(-1,255),r=l();break;default:_.R;e=l(-1,255),n=l(),r=l()}return this.set(e,n,r)},redInvert:function(){return this.channelInvert(_.R)},greenInvert:function(){return this.channelInvert(_.G)},blueInvert:function(){return this.channelInvert(_.B)},invert:function(){return this.set(Jt.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var r,i=(t=t.length?t:[t]).length,o=i+1,a=(e=e||t).length,s=a+1,l=(n=n||e).length,u=l+1,c=new te(256),f=new te(o),h=new te(256),m=new te(s),p=new te(256),d=new te(u),g=255/(o-1),_=255/(s-1),v=255/(u-1),C=0;C<o;++C)f[C]=g*C|0;for(t[0]=255*t[0]|0,C=1;C<i;++C)t[C]=t[C-1]+255*t[C]|0;for(C=0;C<s;++C)m[C]=_*C|0;for(e[0]=255*e[0]|0,C=1;C<a;++C)e[C]=e[C-1]+255*e[C]|0;for(C=0;C<u;++C)d[C]=v*C|0;for(n[0]=255*n[0]|0,C=1;C<l;++C)n[C]=n[C-1]+255*n[C]|0;for(C=0;C<256;++C){for(r=0;r<i&&C>t[r];)++r;for(c[C]=ee(f[r]),r=0;r<a&&C>e[r];)++r;for(h[C]=ee(m[r]),r=0;r<l&&C>n[r];)++r;p[C]=ee(d[r])}return this.set(c,h,p)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){for(var e=new te(t=(t=null==t?64:t)<2?2:t),n=255/(t-1),r=t/256,i=0;i<t;++i)e[i]=0|ee(n*i);return this.set(l(function(t){return e[r*t|0]}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(l(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,r=255&t;return this.set(l(function(t){return t&e}),l(function(t){return t&n}),l(function(t){return t&r}))},replace:function(t,e){var n,r,i;return t==e?this:(n=l(),r=l(),i=l(),n[t>>>16&255]=e>>>16&255,r[t>>>8&255]=e>>>8&255,i[255&t]=255&e,this.set(n,r,i))},extract:function(t,e,n){if(!e||!e.length)return this;var r=l(0,(n=n||0)>>>16&255),i=l(0,n>>>8&255),o=l(0,255&n);switch(t||_.R){case _.B:for(s=e[0],f=e[1];s<=f;++s)o[s]=ee(s);break;case _.G:for(s=e[0],f=e[1];s<=f;++s)i[s]=ee(s);break;default:_.R;for(s=e[0],f=e[1];s<=f;++s)r[s]=ee(s)}return this.set(r,i,o)},gammaCorrection:function(e,n,r){return e=e||1,n=n||e,r=r||n,e=1/e,n=1/n,r=1/r,this.set(l(function(t){return 255*ne(ie*t,e)}),l(function(t){return 255*ne(ie*t,n)}),l(function(t){return 255*ne(ie*t,r)}))},exposure:function(e){return null==e&&(e=1),this.set(l(function(t){return 255*(1-re(-e*t*ie))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(l(t+=1,128*(1-t)),l(e,128*(1-e)),l(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(l(1,t),l(1,e),l(1,n))},quickContrastCorrection:function(t){return this.set(l(null==t?1.2:+t))},set:function(t,e,n,r){var i,o,a,s;return t&&(o=(i=this.table)[_.R]||l(),e||n?(e=e||t,n=n||e,a=i[_.G]||o,s=i[_.B]||a,i[_.R]=ae(t,o),i[_.G]=ae(e,a),i[_.B]=ae(n,s)):(i[_.R]=ae(t,o),i[_.G]=i[_.R],i[_.B]=i[_.R])),this},reset:function(){return this.table=[null,null,null,null],this},getGLSL:function(){return(t=this).table&&t.table[0]?(e=t.table,a=e[0],s=e[1]||a,l=e[2]||s,u=e[3],{instance:t,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform int hasAlpha;","void main(void) {","   vec4 col = texture2D(img, pix);","   if (1 == hasAlpha) gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,texture2D(map, vec2(col.a, 0.0)).a);","   else gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,col.a);","}"].join("\n"),textures:function(t,e,n){for(var r=new Jt.Array8U(1024),i=0,o=0;i<1024;i+=4,++o)r[i]=a[o],r[i+1]=s[o],r[i+2]=l[o],r[i+3]=u?u[o]:255;se.uploadTexture(t,r,256,1,1)},vars:function(t,e,n,r){t.uniform1i(r.uniform.map,1),t.uniform1i(r.uniform.hasAlpha,u?1:0)}}):{instance:t,shader:se.DEFAULT};var t,e,a,s,l,u},combineWith:function(t){return this.set(t.getTable(_.R),t.getTable(_.G),t.getTable(_.B))},getTable:function(t){return this.table[t||_.R]||null},setTable:function(t,e){return this.table[e||_.R]=t||null,this},_apply:function(t,e,n){var r=this.table;if(r&&r[_.R]){var i,o,a=t.length,s=(15&a>>>2)<<2,l=r[0],u=r[1],c=r[2],f=r[3];if(f){for(i=0;i<s;i+=4)t[i]=l[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]],t[i+3]=f[t[i+3]];for(o=s;o<a;o+=64)t[i=o]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]]}else{for(i=0;i<s;i+=4)t[i]=l[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]];for(o=s;o<a;o+=64)t[i=o]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],++i}}return t},canRun:function(){return this._isOn&&this.table&&this.table[_.R]}})).prototype.posterize=r.prototype.levels=r.prototype.quantize,Jt.TableLookupFilter=Jt.ColorTableFilter,C=(v=L).CHANNEL,le=v.ColorMatrix,ue=v.Array8U,i=Math,ce=i.sin,fe=i.cos,he=v.CONST.toRad,v.CONST.toDeg,me=v.Util.Array.typed,i=v._notSupportClamp,y=v.Util.Filter.cm_rechannel,pe=v.Util.Filter.cm_combine,de=v.Util.Filter.cm_multiply,ge=v.Util.GLSL,(i=v.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new le(t):null},path:v.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=me(t.matrix,le),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=C.A===(t=t||0)||e?1:0;return n[5*C.R+t]=C.R===t?1:e,n[5*C.G+t]=C.G===t?1:e,n[5*C.B+t]=C.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(C.R,t)},greenChannel:function(t){return this.channel(C.G,t)},blueChannel:function(t){return this.channel(C.B,t)},alphaChannel:function(t){return this.channel(C.A,!0)},maskChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(C.R)},invertGreen:function(){return this.invertChannel(C.G)},invertBlue:function(){return this.invertChannel(C.B)},invertAlpha:function(){return this.invertChannel(C.A)},invert:function(){return this.set(y([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},desaturate:function(t){t=t||v.LUMA;return this.set(y([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},grayscale:null,saturate:function(t,e){var e=e||v.LUMA,n=1-t,r=n*e[0],i=n*e[1],n=n*e[2];return this.set(y([r+t,i,n,0,0,r,i+t,n,0,0,r,i,n+t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},colorize:function(t,e,n){var r,i,n=n||v.LUMA;return this.set(y([(i=1-(e=null==e?1:e))+e*(r=(t>>16&255)/255)*n[0],e*r*n[1],e*r*n[2],0,0,e*(r=(t>>8&255)/255)*n[0],i+e*r*n[1],e*r*n[2],0,0,e*(r=(255&t)/255)*n[0],e*r*n[1],i+e*r*n[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(y([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},brightness:function(t,e,n){return this.set(y([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},adjustHue:function(t,e){var n=fe(t*=he),t=ce(t),e=e||v.LUMA;return this.set(y([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},rotateHue:null,average:function(t,e,n){return this.set(y([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},quickContrastCorrection:function(t){return this.set(y([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set(y([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||v.LUMA;return this.set(y([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},threshold:function(t,e,n){null==e&&(e=256);var r=n||v.LUMA;return this.set(y(!1!==n?[r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,r){null==n&&(n=256);var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],o=r||v.LUMA;return C.A===t?(i[5*t+t]=n,i[5*t+4]=-n*e):(!1!==r?(i[5*t+C.R]=o[0]*n,i[5*t+C.G]=o[1]*n,i[5*t+C.B]=o[2]*n):(i[5*t+C.R]=n,i[5*t+C.G]=n,i[5*t+C.B]=n),i[5*t+4]=-(n-1)*e),this.set(i)},thresholdRed:function(t,e,n){return this.thresholdChannel(C.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(C.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(C.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(C.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set(y([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.XX,C.YY,C.ZZ,C.A))},XYZ2RGB:function(){return this.set(y([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],C.XX,C.YY,C.ZZ,C.A,C.R,C.G,C.B,C.A))},RGB2YCbCr:function(){return this.set(y([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.CB,C.CR,C.A))},YCbCr2RGB:function(){return this.set(y([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],C.Y,C.CB,C.CR,C.A,C.R,C.G,C.B,C.A))},RGB2YIQ:function(){return this.set(y([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.IP,C.Q,C.A))},YIQ2RGB:function(){return this.set(y([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],C.Y,C.IP,C.Q,C.A,C.R,C.G,C.B,C.A))},blend:function(t,e){return this.matrix=this.matrix?pe(this.matrix,t.matrix,1-e,e,le):new le(t.matrix),this},set:function(t){return this.matrix=this.matrix?de(this.matrix,t):new le(t),this},reset:function(){return this.matrix=null,this},getGLSL:function(){return o=(t=this).matrix,{instance:t,shader:o?["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform float cm[20];","void main(void) {","   vec4 col = texture2D(img, pix);","   gl_FragColor.r = cm[0 ]*col.r+cm[1 ]*col.g+cm[2 ]*col.b+cm[3 ]*col.a+cm[4 ];","   gl_FragColor.g = cm[5 ]*col.r+cm[6 ]*col.g+cm[7 ]*col.b+cm[8 ]*col.a+cm[9 ];","   gl_FragColor.b = cm[10]*col.r+cm[11]*col.g+cm[12]*col.b+cm[13]*col.a+cm[14];","   gl_FragColor.a = cm[15]*col.r+cm[16]*col.g+cm[17]*col.b+cm[18]*col.a+cm[19];","}"].join("\n"):ge.DEFAULT,vars:o?function(t,e,n,r){var i=new v.Array32F([o[0],o[1],o[2],o[3],o[4]/255,o[5],o[6],o[7],o[8],o[9]/255,o[10],o[11],o[12],o[13],o[14]/255,o[15],o[16],o[17],o[18],o[19]/255]);t.uniform1fv(r.uniform.cm,i)}:null};var t,o},combineWith:function(t){return this.set(t.matrix)},_apply:i?function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,o=(7&i>>>2)<<2,a=new le(32),s=new ue(4),l=new le(4),u=0;u<o;u+=4)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],l[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],l[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],l[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],l[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],l[0]=l[0]<0?0:255<l[0]?255:l[0],l[1]=l[1]<0?0:255<l[1]?255:l[1],l[2]=l[2]<0?0:255<l[2]?255:l[2],l[3]=l[3]<0?0:255<l[3]?255:l[3],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3];for(u=o;u<i;u+=32)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],a[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+4],s[1]=t[u+5],s[2]=t[u+6],s[3]=t[u+7],a[4]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[5]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[6]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[7]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+8],s[1]=t[u+9],s[2]=t[u+10],s[3]=t[u+11],a[8]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[9]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[10]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[11]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+12],s[1]=t[u+13],s[2]=t[u+14],s[3]=t[u+15],a[12]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[13]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[14]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[15]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+16],s[1]=t[u+17],s[2]=t[u+18],s[3]=t[u+19],a[16]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[17]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[18]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[19]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+20],s[1]=t[u+21],s[2]=t[u+22],s[3]=t[u+23],a[20]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[21]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[22]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[23]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+24],s[1]=t[u+25],s[2]=t[u+26],s[3]=t[u+27],a[24]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[25]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[26]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[27]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+28],s[1]=t[u+29],s[2]=t[u+30],s[3]=t[u+31],a[28]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[29]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[30]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[31]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],a[0]=a[0]<0?0:255<a[0]?255:a[0],a[1]=a[1]<0?0:255<a[1]?255:a[1],a[2]=a[2]<0?0:255<a[2]?255:a[2],a[3]=a[3]<0?0:255<a[3]?255:a[3],a[4]=a[4]<0?0:255<a[4]?255:a[4],a[5]=a[5]<0?0:255<a[5]?255:a[5],a[6]=a[6]<0?0:255<a[6]?255:a[6],a[7]=a[7]<0?0:255<a[7]?255:a[7],a[8]=a[8]<0?0:255<a[8]?255:a[8],a[9]=a[9]<0?0:255<a[9]?255:a[9],a[10]=a[10]<0?0:255<a[10]?255:a[10],a[11]=a[11]<0?0:255<a[11]?255:a[11],a[12]=a[12]<0?0:255<a[12]?255:a[12],a[13]=a[13]<0?0:255<a[13]?255:a[13],a[14]=a[14]<0?0:255<a[14]?255:a[14],a[15]=a[15]<0?0:255<a[15]?255:a[15],a[16]=a[16]<0?0:255<a[16]?255:a[16],a[17]=a[17]<0?0:255<a[17]?255:a[17],a[18]=a[18]<0?0:255<a[18]?255:a[18],a[19]=a[19]<0?0:255<a[19]?255:a[19],a[20]=a[20]<0?0:255<a[20]?255:a[20],a[21]=a[21]<0?0:255<a[21]?255:a[21],a[22]=a[22]<0?0:255<a[22]?255:a[22],a[23]=a[23]<0?0:255<a[23]?255:a[23],a[24]=a[24]<0?0:255<a[24]?255:a[24],a[25]=a[25]<0?0:255<a[25]?255:a[25],a[26]=a[26]<0?0:255<a[26]?255:a[26],a[27]=a[27]<0?0:255<a[27]?255:a[27],a[28]=a[28]<0?0:255<a[28]?255:a[28],a[29]=a[29]<0?0:255<a[29]?255:a[29],a[30]=a[30]<0?0:255<a[30]?255:a[30],a[31]=a[31]<0?0:255<a[31]?255:a[31],t[u]=0|a[0],t[u+1]=0|a[1],t[u+2]=0|a[2],t[u+3]=0|a[3],t[u+4]=0|a[4],t[u+5]=0|a[5],t[u+6]=0|a[6],t[u+7]=0|a[7],t[u+8]=0|a[8],t[u+9]=0|a[9],t[u+10]=0|a[10],t[u+11]=0|a[11],t[u+12]=0|a[12],t[u+13]=0|a[13],t[u+14]=0|a[14],t[u+15]=0|a[15],t[u+16]=0|a[16],t[u+17]=0|a[17],t[u+18]=0|a[18],t[u+19]=0|a[19],t[u+20]=0|a[20],t[u+21]=0|a[21],t[u+22]=0|a[22],t[u+23]=0|a[23],t[u+24]=0|a[24],t[u+25]=0|a[25],t[u+26]=0|a[26],t[u+27]=0|a[27],t[u+28]=0|a[28],t[u+29]=0|a[29],t[u+30]=0|a[30],t[u+31]=0|a[31]}return t}:function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,o=(7&i>>>2)<<2,a=new le(32),s=new ue(4),l=new le(4),u=0;u<o;u+=4)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],l[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],l[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],l[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],l[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3];for(u=o;u<i;u+=32)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],a[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+4],s[1]=t[u+5],s[2]=t[u+6],s[3]=t[u+7],a[4]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[5]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[6]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[7]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+8],s[1]=t[u+9],s[2]=t[u+10],s[3]=t[u+11],a[8]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[9]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[10]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[11]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+12],s[1]=t[u+13],s[2]=t[u+14],s[3]=t[u+15],a[12]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[13]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[14]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[15]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+16],s[1]=t[u+17],s[2]=t[u+18],s[3]=t[u+19],a[16]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[17]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[18]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[19]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+20],s[1]=t[u+21],s[2]=t[u+22],s[3]=t[u+23],a[20]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[21]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[22]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[23]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+24],s[1]=t[u+25],s[2]=t[u+26],s[3]=t[u+27],a[24]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[25]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[26]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[27]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+28],s[1]=t[u+29],s[2]=t[u+30],s[3]=t[u+31],a[28]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],a[29]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],a[30]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],a[31]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],t[u]=0|a[0],t[u+1]=0|a[1],t[u+2]=0|a[2],t[u+3]=0|a[3],t[u+4]=0|a[4],t[u+5]=0|a[5],t[u+6]=0|a[6],t[u+7]=0|a[7],t[u+8]=0|a[8],t[u+9]=0|a[9],t[u+10]=0|a[10],t[u+11]=0|a[11],t[u+12]=0|a[12],t[u+13]=0|a[13],t[u+14]=0|a[14],t[u+15]=0|a[15],t[u+16]=0|a[16],t[u+17]=0|a[17],t[u+18]=0|a[18],t[u+19]=0|a[19],t[u+20]=0|a[20],t[u+21]=0|a[21],t[u+22]=0|a[22],t[u+23]=0|a[23],t[u+24]=0|a[24],t[u+25]=0|a[25],t[u+26]=0|a[26],t[u+27]=0|a[27],t[u+28]=0|a[28],t[u+29]=0|a[29],t[u+30]=0|a[30],t[u+31]=0|a[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=i.prototype.desaturate,i.prototype.rotateHue=i.prototype.adjustHue,i.prototype.threshold_rgb=i.prototype.thresholdRGB,i.prototype.threshold_alpha=i.prototype.thresholdAlpha,_e=L,R=_e.MODE,_e.Color,_e.ColorMatrix,Ce=_e.Util.Array.typed,ye=_e._notSupportClamp,we=_e.Util.String.function_body,Ae=Object.prototype.hasOwnProperty,Function.prototype.toString,(R=_e.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:_e.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:R.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?t._map.toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=Ce(t.thresholds,Array),e.quantizedColors=Ce(t.quantizedColors,Array),!t._map&&t._mapName&&Ae.call(ve,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},RGB2ILL:function(){return this.set("rgb2ill")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&Ae.call(ve,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=ve[n._mapName],n._mapInit=ve["init__"+n._mapName],n._apply=ai(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=ai(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=R.prototype.quantize,R.prototype.extract=R.prototype.mask,ve={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},Re=L.ImArray,be=L.AffineMatrix,xe=L.Util.Array.typed,Ie=L.Util.GLSL,Ee=L.MODE,L.CONST.toRad,b=Math,Le=b.sin,Se=b.cos,Te=b.tan,Ge=L.Util.Filter.am_multiply,(b=L.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new be(t):null},path:L.Path,matrix:null,mode:Ee.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=xe(t.matrix,be),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=Le(t),t=Se(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?Te(t):0,0,0,e?Te(e):0,1,0,0])},set:function(t){return this.matrix=this.matrix?Ge(this.matrix,t):new be(t),this},reset:function(){return this.matrix=null,this},getGLSL:function(){return i=(t=this).matrix,o=t.color||0,{instance:t,shader:i?["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform float am[6];","uniform vec4 color;","const int IGNORE="+Ee.IGNORE+";","const int CLAMP="+Ee.CLAMP+";","const int COLOR="+Ee.COLOR+";","const int WRAP="+Ee.WRAP+";","uniform int mode;","void main(void) {","   vec2 p = vec2(am[0]*pix.x+am[1]*pix.x+am[2], am[3]*pix.x+am[4]*pix.x+am[5]);","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (COLOR == mode) {gl_FragColor = color;}","       else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","       else if (WRAP == mode) {","           if (0.0 > p.x) p.x += 1.0;","           if (1.0 < p.x) p.x -= 1.0;","           if (0.0 > p.y) p.y += 1.0;","           if (1.0 < p.y) p.y -= 1.0;","           gl_FragColor = texture2D(img, p);","       }","       else {gl_FragColor = texture2D(img, pix);}","   } else {","       gl_FragColor = texture2D(img, p);","   }","}"].join("\n"):Ie.DEFAULT,vars:i?function(t,e,n,r){e=[i[0],i[1],i[2]/e+i[3],i[4],i[5],i[6]/n+i[7]];t.uniform1fv(r.uniform.am,e),t.uniform4f(r.uniform.color,(o>>>16&255)/255,(o>>>8&255)/255,(255&o)/255,(o>>>24&255)/255)}:null};var t,i,o},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this.matrix;if(!r)return t;var i,o,a,s,l,u,c,f,h,m,p,d=t.length,g=d>>>2,_=e-1,v=g-e,C=new Re(d),y=this.color||0,w=Ee.COLOR,A=(Ee.CLAMP,Ee.WRAP),R=Ee.IGNORE,b=r[0],x=r[1],I=r[2]+r[3]*_,E=r[4]*e,L=r[5],S=r[6]*e+r[7]*v,r=this.mode||R;if(w===r)for(p=y>>>24&255,f=y>>>16&255,h=y>>>8&255,m=255&y,u=a=o=i=0;u<d;u+=4,++i)e<=i&&(i=0,++o,a+=e),l=E*i+L*a+S,(s=b*i+x*o+I)<0||_<s||l<0||v<l?(C[u]=f,C[u+1]=h,C[u+2]=m,C[u+3]=p):(C[u]=t[c=(0|s)+(0|l)<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3]);else if(R===r)for(u=a=o=i=0;u<d;u+=4,++i)e<=i&&(i=0,++o,a+=e),C[u]=t[c=(0|(s=_<(s=b*i+x*o+I)||s<0?i:s))+(0|(l=v<(l=E*i+L*a+S)||l<0?a:l))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];else if(A===r)for(u=a=o=i=0;u<d;u+=4,++i)e<=i&&(i=0,++o,a+=e),C[u]=t[c=(0|(s=_<(s=b*i+x*o+I)?s-e:s<0?s+e:s))+(0|(l=v<(l=E*i+L*a+S)?l-g:l<0?l+g:l))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];else for(u=a=o=i=0;u<d;u+=4,++i)e<=i&&(i=0,++o,a+=e),C[u]=t[c=(0|(s=_<(s=b*i+x*o+I)?_:s<0?0:s))+(0|(l=v<(l=E*i+L*a+S)?v:l<0?0:l))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];return C},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=b.prototype.translate,Fe=(Me=L).MODE,Oe=Me.CHANNEL,Me.Util.Array.typed,De=Me.Util.GLSL,I=Math,Ne=I.min,I.max,V=I.floor,Me.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:Me.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:Fe.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},getGLSL:function(){return o=(i=this).input("map"),a=i.color||0,o?{instance:i,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform vec2 mapSize;","uniform vec2 start;","uniform vec2 scale;","uniform vec4 color;","uniform ivec2 component;","const int IGNORE="+Fe.IGNORE+";","const int CLAMP="+Fe.CLAMP+";","const int COLOR="+Fe.COLOR+";","const int WRAP="+Fe.WRAP+";","const int RED="+Oe.R+";","const int GREEN="+Oe.G+";","const int BLUE="+Oe.B+";","const int ALPHA="+Oe.A+";","uniform int mode;","void main(void) {","   if (pix.x < start.x || pix.x > min(1.0,start.x+mapSize.x) || pix.y < start.y || pix.y > min(1.0,start.y+mapSize.y)) {","      gl_FragColor = texture2D(img, pix);","   } else {","       vec4 mc = texture2D(map, (pix-start)/mapSize);","       vec2 p = vec2(pix.x, pix.y);","       if (ALPHA == component.x) p.x += (mc.a - 0.5)*scale.x;","       else if (BLUE == component.x) p.x += (mc.b - 0.5)*scale.x;","       else if (GREEN == component.x) p.x += (mc.g - 0.5)*scale.x;","       else p.x += (mc.r - 0.5)*scale.x;","       if (ALPHA == component.y) p.y += (mc.a - 0.5)*scale.y;","       else if (BLUE == component.y) p.y += (mc.b - 0.5)*scale.y;","       else if (GREEN == component.y) p.y += (mc.g - 0.5)*scale.y;","       else p.y += (mc.r - 0.5)*scale.y;","       if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","           if (COLOR == mode) {gl_FragColor = color;}","           else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","           else if (WRAP == mode) {","               if (0.0 > p.x) p.x += 1.0;","               if (1.0 < p.x) p.x -= 1.0;","               if (0.0 > p.y) p.y += 1.0;","               if (1.0 < p.y) p.y -= 1.0;","               gl_FragColor = texture2D(img, p);","           }","           else {gl_FragColor = texture2D(img, pix);}","       } else {","           gl_FragColor = texture2D(img, p);","       }","   }","}"].join("\n"),textures:function(t,e,n){De.uploadTexture(t,o[0],o[1],o[2],1)},vars:function(t,e,n,r){t.uniform1i(r.uniform.map,1),t.uniform2f(r.uniform.mapSize,o[1]/e,o[2]/n),t.uniform2f(r.uniform.scale,1.4*i.scaleX/255,i.scaleY/255),t.uniform2f(r.uniform.start,i.startX,i.startY),t.uniform2i(r.uniform.component,i.componentX,i.componentY),t.uniform4f(r.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255)}}:{instance:i,shader:De.DEFAULT};var i,o,a},_apply:function(t,e,n){var r=this,i=r.input("map");if(i){for(var N,B,H,U,o,a,s,l,u,c,f,h,m,p=r.color||0,d=e-1,g=n-1,_=.00390625*r.scaleX,v=.00390625*r.scaleY,C=r.componentX,y=r.componentY,Y=Fe.IGNORE,P=(Fe.CLAMP,Fe.COLOR),X=Fe.WRAP,k=r.mode||Y,$=(Me.ImArray,Me.Util.Array.copy),z=Me.Array16I,w=i[0],A=i[1],i=i[2],j=w.length,W=j>>>2,R=Ne(A,e),b=R*Ne(i,n)<<2,x=(t.length,V(r.startX*d)),I=V(r.startY*g),E=I*e,L=-x,S=-I,T=d-x,G=g-I,M=new z(W<<1),F=$(t),q=(15&W)<<2,O=0,D=0;D<q;D+=4)M[O++]=V((w[D+C]-128)*_),M[O++]=V((w[D+y]-128)*v);for(D=q;D<j;D+=64)M[O++]=V((w[D+C]-128)*_),M[O++]=V((w[D+y]-128)*v),M[O++]=V((w[D+4+C]-128)*_),M[O++]=V((w[D+4+y]-128)*v),M[O++]=V((w[D+8+C]-128)*_),M[O++]=V((w[D+8+y]-128)*v),M[O++]=V((w[D+12+C]-128)*_),M[O++]=V((w[D+12+y]-128)*v),M[O++]=V((w[D+16+C]-128)*_),M[O++]=V((w[D+16+y]-128)*v),M[O++]=V((w[D+20+C]-128)*_),M[O++]=V((w[D+20+y]-128)*v),M[O++]=V((w[D+24+C]-128)*_),M[O++]=V((w[D+24+y]-128)*v),M[O++]=V((w[D+28+C]-128)*_),M[O++]=V((w[D+28+y]-128)*v),M[O++]=V((w[D+32+C]-128)*_),M[O++]=V((w[D+32+y]-128)*v),M[O++]=V((w[D+36+C]-128)*_),M[O++]=V((w[D+36+y]-128)*v),M[O++]=V((w[D+40+C]-128)*_),M[O++]=V((w[D+40+y]-128)*v),M[O++]=V((w[D+44+C]-128)*_),M[O++]=V((w[D+44+y]-128)*v),M[O++]=V((w[D+48+C]-128)*_),M[O++]=V((w[D+48+y]-128)*v),M[O++]=V((w[D+52+C]-128)*_),M[O++]=V((w[D+52+y]-128)*v),M[O++]=V((w[D+56+C]-128)*_),M[O++]=V((w[D+56+y]-128)*v),M[O++]=V((w[D+60+C]-128)*_),M[O++]=V((w[D+60+y]-128)*v);if(P===k)for(N=p>>>24&255,B=p>>>16&255,H=p>>>8&255,U=255&p,D=l=s=a=o=0;D<b;D+=4,++o)R<=o&&(o=0,++a,s+=e,l+=A),a<S||G<a||o<L||T<o||(c=(u=o+x)+s+E<<2,h=u+M[O=o+l<<1],g<(m=a+I+M[O+1])||m<0||d<h||h<0?(t[c]=B,t[c+1]=H,t[c+2]=U,t[c+3]=N):(t[c]=F[f=h+m*e<<2],t[c+1]=F[f+1],t[c+2]=F[f+2],t[c+3]=F[f+3]));else if(Y===k)for(D=l=s=a=o=0;D<b;D+=4,++o)R<=o&&(o=0,++a,s+=e,l+=A),a<S||G<a||o<L||T<o||(c=(u=o+x)+s+E<<2,h=u+M[O=o+l<<1],g<(m=a+I+M[O+1]))||m<0||d<h||h<0||(t[c]=F[f=h+m*e<<2],t[c+1]=F[f+1],t[c+2]=F[f+2],t[c+3]=F[f+3]);else if(X===k)for(D=l=s=a=o=0;D<b;D+=4,++o)R<=o&&(o=0,++a,s+=e,l+=A),a<S||G<a||o<L||T<o||(h=(u=o+x)+M[O=o+l<<1],m=a+I+M[O+1],t[c=u+s+E<<2]=F[f=(h=d<h?h-e:h<0?h+e:h)+(m=g<m?m-n:m<0?m+n:m)*e<<2],t[c+1]=F[f+1],t[c+2]=F[f+2],t[c+3]=F[f+3]);else for(D=l=s=a=o=0;D<b;D+=4,++o)R<=o&&(o=0,++a,s+=e,l+=A),a<S||G<a||o<L||T<o||(h=(u=o+x)+M[O=o+l<<1],m=a+I+M[O+1],t[c=u+s+E<<2]=F[f=(h=d<h?d:h<0?0:h)+(m=g<m?g:m<0?0:m)*e<<2],t[c+1]=F[f+1],t[c+2]=F[f+2],t[c+3]=F[f+3])}return t}});var si,G=L,S=G.MODE,li=G.Util.String.function_body,M=Math,ui=M.floor,ci=M.round,fi=M.sqrt,hi=M.atan2,mi=M.sin,pi=M.cos,di=M.max,gi=(M.min,2*M.PI),_i=G.Util.Math.clamp,vi=(G.POS.X,G.POS.Y),Ci=Object.prototype.hasOwnProperty;function yi(t,e){e=e?li(e):"",t=li(t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(G)}function wi(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n];return e}function Ai(t,e){for(var n=[],r=[],i=[],o=t.length,a=e,s=a>>>1,l=0,u=0,c=0;c<o;)r.push(l-s),r.push(u-s),t[c]&&(n.push(l-s),n.push(u-s),i.push(t[c])),++c,a<=++l&&(l=0,++u);return[new Ye(n),new Ye(r),new He(i)]}function Ri(t,e){for(var n=new Array(t),r=0,i=0;i<t;++i,++r)n[i]=e(r,0,t);return n}function bi(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function xi(t,e){var n,r=t>>>1,i=new Array(t);if(e)for(n=0;n<t;++n)i[t-1-n]=n-r;else for(n=0;n<t;++n)i[n]=n-r;return i}function Ii(t){var e,n,r,i,o=nn.length;if(--t<o)e=nn[t];else for(e=nn[o-1];o<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,r=0,i=n.length-1;r<i;++r)e[r+1]=n[r]+n[r+1];e[n.length]=1,o<20&&nn.push(e),++o}return e.slice()}function Ei(t,e){return 1===e?Pe(xi(t,1),Ii(t)):Pe(Ii(t),xi(t,0))}function Li(t,e){return 1===e?Pe(xi(t,1),bi(t)):Pe(bi(t),xi(t,0))}function Si(t,e,n){e=e||1,n=n||e;for(var r=t*t,i=new He(r),o=0;o<t;++o)i[o]=e;return i[r>>>1]=n,i}function Ti(t){for(var e=t*t,n=new cn(e),r=0;r<e;++r)n[r]=1;return n}function Gi(t,e,n,r,i,o,a,s,l,u,c){var f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I=e.length,E=r-1,L=(I>>>o)-r,S=e;if(e=n,n=S,rn.MODE.GRAY===t){for(x=a.length,f=0;f<c;++f)for(S=e,e=n,n=S,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<x;d+=2)A=h+a[d],R=m+a[d+1],A<0||E<A||R<0||L<R||(g=l(C=e[b=A+R<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}if(s)for(x=(a=s).length,f=0;f<c;++f)for(S=e,e=n,n=S,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<x;d+=2)A=h+a[d],R=m+a[d+1],A<0||E<A||R<0||L<R||(g=l(C=e[b=A+R<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}}else{for(x=a.length,f=0;f<c;++f)for(S=e,e=n,n=S,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=v=u,d=0;d<x;d+=2)A=h+a[d],R=m+a[d+1],A<0||E<A||R<0||L<R||(C=e[b=A+R<<2],y=e[b+1],w=e[b+2],g=l(C,g),_=l(y,_),v=l(w,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}if(s)for(x=(a=s).length,f=0;f<c;++f)for(S=e,e=n,n=S,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=v=u,d=0;d<x;d+=2)A=h+a[d],R=m+a[d+1],A<0||E<A||R<0||L<R||(C=e[b=A+R<<2],y=e[b+1],w=e[b+2],g=l(C,g),_=l(y,_),v=l(w,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}}}function Mi(t,e,n){t[e]=n,Oi(t,0,e)}function Fi(t,e){var n,r=t[e-1];if(e-1){n=t[0],t[0]=r;var i,o,a=t,s=0,l=t=e-1,t=s,e=a[s];for(i=2*s+1;i<l;)(o=i+1)<l&&a[i]>=a[o]&&(i=o),a[s]=a[i],i=2*(s=i)+1;return a[s]=e,Oi(a,t,s),n}return r}function Oi(t,e,n){for(var r,i,o=t[n];e<n&&o<(i=t[r=n-1>>>1]);)t[n]=i,n=r;t[n]=o}function Di(t,e,n){var t=7&t,r=t<4?e:n,n=t<4?n:e;return(1&t?-r:r)+(2&t?-2*n:2*n)}function Ni(t,e){var n=.211324865,r=.366025403*(t+e),i=e+r,r=Ln(t+r),i=Ln(i),o=(r+i)*n,t=t-(r-o),e=e-(i-o),o=e<t?(c=1,0):(c=0,1),a=t-c+n,s=e-o+n,l=t-1+2*n,n=e-1+2*n,r=255&r,i=255&i,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*Di(A[r+A[i]],t,e),t=.5-a*a-s*s,e=t<0?0:(t*=t)*t*Di(A[r+c+A[i+o]],a,s),t=.5-l*l-n*n,c=t<0?0:(t*=t)*t*Di(A[1+r+A[1+i]],l,n);return 40*(u+e+c)}function Bi(t){return t*t*t*(t*(6*t-15)+10)}function Hi(t,e,n){return e+t*(n-e)}function Ui(t,e){var n=Ln(t),r=Ln(e),t=t-n,e=e-r,i=t-1,o=e-1,a=n+1&255,s=r+1&255,l=Bi(e),u=Bi(t),n=Hi(l,Di(A[(n&=255)+A[r&=255]],t,e),Di(A[n+A[s]],t,o)),t=Hi(l,Di(A[a+A[r]],i,e),Di(A[a+A[s]],i,o));return.507*Hi(u,n,t)}function Yi(t,e,n,r,i,o,a,s,l,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%o)*s,p*((i+c[_][1])%a)*l)*d,p*=2,g+=d,d*=h;t[e]=f=~~(255*(.5*m/g+.5)),t[e+1]=f,t[e+2]=f,t[e+3]=255}function Pi(t,e,n,r,i,o,a,s,l,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%o)*s,p*((i+c[_][1])%a)*l)*d,p*=2,g+=d,d*=h;t[e]=(f=~~(16777215*(.5*m/g+.5)))>>>16&255,t[e+1]=f>>>8&255,t[e+2]=255&f,t[e+3]=255}function Xi(t,e,n,r,i,o,a,s,l,u,c,f){var h,m,p,d,g,_,v=1/o,C=1/a,y=f?Ui:Ni,w=i?Yi:Pi,A=t.length,R=e>>>1,b=n>>>1;if(u=u||1,c=c||.5,s=s||1,l=l||[[0,0]],r)for(g=m=h=0;g<A;g+=4,++h)e<=h&&(h=0,++m),d=b<m?n-1-m:m,(p=R<h?e-1-h:h)<h||d<m?(t[g]=t[_=d*e+p<<2],t[g+1]=t[1+_],t[g+2]=t[2+_],t[g+3]=255):w(t,g,y,p,d,e,n,v,C,s,l,u,c);else for(g=m=h=0;g<A;g+=4,++h)e<=h&&(h=0,++m),w(t,g,y,h,m,e,n,v,C,s,l,u,c);return t}function ki(t,e,n,r,i,o){r|=0,i|=0,o|=0;var a=new hr(256);return a[0]=(x(+n)<=o?r:i)<<2|(x(+e)<=o?r:i)<<1|(x(+t)<=o?r:i)<<0,a[1]=(x(n-1)<=o?r:i)<<2|(x(e-1)<=o?r:i)<<1|(x(t-1)<=o?r:i)<<0,a[2]=(x(n-2)<=o?r:i)<<2|(x(e-2)<=o?r:i)<<1|(x(t-2)<=o?r:i)<<0,a[3]=(x(n-3)<=o?r:i)<<2|(x(e-3)<=o?r:i)<<1|(x(t-3)<=o?r:i)<<0,a[4]=(x(n-4)<=o?r:i)<<2|(x(e-4)<=o?r:i)<<1|(x(t-4)<=o?r:i)<<0,a[5]=(x(n-5)<=o?r:i)<<2|(x(e-5)<=o?r:i)<<1|(x(t-5)<=o?r:i)<<0,a[6]=(x(n-6)<=o?r:i)<<2|(x(e-6)<=o?r:i)<<1|(x(t-6)<=o?r:i)<<0,a[7]=(x(n-7)<=o?r:i)<<2|(x(e-7)<=o?r:i)<<1|(x(t-7)<=o?r:i)<<0,a[8]=(x(n-8)<=o?r:i)<<2|(x(e-8)<=o?r:i)<<1|(x(t-8)<=o?r:i)<<0,a[9]=(x(n-9)<=o?r:i)<<2|(x(e-9)<=o?r:i)<<1|(x(t-9)<=o?r:i)<<0,a[10]=(x(n-10)<=o?r:i)<<2|(x(e-10)<=o?r:i)<<1|(x(t-10)<=o?r:i)<<0,a[11]=(x(n-11)<=o?r:i)<<2|(x(e-11)<=o?r:i)<<1|(x(t-11)<=o?r:i)<<0,a[12]=(x(n-12)<=o?r:i)<<2|(x(e-12)<=o?r:i)<<1|(x(t-12)<=o?r:i)<<0,a[13]=(x(n-13)<=o?r:i)<<2|(x(e-13)<=o?r:i)<<1|(x(t-13)<=o?r:i)<<0,a[14]=(x(n-14)<=o?r:i)<<2|(x(e-14)<=o?r:i)<<1|(x(t-14)<=o?r:i)<<0,a[15]=(x(n-15)<=o?r:i)<<2|(x(e-15)<=o?r:i)<<1|(x(t-15)<=o?r:i)<<0,a[16]=(x(n-16)<=o?r:i)<<2|(x(e-16)<=o?r:i)<<1|(x(t-16)<=o?r:i)<<0,a[17]=(x(n-17)<=o?r:i)<<2|(x(e-17)<=o?r:i)<<1|(x(t-17)<=o?r:i)<<0,a[18]=(x(n-18)<=o?r:i)<<2|(x(e-18)<=o?r:i)<<1|(x(t-18)<=o?r:i)<<0,a[19]=(x(n-19)<=o?r:i)<<2|(x(e-19)<=o?r:i)<<1|(x(t-19)<=o?r:i)<<0,a[20]=(x(n-20)<=o?r:i)<<2|(x(e-20)<=o?r:i)<<1|(x(t-20)<=o?r:i)<<0,a[21]=(x(n-21)<=o?r:i)<<2|(x(e-21)<=o?r:i)<<1|(x(t-21)<=o?r:i)<<0,a[22]=(x(n-22)<=o?r:i)<<2|(x(e-22)<=o?r:i)<<1|(x(t-22)<=o?r:i)<<0,a[23]=(x(n-23)<=o?r:i)<<2|(x(e-23)<=o?r:i)<<1|(x(t-23)<=o?r:i)<<0,a[24]=(x(n-24)<=o?r:i)<<2|(x(e-24)<=o?r:i)<<1|(x(t-24)<=o?r:i)<<0,a[25]=(x(n-25)<=o?r:i)<<2|(x(e-25)<=o?r:i)<<1|(x(t-25)<=o?r:i)<<0,a[26]=(x(n-26)<=o?r:i)<<2|(x(e-26)<=o?r:i)<<1|(x(t-26)<=o?r:i)<<0,a[27]=(x(n-27)<=o?r:i)<<2|(x(e-27)<=o?r:i)<<1|(x(t-27)<=o?r:i)<<0,a[28]=(x(n-28)<=o?r:i)<<2|(x(e-28)<=o?r:i)<<1|(x(t-28)<=o?r:i)<<0,a[29]=(x(n-29)<=o?r:i)<<2|(x(e-29)<=o?r:i)<<1|(x(t-29)<=o?r:i)<<0,a[30]=(x(n-30)<=o?r:i)<<2|(x(e-30)<=o?r:i)<<1|(x(t-30)<=o?r:i)<<0,a[31]=(x(n-31)<=o?r:i)<<2|(x(e-31)<=o?r:i)<<1|(x(t-31)<=o?r:i)<<0,a[32]=(x(n-32)<=o?r:i)<<2|(x(e-32)<=o?r:i)<<1|(x(t-32)<=o?r:i)<<0,a[33]=(x(n-33)<=o?r:i)<<2|(x(e-33)<=o?r:i)<<1|(x(t-33)<=o?r:i)<<0,a[34]=(x(n-34)<=o?r:i)<<2|(x(e-34)<=o?r:i)<<1|(x(t-34)<=o?r:i)<<0,a[35]=(x(n-35)<=o?r:i)<<2|(x(e-35)<=o?r:i)<<1|(x(t-35)<=o?r:i)<<0,a[36]=(x(n-36)<=o?r:i)<<2|(x(e-36)<=o?r:i)<<1|(x(t-36)<=o?r:i)<<0,a[37]=(x(n-37)<=o?r:i)<<2|(x(e-37)<=o?r:i)<<1|(x(t-37)<=o?r:i)<<0,a[38]=(x(n-38)<=o?r:i)<<2|(x(e-38)<=o?r:i)<<1|(x(t-38)<=o?r:i)<<0,a[39]=(x(n-39)<=o?r:i)<<2|(x(e-39)<=o?r:i)<<1|(x(t-39)<=o?r:i)<<0,a[40]=(x(n-40)<=o?r:i)<<2|(x(e-40)<=o?r:i)<<1|(x(t-40)<=o?r:i)<<0,a[41]=(x(n-41)<=o?r:i)<<2|(x(e-41)<=o?r:i)<<1|(x(t-41)<=o?r:i)<<0,a[42]=(x(n-42)<=o?r:i)<<2|(x(e-42)<=o?r:i)<<1|(x(t-42)<=o?r:i)<<0,a[43]=(x(n-43)<=o?r:i)<<2|(x(e-43)<=o?r:i)<<1|(x(t-43)<=o?r:i)<<0,a[44]=(x(n-44)<=o?r:i)<<2|(x(e-44)<=o?r:i)<<1|(x(t-44)<=o?r:i)<<0,a[45]=(x(n-45)<=o?r:i)<<2|(x(e-45)<=o?r:i)<<1|(x(t-45)<=o?r:i)<<0,a[46]=(x(n-46)<=o?r:i)<<2|(x(e-46)<=o?r:i)<<1|(x(t-46)<=o?r:i)<<0,a[47]=(x(n-47)<=o?r:i)<<2|(x(e-47)<=o?r:i)<<1|(x(t-47)<=o?r:i)<<0,a[48]=(x(n-48)<=o?r:i)<<2|(x(e-48)<=o?r:i)<<1|(x(t-48)<=o?r:i)<<0,a[49]=(x(n-49)<=o?r:i)<<2|(x(e-49)<=o?r:i)<<1|(x(t-49)<=o?r:i)<<0,a[50]=(x(n-50)<=o?r:i)<<2|(x(e-50)<=o?r:i)<<1|(x(t-50)<=o?r:i)<<0,a[51]=(x(n-51)<=o?r:i)<<2|(x(e-51)<=o?r:i)<<1|(x(t-51)<=o?r:i)<<0,a[52]=(x(n-52)<=o?r:i)<<2|(x(e-52)<=o?r:i)<<1|(x(t-52)<=o?r:i)<<0,a[53]=(x(n-53)<=o?r:i)<<2|(x(e-53)<=o?r:i)<<1|(x(t-53)<=o?r:i)<<0,a[54]=(x(n-54)<=o?r:i)<<2|(x(e-54)<=o?r:i)<<1|(x(t-54)<=o?r:i)<<0,a[55]=(x(n-55)<=o?r:i)<<2|(x(e-55)<=o?r:i)<<1|(x(t-55)<=o?r:i)<<0,a[56]=(x(n-56)<=o?r:i)<<2|(x(e-56)<=o?r:i)<<1|(x(t-56)<=o?r:i)<<0,a[57]=(x(n-57)<=o?r:i)<<2|(x(e-57)<=o?r:i)<<1|(x(t-57)<=o?r:i)<<0,a[58]=(x(n-58)<=o?r:i)<<2|(x(e-58)<=o?r:i)<<1|(x(t-58)<=o?r:i)<<0,a[59]=(x(n-59)<=o?r:i)<<2|(x(e-59)<=o?r:i)<<1|(x(t-59)<=o?r:i)<<0,a[60]=(x(n-60)<=o?r:i)<<2|(x(e-60)<=o?r:i)<<1|(x(t-60)<=o?r:i)<<0,a[61]=(x(n-61)<=o?r:i)<<2|(x(e-61)<=o?r:i)<<1|(x(t-61)<=o?r:i)<<0,a[62]=(x(n-62)<=o?r:i)<<2|(x(e-62)<=o?r:i)<<1|(x(t-62)<=o?r:i)<<0,a[63]=(x(n-63)<=o?r:i)<<2|(x(e-63)<=o?r:i)<<1|(x(t-63)<=o?r:i)<<0,a[64]=(x(n-64)<=o?r:i)<<2|(x(e-64)<=o?r:i)<<1|(x(t-64)<=o?r:i)<<0,a[65]=(x(n-65)<=o?r:i)<<2|(x(e-65)<=o?r:i)<<1|(x(t-65)<=o?r:i)<<0,a[66]=(x(n-66)<=o?r:i)<<2|(x(e-66)<=o?r:i)<<1|(x(t-66)<=o?r:i)<<0,a[67]=(x(n-67)<=o?r:i)<<2|(x(e-67)<=o?r:i)<<1|(x(t-67)<=o?r:i)<<0,a[68]=(x(n-68)<=o?r:i)<<2|(x(e-68)<=o?r:i)<<1|(x(t-68)<=o?r:i)<<0,a[69]=(x(n-69)<=o?r:i)<<2|(x(e-69)<=o?r:i)<<1|(x(t-69)<=o?r:i)<<0,a[70]=(x(n-70)<=o?r:i)<<2|(x(e-70)<=o?r:i)<<1|(x(t-70)<=o?r:i)<<0,a[71]=(x(n-71)<=o?r:i)<<2|(x(e-71)<=o?r:i)<<1|(x(t-71)<=o?r:i)<<0,a[72]=(x(n-72)<=o?r:i)<<2|(x(e-72)<=o?r:i)<<1|(x(t-72)<=o?r:i)<<0,a[73]=(x(n-73)<=o?r:i)<<2|(x(e-73)<=o?r:i)<<1|(x(t-73)<=o?r:i)<<0,a[74]=(x(n-74)<=o?r:i)<<2|(x(e-74)<=o?r:i)<<1|(x(t-74)<=o?r:i)<<0,a[75]=(x(n-75)<=o?r:i)<<2|(x(e-75)<=o?r:i)<<1|(x(t-75)<=o?r:i)<<0,a[76]=(x(n-76)<=o?r:i)<<2|(x(e-76)<=o?r:i)<<1|(x(t-76)<=o?r:i)<<0,a[77]=(x(n-77)<=o?r:i)<<2|(x(e-77)<=o?r:i)<<1|(x(t-77)<=o?r:i)<<0,a[78]=(x(n-78)<=o?r:i)<<2|(x(e-78)<=o?r:i)<<1|(x(t-78)<=o?r:i)<<0,a[79]=(x(n-79)<=o?r:i)<<2|(x(e-79)<=o?r:i)<<1|(x(t-79)<=o?r:i)<<0,a[80]=(x(n-80)<=o?r:i)<<2|(x(e-80)<=o?r:i)<<1|(x(t-80)<=o?r:i)<<0,a[81]=(x(n-81)<=o?r:i)<<2|(x(e-81)<=o?r:i)<<1|(x(t-81)<=o?r:i)<<0,a[82]=(x(n-82)<=o?r:i)<<2|(x(e-82)<=o?r:i)<<1|(x(t-82)<=o?r:i)<<0,a[83]=(x(n-83)<=o?r:i)<<2|(x(e-83)<=o?r:i)<<1|(x(t-83)<=o?r:i)<<0,a[84]=(x(n-84)<=o?r:i)<<2|(x(e-84)<=o?r:i)<<1|(x(t-84)<=o?r:i)<<0,a[85]=(x(n-85)<=o?r:i)<<2|(x(e-85)<=o?r:i)<<1|(x(t-85)<=o?r:i)<<0,a[86]=(x(n-86)<=o?r:i)<<2|(x(e-86)<=o?r:i)<<1|(x(t-86)<=o?r:i)<<0,a[87]=(x(n-87)<=o?r:i)<<2|(x(e-87)<=o?r:i)<<1|(x(t-87)<=o?r:i)<<0,a[88]=(x(n-88)<=o?r:i)<<2|(x(e-88)<=o?r:i)<<1|(x(t-88)<=o?r:i)<<0,a[89]=(x(n-89)<=o?r:i)<<2|(x(e-89)<=o?r:i)<<1|(x(t-89)<=o?r:i)<<0,a[90]=(x(n-90)<=o?r:i)<<2|(x(e-90)<=o?r:i)<<1|(x(t-90)<=o?r:i)<<0,a[91]=(x(n-91)<=o?r:i)<<2|(x(e-91)<=o?r:i)<<1|(x(t-91)<=o?r:i)<<0,a[92]=(x(n-92)<=o?r:i)<<2|(x(e-92)<=o?r:i)<<1|(x(t-92)<=o?r:i)<<0,a[93]=(x(n-93)<=o?r:i)<<2|(x(e-93)<=o?r:i)<<1|(x(t-93)<=o?r:i)<<0,a[94]=(x(n-94)<=o?r:i)<<2|(x(e-94)<=o?r:i)<<1|(x(t-94)<=o?r:i)<<0,a[95]=(x(n-95)<=o?r:i)<<2|(x(e-95)<=o?r:i)<<1|(x(t-95)<=o?r:i)<<0,a[96]=(x(n-96)<=o?r:i)<<2|(x(e-96)<=o?r:i)<<1|(x(t-96)<=o?r:i)<<0,a[97]=(x(n-97)<=o?r:i)<<2|(x(e-97)<=o?r:i)<<1|(x(t-97)<=o?r:i)<<0,a[98]=(x(n-98)<=o?r:i)<<2|(x(e-98)<=o?r:i)<<1|(x(t-98)<=o?r:i)<<0,a[99]=(x(n-99)<=o?r:i)<<2|(x(e-99)<=o?r:i)<<1|(x(t-99)<=o?r:i)<<0,a[100]=(x(n-100)<=o?r:i)<<2|(x(e-100)<=o?r:i)<<1|(x(t-100)<=o?r:i)<<0,a[101]=(x(n-101)<=o?r:i)<<2|(x(e-101)<=o?r:i)<<1|(x(t-101)<=o?r:i)<<0,a[102]=(x(n-102)<=o?r:i)<<2|(x(e-102)<=o?r:i)<<1|(x(t-102)<=o?r:i)<<0,a[103]=(x(n-103)<=o?r:i)<<2|(x(e-103)<=o?r:i)<<1|(x(t-103)<=o?r:i)<<0,a[104]=(x(n-104)<=o?r:i)<<2|(x(e-104)<=o?r:i)<<1|(x(t-104)<=o?r:i)<<0,a[105]=(x(n-105)<=o?r:i)<<2|(x(e-105)<=o?r:i)<<1|(x(t-105)<=o?r:i)<<0,a[106]=(x(n-106)<=o?r:i)<<2|(x(e-106)<=o?r:i)<<1|(x(t-106)<=o?r:i)<<0,a[107]=(x(n-107)<=o?r:i)<<2|(x(e-107)<=o?r:i)<<1|(x(t-107)<=o?r:i)<<0,a[108]=(x(n-108)<=o?r:i)<<2|(x(e-108)<=o?r:i)<<1|(x(t-108)<=o?r:i)<<0,a[109]=(x(n-109)<=o?r:i)<<2|(x(e-109)<=o?r:i)<<1|(x(t-109)<=o?r:i)<<0,a[110]=(x(n-110)<=o?r:i)<<2|(x(e-110)<=o?r:i)<<1|(x(t-110)<=o?r:i)<<0,a[111]=(x(n-111)<=o?r:i)<<2|(x(e-111)<=o?r:i)<<1|(x(t-111)<=o?r:i)<<0,a[112]=(x(n-112)<=o?r:i)<<2|(x(e-112)<=o?r:i)<<1|(x(t-112)<=o?r:i)<<0,a[113]=(x(n-113)<=o?r:i)<<2|(x(e-113)<=o?r:i)<<1|(x(t-113)<=o?r:i)<<0,a[114]=(x(n-114)<=o?r:i)<<2|(x(e-114)<=o?r:i)<<1|(x(t-114)<=o?r:i)<<0,a[115]=(x(n-115)<=o?r:i)<<2|(x(e-115)<=o?r:i)<<1|(x(t-115)<=o?r:i)<<0,a[116]=(x(n-116)<=o?r:i)<<2|(x(e-116)<=o?r:i)<<1|(x(t-116)<=o?r:i)<<0,a[117]=(x(n-117)<=o?r:i)<<2|(x(e-117)<=o?r:i)<<1|(x(t-117)<=o?r:i)<<0,a[118]=(x(n-118)<=o?r:i)<<2|(x(e-118)<=o?r:i)<<1|(x(t-118)<=o?r:i)<<0,a[119]=(x(n-119)<=o?r:i)<<2|(x(e-119)<=o?r:i)<<1|(x(t-119)<=o?r:i)<<0,a[120]=(x(n-120)<=o?r:i)<<2|(x(e-120)<=o?r:i)<<1|(x(t-120)<=o?r:i)<<0,a[121]=(x(n-121)<=o?r:i)<<2|(x(e-121)<=o?r:i)<<1|(x(t-121)<=o?r:i)<<0,a[122]=(x(n-122)<=o?r:i)<<2|(x(e-122)<=o?r:i)<<1|(x(t-122)<=o?r:i)<<0,a[123]=(x(n-123)<=o?r:i)<<2|(x(e-123)<=o?r:i)<<1|(x(t-123)<=o?r:i)<<0,a[124]=(x(n-124)<=o?r:i)<<2|(x(e-124)<=o?r:i)<<1|(x(t-124)<=o?r:i)<<0,a[125]=(x(n-125)<=o?r:i)<<2|(x(e-125)<=o?r:i)<<1|(x(t-125)<=o?r:i)<<0,a[126]=(x(n-126)<=o?r:i)<<2|(x(e-126)<=o?r:i)<<1|(x(t-126)<=o?r:i)<<0,a[127]=(x(n-127)<=o?r:i)<<2|(x(e-127)<=o?r:i)<<1|(x(t-127)<=o?r:i)<<0,a[128]=(x(n-128)<=o?r:i)<<2|(x(e-128)<=o?r:i)<<1|(x(t-128)<=o?r:i)<<0,a[129]=(x(n-129)<=o?r:i)<<2|(x(e-129)<=o?r:i)<<1|(x(t-129)<=o?r:i)<<0,a[130]=(x(n-130)<=o?r:i)<<2|(x(e-130)<=o?r:i)<<1|(x(t-130)<=o?r:i)<<0,a[131]=(x(n-131)<=o?r:i)<<2|(x(e-131)<=o?r:i)<<1|(x(t-131)<=o?r:i)<<0,a[132]=(x(n-132)<=o?r:i)<<2|(x(e-132)<=o?r:i)<<1|(x(t-132)<=o?r:i)<<0,a[133]=(x(n-133)<=o?r:i)<<2|(x(e-133)<=o?r:i)<<1|(x(t-133)<=o?r:i)<<0,a[134]=(x(n-134)<=o?r:i)<<2|(x(e-134)<=o?r:i)<<1|(x(t-134)<=o?r:i)<<0,a[135]=(x(n-135)<=o?r:i)<<2|(x(e-135)<=o?r:i)<<1|(x(t-135)<=o?r:i)<<0,a[136]=(x(n-136)<=o?r:i)<<2|(x(e-136)<=o?r:i)<<1|(x(t-136)<=o?r:i)<<0,a[137]=(x(n-137)<=o?r:i)<<2|(x(e-137)<=o?r:i)<<1|(x(t-137)<=o?r:i)<<0,a[138]=(x(n-138)<=o?r:i)<<2|(x(e-138)<=o?r:i)<<1|(x(t-138)<=o?r:i)<<0,a[139]=(x(n-139)<=o?r:i)<<2|(x(e-139)<=o?r:i)<<1|(x(t-139)<=o?r:i)<<0,a[140]=(x(n-140)<=o?r:i)<<2|(x(e-140)<=o?r:i)<<1|(x(t-140)<=o?r:i)<<0,a[141]=(x(n-141)<=o?r:i)<<2|(x(e-141)<=o?r:i)<<1|(x(t-141)<=o?r:i)<<0,a[142]=(x(n-142)<=o?r:i)<<2|(x(e-142)<=o?r:i)<<1|(x(t-142)<=o?r:i)<<0,a[143]=(x(n-143)<=o?r:i)<<2|(x(e-143)<=o?r:i)<<1|(x(t-143)<=o?r:i)<<0,a[144]=(x(n-144)<=o?r:i)<<2|(x(e-144)<=o?r:i)<<1|(x(t-144)<=o?r:i)<<0,a[145]=(x(n-145)<=o?r:i)<<2|(x(e-145)<=o?r:i)<<1|(x(t-145)<=o?r:i)<<0,a[146]=(x(n-146)<=o?r:i)<<2|(x(e-146)<=o?r:i)<<1|(x(t-146)<=o?r:i)<<0,a[147]=(x(n-147)<=o?r:i)<<2|(x(e-147)<=o?r:i)<<1|(x(t-147)<=o?r:i)<<0,a[148]=(x(n-148)<=o?r:i)<<2|(x(e-148)<=o?r:i)<<1|(x(t-148)<=o?r:i)<<0,a[149]=(x(n-149)<=o?r:i)<<2|(x(e-149)<=o?r:i)<<1|(x(t-149)<=o?r:i)<<0,a[150]=(x(n-150)<=o?r:i)<<2|(x(e-150)<=o?r:i)<<1|(x(t-150)<=o?r:i)<<0,a[151]=(x(n-151)<=o?r:i)<<2|(x(e-151)<=o?r:i)<<1|(x(t-151)<=o?r:i)<<0,a[152]=(x(n-152)<=o?r:i)<<2|(x(e-152)<=o?r:i)<<1|(x(t-152)<=o?r:i)<<0,a[153]=(x(n-153)<=o?r:i)<<2|(x(e-153)<=o?r:i)<<1|(x(t-153)<=o?r:i)<<0,a[154]=(x(n-154)<=o?r:i)<<2|(x(e-154)<=o?r:i)<<1|(x(t-154)<=o?r:i)<<0,a[155]=(x(n-155)<=o?r:i)<<2|(x(e-155)<=o?r:i)<<1|(x(t-155)<=o?r:i)<<0,a[156]=(x(n-156)<=o?r:i)<<2|(x(e-156)<=o?r:i)<<1|(x(t-156)<=o?r:i)<<0,a[157]=(x(n-157)<=o?r:i)<<2|(x(e-157)<=o?r:i)<<1|(x(t-157)<=o?r:i)<<0,a[158]=(x(n-158)<=o?r:i)<<2|(x(e-158)<=o?r:i)<<1|(x(t-158)<=o?r:i)<<0,a[159]=(x(n-159)<=o?r:i)<<2|(x(e-159)<=o?r:i)<<1|(x(t-159)<=o?r:i)<<0,a[160]=(x(n-160)<=o?r:i)<<2|(x(e-160)<=o?r:i)<<1|(x(t-160)<=o?r:i)<<0,a[161]=(x(n-161)<=o?r:i)<<2|(x(e-161)<=o?r:i)<<1|(x(t-161)<=o?r:i)<<0,a[162]=(x(n-162)<=o?r:i)<<2|(x(e-162)<=o?r:i)<<1|(x(t-162)<=o?r:i)<<0,a[163]=(x(n-163)<=o?r:i)<<2|(x(e-163)<=o?r:i)<<1|(x(t-163)<=o?r:i)<<0,a[164]=(x(n-164)<=o?r:i)<<2|(x(e-164)<=o?r:i)<<1|(x(t-164)<=o?r:i)<<0,a[165]=(x(n-165)<=o?r:i)<<2|(x(e-165)<=o?r:i)<<1|(x(t-165)<=o?r:i)<<0,a[166]=(x(n-166)<=o?r:i)<<2|(x(e-166)<=o?r:i)<<1|(x(t-166)<=o?r:i)<<0,a[167]=(x(n-167)<=o?r:i)<<2|(x(e-167)<=o?r:i)<<1|(x(t-167)<=o?r:i)<<0,a[168]=(x(n-168)<=o?r:i)<<2|(x(e-168)<=o?r:i)<<1|(x(t-168)<=o?r:i)<<0,a[169]=(x(n-169)<=o?r:i)<<2|(x(e-169)<=o?r:i)<<1|(x(t-169)<=o?r:i)<<0,a[170]=(x(n-170)<=o?r:i)<<2|(x(e-170)<=o?r:i)<<1|(x(t-170)<=o?r:i)<<0,a[171]=(x(n-171)<=o?r:i)<<2|(x(e-171)<=o?r:i)<<1|(x(t-171)<=o?r:i)<<0,a[172]=(x(n-172)<=o?r:i)<<2|(x(e-172)<=o?r:i)<<1|(x(t-172)<=o?r:i)<<0,a[173]=(x(n-173)<=o?r:i)<<2|(x(e-173)<=o?r:i)<<1|(x(t-173)<=o?r:i)<<0,a[174]=(x(n-174)<=o?r:i)<<2|(x(e-174)<=o?r:i)<<1|(x(t-174)<=o?r:i)<<0,a[175]=(x(n-175)<=o?r:i)<<2|(x(e-175)<=o?r:i)<<1|(x(t-175)<=o?r:i)<<0,a[176]=(x(n-176)<=o?r:i)<<2|(x(e-176)<=o?r:i)<<1|(x(t-176)<=o?r:i)<<0,a[177]=(x(n-177)<=o?r:i)<<2|(x(e-177)<=o?r:i)<<1|(x(t-177)<=o?r:i)<<0,a[178]=(x(n-178)<=o?r:i)<<2|(x(e-178)<=o?r:i)<<1|(x(t-178)<=o?r:i)<<0,a[179]=(x(n-179)<=o?r:i)<<2|(x(e-179)<=o?r:i)<<1|(x(t-179)<=o?r:i)<<0,a[180]=(x(n-180)<=o?r:i)<<2|(x(e-180)<=o?r:i)<<1|(x(t-180)<=o?r:i)<<0,a[181]=(x(n-181)<=o?r:i)<<2|(x(e-181)<=o?r:i)<<1|(x(t-181)<=o?r:i)<<0,a[182]=(x(n-182)<=o?r:i)<<2|(x(e-182)<=o?r:i)<<1|(x(t-182)<=o?r:i)<<0,a[183]=(x(n-183)<=o?r:i)<<2|(x(e-183)<=o?r:i)<<1|(x(t-183)<=o?r:i)<<0,a[184]=(x(n-184)<=o?r:i)<<2|(x(e-184)<=o?r:i)<<1|(x(t-184)<=o?r:i)<<0,a[185]=(x(n-185)<=o?r:i)<<2|(x(e-185)<=o?r:i)<<1|(x(t-185)<=o?r:i)<<0,a[186]=(x(n-186)<=o?r:i)<<2|(x(e-186)<=o?r:i)<<1|(x(t-186)<=o?r:i)<<0,a[187]=(x(n-187)<=o?r:i)<<2|(x(e-187)<=o?r:i)<<1|(x(t-187)<=o?r:i)<<0,a[188]=(x(n-188)<=o?r:i)<<2|(x(e-188)<=o?r:i)<<1|(x(t-188)<=o?r:i)<<0,a[189]=(x(n-189)<=o?r:i)<<2|(x(e-189)<=o?r:i)<<1|(x(t-189)<=o?r:i)<<0,a[190]=(x(n-190)<=o?r:i)<<2|(x(e-190)<=o?r:i)<<1|(x(t-190)<=o?r:i)<<0,a[191]=(x(n-191)<=o?r:i)<<2|(x(e-191)<=o?r:i)<<1|(x(t-191)<=o?r:i)<<0,a[192]=(x(n-192)<=o?r:i)<<2|(x(e-192)<=o?r:i)<<1|(x(t-192)<=o?r:i)<<0,a[193]=(x(n-193)<=o?r:i)<<2|(x(e-193)<=o?r:i)<<1|(x(t-193)<=o?r:i)<<0,a[194]=(x(n-194)<=o?r:i)<<2|(x(e-194)<=o?r:i)<<1|(x(t-194)<=o?r:i)<<0,a[195]=(x(n-195)<=o?r:i)<<2|(x(e-195)<=o?r:i)<<1|(x(t-195)<=o?r:i)<<0,a[196]=(x(n-196)<=o?r:i)<<2|(x(e-196)<=o?r:i)<<1|(x(t-196)<=o?r:i)<<0,a[197]=(x(n-197)<=o?r:i)<<2|(x(e-197)<=o?r:i)<<1|(x(t-197)<=o?r:i)<<0,a[198]=(x(n-198)<=o?r:i)<<2|(x(e-198)<=o?r:i)<<1|(x(t-198)<=o?r:i)<<0,a[199]=(x(n-199)<=o?r:i)<<2|(x(e-199)<=o?r:i)<<1|(x(t-199)<=o?r:i)<<0,a[200]=(x(n-200)<=o?r:i)<<2|(x(e-200)<=o?r:i)<<1|(x(t-200)<=o?r:i)<<0,a[201]=(x(n-201)<=o?r:i)<<2|(x(e-201)<=o?r:i)<<1|(x(t-201)<=o?r:i)<<0,a[202]=(x(n-202)<=o?r:i)<<2|(x(e-202)<=o?r:i)<<1|(x(t-202)<=o?r:i)<<0,a[203]=(x(n-203)<=o?r:i)<<2|(x(e-203)<=o?r:i)<<1|(x(t-203)<=o?r:i)<<0,a[204]=(x(n-204)<=o?r:i)<<2|(x(e-204)<=o?r:i)<<1|(x(t-204)<=o?r:i)<<0,a[205]=(x(n-205)<=o?r:i)<<2|(x(e-205)<=o?r:i)<<1|(x(t-205)<=o?r:i)<<0,a[206]=(x(n-206)<=o?r:i)<<2|(x(e-206)<=o?r:i)<<1|(x(t-206)<=o?r:i)<<0,a[207]=(x(n-207)<=o?r:i)<<2|(x(e-207)<=o?r:i)<<1|(x(t-207)<=o?r:i)<<0,a[208]=(x(n-208)<=o?r:i)<<2|(x(e-208)<=o?r:i)<<1|(x(t-208)<=o?r:i)<<0,a[209]=(x(n-209)<=o?r:i)<<2|(x(e-209)<=o?r:i)<<1|(x(t-209)<=o?r:i)<<0,a[210]=(x(n-210)<=o?r:i)<<2|(x(e-210)<=o?r:i)<<1|(x(t-210)<=o?r:i)<<0,a[211]=(x(n-211)<=o?r:i)<<2|(x(e-211)<=o?r:i)<<1|(x(t-211)<=o?r:i)<<0,a[212]=(x(n-212)<=o?r:i)<<2|(x(e-212)<=o?r:i)<<1|(x(t-212)<=o?r:i)<<0,a[213]=(x(n-213)<=o?r:i)<<2|(x(e-213)<=o?r:i)<<1|(x(t-213)<=o?r:i)<<0,a[214]=(x(n-214)<=o?r:i)<<2|(x(e-214)<=o?r:i)<<1|(x(t-214)<=o?r:i)<<0,a[215]=(x(n-215)<=o?r:i)<<2|(x(e-215)<=o?r:i)<<1|(x(t-215)<=o?r:i)<<0,a[216]=(x(n-216)<=o?r:i)<<2|(x(e-216)<=o?r:i)<<1|(x(t-216)<=o?r:i)<<0,a[217]=(x(n-217)<=o?r:i)<<2|(x(e-217)<=o?r:i)<<1|(x(t-217)<=o?r:i)<<0,a[218]=(x(n-218)<=o?r:i)<<2|(x(e-218)<=o?r:i)<<1|(x(t-218)<=o?r:i)<<0,a[219]=(x(n-219)<=o?r:i)<<2|(x(e-219)<=o?r:i)<<1|(x(t-219)<=o?r:i)<<0,a[220]=(x(n-220)<=o?r:i)<<2|(x(e-220)<=o?r:i)<<1|(x(t-220)<=o?r:i)<<0,a[221]=(x(n-221)<=o?r:i)<<2|(x(e-221)<=o?r:i)<<1|(x(t-221)<=o?r:i)<<0,a[222]=(x(n-222)<=o?r:i)<<2|(x(e-222)<=o?r:i)<<1|(x(t-222)<=o?r:i)<<0,a[223]=(x(n-223)<=o?r:i)<<2|(x(e-223)<=o?r:i)<<1|(x(t-223)<=o?r:i)<<0,a[224]=(x(n-224)<=o?r:i)<<2|(x(e-224)<=o?r:i)<<1|(x(t-224)<=o?r:i)<<0,a[225]=(x(n-225)<=o?r:i)<<2|(x(e-225)<=o?r:i)<<1|(x(t-225)<=o?r:i)<<0,a[226]=(x(n-226)<=o?r:i)<<2|(x(e-226)<=o?r:i)<<1|(x(t-226)<=o?r:i)<<0,a[227]=(x(n-227)<=o?r:i)<<2|(x(e-227)<=o?r:i)<<1|(x(t-227)<=o?r:i)<<0,a[228]=(x(n-228)<=o?r:i)<<2|(x(e-228)<=o?r:i)<<1|(x(t-228)<=o?r:i)<<0,a[229]=(x(n-229)<=o?r:i)<<2|(x(e-229)<=o?r:i)<<1|(x(t-229)<=o?r:i)<<0,a[230]=(x(n-230)<=o?r:i)<<2|(x(e-230)<=o?r:i)<<1|(x(t-230)<=o?r:i)<<0,a[231]=(x(n-231)<=o?r:i)<<2|(x(e-231)<=o?r:i)<<1|(x(t-231)<=o?r:i)<<0,a[232]=(x(n-232)<=o?r:i)<<2|(x(e-232)<=o?r:i)<<1|(x(t-232)<=o?r:i)<<0,a[233]=(x(n-233)<=o?r:i)<<2|(x(e-233)<=o?r:i)<<1|(x(t-233)<=o?r:i)<<0,a[234]=(x(n-234)<=o?r:i)<<2|(x(e-234)<=o?r:i)<<1|(x(t-234)<=o?r:i)<<0,a[235]=(x(n-235)<=o?r:i)<<2|(x(e-235)<=o?r:i)<<1|(x(t-235)<=o?r:i)<<0,a[236]=(x(n-236)<=o?r:i)<<2|(x(e-236)<=o?r:i)<<1|(x(t-236)<=o?r:i)<<0,a[237]=(x(n-237)<=o?r:i)<<2|(x(e-237)<=o?r:i)<<1|(x(t-237)<=o?r:i)<<0,a[238]=(x(n-238)<=o?r:i)<<2|(x(e-238)<=o?r:i)<<1|(x(t-238)<=o?r:i)<<0,a[239]=(x(n-239)<=o?r:i)<<2|(x(e-239)<=o?r:i)<<1|(x(t-239)<=o?r:i)<<0,a[240]=(x(n-240)<=o?r:i)<<2|(x(e-240)<=o?r:i)<<1|(x(t-240)<=o?r:i)<<0,a[241]=(x(n-241)<=o?r:i)<<2|(x(e-241)<=o?r:i)<<1|(x(t-241)<=o?r:i)<<0,a[242]=(x(n-242)<=o?r:i)<<2|(x(e-242)<=o?r:i)<<1|(x(t-242)<=o?r:i)<<0,a[243]=(x(n-243)<=o?r:i)<<2|(x(e-243)<=o?r:i)<<1|(x(t-243)<=o?r:i)<<0,a[244]=(x(n-244)<=o?r:i)<<2|(x(e-244)<=o?r:i)<<1|(x(t-244)<=o?r:i)<<0,a[245]=(x(n-245)<=o?r:i)<<2|(x(e-245)<=o?r:i)<<1|(x(t-245)<=o?r:i)<<0,a[246]=(x(n-246)<=o?r:i)<<2|(x(e-246)<=o?r:i)<<1|(x(t-246)<=o?r:i)<<0,a[247]=(x(n-247)<=o?r:i)<<2|(x(e-247)<=o?r:i)<<1|(x(t-247)<=o?r:i)<<0,a[248]=(x(n-248)<=o?r:i)<<2|(x(e-248)<=o?r:i)<<1|(x(t-248)<=o?r:i)<<0,a[249]=(x(n-249)<=o?r:i)<<2|(x(e-249)<=o?r:i)<<1|(x(t-249)<=o?r:i)<<0,a[250]=(x(n-250)<=o?r:i)<<2|(x(e-250)<=o?r:i)<<1|(x(t-250)<=o?r:i)<<0,a[251]=(x(n-251)<=o?r:i)<<2|(x(e-251)<=o?r:i)<<1|(x(t-251)<=o?r:i)<<0,a[252]=(x(n-252)<=o?r:i)<<2|(x(e-252)<=o?r:i)<<1|(x(t-252)<=o?r:i)<<0,a[253]=(x(n-253)<=o?r:i)<<2|(x(e-253)<=o?r:i)<<1|(x(t-253)<=o?r:i)<<0,a[254]=(x(n-254)<=o?r:i)<<2|(x(e-254)<=o?r:i)<<1|(x(t-254)<=o?r:i)<<0,a[255]=(x(n-255)<=o?r:i)<<2|(x(e-255)<=o?r:i)<<1|(x(t-255)<=o?r:i)<<0,a}function $i(t,e,n,r,i,o,a,s){var l,u,c,f,h,m,p,d,g=t.length,_=g>>>(r|=0),v=1<<r,C=e<<r,y=g-C,w=e-1<<r,A=a,R=s,b=a,x=s,I=new cr(mr(_/32)),E=new ur(_<<2),L=0,S=a+s>>>r;if(I[S>>>5]|=1<<(31&S),0<=s+C&&s+C<=y&&(E[L]=s,E[L+1]=a,E[L+2]=a,E[L+3]=C,L+=4),E[L]=s+C,E[L+1]=a,E[L+2]=a,E[L+3]=-C,L+=4,r)for(;0<L;){for(C=E[(L-=4)+3],m=E[L]+C,f=E[L+1],h=E[L+2],R=pr(R,m),x=dr(x,m),A=pr(A,f),b=dr(b,h),c=f;0<=c&&(S=(u=c+m)>>>r,!((d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]])||I[S>>>5]&1<<(31&S)));c-=v)I[S>>>5]|=1<<(31&S),A=pr(A,c);if(f<=c){for(S=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||I[S>>>5]&1<<(31&S));)S=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(l=c)<=h}else(l=c+v)<f&&0+C<=m&&m<=y+C&&(E[L]=m,E[L+1]=l,E[L+2]=f-v,E[L+3]=-C,L+=4),c=f+v,p=!0;for(;p;){for(S=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=w&&!d&&!(I[S>>>5]&1<<(31&S));)I[S>>>5]|=1<<(31&S),b=dr(b,c),S=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];for(0<=m+C&&m+C<=y&&(E[L]=m,E[L+1]=l,E[L+2]=c-v,E[L+3]=C,L+=4),h+v<c&&0<=m-C&&m-C<=y&&(E[L]=m,E[L+1]=h+v,E[L+2]=c-v,E[L+3]=-C,L+=4),S=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||I[S>>>5]&1<<(31&S));)S=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(l=c)<=h}}else for(;0<L;){for(C=E[(L-=4)+3],m=E[L]+C,f=E[L+1],h=E[L+2],R=pr(R,m),x=dr(x,m),A=pr(A,f),b=dr(b,h),c=f;0<=c&&!(1&i[t[S=u=c+m]]||I[S>>>5]&1<<(31&S));c-=v)I[S>>>5]|=1<<(31&S),A=pr(A,c);if(f<=c){for(S=u=c+m;c<=h&&(1&i[t[u]]||I[S>>>5]&1<<(31&S));)S=u=(c+=v)+m;p=(l=c)<=h}else(l=c+v)<f&&0+C<=m&&m<=y+C&&(E[L]=m,E[L+1]=l,E[L+2]=f-v,E[L+3]=-C,L+=4),c=f+v,p=!0;for(;p;){for(S=u=c+m;c<=w&&!(1&i[t[u]])&&!(I[S>>>5]&1<<(31&S));)I[S>>>5]|=1<<(31&S),b=dr(b,c),S=u=(c+=v)+m;for(0<=m+C&&m+C<=y&&(E[L]=m,E[L+1]=l,E[L+2]=c-v,E[L+3]=C,L+=4),h+v<c&&0<=m-C&&m-C<=y&&(E[L]=m,E[L+1]=h+v,E[L+2]=c-v,E[L+3]=-C,L+=4),S=u=c+m;c<=h&&(1&i[t[u]]||I[S>>>5]&1<<(31&S));)S=u=(c+=v)+m;p=(l=c)<=h}}return{mask:I,box:[A,R,b,x]}}function zi(t,e,n){this.id=-1,this.root=n||this}function ji(t){for(;t!==t.root;)t=t.root;return t}function Wi(t,e){(t=ji(t))!==(e=ji(e))&&(t.root=e)}function qi(t,e,n){var r=e.width*n,n=e.height*n;return t.x>=e.x-r&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+r&&t.y+t.height<=e.y+e.height+n}function Vi(t,e){return e.area-t.area}return Function.prototype.toString,G.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:G.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,posX:0,posY:1,angle:0,radius:0,mode:S.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?t._map.toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,posX:t.posX,posY:t.posY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.posX=t.posX,e.posY=t.posY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&Ci.call(si,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},polar:function(t,e,n,r){var i=this;return i.centerX=t||0,i.centerY=e||0,i.posX=n||0,i.posY=r||0,i.set("polar")},cartesian:function(t,e,n,r){var i=this;return i.centerX=t||0,i.centerY=e||0,i.posX=n||0,i.posY=r||0,i.set("cartesian")},twirl:function(t,e,n,r){var i=this;return i.angle=t||0,i.radius=e||0,i.centerX=n||0,i.centerY=r||0,i.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},set:function(t,e){var n=this;return"polar"===t?(n._mapName="polar",n._map="polar",n._mapInit=null,n._apply=function(t,e,n){var r,i,o,a,s,l,u,c,f=this,h=t.length,m=e-1,p=n-1,d=f.centerX*m,g=f.centerY*p,_=f.posX,v=(f.posY,G.MODE.COLOR),C=G.MODE.CLAMP,y=G.MODE.WRAP,w=G.MODE.IGNORE,A=f.mode||w,w=f.color||0,R=w>>>24&255,b=w>>>16&255,x=w>>>8&255,I=255&w,E=gi,L=ui(di(fi(d*d+g*g),fi((d-m)*(d-m)+g*g),fi(d*d+(g-p)*(g-p)),fi((d-m)*(d-m)+(g-p)*(g-p)))),S=new G.ImArray(h);for(o=a=u=0;u<h;++o,u+=4){if(e<=o&&(o=0,++a),_===vi?(i=ci((l=L*a/p)*pi(s=E*o/m)+g),r=ci(l*mi(s)+d)):(r=ci((l=L*o/m)*pi(s=E*a/p)+d),i=ci(l*mi(s)+g)),r<0||e<=r||i<0||n<=i){if(v===A){S[u]=b,S[u+1]=x,S[u+2]=I,S[u+3]=R;continue}if(y===A)r<0&&(r+=e),e<=r&&(r-=e),i<0&&(i+=n),n<=i&&(i-=n);else{if(C!==A)continue;r=_i(r,0,m),i=_i(i,0,p)}}c=r+i*e<<2,S[u]=t[c],S[u+1]=t[1+c],S[u+2]=t[2+c],S[u+3]=t[3+c]}return S}.bind(n),n._mapChanged=!1):"cartesian"===t?(n._mapName="cartesian",n._map="cartesian",n._mapInit=null,n._apply=function(t,e,n){var r,i,o,a,s,l,u,c=this,f=t.length,h=e-1,m=n-1,p=c.centerX*h,d=c.centerY*m,g=c.posX,_=(c.posY,G.MODE.COLOR),v=G.MODE.CLAMP,C=G.MODE.WRAP,y=G.MODE.IGNORE,w=c.mode||y,y=c.color||0,A=y>>>24&255,R=y>>>16&255,b=y>>>8&255,x=255&y,I=gi,E=ui(di(fi(p*p+d*d),fi((p-h)*(p-h)+d*d),fi(p*p+(d-m)*(d-m)),fi((p-h)*(p-h)+(d-m)*(d-m)))),L=new G.ImArray(f);for(o=a=l=0;l<f;++o,l+=4){if(e<=o&&(o=0,++a),g===vi?(i=o-p,r=a-d):(r=o-p,i=a-d),u=fi(r*r+i*i),(s=hi(i,r))<0&&(s+=gi),g===vi?(i=ci(m*u/E),r=ci(h*s/I)):(r=ci(h*u/E),i=ci(m*s/I)),r<0||e<=r||i<0||n<=i){if(_===w){L[l]=R,L[l+1]=b,L[l+2]=x,L[l+3]=A;continue}if(C===w)r<0&&(r+=e),e<=r&&(r-=e),i<0&&(i+=n),n<=i&&(i-=n);else{if(v!==w)continue;r=_i(r,0,h),i=_i(i,0,m)}}u=r+i*e<<2,L[l]=t[u],L[l+1]=t[1+u],L[l+2]=t[2+u],L[l+3]=t[3+u]}return L}.bind(n),n._mapChanged=!1):t&&Ci.call(si,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=si[n._mapName],n._mapInit=si["init__"+n._mapName],n._apply=yi(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=yi(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}}),si={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"},Be=(t=L).MODE,He=t.ConvolutionMatrix,Ue=t.ImArray,t.Array32F,Ye=t.Array16I,t.Array8U,Pe=t.Util.Filter.cm_convolve,Xe=t.Util.Filter.cm_combine,ke=t.Util.Filter.integral_convolution,$e=t.Util.Filter.separable_convolution,ze=t.Util.Array.typed,je=t._notSupportClamp,We=t.Util.GLSL,(qe=Math).SQRT2,Ve=t.CONST.toRad,t.CONST.toDeg,Ke=qe.abs,Qe=qe.sqrt,Ze=qe.sin,Je=qe.cos,tn=qe.min,en=qe.max,nn=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(t=t.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,r){var i=this;i._coeff=new He([1,0]),i.matrix2=null,i.dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,t&&t.length?i.set(t,Qe(t.length)+.5|0,e||1,n||0):(i.matrix=null,i.dim=0),i.mode=r||Be.RGB},path:t.Path,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,mode:Be.RGB,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}},unserialize:function(t){var e=this;return e.dim=t.dim,e.dim2=t.dim2,e.matrix=ze(t.matrix,He),e.matrix2=ze(t.matrix2,He),e._mat=ze(t._mat,He),e._mat2=ze(t._mat2,He),e._coeff=ze(t._coeff,He),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=ze(t._indices,Ye),e._indices2=ze(t._indices2,Ye),e._indicesf=ze(t._indicesf,Ye),e._indicesf2=ze(t._indicesf2,Ye),e},functional:function(t,e){var t=Ri(e=null==e?3:1&e?e:e+1,t),n=1/wi(t);return this.set(t,e,n,n,e,t),this._doSeparable=!0,this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set(Si(e=null==e?3:1&e?e:e+1),e,1/(e*e),0),this._doIntegral=t,this},lowPass:function(t){return this.set(Si(t=null==t?3:1&t?t:t+1),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=null==e?1:e)/((t=null==t?3:1&t?t:t+1)*t);return this.set(Si(t,e,1+e),t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=null==t?.5:t))},sharpen:function(t,e){return this.highPass(e,t=null==t?.5:t)},verticalBlur:function(t){return this.set(bi(t=null==t?3:1&t?t:t+1),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(bi(t=null==t?3:1&t?t:t+1),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,r){var i,o,a,s,l,u=t*t,c=t>>1,f=u>>1,h=new He(u),m=new He(u),p=1/t;u=1e-8<Ke(e)?(l=1,n/e):(l=e/n,1);s=a=i=0,o=u*t;for(;i<=c;)m[f+i]=f+a+s+.5|0,m[f-i]=f-a-s+.5|0,++i,a+=l,s+=o;i=0;for(;i<=c;)h[m[f+i]]=h[m[f-i]]=p,++i;return h[f]=r||1,h}(e=null==e?3:1&e?e:e+1,Je(t*=Ve),-Ze(t),1/e),e,1,0)},binomialLowPass:function(t){var e=Ii(t=null==t?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,n,n,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=Ii(t);return Pe(t,t)}(t=null==t?3:1&t?t:t+1);return this.set(Xe(Si(t),e,1,-1/wi(e)),t,1,0)},prewittX:function(t){return this.set(bi(t=null==t?3:1&t?t:t+1),t,1,0,t,xi(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(xi(t=null==t?3:1&t?t:t+1,1),t,1,0,t,bi(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=Ve,this.set(Xe(Li(e=null==e?3:1&e?e:e+1,0),Li(e,1),Je(t),Ze(t)),e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(Li(t=null==t?3:1&t?t:t+1,0),t,1,0,t,Li(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(Ii(t=null==t?3:1&t?t:t+1),t,1,0,t,xi(t,0)),this._doSeparable=!0,this},sobelY:function(t){return this.set(xi(t=null==t?3:1&t?t:t+1,1),t,1,0,t,Ii(t)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=Ve,this.set(Xe(Ei(e=null==e?3:1&e?e:e+1,0),Ei(e,1),Je(t),Ze(t)),e,1,0)},sobel:function(t){return this.set(Ei(t=null==t?3:1&t?t:t+1,0),t,1,0,t,Ei(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set(Si(t=null==t?3:1&t?t:t+1,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=null==t?-.25*qe.PI:t*Ve,this.set(function(t,e,n,r){var i,o,a,s,l,u=t*t,c=t>>>1,f=u>>>1,h=new He(u);for(i=s=0;i<=c;++i,s+=e)for(a=l=o=0;a<=c;++a,o+=t,l+=n)h[f+i+o]=s+l,h[f-i-o]=-s-l,h[f-i+o]=-s+l,h[f+i-o]=s-l;return h[f]=r||1,h}(n=null==n?3:1&n?n:n+1,(e=e||1)*Je(t),-e*Ze(t),1),n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r,i,o){var a=this;return a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,a.matrix2=null,a.dim2=0,a._indices2=a._indicesf2=null,a._mat2=null,a.matrix=new He(t),a.dim=e,a._coeff[0]=n||1,a._coeff[1]=r||0,t=Ai(a.matrix,a.dim),a._indices=t[0],a._indicesf=t[1],a._mat=t[2],o?(a.matrix2=new He(o),a.dim2=i,t=Ai(a.matrix2,a.dim2),a._indices2=t[0],a._indicesf2=t[1],a._mat2=t[2]):i&&(a.dim2=i),a},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},getGLSL:function(){var t=this,v=We.formatFloat,e=t.matrix,n=t.matrix2;return e?(t._doSeparable&&n&&(e=Pe(e,n),n=null),e=function(t,e,n,r,i,o){for(var a,s,l=[],u=[],c=[],f="c0",h=t.length,m=n,p=m>>>1,d=0,g=0,_=0;_<h;)a=d-p,s=g-p,(t[_]||0===a&&0===s)&&(l.push("vec2 p"+_+"=vec2(pix.x"+v(a,1)+"*dp.x, pix.y"+v(s,1)+"*dp.y); vec4 c"+_+"=vec4(0.0); if (0.0 <= p"+_+".x && 1.0 >= p"+_+".x && 0.0 <= p"+_+".y && 1.0 >= p"+_+".y) c"+_+"=texture2D(img,  p"+_+");"),u.push(v(t[_]*r,u.length)+"*c"+_),0===a)&&0===s&&(f="c"+_+".a"),++_,m<=++d&&(d=0,++g);if(e){for(_=g=d=0;_<h;)a=d-p,s=g-p,(e[_]||0===a&&0===s)&&(l.push("vec2 pp"+_+"=vec2(pix.x"+v(a,1)+"*dp.x, pix.y"+v(s,1)+"*dp.y); vec4 cc"+_+"=vec4(0.0); if (0.0 <= pp"+_+".x && 1.0 >= pp"+_+".x && 0.0 <= pp"+_+".y && 1.0 >= pp"+_+".y) cc"+_+"=texture2D(img,  pp"+_+");"),c.push(v(e[_]*r,c.length)+"*cc"+_)),++_,m<=++d&&(d=0,++g);return o?(l.push("vec4 o1="+u.join("")+";"),l.push("vec4 o2="+c.join("")+";"),[l.join("\n"),"vec4(sqrt(o1.r*o1.r+o2.r*o2.r),sqrt(o1.g*o1.g+o2.g*o2.g),sqrt(o1.b*o1.b+o2.b*o2.b),1.0)",f]):(l.push("vec4 o1="+u.join("")+";"),l.push("vec4 o2="+c.join("")+";"),[l.join("\n"),v(r)+"*o1"+v(i,1)+"*o2",f])}return[l.join("\n"),u.join("")+"+vec4("+v(i)+")",f]}(e,n,t.dim,t._coeff[0],t._coeff[1],t._isGrad),{instance:t,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","gl_FragColor.a = "+e[2]+";","}"].join("\n"),iterations:t._doIntegral||1}):{instance:t,shader:We.DEFAULT}},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(Pe(e.matrix,t.matrix),e.dim*t.dim,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):e},_apply:function(t,e,n){var r=this,i=r.mode;if(!r.matrix)return t;if(r._doIntegral)return r.matrix2?ke(i,t,e,n,2,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):ke(i,t,e,n,2,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return $e(i,t,e,n,2,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I,E,L,S=t.length,n=S>>>2,T=new Ue(S),G=e-1,M=n-e,F=r._coeff[0],O=r._coeff[1],D=r.matrix,N=r.matrix2,B=r._isGrad;if(Be.GRAY===i)if(N){for(b=r._indicesf.length,I=new Ye(r._indicesf),c=0;c<b;c+=2)I[c+1]*=e;for(x=D.length,l=h=f=0;l<S;l+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=C=y=w=0;c<x;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||G<m||p<0||M<p||(A=D[c],g+=t[d=m+p<<2]*A,R=N[c],C+=t[d]*R);o=B?(g=Ke(g),C=Ke(C),(L=en(g,C))?L*(1+.43*(E=tn(g,C))/L*E/L):0):F*g+O*C,T[l]=0|(o=je?o<0?0:255<o?255:o:o),T[l+1]=0|o,T[l+2]=0|o,T[l+3]=t[l+3]}}else{for(b=r._indices.length,I=new Ye(r._indices),c=0;c<b;c+=2)I[c+1]*=e;for(x=(D=r._mat).length,l=h=f=0;l<S;l+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=0;c<x;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||G<m||p<0||M<p||(A=D[c],g+=t[d=m+p<<2]*A);o=F*g+O,T[l]=0|(o=je?o<0?0:255<o?255:o:o),T[l+1]=0|o,T[l+2]=0|o,T[l+3]=t[l+3]}}else if(N){for(b=r._indicesf.length,I=new Ye(r._indicesf),c=0;c<b;c+=2)I[c+1]*=e;for(x=D.length,l=h=f=0;l<S;l+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=C=y=w=0;c<x;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||G<m||p<0||M<p||(A=D[c],g+=t[d=m+p<<2]*A,_+=t[d+1]*A,v+=t[d+2]*A,R=N[c],C+=t[d]*R,y+=t[d+1]*R,w+=t[d+2]*R);s=B?(g=Ke(g),C=Ke(C),o=(L=en(g,C))?L*(1+.43*(E=tn(g,C))/L*E/L):0,_=Ke(_),y=Ke(y),a=(L=en(_,y))?L*(1+.43*(E=tn(_,y))/L*E/L):0,v=Ke(v),w=Ke(w),(L=en(v,w))?L*(1+.43*(E=tn(v,w))/L*E/L):0):(o=F*g+O*C,a=F*_+O*y,F*v+O*w),je&&(o=o<0?0:255<o?255:o,a=a<0?0:255<a?255:a,s=s<0?0:255<s?255:s),T[l]=0|o,T[l+1]=0|a,T[l+2]=0|s,T[l+3]=t[l+3]}}else{for(b=r._indices.length,I=new Ye(r._indices),c=0;c<b;c+=2)I[c+1]*=e;for(x=(D=r._mat).length,l=h=f=0;l<S;l+=4,f++){for(e<=f&&(f=0,h+=e),u=c=g=_=v=0;c<x;c++,u+=2)m=f+I[u],p=h+I[u+1],m<0||G<m||p<0||M<p||(A=D[c],g+=t[d=m+p<<2]*A,_+=t[d+1]*A,v+=t[d+2]*A);o=F*g+O,a=F*_+O,s=F*v+O,je&&(o=o<0?0:255<o?255:o,a=a<0?0:255<a?255:a,s=s<0?0:255<s?255:s),T[l]=0|o,T[l+1]=0|a,T[l+2]=0|s,T[l+3]=t[l+3]}}return T}})).prototype.gradX=t.prototype.prewittX,t.prototype.gradY=t.prototype.prewittY,t.prototype.gradDirectional=t.prototype.prewittDirectional,t.prototype.grad=t.prototype.prewitt,t.prototype.bump=t.prototype.emboss,t.prototype.boxBlur=t.prototype.lowPass,t.prototype.gaussBlur=t.prototype.binomialLowPass,an=(rn=L).MODE,sn=rn.ImArray,ln=rn.Util.Array.copy,un=rn.Util.GLSL,cn=rn.Array8U,w=rn.Array32I,fn=Math.sqrt,hn=rn.Util.Array.typed,rn.Util.Filter.primitive_morphology_operator,mn=Ti(3),rn.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=an.RGB},path:rn.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:an.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_dim2:t._dim2,_iter:t._iter,_structureElement:t._structureElement,_indices:t._indices,_structureElement2:t._structureElement2,_indices2:t._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=hn(t._structureElement,cn),e._indices=hn(t._indices,w),e._structureElement2=hn(t._structureElement2,cn),e._indices2=hn(t._indices2,w),e._filterName=t._filterName,e._filterName&&on[e._filterName]&&(e._filter=on[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,r){var i=this,o=(i._dim2=0,i._structureElement2=null,i._indices2=null,i._iter=0|r||1,i._filterName=t,i._filter=on[t],e&&e.length?(i._structureElement=new cn(e),i._dim=fn(i._structureElement.length)+.5|0):e&&e===+e?(i._structureElement=Ti(e),i._dim=e):(i._structureElement=mn,i._dim=3),n&&n.length?(i._structureElement2=new cn(n),i._dim2=fn(i._structureElement2.length)+.5|0):n&&n===+n&&(i._structureElement2=Ti(n),i._dim2=n),[]),a=(e=i._structureElement).length,s=(f=i._dim)>>>1;for(l=c=u=0;l<a;++l,++u)f<=u&&(u=0,++c),e[l]&&(o.push(u-s),o.push(c-s));if(i._indices=new w(o),i._structureElement2){var l,u,c,f,o=[],a=(e=i._structureElement2).length,s=(f=i._dim2)>>>1;for(l=c=u=0;l<a;++l,++u)f<=u&&(u=0,++c),e[l]&&(o.push(u-s),o.push(c-s));i._indices2=new w(o)}return i},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t},getGLSL:function(){var i=this;function t(t,e,n,r){return t=function(t,e,n,r,i){var o,a,s,l,u,c=[],f="c0",h=t.length,m=e,p=m>>>1;for(c.push("vec4 res=vec4("+r+");"),s=a=o=0,i=i||"img";s<h;)l=o-p,u=a-p,(t[s]||0==l&&0==u)&&(c.push("vec2 p"+s+"=vec2(pix.x"+d(l,1)+"*dp.x, pix.y"+d(u,1)+"*dp.y); vec4 c"+s+"=vec4(0.0); if (0.0 <= p"+s+".x && 1.0 >= p"+s+".x && 0.0 <= p"+s+".y && 1.0 >= p"+s+".y) c"+s+"=texture2D("+i+",  p"+s+");"),c.push("res="+n+"(res, c"+s+");"),0==l)&&0==u&&(f="c"+s+".a"),++s,m<=++o&&(o=0,++a);return[c.join("\n"),"res",f]}(t,i._dim,e,n,r),{instance:i,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D "+(r||"img")+";","uniform vec2 dp;","void main(void) {",t[0],"gl_FragColor = "+t[1]+";","gl_FragColor.a = "+t[2]+";","}"].join("\n"),iterations:i._iter||1}}var e,d=un.formatFloat;if(!i._dim)return{instance:i,shader:un.DEFAULT};switch(i._filterName){case"dilate":e=t(i._structureElement,"max","0.0");break;case"erode":e=t(i._structureElement,"min","1.0");break;case"open":e=[t(i._structureElement,"min","1.0"),t(i._structureElement,"max","0.0")];break;case"close":e=[t(i._structureElement,"max","0.0"),t(i._structureElement,"min","1.0")];break;case"gradient":e=[t(i._structureElement,"max","0.0"),t(i._structureElement,"min","1.0","img_prev"),{instance:i,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D img_prev;","void main(void) {","vec4 dilate = texture2D(img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate-erode)*0.5).rgb, erode.a);","}"].join("\n")}];break;case"laplacian":e=[t(i._structureElement,"max","0.0"),t(i._structureElement,"min","1.0","img_prev"),{instance:i,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D img_prev;","uniform sampler2D img_prev_prev;","void main(void) {","vec4 original = texture2D(img_prev_prev, pix);","vec4 dilate = texture2D(img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate+erode-2.0*original)*0.5).rgb, original.a);","}"].join("\n")}];break;default:e={instance:i}}return e},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),rn.Util.Filter.primitive_morphology_operator=Gi,on={dilate:function(t,e,n,r){for(var i=null,o=new sn(e.length),a=t._indices,s=a.length,l=new w(s),u=0;u<s;u+=2)l[u]=a[u],l[u+1]=a[u+1]*n;if(t._indices2)for(s=(a=t._indices2).length,i=new w(s),u=0;u<s;u+=2)i[u]=a[u],i[u+1]=a[u+1]*n;return Gi(t.mode,e,o,n,0,2,l,i,Math.max,0,t._iter),o},erode:function(t,e,n,r){for(var i=null,o=new sn(e.length),a=t._indices,s=a.length,l=new w(s),u=0;u<s;u+=2)l[u]=a[u],l[u+1]=a[u+1]*n;if(t._indices2)for(s=(a=t._indices2).length,i=new w(s),u=0;u<s;u+=2)i[u]=a[u],i[u+1]=a[u+1]*n;return Gi(t.mode,e,o,n,0,2,l,i,Math.min,255,t._iter),o},open:function(t,e,n,r){for(var i=null,o=new sn(e.length),a=t._indices,s=a.length,l=new w(s),u=0;u<s;u+=2)l[u]=a[u],l[u+1]=a[u+1]*n;if(t._indices2)for(s=(a=t._indices2).length,i=new w(s),u=0;u<s;u+=2)i[u]=a[u],i[u+1]=a[u+1]*n;Gi(t.mode,e,o,n,0,2,l,i,Math.min,255,t._iter);var c=e;return Gi(t.mode,e=o,o=c,n,0,2,l,i,Math.max,0,t._iter),o},close:function(t,e,n,r){for(var i=null,o=new sn(e.length),a=t._indices,s=a.length,l=new w(coverArea2),u=0;u<s;u+=2)l[u]=a[u],l[u+1]=a[u+1]*n;if(t._indices2)for(s=(a=t._indices2).length,i=new w(s),u=0;u<s;u+=2)i[u]=a[u],i[u+1]=a[u+1]*n;Gi(t.mode,e,o,n,0,2,l,i,Math.max,0,t._iter);var c=e;return Gi(t.mode,e=o,o=c,n,0,2,l,i,Math.min,255,t._iter),o},gradient:function(t,e,n,r){for(var i,o=null,a=e.length,s=new sn(a),l=t._indices,u=l.length,c=new w(u),f=0;f<u;f+=2)c[f]=l[f],c[f+1]=l[f+1]*n;if(t._indices2)for(u=(l=t._indices2).length,o=new w(u),f=0;f<u;f+=2)o[f]=l[f],o[f+1]=l[f+1]*n;for(i=ln(e),Gi(t.mode,i,s,n,0,2,c,o,Math.max,0,t._iter),Gi(t.mode,e,i,n,0,2,c,o,Math.min,255,t._iter),f=0;f<a;f+=4)s[f]=(s[f]-i[f])/2|0,s[f+1]=(s[f+1]-i[f+1])/2|0,s[f+2]=(s[f+2]-i[f+2])/2|0;return s},laplacian:function(t,e,n,r){for(var i,o=null,a=e.length,s=new sn(a),l=new sn(a),u=t._indices,c=u.length,f=new w(c),h=0;h<c;h+=2)f[h]=u[h],f[h+1]=u[h+1]*n;if(t._indices2)for(c=(u=t._indices2).length,o=new w(c),h=0;h<c;h+=2)o[h]=u[h],o[h+1]=u[h+1]*n;for(i=ln(e),Gi(t.mode,i,l,n,0,2,f,o,Math.max,0,t._iter),i=ln(e),Gi(t.mode,i,s,n,0,2,f,o,Math.min,255,t._iter),h=0;h<a;h+=4)s[h]=(s[h]+l[h]-2*e[h])/2|0,s[h+1]=(s[h+1]+l[h+1]-2*e[h+1])/2|0,s[h+2]=(s[h+2]+l[h+2]-2*e[h+2])/2|0;return s}},dn=(e=L).MODE,gn=e.ImArray,_n=e.Array32I,vn=e.Array32U,Cn=e.Util.GLSL,yn=e.Util.Array.typed,wn=Math.min,An=Math.max,(e=e.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=dn.RGB},path:e.Path,d:0,k:0,_filter:null,_indices:null,mode:dn.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=yn(t._indices,_n),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||0,n.k=e=wn(1,An(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";for(var r=t*t<<1,i=t>>>1,o=new _n(r),a=0,s=0,l=0;l<r;l+=2,++a)t<=a&&(a=0,++s),o[l]=a-i,o[l+1]=s-i;return n._indices=o,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t},getGLSL:function(){return{instance:this,shader:Cn.DEFAULT}},_apply:function(t,e,n){var r=this;return r.d?"0th"===r._filter||"1th"===r._filter?pn["01th"](r,t,e,n):pn[r._filter](r,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=e.prototype.minimum,e.prototype.dilate=e.prototype.maximum,pn={"01th":function(t,e,n,r){t.d;for(var i,o,a,s,l,u,c,f,h,m,p,d,g,_=e.length,v=_>>>2,C=new gn(_),y=n-1,w=v-n,A=t._indices,R=A.length,b=new _n(R),x="0th"===t._filter?(g=wn,255):(g=An,0),I=0;I<R;I+=2)b[I]=A[I],b[I+1]=A[I+1]*n;if(dn.GRAY===t.mode)for(a=o=i=0;i<_;i+=4,++o){for(n<=o&&(o=0,a+=n),p=x,I=0;I<R;I+=2)s=o+b[I],l=a+b[I+1],s<0||y<s||l<0||w<l||(p=g(e[u=s+l<<2],p));C[i]=p,C[i+1]=p,C[i+2]=p,C[i+3]=e[i+3]}else for(a=o=i=0;i<_;i+=4,++o){for(n<=o&&(o=0,a+=n),m=p=d=x,I=0;I<R;I+=2)s=o+b[I],l=a+b[I+1],s<0||y<s||l<0||w<l||(c=e[u=s+l<<2],f=e[u+1],h=e[u+2],m=g(c,m),p=g(f,p),d=g(h,d));C[i]=m,C[i+1]=p,C[i+2]=d,C[i+3]=e[i+3]}return C},kth:function(t,e,n,N){t.d;for(var r,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x,I=t.k,E=e.length,L=E>>>2,S=new gn(E),T=n-1,G=L-n,M=t._indices,F=M.length,L=F>>>1,O=new _n(F),D=0;D<F;D+=2)O[D]=M[D],O[D+1]=M[D+1]*n;if(dn.GRAY===t.mode)for(g=new gn(L),A=new vn(256),o=i=r=0;r<E;r+=4,++i){for(n<=i&&(i=0,o+=n),D=C=b=0;D<F;D+=2)a=i+O[D],s=o+O[D+1],a<0||T<a||s<0||G<s||(++b,++A[c=e[l=a+s<<2]],1===A[c]&&Mi(g,C++,c));for(b*=I,x=0,m=-1,D=C;0<D;--D)x+=A[c=Fi(g,D)],m<(A[c]=0)&&b<=x&&(m=c);S[r]=m,S[r+1]=m,S[r+2]=m,S[r+3]=e[r+3]}else for(d=new gn(L),g=new gn(L),_=new gn(L),w=new vn(256),A=new vn(256),R=new vn(256),o=i=r=0;r<E;r+=4,++i){for(n<=i&&(i=0,o+=n),D=v=C=y=b=0;D<F;D+=2)a=i+O[D],s=o+O[D+1],a<0||T<a||s<0||G<s||(u=e[l=a+s<<2],c=e[l+1],f=e[l+2],++w[u],++A[c],++R[f],++b,1===w[u]&&Mi(d,v++,u),1===A[c]&&Mi(g,C++,c),1===R[f]&&Mi(_,y++,f));for(b*=I,x=0,h=-1,D=v;0<D;--D)x+=w[u=Fi(d,D)],h<(w[u]=0)&&b<=x&&(h=u);for(x=0,m=-1,D=C;0<D;--D)x+=A[c=Fi(g,D)],m<(A[c]=0)&&b<=x&&(m=c);for(x=0,p=-1,D=y;0<D;--D)x+=R[f=Fi(_,D)],p<(R[f]=0)&&b<=x&&(p=f);S[r]=h,S[r+1]=m,S[r+2]=p,S[r+3]=e[r+3]}return S}},Rn=L,bn=Object.prototype.hasOwnProperty,Rn.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:Rn.Path,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_filter:!1!==t._filter&&(t._changed&&t._filter?(t._filter.filter||t._filter).toString():null),_params:t._params};return t._changed=!1,e},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(Rn)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)bn.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},set:function(t,e){var n=this;return!1===t?(n._filter=!1,n._changed=!0):("function"!=typeof t&&"function"!=typeof t.filter||(n._filter=t,n._changed=!0),e&&n.params(e)),n},getGLSL:function(){var t=this._filter;return t&&t.shader?{instance:this,shader:t.shader,textures:t.textures,vars:t.vars}:{instance:this}},_apply:function(t,e,n,r){var i=this._filter;return i?(i="function"==typeof i.filter?i.filter:i)(this._params,t,e,n,r):t},canRun:function(){return this._isOn&&this._filter}}),Rn.CustomFilter=Rn.InlineFilter,xn=L._notSupportClamp,(In=L.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:L.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var r,i,o,a,s,l,u,c,f=In.random,h=this.max-this.min,m=this.min,p=t.length;if(xn)for(r=0;r<p;r+=4)o=t[r],a=t[r+1],s=t[r+2],(l=o+(i=h*f()+m))<0?l=0:255<l&&(l=255),(u=a+i)<0?u=0:255<u&&(u=255),(c=s+i)<0?c=0:255<c&&(c=255),t[r]=0|l,t[r+1]=0|u,t[r+2]=0|c;else for(r=0;r<p;r+=4)o=t[r],a=t[r+1],s=t[r+2],u=a+(i=h*f()+m),c=s+i,t[r]=0|(l=o+i),t[r+1]=0|u,t[r+2]=0|c;return t}})).random=Math.random,En=(n=L).MODE,n.Create({name:"PerlinNoiseFilter",mode:En.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n.Path,init:function(t,e,n,r,i,o,a,s){var l=this;l.mode=En.GRAY,l._baseX=t||1,l._baseY=e||1,l._seed=a||0,l._stitch=!!r,l._fractal=!1!==i,l._perlin=!!s,l.octaves(n||1,o)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){var n=this;for(n._octaves=t||1,n._offsets=e?e.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?En.COLOR:En.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var t=this;return{_baseX:t._baseX,_baseY:t._baseY,_octaves:t._octaves,_offsets:t._offsets,_seed:t._seed||0,_stitch:t._stitch,_fractal:t._fractal,_perlin:t._perlin}},unserialize:function(t){var e=this;return e._baseX=t._baseX,e._baseY=t._baseY,e._octaves=t._octaves,e._offsets=t._offsets,e._seed=t._seed||0,e._stitch=t._stitch,e._fractal=t._fractal,e._perlin=t._perlin,e},apply:function(t,e,n){var r=this;return r._seed&&(Xi.seed(r._seed),r._seed=0),Xi(t,e,n,r._stitch,En.COLOR!==r.mode,r._baseX,r._baseY,r._octaves,r._offsets,1,.5,r._perlin)}}),r=Math,Ln=r.floor,r.sin,r.cos,n.CONST.PI2,r=n.Array8U,Sn=new r([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),A=new r(Sn),Xi.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=Ln(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?Sn[n]^255&t:Sn[n]^t>>8&255,A[n]=A[n+256]=e},i=Math,Tn=i.min,Gn=i.floor,Mn=L.Util.GLSL,On=L.MODE,L.Create({name:"ChannelCopyFilter",srcChannel:(Fn=L.CHANNEL).R,dstChannel:Fn.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:L.Path,init:function(t,e,n,r,i){var o=this;o.srcChannel=t||Fn.R,o.dstChannel=e||Fn.R,o.centerX=n||0,o.centerY=r||0,o.color=i||0},dispose:function(){var t=this;return t.srcChannel=null,t.dstChannel=null,t.centerX=null,t.centerY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{srcChannel:t.srcChannel,dstChannel:t.dstChannel,centerX:t.centerX,centerY:t.centerY,color:t.color}},unserialize:function(t){var e=this;return e.srcChannel=t.srcChannel,e.dstChannel=t.dstChannel,e.centerX=t.centerX,e.centerY=t.centerY,e.color=t.color,e},getGLSL:function(){return o=(i=this).color||0,(a=i.input("source"))?{instance:i,shader:["precision highp float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D src;","uniform vec2 srcSize;","uniform vec2 center;","uniform vec4 color;","uniform int sC;","uniform int tC;","const int COLOR32="+On.COLOR32+";","const int COLOR8="+On.COLOR8+";","const int MASK32="+On.MASK32+";","const int MASK8="+On.MASK8+";","const int RED="+Fn.R+";","const int GREEN="+Fn.G+";","const int BLUE="+Fn.B+";","const int ALPHA="+Fn.A+";","uniform int mode;","void main(void) {","   vec4 tCol = vec4(0.0);","   vec2 p = pix - center + 0.5*srcSize;","   if (COLOR32 != mode) tCol = texture2D(img, pix);","   if (0.0 > p.x || min(1.0, srcSize.x) < p.x || 0.0 > p.y || min(1.0, srcSize.y) < p.y) {","       if (MASK32 == mode) {tCol *= color;}","       else if (COLOR32 == mode) {tCol = color;}","       else if (MASK8 == mode) {","           if (ALPHA == tC) tCol.a *= color.a;","           else if (BLUE == tC) tCol.b *= color.b;","           else if (GREEN == tC) tCol.g *= color.g;","           else tCol.r *= color.r;","       }","       else if (COLOR8 == mode) {","           if (ALPHA == tC) tCol.a = color.a;","           else if (BLUE == tC) tCol.b = color.b;","           else if (GREEN == tC) tCol.g = color.g;","           else tCol.r = color.r;","       }","   } else {","       vec4 sCol = texture2D(src, p);","       if (ALPHA == sC) {","           if (ALPHA == tC) tCol.a = sCol.a;","           else if (BLUE == tC) tCol.b = sCol.a;","           else if (GREEN == tC) tCol.g = sCol.a;","           else tCol.r = sCol.a;","       } else if (BLUE == sC) {","           if (ALPHA == tC) tCol.a = sCol.b;","           else if (BLUE == tC) tCol.b = sCol.b;","           else if (GREEN == tC) tCol.g = sCol.b;","           else tCol.r = sCol.b;","       } else if (GREEN == sC) {","           if (ALPHA == tC) tCol.a = sCol.g;","           else if (BLUE == tC) tCol.b = sCol.g;","           else if (GREEN == tC) tCol.g = sCol.g;","           else tCol.r = sCol.g;","       } else {","           if (ALPHA == tC) tCol.a = sCol.r;","           else if (BLUE == tC) tCol.b = sCol.r;","           else if (GREEN == tC) tCol.g = sCol.r;","           else tCol.r = sCol.r;","       }","   }","   gl_FragColor = tCol;","}"].join("\n"),textures:function(t,e,n){Mn.uploadTexture(t,a[0],a[1],a[2],1)},vars:function(t,e,n,r){t.uniform1i(r.uniform.src,1),t.uniform2f(r.uniform.srcSize,a[1]/e,a[2]/n),t.uniform2f(r.uniform.center,i.centerX,i.centerY),t.uniform1i(r.uniform.sC,i.srcChannel),t.uniform1i(r.uniform.tC,i.dstChannel),On.COLOR8===i.mode||On.MASK8===i.mode?(o=(255&o)/255,t.uniform4f(r.uniform.color,o,o,o,o)):t.uniform4f(r.uniform.color,(o>>>16&255)/255,(o>>>8&255)/255,(255&o)/255,(o>>>24&255)/255)}}:{instance:i,shader:Mn.DEFAULT};var i,o,a},apply:function(t,e,n){var r=this,i=r.input("source");if(i){var o,a,s,l,u,c,f,h,m,p=i[0],d=i[1],i=i[2],g=t.length,_=(p.length,r.srcChannel),v=r.dstChannel,C=r.centerX||0,y=r.centerY||0,w=d>>>1,A=i>>>1,R=Tn(e,d),b=Tn(n,i),x=r.color||0,I=r.mode,E=On.COLOR32,L=On.COLOR8,S=On.COLORMASK32,T=On.COLORMASK8;for(E===I||S===I?(m=x>>>24&255,c=x>>>16&255,f=x>>>8&255,h=255&x):L!==I&&T!==I||(x&=255),C=Gn(C*(e-1))-w,y=Gn(y*(n-1))-A,o=s=a=0;o<g;o+=4,++a)e<=a&&(a=0,++s),u=s-y,(l=a-C)<0||R<=l||u<0||b<=u?E===I?(t[o]=c,t[o+1]=f,t[o+2]=h,t[o+3]=m):S===I?(t[o]=c&t[o],t[o+1]=f&t[o+1],t[o+2]=h&t[o+2],t[o+3]=m&t[o+3]):L===I?t[o+v]=x:T===I&&(t[o+v]=x&t[o+_]):t[o+v]=p[(l+u*d<<2)+_]}return t}}),Dn=L._notSupportClamp,Nn=L.Array32F,Bn=L.MODE,Hn=Math.min,Un=Math.max,L.Create({name:"HistogramEqualizeFilter",path:L.Path,mode:Bn.INTENSITY,init:function(t){this.mode=t||Bn.INTENSITY},_apply_rgb:function(t,e,n){for(var r,i,o,a,s,l,u,c,f,h,m,p,d=0,g=0,_=0,v=255,C=255,y=255,w=t.length,A=w>>>2,R=new Nn(256),b=new Nn(256),x=new Nn(256),I=0;I<w;I+=4)r=t[I],i=t[I+1],o=t[I+2],R[r]++,b[i]++,x[o]++,d=Un(r,d),g=Un(i,g),_=Un(o,_),v=Hn(r,v),C=Hn(i,C),y=Hn(o,y);for(I=u=c=f=0;I<256;I+=32)u+=R[I],R[I]=u,u+=R[I+1],R[I+1]=u,u+=R[I+2],R[I+2]=u,u+=R[I+3],R[I+3]=u,u+=R[I+4],R[I+4]=u,u+=R[I+5],R[I+5]=u,u+=R[I+6],R[I+6]=u,u+=R[I+7],R[I+7]=u,u+=R[I+8],R[I+8]=u,u+=R[I+9],R[I+9]=u,u+=R[I+10],R[I+10]=u,u+=R[I+11],R[I+11]=u,u+=R[I+12],R[I+12]=u,u+=R[I+13],R[I+13]=u,u+=R[I+14],R[I+14]=u,u+=R[I+15],R[I+15]=u,u+=R[I+16],R[I+16]=u,u+=R[I+17],R[I+17]=u,u+=R[I+18],R[I+18]=u,u+=R[I+19],R[I+19]=u,u+=R[I+20],R[I+20]=u,u+=R[I+21],R[I+21]=u,u+=R[I+22],R[I+22]=u,u+=R[I+23],R[I+23]=u,u+=R[I+24],R[I+24]=u,u+=R[I+25],R[I+25]=u,u+=R[I+26],R[I+26]=u,u+=R[I+27],R[I+27]=u,u+=R[I+28],R[I+28]=u,u+=R[I+29],R[I+29]=u,u+=R[I+30],R[I+30]=u,u+=R[I+31],R[I+31]=u,c+=b[I],b[I]=c,c+=b[I+1],b[I+1]=c,c+=b[I+2],b[I+2]=c,c+=b[I+3],b[I+3]=c,c+=b[I+4],b[I+4]=c,c+=b[I+5],b[I+5]=c,c+=b[I+6],b[I+6]=c,c+=b[I+7],b[I+7]=c,c+=b[I+8],b[I+8]=c,c+=b[I+9],b[I+9]=c,c+=b[I+10],b[I+10]=c,c+=b[I+11],b[I+11]=c,c+=b[I+12],b[I+12]=c,c+=b[I+13],b[I+13]=c,c+=b[I+14],b[I+14]=c,c+=b[I+15],b[I+15]=c,c+=b[I+16],b[I+16]=c,c+=b[I+17],b[I+17]=c,c+=b[I+18],b[I+18]=c,c+=b[I+19],b[I+19]=c,c+=b[I+20],b[I+20]=c,c+=b[I+21],b[I+21]=c,c+=b[I+22],b[I+22]=c,c+=b[I+23],b[I+23]=c,c+=b[I+24],b[I+24]=c,c+=b[I+25],b[I+25]=c,c+=b[I+26],b[I+26]=c,c+=b[I+27],b[I+27]=c,c+=b[I+28],b[I+28]=c,c+=b[I+29],b[I+29]=c,c+=b[I+30],b[I+30]=c,c+=b[I+31],b[I+31]=c,f+=x[I],x[I]=f,f+=x[I+1],x[I+1]=f,f+=x[I+2],x[I+2]=f,f+=x[I+3],x[I+3]=f,f+=x[I+4],x[I+4]=f,f+=x[I+5],x[I+5]=f,f+=x[I+6],x[I+6]=f,f+=x[I+7],x[I+7]=f,f+=x[I+8],x[I+8]=f,f+=x[I+9],x[I+9]=f,f+=x[I+10],x[I+10]=f,f+=x[I+11],x[I+11]=f,f+=x[I+12],x[I+12]=f,f+=x[I+13],x[I+13]=f,f+=x[I+14],x[I+14]=f,f+=x[I+15],x[I+15]=f,f+=x[I+16],x[I+16]=f,f+=x[I+17],x[I+17]=f,f+=x[I+18],x[I+18]=f,f+=x[I+19],x[I+19]=f,f+=x[I+20],x[I+20]=f,f+=x[I+21],x[I+21]=f,f+=x[I+22],x[I+22]=f,f+=x[I+23],x[I+23]=f,f+=x[I+24],x[I+24]=f,f+=x[I+25],x[I+25]=f,f+=x[I+26],x[I+26]=f,f+=x[I+27],x[I+27]=f,f+=x[I+28],x[I+28]=f,f+=x[I+29],x[I+29]=f,f+=x[I+30],x[I+30]=f,f+=x[I+31],x[I+31]=f;if(a=(d-v)/A,s=(g-C)/A,l=(_-y)/A,Dn)for(I=0;I<w;I+=4)r=t[I],i=t[I+1],o=t[I+2],h=R[r]*a+v,m=(m=b[i]*s+C)<0?0:255<m?255:m,p=(p=x[o]*l+y)<0?0:255<p?255:p,t[I]=~~(h=h<0?0:255<h?255:h),t[I+1]=~~m,t[I+2]=~~p;else for(I=0;I<w;I+=4)r=t[I],i=t[I+1],o=t[I+2],h=R[r]*a+v,m=b[i]*s+C,p=x[o]*l+y,t[I]=~~h,t[I+1]=~~m,t[I+2]=~~p;return t},apply:function(t,e,n){if(Bn.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,o,a,s,l,u,c,f,h=0,m=255,p=t.length,e=p>>>2,n=Bn.GRAY===this.mode,d=new Nn(256);if(n)for(f=0;f<p;f+=4)d[r=t[f]]++,h=Un(r,h),m=Hn(r,m);else for(f=0;f<p;f+=4)a=(a=~~(0+.299*(r=t[f])+.587*(i=t[f+1])+.114*(o=t[f+2])))<0?0:255<a?255:a,s=(s=~~(128-.168736*r-.331264*i+.5*o))<0?0:255<s?255:s,t[f]=l=(l=~~(128+.5*r-.418688*i-.081312*o))<0?0:255<l?255:l,t[f+1]=a,t[f+2]=s,d[a]++,h=Un(a,h),m=Hn(a,m);for(f=c=0;f<256;f+=32)c+=d[f],d[f]=c,c+=d[f+1],d[f+1]=c,c+=d[f+2],d[f+2]=c,c+=d[f+3],d[f+3]=c,c+=d[f+4],d[f+4]=c,c+=d[f+5],d[f+5]=c,c+=d[f+6],d[f+6]=c,c+=d[f+7],d[f+7]=c,c+=d[f+8],d[f+8]=c,c+=d[f+9],d[f+9]=c,c+=d[f+10],d[f+10]=c,c+=d[f+11],d[f+11]=c,c+=d[f+12],d[f+12]=c,c+=d[f+13],d[f+13]=c,c+=d[f+14],d[f+14]=c,c+=d[f+15],d[f+15]=c,c+=d[f+16],d[f+16]=c,c+=d[f+17],d[f+17]=c,c+=d[f+18],d[f+18]=c,c+=d[f+19],d[f+19]=c,c+=d[f+20],d[f+20]=c,c+=d[f+21],d[f+21]=c,c+=d[f+22],d[f+22]=c,c+=d[f+23],d[f+23]=c,c+=d[f+24],d[f+24]=c,c+=d[f+25],d[f+25]=c,c+=d[f+26],d[f+26]=c,c+=d[f+27],d[f+27]=c,c+=d[f+28],d[f+28]=c,c+=d[f+29],d[f+29]=c,c+=d[f+30],d[f+30]=c,c+=d[f+31],d[f+31]=c;if(u=(h-m)/e,Dn)if(n)for(f=0;f<p;f+=4)r=~~(d[t[f]]*u+m),t[f]=r=r<0?0:255<r?255:r,t[f+1]=r,t[f+2]=r;else for(f=0;f<p;f+=4)i=(i=~~((a=d[t[f+1]]*u+m)-.34414*((s=t[f+2])-128)-.71414*((l=t[f])-128)))<0?0:255<i?255:i,o=(o=~~(a+1.772*(s-128)))<0?0:255<o?255:o,t[f]=r=(r=~~(a+1.402*(l-128)))<0?0:255<r?255:r,t[f+1]=i,t[f+2]=o;else if(n)for(f=0;f<p;f+=4)r=~~(d[t[f]]*u+m),t[f]=r,t[f+1]=r,t[f+2]=r;else for(f=0;f<p;f+=4)i=~~((a=d[t[f+1]]*u+m)-.34414*((s=t[f+2])-128)-.71414*((l=t[f])-128)),o=~~(a+1.772*(s-128)),t[f]=r=~~(a+1.402*(l-128)),t[f+1]=i,t[f+2]=o;return t}}),Yn=L,R=Math,Pn=R.sqrt,O=R.min,Xn=R.max,kn=Pn(3),$n=Yn.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:Yn.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},apply:function(t,e,n){var r,i=this.pattern;return this.scale<=1||!i||!$n[i]?t:(100<this.scale&&(this.scale=100),r=new Yn.ImArray(t.length),$n[i](this.scale,r,t,e,n),r)}}).PATTERN={rectangular:function(t,e,n,r,i){for(var o,a,s,l,u,c,f,h,m,p,d,g,_,v,C=n.length,y=C>>>2,w=r-1,A=y-r,R=(o=Pn(y)*t*.01|0)*r,b=(a=.5*o|0)*r,x=l=u=c=f=h=0;x<C;x+=4)p=u-h,d=O(w,(m=l-c)+o),g=O(A,p+R),_=O(w,m+a),v=O(A,p+b),_=.125*(n[s=m+p<<2]+n[m=m+g<<2]+n[p=d+p<<2]+n[d=d+g<<2]+4*n[g=_+v<<2]),v=.125*(n[1+s]+n[1+m]+n[1+p]+n[1+d]+4*n[1+g]),s=.125*(n[2+s]+n[2+m]+n[2+p]+n[2+d]+4*n[2+g]),e[x]=0|_,e[x+1]=0|v,e[x+2]=0|s,e[x+3]=n[x+3],++c,r<=++l&&(l=c=0,h+=r,u+=r,o<=++f)&&(h=f=0),o<=c&&(c=0)},triangular:function(t,e,n,r,i){for(var o,a,s,l,u,c,f,h,m,p,d=n.length,g=d>>>2,_=r-1,v=g-r,C=Pn(g)*t*.0125|0,y=.333*C|0,w=.666*C|0,A=C*r,R=(.5*C|0)*r,b=s=l=u=c=0,x=0;x<d;x+=4)h=s-c,m=O(_,(f=b-l)+C),p=O(v,h+A),h=.2*(n[p=C<l+u?(o=O(_,f+w)+O(v,h+R)<<2,m+p<<2):(o=O(_,f+y)+O(v,h+R)<<2,f+p<<2)]+n[f=f+h<<2]+n[m=m+h<<2]+2*n[o]),a=.2*(n[p+1]+n[1+f]+n[1+m]+2*n[o+1]),p=.2*(n[p+2]+n[2+f]+n[2+m]+2*n[o+2]),e[x]=0|h,e[x+1]=0|a,e[x+2]=0|p,e[x+3]=n[x+3],++l,r<=++b&&(b=l=0,c+=r,s+=r,C<=++u)&&(c=u=0),C<=l&&(l=0)},rhomboidal:function(t,e,n,r,i){for(var o,a,s,l,u,c,f,h,m,p,d,g,_=n.length,v=_>>>2,C=r-1,y=v-r,w=Pn(v)*t*.007|0,A=2*w,R=w*r,b=A*r,x=s=l=u=c=0,I=0,E=0;E<_;E+=4)h=I?A<l+u?(f=O(C,x-l+w),s-c):w<l+w-u?(f=x-l,Xn(0,s-c-R)):(f=Xn(0,x-l-w),s-c):A<l+w-u?(f=O(C,x-l+w),Xn(0,s-c-R)):w<l+u?(f=x-l,s-c):(f=Xn(0,x-l-w),Xn(0,s-c-R)),m=O(C,f+A),p=O(y,h+b),d=O(C,f+w),g=O(y,h+R),g=.125*(n[h=d+h<<2]+n[o=f+g<<2]+n[m=m+g<<2]+n[p=d+p<<2]+4*n[d=d+g<<2]),a=.125*(n[1+h]+n[1+o]+n[1+m]+n[1+p]+4*n[1+d]),h=.125*(n[2+h]+n[2+o]+n[2+m]+n[2+p]+4*n[2+d]),e[E]=0|g,e[E+1]=0|a,e[E+2]=0|h,e[E+3]=n[E+3],++l,r<=++x&&(x=l=0,c+=r,s+=r,w<=++u)&&(c=u=0,I=1-I),A<=l&&(l=0)},hexagonal:function(t,e,n,r,i){for(var o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w=n.length,A=w>>>2,R=r-1,b=A-r,x=kn*t*Pn(A)*.012|0,I=.5*x|0,E=.25*x|0,L=x-E,S=.25*x|0,T=S*r,G=s=l=u=c=0,M=y=1,F=0;F<w;F+=4)h=y?2===M?(f=Xn(0,G-l-E),s-c):1===M?I<kn*l+S-u?(f=O(R,G-l+E),s-c):(f=Xn(0,G-l-I),O(b,s-c+T)):kn*l+u<I?(f=Xn(0,G-l-L),s-c):(f=G-l,O(b,s-c+T)):2===M?(f=Xn(0,G-l-E),O(b,s-c+T)):1===M?I<kn*l+u?(f=O(R,G-l+E),O(b,s-c+T)):(f=Xn(0,G-l-I),s-c):kn*l+S-u<I?(f=Xn(0,G-l-L),O(b,s-c+T)):(f=G-l,s-c),m=O(R,f+E),p=Xn(0,h-T),d=O(R,f+I),g=h,_=O(R,f+x),v=O(b,h+T),C=O(R,f+L),v=.125*(n[o=f+h<<2]+n[a=m+p<<2]+n[p=C+p<<2]+n[_=_+h<<2]+n[h=C+v<<2]+n[C=m+v<<2]+2*n[m=d+g<<2]),d=.125*(n[1+o]+n[1+a]+n[1+p]+n[1+_]+n[1+h]+n[1+C]+2*n[1+m]),g=.125*(n[2+o]+n[2+a]+n[2+p]+n[2+_]+n[2+h]+n[2+C]+2*n[2+m]),e[F]=0|v,e[F+1]=0|d,e[F+2]=0|g,e[F+3]=n[F+3],++l,r<=++G&&(c+=r,s+=r,M=G=l=0,S<=++u)&&(c=u=0,y=1-y),I<=l&&(l=0,M=(M+1)%3)}},zn=L.MODE,jn=L.Array32F,Wn=L.Color.clamp,qn=L.Color.intensity,L.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:zn.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=Wn(null==e?.4:e,0,1),this.mode=n||zn.GRAY},path:L.Path,threshold:function(t){return this.thresh=Wn(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var r,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y=t.length,w=new jn(3*(y>>>2)),A=this.size,R=1/(A*A),b=255*this.thresh,x=zn.RGB===this.mode,I=A*e,E=0,L=0,S=0;E<n;){if(l=u=c=0,x){for(s=a=o=0;a<A;)l+=t[r=S+L+o+s<<2]+w[i=3*(S+L+o+s)],u+=t[r+1]+w[i+1],c+=t[r+2]+w[i+2],++o>=A&&(o=0,++a,s+=e);m=b<qn(l*=R,u*=R,c*=R)?(f=0|l,h=0|u,0|c):h=f=0}else{for(s=a=o=0;a<A;)l+=t[r=S+L+o+s<<2]+w[i=3*(S+L+o+s)],++o>=A&&(o=0,++a,s+=e);m=h=f=b<l*R?255:0}if(p=t[r=S+L<<2]-f,d=t[r+1]-h,g=t[r+2]-m,S+A<e)for(_=7/16*p,v=7/16*d,C=7/16*g,o=A,s=a=0;a<A;)w[i=3*(S+L+o+s)]+=_,w[i+1]+=v,w[i+2]+=C,0<=++o&&(o=A,++a,s+=e);if(E+A<n&&A<S)for(_=3/16*p,v=3/16*d,C=3/16*g,o=-A,a=A,s=0;a<0;)w[i=3*(S+L+o+s)]+=_,w[i+1]+=v,w[i+2]+=C,0<=++o&&(o=-A,++a,s+=e);if(E+A<n)for(_=5/16*p,v=5/16*d,C=5/16*g,a=A,s=o=0;a<0;)w[i=3*(S+L+o+s)]+=_,w[i+1]+=v,w[i+2]+=C,++o>=A&&(o=0,++a,s+=e);if(E+A<n&&S+A<e)for(_=1/16*p,v=1/16*d,C=1/16*g,a=o=A,s=0;a<0;)w[i=3*(S+L+o+s)]+=_,w[i+1]+=v,w[i+2]+=C,0<=++o&&(o=A,++a,s+=e);for(s=a=o=0;a<A;)t[r=S+L+o+s<<2]=f,t[r+1]=h,t[r+2]=m,++o>=A&&(o=0,++a,s+=e);e<=(S+=A)&&(S=0,E+=A,L+=I)}return t}}),Kn=(Vn=L).MODE,Qn=new Vn.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),Zn=Math,Vn.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:Vn.Path,init:function(t,e,n,r,i,o,a){this.offsetX=t||0,this.offsetY=e||0,this.color=n||0,this.opacity=null==r?1:+r,this.quality=0|(i||1),this.pad=null==o||!!o,this.onlyShadow=!!a},dispose:function(){return this.offsetX=null,this.offsetY=null,this.color=null,this.opacity=null,this.quality=null,this.pad=null,this.onlyShadow=null,this.$super("dispose"),this},serialize:function(){return{offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,opacity:this.opacity,quality:this.quality,pad:this.pad,onlyShadow:this.onlyShadow}},unserialize:function(t){return this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.color=t.color,this.opacity=t.opacity,this.quality=t.quality,this.pad=t.pad,this.onlyShadow=t.onlyShadow,this},apply:function(t,e,n){var r=this;if(r.hasMeta=!1,r._isOn){var i,o,a,s,l,u,c,f=Zn.max,h=r.color||0,m=r.opacity,p=r.quality,d=r.pad,g=r.onlyShadow,_=r.offsetX||0,v=r.offsetY||0,C=t.length,y=C>>>2,w=C,A=e;if(0!==(m=1<(m=m<0?0:m)?1:m)){i=h>>>16&255,o=h>>>8&255,a=255&h,3<(p=p<=0?1:p)&&(p=3);for(var R=new Vn.ImArray(w),b=0,x=0,I=0,E=0,L=0;I<w;I+=4,++E)A<=E&&(E=0,++L),0<(c=t[I+3])&&(R[I]=i,R[I+1]=o,R[I+2]=a,R[I+3]=m*c|0,b=f(b,E),x=f(x,L));if(R=Vn.Util.Filter.integral_convolution(i===o&&o===a?Kn.GRAY:Kn.RGB,R,e,n,2,Qn,null,3,3,1,0,p),b+=_,x+=v,d&&(e<=b||b<0||n<=x||x<0)&&(t=Vn.Util.Image.pad(t,e,n,C=e<=b?b-e:0,h=n<=x?x-n:0,p=b<0?-b:0,d=x<0?-x:0),y=(e+=p+C)*(n+=d+h),r.hasMeta=!0,r.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}),v*=e,g)for(u=L=E=0;u<w;u+=4,++E)A<=E&&(E=0,L+=e),l=L+v,(s=E+_)<0||e<=s||l<0||y<=l||(t[I=s+l<<2]=R[u],t[I+1]=R[u+1],t[I+2]=R[u+2],t[I+3]=R[u+3]);else for(u=L=E=0;u<w;u+=4,++E)A<=E&&(E=0,L+=e),l=L+v,(s=E+_)<0||e<=s||l<0||y<=l||(c=t[(I=s+l<<2)+3],m=R[u+3],255!==c&&0!==m&&(i=t[I]+(R[u]-t[I])*(m/=255),o=t[I+1]+(R[u+1]-t[I+1])*m,a=t[I+2]+(R[u+2]-t[I+2])*m,t[I]=0|i,t[I+1]=0|o,t[I+2]=0|a))}}return t}}),(Jn=Math).sqrt,Jn.exp,tr=Jn.log,er=Jn.abs,nr=Jn.floor,rr=L._notSupportClamp,ir=L.Array32F,L.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,r){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==r?10:r},path:L.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var r,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R=t.length,b=this.centerX||0,x=this.centerY||0,I=this.radius,E=this.amount;if(!(E<=0)){for(0,A=(r=R>>>2)-e,b=nr(b*(w=e-1)),x=nr(x*(n-1)),l=(e<<1)+e,i=new ir((r<<1)+r),f=o=a=s=f=c=u=0;f<e;++f,u+=4,c+=3)o+=t[u],a+=t[u+1],s+=t[u+2],i[c]=o,i[c+1]=a,i[c+2]=s;for(o=a=s=f=c=0,u=u=l+e;u<R;u+=4,c+=3,++f)e<=f&&(o=a=s=f=0),o+=t[u],a+=t[u+1],s+=t[u+2],i[c+l]=i[c]+o,i[c+l+1]=i[c+1]+a,i[c+l+2]=i[c+2]+s;for(u=m=h=f=0;u<R;u+=4,++f)e<=f&&(f=0,++h,m+=e),y=er(f-b),v=er(h-x),d=Jn.max(y,v),y=Jn.min(y,v),0<(y=I<(v=d?d*(1+.43*y/d*y/d):0)?0|tr((v-I)*E):v/I+.5|0)&&(d=f+y,g=m+(v=y*e),(p=f-y)<0?p=0:w<d&&(d=w),(v=m-v)<0?v=0:A<g&&(g=A),v=(y=.25/(y*y))*(i[_=((_=d+g)<<1)+_]-i[d=((d=d+v)<<1)+d]-i[g=((g=p+g)<<1)+g]+i[p=((p=p+v)<<1)+p]),C=y*(i[_+1]-i[d+1]-i[g+1]+i[p+1]),y=y*(i[_+2]-i[d+2]-i[g+2]+i[p+2]),rr&&(v=v<0?0:255<v?255:v,C=C<0?0:255<C?255:C,y=y<0?0:255<y?255:y),t[u]=0|v,t[u+1]=0|C,t[u+2]=0|y)}}return t}}),or=L,ar=Math,or.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:or.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},apply:function(t,e,n){var r,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v=this.type,C=or.ImArray,y=or.Array8U,w=or.Util.Image.interpolate,A=ar.sqrt;for(e!==n?t=w(t,e,n,p=n<e?e:n,p):p=e,d=ar.round(p/2),g=p*p,r=new C(_=t.length),i=new C(_),o=new y(g),h=f=c=0;h<_;h+=4,++c)p<=c&&(c=0,++f),r[m=(c+d)%p+(f+d)%p*p<<2]=t[h],r[m+1]=t[h+1],r[m+2]=t[h+2],r[m+3]=t[h+3];if(0===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*A((c-d)*(c-d)+(f-d)*(f-d))/d,o[c+f*p]=u=u<1?1:255<u?255:u,o[c+(p-1-f)*p]=u,o[p-1-c+f*p]=u,o[p-1-c+(p-1-f)*p]=u;else if(1===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),o[c+f*p]=u=(u=255-255*(d+f<d+c?(f-d)/d:(c-p/2)/d))<1?1:255<u?255:u,o[c+(p-1-f)*p]=u,o[p-1-c+f*p]=u,o[p-1-c+(p-1-f)*p]=u;else for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*(d+f<d+c?A((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p):A((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p)),o[c+f*p]=u=u<1?1:255<u?255:u,o[c+(p-1-f)*p]=u,o[p-1-c+f*p]=u,o[p-1-c+(p-1-f)*p]=u;for(c=f=0;f<p;++c)p<=c&&(c=0,++f),a=o[m=c+f*p],a/=l=a+(s=o[(c+d)%p+(f+d)%p*p]),i[m<<=2]=~~(a*t[m]+(s/=l)*r[m]),i[m+1]=~~(a*t[m+1]+s*r[m+1]),i[m+2]=~~(a*t[m+2]+s*r[m+2]),i[m+3]=t[m+3];return i=e!==n?w(i,p,p,e,n):i}}),lr=(sr=L).MODE,b=Math,sr.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:lr.COLOR,path:sr.Path,init:function(t,e,n,r,i){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==r?1e-6:+r,this.border=null!=i?i||0:null,this.mode=lr.COLOR},serialize:function(){return{color:this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var r,i,o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y,w,A,R,b,x=this.mode||lr.COLOR,I=this.color||0,E=this.border,L=null!=E,S=this.x||0,T=this.y||0,G=sr.Color.RGB2HSV,M=sr.Color.HSV2RGB;if(!(S<0||e<=S||T<0||n<=T)){if(d=t[c=(S<<=2)+(T=T*e<<2)],g=t[c+1],_=t[c+2],y=0,w=1,h=I>>>16&255,m=I>>>8&255,p=255&I,L){if(L=E>>>8&255,v=255&E,d===(E=E>>>16&255)&&g===L&&_===v)return t;d=E,g=L,_=v,y=1,w=0}else if(lr.COLOR===x&&d===h&&g===m&&_===p)return t;if(R=(E=$i(t,e,0,2,ki(d,g,_,y,w,255*(1<=this.tolerance?.999:this.tolerance)),0,S,T)).mask,lr.MASK===x||lr.COLORMASK===x)for(b=lr.MASK===x,c=i=r=0,f=t.length;c<f;c+=4,++r)e<=r&&(r=0,i+=e),R[(u=r+i)>>>5]&1<<(31&u)?b&&(t[c]=h,t[c+1]=m,t[c+2]=p):(t[c]=0,t[c+1]=0,t[c+2]=0);else if(lr.HUE===x)for(o=(A=E.box)[0]>>>2,a=A[1]>>>2,s=A[2]>>2,l=A[3]>>>2,C=new fr(3),r=o,i=a;i<=l;)R[(u=r+i)>>>5]&1<<(31&u)&&(C[0]=t[c=u<<2],C[1]=t[c+1],C[2]=t[c+2],G(C,0,1),C[0]=I,M(C,0,1),t[c]=0|C[0],t[c+1]=0|C[1],t[c+2]=0|C[2]),++r>s&&(r=o,i+=e);else for(o=(A=E.box)[0]>>>2,a=A[1]>>>2,s=A[2]>>2,l=A[3]>>>2,r=o,i=a;i<=l;)R[(u=r+i)>>>5]&1<<(31&u)&&(t[c=u<<2]=h,t[c+1]=m,t[c+2]=p),++r>s&&(r=o,i+=e)}return t}}),sr.FloodFillFilter=sr.ColorFillFilter,sr.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:lr.TILE,hasInputs:!0,path:sr.Path,init:function(t,e,n,r,i,o,a){this.x=t||0,this.y=e||0,this.offsetX=r||0,this.offsetY=i||0,n&&this.setInput("pattern",n),this.tolerance=null==o?1e-6:+o,this.border=null!=a?a||0:null,this.mode=lr.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var r=this.x||0,i=this.y||0;if(!(r<0||e<=r||i<0||n<=i)&&(E=this.input("pattern"))){var o,a,s,l,u,c,f,h,m,p,d,g,_,v,C,y=this.mode||lr.TILE,w=this.border,A=E[0],R=E[1],b=E[2],x=this.offsetX||0,I=this.offsetY||0,E=t[u=(r<<=2)+(i=i*e<<2)],L=t[u+1],S=t[u+2],T=0,G=1;if(null!=w){if(_=w>>>8&255,o=255&w,E===(w=w>>>16&255)&&L===_&&S===o)return t;E=w,L=_,S=o,T=1,G=0}if(v=(w=$i(t,e,0,2,ki(E,L,S,T,G,255*(1<=this.tolerance?.999:this.tolerance)),0,r,i)).mask,f=(_=w.box)[0]>>>2,h=_[1]>>>2,m=_[2]>>>2,p=_[3]>>>2,lr.STRETCH===y)for(d=R/(m-f+1),g=b/(p-h+e),a=f,s=h;s<=p;)v[(l=a+s)>>>5]&1<<(31&l)&&(t[u=l<<2]=A[c=(d*(a-f)|0)+(g*(s-h)|0)*R<<2],t[u+1]=A[c+1],t[u+2]=A[c+2]),++a>m&&(a=f,s+=e);else{for(;x<0;)x+=R;for(;I<0;)I+=b;for(m=m-f+1,s=a=0,C=h;C<=p;)v[(l=a+f+C)>>>5]&1<<(31&l)&&(t[u=l<<2]=A[c=(a+x)%R+(s+I)%b*R<<2],t[u+1]=A[c+1],t[u+2]=A[c+2]),++a>=m&&(a=0,C+=e,++s)}}return t}}),ur=sr.Array32I,cr=sr.Array32U,fr=sr.Array32F,hr=sr.Array8U,mr=b.ceil,pr=b.min,dr=b.max,x=b.abs,_r=(gr=L).MODE,vr=gr.Array32F,Cr=Math,yr=Cr.min,wr=Cr.max,Ar=Cr.abs,Rr=Cr.cos,br=gr.CONST.toRad,gr.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:_r.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,r){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!r,this.mode=_r.COLOR},path:gr.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var r=t.length>>>2,i=this.mode||_r.COLOR,o=this.color,a=yr(.999,wr(0,this.tolerance||0)),r=new vr(r),s=(null!=o&&(_r.HUE===i?o=Rr(br*o):_r.COLOR===i&&(o=1e4*((d=(o>>>16&255)/255)+(c=(o>>>8&255)/255)+(h=(255&o)/255))/3+1e3*(d+c)/2+100*(c+h)/2+10*(d+h)/2+d)),a=function(t,e,n,r,i){var o,a,s=gr.MODE,l=gr.Color.hue,u=gr.Color.intensity,c=Cr.cos,f=gr.CONST.toRad,h=(t.length,n.length);if(0<e)if(s.HUE===i)for(a=o=0;a<h;o+=4,++a)n[a]=0===t[o+3]?1e4:c(f*l(t[o],t[o+1],t[o+2]));else if(s.INTENSITY===i)for(r*=255,a=o=0;a<h;o+=4,++a)n[a]=0===t[o+3]?1e4:u(t[o],t[o+1],t[o+2]);else if(s.GRAY===i)for(r*=255,a=o=0;a<h;o+=4,++a)n[a]=0===t[o+3]?1e4:t[o];else for(r=1e4*r+1e3*r+100*r+10*r+r,a=o=0;a<h;o+=4,++a)n[a]=0===t[o+3]?1e5:1e4*(t[o]+t[o+1]+t[o+2])/3/255+1e3*(t[o]+t[o+1])/2/255+100*(t[o+1]+t[o+2])/2/255+10*(t[o]+t[o+2])/2/255+t[o]/255;else if(s.HUE===i)for(a=o=0;a<h;++o,++a)n[a]=c(f*t[o]);else for(r*=255,a=o=0;a<h;++o,++a)n[a]=t[o];return r}(t,2,r,a,i),t),l=e,u=n,c=2,f=r,h=this.connectivity,m=a,p=o,d=this.invert;c|=0;var g,_,v,C,y,w,A,R,b,x,I=s.length,E=I>>>c,L=8===h,S=null,T=null!=p,G=2*m;for(A=new Array(E),S=T?new zi:null,A[0]=T&&Ar(m+f[0]-p)>G?S:new zi,v=1;v<l;++v)A[v]=T&&Ar(m+f[v]-p)>G?S:Ar(m+f[v]-f[v-1])<=G?A[v-1]:new zi;for(C=1,y=l;C<u;++C,y+=l)for(A[y]=T&&Ar(m+f[y]-p)>G?S:Ar(m+f[y]-f[y-l])<=G?A[y-l]:new zi,v=1;v<l;++v)T&&Ar(m+f[y+v]-p)>G?A[y+v]=S:(_=S!==A[y+v-1]&&Ar(m+f[y+v]-f[y+v-1])<=G?A[y+v-1]:null,L&&S!==A[y-l+v-1]&&Ar(m+f[y+v]-f[y-l+v-1])<=G&&(null!=_?Wi(_,A[y-l+v-1]):_=A[y-l+v-1]),S!==A[y-l+v]&&Ar(m+f[y+v]-f[y-l+v])<=G&&(null!=_?Wi(_,A[y-l+v]):_=A[y-l+v]),A[y+v]=null!=_?_:new zi,L&&S!==A[y+v-1]&&S!==A[y-l+v]&&Ar(m+f[y+v-1]-f[y-l+v])<=G&&Wi(A[y+v-1],A[y-l+v]));for(x=d?(b=-255,255):(b=255,0),w=null!=S?(S.id=0,1):0,v=0;v<E;++v)A[v]=ji(A[v]),A[v].id<0&&(A[v].id=w++);if(c)for(g=v=0;g<I;g+=4,++v)R=x+b*A[v].id/w|0,s[g]=s[g+1]=s[g+2]=R;else for(v=0;v<I;++v)R=x+b*A[v].id/w|0,s[v]=R;return s}}),zi.prototype={constructor:zi,id:0,root:null},xr=L,Ir=Math.round,xr.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,lowpass:!0,path:xr.Path,init:function(t,e,n){this.low=arguments.length<1?2.5:+t,this.high=arguments.length<2?7.5:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},apply:function(t,e,n){return xr.Util.Filter.gradient(t,e,n,2,0,this.lowpass,0,Ir(100*this.low),Ir(100*this.high),100,1e3,1e5)}}),Er=L,I=Math,Lr=I.abs,yt=I.max,wt=I.min,I.floor,Sr=I.round,Tr=I.sqrt,Er.Util.Array.typed,Gr=Er.Util.Array.typed_obj,Mr=Array.prototype.push,Er.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,r,i,o,a){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==r?.5:+r,this.minNeighbors=null==i?1:+i,this.doCannyPruning=void 0===o||!!o,this.tolerance=null==a?.2:+a,this._haarchanged=!!this.haardata},path:Er.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh};return t._haarchanged&&(e.haardata=Gr(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=Gr(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e},metaData:function(t){return t&&Er.isWorker?Gr(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Gr(t,1):t,this},apply:function(t,e,n,r){var i,o,a,s,l,u,c,f,h,m,p,d,g=this;return g.haardata&&(i=t.length>>>2,d=g.selection||null,o=Er.Array32F,u=l=s=a=null,p=Er.Util.Filter,d=d?(m=d[4]?(h=e-1,n-1):h=1,c=wt(e-1,yt(0,d[0]*h)),f=wt(n-1,yt(0,d[1]*m)),h=wt(e-1,yt(0,d[2]*h)),wt(n-1,yt(0,d[3]*m))):(f=c=0,h=e-1,n-1),r&&r.haarfilter_SAT?(a=r.haarfilter_SAT,s=r.haarfilter_SAT2,l=r.haarfilter_RSAT):(p.sat(t,e,n,2,0,a=new o(i),s=new o(i),l=new o(i)),r&&(r.haarfilter_SAT=a,r.haarfilter_SAT2=s,r.haarfilter_RSAT=l)),g.doCannyPruning&&(r&&r.haarfilter_GSAT?u=r.haarfilter_GSAT:(u=p.gradient(t,e,n,2,0,1,1),r&&(r.haarfilter_GSAT=u))),(m=new Array(10)).count=0,p.haar_detect(m,e,n,c,f,h,d,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,a,l,s,u,g.cannyLow,g.cannyHigh),m.length>m.count&&(m.length=m.count),g.meta={objects:p.merge_features(m,g.minNeighbors,g.tolerance)}),t}}),Er.Util.Filter.haar_detect=function(t,e,N,B,H,U,Y,P,X,k,$,n,r,i,o,z,j){for(var W,q,a,s,l,u,V,K,Q,c,f,h,m,Z,J,p,d,g,_,tt,et,nt,rt,it,v,C,ot,y,at,st,lt,w,A,R,b,x,I,E,L,S,T,G,M,ut=null!=o,ct=U-B+1|0,ft=Y-H+1|0,ht=(U=e*N)-1,mt=P.stages,pt=mt.length,dt=P.size1,gt=P.size2,F=e-1,O=U-e,_t=0|B,vt=0|H,Ct=wt(e/dt,N/gt),D=X;D<=Ct;D*=k)for(W=(a=D*dt|0)*$|0,K=(s=D*gt|0)*e,Z=_t+ct-a,J=vt+ft-s,d=1/(a*s),V=(u=vt)*(Q=(q=s*$|0)*e);u<J;u+=q,V+=Q)for(l=_t;l<Z;l+=W)if(f=(c=l-1+V-e)+a,m=(h=c+K)+a,c=wt(ht,yt(0,c)),f=wt(ht,yt(0,f)),h=wt(ht,yt(0,h)),m=wt(ht,yt(0,m)),!ut||!((_=d*(o[m]-o[h]-o[f]+o[c]))<z||j<_)){for(_=d*(n[m]-n[h]-n[f]+n[c]),g=1<(g=d*(i[m]-i[h]-i[f]+i[c])-_*_)?Tr(g):g,tt=!1,p=0;p<pt;++p){for(nt=(et=mt[p]).thres,it=(rt=et.trees).length,v=M=0;v<it;++v)for(ot=rt[v].feats,C=0;;){if(st=(at=(y=ot[C]).rects).length,lt=y.thres,w=0,y.tilt)for(A=0;A<st;++A)b=l+D*(R=at[A])[0]|0,x=(u-1+D*R[1]|0)*e,I=l+D*(R[0]+R[2])|0,E=(u-1+D*(R[1]+R[2])|0)*e,L=l+D*(R[0]-R[3])|0,S=(u-1+D*(R[1]+R[3])|0)*e,T=l+D*(R[0]+R[2]-R[3])|0,G=(u-1+D*(R[1]+R[2]+R[3])|0)*e,b=wt(F,yt(0,b)),I=wt(F,yt(0,I)),L=wt(F,yt(0,L)),T=wt(F,yt(0,T)),x=wt(O,yt(0,x)),E=wt(O,yt(0,E)),S=wt(O,yt(0,S)),G=wt(O,yt(0,G)),w+=R[4]*(r[T+G]-r[L+S]-r[I+E]+r[b+x]);else for(A=0;A<st;++A)b=l-1+D*(R=at[A])[0]|0,I=l-1+D*(R[0]+R[2])|0,x=e*(u-1+D*R[1]|0),E=e*(u-1+D*(R[1]+R[3])|0),b=wt(F,yt(0,b)),I=wt(F,yt(0,I)),x=wt(O,yt(0,x)),E=wt(O,yt(0,E)),w+=R[4]*(n[I+E]-n[b+E]-n[I+x]+n[b+x]);if(w*d<lt*g){if(y.has_l){M+=y.l_val;break}C=y.l_node}else{if(y.has_r){M+=y.r_val;break}C=y.r_node}}if(!(tt=nt<M))break}tt&&(t.count===t.length&&Mr.apply(t,new Array(10)),t[t.count++]={x:l,y:u,width:a,height:s})}},Er.Util.Filter.merge_features=function(t,e,n){for(var r,i,o,a,s,l,u,c,f,h,m,p,d=t.length,g=new Array(d),_=[],v=0,C=!1,y=0;y<d;++y)g[y]=0;for(y=0;y<d;++y){for(C=!1,o=0;o<y;++o)u=t[o],c=t[y],f=(f=n)*(wt(u.width,c.width)+wt(u.height,c.height))*.5,Lr(u.x-c.x)<=f&&Lr(u.y-c.y)<=f&&Lr(u.x+u.width-c.x-c.width)<=f&&Lr(u.y+u.height-c.y-c.height)<=f&&(C=!0,g[y]=g[o]);C||(g[y]=v,++v)}for(r=new Array(v),i=new Array(v),y=0;y<v;++y)r[y]=0,i[y]={x:0,y:0,width:0,height:0};for(y=0;y<d;++y)++r[l=g[y]],h=i[l],m=t[y],h.x+=m.x,h.y+=m.y,h.width+=m.width,h.height+=m.height;for(y=0;y<v;++y)e<=(a=r[y])&&(l={x:(s=1/(a+a))*(2*i[y].x+a),y:s*(2*i[y].y+a),width:s*(2*i[y].width+a),height:s*(2*i[y].height+a)},_.push(l));for(d=_.length,y=0;y<d;++y)for(o=y+1;o<d;++o)!_[y].isInside&&qi(_[y],_[o],n)&&(_[y].isInside=!0),!_[o].isInside&&qi(_[o],_[y],n)&&(_[o].isInside=!0);for(y=d;0<=--y;)_[y].isInside?_.splice(y,1):((p=_[y]).x=Sr(p.x),p.y=Sr(p.y),p.width=Sr(p.width),p.height=Sr(p.height),p.area=p.width*p.height);return _.sort(Vi)},L});
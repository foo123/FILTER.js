/**
*
*   FILTER.js
*   @version: 1.0.0
*   @built on 2023-08-04 23:22:36
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function q(){"use strict";var n,N,F,D,B,J,tt,et,k,Y,U,$,P,S,nt,rt,it,Z,X,z,W,u,j,K,Q,at,ot,st,lt,ut,ct,ht,ft,dt,mt,c,pt,a,gt,_t,h,Ct,vt,It,bt,At,d,m,Rt,xt,St,Et,p,Lt,Mt,Tt,Gt,Ht,Ot,Nt,Ft,Dt,Bt,Yt,kt,Ut,$t,g,Pt,Xt,zt,Wt,_,jt,qt,Vt,Kt,Qt,Zt,l,Jt,o,C,te,ee,ne,re,ie,ae,v,oe,se,le,ue,ce,he,fe,de,me,pe,ge,_e,Ce,ve,ye,we,Ie,be,Ae,V,t,r,Re,xe,Se,Ee,Le,Me,Te,Ge,He,Oe,Ne,Fe,De,Be,Ye,ke,Ue,$e,Pe,Xe,ze,We,je,qe,Ve,y,Ke,Qe,Ze,e,Je,tn,en,nn,rn,an,on,sn,ln,un,i,cn,w,hn,fn,I,b,dn,mn,pn,gn,_n,Cn,vn,yn,wn,In,A,bn,O,An,Rn,xn,Sn,En,Ln,Mn,Tn,Gn,Hn,On,Nn,Fn,Dn,Bn,Yn,kn,Un,$n,Pn,Xn,R,zn,Wn,jn,qn,Vn,Kn,Qn,x,Zn,Jn,tr,er,nr,rr,ir,ar,or,sr,lr,ur,E,cr,yt,wt,hr,fr,dr,mr,L={VERSION:"1.0.0"};function pr(t,e,n){arguments.length<2&&(e=t,t=null),F.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var r,i,a,o=F.call(e,"constructor")?e.constructor:function(){};for(r in t?(o[N]=Object.create(t[N]),o[N].$super=(i=t,a={},function(t,e){var n=":"+t;return 1===a[n]?(i[N].$super||D).call(this,t,e):(a[n]=1,t=("constructor"===t?i:i[N][t]||D).apply(this,e||[]),a[n]=0,t)})):o[N].$super=D,o[N].constructor=o,e)F.call(e,r)&&"constructor"!==r&&(o[N][r]=e[r]);if(n)for(r in n)F.call(n,r)&&(o[r]=n[r]);return o}function M(t,e,n){return n<t?n:t<e?e:t}function gr(t,e,n,r,i){n=n||0,r=r||0;for(var a,o=i?i-r+1:e.length,s=31&o,l=0;l<s;++l)t[l+n]=e[r+l];for(a=s;a<o;a+=32)t[(l=a)+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],t[++l+n]=e[r+l],++l}function _r(t,e,n,r,F,i,D,B,Y,a,k,U){null==a&&(U=(a=1)*(k=510));for(var o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,$,P,A,R,X,x,S,z,E,W,L,j,M,T,q=n.length,V=q>>>i,K=r-1,Q=F-1,G=new et(V),H=1,O=1,N=r;O<Q&&!(K<=H&&(H=1,N+=r,Q<=++O));++H)_=(l=H+N)-1,C=l+1,I=(p=l-r)-1,v=1+p,w=(g=l+r)-1,y=g+1,u=t[l],c=e[l],h=Z(u),f=Z(c),T=it(h,f),M=rt(h,f),d=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[p]),Z(e[p])),M=rt(Z(t[p]),Z(e[p])),p=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[g]),Z(e[g])),M=rt(Z(t[g]),Z(e[g])),g=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[_]),Z(e[_])),M=rt(Z(t[_]),Z(e[_])),_=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[C]),Z(e[C])),M=rt(Z(t[C]),Z(e[C])),C=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[v]),Z(e[v])),M=rt(Z(t[v]),Z(e[v])),v=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[y]),Z(e[y])),M=rt(Z(t[y]),Z(e[y])),y=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[w]),Z(e[w])),M=rt(Z(t[w]),Z(e[w])),w=T?T*(1+.43*M/T*M/T):0,T=it(Z(t[I]),Z(e[I])),M=rt(Z(t[I]),Z(e[I])),I=T?T*(1+.43*M/T*M/T):0,M=u*c<=0?f<=h?(m=h*d)>=Z(c*v-(u+c)*C)&&m>Z(c*w-(u+c)*_):(m=f*d)>=Z(u*v-(c+u)*p)&&m>Z(u*w-(c+u)*g):f<=h?(m=h*d)>=Z(c*y+(u-c)*C)&&m>Z(c*I+(u-c)*_):(m=f*d)>=Z(u*y+(c-u)*g)&&m>Z(u*I+(c-u)*p),G[l]=M?k<=d?U:nt(a*d):0;if(D){for(s=H=0;H<r;++H)s+=G[H],G[H]=s;for(H=r,s=N=0;H<V;++H,++N)r<=N&&(s=N=0),s+=G[H],G[H]=G[H-r]+s;return G}if(i)for(H=0;H<q;H+=4)n[H]=n[H+1]=n[H+2]=0;else for(H=0;H<q;++H)n[H]=0;for(N=o=O=H=0;o<V;N=++o<<i,++H)if(r<=H&&(H=0,++O),!(0!==n[N]||G[o]<Y)){b=H,A=O,L=N;do{for(n[L]=i?n[L+1]=n[L+2]=255:255,P=b===K?b:b+1,X=A===Q?A:A+1,x=$=0===b?b:b-1,S=R=0===A?A:A-1,E=z=R*r,j=0;x<=P&&S<=X;){if(L=(W=x+E)<<i,(S!==R||x!==$)&&0===n[L]&&G[W]>=B){b=x,A=S,j=1;break}E+=r,X<++S&&(S=A,E=z,++x)}}while(j)}return n}function Cr(){}function vr(t,e,n){var r,i,a;return e/=100,e=(1-c.abs(2*(n/=100)-1))*e,r=c.floor((t=t/60)/2),r=e*(1-c.abs(t-2*r-1)),n=n-e/2,t=0<=t&&t<1?(i=e+n,a=r+n,0+n):1<=t&&t<2?(i=r+n,a=e+n,0+n):2<=t&&t<3?(i=0+n,a=e+n,r+n):3<=t&&t<4?(i=0+n,a=r+n,e+n):4<=t&&t<5?(i=r+n,a=0+n,e+n):(i=e+n,a=0+n,r+n),[h(c.round(255*i),0,255),h(c.round(255*a),0,255),h(c.round(255*t),0,255)]}function yr(t,e,n){var e=(n/=100)*(1-e/200),r=c.min(e,1-e);return vr(t,0===r?0:100*(n-e)/r,100*e)}function wr(t,e,n){n=1-n/100;return yr(t,100-e/n,100*n)}function Ir(t,e,n,r,i){var a,o,s,l,u;return r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=c.max(t,e,n),l=s=c.min(t,e,n),u=1-r,n=0==(o=r-s)?0:a===t?60*(0+(e-n)/o):a===e?60*(2+(n-t)/o):60*(4+(t-e)/o),e=0==(t=(r+s)/2)||1==t?0:(a-t)/c.min(t,1-t),r=0===a?0:o/a,"hwb"===i?[h(c.round(n),0,360),h(100*l,0,100),h(100*u,0,100)]:"hsv"===i?[h(c.round(n),0,360),h(100*r,0,100),h(100*a,0,100)]:[h(c.round(n),0,360),h(100*e,0,100),h(100*t,0,100)]}function br(t,e,n,r){return Ir(t,e,n,r,"hsl")}function Ar(t,e,n,r){return Ir(t,e,n,r,"hsv")}function Rr(t,e,n,r){return Ir(t,e,n,r,"hwb")}function xr(t,e,n,r){return r&&(t=h(a(t*At),0,255),e=h(a(e*At),0,255),n=h(a(n*At),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((r=1-t*It)-(e=gt(r,t=1-e*It,r=1-n*It)))*(n=1/(1-e)),(t-e)*n,(r-e)*n,e]}function Sr(t,e,n,r){var i;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(i=1-r)+r)),n=255*(1-(n=n*i+r)),[h(a(255*(1-(t=t*i+r))),0,255),h(a(e),0,255),h(a(n),0,255)])}function Er(t,e,n,r){2&(r=r||6)&&(t.width=e,t.oCanvas.width=+e,t.oCanvas.style&&(t.oCanvas.style.width=String(t.oCanvas.width)+"px"),t._restorable)&&(t.iCanvas.width=t.oCanvas.width,t.iCanvas.style)&&(t.iCanvas.style.width=t.oCanvas.style.width),4&r&&(t.height=n,t.oCanvas.height=+n,t.oCanvas.style&&(t.oCanvas.style.height=String(t.oCanvas.height)+"px"),t._restorable)&&(t.iCanvas.height=t.oCanvas.height,t.iCanvas.style)&&(t.iCanvas.style.height=t.oCanvas.style.height)}function Lr(t,e){var n=t.oCanvas.width,r=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d").getImageData(0,0,n,r),t.iData||(t.iData=t.iCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d").getImageData(0,0,n,r),t.oData||(t.oData=t.oCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-3)}function Mr(t,e){var n,r,i,a,o,s,l;t.selection&&(n=t.selection,l=t.oCanvas.width-1,s=t.oCanvas.height-1,r=n[0],i=n[1],a=n[2],o=n[3],l=n[4]?l:1,n=n[4]?s:1,r=p(r*l),i=p(i*n),s=(a=p(a*l))-r+1,l=(o=p(o*n))-i+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d").getImageData(r,i,s,l),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d").createImageData(0,0,s,l)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d").getImageData(r,i,s,l),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d").createImageData(0,0,s,l)),t._refresh&=-9)}function Tr(t,e){var e=e?fe(e):"",t=fe(t),n=he?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(le)}!function(t,F,y){function e(){}function n(t,e){return t&&$?$.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t}function r(t){var e;return b?{file:__filename,path:__dirname}:R||x?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:B&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:S&&(e=document.getElementsByTagName("script"))&&e.length?((r.link=r.link?r.link:document.createElement("a")).href=e[e.length-1].src,{file:e=r.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var s,i="prototype",a=Object,o=Array,l=Function[i],a=a[i],o=o[i],D=(JSON.parse,JSON.stringify),u=a.hasOwnProperty,c=function(t,e){return function(){return t(e)}},h=l.call.bind(o.slice),l=a.toString,w=function(t){return"function"==typeof t},f=function(t,e){return t instanceof e},d=setTimeout,m=clearTimeout,o=y,p=60,g=0,_=1,C=2,v=3,I=4,a="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,b="undefined"!=typeof global&&"[object global]"===l.call(global),A=b&&void 0!==process.send,R=!a&&!b&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,x=!a&&!b&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,S=!(a||b||x||R||"undefined"==typeof navigator||"undefined"==typeof document),B=(S&&window.opener,S&&(window.self,window.top),"function"==typeof define&&define.amd),Y=b||"function"==typeof Worker||"function"==typeof SharedWorker,E=b?t:R||x?self||t:window||t,k=b?module.$deps:R||x?self||this:window||this,U=(b?global:R||x?self:window,A||R||x),L=A&&0===process.listenerCount("message")||R&&!E.onconnect||x&&!E.onmessage,M=L?function t(e){t.handler&&t.handler(A?e:e.data)}:e,T=null,G={},$=(b&&require("os").cpus().length,b?null:void 0!==E.webkitURL?E.webkitURL:void 0!==E.URL?E.URL:null),P=r(q.moduleUri).file,X=function(t,e){if(t=t||{},e)for(var n in e)u.call(e,n)&&(t[n]=e[n]);return t},z=0;G[P]=1,b?((s=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=s)[i]={constructor:s,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((s=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=s)[i]={constructor:s,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(s.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},s.Shared[i]={constructor:s.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),L&&(R?(E.close=e,E.postMessage=e,E.onconnect=function(t){var e=t.ports[0];E.close=function(){e.close()},E.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",M),e.start()}):x?E.onmessage=M:A&&(E.close=function(){process.exit()},E.postMessage=function(t){process.send(t)},E.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(k)}catch(t){throw t}},process.on("message",M)));function H(t){if(!(this instanceof H))return new H(t);this.$id=(++z).toString(16),this.options=X({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},t)}H[i]={constructor:H,options:null,$id:null,$window:null,dispose:function(){var t=this;return t.$window&&t.close(),t.$window=null,t.$id=null,t.options=null,t},close:function(){var t=this;return t.$window&&(t.$window.closed||t.$window.close(),t.$window=null),t},ready:function(e,n){var r=this;return setTimeout(function t(){!r.$window||e&&!r.$window[e]?setTimeout(t,60):n()},0),r},open:function(t){var e=this;return!e.$window&&t&&(e.$window=window.open(t.push?n(["\ufeff"].concat(t),{type:"text/html;charset=utf-8"}):t,e.$id,function(t){var e,n=[];if(t)for(e in t)u.call(t,e)&&n.push(e+"="+(!0===t[e]||1===t[e]?"yes":!1===t[e]||0===t[e]?"no":t[e]));return n.join(",")}(e.options))),e},write:function(t){return this.$window&&t&&this.$window.document.write(t),this}};var O=function t(e){var r,n,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v;return e instanceof t?e:this instanceof t?(h=c=u=l=s=o=!1,d=0,m=1,_=g=p=f=a=i=n=null,C=y,(r=this).queue=function(t){return arguments.length?(n=t,r):n},r.jumpNext=function(t){n&&n.jumpNext(!1,t)},r.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},r.dispose=function(){n&&(n.dispose(),n=null)},r.task=function(t){return i=t,r},e&&r.task(e),r.run=v=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,C=i(),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,C},r.runWithArgs=function(t){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,C=i.apply(null,t),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,C},r.canRun=function(){return!!i&&!!(!o||s||l||u||c||h)&&!((s||l)&&p<=d||l&&!f||(u||c)&&C===g)},r.iif=function(t,e,n){return(t=w(t)?t():t)?r.task(e):2<arguments.length&&r.task(n),r},r.until=function(t){return C=y,g=t,u=l=s=h=!(c=!(f=null)),r.run=v,r},r.untilNot=function(t){return C=y,_=t,u=l=s=c=!(h=!(f=null)),r.run=v,r},r.loop=function(t,e,n){return C=y,d=e||0,m=n||1,p=t,u=l=h=c=!(s=!(f=null)),r.run=function(){var t=i(d);return d+=m,o=!0,C=t},r},r.each=function(t){return C=y,d=0,m=1,p=(f=t)&&t.length||0,u=s=h=c=!(l=!0),r.run=function(){var t=i(f[d],d);return++d,o=!0,C=t},r},r.recurse=function(t,e){return C=t,g=e,l=s=h=c=!(u=!(f=null)),r.run=function(){var t=i(C);return o=!0,C=t},r},r.isFinished=function(){var t=!o||h||c||s||l||u;return!(t=(t=(t=t&&(c||u)&&C===g?!1:t)&&h&&C!==_?!1:t)&&(s||l)&&p<=d?!1:t)},r.onComplete=function(t){return a=t||null,r},void(r.complete=function(){return a&&w(a)&&a(),r})):new t(e)};function W(t,e){var n,r=t.$queue,i=0;if(t.$runmode=_,r&&r.length){for(t.$running=!0;i<r.length;)(n=r[i])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(r.shift(),n.complete()):++i):r.shift();t.$running=!1,t.$timer=d(c(W,t),t.$interval)}}function j(t,e){var n,r=t.$queue;t.$runmode=I,r&&r.length&&((n=r[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(r.shift(),n.complete())):r.shift(),t.$running=!1,t.$timer=d(c(j,t),t.$interval))}function N(t,e){var n;return f(t,O)?t:w(t)?new O(t):f(this,N)?((n=this).$interval=arguments.length&&parseInt(t,10)||p,n.$timer=null,n.$runmode=g,n.$running=!1,n.$queue=[],void(L&&!1!==e&&n.initThread())):new N(t,e)}N.VERSION="0.5.2",N.Thread=s,N.Task=O,N.BrowserWindow=H,N.MODE={NONE:g,INTERLEAVE:_,LINEAR:C,PARALLEL:v,SEQUENCE:I},N.Platform={UNDEFINED:o,UNKNOWN:0,NODE:1,BROWSER:2},N.supportsMultiThreading=function(){return Y},N.isPlatform=function(t){return 1===t?b:2===t?S:void 0},N.isThread=function(t,e){return e=!0!==e||L,1===t?e&&A:2===t?e&&(R||x):e&&U},N.path=r,N.blob=n,N.load=function(t,e,n){if(t){e&&e.length&&N.importScripts(e.join?e.join(","):e),t=t.split(".");for(var r=k;t.length;)t[0]&&t[0].length&&r[t[0]]&&(r=r[t[0]]),t.shift();return r&&E!==r?w(r)?!1!==n?new r:r():r:void 0}return null},N.listen=L?function(t){M.handler=t}:e,N.send=L?function(t){E.postMessage(t)}:e,N.importScripts=L?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var r=t[e];r&&r.length&&1!==G[r]&&(E.importScripts(r),G[r]=1)}}:e,N.close=L?function(){E.close()}:e,N.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,N.serialize=function(r){r=r||new N(0,!1);function t(n){function t(){var t=this,e=arguments;r.step(function(){n.apply(t,e)}),r.$running||r.run(C)}return t.free=function(){return n},t}return t.free=function(){r&&r.dispose(),r=null},t},N[i]={constructor:N,$interval:p,$timer:null,$queue:null,$thread:null,$events:null,$runmode:g,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&m(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=g,e.$running=!1,L&&!0===t&&N.close(),e},empty:function(){var t=this;return t.$timer&&m(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=g,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,r){var i,a,o=this;if(!o.$thread){if(!Y)throw o.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");a=b?(i="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),o.$events=o.$events||{},(r=o.$thread=new(!0===r?s.Shared:s)(P)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,o.$events&&o.$events[e]?o.$events[e](t):"console.log"!==e&&"console.error"!==e||N.log(("console.error"===e?a:i)+(t||"")))},r.onerror=function(t){if(!o.$events||!o.$events.error)throw new Error(a+t.toString());o.$events.error(t)},o.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return o},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return L&&(n.$events={},N.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),N.close())})),n},listen:function(t,e){return t&&w(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(L?N.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return f(t,O)?t:w(t)?O(t):void 0},iif:function(){var t=arguments,e=new O;return e.iif.apply(e,t)},until:function(){var t=h(arguments),e=new O(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=h(arguments),e=new O(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=h(arguments),e=new O(t.pop());return e.loop.apply(e,t)},each:function(){var t=h(arguments),e=new O(t.pop());return e.each.apply(e,t)},recurse:function(){var t=h(arguments),e=new O(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,r=n.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n}:(e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var r=this,i=r.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,n)),r)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?d(function(){n.empty()},e):n.empty(),n}:(e&&0<e?d(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,I===t)j(n,e);else if(_===t)W(n,e);else if(C===t){var r,i=n,a=i.$queue;if(i.$runmode=C,a){for(;a.length&&(!a[0]||!a[0].canRun());)a.shift();a.length?(i.$running=!0,r=a.shift(),e?r.runWithArgs(e):r.run(),r.complete()):i.$running=!1}}else v===t&&((e=n).$runmode=v,e.$running=!1);return n}},L&&(N.log=function(t){N.send({event:"console.log",data:"string"!=typeof t?D(t):t})},N.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(T&&(w(T.dispose)&&T.dispose(),T=null),T=N.load(n.component,n.imports,n.asInstance));break;case"dispose":T&&(w(T.dispose)&&T.dispose(),T=null),N.close()}})),F.Asynchronous=N}(this,L),n=L,N="prototype",F=Object[N].hasOwnProperty,Object[N].toString,Object.defineProperty,E=Math,D=function(){},B=0,pr.Merge=function(){for(var t,e,n=arguments.length,r=n?arguments[0]:null,i=1;i<n;++i)for(t in e=arguments[i])F.call(e,t)&&(r[t]=e[t]);return r},n.Class=pr,n.Path=n.Asynchronous.path(q.moduleUri),n.uuid=function(t){return[t||"filter",(new Date).getTime(),++B].join("_")},n.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},w=n.Asynchronous,G=w.isPlatform(w.Platform.NODE),A=w.isPlatform(w.Platform.BROWSER),t=w.supportsMultiThreading(),H=w.isThread(null,!0),R=w.isThread(),e="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",i="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",b="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",(G=n.Browser={isNode:G,isBrowser:A,isWorker:H,isInsideWorker:R,supportsWorker:t,isPhantom:/PhantomJS/.test(e),isOpera:A&&/Opera|OPR\//.test(e),isFirefox:A&&/Firefox\//.test(e),isChrome:A&&/Chrome\//.test(e),isSafari:A&&/Apple Computer/.test(b),isKhtml:A&&/KHTML\//.test(e),isIE:A&&(/MSIE \d/.test(e)||/Trident\/\d/.test(e)),isGecko:A&&/gecko\/\d/i.test(e),isWebkit:A&&/WebKit\//.test(e),isMac_geLion:A&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(e),isMac_geMountainLion:A&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),isMobile:!1,isIOS:/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e),isWin:/windows/i.test(i),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=G.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),G.isMac=G.isIOS||/Mac/.test(i),G.isIE_lt8=G.isIE&&!R&&(null==document.documentMode||document.documentMode<8),G.isIE_lt9=G.isIE&&!R&&(null==document.documentMode||document.documentMode<9),G.isQtWebkit=G.isWebkit&&/Qt\/\d+\.\d+/.test(e),n.getPath=w.path,n.log=H?w.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},n.warning=function(t){n.log("WARNING: "+t)},n.error=function(t,e){if(n.log("ERROR: "+t),e)throw new Error(String(t))},n.devicePixelRatio=(A&&!R?window.devicePixelRatio:1)||1,n._notSupportClamp="undefined"==typeof Uint8ClampedArray,n.Array=Array,n.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,n.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,n.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,n.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,n.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,n.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,n.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,n.ImArray=n._notSupportClamp?n.Array8U:Uint8ClampedArray,n.ColorTable=n.ImArray,n.AffineMatrix=n.ColorMatrix=n.ConvolutionMatrix=n.Array32F,n._notSupportClamp=n._notSupportClamp||G.isOpera,n.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26},n.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},n.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},n.LUMA=n.LUMA_YUV=n.LUMA_YIQ=new n.Array32F([.2126,.7152,.0722]),n.LUMA_YCbCr=new n.Array32F([.299,.587,.114]),n.LUMA_GREEN=new n.Array32F([0,1,0]),n.CONSTANTS=n.CONST={X:0,Y:1,Z:2,PI:E.PI,PI2:2*E.PI,PI_2:E.PI/2,toRad:E.PI/180,toDeg:180/E.PI},n.FORMAT={IMAGE:1024,DATA:2048},n.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[N].set,hasSubarray:"function"==typeof n.Array32F[N].subarray},Math:{},Filter:{},Image:{}},n.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n.style&&(n.style.width=String(n.width)+"px",n.style.height=String(n.height)+"px",n.style.transformOrigin="top left",n.style.transform="scale(1,1)"),n},n.Canvas.Image=function(){return new Image},n.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},J=(t=L).MODE,b=t._notSupportClamp,tt=t.ImArray,et=t.Array32F,t.Array64F,t.Array32I,k=t.Array16I,Y=t.Array8U,U=t.ColorTable,$=t.ColorMatrix,P=t.AffineMatrix,t.ConvolutionMatrix,i=t.Util.Array=t.Util.Array||{},e=t.Util.String=t.Util.String||{},H=t.Util.Math=t.Util.Math||{},w=t.Util.Image=t.Util.Image||{},A=t.Util.Filter=t.Util.Filter||{},(S=Math).exp,S.sqrt,S.pow,S.ceil,nt=S.floor,S.log,S.sin,S.cos,rt=S.min,it=S.max,Z=S.abs,S.PI,S.log2,X=/([.*+?^${}()|\[\]\/\\\-])/g,z=/^\s+|\s+$/g,W=/^function[^{]+{([\s\S]*)}$/,i.copy=i.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return gr(e,t,0,0,t.length-1),e},i.typed=t.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},i.typed_obj=t.Browser.isNode?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t},i.arrayset_shim=gr,i.arrayset=i.hasArrayset?function(t,e,n){t.set(e,n||0)}:gr,i.subarray=i.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},H.clamp=M,e.esc=function(t){return t.replace(X,"\\$1")},e.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(z,"")},e.function_body=function(t){return t.toString().match(W)[1]||""},w.crop=i.hasArrayset?function(t,e,n,r,i,a,o){a=rt(a,e-1),o=rt(o,n-1);for(var s,l=new tt((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,h=i*e,f=0;c<=o;++c,h+=e,f+=u)l.set(t.subarray(s=h+r<<2,s+u),f);return l}:function(t,e,n,r,i,a,o){a=rt(a,e-1),o=rt(o,n-1);for(var s,l=new tt((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,h=i*e,f=0;c<=o;++c,h+=e,f+=u)gr(l,t,f,s=h+r<<2,s+u);return l},w.pad=i.hasArrayset?function(t,e,n,r,i,a,o){for(var s,r=e+(a=a||0)+(r=r||0),l=new tt(r*(n+(o=o||0)+(i=i||0))<<2),u=e<<2,c=r<<2,h=a<<2,f=0,d=0,m=o*c;f<n;++f,d+=e,m+=c)l.set(t.subarray(s=d<<2,s+u),h+m);return l}:function(t,e,n,r,i,a,o){for(var s,r=e+(a=a||0)+(r=r||0),l=new tt(r*(n+(o=o||0)+(i=i||0))<<2),u=e<<2,c=r<<2,h=a<<2,f=0,d=0,m=o*c;f<n;++f,d+=e,m+=c)gr(l,t,h+m,s=d<<2,s+u);return l},w.interpolate=function(t,e,n,r,i){for(var a,o,s,l,u,c,h,f,d,m,p=r*i<<2,g=new tt(p),_=(e-1)/r,C=(n-1)/i,v=e<<2,y=S.round,w=0,I=0,b=0,A=0,R=0,x=0;x<p;x+=4,++w,I+=_)r<=w&&(R=(b+=C)-(m=(I=w=0)|b),A=m*e),a=t[f=A+(m=0|I)<<2],o=t[4+f],s=t[f+v],l=t[f+v+4],g[x]=M(y(a*(u=(1-(d=I-m))*(1-R))+o*(c=d*(1-R))+s*(h=R*(1-d))+l*(d=d*R)),0,255),a=t[1+f],o=t[5+f],s=t[f+v+1],l=t[f+v+5],g[x+1]=M(y(a*u+o*c+s*h+l*d),0,255),a=t[2+f],o=t[6+f],s=t[f+v+2],l=t[f+v+6],g[x+2]=M(y(a*u+o*c+s*h+l*d),0,255),a=t[3+f],o=t[7+f],s=t[f+v+3],l=t[f+v+7],g[x+3]=M(y(a*u+o*c+s*h+l*d),0,255);return g},A.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,r=new U(256);if("function"==typeof t)for(n=0;n<256;n+=32)r[n]=0|M(t(n),0,255),r[n+1]=0|M(t(n+1),0,255),r[n+2]=0|M(t(n+2),0,255),r[n+3]=0|M(t(n+3),0,255),r[n+4]=0|M(t(n+4),0,255),r[n+5]=0|M(t(n+5),0,255),r[n+6]=0|M(t(n+6),0,255),r[n+7]=0|M(t(n+7),0,255),r[n+8]=0|M(t(n+8),0,255),r[n+9]=0|M(t(n+9),0,255),r[n+10]=0|M(t(n+10),0,255),r[n+11]=0|M(t(n+11),0,255),r[n+12]=0|M(t(n+12),0,255),r[n+13]=0|M(t(n+13),0,255),r[n+14]=0|M(t(n+14),0,255),r[n+15]=0|M(t(n+15),0,255),r[n+16]=0|M(t(n+16),0,255),r[n+17]=0|M(t(n+17),0,255),r[n+18]=0|M(t(n+18),0,255),r[n+19]=0|M(t(n+19),0,255),r[n+20]=0|M(t(n+20),0,255),r[n+21]=0|M(t(n+21),0,255),r[n+22]=0|M(t(n+22),0,255),r[n+23]=0|M(t(n+23),0,255),r[n+24]=0|M(t(n+24),0,255),r[n+25]=0|M(t(n+25),0,255),r[n+26]=0|M(t(n+26),0,255),r[n+27]=0|M(t(n+27),0,255),r[n+28]=0|M(t(n+28),0,255),r[n+29]=0|M(t(n+29),0,255),r[n+30]=0|M(t(n+30),0,255),r[n+31]=0|M(t(n+31),0,255);else for(n=0;n<256;n+=32)r[n]=0|M(e+t*n,0,255),r[n+1]=0|M(e+t*(n+1),0,255),r[n+2]=0|M(e+t*(n+2),0,255),r[n+3]=0|M(e+t*(n+3),0,255),r[n+4]=0|M(e+t*(n+4),0,255),r[n+5]=0|M(e+t*(n+5),0,255),r[n+6]=0|M(e+t*(n+6),0,255),r[n+7]=0|M(e+t*(n+7),0,255),r[n+8]=0|M(e+t*(n+8),0,255),r[n+9]=0|M(e+t*(n+9),0,255),r[n+10]=0|M(e+t*(n+10),0,255),r[n+11]=0|M(e+t*(n+11),0,255),r[n+12]=0|M(e+t*(n+12),0,255),r[n+13]=0|M(e+t*(n+13),0,255),r[n+14]=0|M(e+t*(n+14),0,255),r[n+15]=0|M(e+t*(n+15),0,255),r[n+16]=0|M(e+t*(n+16),0,255),r[n+17]=0|M(e+t*(n+17),0,255),r[n+18]=0|M(e+t*(n+18),0,255),r[n+19]=0|M(e+t*(n+19),0,255),r[n+20]=0|M(e+t*(n+20),0,255),r[n+21]=0|M(e+t*(n+21),0,255),r[n+22]=0|M(e+t*(n+22),0,255),r[n+23]=0|M(e+t*(n+23),0,255),r[n+24]=0|M(e+t*(n+24),0,255),r[n+25]=0|M(e+t*(n+25),0,255),r[n+26]=0|M(e+t*(n+26),0,255),r[n+27]=0|M(e+t*(n+27),0,255),r[n+28]=0|M(e+t*(n+28),0,255),r[n+29]=0|M(e+t*(n+29),0,255),r[n+30]=0|M(e+t*(n+30),0,255),r[n+31]=0|M(e+t*(n+31),0,255);return r},A.ct_multiply=function(t,e){for(var n=new U(256),r=0;r<256;r+=64)n[r]=M(t[M(e[r],0,255)],0,255),n[r+1]=M(t[M(e[r+1],0,255)],0,255),n[r+2]=M(t[M(e[r+2],0,255)],0,255),n[r+3]=M(t[M(e[r+3],0,255)],0,255),n[r+4]=M(t[M(e[r+4],0,255)],0,255),n[r+5]=M(t[M(e[r+5],0,255)],0,255),n[r+6]=M(t[M(e[r+6],0,255)],0,255),n[r+7]=M(t[M(e[r+7],0,255)],0,255),n[r+8]=M(t[M(e[r+8],0,255)],0,255),n[r+9]=M(t[M(e[r+9],0,255)],0,255),n[r+10]=M(t[M(e[r+10],0,255)],0,255),n[r+11]=M(t[M(e[r+11],0,255)],0,255),n[r+12]=M(t[M(e[r+12],0,255)],0,255),n[r+13]=M(t[M(e[r+13],0,255)],0,255),n[r+14]=M(t[M(e[r+14],0,255)],0,255),n[r+15]=M(t[M(e[r+15],0,255)],0,255),n[r+16]=M(t[M(e[r+16],0,255)],0,255),n[r+17]=M(t[M(e[r+17],0,255)],0,255),n[r+18]=M(t[M(e[r+18],0,255)],0,255),n[r+19]=M(t[M(e[r+19],0,255)],0,255),n[r+20]=M(t[M(e[r+20],0,255)],0,255),n[r+21]=M(t[M(e[r+21],0,255)],0,255),n[r+22]=M(t[M(e[r+22],0,255)],0,255),n[r+23]=M(t[M(e[r+23],0,255)],0,255),n[r+24]=M(t[M(e[r+24],0,255)],0,255),n[r+25]=M(t[M(e[r+25],0,255)],0,255),n[r+26]=M(t[M(e[r+26],0,255)],0,255),n[r+27]=M(t[M(e[r+27],0,255)],0,255),n[r+28]=M(t[M(e[r+28],0,255)],0,255),n[r+29]=M(t[M(e[r+29],0,255)],0,255),n[r+30]=M(t[M(e[r+30],0,255)],0,255),n[r+31]=M(t[M(e[r+31],0,255)],0,255),n[r+32]=M(t[M(e[r+32],0,255)],0,255),n[r+33]=M(t[M(e[r+33],0,255)],0,255),n[r+34]=M(t[M(e[r+34],0,255)],0,255),n[r+35]=M(t[M(e[r+35],0,255)],0,255),n[r+36]=M(t[M(e[r+36],0,255)],0,255),n[r+37]=M(t[M(e[r+37],0,255)],0,255),n[r+38]=M(t[M(e[r+38],0,255)],0,255),n[r+39]=M(t[M(e[r+39],0,255)],0,255),n[r+40]=M(t[M(e[r+40],0,255)],0,255),n[r+41]=M(t[M(e[r+41],0,255)],0,255),n[r+42]=M(t[M(e[r+42],0,255)],0,255),n[r+43]=M(t[M(e[r+43],0,255)],0,255),n[r+44]=M(t[M(e[r+44],0,255)],0,255),n[r+45]=M(t[M(e[r+45],0,255)],0,255),n[r+46]=M(t[M(e[r+46],0,255)],0,255),n[r+47]=M(t[M(e[r+47],0,255)],0,255),n[r+48]=M(t[M(e[r+48],0,255)],0,255),n[r+49]=M(t[M(e[r+49],0,255)],0,255),n[r+50]=M(t[M(e[r+50],0,255)],0,255),n[r+51]=M(t[M(e[r+51],0,255)],0,255),n[r+52]=M(t[M(e[r+52],0,255)],0,255),n[r+53]=M(t[M(e[r+53],0,255)],0,255),n[r+54]=M(t[M(e[r+54],0,255)],0,255),n[r+55]=M(t[M(e[r+55],0,255)],0,255),n[r+56]=M(t[M(e[r+56],0,255)],0,255),n[r+57]=M(t[M(e[r+57],0,255)],0,255),n[r+58]=M(t[M(e[r+58],0,255)],0,255),n[r+59]=M(t[M(e[r+59],0,255)],0,255),n[r+60]=M(t[M(e[r+60],0,255)],0,255),n[r+61]=M(t[M(e[r+61],0,255)],0,255),n[r+62]=M(t[M(e[r+62],0,255)],0,255),n[r+63]=M(t[M(e[r+63],0,255)],0,255);return n},A.cm_eye=function(){return new $([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},A.cm_multiply=function(t,e){var n=new $(20);return n[0]=e[0]*t[0]+e[1]*t[5]+e[2]*t[10]+e[3]*t[15],n[1]=e[0]*t[1]+e[1]*t[6]+e[2]*t[11]+e[3]*t[16],n[2]=e[0]*t[2]+e[1]*t[7]+e[2]*t[12]+e[3]*t[17],n[3]=e[0]*t[3]+e[1]*t[8]+e[2]*t[13]+e[3]*t[18],n[4]=e[0]*t[4]+e[1]*t[9]+e[2]*t[14]+e[3]*t[19]+e[4],n[5]=e[5]*t[0]+e[6]*t[5]+e[7]*t[10]+e[8]*t[15],n[6]=e[5]*t[1]+e[6]*t[6]+e[7]*t[11]+e[8]*t[16],n[7]=e[5]*t[2]+e[6]*t[7]+e[7]*t[12]+e[8]*t[17],n[8]=e[5]*t[3]+e[6]*t[8]+e[7]*t[13]+e[8]*t[18],n[9]=e[5]*t[4]+e[6]*t[9]+e[7]*t[14]+e[8]*t[19]+e[9],n[10]=e[10]*t[0]+e[11]*t[5]+e[12]*t[10]+e[13]*t[15],n[11]=e[10]*t[1]+e[11]*t[6]+e[12]*t[11]+e[13]*t[16],n[12]=e[10]*t[2]+e[11]*t[7]+e[12]*t[12]+e[13]*t[17],n[13]=e[10]*t[3]+e[11]*t[8]+e[12]*t[13]+e[13]*t[18],n[14]=e[10]*t[4]+e[11]*t[9]+e[12]*t[14]+e[13]*t[19]+e[14],n[15]=e[15]*t[0]+e[16]*t[5]+e[17]*t[10]+e[18]*t[15],n[16]=e[15]*t[1]+e[16]*t[6]+e[17]*t[11]+e[18]*t[16],n[17]=e[15]*t[2]+e[16]*t[7]+e[17]*t[12]+e[18]*t[17],n[18]=e[15]*t[3]+e[16]*t[8]+e[17]*t[13]+e[18]*t[18],n[19]=e[15]*t[4]+e[16]*t[9]+e[17]*t[14]+e[18]*t[19]+e[19],n},A.cm_rechannel=function(t,e,n,r,i,a,o,s,l){var u=new $(20),o=5*o,s=5*s,l=5*l;return u[(a=5*a)+e]=t[0],u[a+n]=t[1],u[a+r]=t[2],u[a+i]=t[3],u[4+a]=t[4],u[o+e]=t[5],u[o+n]=t[6],u[o+r]=t[7],u[o+i]=t[8],u[4+o]=t[9],u[s+e]=t[10],u[s+n]=t[11],u[s+r]=t[12],u[s+i]=t[13],u[4+s]=t[14],u[l+e]=t[15],u[l+n]=t[16],u[l+r]=t[17],u[l+i]=t[18],u[4+l]=t[19],u},A.am_eye=function(){return new P([1,0,0,0,0,1,0,0])},A.am_multiply=function(t,e){var n=new P(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},A.cm_combine=function(t,e,n,r,i){i=i||Array,n=n||1,r=r||1;for(var a=0,o=t.length,s=new i(o);a<o;++a)s[a]=n*t[a]+r*e[a];return s},A.cm_convolve=function(t,e,n){n=n||Array;for(var r=t.length,i=(e=e===+e?[e]:e).length,a=new n(r*i),o=0,s=0;o<r;)a[o*i+s]=t[o]*e[s],++s>=i&&(s=0,++o);return a},A.integral_convolution=b?function(F,t,e,D,n,r,B,Y,k,i,a,U){var o,s,l,u,c,h,f,d,m,p,g,_,$,C,v,y,w,I,b,A,R,x,S,E,L,P,X,z,M,T,G=t.length,W=G>>>n,j=e<<n,H=1<<n,n=Y*k,q=-(Y=Y>>>1)-1,V=-(k=e*(k>>>1))-e,K=Y,Q=k,O=e-1,Z=W-e,N=t;if(t=new tt(G),U=U||1,J.GRAY===F)if(c=e,o=new et(W),B)for(p=r[0],g=r[n>>>1]-p,_=B[0],$=B[n>>>1]-_,M=0;M<U;++M){for(T=t,t=N,N=T,d=s=f=h=0;d<e;d++,h+=H,++f)s+=t[h],o[f]=s;for(s=d=f=0,h=j;h<G;h+=H,++f,++d)e<=d&&(s=d=0),s+=t[h],o[f+c]=o[f]+s;for(h=m=d=0;h<G;h+=H,++d)e<=d&&(d=0,m+=e),L=p*(o[R=(y=O<(y=d+K)?O:y)+(w=Z<(w=m+Q)?Z:w)]-o[b=y+(v=(v=m+V)<0?0:v)]-o[A=(C=(C=d+q)<0?0:C)+w]+o[I=C+v])+g*t[h],z=_*(o[R]-o[b]-o[A]+o[I])+$*t[h],N[h]=0|(x=(x=i*L+a*z)<0?0:255<x?255:x),N[h+1]=0|x,N[h+2]=0|x,N[h+3]=t[h+3]}else for(p=r[0],g=r[n>>>1]-p,M=0;M<U;++M){for(T=t,t=N,N=T,d=s=f=h=0;d<e;d++,h+=H,++f)s+=t[h],o[f]=s;for(s=d=f=0,h=j;h<G;h+=H,++f,++d)e<=d&&(s=d=0),s+=t[h],o[f+c]=o[f]+s;for(h=m=d=0;h<G;h+=H,++d)e<=d&&(d=0,m+=e),L=p*(o[R=(y=O<(y=d+K)?O:y)+(w=Z<(w=m+Q)?Z:w)]-o[b=y+(v=(v=m+V)<0?0:v)]-o[A=(C=(C=d+q)<0?0:C)+w]+o[I=C+v])+g*t[h],N[h]=0|(x=(x=i*L+a)<0?0:255<x?255:x),N[h+1]=0|x,N[h+2]=0|x,N[h+3]=t[h+3]}else if(c=(e<<1)+e,o=new et((W<<1)+W),B)for(p=r[0],g=r[n>>>1]-p,_=B[0],$=B[n>>>1]-_,M=0;M<U;++M){for(T=t,t=N,N=T,d=s=l=u=f=h=0;d<e;++d,h+=H,f+=3)s+=t[h],l+=t[h+1],u+=t[h+2],o[f]=s,o[f+1]=l,o[f+2]=u;for(s=l=u=d=f=0,h=j;h<G;h+=H,f+=3,++d)e<=d&&(s=l=u=d=0),s+=t[h],l+=t[h+1],u+=t[h+2],o[f+c]=o[f]+s,o[f+c+1]=o[f+1]+l,o[f+c+2]=o[f+2]+u;for(h=m=d=0;h<G;h+=H,++d)e<=d&&(d=0,m+=e),L=p*(o[R=((R=(y=O<(y=d+K)?O:y)+(w=Z<(w=m+Q)?Z:w))<<1)+R]-o[b=((b=y+(v=(v=m+V)<0?0:v))<<1)+b]-o[A=((A=(C=(C=d+q)<0?0:C)+w)<<1)+A]+o[I=((I=C+v)<<1)+I])+g*t[h],P=p*(o[R+1]-o[b+1]-o[A+1]+o[I+1])+g*t[h+1],X=p*(o[R+2]-o[b+2]-o[A+2]+o[I+2])+g*t[h+2],z=_*(o[R]-o[b]-o[A]+o[I])+$*t[h],S=(S=i*P+a*(_*(o[R+1]-o[b+1]-o[A+1]+o[I+1])+$*t[h+1]))<0?0:255<S?255:S,E=(E=i*X+a*(_*(o[R+2]-o[b+2]-o[A+2]+o[I+2])+$*t[h+2]))<0?0:255<E?255:E,N[h]=0|(x=(x=i*L+a*z)<0?0:255<x?255:x),N[h+1]=0|S,N[h+2]=0|E,N[h+3]=t[h+3]}else for(p=r[0],g=r[n>>>1]-p,M=0;M<U;++M){for(T=t,t=N,N=T,d=s=l=u=f=h=0;d<e;++d,h+=H,f+=3)s+=t[h],l+=t[h+1],u+=t[h+2],o[f]=s,o[f+1]=l,o[f+2]=u;for(s=l=u=d=f=0,h=j;h<G;h+=H,f+=3,++d)e<=d&&(s=l=u=d=0),s+=t[h],l+=t[h+1],u+=t[h+2],o[f+c]=o[f]+s,o[f+c+1]=o[f+1]+l,o[f+c+2]=o[f+2]+u;for(h=m=d=0;h<G;h+=H,++d)e<=d&&(d=0,m+=e),L=p*(o[R=((R=(y=O<(y=d+K)?O:y)+(w=Z<(w=m+Q)?Z:w))<<1)+R]-o[b=((b=y+(v=(v=m+V)<0?0:v))<<1)+b]-o[A=((A=(C=(C=d+q)<0?0:C)+w)<<1)+A]+o[I=((I=C+v)<<1)+I])+g*t[h],S=(S=i*(P=p*(o[R+1]-o[b+1]-o[A+1]+o[I+1])+g*t[h+1])+a)<0?0:255<S?255:S,E=(E=i*(X=p*(o[R+2]-o[b+2]-o[A+2]+o[I+2])+g*t[h+2])+a)<0?0:255<E?255:E,N[h]=0|(x=(x=i*L+a)<0?0:255<x?255:x),N[h+1]=0|S,N[h+2]=0|E,N[h+3]=t[h+3]}return N}:function(F,t,e,D,n,r,i,B,Y,a,o,k){var s,l,u,c,h,f,d,m,p,g,_,C,U,v,y,w,I,b,A,R,x,S,$,P,E,X,z,W,L,M,T=t.length,j=T>>>n,q=e<<n,G=1<<n,n=B*Y,V=-(B=B>>>1)-1,K=-(Y=e*(Y>>>1))-e,Q=B,Z=Y,H=e-1,O=j-e,N=t;if(t=new tt(T),k=k||1,J.GRAY===F)if(h=e,s=new et(j),i)for(g=r[0],_=r[n>>>1]-g,C=i[0],U=i[n>>>1]-C,L=0;L<k;++L){for(M=t,t=N,N=M,m=l=d=f=0;m<e;++m,f+=G,++d)l+=t[f],s[d]=l;for(l=m=d=0,f=q;f<T;f+=G,++d,++m)e<=m&&(l=m=0),l+=t[f],s[d+h]=s[d]+l;for(f=p=m=0;f<T;f+=G,++m)e<=m&&(m=0,p+=e),E=g*(s[x=(w=H<(w=m+Q)?H:w)+(I=O<(I=p+Z)?O:I)]-s[A=w+(y=(y=p+K)<0?0:y)]-s[R=(v=(v=m+V)<0?0:v)+I]+s[b=v+y])+_*t[f],W=C*(s[x]-s[A]-s[R]+s[b])+U*t[f],N[f]=0|(S=a*E+o*W),N[f+1]=0|S,N[f+2]=0|S,N[f+3]=t[f+3]}else for(g=r[0],_=r[n>>>1]-g,L=0;L<k;++L){for(M=t,t=N,N=M,m=l=d=f=0;m<e;m++,f+=G,++d)l+=t[f],s[d]=l;for(l=m=d=0,f=q;f<T;f+=G,++d,++m)e<=m&&(l=m=0),l+=t[f],s[d+h]=s[d]+l;for(f=p=m=0;f<T;f+=G,++m)e<=m&&(m=0,p+=e),E=g*(s[x=(w=H<(w=m+Q)?H:w)+(I=O<(I=p+Z)?O:I)]-s[A=w+(y=(y=p+K)<0?0:y)]-s[R=(v=(v=m+V)<0?0:v)+I]+s[b=v+y])+_*t[f],N[f]=0|(S=a*E+o),N[f+1]=0|S,N[f+2]=0|S,N[f+3]=t[f+3]}else if(h=(e<<1)+e,s=new et((j<<1)+j),i)for(g=r[0],_=r[n>>>1]-g,C=i[0],U=i[n>>>1]-C,L=0;L<k;++L){for(M=t,t=N,N=M,m=l=u=c=d=f=0;m<e;++m,f+=G,d+=3)l+=t[f],u+=t[f+1],c+=t[f+2],s[d]=l,s[d+1]=u,s[d+2]=c;for(l=u=c=m=d=0,f=q;f<T;f+=G,d+=3,++m)e<=m&&(l=u=c=m=0),l+=t[f],u+=t[f+1],c+=t[f+2],s[d+h]=s[d]+l,s[d+h+1]=s[d+1]+u,s[d+h+2]=s[d+2]+c;for(f=p=m=0;f<T;f+=G,++m)e<=m&&(m=0,p+=e),E=g*(s[x=((x=(w=H<(w=m+Q)?H:w)+(I=O<(I=p+Z)?O:I))<<1)+x]-s[A=((A=w+(y=(y=p+K)<0?0:y))<<1)+A]-s[R=((R=(v=(v=m+V)<0?0:v)+I)<<1)+R]+s[b=((b=v+y)<<1)+b])+_*t[f],X=g*(s[x+1]-s[A+1]-s[R+1]+s[b+1])+_*t[f+1],z=g*(s[x+2]-s[A+2]-s[R+2]+s[b+2])+_*t[f+2],W=C*(s[x]-s[A]-s[R]+s[b])+U*t[f],$=a*X+o*(C*(s[x+1]-s[A+1]-s[R+1]+s[b+1])+U*t[f+1]),P=a*z+o*(C*(s[x+2]-s[A+2]-s[R+2]+s[b+2])+U*t[f+2]),N[f]=0|(S=a*E+o*W),N[f+1]=0|$,N[f+2]=0|P,N[f+3]=t[f+3]}else for(g=r[0],_=r[n>>>1]-g,L=0;L<k;++L){for(M=t,t=N,N=M,m=l=u=c=d=f=0;m<e;++m,f+=G,d+=3)l+=t[f],u+=t[f+1],c+=t[f+2],s[d]=l,s[d+1]=u,s[d+2]=c;for(l=u=c=m=d=0,f=q;f<T;f+=G,d+=3,++m)e<=m&&(l=u=c=m=0),l+=t[f],u+=t[f+1],c+=t[f+2],s[d+h]=s[d]+l,s[d+h+1]=s[d+1]+u,s[d+h+2]=s[d+2]+c;for(f=p=m=0;f<T;f+=G,++m)e<=m&&(m=0,p+=e),E=g*(s[x=((x=(w=H<(w=m+Q)?H:w)+(I=O<(I=p+Z)?O:I))<<1)+x]-s[A=((A=w+(y=(y=p+K)<0?0:y))<<1)+A]-s[R=((R=(v=(v=m+V)<0?0:v)+I)<<1)+R]+s[b=((b=v+y)<<1)+b])+_*t[f],$=a*(X=g*(s[x+1]-s[A+1]-s[R+1]+s[b+1])+_*t[f+1])+o,P=a*(z=g*(s[x+2]-s[A+2]-s[R+2]+s[b+2])+_*t[f+2])+o,N[f]=0|(S=a*E+o),N[f+1]=0|$,N[f+2]=0|P,N[f+3]=t[f+3]}return N},A.separable_convolution=b?function(F,t,e,D,n,B,r,i,a,Y,o){for(var s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x,S,E,L=t.length,M=1<<n,T=e-1,G=(L>>>n)-e,H=new k(i),O=0,N=i.length;O<N;O+=2)H[O+1]*=e;for(f=new k(a),O=0,N=a.length;O<N;O+=2)f[O+1]*=e;if(S=2,l=B,u=i,x=Y,h=H,c=t,t=new tt(L),J.GRAY===F)for(;S--;){for(E=t,t=c,c=E,s=l.length,N=u.length,d=g=p=0;d<L;d+=M,++p){for(e<=p&&(p=0,g+=e),m=O=b=A=R=0;O<s;++O,m+=2)_=p+h[m],C=g+h[m+1],0<=_&&_<=T&&0<=C&&C<=G&&(srcOff=_+C<<2,I=l[O],b+=t[srcOff]*I);c[d]=0|(v=(v=x*b)<0?0:255<v?255:v),c[d+1]=0|v,c[d+2]=0|v,c[d+3]=t[d+3]}l=r,u=a,x=o,h=f}else for(;S--;){for(E=t,t=c,c=E,s=l.length,N=u.length,d=g=p=0;d<L;d+=M,++p){for(e<=p&&(p=0,g+=e),m=O=b=A=R=0;O<s;++O,m+=2)_=p+h[m],C=g+h[m+1],0<=_&&_<=T&&0<=C&&C<=G&&(srcOff=_+C<<2,I=l[O],b+=t[srcOff]*I,A+=t[srcOff+1]*I,R+=t[srcOff+2]*I);y=(y=x*A)<0?0:255<y?255:y,w=(w=x*R)<0?0:255<w?255:w,c[d]=0|(v=(v=x*b)<0?0:255<v?255:v),c[d+1]=0|y,c[d+2]=0|w,c[d+3]=t[d+3]}l=r,u=a,x=o,h=f}return c}:function(F,t,e,D,n,B,r,i,a,Y,o){for(var s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x,S,E,L=t.length,M=1<<n,T=e-1,G=(L>>>n)-e,H=new k(i),O=0,N=i.length;O<N;O+=2)H[O+1]*=e;for(f=new k(a),O=0,N=a.length;O<N;O+=2)f[O+1]*=e;if(S=2,l=B,u=i,x=Y,h=H,c=t,t=new tt(L),J.GRAY===F)for(;S--;){for(E=t,t=c,c=E,s=l.length,N=u.length,d=g=p=0;d<L;d+=M,++p){for(e<=p&&(p=0,g+=e),m=O=b=A=R=0;O<s;++O,m+=2)_=p+h[m],C=g+h[m+1],0<=_&&_<=T&&0<=C&&C<=G&&(srcOff=_+C<<2,I=l[O],b+=t[srcOff]*I);c[d]=0|(v=x*b),c[d+1]=0|v,c[d+2]=0|v,c[d+3]=t[d+3]}l=r,u=a,x=o,h=f}else for(;S--;){for(E=t,t=c,c=E,s=l.length,N=u.length,d=g=p=0;d<L;d+=M,++p){for(e<=p&&(p=0,g+=e),m=O=b=A=R=0;O<s;++O,m+=2)_=p+h[m],C=g+h[m+1],0<=_&&_<=T&&0<=C&&C<=G&&(srcOff=_+C<<2,I=l[O],b+=t[srcOff]*I,A+=t[srcOff+1]*I,R+=t[srcOff+2]*I);y=x*A,w=x*R,c[d]=0|(v=x*b),c[d+1]=0|y,c[d+2]=0|w,c[d+3]=t[d+3]}l=r,u=a,x=o,h=f}return c},A.gradient=function(t,e,n,r,i,a,o,s,l,u,c,h){var f,d,m,p,g,_,C,v,y,w,I,b=r,A=t.length,R=e-1,x=n-1,S=1<<r,E=S<<1,L=e<<r,M=new et(A=A>>>r),T=new et(A);if(a){for(g=e-2,_=n-2,a=e<<1,I=new Y(A),m=d=2,p=a;m<_&&!(g<=d&&(d=2,p+=e,_<=++m));++d)I[f=d+p]=(103*(2*t[(w=(y=(C=(f<<r)+i)-L)-L)-E]+4*t[w-S]+5*t[w]+4*t[w+S]+2*t[w+E]+4*t[y-E]+9*t[y-S]+12*t[y]+9*t[y+S]+4*t[y+E]+5*t[C-E]+12*t[C-S]+15*t[C]+12*t[C+S]+5*t[C+E]+4*t[(v=C+L)-E]+9*t[v-S]+12*t[v]+9*t[v+S]+4*t[v+E]+2*t[(w=v+L)-E]+4*t[w-S]+5*t[w]+4*t[w+S]+2*t[w+E])+8192&4294967295)>>>14&255;S=1,E=2,L=e,i=r=0}else I=t;for(m=d=1,p=e;m<x&&!(R<=d&&(d=1,p+=e,x<=++m));++d)M[f=p+d]=I[(y=(C=(f<<r)+i)-L)+S]-I[y-S]+(I[C+S]<<1)-(I[C-S]<<1)+I[(v=C+L)+S]-I[v-S],T[f]=I[y-S]-I[v-S]+(I[y]<<1)-(I[v]<<1)+I[y+S]-I[v+S];return _r(M,T,t,e,n,b,o,s,l,u,c,h)},A.optimum_gradient=_r,A.sat=function(t,e,n,r,i,a,o,s){for(var l,u,c,h,f,d=t.length,m=e<<r,p=(31&e)<<r,g=32<<r,_=1<<r,C=l=0,v=0,y=i;y<p;y+=_)C+=u=t[y],a[v]=C,l+=(s[v]=u)*u,o[v]=l,++v;for(c=p+i;c<m;c+=g)C+=u=t[y=c],a[v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,C+=u=t[y+=_],a[++v]=C,l+=(s[v]=u)*u,o[v]=l,++v;for(f=1,l=C=v=h=0,p+=m,y=m+i;y<p;y+=_)C+=u=t[y],a[v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++v,++h>=e&&(++f,C=l=h=0);for(c=p+i;c<d;c+=g)C+=u=t[y=c],a[v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++h>=e&&(++f,C=l=h=0),C+=u=t[y+=_],a[++v+e]=a[v]+C,o[v+e]=o[v]+(l+=u*u),s[v+e]=s[v+1-e]+(u+t[v-e<<r])+(1<f?s[v-e-e]:0)+(0<h?s[v-1-e]:0),++v,++h>=e&&(++f,C=l=h=0)},u=L,j="prototype",R=Object[j],K=Function[j],Q=Array[j],at=R.hasOwnProperty,ot=Object.keys,R=Math,st=u.Asynchronous,lt=st.isPlatform(st.Platform.NODE),st.isPlatform(st.Platform.BROWSER),st.supportsMultiThreading(),ut=st.isThread(null,!0),st.isThread(),ct=u.Path,ht=u.Class.Merge,u._notSupportClamp,u.log,ft=R.min,dt=R.max,R=u.FilterThread=u.Class(st,{path:ct,name:null,_listener:null,_rand:null,constructor:function(){var n=this,r=null;ut&&n.initThread().listen("load",function(t){t&&t.filter&&(r&&(r.dispose(!0),r=null),r=st.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&st.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(t){var e;r&&t&&t.im?((e=t.im)[0]=u.Util.Array.typed(e[0],u.ImArray),t.params&&r.unserializeFilter(t.params),t.inputs&&r.unserializeInputs(t.inputs,e),e=r._apply(e[0],e[1],e[2]),n.send("apply",{im:!!r._update&&e,meta:r.hasMeta?r.metaData(!0):null})):n.send("apply",{im:null})}).listen("dispose",function(t){r&&(r.dispose(!0),r=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=lt?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",ct.file!==n.path.file?[ct.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:Q.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(st.blob("function"==typeof t[n]?K.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:Q.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),mt=u.Filter=u.Class(R,{name:"Filter",constructor:function(){this.inputs={},this.meta=null},_isOn:!0,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t.$super("dispose"),t},worker:R[j].thread,metaData:function(t,e){return this.meta},getMetaData:null,setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){return t=String(t),null===e?this.inputs[t]&&delete this.inputs[t]:this.inputs[t]=[null,e,e.nref],this},unsetInput:function(t){return t=String(t),this.inputs[t]&&delete this.inputs[t],this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,r,i=this.inputs,a=ot(i),o=a.length;if(!o)return null;for(r={},n=0;n<o;++n)(null==(e=i[a[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(e[2]=e[1].nref,r[a[n]]=t===e[1]||e[1].getSelectedData(1));return r},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,r=this.inputs,i=ot(t),a=i.length,o=u.ImArray,s=u.Util.Array.typed,l=0;l<a;++l)(n=t[i[l]])&&(!0===n?n=e:n[0]=s(n[0],o),r[i[l]]=[n,null,0]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,r,i){return this.selection=!1===t?null:i?[dt(0,t||0),dt(0,e||0),dt(0,n||0),dt(0,r||0),0]:[ft(1,dt(0,t||0)),ft(1,dt(0,e||0)),ft(1,dt(0,n||0)),ft(1,dt(0,r||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply:function(t,e,n,r){return t},apply:function(t,e,n){var r,i,a,o=this;return o.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||o.onComplete,r=t.getSelectedData(),i=r[1],a=r[2],o.$thread?(o._listener.cb=function(t){o._listener.cb=null,t&&(t.meta&&o.setMetaData(t.meta,!0),t.im)&&o._update&&(o.hasMeta&&(null!=o.meta._IMG_WIDTH&&i!==o.meta._IMG_WIDTH||null!=o.meta._IMG_HEIGHT&&a!==o.meta._IMG_HEIGHT)&&e.dimensions(o.meta._IMG_WIDTH,o.meta._IMG_HEIGHT),e.setSelectedData(u.Util.Array.typed(t.im,u.ImArray))),n&&n.call(o)},o.send("apply",{im:r,params:o.serializeFilter(),inputs:o.serializeInputs(t)})):(r=o._apply(r[0],i,a,{src:t,dst:e}),o._update&&(o.hasMeta&&(null!=o.meta._IMG_WIDTH&&i!==o.meta._IMG_WIDTH||null!=o.meta._IMG_HEIGHT&&a!==o.meta._IMG_HEIGHT)&&e.dimensions(o.meta._IMG_WIDTH,o.meta._IMG_HEIGHT),e.setSelectedData(r)),n&&n.call(o))),t},toString:function(){return"[FILTER: "+this.name+"]"}}),u.Filter[j].getMetaData=u.Filter[j].metaData,u.Filter[j].getInput=u.Filter[j].input,u.Filter[j].delInput=u.Filter[j].unsetInput,u.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,r=u,i=0;i<n;++i){if(!r[e=t[i]])return null;r=r[e]}return r}return u[t]||null},u.Create=function(t){var e,n=(t=ht({init:Cr,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==mt[j].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==mt[j].getMetaData&&(t.metaData=t.getMetaData),delete t.init,at.call(t,"apply")&&delete t.apply,u[n]=u.Class(mt,t)},c=Math,pt=c.sqrt,a=c.round,c.floor,gt=c.min,_t=c.max,c.abs,c.sin,c.cos,c.PI,h=L.Util.Math.clamp,G=L.Util.String.esc,Ct=L.Util.String.trim,vt=L.LUMA,(d=L.Color=L.Class({__static__:{clamp:h,clampPixel:function(t){return gt(255,_t(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,r){return(255&r)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},intensity:function(t,e,n){return~~(vt[0]*t+vt[1]*e+vt[2]*n)},hue:function(t,e,n){return t=t,e=e,n=n,r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),i=r=c.max(t,e,n),a=c.min(t,e,n),h(c.round(0==(r=r-a)?0:i===t?60*(0+(e-n)/r):i===e?60*(2+(n-t)/r):60*(4+(t-e)/r)),0,360);var r,i,a},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(r=!(i="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=c.max(t,e,n),e=r-(t=c.min(t,e,n)),r=0==(n=(r+t)/2)||1==n?0:(a-n)/c.min(n,1-n),t=0===a?0:e/a,h("hsv"===i?100*t:100*r,0,100));var r,i,a},dist:function(t,e,n,r){var i=t[n+0]-e[r+0],a=t[n+1]-e[r+1],t=t[n+2]-e[r+2];return pt(i*i+a*a+t*t)},RGB2Gray:function(t,e){var n=vt[0]*t[e+0]+vt[1]*t[e+1]+vt[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=.412453*n+.35758*r+.180423*i|0,t[e+1]=.212671*n+.71516*r+.072169*i|0,t[e+2]=.019334*n+.119193*r+.950227*i|0,t},XYZ2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,r=t[e+1]/255,i=t[e+2]/255,a=Math.log,o=.412453*n+.35758*r+.180423*i,s=.212671*n+.71516*r+.072169*i,n=.019334*n+.119193*r+.950227*i,r=a(.9465229*o+.2946927*s-.1313419*n),i=a(-.1179179*o+.992996*s+.007371554*n),a=a(.09230461*o-.04645794*s+.9946464*n);return t[e+0]=27.07439*r-22.80783*i-1.806681*a,t[e+1]=-5.646736*r-7.722125*i+12.86503*a,t[e+2]=-4.163133*r-4.579428*i-4.576049*a,t},ILL2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2],a=Math.exp,o=a(.021547742011105847*n-.021969518919866274*r-.07027206572176435*i),s=a(-.018152109501074376*n-.03004415376911152*r-.07729896865586937*i),a=a(-.0014378861182725712*n+.050053456205559545*r-.07724195758868482*i),n=1.0068824301911365*o-.2924918682640871*s+.13512537828457516*a,r=.12021888110585245*o+.9717816461525606*s+.008672665360769691*a,i=-.08782494811157235*o+.07253363731909634*s+.9932476695469974*a;return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=0+.299*n+.587*r+.114*i|0,t[e+1]=128-.168736*n-.331264*r+.5*i|0,t[e+2]=128+.5*n-.418688*r-.081312*i|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=n+1.402*(i-128)|0,t[e+1]=n-.34414*(r-128)-.71414*(i-128)|0,t[e+2]=n+1.772*(r-128)|0,t},RGB2HSV:function(t,e,n){var r=Ar(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HSL:function(t,e,n){var r=br(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HWB:function(t,e,n){var r=Rr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},HSV2RGB:function(t,e,n){n=yr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=vr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=wr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,r=t[e+0],i=t[e+1],a=t[e+2];return 0===r&&0===i&&0===a||(n=gt(r=255-r,i=255-i,a=255-a),t[e+0]=(r-n)*(r=255===n?0:255/(255-n)),t[e+1]=(i-n)*r,t[e+2]=(a-n)*r),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:It=1/255,C2P:bt=100/255,P2C:At=2.55,Keywords:E={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(E).map(G).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*bt+(e||"")},per2col:function(t){return t*At},rgb2hex:function(t,e,n,r,i){return i&&(t=h(a(t*At),0,255),e=h(a(e*At),0,255),n=h(a(n*At),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),r&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,r,i){return i&&(t=h(a(t*At),0,255),e=h(a(e*At),0,255),n=h(a(n*At),0,255),r=h(a(r*At),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(r=r<16?"0"+r.toString(16):r.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[h(parseInt(t[0]+t[0],16),0,255),h(parseInt(t[1]+t[1],16),0,255),h(parseInt(t[2]+t[2],16),0,255)]:[h(parseInt(t[0]+t[1],16),0,255),h(parseInt(t[2]+t[3],16),0,255),h(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:vr,hsv2rgb:yr,hwb2rgb:wr,rgb2hsl:br,rgb2hsv:Ar,rgb2hwb:Rr,rgb2cmyk:xr,cmyk2rgb:Sr,parse:function(t,e,n){var r,i,a,o,s,l,u,c,h=0,f=0;return"hsl"===e||!e&&(r=t.match(d.hslRE))?(u=(c=("hsl"===e?(a="hsla"===t[0].toLowerCase(),t[1]):(h=r[0].length,f=0,a="hsla"===r[1].toLowerCase(),r[2])).split(",").map(Ct))[0]||"0",t=c[1]||"0",o=c[2]||"0",l=a&&null!=c[3]?c[3]:"1",u=parseFloat(u,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*bt,o="%"===o.slice(-1)?parseFloat(o,10):parseFloat(o,10)*bt,l=parseFloat(l,10),u=(new d).fromHSL([u,t,o,l]),n?u:[u,0,h+f]):"rgb"===e||!e&&(r=t.match(d.rgbRE))?(o=(c=("rgb"===e?(a="rgba"===t[0].toLowerCase(),t[1]):(h=r[0].length,f=0,a="rgba"===r[1].toLowerCase(),r[2])).split(",").map(Ct))[0]||"0",s=c[1]||"0",i=c[2]||"0",l=a&&null!=c[3]?c[3]:"1",o="%"===o.slice(-1)?2.55*parseFloat(o,10):parseFloat(o,10),s="%"===s.slice(-1)?2.55*parseFloat(s,10):parseFloat(s,10),i="%"===i.slice(-1)?2.55*parseFloat(i,10):parseFloat(i,10),l=parseFloat(l,10),u=(new d).fromRGB([o,s,i,l]),n?u:[u,0,h+f]):"hex"===e||!e&&(r=t.match(d.hexRE))?(a=(c="hex"===e?d.hex2rgb(t[0]):(h=r[0].length,f=0,d.hex2rgb(r[1])))[0]||0,o=c[1]||0,s=c[2]||0,l=null!=c[3]?c[3]:255,u=(new d).fromHEX([a,o,s,l]),n?u:[u,0,h+f]):"keyword"===e||!e&&(r=t.match(d.keywordRE))?(c="keyword"===e?t[0]:(h=r[0].length,f=0,r[1]),u=(new d).fromKeyword(c),n?u:[u,0,h+f]):null},fromString:function(t,e){return d.parse(t,e,1)},fromRGB:function(t){return(new d).fromRGB(t)},fromHSL:function(t){return(new d).fromHSL(t)},fromHSV:function(t){return(new d).fromHSV(t)},fromHWB:function(t){return(new d).fromHWB(t)},fromCMYK:function(t){return(new d).fromCMYK(t)},fromHEX:function(t){return(new d).fromHEX(t)},fromKeyword:function(t){return(new d).fromKeyword(t)},fromPixel:function(t){return(new d).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new d;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=h(t[0],0,255)),null!=t[1]&&(this.col[1]=h(t[1],0,255)),null!=t[2]&&(this.col[2]=h(t[2],0,255)),null!=t[3]?this.col[3]=h(t[3],0,1):this.col[3]=1,this.kword=null),this},isTransparent:function(){return this.col[3]<1},isKeyword:function(){return!!this.kword},fromPixel:function(t){return this.col=[h((t=t||0)>>16&255,0,255),h(t>>8&255,0,255),h(255&t,0,255),h((t>>24&255)*It,0,1)],this.kword=null,this},fromKeyword:function(t){return t=t.toLowerCase(),d.Keywords[t]&&(this.col=d.Keywords[t].slice(),this.kword=t),this},fromHEX:function(t){return this.col[0]=t[0]?h(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?h(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?h(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?h(parseInt(t[3],10)*It,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?h(a(t[0]),0,255):0,this.col[1]=t[1]?h(a(t[1]),0,255):0,this.col[2]=t[2]?h(a(t[2]),0,255):0,this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=Sr(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?h(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=vr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=yr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=wr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?h(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var r=xr(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(t,e,n){return this.kword||this.toHEX(1,e,n)},toHEX:function(t,e,n){return n?d.rgb2hexIE(this.col[0],this.col[1],this.col[2],h(a(255*this.col[3]),0,255)):d.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var r=this.col[3];return t?(e&&(r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var r=this.col[3],i=br(this.col[0],this.col[1],this.col[2]);return t?(e&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toString:function(t,e){return"rgb"==(t=t?t.toLowerCase():"hex")||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):"keyword"==t?this.toKeyword(1):this.toHEX(1,!1!==e,"hexie"==t)}})).toGray=d.intensity,t="prototype",m=L,H=m.CHANNEL,m.Color,Rt=m.Util.Array.copy,xt=m.Util.Array.subarray,St=m.Util.Math.clamp,(Et=Math).min,p=Et.floor,Lt=0,H.R,H.G,H.B,H.A,(Mt=m.Image=m.Class({name:"Image",constructor:function t(e){var n=this;if(!(n instanceof t))return new t(e);n.id=++Lt,n.width=0,n.height=0,n.iCanvas=m.Canvas(0,0),n.oCanvas=m.Canvas(0,0),n.iData=null,n.iDataSel=null,n.oData=null,n.oDataSel=null,n.domElement=n.oCanvas,n._restorable=!0,n.gray=!1,n.selection=null,n._refresh=0,n.nref=0,n._refresh|=15,e&&n.image(e)},id:null,width:0,height:0,gray:!1,selection:null,iCanvas:null,oCanvas:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_refresh:0,nref:0,dispose:function(){var t=this;return t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=null,t._restorable=null,t._refresh=t.nref=null,t},clone:function(t){return new Mt(!0===t?this.iCanvas:this.oCanvas)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,r,i){var a=this,o=arguments.length;return!1===t?(a.selection=null,a.iDataSel=null,a.oDataSel=null,a._refresh&=-13):(o<1&&(t=0),o<2&&(e=0),o<3&&(n=1),o<4&&(r=1),a.selection=i?[t<0?0:t,e<0?0:e,n<0?0:n,r<0?0:r,0]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,r<0?0:1<r?1:r,1],a._refresh|=12),++a.nref,a},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d").drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),++t.nref),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d").drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),++t.nref),t},dimensions:function(t,e,n){var r=this;return r._refresh|=3,r.selection&&(r._refresh|=12),++r.nref,Er(r,t,e,6),r},setDimensions:null,scale:function(t,e){var n,r,i=this,a=i.oCanvas.width,o=i.oCanvas.height;return t=t||1,e=e||t,1===t&&1===e||((r=(n=m.Canvas(a,o)).getContext("2d")).scale(t,e),a=i.width=Et.round(t*i.width),o=i.height=Et.round(e*i.height),r.drawImage(i.oCanvas,0,0),i.oCanvas.width=+a,i.oCanvas.height=+o,i.oCanvas.style&&(i.oCanvas.style.width=String(i.oCanvas.width)+"px",i.oCanvas.style.height=String(i.oCanvas.height)+"px"),i.oCanvas.getContext("2d").drawImage(n,0,0),i._restorable&&(r.drawImage(i.iCanvas,0,0),i.iCanvas.width=i.oCanvas.width,i.iCanvas.height=i.oCanvas.height,i.iCanvas.style&&(i.iCanvas.style.width=i.oCanvas.style.width,i.iCanvas.style.height=i.oCanvas.style.height),i.iCanvas.getContext("2d").drawImage(n,0,0)),i._refresh|=3,i.selection&&(i._refresh|=12),++i.nref),i},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=m.Canvas(e,n),r=n.getContext("2d");return r.translate(e,0),r.scale(-1,1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(n,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),++t.nref,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=m.Canvas(e,n),r=e.getContext("2d");return r.translate(0,n),r.scale(1,-1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(e,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),++t.nref,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d").clearRect(0,0,e,n),t.oCanvas.getContext("2d").clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),++t.nref),t},crop:function(t,e,n,r){var i,a,o,s,l,u=this,c=u.selection,h=u.oCanvas.width,f=u.oCanvas.height;if(arguments.length)s=n-(a=t)+1,l=r-(o=e)+1;else{if(!c)return u;n=c[4]?(i=h-1,f-1):i=1,a=p(c[0]*i),o=p(c[1]*n),s=p(c[2]*i)-a+1,l=p(c[3]*n)-o+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}t=m.Canvas(s,l),r=t.getContext("2d");return r.drawImage(u.oCanvas,a,o,s,l,0,0,s,l),u.oCanvas.width=+s,u.oCanvas.height=+l,u.oCanvas.style&&(u.oCanvas.style.width=String(u.oCanvas.width)+"px",u.oCanvas.style.height=String(u.oCanvas.height)+"px"),u.oCanvas.getContext("2d").drawImage(t,0,0),u._restorable&&(r.drawImage(u.iCanvas,a,o,s,l,0,0,s,l),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.style&&(u.iCanvas.style.width=u.oCanvas.style.width,u.iCanvas.style.height=u.oCanvas.style.height),u.iCanvas.getContext("2d").drawImage(t,0,0)),u.width=s,u.height=l,u._refresh|=3,c&&(u._refresh|=12),++u.nref,u},fill:function(t,e,n,r,i){var a,o,s,l,u=this,c=u.selection,h=u.oCanvas.width,f=u.oCanvas.height,h=((r&&!h||i&&!f)&&(Er(u,e+r,n+i,6),h=u.oCanvas.width,f=u.oCanvas.height),l=c?(l=c[4]?(s=h-1,f-1):s=1,a=p(c[0]*s),o=p(c[1]*l),s=p(c[2]*s)-a+1,p(c[3]*l)-o+1):(o=a=0,s=h,f),null==n&&(n=o),s<(r=null==r?s:r)&&(r=s),l<(i=null==i?l:i)&&(i=l),e=St(e=null==e?a:e,a,s),n=St(n,o,l),u.oCanvas.getContext("2d")),f=u.iCanvas.getContext("2d");return t=t||0,u._restorable&&(f.fillStyle=t,f.fillRect(e,n,r,i)),h.fillStyle=t,h.fillRect(e,n,r,i),u._refresh|=3,c&&(u._refresh|=12),++u.nref,u},draw:function(t,e,n){var r,i,a;return t?(r=this,t instanceof Mt&&(t=t.oCanvas),i="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,a=t instanceof r.oCanvas.constructor,(t instanceof m.Canvas.Image().constructor||a||i)&&(r._restorable&&r.iCanvas.getContext("2d").drawImage(t,0|e,0|n),r.oCanvas.getContext("2d").drawImage(t,0|e,0|n),r._refresh|=3,r.selection&&(r._refresh|=12),++r.nref),r):this},paste:null,getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&Lr(e,1),e.iData):(2&e._refresh&&Lr(e,2),e.oData);return Rt(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&Mr(e,4),e.iDataSel):(8&e._refresh&&Mr(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&Lr(e,1),e.iData):(2&e._refresh&&Lr(e,2),e.oData);return[Rt(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d").putImageData(m.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),++e.nref,e},setSelectedData:function(t){var e,n,r,i,a=this,o=a.selection,s=a.oCanvas.width,l=a.oCanvas.height;return o?(i=o[4]?(r=s-1,l-1):r=1,e=p(o[0]*r),n=p(o[1]*i),r=p(o[2]*r)-e+1,o=p(o[3]*i)-n+1,a.oCanvas.getContext("2d").putImageData(m.Canvas.ImageData(t,r,o),e,n)):a.oCanvas.getContext("2d").putImageData(m.Canvas.ImageData(t,s,l),0,0),a._refresh|=2,a.selection&&(a._refresh|=8),++a.nref,a},image:function(t){var e,n,r,i,a,o;return t?(e=this,t instanceof Mt&&(t=t.oCanvas),i="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,a=t instanceof e.oCanvas.constructor,o=t instanceof m.Canvas.Image().constructor,r=i?(n=t.videoWidth,t.videoHeight):(n=t.width,t.height),Er(e,n,r,6),o||a||i?(e._restorable&&e.iCanvas.getContext("2d").drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d").drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d").putImageData(t,0,0),e.oCanvas.getContext("2d").putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),++e.nref,e):this},setImage:null,getPixel:function(t,e){var n=this,r=n.oCanvas.width,i=n.oCanvas.height;return t<0||r<=t||e<0||i<=e?null:(2&n._refresh&&Lr(n,2),xt(n.oData.data,i=(e*r+t|0)<<2,4+i))},setPixel:function(t,e,n){var r=this,i=r.oCanvas.width,a=r.oCanvas.height;return t<0||i<=t||e<0||a<=e||(r.oCanvas.getContext("2d").putImageData(m.Canvas.ImageData(n,1,1),t,e),r._refresh|=2,r.selection&&(r._refresh|=8),++r.nref),r},getPixelData:function(){return 2&this._refresh&&Lr(this,2),this.oData},setPixelData:function(t){var e=this;return e.oCanvas.getContext("2d").putImageData(t,0,0),e._refresh|=2,e.selection&&(e._refresh|=8),++e.nref,e},toImage:function(n,r){function t(t){var e;"uri"!==r?((e=m.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"]"}}))[t].setImage=Mt[t].image,Mt[t].setDimensions=Mt[t].dimensions,Mt[t].paste=Mt[t].draw,Tt=L,Object.prototype,Function.prototype,e=Array.prototype,Gt=e.slice,Ht=e.splice,Ot=e.push,(e=Tt.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:Tt.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,r=[],i=!1,a=0,o=n.length;a<o;++a)r.push(e=n[a].serializeInputs(t)),e&&(i=!0);return i?r:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,r=0,i=n.length;r<i;++r)t[r]&&n[r].unserializeInputs(t[r],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,r=t.length;n<r;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,r,i,a,o=this,s=o.filters;if(o._stable=t._stable,(n=(i=t.filters||[]).length)===(r=s.length)&&o._stable)for(e=0;e<n;++e)s[e].unserializeFilter(i[e]);else{for(e=0;e<r;++e)s[e]&&s[e].dispose(!0),s[e]=null;for(s=[],e=0;e<n;++e){if(!(a=i[e]&&i[e].filter?Tt.Filter.get(i[e].filter):null))throw new Error('Filter "'+i[e].filter+'" could not be created');s.push((new a).unserializeFilter(i[e]))}o.filters=s}return o},setMetaData:function(t,e){var n,r,i=this.filters;if(t&&t.filters&&(r=t.filters.length)&&i.length)for(n=0;n<r;++n)i[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&Ot.apply(this.filters,arguments),this},concat:null,pop:function(){return this.filters.pop()},shift:function(){return this.filters.shift()},unshift:function(){return arguments.length&&Ht.apply(this.filters,Ot.apply([0,0],arguments)),this},insertAt:function(t){var e=Gt.call(arguments);e.length;return 1<argslen&&(e.shift(),Ht.apply(this.filters,[t,0].concat(e))),this},removeAt:function(t){return this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this},reset:function(){return this.filters.length=0,this},empty:null,_apply:function(t,e,n,r){var i=this,a=null,o=0,s=null,l=null;if(i.filters.length){r=r||{};for(var u,c=i.filters,h=c.length,a=new Array(h),f=0;f<h;++f)(u=c[f])&&u._isOn&&(r.container=i,r.index=f,t=u._apply(t,e,n,r),u.hasMeta)&&(a[o++]=[f,u=u.metaData()],null!=u._IMG_WIDTH)&&(s=e=u._IMG_WIDTH,l=n=u._IMG_HEIGHT)}return 0<o?(a.length>o&&(a.length=o),i.hasMeta=!0,i.meta={filters:a},null!=s&&(i.meta._IMG_WIDTH=s,i.meta._IMG_HEIGHT=l)):(i.hasMeta=!1,i.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,r=0;r<n;++r)e.push("\t"+t[r].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=e.prototype.filter,e.prototype.empty=e.prototype.reset,e.prototype.concat=e.prototype.push,Tt.CompositionFilter=Tt.CompositeFilter,i=L,Nt=i.Util.Array.copy,Ft=Math,Dt=Ft.min,Bt=Ft.round,Yt=i._notSupportClamp,kt=i.Color.clampPixel,i.Create({name:"BlendFilter",init:function(t){this.set(t)},path:i.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),void 0!==e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this},_apply:function(t,e,n){var r=this.matrix;if(!r||!r.length)return t;for(var i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x,S,E,L,M,T,G,H,F=r.length,O=(t.length,Nt(t)),N=0,D=1;N<F;N+=4,++D)if(r[N+3]&&(A=r[N]||"normal",b=Ut[A])&&(m=this.input(D))&&(f=m[0],d=m[1],m=m[2],(o=r[N+1]||0)<(u=l=0)&&(l=-o,o=0),(s=r[N+2]||0)<0&&(u=-s,s=0),!(e<=o||n<=s||d<=l||m<=u||(o=Bt(o),s=Bt(s),l=Bt(l),u=Bt(u),c=Dt(e-o,d-l),h=Dt(n-s,m-u),c<=0)||h<=0)))if(y=s*e,I=u*d,p=(v=o)+c,g=(w=l)+c,Yt)for(_=0,C=h*c;_<C;++_)R=O[i=v+y<<2],x=O[i+1],S=O[i+2],E=O[i+3]/255,L=f[a=w+I<<2],M=f[a+1],T=f[a+2],G=f[a+3]/255,0<(H="normal"===A?G+E*(1-G):G+E-G*E)?(O[i]=kt(Bt(255*b(E*R/255,E,G*L/255,G)/H)),O[i+1]=kt(Bt(255*b(E*x/255,E,G*M/255,G)/H)),O[i+2]=kt(Bt(255*b(E*S/255,E,G*T/255,G)/H)),O[i+3]=kt(Bt(255*H))):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++v>=p&&(v=o,y+=e),++w>=g&&(w=l,I+=d);else for(_=0,C=h*c;_<C;++_)R=O[i=v+y<<2],x=O[i+1],S=O[i+2],E=O[i+3]/255,L=f[a=w+I<<2],M=f[a+1],T=f[a+2],G=f[a+3]/255,0<(H="normal"===A?G+E*(1-G):G+E-G*E)?(O[i]=Bt(255*b(E*R/255,E,G*L/255,G)/H),O[i+1]=Bt(255*b(E*x/255,E,G*M/255,G)/H),O[i+2]=Bt(255*b(E*S/255,E,G*T/255,G)/H),O[i+3]=Bt(255*H)):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++v>=p&&(v=o,y+=e),++w>=g&&(w=l,I+=d);return O}}),i.CombineFilter=i.BlendFilter,(Ut=i.Color.Blend={normal:function(t,e,n,r){return n+t*(1-r)},multiply:function(t,e,n,r){return n*t+n*(1-e)+t*(1-r)},screen:function(t,e,n,r){return n+t-n*t},overlay:function(t,e,n,r){return 2*t<=e?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-2*t*n-e*r},darken:function(t,e,n,r){return Ft.min(n*e,t*r)+n*(1-e)+t*(1-r)},lighten:function(t,e,n,r){return Ft.max(n*e,t*r)+n*(1-e)+t*(1-r)},"color-dodge":function(t,e,n,r){return n===r&&0===t?n*(1-e):n===r?r*e+n*(1-e)+t*(1-r):r*e*Ft.min(1,t/e*r/(r-n))+n*(1-e)+t*(1-r)},"color-burn":function(t,e,n,r){return 0===n&&t===e?r*e+t*(1-r):0===n?t*(1-r):r*e*(1-Ft.min(1,(1-(e?t/e:0))*r/n))+n*(1-e)+t*(1-r)},"hard-light":function(t,e,n,r){return 2*n<=r?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-r*e-2*n*t},"soft-light":function(t,e,n,r){var i=e?t/e:0;return 2*n<=r?t*(r+(2*n-r)*(1-i))+n*(1-e)+t*(1-r):r<2*n&&4*t<=e?e*(2*n-r)*(16*Ft.pow(i,3)-12*Ft.pow(i,2)-3*i)+n-n*e+t:e*(2*n-r)*(Ft.pow(i,.5)-i)+n-n*e+t},difference:function(t,e,n,r){return n+t-2*Ft.min(n*e,t*r)},exclusion:function(t,e,n,r){return n*e+t*r-2*n*t+n*(1-e)+t*(1-r)},average:function(t,e,n,r){return(n+t)/2},add:function(t,e,n,r){return Ft.min(1,n+t)},subtract:function(t,e,n,r){return Ft.max(0,t+n-1)},negation:function(t,e,n,r){return 1-Ft.abs(1-n-t)},"linear-light":function(t,e,n,r){return n<.5?Ut.subtract(t,e,2*n,r):Ut.add(t,e,2*(1-n),r)}})["linear-dodge"]=Ut.add,Ut["linear-burn"]=Ut.subtract,$t=L,g=Math,Pt=$t.Util.Image.crop,Xt=$t.Util.Image.pad,zt=$t.Util.Image.interpolate,$t.Create({name:"DimensionFilter",init:function(t,e,n,r,i){this.set(t,e,n,r,i)},path:$t.Path,mode:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!1,dispose:function(){return this.mode=null,this.$super("dispose"),this},serialize:function(){var t=this;return{mode:t.mode,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.mode,t.a,t.b,t.c,t.d),this},metaData:function(t){return this.meta},setMetaData:function(t,e){return this},set:function(t,e,n,r,i){var a=this;return t?(a.mode=String(t||"scale").toLowerCase(),a.a=e||0,a.b=n||0,a.c=r||0,a.d=i||0):(a.mode=null,a.a=0,a.b=0,a.c=0,a.d=0),a},reset:function(){return this.set(null)},_apply:function(t,e,n,r){var i=this,a=i.mode,o=i.a,s=i.b,l=i.c,u=i.d;if(i.meta=null,i.hasMeta=!1,a)switch(a){case"set":s=l&&u?(o=g.round(l*e),g.round(u*n)):(o=g.round(o),g.round(s)),t=new $t.ImArray(o*s<<2),i.meta={_IMG_WIDTH:o,_IMG_HEIGHT:s},i.hasMeta=!0;break;case"pad":o=g.round(o),s=g.round(s),l=g.round(l),u=g.round(u),t=Xt(t,e,n,l,u,o,s),i.meta={_IMG_WIDTH:s+u+n,_IMG_HEIGHT:o+l+e},i.hasMeta=!0;break;case"crop":o=g.round(o),s=g.round(s),l=g.round(l),u=g.round(u),t=Pt(t,e,n,o,s,o+l-1,s+u-1),i.meta={_IMG_WIDTH:l,_IMG_HEIGHT:u},i.hasMeta=!0;break;default:s=l&&u?(o=g.round(l*e),g.round(u*n)):(o=g.round(o),g.round(s)),t=zt(t,e,n,o,s),i.meta={_IMG_WIDTH:o,_IMG_HEIGHT:s},i.hasMeta=!0}return t}}),_=(Wt=L).CHANNEL,jt=Wt.ColorTable,qt=Wt.Color.clampPixel,(w=Math).floor,Vt=w.pow,Kt=w.exp,Qt=1/255,Zt=Wt.Util.Array.typed,l=Wt.Util.Filter.ct_eye,Jt=Wt.Util.Filter.ct_multiply,(w=Wt.Create({name:"ColorTableFilter",init:function(t,e,n,r){var i=this;i.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,i.table[_.R]=t,i.table[_.G]=e,i.table[_.B]=n,i.table[_.A]=r},path:Wt.Path,table:null,dispose:function(){return this.table=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[_.R],tableG:this.table[_.G],tableB:this.table[_.B],tableA:this.table[_.A]}},unserialize:function(t){var e=this;return e.table[_.R]=Zt(t.tableR,jt),e.table[_.G]=Zt(t.tableG,jt),e.table[_.B]=Zt(t.tableB,jt),e.table[_.A]=Zt(t.tableA,jt),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=l(t),e=e?l(e):t,n=n?l(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=l(0,0),n=l(0,0),r=l();break;case _.G:e=l(0,0),n=l(),r=l(0,0);break;default:_.R;e=l(),n=l(0,0),r=l(0,0)}return this.set(e,n,r)},redChannel:function(){return this.channel(_.R)},greenChannel:function(){return this.channel(_.G)},blueChannel:function(){return this.channel(_.B)},channelInvert:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=l(),n=l(),r=l(-1,255);break;case _.G:e=l(),n=l(-1,255),r=l();break;default:_.R;e=l(-1,255),n=l(),r=l()}return this.set(e,n,r)},redInvert:function(){return this.channelInvert(_.R)},greenInvert:function(){return this.channelInvert(_.G)},blueInvert:function(){return this.channelInvert(_.B)},invert:function(){return this.set(Wt.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var r,i=(t=t.length?t:[t]).length,a=i+1,o=(e=e||t).length,s=o+1,l=(n=n||e).length,u=l+1,c=new jt(256),h=new jt(a),f=new jt(256),d=new jt(s),m=new jt(256),p=new jt(u),g=255/(a-1),_=255/(s-1),C=255/(u-1),v=0;v<a;++v)h[v]=g*v|0;for(t[0]=255*t[0]|0,v=1;v<i;++v)t[v]=t[v-1]+255*t[v]|0;for(v=0;v<s;++v)d[v]=_*v|0;for(e[0]=255*e[0]|0,v=1;v<o;++v)e[v]=e[v-1]+255*e[v]|0;for(v=0;v<u;++v)p[v]=C*v|0;for(n[0]=255*n[0]|0,v=1;v<l;++v)n[v]=n[v-1]+255*n[v]|0;for(v=0;v<256;++v){for(r=0;r<i&&v>t[r];)++r;for(c[v]=qt(h[r]),r=0;r<o&&v>e[r];)++r;for(f[v]=qt(d[r]),r=0;r<l&&v>n[r];)++r;m[v]=qt(p[r])}return this.set(c,f,m)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){for(var e=new jt(t=(t=null==t?64:t)<2?2:t),n=255/(t-1),r=t/256,i=0;i<t;++i)e[i]=0|qt(n*i);return this.set(l(function(t){return e[r*t|0]}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(l(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,r=255&t;return this.set(l(function(t){return t&e}),l(function(t){return t&n}),l(function(t){return t&r}))},replace:function(t,e){var n,r,i;return t==e?this:(n=l(),r=l(),i=l(),n[t>>>16&255]=e>>>16&255,r[t>>>8&255]=e>>>8&255,i[255&t]=255&e,this.set(n,r,i))},extract:function(t,e,n){if(!e||!e.length)return this;var r=l(0,(n=n||0)>>>16&255),i=l(0,n>>>8&255),a=l(0,255&n);switch(t||_.R){case _.B:for(s=e[0],f=e[1];s<=f;++s)a[s]=qt(s);break;case _.G:for(s=e[0],f=e[1];s<=f;++s)i[s]=qt(s);break;default:_.R;for(s=e[0],f=e[1];s<=f;++s)r[s]=qt(s)}return this.set(r,i,a)},gammaCorrection:function(e,n,r){return e=e||1,n=n||e,r=r||n,e=1/e,n=1/n,r=1/r,this.set(l(function(t){return 255*Vt(Qt*t,e)}),l(function(t){return 255*Vt(Qt*t,n)}),l(function(t){return 255*Vt(Qt*t,r)}))},exposure:function(e){return null==e&&(e=1),this.set(l(function(t){return 255*(1-Kt(-e*t*Qt))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(l(t+=1,128*(1-t)),l(e,128*(1-e)),l(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(l(1,t),l(1,e),l(1,n))},quickContrastCorrection:function(t){return this.set(l(null==t?1.2:+t))},set:function(t,e,n,r){var i,a,o,s;return t&&(a=(i=this.table)[_.R]||l(),e||n?(e=e||t,n=n||e,o=i[_.G]||a,s=i[_.B]||o,i[_.R]=Jt(t,a),i[_.G]=Jt(e,o),i[_.B]=Jt(n,s)):(i[_.R]=Jt(t,a),i[_.G]=i[_.R],i[_.B]=i[_.R])),this},reset:function(){return this.table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(_.R),t.getTable(_.G),t.getTable(_.B))},getTable:function(t){return this.table[t||_.R]||null},setTable:function(t,e){return this.table[e||_.R]=t||null,this},_apply:function(t,e,n){var r=this.table;if(r&&r[_.R]){var i,a,o=t.length,s=(15&o>>>2)<<2,l=r[0],u=r[1],c=r[2],h=r[3];if(h){for(i=0;i<s;i+=4)t[i]=l[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]],t[i+3]=h[t[i+3]];for(a=s;a<o;a+=64)t[i=a]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]],t[i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=h[t[i++]]}else{for(i=0;i<s;i+=4)t[i]=l[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]];for(a=s;a<o;a+=64)t[i=a]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=l[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],++i}}return t},canRun:function(){return this._isOn&&this.table&&this.table[_.R]}})).prototype.posterize=w.prototype.levels=w.prototype.quantize,Wt.TableLookupFilter=Wt.ColorTableFilter,C=(o=L).CHANNEL,te=o.ColorMatrix,ee=o.Array8U,b=Math,ne=b.sin,re=b.cos,ie=o.CONST.toRad,o.CONST.toDeg,ae=o.Util.Array.typed,b=o._notSupportClamp,v=o.Util.Filter.cm_rechannel,oe=o.Util.Filter.cm_combine,se=o.Util.Filter.cm_multiply,(b=o.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new te(t):null},path:o.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=ae(t.matrix,te),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=C.A===(t=t||0)||e?1:0;return n[5*C.R+t]=C.R===t?1:e,n[5*C.G+t]=C.G===t?1:e,n[5*C.B+t]=C.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(C.R,t)},greenChannel:function(t){return this.channel(C.G,t)},blueChannel:function(t){return this.channel(C.B,t)},alphaChannel:function(t){return this.channel(C.A,!0)},maskChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(C.R)},invertGreen:function(){return this.invertChannel(C.G)},invertBlue:function(){return this.invertChannel(C.B)},invertAlpha:function(){return this.invertChannel(C.A)},invert:function(){return this.set(v([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},desaturate:function(t){t=t||o.LUMA;return this.set(v([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},grayscale:null,saturate:function(t,e){var e=e||o.LUMA,n=1-t,r=n*e[0],i=n*e[1],n=n*e[2];return this.set(v([r+t,i,n,0,0,r,i+t,n,0,0,r,i,n+t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},colorize:function(t,e,n){var r,i,n=n||o.LUMA;return this.set(v([(i=1-(e=null==e?1:e))+e*(r=(t>>16&255)/255)*n[0],e*r*n[1],e*r*n[2],0,0,e*(r=(t>>8&255)/255)*n[0],i+e*r*n[1],e*r*n[2],0,0,e*(r=(255&t)/255)*n[0],e*r*n[1],i+e*r*n[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(v([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},brightness:function(t,e,n){return this.set(v([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},adjustHue:function(t,e){var n=re(t*=ie),t=ne(t),e=e||o.LUMA;return this.set(v([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},rotateHue:null,average:function(t,e,n){return this.set(v([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},quickContrastCorrection:function(t){return this.set(v([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set(v([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||o.LUMA;return this.set(v([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},threshold:function(t,e,n){null==e&&(e=256);var r=n||o.LUMA;return this.set(v(!1!==n?[r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,r){null==n&&(n=256);var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=r||o.LUMA;return C.A===t?(i[5*t+t]=n,i[5*t+4]=-n*e):(!1!==r?(i[5*t+C.R]=a[0]*n,i[5*t+C.G]=a[1]*n,i[5*t+C.B]=a[2]*n):(i[5*t+C.R]=n,i[5*t+C.G]=n,i[5*t+C.B]=n),i[5*t+4]=-(n-1)*e),this.set(i)},thresholdRed:function(t,e,n){return this.thresholdChannel(C.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(C.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(C.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(C.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set(v([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.XX,C.YY,C.ZZ,C.A))},XYZ2RGB:function(){return this.set(v([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],C.XX,C.YY,C.ZZ,C.A,C.R,C.G,C.B,C.A))},RGB2YCbCr:function(){return this.set(v([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.CB,C.CR,C.A))},YCbCr2RGB:function(){return this.set(v([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],C.Y,C.CB,C.CR,C.A,C.R,C.G,C.B,C.A))},RGB2YIQ:function(){return this.set(v([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.IP,C.Q,C.A))},YIQ2RGB:function(){return this.set(v([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],C.Y,C.IP,C.Q,C.A,C.R,C.G,C.B,C.A))},blend:function(t,e){return this.matrix=this.matrix?oe(this.matrix,t.matrix,1-e,e,te):new te(t.matrix),this},set:function(t){return this.matrix=this.matrix?se(this.matrix,t):new te(t),this},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:b?function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new te(32),s=new ee(4),l=new te(4),u=0;u<a;u+=4)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],l[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],l[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],l[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],l[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],l[0]=l[0]<0?0:255<l[0]?255:l[0],l[1]=l[1]<0?0:255<l[1]?255:l[1],l[2]=l[2]<0?0:255<l[2]?255:l[2],l[3]=l[3]<0?0:255<l[3]?255:l[3],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3];for(u=a;u<i;u+=32)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],o[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+4],s[1]=t[u+5],s[2]=t[u+6],s[3]=t[u+7],o[4]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[5]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[6]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[7]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+8],s[1]=t[u+9],s[2]=t[u+10],s[3]=t[u+11],o[8]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[9]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[10]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[11]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+12],s[1]=t[u+13],s[2]=t[u+14],s[3]=t[u+15],o[12]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[13]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[14]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[15]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+16],s[1]=t[u+17],s[2]=t[u+18],s[3]=t[u+19],o[16]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[17]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[18]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[19]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+20],s[1]=t[u+21],s[2]=t[u+22],s[3]=t[u+23],o[20]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[21]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[22]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[23]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+24],s[1]=t[u+25],s[2]=t[u+26],s[3]=t[u+27],o[24]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[25]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[26]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[27]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+28],s[1]=t[u+29],s[2]=t[u+30],s[3]=t[u+31],o[28]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[29]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[30]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[31]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],o[0]=o[0]<0?0:255<o[0]?255:o[0],o[1]=o[1]<0?0:255<o[1]?255:o[1],o[2]=o[2]<0?0:255<o[2]?255:o[2],o[3]=o[3]<0?0:255<o[3]?255:o[3],o[4]=o[4]<0?0:255<o[4]?255:o[4],o[5]=o[5]<0?0:255<o[5]?255:o[5],o[6]=o[6]<0?0:255<o[6]?255:o[6],o[7]=o[7]<0?0:255<o[7]?255:o[7],o[8]=o[8]<0?0:255<o[8]?255:o[8],o[9]=o[9]<0?0:255<o[9]?255:o[9],o[10]=o[10]<0?0:255<o[10]?255:o[10],o[11]=o[11]<0?0:255<o[11]?255:o[11],o[12]=o[12]<0?0:255<o[12]?255:o[12],o[13]=o[13]<0?0:255<o[13]?255:o[13],o[14]=o[14]<0?0:255<o[14]?255:o[14],o[15]=o[15]<0?0:255<o[15]?255:o[15],o[16]=o[16]<0?0:255<o[16]?255:o[16],o[17]=o[17]<0?0:255<o[17]?255:o[17],o[18]=o[18]<0?0:255<o[18]?255:o[18],o[19]=o[19]<0?0:255<o[19]?255:o[19],o[20]=o[20]<0?0:255<o[20]?255:o[20],o[21]=o[21]<0?0:255<o[21]?255:o[21],o[22]=o[22]<0?0:255<o[22]?255:o[22],o[23]=o[23]<0?0:255<o[23]?255:o[23],o[24]=o[24]<0?0:255<o[24]?255:o[24],o[25]=o[25]<0?0:255<o[25]?255:o[25],o[26]=o[26]<0?0:255<o[26]?255:o[26],o[27]=o[27]<0?0:255<o[27]?255:o[27],o[28]=o[28]<0?0:255<o[28]?255:o[28],o[29]=o[29]<0?0:255<o[29]?255:o[29],o[30]=o[30]<0?0:255<o[30]?255:o[30],o[31]=o[31]<0?0:255<o[31]?255:o[31],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t}:function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new te(32),s=new ee(4),l=new te(4),u=0;u<a;u+=4)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],l[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],l[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],l[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],l[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3];for(u=a;u<i;u+=32)s[0]=t[u],s[1]=t[u+1],s[2]=t[u+2],s[3]=t[u+3],o[0]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[1]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[2]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[3]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+4],s[1]=t[u+5],s[2]=t[u+6],s[3]=t[u+7],o[4]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[5]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[6]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[7]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+8],s[1]=t[u+9],s[2]=t[u+10],s[3]=t[u+11],o[8]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[9]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[10]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[11]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+12],s[1]=t[u+13],s[2]=t[u+14],s[3]=t[u+15],o[12]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[13]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[14]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[15]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+16],s[1]=t[u+17],s[2]=t[u+18],s[3]=t[u+19],o[16]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[17]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[18]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[19]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+20],s[1]=t[u+21],s[2]=t[u+22],s[3]=t[u+23],o[20]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[21]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[22]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[23]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+24],s[1]=t[u+25],s[2]=t[u+26],s[3]=t[u+27],o[24]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[25]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[26]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[27]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],s[0]=t[u+28],s[1]=t[u+29],s[2]=t[u+30],s[3]=t[u+31],o[28]=r[0]*s[0]+r[1]*s[1]+r[2]*s[2]+r[3]*s[3]+r[4],o[29]=r[5]*s[0]+r[6]*s[1]+r[7]*s[2]+r[8]*s[3]+r[9],o[30]=r[10]*s[0]+r[11]*s[1]+r[12]*s[2]+r[13]*s[3]+r[14],o[31]=r[15]*s[0]+r[16]*s[1]+r[17]*s[2]+r[18]*s[3]+r[19],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=b.prototype.desaturate,b.prototype.rotateHue=b.prototype.adjustHue,b.prototype.threshold_rgb=b.prototype.thresholdRGB,b.prototype.threshold_alpha=b.prototype.thresholdAlpha,le=L,A=le.MODE,le.Color,le.ColorMatrix,ce=le.Util.Array.typed,he=le._notSupportClamp,fe=le.Util.String.function_body,de=Object.prototype.hasOwnProperty,Function.prototype.toString,(A=le.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:le.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:A.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?t._map.toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=ce(t.thresholds,Array),e.quantizedColors=ce(t.quantizedColors,Array),!t._map&&t._mapName&&de.call(ue,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},RGB2ILL:function(){return this.set("rgb2ill")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&de.call(ue,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=ue[n._mapName],n._mapInit=ue["init__"+n._mapName],n._apply=Tr(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=Tr(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=A.prototype.quantize,A.prototype.extract=A.prototype.mask,ue={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},me=L.ImArray,pe=L.AffineMatrix,ge=L.Util.Array.typed,_e=L.MODE,L.CONST.toRad,R=Math,Ce=R.sin,ve=R.cos,ye=R.tan,we=L.Util.Filter.am_multiply,(R=L.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new pe(t):null},path:L.Path,matrix:null,mode:_e.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=ge(t.matrix,pe),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=Ce(t),t=ve(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?ye(t):0,0,0,e?ye(e):0,1,0,0])},set:function(t){return this.matrix=this.matrix?we(this.matrix,t):new pe(t),this},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this.matrix;if(!r)return t;var i,a,o,s,l,u,c,h,f,d,m,p=t.length,g=p>>>2,_=e-1,C=g-e,v=new me(p),y=this.color||0,w=_e.COLOR,I=(_e.CLAMP,_e.WRAP),b=_e.IGNORE,A=r[0],R=r[1],x=r[2]+r[3]*_,S=r[4]*e,E=r[5],L=r[6]*e+r[7]*C,r=this.mode||b;if(w===r)for(m=y>>>24&255,h=y>>>16&255,f=y>>>8&255,d=255&y,u=o=a=i=0;u<p;u+=4,++i)e<=i&&(i=0,++a,o+=e),l=S*i+E*o+L,(s=A*i+R*a+x)<0||_<s||l<0||C<l?(v[u]=h,v[u+1]=f,v[u+2]=d,v[u+3]=m):(v[u]=t[c=(0|s)+(0|l)<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3]);else if(b===r)for(u=o=a=i=0;u<p;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(s=_<(s=A*i+R*a+x)||s<0?i:s))+(0|(l=C<(l=S*i+E*o+L)||l<0?o:l))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];else if(I===r)for(u=o=a=i=0;u<p;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(s=_<(s=A*i+R*a+x)?s-e:s<0?s+e:s))+(0|(l=C<(l=S*i+E*o+L)?l-g:l<0?l+g:l))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];else for(u=o=a=i=0;u<p;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(s=_<(s=A*i+R*a+x)?_:s<0?0:s))+(0|(l=C<(l=S*i+E*o+L)?C:l<0?0:l))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];return v},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=R.prototype.translate,be=(Ie=L).MODE,Ie.Util.Array.typed,E=Math,Ae=E.min,E.max,V=E.floor,Ie.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:Ie.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:be.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},_apply:function(t,e,n){var r=this,i=r.input("map");if(i){for(var F,D,B,Y,a,o,s,l,u,c,h,f,d,m=r.color||0,p=e-1,g=n-1,_=.00390625*r.scaleX,C=.00390625*r.scaleY,v=r.componentX,y=r.componentY,k=be.IGNORE,U=(be.CLAMP,be.COLOR),$=be.WRAP,P=r.mode||k,X=(Ie.ImArray,Ie.Util.Array.copy),z=Ie.Array16I,w=i[0],I=i[1],i=i[2],W=w.length,j=W>>>2,b=Ae(I,e),A=b*Ae(i,n)<<2,R=(t.length,V(r.startX*p)),x=V(r.startY*g),S=x*e,E=-R,L=-x,M=p-R,T=g-x,G=new z(j<<1),H=X(t),q=(15&j)<<2,O=0,N=0;N<q;N+=4)G[O++]=V((w[N+v]-128)*_),G[O++]=V((w[N+y]-128)*C);for(N=q;N<W;N+=64)G[O++]=V((w[N+v]-128)*_),G[O++]=V((w[N+y]-128)*C),G[O++]=V((w[N+4+v]-128)*_),G[O++]=V((w[N+4+y]-128)*C),G[O++]=V((w[N+8+v]-128)*_),G[O++]=V((w[N+8+y]-128)*C),G[O++]=V((w[N+12+v]-128)*_),G[O++]=V((w[N+12+y]-128)*C),G[O++]=V((w[N+16+v]-128)*_),G[O++]=V((w[N+16+y]-128)*C),G[O++]=V((w[N+20+v]-128)*_),G[O++]=V((w[N+20+y]-128)*C),G[O++]=V((w[N+24+v]-128)*_),G[O++]=V((w[N+24+y]-128)*C),G[O++]=V((w[N+28+v]-128)*_),G[O++]=V((w[N+28+y]-128)*C),G[O++]=V((w[N+32+v]-128)*_),G[O++]=V((w[N+32+y]-128)*C),G[O++]=V((w[N+36+v]-128)*_),G[O++]=V((w[N+36+y]-128)*C),G[O++]=V((w[N+40+v]-128)*_),G[O++]=V((w[N+40+y]-128)*C),G[O++]=V((w[N+44+v]-128)*_),G[O++]=V((w[N+44+y]-128)*C),G[O++]=V((w[N+48+v]-128)*_),G[O++]=V((w[N+48+y]-128)*C),G[O++]=V((w[N+52+v]-128)*_),G[O++]=V((w[N+52+y]-128)*C),G[O++]=V((w[N+56+v]-128)*_),G[O++]=V((w[N+56+y]-128)*C),G[O++]=V((w[N+60+v]-128)*_),G[O++]=V((w[N+60+y]-128)*C);if(U===P)for(F=m>>>24&255,D=m>>>16&255,B=m>>>8&255,Y=255&m,N=l=s=o=a=0;N<A;N+=4,++a)b<=a&&(a=0,++o,s+=e,l+=I),o<L||T<o||a<E||M<a||(c=(u=a+R)+s+S<<2,f=u+G[O=a+l<<1],g<(d=o+x+G[O+1])||d<0||p<f||f<0?(t[c]=D,t[c+1]=B,t[c+2]=Y,t[c+3]=F):(t[c]=H[h=f+d*e<<2],t[c+1]=H[h+1],t[c+2]=H[h+2],t[c+3]=H[h+3]));else if(k===P)for(N=l=s=o=a=0;N<A;N+=4,++a)b<=a&&(a=0,++o,s+=e,l+=I),o<L||T<o||a<E||M<a||(c=(u=a+R)+s+S<<2,f=u+G[O=a+l<<1],g<(d=o+x+G[O+1]))||d<0||p<f||f<0||(t[c]=H[h=f+d*e<<2],t[c+1]=H[h+1],t[c+2]=H[h+2],t[c+3]=H[h+3]);else if($===P)for(N=l=s=o=a=0;N<A;N+=4,++a)b<=a&&(a=0,++o,s+=e,l+=I),o<L||T<o||a<E||M<a||(f=(u=a+R)+G[O=a+l<<1],d=o+x+G[O+1],t[c=u+s+S<<2]=H[h=(f=p<f?f-e:f<0?f+e:f)+(d=g<d?d-n:d<0?d+n:d)*e<<2],t[c+1]=H[h+1],t[c+2]=H[h+2],t[c+3]=H[h+3]);else for(N=l=s=o=a=0;N<A;N+=4,++a)b<=a&&(a=0,++o,s+=e,l+=I),o<L||T<o||a<E||M<a||(f=(u=a+R)+G[O=a+l<<1],d=o+x+G[O+1],t[c=u+s+S<<2]=H[h=(f=p<f?p:f<0?0:f)+(d=g<d?g:d<0?0:d)*e<<2],t[c+1]=H[h+1],t[c+2]=H[h+2],t[c+3]=H[h+3])}return t}});var Gr,Hr=L,G=Hr.MODE,Or=Hr.Util.String.function_body,H=Math,Nr=H.floor,Fr=H.sqrt,Dr=H.atan2,Br=H.sin,Yr=H.cos,kr=H.max,Ur=(H.min,2*H.PI),$r=Hr.Util.Math.clamp,Pr=[0,0,0,0],Xr=Object.prototype.hasOwnProperty;function zr(t,e){e=e?Or(e):"",t=Or(t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(Hr)}function Wr(t,e,n,r,i,a,o){for(var s=Nr(n),l=Nr(r),u=s<0||l<0||a<=s||o<=l?Pr:[i[d=s+l*a<<2],i[d+1],i[d+2],i[d+3]],c=s<0||l+1<0||a<=s||o<=l+1?Pr:[i[d=s+(l+1)*a<<2],i[d+1],i[d+2],i[d+3]],h=s+1<0||l<0||a<=s+1||o<=l?Pr:[i[d=s+1+l*a<<2],i[d+1],i[d+2],i[d+3]],f=s+1<0||l+1<0||a<=s+1||o<=l+1?Pr:[i[d=s+1+(l+1)*a<<2],i[d+1],i[d+2],i[d+3]],d=0;d<3;++d)t[e+d]=$r(Nr((s+1-n)*(l+1-r)*u[d]+(n-s)*(l+1-r)*h[d]+(s+1-n)*(r-l)*c[d]+(n-s)*(r-l)*f[d]),0,255)}function jr(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n];return e}function qr(t,e){for(var n=[],r=[],i=[],a=t.length,o=e,s=o>>>1,l=0,u=0,c=0;c<a;)r.push(l-s),r.push(u-s),t[c]&&(n.push(l-s),n.push(u-s),i.push(t[c])),++c,o<=++l&&(l=0,++u);return[new Ee(n),new Ee(r),new xe(i)]}function Vr(t,e){for(var n=new Array(t),r=0,i=0;i<t;++i,++r)n[i]=e(r,0,t);return n}function Kr(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function Qr(t,e){var n,r=t>>>1,i=new Array(t);if(e)for(n=0;n<t;++n)i[t-1-n]=n-r;else for(n=0;n<t;++n)i[n]=n-r;return i}function Zr(t){var e,n,r,i,a=Pe.length;if(--t<a)e=Pe[t];else for(e=Pe[a-1];a<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,r=0,i=n.length-1;r<i;++r)e[r+1]=n[r]+n[r+1];e[n.length]=1,a<20&&Pe.push(e),++a}return e.slice()}function Jr(t,e){return 1===e?Le(Qr(t,1),Zr(t)):Le(Zr(t),Qr(t,0))}function t1(t,e){return 1===e?Le(Qr(t,1),Kr(t)):Le(Kr(t),Qr(t,0))}function e1(t,e,n){e=e||1,n=n||e;for(var r=t*t,i=new xe(r),a=0;a<t;++a)i[a]=e;return i[r>>>1]=n,i}function n1(t){for(var e=t*t,n=new Ve(e),r=0;r<e;++r)n[r]=1;return n}function r1(t,e,n,r,i,a,o,s,l,u,c){var h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x=e.length,S=r-1,E=(x>>>a)-r,L=e;if(e=n,n=L,Xe.MODE.GRAY===t){for(R=o.length,h=0;h<c;++h)for(L=e,e=n,n=L,m=d=f=0;m<x;m+=4,++f){for(r<=f&&(f=0,d+=r),g=u,p=0;p<R;p+=2)I=f+o[p],b=d+o[p+1],I<0||S<I||b<0||E<b||(g=l(v=e[A=I+b<<2],g));n[m]=g,n[m+1]=g,n[m+2]=g,n[m+3]=e[m+3]}if(s)for(R=(o=s).length,h=0;h<c;++h)for(L=e,e=n,n=L,m=d=f=0;m<x;m+=4,++f){for(r<=f&&(f=0,d+=r),g=u,p=0;p<R;p+=2)I=f+o[p],b=d+o[p+1],I<0||S<I||b<0||E<b||(g=l(v=e[A=I+b<<2],g));n[m]=g,n[m+1]=g,n[m+2]=g,n[m+3]=e[m+3]}}else{for(R=o.length,h=0;h<c;++h)for(L=e,e=n,n=L,m=d=f=0;m<x;m+=4,++f){for(r<=f&&(f=0,d+=r),g=_=C=u,p=0;p<R;p+=2)I=f+o[p],b=d+o[p+1],I<0||S<I||b<0||E<b||(v=e[A=I+b<<2],y=e[A+1],w=e[A+2],g=l(v,g),_=l(y,_),C=l(w,C));n[m]=g,n[m+1]=_,n[m+2]=C,n[m+3]=e[m+3]}if(s)for(R=(o=s).length,h=0;h<c;++h)for(L=e,e=n,n=L,m=d=f=0;m<x;m+=4,++f){for(r<=f&&(f=0,d+=r),g=_=C=u,p=0;p<R;p+=2)I=f+o[p],b=d+o[p+1],I<0||S<I||b<0||E<b||(v=e[A=I+b<<2],y=e[A+1],w=e[A+2],g=l(v,g),_=l(y,_),C=l(w,C));n[m]=g,n[m+1]=_,n[m+2]=C,n[m+3]=e[m+3]}}}function i1(t,e,n){t[e]=n,o1(t,0,e)}function a1(t,e){var n,r=t[e-1];if(e-1){n=t[0],t[0]=r;var i,a,o=t,s=0,l=t=e-1,t=s,e=o[s];for(i=2*s+1;i<l;)(a=i+1)<l&&o[i]>=o[a]&&(i=a),o[s]=o[i],i=2*(s=i)+1;return o[s]=e,o1(o,t,s),n}return r}function o1(t,e,n){for(var r,i,a=t[n];e<n&&a<(i=t[r=n-1>>>1]);)t[n]=i,n=r;t[n]=a}Function.prototype.toString,Hr.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:Hr.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,angle:0,radius:0,mode:G.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?t._map.toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&Xr.call(Gr,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this.set("polar")},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this.set("cartesian")},twirl:function(t,e,n,r){var i=this;return i.angle=t||0,i.radius=e||0,i.centerX=n||0,i.centerY=r||0,i.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},set:function(t,e){var n=this;return"polar"===t?(n._mapName="polar",n._map="polar",n._mapInit=null,n._apply=function(t,e,n){var r,i,a,o,s,l,u=this,c=(t.length,e-1),h=n-1,f=u.centerX*c,d=u.centerY*h,m=Nr(kr(Fr(f*f+d*d),Fr((f-c)*(f-c)+d*d),Fr(f*f+(d-h)*(d-h)),Fr((f-c)*(f-c)+(d-h)*(d-h)))),p=new Hr.ImArray(360*m<<2);for(u.hasMeta=!1,i=a=l=0;a<360;++i,l+=4)m<=i&&(i=0,++a),r=(s=i)*Yr(o=a/360*Ur)+f,s=s*Br(o)+d,Wr(p,l,r,s,t,e,n);return u.meta={_IMG_WIDTH:m,_IMG_HEIGHT:360},u.hasMeta=!0,p}.bind(n),n._mapChanged=!1):"cartesian"===t?(n._mapName="cartesian",n._map="cartesian",n._mapInit=null,n._apply=function(t,e,n){var r,i,a,o,s,l,u,c=this,h=(t.length,e-1),f=n-1,d=c.centerX*h,m=c.centerY*f,p=2*e+1,g=2*e+1,_=new Hr.ImArray(g*p<<2);for(c.hasMeta=!1,a=o=u=0;o<p;++a,u+=4)g<=a&&(a=0,++o),l=Fr((r=a-d)*r+(i=o-m)*i),(s=Dr(i,r))<0&&(s+=Ur),Wr(_,u,r=l,i=s*(p/360),t,e,n);return c.meta={_IMG_WIDTH:g,_IMG_HEIGHT:p},c.hasMeta=!0,_}.bind(n),n._mapChanged=!1):t&&Xr.call(Gr,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Gr[n._mapName],n._mapInit=Gr["init__"+n._mapName],n._apply=zr(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=zr(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}}),Gr={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"},Re=(t=L).MODE,xe=t.ConvolutionMatrix,Se=t.ImArray,t.Array32F,Ee=t.Array16I,t.Array8U,Le=t.Util.Filter.cm_convolve,Me=t.Util.Filter.cm_combine,Te=t.Util.Filter.integral_convolution,Ge=t.Util.Filter.separable_convolution,He=t.Util.Array.typed,Oe=t._notSupportClamp,(Ne=Math).SQRT2,Fe=t.CONST.toRad,t.CONST.toDeg,De=Ne.abs,Be=Ne.sqrt,Ye=Ne.sin,ke=Ne.cos,Ue=Ne.min,$e=Ne.max,Pe=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(t=t.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,r){var i=this;i._coeff=new xe([1,0]),i.matrix2=null,i.dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,t&&t.length?i.set(t,Be(t.length)+.5|0,e||1,n||0):(i.matrix=null,i.dim=0),i.mode=r||Re.RGB},path:t.Path,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,mode:Re.RGB,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}},unserialize:function(t){var e=this;return e.dim=t.dim,e.dim2=t.dim2,e.matrix=He(t.matrix,xe),e.matrix2=He(t.matrix2,xe),e._mat=He(t._mat,xe),e._mat2=He(t._mat2,xe),e._coeff=He(t._coeff,xe),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=He(t._indices,Ee),e._indices2=He(t._indices2,Ee),e._indicesf=He(t._indicesf,Ee),e._indicesf2=He(t._indicesf2,Ee),e},functional:function(t,e){var t=Vr(e=e===r?3:1&e?e:e+1,t),n=1/jr(t);return this.set(t,e,n,n,e,t),this._doSeparable=!0,this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set(e1(e=e===r?3:1&e?e:e+1),e,1/(e*e),0),this._doIntegral=t,this},lowPass:function(t){return this.set(e1(t=t===r?3:1&t?t:t+1),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=e===r?1:e)/((t=t===r?3:1&t?t:t+1)*t);return this.set(e1(t,e,1+e),t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=t===r?.5:t))},sharpen:function(t,e){return this.highPass(e,t=t===r?.5:t)},verticalBlur:function(t){return this.set(Kr(t=t===r?3:1&t?t:t+1),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(Kr(t=t===r?3:1&t?t:t+1),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,r){var i,a,o,s,l,u=t*t,c=t>>1,h=u>>1,f=new xe(u),d=new xe(u),m=1/t;u=1e-8<De(e)?(l=1,n/e):(l=e/n,1);s=o=i=0,a=u*t;for(;i<=c;)d[h+i]=h+o+s+.5|0,d[h-i]=h-o-s+.5|0,++i,o+=l,s+=a;i=0;for(;i<=c;)f[d[h+i]]=f[d[h-i]]=m,++i;return f[h]=r||1,f}(e=e===r?3:1&e?e:e+1,ke(t*=Fe),-Ye(t),1/e),e,1,0)},binomialLowPass:function(t){var e=Zr(t=t===r?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,n,n,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=Zr(t);return Le(t,t)}(t=t===r?3:1&t?t:t+1);return this.set(Me(e1(t),e,1,-1/jr(e)),t,1,0)},prewittX:function(t){return this.set(Kr(t=t===r?3:1&t?t:t+1),t,1,0,t,Qr(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(Qr(t=t===r?3:1&t?t:t+1,1),t,1,0,t,Kr(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=Fe,this.set(Me(t1(e=e===r?3:1&e?e:e+1,0),t1(e,1),ke(t),Ye(t)),e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(t1(t=t===r?3:1&t?t:t+1,0),t,1,0,t,t1(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(Zr(t=t===r?3:1&t?t:t+1),t,1,0,t,Qr(t,0)),this._doSeparable=!0,this},sobelY:function(t){return this.set(Qr(t=t===r?3:1&t?t:t+1,1),t,1,0,t,Zr(t)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=Fe,this.set(Me(Jr(e=e===r?3:1&e?e:e+1,0),Jr(e,1),ke(t),Ye(t)),e,1,0)},sobel:function(t){return this.set(Jr(t=t===r?3:1&t?t:t+1,0),t,1,0,t,Jr(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set(e1(t=t===r?3:1&t?t:t+1,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=t===r?-.25*Ne.PI:t*Fe,this.set(function(t,e,n,r){var i,a,o,s,l,u=t*t,c=t>>>1,h=u>>>1,f=new xe(u);for(i=s=0;i<=c;++i,s+=e)for(o=l=a=0;o<=c;++o,a+=t,l+=n)f[h+i+a]=s+l,f[h-i-a]=-s-l,f[h-i+a]=-s+l,f[h+i-a]=s-l;return f[h]=r||1,f}(n=n===r?3:1&n?n:n+1,(e=e||1)*ke(t),-e*Ye(t),1),n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r,i,a){var o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new xe(t),o.dim=e,o._coeff[0]=n||1,o._coeff[1]=r||0,t=qr(o.matrix,o.dim),o._indices=t[0],o._indicesf=t[1],o._mat=t[2],a?(o.matrix2=new xe(a),o.dim2=i,t=qr(o.matrix2,o.dim2),o._indices2=t[0],o._indicesf2=t[1],o._mat2=t[2]):i&&(o.dim2=i),o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(Le(e.matrix,t.matrix),e.dim*t.dim,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):e},_apply:function(t,e,n){var r=this,i=r.mode;if(!r.matrix)return t;if(r._doIntegral)return r.matrix2?Te(i,t,e,n,2,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):Te(i,t,e,n,2,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return Ge(i,t,e,n,2,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x,S,E,L=t.length,n=L>>>2,M=new Se(L),T=e-1,G=n-e,H=r._coeff[0],O=r._coeff[1],N=r.matrix,F=r.matrix2,D=r._isGrad;if(Re.GRAY===i)if(F){for(A=r._indicesf.length,x=new Ee(r._indicesf),c=0;c<A;c+=2)x[c+1]*=e;for(R=N.length,l=f=h=0;l<L;l+=4,++h){for(e<=h&&(h=0,f+=e),u=c=g=_=C=v=y=w=0;c<R;++c,u+=2)d=h+x[u],m=f+x[u+1],d<0||T<d||m<0||G<m||(I=N[c],g+=t[p=d+m<<2]*I,b=F[c],v+=t[p]*b);a=D?(g=De(g),v=De(v),(E=$e(g,v))?E*(1+.43*(S=Ue(g,v))/E*S/E):0):H*g+O*v,M[l]=0|(a=Oe?a<0?0:255<a?255:a:a),M[l+1]=0|a,M[l+2]=0|a,M[l+3]=t[l+3]}}else{for(A=r._indices.length,x=new Ee(r._indices),c=0;c<A;c+=2)x[c+1]*=e;for(R=(N=r._mat).length,l=f=h=0;l<L;l+=4,++h){for(e<=h&&(h=0,f+=e),u=c=g=_=C=0;c<R;++c,u+=2)d=h+x[u],m=f+x[u+1],d<0||T<d||m<0||G<m||(I=N[c],g+=t[p=d+m<<2]*I);a=H*g+O,M[l]=0|(a=Oe?a<0?0:255<a?255:a:a),M[l+1]=0|a,M[l+2]=0|a,M[l+3]=t[l+3]}}else if(F){for(A=r._indicesf.length,x=new Ee(r._indicesf),c=0;c<A;c+=2)x[c+1]*=e;for(R=N.length,l=f=h=0;l<L;l+=4,++h){for(e<=h&&(h=0,f+=e),u=c=g=_=C=v=y=w=0;c<R;++c,u+=2)d=h+x[u],m=f+x[u+1],d<0||T<d||m<0||G<m||(I=N[c],g+=t[p=d+m<<2]*I,_+=t[p+1]*I,C+=t[p+2]*I,b=F[c],v+=t[p]*b,y+=t[p+1]*b,w+=t[p+2]*b);s=D?(g=De(g),v=De(v),a=(E=$e(g,v))?E*(1+.43*(S=Ue(g,v))/E*S/E):0,_=De(_),y=De(y),o=(E=$e(_,y))?E*(1+.43*(S=Ue(_,y))/E*S/E):0,C=De(C),w=De(w),(E=$e(C,w))?E*(1+.43*(S=Ue(C,w))/E*S/E):0):(a=H*g+O*v,o=H*_+O*y,H*C+O*w),Oe&&(a=a<0?0:255<a?255:a,o=o<0?0:255<o?255:o,s=s<0?0:255<s?255:s),M[l]=0|a,M[l+1]=0|o,M[l+2]=0|s,M[l+3]=t[l+3]}}else{for(A=r._indices.length,x=new Ee(r._indices),c=0;c<A;c+=2)x[c+1]*=e;for(R=(N=r._mat).length,l=f=h=0;l<L;l+=4,h++){for(e<=h&&(h=0,f+=e),u=c=g=_=C=0;c<R;c++,u+=2)d=h+x[u],m=f+x[u+1],d<0||T<d||m<0||G<m||(I=N[c],g+=t[p=d+m<<2]*I,_+=t[p+1]*I,C+=t[p+2]*I);a=H*g+O,o=H*_+O,s=H*C+O,Oe&&(a=a<0?0:255<a?255:a,o=o<0?0:255<o?255:o,s=s<0?0:255<s?255:s),M[l]=0|a,M[l+1]=0|o,M[l+2]=0|s,M[l+3]=t[l+3]}}return M}})).prototype.gradX=t.prototype.prewittX,t.prototype.gradY=t.prototype.prewittY,t.prototype.gradDirectional=t.prototype.prewittDirectional,t.prototype.grad=t.prototype.prewitt,t.prototype.bump=t.prototype.emboss,t.prototype.boxBlur=t.prototype.lowPass,t.prototype.gaussBlur=t.prototype.binomialLowPass,We=(Xe=L).MODE,je=Xe.ImArray,qe=Xe.Util.Array.copy,Ve=Xe.Array8U,y=Xe.Array32I,Ke=Math.sqrt,Qe=Xe.Util.Array.typed,Xe.Util.Filter.primitive_morphology_operator,Ze=n1(3),Xe.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=We.RGB},path:Xe.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:We.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_dim2:t._dim2,_iter:t._iter,_structureElement:t._structureElement,_indices:t._indices,_structureElement2:t._structureElement2,_indices2:t._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=Qe(t._structureElement,Ve),e._indices=Qe(t._indices,y),e._structureElement2=Qe(t._structureElement2,Ve),e._indices2=Qe(t._indices2,y),e._filterName=t._filterName,e._filterName&&ze[e._filterName]&&(e._filter=ze[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,r){var i=this,a=(i._dim2=0,i._structureElement2=null,i._indices2=null,i._iter=0|r||1,i._filterName=t,i._filter=ze[t],e&&e.length?(i._structureElement=new Ve(e),i._dim=Ke(i._structureElement.length)+.5|0):e&&e===+e?(i._structureElement=n1(e),i._dim=e):(i._structureElement=Ze,i._dim=3),n&&n.length?(i._structureElement2=new Ve(n),i._dim2=Ke(i._structureElement2.length)+.5|0):n&&n===+n&&(i._structureElement2=n1(n),i._dim2=n),[]),o=(e=i._structureElement).length,s=(h=i._dim)>>>1;for(l=c=u=0;l<o;++l,++u)h<=u&&(u=0,++c),e[l]&&(a.push(u-s),a.push(c-s));if(i._indices=new y(a),i._structureElement2){var l,u,c,h,a=[],o=(e=i._structureElement2).length,s=(h=i._dim2)>>>1;for(l=c=u=0;l<o;++l,++u)h<=u&&(u=0,++c),e[l]&&(a.push(u-s),a.push(c-s));i._indices2=new y(a)}return i},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),Xe.Util.Filter.primitive_morphology_operator=r1,ze={dilate:function(t,e,n,r){for(var i=null,a=new je(e.length),o=t._indices,s=o.length,l=new y(s),u=0;u<s;u+=2)l[u]=o[u],l[u+1]=o[u+1]*n;if(t._indices2)for(s=(o=t._indices2).length,i=new y(s),u=0;u<s;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;return r1(t.mode,e,a,n,0,2,l,i,Math.max,0,t._iter),a},erode:function(t,e,n,r){for(var i=null,a=new je(e.length),o=t._indices,s=o.length,l=new y(s),u=0;u<s;u+=2)l[u]=o[u],l[u+1]=o[u+1]*n;if(t._indices2)for(s=(o=t._indices2).length,i=new y(s),u=0;u<s;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;return r1(t.mode,e,a,n,0,2,l,i,Math.min,255,t._iter),a},open:function(t,e,n,r){for(var i=null,a=new je(e.length),o=t._indices,s=o.length,l=new y(s),u=0;u<s;u+=2)l[u]=o[u],l[u+1]=o[u+1]*n;if(t._indices2)for(s=(o=t._indices2).length,i=new y(s),u=0;u<s;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;r1(t.mode,e,a,n,0,2,l,i,Math.min,255,t._iter);var c=e;return r1(t.mode,e=a,a=c,n,0,2,l,i,Math.max,0,t._iter),a},close:function(t,e,n,r){for(var i=null,a=new je(e.length),o=t._indices,s=o.length,l=new y(coverArea2),u=0;u<s;u+=2)l[u]=o[u],l[u+1]=o[u+1]*n;if(t._indices2)for(s=(o=t._indices2).length,i=new y(s),u=0;u<s;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;r1(t.mode,e,a,n,0,2,l,i,Math.max,0,t._iter);var c=e;return r1(t.mode,e=a,a=c,n,0,2,l,i,Math.min,255,t._iter),a},gradient:function(t,e,n,r){for(var i,a=null,o=e.length,s=new je(o),l=t._indices,u=l.length,c=new y(u),h=0;h<u;h+=2)c[h]=l[h],c[h+1]=l[h+1]*n;if(t._indices2)for(u=(l=t._indices2).length,a=new y(u),h=0;h<u;h+=2)a[h]=l[h],a[h+1]=l[h+1]*n;for(i=qe(e),r1(t.mode,i,s,n,0,2,c,a,Math.max,0,t._iter),r1(t.mode,e,i,n,0,2,c,a,Math.min,255,t._iter),h=0;h<o;h+=4)s[h]=(s[h]-i[h])/2|0,s[h+1]=(s[h+1]-i[h+1])/2|0,s[h+2]=(s[h+2]-i[h+2])/2|0;return s},laplacian:function(t,e,n,r){for(var i,a=null,o=e.length,s=new je(o),l=new je(o),u=t._indices,c=u.length,h=new y(c),f=0;f<c;f+=2)h[f]=u[f],h[f+1]=u[f+1]*n;if(t._indices2)for(c=(u=t._indices2).length,a=new y(c),f=0;f<c;f+=2)a[f]=u[f],a[f+1]=u[f+1]*n;for(i=qe(e),r1(t.mode,i,l,n,0,2,h,a,Math.max,0,t._iter),i=qe(e),r1(t.mode,i,s,n,0,2,h,a,Math.min,255,t._iter),f=0;f<o;f+=4)s[f]=(s[f]+l[f]-2*e[f])/2|0,s[f+1]=(s[f+1]+l[f+1]-2*e[f+1])/2|0,s[f+2]=(s[f+2]+l[f+2]-2*e[f+2])/2|0;return s}},tn=(e=L).MODE,en=e.ImArray,nn=e.Array32I,rn=e.Array32U,an=e.Util.Array.typed,on=Math.min,sn=Math.max,(e=e.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=tn.RGB},path:e.Path,d:0,k:0,_filter:null,_indices:null,mode:tn.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=an(t._indices,nn),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||0,n.k=e=on(1,sn(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";for(var r=t*t<<1,i=t>>>1,a=new nn(r),o=0,s=0,l=0;l<r;l+=2,++o)t<=o&&(o=0,++s),a[l]=o-i,a[l+1]=s-i;return n._indices=a,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r.d?"0th"===r._filter||"1th"===r._filter?Je["01th"](r,t,e,n):Je[r._filter](r,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=e.prototype.minimum,e.prototype.dilate=e.prototype.maximum,Je={"01th":function(t,e,n,r){t.d;for(var i,a,o,s,l,u,c,h,f,d,m,p,g,_=e.length,C=_>>>2,v=new en(_),y=n-1,w=C-n,I=t._indices,b=I.length,A=new nn(b),R="0th"===t._filter?(g=on,255):(g=sn,0),x=0;x<b;x+=2)A[x]=I[x],A[x+1]=I[x+1]*n;if(tn.GRAY===t.mode)for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),m=R,x=0;x<b;x+=2)s=a+A[x],l=o+A[x+1],s<0||y<s||l<0||w<l||(m=g(e[u=s+l<<2],m));v[i]=m,v[i+1]=m,v[i+2]=m,v[i+3]=e[i+3]}else for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),d=m=p=R,x=0;x<b;x+=2)s=a+A[x],l=o+A[x+1],s<0||y<s||l<0||w<l||(c=e[u=s+l<<2],h=e[u+1],f=e[u+2],d=g(c,d),m=g(h,m),p=g(f,p));v[i]=d,v[i+1]=m,v[i+2]=p,v[i+3]=e[i+3]}return v},kth:function(t,e,n,F){t.d;for(var r,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R,x=t.k,S=e.length,E=S>>>2,L=new en(S),M=n-1,T=E-n,G=t._indices,H=G.length,E=H>>>1,O=new nn(H),N=0;N<H;N+=2)O[N]=G[N],O[N+1]=G[N+1]*n;if(tn.GRAY===t.mode)for(g=new en(E),I=new rn(256),a=i=r=0;r<S;r+=4,++i){for(n<=i&&(i=0,a+=n),N=v=A=0;N<H;N+=2)o=i+O[N],s=a+O[N+1],o<0||M<o||s<0||T<s||(++A,++I[c=e[l=o+s<<2]],1===I[c]&&i1(g,v++,c));for(A*=x,R=0,d=-1,N=v;0<N;--N)R+=I[c=a1(g,N)],d<(I[c]=0)&&A<=R&&(d=c);L[r]=d,L[r+1]=d,L[r+2]=d,L[r+3]=e[r+3]}else for(p=new en(E),g=new en(E),_=new en(E),w=new rn(256),I=new rn(256),b=new rn(256),a=i=r=0;r<S;r+=4,++i){for(n<=i&&(i=0,a+=n),N=C=v=y=A=0;N<H;N+=2)o=i+O[N],s=a+O[N+1],o<0||M<o||s<0||T<s||(u=e[l=o+s<<2],c=e[l+1],h=e[l+2],++w[u],++I[c],++b[h],++A,1===w[u]&&i1(p,C++,u),1===I[c]&&i1(g,v++,c),1===b[h]&&i1(_,y++,h));for(A*=x,R=0,f=-1,N=C;0<N;--N)R+=w[u=a1(p,N)],f<(w[u]=0)&&A<=R&&(f=u);for(R=0,d=-1,N=v;0<N;--N)R+=I[c=a1(g,N)],d<(I[c]=0)&&A<=R&&(d=c);for(R=0,m=-1,N=y;0<N;--N)R+=b[h=a1(_,N)],m<(b[h]=0)&&A<=R&&(m=h);L[r]=f,L[r+1]=d,L[r+2]=m,L[r+3]=e[r+3]}return L}};var s1=L,l1=Object.prototype.hasOwnProperty;function u1(t,e,n){var t=7&t,r=t<4?e:n,n=t<4?n:e;return(1&t?-r:r)+(2&t?-2*n:2*n)}function c1(t,e){var n=.211324865,r=.366025403*(t+e),i=e+r,r=hn(t+r),i=hn(i),a=(r+i)*n,t=t-(r-a),e=e-(i-a),a=e<t?(c=1,0):(c=0,1),o=t-c+n,s=e-a+n,l=t-1+2*n,n=e-1+2*n,r=255&r,i=255&i,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*u1(I[r+I[i]],t,e),t=.5-o*o-s*s,e=t<0?0:(t*=t)*t*u1(I[r+c+I[i+a]],o,s),t=.5-l*l-n*n,c=t<0?0:(t*=t)*t*u1(I[1+r+I[1+i]],l,n);return 40*(u+e+c)}function h1(t){return t*t*t*(t*(6*t-15)+10)}function f1(t,e,n){return e+t*(n-e)}function d1(t,e){var n=hn(t),r=hn(e),t=t-n,e=e-r,i=t-1,a=e-1,o=n+1&255,s=r+1&255,l=h1(e),u=h1(t),n=f1(l,u1(I[(n&=255)+I[r&=255]],t,e),u1(I[n+I[s]],t,a)),t=f1(l,u1(I[o+I[r]],i,e),u1(I[o+I[s]],i,a));return.507*f1(u,n,t)}function m1(t,e,n,r,i,a,o,s,l,u,c,h,f){for(var d=0,m=h,p=1,g=0,_=0;_<u;++_)d+=n(m*((r+c[_][0])%a)*s,m*((i+c[_][1])%o)*l)*p,m*=2,g+=p,p*=f;t[e]=h=~~(255*(.5*d/g+.5)),t[e+1]=h,t[e+2]=h,t[e+3]=255}function p1(t,e,n,r,i,a,o,s,l,u,c,h,f){for(var d=0,m=h,p=1,g=0,_=0;_<u;++_)d+=n(m*((r+c[_][0])%a)*s,m*((i+c[_][1])%o)*l)*p,m*=2,g+=p,p*=f;t[e]=(h=~~(16777215*(.5*d/g+.5)))>>>16&255,t[e+1]=h>>>8&255,t[e+2]=255&h,t[e+3]=255}function g1(t,e,n,r,i,a,o,s,l,u,c,h){var f,d,m,p,g,_,C=1/a,v=1/o,y=h?d1:c1,w=i?m1:p1,I=t.length,b=e>>>1,A=n>>>1;if(u=u||1,c=c||.5,s=s||1,l=l||[[0,0]],r)for(g=d=f=0;g<I;g+=4,++f)e<=f&&(f=0,++d),p=A<d?n-1-d:d,(m=b<f?e-1-f:f)<f||p<d?(t[g]=t[_=p*e+m<<2],t[g+1]=t[1+_],t[g+2]=t[2+_],t[g+3]=255):w(t,g,y,m,p,e,n,C,v,s,l,u,c);else for(g=d=f=0;g<I;g+=4,++f)e<=f&&(f=0,++d),w(t,g,y,f,d,e,n,C,v,s,l,u,c);return t}function _1(t,e,n,r,i,a){r|=0,i|=0,a|=0;var o=new qn(256);return o[0]=(x(+n)<=a?r:i)<<2|(x(+e)<=a?r:i)<<1|(x(+t)<=a?r:i)<<0,o[1]=(x(n-1)<=a?r:i)<<2|(x(e-1)<=a?r:i)<<1|(x(t-1)<=a?r:i)<<0,o[2]=(x(n-2)<=a?r:i)<<2|(x(e-2)<=a?r:i)<<1|(x(t-2)<=a?r:i)<<0,o[3]=(x(n-3)<=a?r:i)<<2|(x(e-3)<=a?r:i)<<1|(x(t-3)<=a?r:i)<<0,o[4]=(x(n-4)<=a?r:i)<<2|(x(e-4)<=a?r:i)<<1|(x(t-4)<=a?r:i)<<0,o[5]=(x(n-5)<=a?r:i)<<2|(x(e-5)<=a?r:i)<<1|(x(t-5)<=a?r:i)<<0,o[6]=(x(n-6)<=a?r:i)<<2|(x(e-6)<=a?r:i)<<1|(x(t-6)<=a?r:i)<<0,o[7]=(x(n-7)<=a?r:i)<<2|(x(e-7)<=a?r:i)<<1|(x(t-7)<=a?r:i)<<0,o[8]=(x(n-8)<=a?r:i)<<2|(x(e-8)<=a?r:i)<<1|(x(t-8)<=a?r:i)<<0,o[9]=(x(n-9)<=a?r:i)<<2|(x(e-9)<=a?r:i)<<1|(x(t-9)<=a?r:i)<<0,o[10]=(x(n-10)<=a?r:i)<<2|(x(e-10)<=a?r:i)<<1|(x(t-10)<=a?r:i)<<0,o[11]=(x(n-11)<=a?r:i)<<2|(x(e-11)<=a?r:i)<<1|(x(t-11)<=a?r:i)<<0,o[12]=(x(n-12)<=a?r:i)<<2|(x(e-12)<=a?r:i)<<1|(x(t-12)<=a?r:i)<<0,o[13]=(x(n-13)<=a?r:i)<<2|(x(e-13)<=a?r:i)<<1|(x(t-13)<=a?r:i)<<0,o[14]=(x(n-14)<=a?r:i)<<2|(x(e-14)<=a?r:i)<<1|(x(t-14)<=a?r:i)<<0,o[15]=(x(n-15)<=a?r:i)<<2|(x(e-15)<=a?r:i)<<1|(x(t-15)<=a?r:i)<<0,o[16]=(x(n-16)<=a?r:i)<<2|(x(e-16)<=a?r:i)<<1|(x(t-16)<=a?r:i)<<0,o[17]=(x(n-17)<=a?r:i)<<2|(x(e-17)<=a?r:i)<<1|(x(t-17)<=a?r:i)<<0,o[18]=(x(n-18)<=a?r:i)<<2|(x(e-18)<=a?r:i)<<1|(x(t-18)<=a?r:i)<<0,o[19]=(x(n-19)<=a?r:i)<<2|(x(e-19)<=a?r:i)<<1|(x(t-19)<=a?r:i)<<0,o[20]=(x(n-20)<=a?r:i)<<2|(x(e-20)<=a?r:i)<<1|(x(t-20)<=a?r:i)<<0,o[21]=(x(n-21)<=a?r:i)<<2|(x(e-21)<=a?r:i)<<1|(x(t-21)<=a?r:i)<<0,o[22]=(x(n-22)<=a?r:i)<<2|(x(e-22)<=a?r:i)<<1|(x(t-22)<=a?r:i)<<0,o[23]=(x(n-23)<=a?r:i)<<2|(x(e-23)<=a?r:i)<<1|(x(t-23)<=a?r:i)<<0,o[24]=(x(n-24)<=a?r:i)<<2|(x(e-24)<=a?r:i)<<1|(x(t-24)<=a?r:i)<<0,o[25]=(x(n-25)<=a?r:i)<<2|(x(e-25)<=a?r:i)<<1|(x(t-25)<=a?r:i)<<0,o[26]=(x(n-26)<=a?r:i)<<2|(x(e-26)<=a?r:i)<<1|(x(t-26)<=a?r:i)<<0,o[27]=(x(n-27)<=a?r:i)<<2|(x(e-27)<=a?r:i)<<1|(x(t-27)<=a?r:i)<<0,o[28]=(x(n-28)<=a?r:i)<<2|(x(e-28)<=a?r:i)<<1|(x(t-28)<=a?r:i)<<0,o[29]=(x(n-29)<=a?r:i)<<2|(x(e-29)<=a?r:i)<<1|(x(t-29)<=a?r:i)<<0,o[30]=(x(n-30)<=a?r:i)<<2|(x(e-30)<=a?r:i)<<1|(x(t-30)<=a?r:i)<<0,o[31]=(x(n-31)<=a?r:i)<<2|(x(e-31)<=a?r:i)<<1|(x(t-31)<=a?r:i)<<0,o[32]=(x(n-32)<=a?r:i)<<2|(x(e-32)<=a?r:i)<<1|(x(t-32)<=a?r:i)<<0,o[33]=(x(n-33)<=a?r:i)<<2|(x(e-33)<=a?r:i)<<1|(x(t-33)<=a?r:i)<<0,o[34]=(x(n-34)<=a?r:i)<<2|(x(e-34)<=a?r:i)<<1|(x(t-34)<=a?r:i)<<0,o[35]=(x(n-35)<=a?r:i)<<2|(x(e-35)<=a?r:i)<<1|(x(t-35)<=a?r:i)<<0,o[36]=(x(n-36)<=a?r:i)<<2|(x(e-36)<=a?r:i)<<1|(x(t-36)<=a?r:i)<<0,o[37]=(x(n-37)<=a?r:i)<<2|(x(e-37)<=a?r:i)<<1|(x(t-37)<=a?r:i)<<0,o[38]=(x(n-38)<=a?r:i)<<2|(x(e-38)<=a?r:i)<<1|(x(t-38)<=a?r:i)<<0,o[39]=(x(n-39)<=a?r:i)<<2|(x(e-39)<=a?r:i)<<1|(x(t-39)<=a?r:i)<<0,o[40]=(x(n-40)<=a?r:i)<<2|(x(e-40)<=a?r:i)<<1|(x(t-40)<=a?r:i)<<0,o[41]=(x(n-41)<=a?r:i)<<2|(x(e-41)<=a?r:i)<<1|(x(t-41)<=a?r:i)<<0,o[42]=(x(n-42)<=a?r:i)<<2|(x(e-42)<=a?r:i)<<1|(x(t-42)<=a?r:i)<<0,o[43]=(x(n-43)<=a?r:i)<<2|(x(e-43)<=a?r:i)<<1|(x(t-43)<=a?r:i)<<0,o[44]=(x(n-44)<=a?r:i)<<2|(x(e-44)<=a?r:i)<<1|(x(t-44)<=a?r:i)<<0,o[45]=(x(n-45)<=a?r:i)<<2|(x(e-45)<=a?r:i)<<1|(x(t-45)<=a?r:i)<<0,o[46]=(x(n-46)<=a?r:i)<<2|(x(e-46)<=a?r:i)<<1|(x(t-46)<=a?r:i)<<0,o[47]=(x(n-47)<=a?r:i)<<2|(x(e-47)<=a?r:i)<<1|(x(t-47)<=a?r:i)<<0,o[48]=(x(n-48)<=a?r:i)<<2|(x(e-48)<=a?r:i)<<1|(x(t-48)<=a?r:i)<<0,o[49]=(x(n-49)<=a?r:i)<<2|(x(e-49)<=a?r:i)<<1|(x(t-49)<=a?r:i)<<0,o[50]=(x(n-50)<=a?r:i)<<2|(x(e-50)<=a?r:i)<<1|(x(t-50)<=a?r:i)<<0,o[51]=(x(n-51)<=a?r:i)<<2|(x(e-51)<=a?r:i)<<1|(x(t-51)<=a?r:i)<<0,o[52]=(x(n-52)<=a?r:i)<<2|(x(e-52)<=a?r:i)<<1|(x(t-52)<=a?r:i)<<0,o[53]=(x(n-53)<=a?r:i)<<2|(x(e-53)<=a?r:i)<<1|(x(t-53)<=a?r:i)<<0,o[54]=(x(n-54)<=a?r:i)<<2|(x(e-54)<=a?r:i)<<1|(x(t-54)<=a?r:i)<<0,o[55]=(x(n-55)<=a?r:i)<<2|(x(e-55)<=a?r:i)<<1|(x(t-55)<=a?r:i)<<0,o[56]=(x(n-56)<=a?r:i)<<2|(x(e-56)<=a?r:i)<<1|(x(t-56)<=a?r:i)<<0,o[57]=(x(n-57)<=a?r:i)<<2|(x(e-57)<=a?r:i)<<1|(x(t-57)<=a?r:i)<<0,o[58]=(x(n-58)<=a?r:i)<<2|(x(e-58)<=a?r:i)<<1|(x(t-58)<=a?r:i)<<0,o[59]=(x(n-59)<=a?r:i)<<2|(x(e-59)<=a?r:i)<<1|(x(t-59)<=a?r:i)<<0,o[60]=(x(n-60)<=a?r:i)<<2|(x(e-60)<=a?r:i)<<1|(x(t-60)<=a?r:i)<<0,o[61]=(x(n-61)<=a?r:i)<<2|(x(e-61)<=a?r:i)<<1|(x(t-61)<=a?r:i)<<0,o[62]=(x(n-62)<=a?r:i)<<2|(x(e-62)<=a?r:i)<<1|(x(t-62)<=a?r:i)<<0,o[63]=(x(n-63)<=a?r:i)<<2|(x(e-63)<=a?r:i)<<1|(x(t-63)<=a?r:i)<<0,o[64]=(x(n-64)<=a?r:i)<<2|(x(e-64)<=a?r:i)<<1|(x(t-64)<=a?r:i)<<0,o[65]=(x(n-65)<=a?r:i)<<2|(x(e-65)<=a?r:i)<<1|(x(t-65)<=a?r:i)<<0,o[66]=(x(n-66)<=a?r:i)<<2|(x(e-66)<=a?r:i)<<1|(x(t-66)<=a?r:i)<<0,o[67]=(x(n-67)<=a?r:i)<<2|(x(e-67)<=a?r:i)<<1|(x(t-67)<=a?r:i)<<0,o[68]=(x(n-68)<=a?r:i)<<2|(x(e-68)<=a?r:i)<<1|(x(t-68)<=a?r:i)<<0,o[69]=(x(n-69)<=a?r:i)<<2|(x(e-69)<=a?r:i)<<1|(x(t-69)<=a?r:i)<<0,o[70]=(x(n-70)<=a?r:i)<<2|(x(e-70)<=a?r:i)<<1|(x(t-70)<=a?r:i)<<0,o[71]=(x(n-71)<=a?r:i)<<2|(x(e-71)<=a?r:i)<<1|(x(t-71)<=a?r:i)<<0,o[72]=(x(n-72)<=a?r:i)<<2|(x(e-72)<=a?r:i)<<1|(x(t-72)<=a?r:i)<<0,o[73]=(x(n-73)<=a?r:i)<<2|(x(e-73)<=a?r:i)<<1|(x(t-73)<=a?r:i)<<0,o[74]=(x(n-74)<=a?r:i)<<2|(x(e-74)<=a?r:i)<<1|(x(t-74)<=a?r:i)<<0,o[75]=(x(n-75)<=a?r:i)<<2|(x(e-75)<=a?r:i)<<1|(x(t-75)<=a?r:i)<<0,o[76]=(x(n-76)<=a?r:i)<<2|(x(e-76)<=a?r:i)<<1|(x(t-76)<=a?r:i)<<0,o[77]=(x(n-77)<=a?r:i)<<2|(x(e-77)<=a?r:i)<<1|(x(t-77)<=a?r:i)<<0,o[78]=(x(n-78)<=a?r:i)<<2|(x(e-78)<=a?r:i)<<1|(x(t-78)<=a?r:i)<<0,o[79]=(x(n-79)<=a?r:i)<<2|(x(e-79)<=a?r:i)<<1|(x(t-79)<=a?r:i)<<0,o[80]=(x(n-80)<=a?r:i)<<2|(x(e-80)<=a?r:i)<<1|(x(t-80)<=a?r:i)<<0,o[81]=(x(n-81)<=a?r:i)<<2|(x(e-81)<=a?r:i)<<1|(x(t-81)<=a?r:i)<<0,o[82]=(x(n-82)<=a?r:i)<<2|(x(e-82)<=a?r:i)<<1|(x(t-82)<=a?r:i)<<0,o[83]=(x(n-83)<=a?r:i)<<2|(x(e-83)<=a?r:i)<<1|(x(t-83)<=a?r:i)<<0,o[84]=(x(n-84)<=a?r:i)<<2|(x(e-84)<=a?r:i)<<1|(x(t-84)<=a?r:i)<<0,o[85]=(x(n-85)<=a?r:i)<<2|(x(e-85)<=a?r:i)<<1|(x(t-85)<=a?r:i)<<0,o[86]=(x(n-86)<=a?r:i)<<2|(x(e-86)<=a?r:i)<<1|(x(t-86)<=a?r:i)<<0,o[87]=(x(n-87)<=a?r:i)<<2|(x(e-87)<=a?r:i)<<1|(x(t-87)<=a?r:i)<<0,o[88]=(x(n-88)<=a?r:i)<<2|(x(e-88)<=a?r:i)<<1|(x(t-88)<=a?r:i)<<0,o[89]=(x(n-89)<=a?r:i)<<2|(x(e-89)<=a?r:i)<<1|(x(t-89)<=a?r:i)<<0,o[90]=(x(n-90)<=a?r:i)<<2|(x(e-90)<=a?r:i)<<1|(x(t-90)<=a?r:i)<<0,o[91]=(x(n-91)<=a?r:i)<<2|(x(e-91)<=a?r:i)<<1|(x(t-91)<=a?r:i)<<0,o[92]=(x(n-92)<=a?r:i)<<2|(x(e-92)<=a?r:i)<<1|(x(t-92)<=a?r:i)<<0,o[93]=(x(n-93)<=a?r:i)<<2|(x(e-93)<=a?r:i)<<1|(x(t-93)<=a?r:i)<<0,o[94]=(x(n-94)<=a?r:i)<<2|(x(e-94)<=a?r:i)<<1|(x(t-94)<=a?r:i)<<0,o[95]=(x(n-95)<=a?r:i)<<2|(x(e-95)<=a?r:i)<<1|(x(t-95)<=a?r:i)<<0,o[96]=(x(n-96)<=a?r:i)<<2|(x(e-96)<=a?r:i)<<1|(x(t-96)<=a?r:i)<<0,o[97]=(x(n-97)<=a?r:i)<<2|(x(e-97)<=a?r:i)<<1|(x(t-97)<=a?r:i)<<0,o[98]=(x(n-98)<=a?r:i)<<2|(x(e-98)<=a?r:i)<<1|(x(t-98)<=a?r:i)<<0,o[99]=(x(n-99)<=a?r:i)<<2|(x(e-99)<=a?r:i)<<1|(x(t-99)<=a?r:i)<<0,o[100]=(x(n-100)<=a?r:i)<<2|(x(e-100)<=a?r:i)<<1|(x(t-100)<=a?r:i)<<0,o[101]=(x(n-101)<=a?r:i)<<2|(x(e-101)<=a?r:i)<<1|(x(t-101)<=a?r:i)<<0,o[102]=(x(n-102)<=a?r:i)<<2|(x(e-102)<=a?r:i)<<1|(x(t-102)<=a?r:i)<<0,o[103]=(x(n-103)<=a?r:i)<<2|(x(e-103)<=a?r:i)<<1|(x(t-103)<=a?r:i)<<0,o[104]=(x(n-104)<=a?r:i)<<2|(x(e-104)<=a?r:i)<<1|(x(t-104)<=a?r:i)<<0,o[105]=(x(n-105)<=a?r:i)<<2|(x(e-105)<=a?r:i)<<1|(x(t-105)<=a?r:i)<<0,o[106]=(x(n-106)<=a?r:i)<<2|(x(e-106)<=a?r:i)<<1|(x(t-106)<=a?r:i)<<0,o[107]=(x(n-107)<=a?r:i)<<2|(x(e-107)<=a?r:i)<<1|(x(t-107)<=a?r:i)<<0,o[108]=(x(n-108)<=a?r:i)<<2|(x(e-108)<=a?r:i)<<1|(x(t-108)<=a?r:i)<<0,o[109]=(x(n-109)<=a?r:i)<<2|(x(e-109)<=a?r:i)<<1|(x(t-109)<=a?r:i)<<0,o[110]=(x(n-110)<=a?r:i)<<2|(x(e-110)<=a?r:i)<<1|(x(t-110)<=a?r:i)<<0,o[111]=(x(n-111)<=a?r:i)<<2|(x(e-111)<=a?r:i)<<1|(x(t-111)<=a?r:i)<<0,o[112]=(x(n-112)<=a?r:i)<<2|(x(e-112)<=a?r:i)<<1|(x(t-112)<=a?r:i)<<0,o[113]=(x(n-113)<=a?r:i)<<2|(x(e-113)<=a?r:i)<<1|(x(t-113)<=a?r:i)<<0,o[114]=(x(n-114)<=a?r:i)<<2|(x(e-114)<=a?r:i)<<1|(x(t-114)<=a?r:i)<<0,o[115]=(x(n-115)<=a?r:i)<<2|(x(e-115)<=a?r:i)<<1|(x(t-115)<=a?r:i)<<0,o[116]=(x(n-116)<=a?r:i)<<2|(x(e-116)<=a?r:i)<<1|(x(t-116)<=a?r:i)<<0,o[117]=(x(n-117)<=a?r:i)<<2|(x(e-117)<=a?r:i)<<1|(x(t-117)<=a?r:i)<<0,o[118]=(x(n-118)<=a?r:i)<<2|(x(e-118)<=a?r:i)<<1|(x(t-118)<=a?r:i)<<0,o[119]=(x(n-119)<=a?r:i)<<2|(x(e-119)<=a?r:i)<<1|(x(t-119)<=a?r:i)<<0,o[120]=(x(n-120)<=a?r:i)<<2|(x(e-120)<=a?r:i)<<1|(x(t-120)<=a?r:i)<<0,o[121]=(x(n-121)<=a?r:i)<<2|(x(e-121)<=a?r:i)<<1|(x(t-121)<=a?r:i)<<0,o[122]=(x(n-122)<=a?r:i)<<2|(x(e-122)<=a?r:i)<<1|(x(t-122)<=a?r:i)<<0,o[123]=(x(n-123)<=a?r:i)<<2|(x(e-123)<=a?r:i)<<1|(x(t-123)<=a?r:i)<<0,o[124]=(x(n-124)<=a?r:i)<<2|(x(e-124)<=a?r:i)<<1|(x(t-124)<=a?r:i)<<0,o[125]=(x(n-125)<=a?r:i)<<2|(x(e-125)<=a?r:i)<<1|(x(t-125)<=a?r:i)<<0,o[126]=(x(n-126)<=a?r:i)<<2|(x(e-126)<=a?r:i)<<1|(x(t-126)<=a?r:i)<<0,o[127]=(x(n-127)<=a?r:i)<<2|(x(e-127)<=a?r:i)<<1|(x(t-127)<=a?r:i)<<0,o[128]=(x(n-128)<=a?r:i)<<2|(x(e-128)<=a?r:i)<<1|(x(t-128)<=a?r:i)<<0,o[129]=(x(n-129)<=a?r:i)<<2|(x(e-129)<=a?r:i)<<1|(x(t-129)<=a?r:i)<<0,o[130]=(x(n-130)<=a?r:i)<<2|(x(e-130)<=a?r:i)<<1|(x(t-130)<=a?r:i)<<0,o[131]=(x(n-131)<=a?r:i)<<2|(x(e-131)<=a?r:i)<<1|(x(t-131)<=a?r:i)<<0,o[132]=(x(n-132)<=a?r:i)<<2|(x(e-132)<=a?r:i)<<1|(x(t-132)<=a?r:i)<<0,o[133]=(x(n-133)<=a?r:i)<<2|(x(e-133)<=a?r:i)<<1|(x(t-133)<=a?r:i)<<0,o[134]=(x(n-134)<=a?r:i)<<2|(x(e-134)<=a?r:i)<<1|(x(t-134)<=a?r:i)<<0,o[135]=(x(n-135)<=a?r:i)<<2|(x(e-135)<=a?r:i)<<1|(x(t-135)<=a?r:i)<<0,o[136]=(x(n-136)<=a?r:i)<<2|(x(e-136)<=a?r:i)<<1|(x(t-136)<=a?r:i)<<0,o[137]=(x(n-137)<=a?r:i)<<2|(x(e-137)<=a?r:i)<<1|(x(t-137)<=a?r:i)<<0,o[138]=(x(n-138)<=a?r:i)<<2|(x(e-138)<=a?r:i)<<1|(x(t-138)<=a?r:i)<<0,o[139]=(x(n-139)<=a?r:i)<<2|(x(e-139)<=a?r:i)<<1|(x(t-139)<=a?r:i)<<0,o[140]=(x(n-140)<=a?r:i)<<2|(x(e-140)<=a?r:i)<<1|(x(t-140)<=a?r:i)<<0,o[141]=(x(n-141)<=a?r:i)<<2|(x(e-141)<=a?r:i)<<1|(x(t-141)<=a?r:i)<<0,o[142]=(x(n-142)<=a?r:i)<<2|(x(e-142)<=a?r:i)<<1|(x(t-142)<=a?r:i)<<0,o[143]=(x(n-143)<=a?r:i)<<2|(x(e-143)<=a?r:i)<<1|(x(t-143)<=a?r:i)<<0,o[144]=(x(n-144)<=a?r:i)<<2|(x(e-144)<=a?r:i)<<1|(x(t-144)<=a?r:i)<<0,o[145]=(x(n-145)<=a?r:i)<<2|(x(e-145)<=a?r:i)<<1|(x(t-145)<=a?r:i)<<0,o[146]=(x(n-146)<=a?r:i)<<2|(x(e-146)<=a?r:i)<<1|(x(t-146)<=a?r:i)<<0,o[147]=(x(n-147)<=a?r:i)<<2|(x(e-147)<=a?r:i)<<1|(x(t-147)<=a?r:i)<<0,o[148]=(x(n-148)<=a?r:i)<<2|(x(e-148)<=a?r:i)<<1|(x(t-148)<=a?r:i)<<0,o[149]=(x(n-149)<=a?r:i)<<2|(x(e-149)<=a?r:i)<<1|(x(t-149)<=a?r:i)<<0,o[150]=(x(n-150)<=a?r:i)<<2|(x(e-150)<=a?r:i)<<1|(x(t-150)<=a?r:i)<<0,o[151]=(x(n-151)<=a?r:i)<<2|(x(e-151)<=a?r:i)<<1|(x(t-151)<=a?r:i)<<0,o[152]=(x(n-152)<=a?r:i)<<2|(x(e-152)<=a?r:i)<<1|(x(t-152)<=a?r:i)<<0,o[153]=(x(n-153)<=a?r:i)<<2|(x(e-153)<=a?r:i)<<1|(x(t-153)<=a?r:i)<<0,o[154]=(x(n-154)<=a?r:i)<<2|(x(e-154)<=a?r:i)<<1|(x(t-154)<=a?r:i)<<0,o[155]=(x(n-155)<=a?r:i)<<2|(x(e-155)<=a?r:i)<<1|(x(t-155)<=a?r:i)<<0,o[156]=(x(n-156)<=a?r:i)<<2|(x(e-156)<=a?r:i)<<1|(x(t-156)<=a?r:i)<<0,o[157]=(x(n-157)<=a?r:i)<<2|(x(e-157)<=a?r:i)<<1|(x(t-157)<=a?r:i)<<0,o[158]=(x(n-158)<=a?r:i)<<2|(x(e-158)<=a?r:i)<<1|(x(t-158)<=a?r:i)<<0,o[159]=(x(n-159)<=a?r:i)<<2|(x(e-159)<=a?r:i)<<1|(x(t-159)<=a?r:i)<<0,o[160]=(x(n-160)<=a?r:i)<<2|(x(e-160)<=a?r:i)<<1|(x(t-160)<=a?r:i)<<0,o[161]=(x(n-161)<=a?r:i)<<2|(x(e-161)<=a?r:i)<<1|(x(t-161)<=a?r:i)<<0,o[162]=(x(n-162)<=a?r:i)<<2|(x(e-162)<=a?r:i)<<1|(x(t-162)<=a?r:i)<<0,o[163]=(x(n-163)<=a?r:i)<<2|(x(e-163)<=a?r:i)<<1|(x(t-163)<=a?r:i)<<0,o[164]=(x(n-164)<=a?r:i)<<2|(x(e-164)<=a?r:i)<<1|(x(t-164)<=a?r:i)<<0,o[165]=(x(n-165)<=a?r:i)<<2|(x(e-165)<=a?r:i)<<1|(x(t-165)<=a?r:i)<<0,o[166]=(x(n-166)<=a?r:i)<<2|(x(e-166)<=a?r:i)<<1|(x(t-166)<=a?r:i)<<0,o[167]=(x(n-167)<=a?r:i)<<2|(x(e-167)<=a?r:i)<<1|(x(t-167)<=a?r:i)<<0,o[168]=(x(n-168)<=a?r:i)<<2|(x(e-168)<=a?r:i)<<1|(x(t-168)<=a?r:i)<<0,o[169]=(x(n-169)<=a?r:i)<<2|(x(e-169)<=a?r:i)<<1|(x(t-169)<=a?r:i)<<0,o[170]=(x(n-170)<=a?r:i)<<2|(x(e-170)<=a?r:i)<<1|(x(t-170)<=a?r:i)<<0,o[171]=(x(n-171)<=a?r:i)<<2|(x(e-171)<=a?r:i)<<1|(x(t-171)<=a?r:i)<<0,o[172]=(x(n-172)<=a?r:i)<<2|(x(e-172)<=a?r:i)<<1|(x(t-172)<=a?r:i)<<0,o[173]=(x(n-173)<=a?r:i)<<2|(x(e-173)<=a?r:i)<<1|(x(t-173)<=a?r:i)<<0,o[174]=(x(n-174)<=a?r:i)<<2|(x(e-174)<=a?r:i)<<1|(x(t-174)<=a?r:i)<<0,o[175]=(x(n-175)<=a?r:i)<<2|(x(e-175)<=a?r:i)<<1|(x(t-175)<=a?r:i)<<0,o[176]=(x(n-176)<=a?r:i)<<2|(x(e-176)<=a?r:i)<<1|(x(t-176)<=a?r:i)<<0,o[177]=(x(n-177)<=a?r:i)<<2|(x(e-177)<=a?r:i)<<1|(x(t-177)<=a?r:i)<<0,o[178]=(x(n-178)<=a?r:i)<<2|(x(e-178)<=a?r:i)<<1|(x(t-178)<=a?r:i)<<0,o[179]=(x(n-179)<=a?r:i)<<2|(x(e-179)<=a?r:i)<<1|(x(t-179)<=a?r:i)<<0,o[180]=(x(n-180)<=a?r:i)<<2|(x(e-180)<=a?r:i)<<1|(x(t-180)<=a?r:i)<<0,o[181]=(x(n-181)<=a?r:i)<<2|(x(e-181)<=a?r:i)<<1|(x(t-181)<=a?r:i)<<0,o[182]=(x(n-182)<=a?r:i)<<2|(x(e-182)<=a?r:i)<<1|(x(t-182)<=a?r:i)<<0,o[183]=(x(n-183)<=a?r:i)<<2|(x(e-183)<=a?r:i)<<1|(x(t-183)<=a?r:i)<<0,o[184]=(x(n-184)<=a?r:i)<<2|(x(e-184)<=a?r:i)<<1|(x(t-184)<=a?r:i)<<0,o[185]=(x(n-185)<=a?r:i)<<2|(x(e-185)<=a?r:i)<<1|(x(t-185)<=a?r:i)<<0,o[186]=(x(n-186)<=a?r:i)<<2|(x(e-186)<=a?r:i)<<1|(x(t-186)<=a?r:i)<<0,o[187]=(x(n-187)<=a?r:i)<<2|(x(e-187)<=a?r:i)<<1|(x(t-187)<=a?r:i)<<0,o[188]=(x(n-188)<=a?r:i)<<2|(x(e-188)<=a?r:i)<<1|(x(t-188)<=a?r:i)<<0,o[189]=(x(n-189)<=a?r:i)<<2|(x(e-189)<=a?r:i)<<1|(x(t-189)<=a?r:i)<<0,o[190]=(x(n-190)<=a?r:i)<<2|(x(e-190)<=a?r:i)<<1|(x(t-190)<=a?r:i)<<0,o[191]=(x(n-191)<=a?r:i)<<2|(x(e-191)<=a?r:i)<<1|(x(t-191)<=a?r:i)<<0,o[192]=(x(n-192)<=a?r:i)<<2|(x(e-192)<=a?r:i)<<1|(x(t-192)<=a?r:i)<<0,o[193]=(x(n-193)<=a?r:i)<<2|(x(e-193)<=a?r:i)<<1|(x(t-193)<=a?r:i)<<0,o[194]=(x(n-194)<=a?r:i)<<2|(x(e-194)<=a?r:i)<<1|(x(t-194)<=a?r:i)<<0,o[195]=(x(n-195)<=a?r:i)<<2|(x(e-195)<=a?r:i)<<1|(x(t-195)<=a?r:i)<<0,o[196]=(x(n-196)<=a?r:i)<<2|(x(e-196)<=a?r:i)<<1|(x(t-196)<=a?r:i)<<0,o[197]=(x(n-197)<=a?r:i)<<2|(x(e-197)<=a?r:i)<<1|(x(t-197)<=a?r:i)<<0,o[198]=(x(n-198)<=a?r:i)<<2|(x(e-198)<=a?r:i)<<1|(x(t-198)<=a?r:i)<<0,o[199]=(x(n-199)<=a?r:i)<<2|(x(e-199)<=a?r:i)<<1|(x(t-199)<=a?r:i)<<0,o[200]=(x(n-200)<=a?r:i)<<2|(x(e-200)<=a?r:i)<<1|(x(t-200)<=a?r:i)<<0,o[201]=(x(n-201)<=a?r:i)<<2|(x(e-201)<=a?r:i)<<1|(x(t-201)<=a?r:i)<<0,o[202]=(x(n-202)<=a?r:i)<<2|(x(e-202)<=a?r:i)<<1|(x(t-202)<=a?r:i)<<0,o[203]=(x(n-203)<=a?r:i)<<2|(x(e-203)<=a?r:i)<<1|(x(t-203)<=a?r:i)<<0,o[204]=(x(n-204)<=a?r:i)<<2|(x(e-204)<=a?r:i)<<1|(x(t-204)<=a?r:i)<<0,o[205]=(x(n-205)<=a?r:i)<<2|(x(e-205)<=a?r:i)<<1|(x(t-205)<=a?r:i)<<0,o[206]=(x(n-206)<=a?r:i)<<2|(x(e-206)<=a?r:i)<<1|(x(t-206)<=a?r:i)<<0,o[207]=(x(n-207)<=a?r:i)<<2|(x(e-207)<=a?r:i)<<1|(x(t-207)<=a?r:i)<<0,o[208]=(x(n-208)<=a?r:i)<<2|(x(e-208)<=a?r:i)<<1|(x(t-208)<=a?r:i)<<0,o[209]=(x(n-209)<=a?r:i)<<2|(x(e-209)<=a?r:i)<<1|(x(t-209)<=a?r:i)<<0,o[210]=(x(n-210)<=a?r:i)<<2|(x(e-210)<=a?r:i)<<1|(x(t-210)<=a?r:i)<<0,o[211]=(x(n-211)<=a?r:i)<<2|(x(e-211)<=a?r:i)<<1|(x(t-211)<=a?r:i)<<0,o[212]=(x(n-212)<=a?r:i)<<2|(x(e-212)<=a?r:i)<<1|(x(t-212)<=a?r:i)<<0,o[213]=(x(n-213)<=a?r:i)<<2|(x(e-213)<=a?r:i)<<1|(x(t-213)<=a?r:i)<<0,o[214]=(x(n-214)<=a?r:i)<<2|(x(e-214)<=a?r:i)<<1|(x(t-214)<=a?r:i)<<0,o[215]=(x(n-215)<=a?r:i)<<2|(x(e-215)<=a?r:i)<<1|(x(t-215)<=a?r:i)<<0,o[216]=(x(n-216)<=a?r:i)<<2|(x(e-216)<=a?r:i)<<1|(x(t-216)<=a?r:i)<<0,o[217]=(x(n-217)<=a?r:i)<<2|(x(e-217)<=a?r:i)<<1|(x(t-217)<=a?r:i)<<0,o[218]=(x(n-218)<=a?r:i)<<2|(x(e-218)<=a?r:i)<<1|(x(t-218)<=a?r:i)<<0,o[219]=(x(n-219)<=a?r:i)<<2|(x(e-219)<=a?r:i)<<1|(x(t-219)<=a?r:i)<<0,o[220]=(x(n-220)<=a?r:i)<<2|(x(e-220)<=a?r:i)<<1|(x(t-220)<=a?r:i)<<0,o[221]=(x(n-221)<=a?r:i)<<2|(x(e-221)<=a?r:i)<<1|(x(t-221)<=a?r:i)<<0,o[222]=(x(n-222)<=a?r:i)<<2|(x(e-222)<=a?r:i)<<1|(x(t-222)<=a?r:i)<<0,o[223]=(x(n-223)<=a?r:i)<<2|(x(e-223)<=a?r:i)<<1|(x(t-223)<=a?r:i)<<0,o[224]=(x(n-224)<=a?r:i)<<2|(x(e-224)<=a?r:i)<<1|(x(t-224)<=a?r:i)<<0,o[225]=(x(n-225)<=a?r:i)<<2|(x(e-225)<=a?r:i)<<1|(x(t-225)<=a?r:i)<<0,o[226]=(x(n-226)<=a?r:i)<<2|(x(e-226)<=a?r:i)<<1|(x(t-226)<=a?r:i)<<0,o[227]=(x(n-227)<=a?r:i)<<2|(x(e-227)<=a?r:i)<<1|(x(t-227)<=a?r:i)<<0,o[228]=(x(n-228)<=a?r:i)<<2|(x(e-228)<=a?r:i)<<1|(x(t-228)<=a?r:i)<<0,o[229]=(x(n-229)<=a?r:i)<<2|(x(e-229)<=a?r:i)<<1|(x(t-229)<=a?r:i)<<0,o[230]=(x(n-230)<=a?r:i)<<2|(x(e-230)<=a?r:i)<<1|(x(t-230)<=a?r:i)<<0,o[231]=(x(n-231)<=a?r:i)<<2|(x(e-231)<=a?r:i)<<1|(x(t-231)<=a?r:i)<<0,o[232]=(x(n-232)<=a?r:i)<<2|(x(e-232)<=a?r:i)<<1|(x(t-232)<=a?r:i)<<0,o[233]=(x(n-233)<=a?r:i)<<2|(x(e-233)<=a?r:i)<<1|(x(t-233)<=a?r:i)<<0,o[234]=(x(n-234)<=a?r:i)<<2|(x(e-234)<=a?r:i)<<1|(x(t-234)<=a?r:i)<<0,o[235]=(x(n-235)<=a?r:i)<<2|(x(e-235)<=a?r:i)<<1|(x(t-235)<=a?r:i)<<0,o[236]=(x(n-236)<=a?r:i)<<2|(x(e-236)<=a?r:i)<<1|(x(t-236)<=a?r:i)<<0,o[237]=(x(n-237)<=a?r:i)<<2|(x(e-237)<=a?r:i)<<1|(x(t-237)<=a?r:i)<<0,o[238]=(x(n-238)<=a?r:i)<<2|(x(e-238)<=a?r:i)<<1|(x(t-238)<=a?r:i)<<0,o[239]=(x(n-239)<=a?r:i)<<2|(x(e-239)<=a?r:i)<<1|(x(t-239)<=a?r:i)<<0,o[240]=(x(n-240)<=a?r:i)<<2|(x(e-240)<=a?r:i)<<1|(x(t-240)<=a?r:i)<<0,o[241]=(x(n-241)<=a?r:i)<<2|(x(e-241)<=a?r:i)<<1|(x(t-241)<=a?r:i)<<0,o[242]=(x(n-242)<=a?r:i)<<2|(x(e-242)<=a?r:i)<<1|(x(t-242)<=a?r:i)<<0,o[243]=(x(n-243)<=a?r:i)<<2|(x(e-243)<=a?r:i)<<1|(x(t-243)<=a?r:i)<<0,o[244]=(x(n-244)<=a?r:i)<<2|(x(e-244)<=a?r:i)<<1|(x(t-244)<=a?r:i)<<0,o[245]=(x(n-245)<=a?r:i)<<2|(x(e-245)<=a?r:i)<<1|(x(t-245)<=a?r:i)<<0,o[246]=(x(n-246)<=a?r:i)<<2|(x(e-246)<=a?r:i)<<1|(x(t-246)<=a?r:i)<<0,o[247]=(x(n-247)<=a?r:i)<<2|(x(e-247)<=a?r:i)<<1|(x(t-247)<=a?r:i)<<0,o[248]=(x(n-248)<=a?r:i)<<2|(x(e-248)<=a?r:i)<<1|(x(t-248)<=a?r:i)<<0,o[249]=(x(n-249)<=a?r:i)<<2|(x(e-249)<=a?r:i)<<1|(x(t-249)<=a?r:i)<<0,o[250]=(x(n-250)<=a?r:i)<<2|(x(e-250)<=a?r:i)<<1|(x(t-250)<=a?r:i)<<0,o[251]=(x(n-251)<=a?r:i)<<2|(x(e-251)<=a?r:i)<<1|(x(t-251)<=a?r:i)<<0,o[252]=(x(n-252)<=a?r:i)<<2|(x(e-252)<=a?r:i)<<1|(x(t-252)<=a?r:i)<<0,o[253]=(x(n-253)<=a?r:i)<<2|(x(e-253)<=a?r:i)<<1|(x(t-253)<=a?r:i)<<0,o[254]=(x(n-254)<=a?r:i)<<2|(x(e-254)<=a?r:i)<<1|(x(t-254)<=a?r:i)<<0,o[255]=(x(n-255)<=a?r:i)<<2|(x(e-255)<=a?r:i)<<1|(x(t-255)<=a?r:i)<<0,o}function C1(t,e,n,r,i,a,o,s){var l,u,c,h,f,d,m,p,g=t.length,_=g>>>(r|=0),C=1<<r,v=e<<r,y=g-v,w=e-1<<r,I=o,b=s,A=o,R=s,x=new Wn(Vn(_/32)),S=new zn(_<<2),E=0,L=o+s>>>r;if(x[L>>>5]|=1<<(31&L),0<=s+v&&s+v<=y&&(S[E]=s,S[E+1]=o,S[E+2]=o,S[E+3]=v,E+=4),S[E]=s+v,S[E+1]=o,S[E+2]=o,S[E+3]=-v,E+=4,r)for(;0<E;){for(v=S[(E-=4)+3],d=S[E]+v,h=S[E+1],f=S[E+2],b=Kn(b,d),R=Qn(R,d),I=Kn(I,h),A=Qn(A,f),c=h;0<=c&&(L=(u=c+d)>>>r,!((p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]])||x[L>>>5]&1<<(31&L)));c-=C)x[L>>>5]|=1<<(31&L),I=Kn(I,c);if(h<=c){for(L=(u=c+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=f&&(p||x[L>>>5]&1<<(31&L));)L=(u=(c+=C)+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];m=(l=c)<=f}else(l=c+C)<h&&0+v<=d&&d<=y+v&&(S[E]=d,S[E+1]=l,S[E+2]=h-C,S[E+3]=-v,E+=4),c=h+C,m=!0;for(;m;){for(L=(u=c+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=w&&!p&&!(x[L>>>5]&1<<(31&L));)x[L>>>5]|=1<<(31&L),A=Qn(A,c),L=(u=(c+=C)+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];for(0<=d+v&&d+v<=y&&(S[E]=d,S[E+1]=l,S[E+2]=c-C,S[E+3]=v,E+=4),f+C<c&&0<=d-v&&d-v<=y&&(S[E]=d,S[E+1]=f+C,S[E+2]=c-C,S[E+3]=-v,E+=4),L=(u=c+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=f&&(p||x[L>>>5]&1<<(31&L));)L=(u=(c+=C)+d)>>>r,p=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];m=(l=c)<=f}}else for(;0<E;){for(v=S[(E-=4)+3],d=S[E]+v,h=S[E+1],f=S[E+2],b=Kn(b,d),R=Qn(R,d),I=Kn(I,h),A=Qn(A,f),c=h;0<=c&&!(1&i[t[L=u=c+d]]||x[L>>>5]&1<<(31&L));c-=C)x[L>>>5]|=1<<(31&L),I=Kn(I,c);if(h<=c){for(L=u=c+d;c<=f&&(1&i[t[u]]||x[L>>>5]&1<<(31&L));)L=u=(c+=C)+d;m=(l=c)<=f}else(l=c+C)<h&&0+v<=d&&d<=y+v&&(S[E]=d,S[E+1]=l,S[E+2]=h-C,S[E+3]=-v,E+=4),c=h+C,m=!0;for(;m;){for(L=u=c+d;c<=w&&!(1&i[t[u]])&&!(x[L>>>5]&1<<(31&L));)x[L>>>5]|=1<<(31&L),A=Qn(A,c),L=u=(c+=C)+d;for(0<=d+v&&d+v<=y&&(S[E]=d,S[E+1]=l,S[E+2]=c-C,S[E+3]=v,E+=4),f+C<c&&0<=d-v&&d-v<=y&&(S[E]=d,S[E+1]=f+C,S[E+2]=c-C,S[E+3]=-v,E+=4),L=u=c+d;c<=f&&(1&i[t[u]]||x[L>>>5]&1<<(31&L));)L=u=(c+=C)+d;m=(l=c)<=f}}return{mask:x,box:[I,b,A,R]}}function v1(t,e,n){this.id=-1,this.root=n||this}function y1(t){for(;t!==t.root;)t=t.root;return t}function w1(t,e){(t=y1(t))!==(e=y1(e))&&(t.root=e)}function I1(t,e,n){var r=e.width*n,n=e.height*n;return t.x>=e.x-r&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+r&&t.y+t.height<=e.y+e.height+n}function b1(t,e){return e.area-t.area}return Function.prototype.toString,s1.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:s1.Path,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_filter:!1!==t._filter&&(t._changed&&t._filter?t._filter.toString():null),_params:t._params};return t._changed=!1,e},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(s1)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)l1.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},set:function(t,e){var n=this;return!1===t?(n._filter=!1,n._changed=!0):("function"==typeof t&&(n._filter=t,n._changed=!0),e&&n.params(e)),n},_apply:function(t,e,n,r){return this._filter?this._filter(this._params,t,e,n,r):t},canRun:function(){return this._isOn&&this._filter}}),s1.CustomFilter=s1.InlineFilter,ln=L._notSupportClamp,(un=L.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:L.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var r,i,a,o,s,l,u,c,h=un.random,f=this.max-this.min,d=this.min,m=t.length;if(ln)for(r=0;r<m;r+=4)a=t[r],o=t[r+1],s=t[r+2],(l=a+(i=f*h()+d))<0?l=0:255<l&&(l=255),(u=o+i)<0?u=0:255<u&&(u=255),(c=s+i)<0?c=0:255<c&&(c=255),t[r]=0|l,t[r+1]=0|u,t[r+2]=0|c;else for(r=0;r<m;r+=4)a=t[r],o=t[r+1],s=t[r+2],u=o+(i=f*h()+d),c=s+i,t[r]=0|(l=a+i),t[r+1]=0|u,t[r+2]=0|c;return t}})).random=Math.random,cn=(i=L).MODE,i.Create({name:"PerlinNoiseFilter",mode:cn.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:i.Path,init:function(t,e,n,r,i,a,o,s){var l=this;l.mode=cn.GRAY,l._baseX=t||1,l._baseY=e||1,l._seed=o||0,l._stitch=!!r,l._fractal=!1!==i,l._perlin=!!s,l.octaves(n||1,a)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){var n=this;for(n._octaves=t||1,n._offsets=e?e.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?cn.COLOR:cn.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var t=this;return{_baseX:t._baseX,_baseY:t._baseY,_octaves:t._octaves,_offsets:t._offsets,_seed:t._seed||0,_stitch:t._stitch,_fractal:t._fractal,_perlin:t._perlin}},unserialize:function(t){var e=this;return e._baseX=t._baseX,e._baseY=t._baseY,e._octaves=t._octaves,e._offsets=t._offsets,e._seed=t._seed||0,e._stitch=t._stitch,e._fractal=t._fractal,e._perlin=t._perlin,e},apply:function(t,e,n){var r=this;return r._seed&&(g1.seed(r._seed),r._seed=0),g1(t,e,n,r._stitch,cn.COLOR!==r.mode,r._baseX,r._baseY,r._octaves,r._offsets,1,.5,r._perlin)}}),w=Math,hn=w.floor,w.sin,w.cos,i.CONST.PI2,w=i.Array8U,fn=new w([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),I=new w(fn),g1.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=hn(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?fn[n]^255&t:fn[n]^t>>8&255,I[n]=I[n+256]=e},b=Math,dn=b.min,mn=b.floor,gn=L.MODE,L.Create({name:"ChannelCopyFilter",srcChannel:(pn=L.CHANNEL).R,dstChannel:pn.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:L.Path,init:function(t,e,n,r,i){var a=this;a.srcChannel=t||pn.R,a.dstChannel=e||pn.R,a.centerX=n||0,a.centerY=r||0,a.color=i||0},dispose:function(){var t=this;return t.srcChannel=null,t.dstChannel=null,t.centerX=null,t.centerY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{srcChannel:t.srcChannel,dstChannel:t.dstChannel,centerX:t.centerX,centerY:t.centerY,color:t.color}},unserialize:function(t){var e=this;return e.srcChannel=t.srcChannel,e.dstChannel=t.dstChannel,e.centerX=t.centerX,e.centerY=t.centerY,e.color=t.color,e},apply:function(t,e,n){var r=this,i=r.input("source");if(i){var a,o,s,l,u,c,h,f,d,m=i[0],p=i[1],i=i[2],g=t.length,_=(m.length,r.srcChannel),C=r.dstChannel,v=r.centerX||0,y=r.centerY||0,w=p>>>1,I=i>>>1,b=dn(e,p),A=dn(n,i),R=r.color||0,x=r.mode,S=gn.COLOR32,E=gn.COLOR8,L=gn.COLORMASK32,M=gn.COLORMASK8;for(S===x||L===x?(d=R>>>24&255,c=R>>>16&255,h=R>>>8&255,f=255&R):E!==x&&M!==x||(R&=255),v=mn(v*(e-1))-w,y=mn(y*(n-1))-I,a=s=o=0;a<g;a+=4,++o)e<=o&&(o=0,++s),u=s-y,(l=o-v)<0||b<=l||u<0||A<=u?S===x?(t[a]=c,t[a+1]=h,t[a+2]=f,t[a+3]=d):L===x?(t[a]=c&t[a],t[a+1]=h&t[a+1],t[a+2]=f&t[a+2],t[a+3]=d&t[a+3]):E===x?t[a+C]=R:M===x&&(t[a+C]=R&t[a+_]):t[a+C]=m[(l+u*p<<2)+_]}return t}}),_n=L._notSupportClamp,Cn=L.Array32F,vn=L.MODE,yn=Math.min,wn=Math.max,L.Create({name:"HistogramEqualizeFilter",path:L.Path,mode:vn.INTENSITY,init:function(t){this.mode=t||vn.INTENSITY},_apply_rgb:function(t,e,n){for(var r,i,a,o,s,l,u,c,h,f,d,m,p=0,g=0,_=0,C=255,v=255,y=255,w=t.length,I=w>>>2,b=new Cn(256),A=new Cn(256),R=new Cn(256),x=0;x<w;x+=4)r=t[x],i=t[x+1],a=t[x+2],b[r]++,A[i]++,R[a]++,p=wn(r,p),g=wn(i,g),_=wn(a,_),C=yn(r,C),v=yn(i,v),y=yn(a,y);for(x=u=c=h=0;x<256;x+=32)u+=b[x],b[x]=u,u+=b[x+1],b[x+1]=u,u+=b[x+2],b[x+2]=u,u+=b[x+3],b[x+3]=u,u+=b[x+4],b[x+4]=u,u+=b[x+5],b[x+5]=u,u+=b[x+6],b[x+6]=u,u+=b[x+7],b[x+7]=u,u+=b[x+8],b[x+8]=u,u+=b[x+9],b[x+9]=u,u+=b[x+10],b[x+10]=u,u+=b[x+11],b[x+11]=u,u+=b[x+12],b[x+12]=u,u+=b[x+13],b[x+13]=u,u+=b[x+14],b[x+14]=u,u+=b[x+15],b[x+15]=u,u+=b[x+16],b[x+16]=u,u+=b[x+17],b[x+17]=u,u+=b[x+18],b[x+18]=u,u+=b[x+19],b[x+19]=u,u+=b[x+20],b[x+20]=u,u+=b[x+21],b[x+21]=u,u+=b[x+22],b[x+22]=u,u+=b[x+23],b[x+23]=u,u+=b[x+24],b[x+24]=u,u+=b[x+25],b[x+25]=u,u+=b[x+26],b[x+26]=u,u+=b[x+27],b[x+27]=u,u+=b[x+28],b[x+28]=u,u+=b[x+29],b[x+29]=u,u+=b[x+30],b[x+30]=u,u+=b[x+31],b[x+31]=u,c+=A[x],A[x]=c,c+=A[x+1],A[x+1]=c,c+=A[x+2],A[x+2]=c,c+=A[x+3],A[x+3]=c,c+=A[x+4],A[x+4]=c,c+=A[x+5],A[x+5]=c,c+=A[x+6],A[x+6]=c,c+=A[x+7],A[x+7]=c,c+=A[x+8],A[x+8]=c,c+=A[x+9],A[x+9]=c,c+=A[x+10],A[x+10]=c,c+=A[x+11],A[x+11]=c,c+=A[x+12],A[x+12]=c,c+=A[x+13],A[x+13]=c,c+=A[x+14],A[x+14]=c,c+=A[x+15],A[x+15]=c,c+=A[x+16],A[x+16]=c,c+=A[x+17],A[x+17]=c,c+=A[x+18],A[x+18]=c,c+=A[x+19],A[x+19]=c,c+=A[x+20],A[x+20]=c,c+=A[x+21],A[x+21]=c,c+=A[x+22],A[x+22]=c,c+=A[x+23],A[x+23]=c,c+=A[x+24],A[x+24]=c,c+=A[x+25],A[x+25]=c,c+=A[x+26],A[x+26]=c,c+=A[x+27],A[x+27]=c,c+=A[x+28],A[x+28]=c,c+=A[x+29],A[x+29]=c,c+=A[x+30],A[x+30]=c,c+=A[x+31],A[x+31]=c,h+=R[x],R[x]=h,h+=R[x+1],R[x+1]=h,h+=R[x+2],R[x+2]=h,h+=R[x+3],R[x+3]=h,h+=R[x+4],R[x+4]=h,h+=R[x+5],R[x+5]=h,h+=R[x+6],R[x+6]=h,h+=R[x+7],R[x+7]=h,h+=R[x+8],R[x+8]=h,h+=R[x+9],R[x+9]=h,h+=R[x+10],R[x+10]=h,h+=R[x+11],R[x+11]=h,h+=R[x+12],R[x+12]=h,h+=R[x+13],R[x+13]=h,h+=R[x+14],R[x+14]=h,h+=R[x+15],R[x+15]=h,h+=R[x+16],R[x+16]=h,h+=R[x+17],R[x+17]=h,h+=R[x+18],R[x+18]=h,h+=R[x+19],R[x+19]=h,h+=R[x+20],R[x+20]=h,h+=R[x+21],R[x+21]=h,h+=R[x+22],R[x+22]=h,h+=R[x+23],R[x+23]=h,h+=R[x+24],R[x+24]=h,h+=R[x+25],R[x+25]=h,h+=R[x+26],R[x+26]=h,h+=R[x+27],R[x+27]=h,h+=R[x+28],R[x+28]=h,h+=R[x+29],R[x+29]=h,h+=R[x+30],R[x+30]=h,h+=R[x+31],R[x+31]=h;if(o=(p-C)/I,s=(g-v)/I,l=(_-y)/I,_n)for(x=0;x<w;x+=4)r=t[x],i=t[x+1],a=t[x+2],f=b[r]*o+C,d=(d=A[i]*s+v)<0?0:255<d?255:d,m=(m=R[a]*l+y)<0?0:255<m?255:m,t[x]=~~(f=f<0?0:255<f?255:f),t[x+1]=~~d,t[x+2]=~~m;else for(x=0;x<w;x+=4)r=t[x],i=t[x+1],a=t[x+2],f=b[r]*o+C,d=A[i]*s+v,m=R[a]*l+y,t[x]=~~f,t[x+1]=~~d,t[x+2]=~~m;return t},apply:function(t,e,n){if(vn.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,a,o,s,l,u,c,h,f=0,d=255,m=t.length,e=m>>>2,n=vn.GRAY===this.mode,p=new Cn(256);if(n)for(h=0;h<m;h+=4)p[r=t[h]]++,f=wn(r,f),d=yn(r,d);else for(h=0;h<m;h+=4)o=(o=~~(0+.299*(r=t[h])+.587*(i=t[h+1])+.114*(a=t[h+2])))<0?0:255<o?255:o,s=(s=~~(128-.168736*r-.331264*i+.5*a))<0?0:255<s?255:s,t[h]=l=(l=~~(128+.5*r-.418688*i-.081312*a))<0?0:255<l?255:l,t[h+1]=o,t[h+2]=s,p[o]++,f=wn(o,f),d=yn(o,d);for(h=c=0;h<256;h+=32)c+=p[h],p[h]=c,c+=p[h+1],p[h+1]=c,c+=p[h+2],p[h+2]=c,c+=p[h+3],p[h+3]=c,c+=p[h+4],p[h+4]=c,c+=p[h+5],p[h+5]=c,c+=p[h+6],p[h+6]=c,c+=p[h+7],p[h+7]=c,c+=p[h+8],p[h+8]=c,c+=p[h+9],p[h+9]=c,c+=p[h+10],p[h+10]=c,c+=p[h+11],p[h+11]=c,c+=p[h+12],p[h+12]=c,c+=p[h+13],p[h+13]=c,c+=p[h+14],p[h+14]=c,c+=p[h+15],p[h+15]=c,c+=p[h+16],p[h+16]=c,c+=p[h+17],p[h+17]=c,c+=p[h+18],p[h+18]=c,c+=p[h+19],p[h+19]=c,c+=p[h+20],p[h+20]=c,c+=p[h+21],p[h+21]=c,c+=p[h+22],p[h+22]=c,c+=p[h+23],p[h+23]=c,c+=p[h+24],p[h+24]=c,c+=p[h+25],p[h+25]=c,c+=p[h+26],p[h+26]=c,c+=p[h+27],p[h+27]=c,c+=p[h+28],p[h+28]=c,c+=p[h+29],p[h+29]=c,c+=p[h+30],p[h+30]=c,c+=p[h+31],p[h+31]=c;if(u=(f-d)/e,_n)if(n)for(h=0;h<m;h+=4)r=~~(p[t[h]]*u+d),t[h]=r=r<0?0:255<r?255:r,t[h+1]=r,t[h+2]=r;else for(h=0;h<m;h+=4)i=(i=~~((o=p[t[h+1]]*u+d)-.34414*((s=t[h+2])-128)-.71414*((l=t[h])-128)))<0?0:255<i?255:i,a=(a=~~(o+1.772*(s-128)))<0?0:255<a?255:a,t[h]=r=(r=~~(o+1.402*(l-128)))<0?0:255<r?255:r,t[h+1]=i,t[h+2]=a;else if(n)for(h=0;h<m;h+=4)r=~~(p[t[h]]*u+d),t[h]=r,t[h+1]=r,t[h+2]=r;else for(h=0;h<m;h+=4)i=~~((o=p[t[h+1]]*u+d)-.34414*((s=t[h+2])-128)-.71414*((l=t[h])-128)),a=~~(o+1.772*(s-128)),t[h]=r=~~(o+1.402*(l-128)),t[h+1]=i,t[h+2]=a;return t}}),In=L,A=Math,bn=A.sqrt,O=A.min,An=A.max,Rn=bn(3),xn=In.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:In.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},apply:function(t,e,n){var r,i=this,a=i.pattern;return i.scale<=1||!a||!xn[a]?t:(100<i.scale&&(i.scale=100),r=new In.ImArray(t.length),xn[a](i.scale,r,t,e,n),r)}}).PATTERN={rectangular:function(t,e,n,r,i){for(var a,o,s,l,u,c,h,f,d,m,p,g,_,C,v=n.length,y=v>>>2,w=r-1,I=y-r,b=(a=bn(y)*t*.01|0)*r,A=(o=.5*a|0)*r,R=l=u=c=h=f=0;R<v;R+=4)m=u-f,p=O(w,(d=l-c)+a),g=O(I,m+b),_=O(w,d+o),C=O(I,m+A),_=.125*(n[s=d+m<<2]+n[d=d+g<<2]+n[m=p+m<<2]+n[p=p+g<<2]+4*n[g=_+C<<2]),C=.125*(n[1+s]+n[1+d]+n[1+m]+n[1+p]+4*n[1+g]),s=.125*(n[2+s]+n[2+d]+n[2+m]+n[2+p]+4*n[2+g]),e[R]=0|_,e[R+1]=0|C,e[R+2]=0|s,e[R+3]=n[R+3],++c,r<=++l&&(l=c=0,f+=r,u+=r,a<=++h)&&(f=h=0),a<=c&&(c=0)},triangular:function(t,e,n,r,i){for(var a,o,s,l,u,c,h,f,d,m,p=n.length,g=p>>>2,_=r-1,C=g-r,v=bn(g)*t*.0125|0,y=.333*v|0,w=.666*v|0,I=v*r,b=(.5*v|0)*r,A=s=l=u=c=0,R=0;R<p;R+=4)f=s-c,d=O(_,(h=A-l)+v),m=O(C,f+I),f=.2*(n[m=v<l+u?(a=O(_,h+w)+O(C,f+b)<<2,d+m<<2):(a=O(_,h+y)+O(C,f+b)<<2,h+m<<2)]+n[h=h+f<<2]+n[d=d+f<<2]+2*n[a]),o=.2*(n[m+1]+n[1+h]+n[1+d]+2*n[a+1]),m=.2*(n[m+2]+n[2+h]+n[2+d]+2*n[a+2]),e[R]=0|f,e[R+1]=0|o,e[R+2]=0|m,e[R+3]=n[R+3],++l,r<=++A&&(A=l=0,c+=r,s+=r,v<=++u)&&(c=u=0),v<=l&&(l=0)},rhomboidal:function(t,e,n,r,i){for(var a,o,s,l,u,c,h,f,d,m,p,g,_=n.length,C=_>>>2,v=r-1,y=C-r,w=bn(C)*t*.007|0,I=2*w,b=w*r,A=I*r,R=s=l=u=c=0,x=0,S=0;S<_;S+=4)f=x?I<l+u?(h=O(v,R-l+w),s-c):w<l+w-u?(h=R-l,An(0,s-c-b)):(h=An(0,R-l-w),s-c):I<l+w-u?(h=O(v,R-l+w),An(0,s-c-b)):w<l+u?(h=R-l,s-c):(h=An(0,R-l-w),An(0,s-c-b)),d=O(v,h+I),m=O(y,f+A),p=O(v,h+w),g=O(y,f+b),g=.125*(n[f=p+f<<2]+n[a=h+g<<2]+n[d=d+g<<2]+n[m=p+m<<2]+4*n[p=p+g<<2]),o=.125*(n[1+f]+n[1+a]+n[1+d]+n[1+m]+4*n[1+p]),f=.125*(n[2+f]+n[2+a]+n[2+d]+n[2+m]+4*n[2+p]),e[S]=0|g,e[S+1]=0|o,e[S+2]=0|f,e[S+3]=n[S+3],++l,r<=++R&&(R=l=0,c+=r,s+=r,w<=++u)&&(c=u=0,x=1-x),I<=l&&(l=0)},hexagonal:function(t,e,n,r,i){for(var a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w=n.length,I=w>>>2,b=r-1,A=I-r,R=Rn*t*bn(I)*.012|0,x=.5*R|0,S=.25*R|0,E=R-S,L=.25*R|0,M=L*r,T=s=l=u=c=0,G=y=1,H=0;H<w;H+=4)f=y?2===G?(h=An(0,T-l-S),s-c):1===G?x<Rn*l+L-u?(h=O(b,T-l+S),s-c):(h=An(0,T-l-x),O(A,s-c+M)):Rn*l+u<x?(h=An(0,T-l-E),s-c):(h=T-l,O(A,s-c+M)):2===G?(h=An(0,T-l-S),O(A,s-c+M)):1===G?x<Rn*l+u?(h=O(b,T-l+S),O(A,s-c+M)):(h=An(0,T-l-x),s-c):Rn*l+L-u<x?(h=An(0,T-l-E),O(A,s-c+M)):(h=T-l,s-c),d=O(b,h+S),m=An(0,f-M),p=O(b,h+x),g=f,_=O(b,h+R),C=O(A,f+M),v=O(b,h+E),C=.125*(n[a=h+f<<2]+n[o=d+m<<2]+n[m=v+m<<2]+n[_=_+f<<2]+n[f=v+C<<2]+n[v=d+C<<2]+2*n[d=p+g<<2]),p=.125*(n[1+a]+n[1+o]+n[1+m]+n[1+_]+n[1+f]+n[1+v]+2*n[1+d]),g=.125*(n[2+a]+n[2+o]+n[2+m]+n[2+_]+n[2+f]+n[2+v]+2*n[2+d]),e[H]=0|C,e[H+1]=0|p,e[H+2]=0|g,e[H+3]=n[H+3],++l,r<=++T&&(c+=r,s+=r,G=T=l=0,L<=++u)&&(c=u=0,y=1-y),x<=l&&(l=0,G=(G+1)%3)}},Sn=L.MODE,En=L.Array32F,Ln=L.Color.clamp,Mn=L.Color.intensity,L.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:Sn.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=Ln(null==e?.4:e,0,1),this.mode=n||Sn.GRAY},path:L.Path,threshold:function(t){return this.thresh=Ln(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var r,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y=t.length,w=new En(3*(y>>>2)),I=this.size,b=1/(I*I),A=255*this.thresh,R=Sn.RGB===this.mode,x=I*e,S=0,E=0,L=0;S<n;){if(l=u=c=0,R){for(s=o=a=0;o<I;)l+=t[r=L+E+a+s<<2]+w[i=3*(L+E+a+s)],u+=t[r+1]+w[i+1],c+=t[r+2]+w[i+2],++a>=I&&(a=0,++o,s+=e);d=A<Mn(l*=b,u*=b,c*=b)?(h=0|l,f=0|u,0|c):f=h=0}else{for(s=o=a=0;o<I;)l+=t[r=L+E+a+s<<2]+w[i=3*(L+E+a+s)],++a>=I&&(a=0,++o,s+=e);d=f=h=A<l*b?255:0}if(m=t[r=L+E<<2]-h,p=t[r+1]-f,g=t[r+2]-d,L+I<e)for(_=7/16*m,C=7/16*p,v=7/16*g,a=I,s=o=0;o<I;)w[i=3*(L+E+a+s)]+=_,w[i+1]+=C,w[i+2]+=v,0<=++a&&(a=I,++o,s+=e);if(S+I<n&&I<L)for(_=3/16*m,C=3/16*p,v=3/16*g,a=-I,o=I,s=0;o<0;)w[i=3*(L+E+a+s)]+=_,w[i+1]+=C,w[i+2]+=v,0<=++a&&(a=-I,++o,s+=e);if(S+I<n)for(_=5/16*m,C=5/16*p,v=5/16*g,o=I,s=a=0;o<0;)w[i=3*(L+E+a+s)]+=_,w[i+1]+=C,w[i+2]+=v,++a>=I&&(a=0,++o,s+=e);if(S+I<n&&L+I<e)for(_=1/16*m,C=1/16*p,v=1/16*g,o=a=I,s=0;o<0;)w[i=3*(L+E+a+s)]+=_,w[i+1]+=C,w[i+2]+=v,0<=++a&&(a=I,++o,s+=e);for(s=o=a=0;o<I;)t[r=L+E+a+s<<2]=h,t[r+1]=f,t[r+2]=d,++a>=I&&(a=0,++o,s+=e);e<=(L+=I)&&(L=0,S+=I,E+=x)}return t}}),Gn=(Tn=L).MODE,Hn=new Tn.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),On=Math,Tn.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:Tn.Path,init:function(t,e,n,r,i,a,o){var s=this;s.offsetX=t||0,s.offsetY=e||0,s.color=n||0,s.opacity=null==r?1:+r,s.quality=0|(i||1),s.pad=null==a||!!a,s.onlyShadow=!!o},dispose:function(){var t=this;return t.offsetX=null,t.offsetY=null,t.color=null,t.opacity=null,t.quality=null,t.pad=null,t.onlyShadow=null,t.$super("dispose"),t},serialize:function(){var t=this;return{offsetX:t.offsetX,offsetY:t.offsetY,color:t.color,opacity:t.opacity,quality:t.quality,pad:t.pad,onlyShadow:t.onlyShadow}},unserialize:function(t){var e=this;return e.offsetX=t.offsetX,e.offsetY=t.offsetY,e.color=t.color,e.opacity=t.opacity,e.quality=t.quality,e.pad=t.pad,e.onlyShadow=t.onlyShadow,e},apply:function(t,e,n){var r=this;if(r.hasMeta=!1,r._isOn){var i,a,o,s,l,u,c,h=On.max,f=r.color||0,d=r.opacity,m=r.quality,p=r.pad,g=r.onlyShadow,_=r.offsetX||0,C=r.offsetY||0,v=t.length,y=v>>>2,w=v,I=e;if(0!==(d=1<(d=d<0?0:d)?1:d)){i=f>>>16&255,a=f>>>8&255,o=255&f,3<(m=m<=0?1:m)&&(m=3);for(var b=new Tn.ImArray(w),A=0,R=0,x=0,S=0,E=0;x<w;x+=4,++S)I<=S&&(S=0,++E),0<(c=t[x+3])&&(b[x]=i,b[x+1]=a,b[x+2]=o,b[x+3]=d*c|0,A=h(A,S),R=h(R,E));if(b=Tn.Util.Filter.integral_convolution(i===a&&a===o?Gn.GRAY:Gn.RGB,b,e,n,2,Hn,null,3,3,1,0,m),A+=_,R+=C,p&&(e<=A||A<0||n<=R||R<0)&&(t=Tn.Util.Image.pad(t,e,n,v=e<=A?A-e:0,f=n<=R?R-n:0,m=A<0?-A:0,p=R<0?-R:0),y=(e+=m+v)*(n+=p+f),r.hasMeta=!0,r.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}),C*=e,g)for(u=E=S=0;u<w;u+=4,++S)I<=S&&(S=0,E+=e),l=E+C,(s=S+_)<0||e<=s||l<0||y<=l||(t[x=s+l<<2]=b[u],t[x+1]=b[u+1],t[x+2]=b[u+2],t[x+3]=b[u+3]);else for(u=E=S=0;u<w;u+=4,++S)I<=S&&(S=0,E+=e),l=E+C,(s=S+_)<0||e<=s||l<0||y<=l||(c=t[(x=s+l<<2)+3],d=b[u+3],255!==c&&0!==d&&(i=t[x]+(b[u]-t[x])*(d/=255),a=t[x+1]+(b[u+1]-t[x+1])*d,o=t[x+2]+(b[u+2]-t[x+2])*d,t[x]=0|i,t[x+1]=0|a,t[x+2]=0|o))}}return t}}),(Nn=Math).sqrt,Nn.exp,Fn=Nn.log,Dn=Nn.abs,Bn=Nn.floor,Yn=L._notSupportClamp,kn=L.Array32F,L.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,r){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==r?10:r},path:L.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var r,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b=t.length,A=this.centerX||0,R=this.centerY||0,x=this.radius,S=this.amount;if(!(S<=0)){for(0,I=(r=b>>>2)-e,A=Bn(A*(w=e-1)),R=Bn(R*(n-1)),l=(e<<1)+e,i=new kn((r<<1)+r),h=a=o=s=h=c=u=0;h<e;++h,u+=4,c+=3)a+=t[u],o+=t[u+1],s+=t[u+2],i[c]=a,i[c+1]=o,i[c+2]=s;for(a=o=s=h=c=0,u=u=l+e;u<b;u+=4,c+=3,++h)e<=h&&(a=o=s=h=0),a+=t[u],o+=t[u+1],s+=t[u+2],i[c+l]=i[c]+a,i[c+l+1]=i[c+1]+o,i[c+l+2]=i[c+2]+s;for(u=d=f=h=0;u<b;u+=4,++h)e<=h&&(h=0,++f,d+=e),y=Dn(h-A),C=Dn(f-R),p=Nn.max(y,C),y=Nn.min(y,C),0<(y=x<(C=p?p*(1+.43*y/p*y/p):0)?0|Fn((C-x)*S):C/x+.5|0)&&(p=h+y,g=d+(C=y*e),(m=h-y)<0?m=0:w<p&&(p=w),(C=d-C)<0?C=0:I<g&&(g=I),C=(y=.25/(y*y))*(i[_=((_=p+g)<<1)+_]-i[p=((p=p+C)<<1)+p]-i[g=((g=m+g)<<1)+g]+i[m=((m=m+C)<<1)+m]),v=y*(i[_+1]-i[p+1]-i[g+1]+i[m+1]),y=y*(i[_+2]-i[p+2]-i[g+2]+i[m+2]),Yn&&(C=C<0?0:255<C?255:C,v=v<0?0:255<v?255:v,y=y<0?0:255<y?255:y),t[u]=0|C,t[u+1]=0|v,t[u+2]=0|y)}}return t}}),Un=L,$n=Math,Un.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:Un.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},apply:function(t,e,n){var r,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C=this.type,v=Un.ImArray,y=Un.Array8U,w=Un.Util.Image.interpolate,I=$n.sqrt;for(e!==n?t=w(t,e,n,m=n<e?e:n,m):m=e,p=$n.round(m/2),g=m*m,r=new v(_=t.length),i=new v(_),a=new y(g),f=h=c=0;f<_;f+=4,++c)m<=c&&(c=0,++h),r[d=(c+p)%m+(h+p)%m*m<<2]=t[f],r[d+1]=t[f+1],r[d+2]=t[f+2],r[d+3]=t[f+3];if(0===C)for(h=c=0;c<p;++h)p<=h&&(h=0,++c),u=255-255*I((c-p)*(c-p)+(h-p)*(h-p))/p,a[c+h*m]=u=u<1?1:255<u?255:u,a[c+(m-1-h)*m]=u,a[m-1-c+h*m]=u,a[m-1-c+(m-1-h)*m]=u;else if(1===C)for(h=c=0;c<p;++h)p<=h&&(h=0,++c),a[c+h*m]=u=(u=255-255*(p+h<p+c?(h-p)/p:(c-m/2)/p))<1?1:255<u?255:u,a[c+(m-1-h)*m]=u,a[m-1-c+h*m]=u,a[m-1-c+(m-1-h)*m]=u;else for(h=c=0;c<p;++h)p<=h&&(h=0,++c),u=255-255*(p+h<p+c?I((h-m)*(h-m)+(c-m)*(c-m))/(1.13*m):I((c-m)*(c-m)+(h-m)*(h-m))/(1.13*m)),a[c+h*m]=u=u<1?1:255<u?255:u,a[c+(m-1-h)*m]=u,a[m-1-c+h*m]=u,a[m-1-c+(m-1-h)*m]=u;for(c=h=0;h<m;++c)m<=c&&(c=0,++h),o=a[d=c+h*m],o/=l=o+(s=a[(c+p)%m+(h+p)%m*m]),i[d<<=2]=~~(o*t[d]+(s/=l)*r[d]),i[d+1]=~~(o*t[d+1]+s*r[d+1]),i[d+2]=~~(o*t[d+2]+s*r[d+2]),i[d+3]=t[d+3];return i=e!==n?w(i,m,m,e,n):i}}),Xn=(Pn=L).MODE,R=Math,Pn.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:Xn.COLOR,path:Pn.Path,init:function(t,e,n,r,i){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==r?1e-6:+r,this.border=null!=i?i||0:null,this.mode=Xn.COLOR},serialize:function(){return{color:this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var r,i,a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y,w,I,b,A,R=this.mode||Xn.COLOR,x=this.color||0,S=this.border,E=null!=S,L=this.x||0,M=this.y||0,T=Pn.Color.RGB2HSV,G=Pn.Color.HSV2RGB;if(!(L<0||e<=L||M<0||n<=M)){if(p=t[c=(L<<=2)+(M=M*e<<2)],g=t[c+1],_=t[c+2],y=0,w=1,f=x>>>16&255,d=x>>>8&255,m=255&x,E){if(E=S>>>8&255,C=255&S,p===(S=S>>>16&255)&&g===E&&_===C)return t;p=S,g=E,_=C,y=1,w=0}else if(Xn.COLOR===R&&p===f&&g===d&&_===m)return t;if(b=(S=C1(t,e,0,2,_1(p,g,_,y,w,255*(1<=this.tolerance?.999:this.tolerance)),0,L,M)).mask,Xn.MASK===R||Xn.COLORMASK===R)for(A=Xn.MASK===R,c=i=r=0,h=t.length;c<h;c+=4,++r)e<=r&&(r=0,i+=e),b[(u=r+i)>>>5]&1<<(31&u)?A&&(t[c]=f,t[c+1]=d,t[c+2]=m):(t[c]=0,t[c+1]=0,t[c+2]=0);else if(Xn.HUE===R)for(a=(I=S.box)[0]>>>2,o=I[1]>>>2,s=I[2]>>2,l=I[3]>>>2,v=new jn(3),r=a,i=o;i<=l;)b[(u=r+i)>>>5]&1<<(31&u)&&(v[0]=t[c=u<<2],v[1]=t[c+1],v[2]=t[c+2],T(v,0,1),v[0]=x,G(v,0,1),t[c]=0|v[0],t[c+1]=0|v[1],t[c+2]=0|v[2]),++r>s&&(r=a,i+=e);else for(a=(I=S.box)[0]>>>2,o=I[1]>>>2,s=I[2]>>2,l=I[3]>>>2,r=a,i=o;i<=l;)b[(u=r+i)>>>5]&1<<(31&u)&&(t[c=u<<2]=f,t[c+1]=d,t[c+2]=m),++r>s&&(r=a,i+=e)}return t}}),Pn.FloodFillFilter=Pn.ColorFillFilter,Pn.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:Xn.TILE,hasInputs:!0,path:Pn.Path,init:function(t,e,n,r,i,a,o){this.x=t||0,this.y=e||0,this.offsetX=r||0,this.offsetY=i||0,n&&this.setInput("pattern",n),this.tolerance=null==a?1e-6:+a,this.border=null!=o?o||0:null,this.mode=Xn.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var r=this.x||0,i=this.y||0;if(!(r<0||e<=r||i<0||n<=i)&&(S=this.input("pattern"))){var a,o,s,l,u,c,h,f,d,m,p,g,_,C,v,y=this.mode||Xn.TILE,w=this.border,I=S[0],b=S[1],A=S[2],R=this.offsetX||0,x=this.offsetY||0,S=t[u=(r<<=2)+(i=i*e<<2)],E=t[u+1],L=t[u+2],M=0,T=1;if(null!=w){if(_=w>>>8&255,a=255&w,S===(w=w>>>16&255)&&E===_&&L===a)return t;S=w,E=_,L=a,M=1,T=0}if(C=(w=C1(t,e,0,2,_1(S,E,L,M,T,255*(1<=this.tolerance?.999:this.tolerance)),0,r,i)).mask,h=(_=w.box)[0]>>>2,f=_[1]>>>2,d=_[2]>>>2,m=_[3]>>>2,Xn.STRETCH===y)for(p=b/(d-h+1),g=A/(m-f+e),o=h,s=f;s<=m;)C[(l=o+s)>>>5]&1<<(31&l)&&(t[u=l<<2]=I[c=(p*(o-h)|0)+(g*(s-f)|0)*b<<2],t[u+1]=I[c+1],t[u+2]=I[c+2]),++o>d&&(o=h,s+=e);else{for(;R<0;)R+=b;for(;x<0;)x+=A;for(d=d-h+1,s=o=0,v=f;v<=m;)C[(l=o+h+v)>>>5]&1<<(31&l)&&(t[u=l<<2]=I[c=(o+R)%b+(s+x)%A*b<<2],t[u+1]=I[c+1],t[u+2]=I[c+2]),++o>=d&&(o=0,v+=e,++s)}}return t}}),zn=Pn.Array32I,Wn=Pn.Array32U,jn=Pn.Array32F,qn=Pn.Array8U,Vn=R.ceil,Kn=R.min,Qn=R.max,x=R.abs,Jn=(Zn=L).MODE,tr=Zn.Array32F,er=Math,nr=er.min,rr=er.max,ir=er.abs,ar=er.cos,or=Zn.CONST.toRad,Zn.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:Jn.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,r){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!r,this.mode=Jn.COLOR},path:Zn.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var r=t.length>>>2,i=this.mode||Jn.COLOR,a=this.color,o=nr(.999,rr(0,this.tolerance||0)),r=new tr(r),s=(null!=a&&(Jn.HUE===i?a=ar(or*a):Jn.COLOR===i&&(a=1e4*((p=(a>>>16&255)/255)+(c=(a>>>8&255)/255)+(f=(255&a)/255))/3+1e3*(p+c)/2+100*(c+f)/2+10*(p+f)/2+p)),o=function(t,e,n,r,i){var a,o,s=Zn.MODE,l=Zn.Color.hue,u=Zn.Color.intensity,c=er.cos,h=Zn.CONST.toRad,f=(t.length,n.length);if(0<e)if(s.HUE===i)for(o=a=0;o<f;a+=4,++o)n[o]=0===t[a+3]?1e4:c(h*l(t[a],t[a+1],t[a+2]));else if(s.INTENSITY===i)for(r*=255,o=a=0;o<f;a+=4,++o)n[o]=0===t[a+3]?1e4:u(t[a],t[a+1],t[a+2]);else if(s.GRAY===i)for(r*=255,o=a=0;o<f;a+=4,++o)n[o]=0===t[a+3]?1e4:t[a];else for(r=1e4*r+1e3*r+100*r+10*r+r,o=a=0;o<f;a+=4,++o)n[o]=0===t[a+3]?1e5:1e4*(t[a]+t[a+1]+t[a+2])/3/255+1e3*(t[a]+t[a+1])/2/255+100*(t[a+1]+t[a+2])/2/255+10*(t[a]+t[a+2])/2/255+t[a]/255;else if(s.HUE===i)for(o=a=0;o<f;++a,++o)n[o]=c(h*t[a]);else for(r*=255,o=a=0;o<f;++a,++o)n[o]=t[a];return r}(t,2,r,o,i),t),l=e,u=n,c=2,h=r,f=this.connectivity,d=o,m=a,p=this.invert;c|=0;var g,_,C,v,y,w,I,b,A,R,x=s.length,S=x>>>c,E=8===f,L=null,M=null!=m,T=2*d;for(I=new Array(S),L=M?new v1:null,I[0]=M&&ir(d+h[0]-m)>T?L:new v1,C=1;C<l;++C)I[C]=M&&ir(d+h[C]-m)>T?L:ir(d+h[C]-h[C-1])<=T?I[C-1]:new v1;for(v=1,y=l;v<u;++v,y+=l)for(I[y]=M&&ir(d+h[y]-m)>T?L:ir(d+h[y]-h[y-l])<=T?I[y-l]:new v1,C=1;C<l;++C)M&&ir(d+h[y+C]-m)>T?I[y+C]=L:(_=L!==I[y+C-1]&&ir(d+h[y+C]-h[y+C-1])<=T?I[y+C-1]:null,E&&L!==I[y-l+C-1]&&ir(d+h[y+C]-h[y-l+C-1])<=T&&(null!=_?w1(_,I[y-l+C-1]):_=I[y-l+C-1]),L!==I[y-l+C]&&ir(d+h[y+C]-h[y-l+C])<=T&&(null!=_?w1(_,I[y-l+C]):_=I[y-l+C]),I[y+C]=null!=_?_:new v1,E&&L!==I[y+C-1]&&L!==I[y-l+C]&&ir(d+h[y+C-1]-h[y-l+C])<=T&&w1(I[y+C-1],I[y-l+C]));for(R=p?(A=-255,255):(A=255,0),w=null!=L?(L.id=0,1):0,C=0;C<S;++C)I[C]=y1(I[C]),I[C].id<0&&(I[C].id=w++);if(c)for(g=C=0;g<x;g+=4,++C)b=R+A*I[C].id/w|0,s[g]=s[g+1]=s[g+2]=b;else for(C=0;C<x;++C)b=R+A*I[C].id/w|0,s[C]=b;return s}}),v1.prototype={constructor:v1,id:0,root:null},sr=L,lr=Math.round,sr.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,lowpass:!0,path:sr.Path,init:function(t,e,n){this.low=arguments.length<1?2.5:+t,this.high=arguments.length<2?7.5:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},apply:function(t,e,n){return sr.Util.Filter.gradient(t,e,n,2,0,this.lowpass,0,lr(100*this.low),lr(100*this.high),100,1e3,1e5)}}),ur=L,E=Math,cr=E.abs,yt=E.max,wt=E.min,E.floor,hr=E.round,fr=E.sqrt,ur.Util.Array.typed,dr=ur.Util.Array.typed_obj,mr=Array.prototype.push,ur.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,r,i,a,o){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==r?.5:+r,this.minNeighbors=null==i?1:+i,this.doCannyPruning=void 0===a||!!a,this.tolerance=null==o?.2:+o,this._haarchanged=!!this.haardata},path:ur.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh};return t._haarchanged&&(e.haardata=dr(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=dr(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e},metaData:function(t){return t&&ur.isWorker?dr(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?dr(t,1):t,this},apply:function(t,e,n,r){var i,a,o,s,l,u,c,h,f,d,m,p,g=this;return g.haardata&&(i=t.length>>>2,p=g.selection||null,a=ur.Array32F,u=l=s=o=null,m=ur.Util.Filter,p=p?(d=p[4]?(f=e-1,n-1):f=1,c=wt(e-1,yt(0,p[0]*f)),h=wt(n-1,yt(0,p[1]*d)),f=wt(e-1,yt(0,p[2]*f)),wt(n-1,yt(0,p[3]*d))):(h=c=0,f=e-1,n-1),r&&r.haarfilter_SAT?(o=r.haarfilter_SAT,s=r.haarfilter_SAT2,l=r.haarfilter_RSAT):(m.sat(t,e,n,2,0,o=new a(i),s=new a(i),l=new a(i)),r&&(r.haarfilter_SAT=o,r.haarfilter_SAT2=s,r.haarfilter_RSAT=l)),g.doCannyPruning&&(r&&r.haarfilter_GSAT?u=r.haarfilter_GSAT:(u=m.gradient(t,e,n,2,0,1,1),r&&(r.haarfilter_GSAT=u))),(d=new Array(10)).count=0,m.haar_detect(d,e,n,c,h,f,p,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,o,l,s,u,g.cannyLow,g.cannyHigh),d.length>d.count&&(d.length=d.count),g.meta={objects:m.merge_features(d,g.minNeighbors,g.tolerance)}),t}}),ur.Util.Filter.haar_detect=function(t,e,F,D,B,Y,k,U,$,P,X,n,r,i,a,z,W){for(var j,q,o,s,l,u,V,K,Q,c,h,f,d,Z,J,m,p,g,_,tt,et,nt,rt,it,C,v,at,y,ot,st,lt,w,I,b,A,R,x,S,E,L,M,T,G,ut=null!=a,ct=Y-D+1|0,ht=k-B+1|0,ft=(Y=e*F)-1,dt=U.stages,mt=dt.length,pt=U.size1,gt=U.size2,H=e-1,O=Y-e,_t=0|D,Ct=0|B,vt=wt(ct/pt,ht/gt),N=$;N<=vt;N*=P)for(j=(o=N*pt|0)*X|0,K=(s=N*gt|0)*e,Z=ct-o,J=ht-s,p=1/(o*s),V=(u=Ct)*(Q=(q=s*X|0)*e);u<J;u+=q,V+=Q)for(l=_t;l<Z;l+=j)if(h=(c=l-1+V-e)+o,d=(f=c+K)+o,c=wt(ft,yt(0,c)),h=wt(ft,yt(0,h)),f=wt(ft,yt(0,f)),d=wt(ft,yt(0,d)),!ut||!((_=p*(a[d]-a[f]-a[h]+a[c]))<z||W<_)){for(_=p*(n[d]-n[f]-n[h]+n[c]),g=1<(g=p*(i[d]-i[f]-i[h]+i[c])-_*_)?fr(g):g,tt=!1,m=0;m<mt;++m){for(nt=(et=dt[m]).thres,it=(rt=et.trees).length,C=G=0;C<it;++C)for(at=rt[C].feats,v=0;;){if(st=(ot=(y=at[v]).rects).length,lt=y.thres,w=0,y.tilt)for(I=0;I<st;++I)A=l+N*(b=ot[I])[0]|0,R=(u-1+N*b[1]|0)*e,x=l+N*(b[0]+b[2])|0,S=(u-1+N*(b[1]+b[2])|0)*e,E=l+N*(b[0]-b[3])|0,L=(u-1+N*(b[1]+b[3])|0)*e,M=l+N*(b[0]+b[2]-b[3])|0,T=(u-1+N*(b[1]+b[2]+b[3])|0)*e,A=wt(H,yt(0,A)),x=wt(H,yt(0,x)),E=wt(H,yt(0,E)),M=wt(H,yt(0,M)),R=wt(O,yt(0,R)),S=wt(O,yt(0,S)),L=wt(O,yt(0,L)),T=wt(O,yt(0,T)),w+=b[4]*(r[M+T]-r[E+L]-r[x+S]+r[A+R]);else for(I=0;I<st;++I)A=l-1+N*(b=ot[I])[0]|0,x=l-1+N*(b[0]+b[2])|0,R=e*(u-1+N*b[1]|0),S=e*(u-1+N*(b[1]+b[3])|0),A=wt(H,yt(0,A)),x=wt(H,yt(0,x)),R=wt(O,yt(0,R)),S=wt(O,yt(0,S)),w+=b[4]*(n[x+S]-n[A+S]-n[x+R]+n[A+R]);if(w*p<lt*g){if(y.has_l){G+=y.l_val;break}v=y.l_node}else{if(y.has_r){G+=y.r_val;break}v=y.r_node}}if(!(tt=nt<G))break}tt&&(t.count===t.length&&mr.apply(t,new Array(10)),t[t.count++]={x:l,y:u,width:o,height:s})}},ur.Util.Filter.merge_features=function(t,e,n){for(var r,i,a,o,s,l,u,c,h,f,d,m,p=t.length,g=new Array(p),_=[],C=0,v=!1,y=0;y<p;++y)g[y]=0;for(y=0;y<p;++y){for(v=!1,a=0;a<y;++a)u=t[a],c=t[y],h=(h=n)*(wt(u.width,c.width)+wt(u.height,c.height))*.5,cr(u.x-c.x)<=h&&cr(u.y-c.y)<=h&&cr(u.x+u.width-c.x-c.width)<=h&&cr(u.y+u.height-c.y-c.height)<=h&&(v=!0,g[y]=g[a]);v||(g[y]=C,++C)}for(r=new Array(C),i=new Array(C),y=0;y<C;++y)r[y]=0,i[y]={x:0,y:0,width:0,height:0};for(y=0;y<p;++y)++r[l=g[y]],f=i[l],d=t[y],f.x+=d.x,f.y+=d.y,f.width+=d.width,f.height+=d.height;for(y=0;y<C;++y)e<=(o=r[y])&&(l={x:(s=1/(o+o))*(2*i[y].x+o),y:s*(2*i[y].y+o),width:s*(2*i[y].width+o),height:s*(2*i[y].height+o)},_.push(l));for(p=_.length,y=0;y<p;++y)for(a=y+1;a<p;++a)!_[y].isInside&&I1(_[y],_[a],n)&&(_[y].isInside=!0),!_[a].isInside&&I1(_[a],_[y],n)&&(_[a].isInside=!0);for(y=p;0<=--y;)_[y].isInside?_.splice(y,1):((m=_[y]).x=hr(m.x),m.y=hr(m.y),m.width=hr(m.width),m.height=hr(m.height),m.area=m.width*m.height);return _.sort(b1)},L});
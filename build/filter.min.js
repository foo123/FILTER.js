/**
*
*   FILTER.js
*   @version: 1.13.0
*   @built on 2025-03-01 16:12:29
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function P(){"use strict";var a,R,I,L,D,E,G,F,O,H,M,ot,lt,st,k,B,j,X,W,V,$,q,Z,J,Q,tt,et,nt,rt,it,ut,ct,ft,ht,z,mt,pt,dt,gt,_t,xt,vt,Ct,wt,At,St,Rt,c,It,Lt,Dt,Et,Tt,Mt,Gt,Ft,Ot,Nt,Ht,Ut,Bt,Yt,zt,kt,Pt,jt,h,Xt,Wt,$t,qt,m,Vt,Kt,Zt,Jt,Qt,te,ee,ne,re,ie,ae,oe,p,le,se,ue,g,ce,fe,he,me,pe,de,ge,_e,xe,ve,ye,be,Ce,U,we,Ae,Se,Re,_,Ie,Le,De,x,Ee,Te,Me,Ge,Fe,Oe,Ne,u,He,Ue,o,l,Be,Ye,ze,ke,Pe,je,v,Xe,We,$e,qe,Ve,Ke,Ze,Je,Qe,tn,en,nn,rn,an,on,ln,sn,un,cn,fn,hn,mn,pn,dn,gn,_n,K,xn,vn,yn,bn,Cn,wn,An,Sn,Rn,In,Ln,Dn,En,Tn,Mn,Gn,Fn,On,Nn,Hn,Un,Bn,Yn,zn,kn,Pn,jn,Xn,Wn,$n,qn,Vn,Kn,Zn,Jn,Qn,tr,er,nr,rr,ir,ar,or,lr,sr,ur,cr,fr,hr,mr,pr,dr,gr,_r,xr,t,vr,yr,br,Cr,wr,Ar,e,Sr,Rr,Ir,Lr,Dr,Er,Tr,Mr,Gr,Fr,Or,Nr,Hr,Ur,Br,Yr,zr,n,kr,Pr,jr,Xr,Wr,$r,qr,Vr,Kr,Zr,Jr,Qr,ti,r,ei,ni,ri,ii,ai,oi,li,y,si,ui,ci,fi,i,hi,mi,pi,di,gi,_i,b,xi,vi,yi,C,bi,Ci,wi,Ai,Si,Ri,Ii,Li,Di,Ei,Ti,Mi,Gi,w,yt,bt,Fi,Oi,Ni,Hi,Ui,Bi,Yi,zi,ki,Pi,ji,Xi,at,Wi,$i,qi,Vi,Ki,Zi,N,Ji,Qi,ta,ea,na,ra,ia,A={VERSION:"1.13.0"};function aa(t,e,n){arguments.length<2&&(e=t,t=null),I.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var r,i,a,o=I.call(e,"constructor")?e.constructor:function(){};for(r in t?(o[R]=Object.create(t[R]),o[R].$super=(i=t,a={},function(t,e){var n=":"+t;return 1===a[n]?(i[R].$super||L).call(this,t,e):(a[n]=1,t=("constructor"===t?i:i[R][t]||L).apply(this,e||[]),a[n]=0,t)})):o[R].$super=L,o[R].constructor=o,e)I.call(e,r)&&"constructor"!==r&&(o[R][r]=e[r]);if(n)for(r in n)I.call(n,r)&&(o[r]=n[r]);return o}function oa(t){t.preventDefault&&t.preventDefault()}function la(t,e,n){return n<t?n:t<e?e:t}function sa(t,e,n,r,i){n=n||0,r=r||0;for(var a,o=i?i-r+1:e.length,l=31&o,s=0;s<l;++s)t[s+n]=e[r+s];for(a=l;a<o;a+=32)t[(s=a)+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],++s}function ua(t,e,n){for(var r=t>>>1,i=e>>>1,a=t*e,o=-1/(2*n*n),l=new st(a),s=V.exp,u=0,c=-r,f=-i,h=0;h<a;++h,++c)r<c&&(c=-r,++f),l[h]=s(o*(c*c+f*f)),u+=l[h];for(h=0;h<a;++h)l[h]/=u;return l}function ca(t,e,n,r,N,i,H,U,B,a,Y,z){null==a&&(z=(a=1)*(Y=510));for(var o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,k,A,S,P,R,I,j,L,X,D,W,E,T,$=n.length,q=$>>>i,V=r-1,K=N-1,M=new st(q),G=1,F=1,O=r;F<K&&!(V<=G&&(G=1,O+=r,K<=++F));++G)_=(s=G+O)-1,x=s+1,C=(d=s-r)-1,v=1+d,b=(g=s+r)-1,y=g+1,u=t[s],c=e[s],f=Q(u),h=Q(c),T=J(f,h),E=Z(f,h),m=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[d]),Q(e[d])),E=Z(Q(t[d]),Q(e[d])),d=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[g]),Q(e[g])),E=Z(Q(t[g]),Q(e[g])),g=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[_]),Q(e[_])),E=Z(Q(t[_]),Q(e[_])),_=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[x]),Q(e[x])),E=Z(Q(t[x]),Q(e[x])),x=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[v]),Q(e[v])),E=Z(Q(t[v]),Q(e[v])),v=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[y]),Q(e[y])),E=Z(Q(t[y]),Q(e[y])),y=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[b]),Q(e[b])),E=Z(Q(t[b]),Q(e[b])),b=T?T*(1+.43*E/T*E/T):0,T=J(Q(t[C]),Q(e[C])),E=Z(Q(t[C]),Q(e[C])),C=T?T*(1+.43*E/T*E/T):0,E=u*c<=0?h<=f?(p=f*m)>=Q(c*v-(u+c)*x)&&p>Q(c*b-(u+c)*_):(p=h*m)>=Q(u*v-(c+u)*d)&&p>Q(u*b-(c+u)*g):h<=f?(p=f*m)>=Q(c*y+(u-c)*x)&&p>Q(c*C+(u-c)*_):(p=h*m)>=Q(u*y+(c-u)*g)&&p>Q(u*C+(c-u)*d),M[s]=E?Y<=m?z:a*m:0;if(H){for(l=G=0;G<r;++G)l+=M[G],M[G]=l;for(G=r,l=O=0;G<q;++G,++O)r<=O&&(l=O=0),l+=M[G],M[G]=M[G-r]+l;return M}if(i)for(G=0;G<$;G+=4)n[G]=n[G+1]=n[G+2]=0;else for(G=0;G<$;++G)n[G]=0;for(O=o=F=G=0;o<q;O=++o<<i,++G)if(r<=G&&(G=0,++F),!(0<n[O]||M[o]<B)){w=G,S=F,D=O,0;do{for(n[D]=i?n[D+1]=n[D+2]=255:255,k=w===V?w:w+1,P=S===K?S:S+1,A=0===S?S:S-1,R=0===w?w:w-1,L=j=(I=A)*r,W=0;R<=k&&I<=P;){if(D=(X=R+L)<<i,(I!==S||R!==w)&&0===n[D]&&M[X]>=U){w=R,S=I,W=1;break}L+=r,P<++I&&(I=A,L=j,++R)}}while(W)}return n}function fa(t,e,n,r,i){var a,o,l,s,u,c,f,h,m;if(r<=n)return!0===i?[n,0]:n;for(l=0,h=n;h<=r;++h)l+=h*t[h]/e;for(c=t[m=n],f=n*t[n]/e,s=(a=c/e)*(o=1-a)*q((l-f)/o-f/a,2),h=n+1;h<=r;++h)c+=t[h],f+=h*t[h]/e,s<(u=(a=c/e)*(o=1-a)*q((l-f)/o-f/a,2))&&(s=u,m=h);return!0===i?[m,s]:m}function ha(t,e,n,r,i){for(var a,o,l={},s=0;s<i;++s)1!==l[s]&&(o=t[a=function(t,e){for(var n=0;1<e;)n=(n<<1)+(1&t),t>>=1,e>>=1;return n}(s,i)],n[a]=t[s],n[s]=o,o=e[a],r[a]=e[s],r[s]=o,l[a]=1)}function ma(t,e,n,N,r,i){if(!(n<=0)){var H=!1;if(null==r&&(r=new t.constructor(n),i=new e.constructor(n),H=!0),n&n-1){var a,o,l,s=t,u=e,c=n,U=N,f=r,h=i;if(1===c)f[0]=s[0]||0,h[0]=u[0]||0;else{for(a=0;a<c;++a)f[a]=0,h[a]=0;var m,p,d,g,_,x,v=function(t){for(var e=V.sqrt(t),n=3;n<=e;){if(0==t%n)return n;n+=2}return t}(c),y=c/v,B=1/V.sqrt(v),b=new s.constructor(y),C=new u.constructor(y),w=new s.constructor(y),A=new u.constructor(y);for(o=0;o<v;++o){for(a=0;a<y;++a)b[a]=s[a*v+o]||0,C[a]=u[a*v+o]||0;for(1<y&&(ma(b,C,y,U,w,A),l=b,b=w,w=l,l=C,C=A,A=l),m=V.cos(2*tt*o/c),p=(U?-1:1)*V.sin(2*tt*o/c),d=1,a=g=0;a<c;++a)_=B*b[a%y],x=B*C[a%y],f[a]+=d*_-g*x,h[a]+=d*x+g*_,_=d*m-g*p,x=g=d*p+g*m,d=_,g=x=g}}}else{var Y,z,S,k,R,I,L,D,E,T,M,P,j,X,W,$=n,q=N,G=r,F=i,O=1;for(ha(t,e,G,F,$);O<$;){for(Y=function(t){var e=ft[t];return null==e&&(ft[t]=e=V.cos(tt/t)),e}(O),z=(q?-1:1)*function(t){var e=ct[t];return null==e&&(ct[t]=e=V.sin(tt/t)),e}(O),k=$/(2*O),S=0;S<k;++S)for(D=1,R=E=0;R<O;++R)M=(T=2*S*O+R)+O,P=G[T]||0,j=F[T]||0,I=G[M]||0,L=F[M]||0,X=D*I-E*L,W=E*I+D*L,G[T]=et*(P+X),F[T]=et*(j+W),G[M]=et*(P-X),F[M]=et*(j-W),L=D*z+E*Y,D=I=D*Y-E*z,E=L;O<<=1}}return H?{r:r,i:i}:void 0}}function pa(t,e,n,r,i,a,o){if(!(n<=0||r<=0)){var l,s,u,c=!1,f=t.constructor,h=e.constructor,m=n*r,p=new f(n),d=new h(n),g=new f(r),_=new h(r),x=new f(n),v=new h(n),y=new f(r),b=new h(r);for(null==a&&(a=new f(m),o=new h(m),c=!0),u=s=0;s<r;++s,u+=n){for(l=0;l<n;++l)p[l]=t[l+u]||0,d[l]=e[l+u]||0;for(ma(p,d,n,i,x,v),l=0;l<n;++l)a[l+u]=x[l],o[l+u]=v[l]}for(l=0;l<n;++l){for(u=s=0;s<r;++s,u+=n)g[s]=a[l+u],_[s]=o[l+u];for(ma(g,_,r,i,y,b),u=s=0;s<r;++s,u+=n)a[l+u]=y[s],o[l+u]=b[s]}return c?{r:a,i:o}:void 0}}function da(t,e,n,r,i,a,o,l,s){s=s||0;var u,c,f,h,m,p,d=t.length,g=1<<(l=l||0),_=1/0,x=-1/0,v=0,y=0;for(a&&(m=new Array(d>>>l)),o&&(p=new Array(d>>>l)),c=f=u=0;u<d;u+=g,++c)e<=c&&(c=0,++f),h=t[u+s],a&&h<=_&&(null==r||h<=r)&&(h<_&&(_=h,v=0),m[v++]={x:c,y:f}),o&&x<=h&&(null==i||i<=h)&&(x<h&&(x=h,y=0),p[y++]={x:c,y:f});return a&&o?(m.length=v,p.length=y,{min:_,minpos:m,max:x,maxpos:p}):a?(m.length=v,{min:_,minpos:m}):o?(p.length=y,{max:x,maxpos:p}):void 0}function ga(t,e,n){var r=e.width*n,n=e.height*n;return t.x>=e.x-r&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+r&&t.y+t.height<=e.y+e.height+n}function _a(t,e,n,r,i,a,o){var l;return e<=0||n<=0||o<i||a<r||o<0||a<0?0:(l=e-1,n=n-1,r=r<0?0:l<r?l:r,i=i<0?0:n<i?n:i,a=a<0?0:l<a?l:a,o=o<0?0:n<o?n:o,t?(l=e*--i,t[a+(n=e*o)]-(--r<0?0:t[r+n])-(i<0?0:t[a+l])+(r<0||i<0?0:t[r+l])):(o-i+1)*(a-r+1))}function Y(t,e,n,r,i,a,o,l){t.area+=l*_a(null,e,n,r,i,a,o),t.sum+=l*_a(t.sat,e,n,r,i,a,o),t.sat2&&(t.sum2+=l*_a(t.sat2,e,n,r,i,a,o))}function xa(N,t,e,n,r,i,a,o,l,s,H){if(!(t<=0||e<=0)){var u,c,f=V.min(n,i,o),h=V.min(r,a,l),m=V.max(n,i,o),p=V.max(r,a,l),d=m-f,g=p-h;if(s=s||0,d&&g)if(s<=1)Y(N,t,e,f,h,m,p,H/2);else{var _,x,v,y,b,C,w=n===f&&(i===m&&a===r||o===m&&l===r)?r:i===f&&(n===m&&r===a||o===m&&l===a)?a:l,r=(a=r===h&&(a===p&&i===n||l===p&&o===n)?n:a===h&&(r===p&&n===i||l===p&&o===i)?i:o)===f&&w===h?(c=g<d?(u=m,f):(u=p,h),-1):a===m&&w===p?(c=u=g<d?m:p,-1):(c=a===m&&w===h?g<d?(u=f,m):u=h:g<d?u=f:(u=h,p),1),A=N,S=t,R=e,I=s,U=f,B=h,L=m,D=p,E=d,T=g,M=r,G=u,F=c,O=H;if(T<E){for(x=V.max(1,V.round((T-I+1)/I)||0),_=1,y=V.min((v=B)+x,D);_<=I;++_){if(C=V.round(G+M*((y-B)/T)*E),Y(A,S,R,V.min(C,F),v,V.max(C,F),y,O),D<=y)return;v=V.min(y+1,D),y=V.min(v+x,D)}y<D&&(C=V.round(G+M*((++y-B)/T)*E),Y(A,S,R,V.min(C,F),y,V.max(C,F),D,O))}else{for(x=V.max(1,V.round((E-I+1)/I)||0),_=1,C=V.min((b=U)+x,L);_<=I;++_){if(y=V.round(G+M*((C-U)/E)*T),Y(A,S,R,b,V.min(y,F),C,V.max(y,F),O),L<=C)return;b=V.min(C+1,L),C=V.min(b+x,L)}C<L&&(y=V.round(G+M*((++C-U)/E)*T),Y(A,S,R,C,V.min(y,F),L,V.max(y,F),O))}}}}function va(t,e){for(var n=t.length,r=new(e||Array)(n),i=0;i<n;++i)r[i]=t[i];return r}function ya(t,e){if(Array!==M.Array32F)for(var n=0,r=ht.length;n<r;++n)if(e instanceof M[ht[n]])return{typed:ht[n],array:va(e,Array)};return e}function ba(t,e,i){t.replace(Ct,"").replace(wt,"").replace(e,function(t,e,n,r){return i[n]={name:n,type:e+(r||""),loc:0},t})}function Ca(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),n}function wa(t,e){var n,r,i,a,o=this;if(-1===t.indexOf("precision ")&&(t=vt+"\n"+t),o.vertexSource=xt,o.fragmentSource=t,n=Ca(e,o.vertexSource,e.VERTEX_SHADER),r=Ca(e,o.fragmentSource,e.FRAGMENT_SHADER),o.id=e.createProgram(),e.attachShader(o.id,n),e.attachShader(o.id,r),e.linkProgram(o.id),e.getProgramParameter(o.id,e.LINK_STATUS)||e.isContextLost()){for(i in o.uniform={},o.attribute={},ba(o.vertexSource,At,o.attribute),ba(o.vertexSource,St,o.uniform),ba(o.fragmentSource,St,o.uniform),o.attribute)o.attribute[i].loc=e.getAttribLocation(o.id,i);for(a in o.uniform)o.uniform[a].loc=e.getUniformLocation(o.id,a)}else z.error(e.getProgramInfoLog(o.id)),z.error(e.getShaderInfoLog(n)),z.error(e.getShaderInfoLog(r)),z.log(t),e.deleteShader(n),e.deleteShader(r),e.deleteProgram(o.id),o.id=null}function Aa(_){function t(){return x}var r=this,e=[],i=null,a={},x={};r.begin=function(){return i={_prev:null,_next:null,_save:null,_inputs:{},_input:"img",_output:null,io:t,iterations:1,instance:_,shader:null,program:null,init:function(t,e,n,r,i,a){var o,l,s;this.program=this.shader&&this.shader.substring?(s=t,o=this.shader,a=a,o=dt(o),(l=a?a[o]:null)||(l=new wa(o,s),a&&(a[o]=l)),l):null,this.program&&this.program.id&&this._save&&(x[this._save]=((s=this)._prev&&s._prev._output&&pt.call(x,s._prev._output)?x[s._prev._output]:null)||{name:this._save,tex:null,data:i?Ma(t,n,r):z.Util.Array.copy(e),width:n,height:r})},inputs:function(a,o,l,s,u,c){var f=this,h=f._inputs||{},m=f._input,p=f.program,d=p.uniform,g=0;return Object.keys(h).forEach(function(t){if("*"===t&&h["*"].setter)c=h["*"].setter(_,o,l,s,u,x,a,p,c)||c;else if(pt.call(d,t)||pt.call(d,h[t].iname)){var t=h[t],e=pt.call(d,t.name)?t.name:t.iname,n=d[e].type,r=d[e].loc,i=null==t.setter&&pt.call(x,t.name)?x[t.name]:"function"==typeof t.setter?t.setter(_,o,l,s,u,x):t.setter;if("sampler2D"===n)m===t.iname?!t.setter&&f._prev&&t.name===f._prev._output||(i.tex||(i.tex=Ia(a,i.data,i.width,i.height)),c={fbo:null,tex:i.tex,w:i.width,h:i.height}):(++g,i.tex?(a.activeTexture(a.TEXTURE0+g),a.bindTexture(a.TEXTURE_2D,i.tex)):i.tex=Ia(a,i.data,i.width,i.height,g),a.uniform1i(r,g));else switch(n){case"ivec4":a.uniform4iv(r,new _t(i||[0,0,0,0]));break;case"vec4":a.uniform4fv(r,new gt(i||[0,0,0,0]));break;case"ivec3":a.uniform3iv(r,new _t(i||[0,0,0]));break;case"vec3":a.uniform3fv(r,new gt(i||[0,0,0]));break;case"ivec2":a.uniform2iv(r,new _t(i||[0,0]));break;case"vec2":a.uniform2fv(r,new gt(i||[0,0]));break;case"int[":a.uniform1iv(r,new _t(i||[0]));break;case"float[":a.uniform1fv(r,new gt(i||[0]));break;case"int":a.uniform1i(r,i||0);break;default:a.uniform1f(r,i||0)}}}),c},output:function(t,e){if(this._islast){for(var n in x)x[n].name&&x[n].data&&(Ra(t,x[n].tex),x[n].tex=null,x[n].data=null);x={}}else this._output&&(x[this._output]={name:this._output,tex:null,data:Ma(t,e.w,e.h),width:e.w,height:e.h})},_islast:!0},r},r.shader=function(t,e,n){return i&&(t&&pt.call(a,t)&&(t=a[t]),n&&t&&(a[n]=t),i.shader=t||null,i.iterations=e||1),r},r.dimensions=function(n){return i&&n&&(i.dimensions=function(t,e){return n(t,e,x)}),r},r.save=function(t){return i&&t&&(i._save=t),r},r.input=function(t,e,n){return i&&t&&(!0===e?i._input=t:i._inputs[t]={name:t,setter:e,iname:n||t}),r},r.output=function(t){return i&&t&&(i._output=t),r},r.end=function(){return i&&(e.length&&(i._prev=e[e.length-1],e[e.length-1]._next=i,e[e.length-1]._islast=!1),e.push(i)),i=null,r},r.code=function(){return e}}function Sa(t,e,n){var r=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),r}function Ra(t,e){e&&t.deleteTexture(e)}function Ia(t,e,n,r,i,a,o){var l=null!=o?o:Sa(t,n,r);return null!=i?(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,l)):null!=o&&t.bindTexture(t.TEXTURE_2D,l),a?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,e),l}function La(t,e,n){var r=Sa(t,e,n),i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{fbo:i,tex:r,w:e,h:n}}function Da(t,e){var n,r;e&&(e.fbo&&(n=t,(r=e).fbo&&(n.bindFramebuffer(n.FRAMEBUFFER,r.fbo),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0),n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null)),r=t,n=e.fbo)&&r.deleteFramebuffer(n),e.tex&&Ra(t,e.tex),e.fbo=null,e.tex=null)}function Ea(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e||null,t.STATIC_DRAW),n}function Ta(t,e){e&&t.deleteBuffer(e)}function Ma(t,e,n,r){return r=r||new z.ImArray(e*n<<2),t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,r),r}function Ga(t,e,n,r){return"if ("+t+">"+e+") {"+n+"="+t+";"+t+"="+e+";"+e+"="+n+";}"}function Fa(t){if(Rt.Browser.isNode)return Buffer.from(t,"base64");for(var e=atob(t),n=new Rt.Array8U(e.length),r=0,i=e.length;r<i;++r)n[r]=e.charCodeAt(r);return n.buffer}function Oa(){}function Na(t){return t&&t.instance&&t.instance.isOn()}function Ha(t,e,n){var r,i,a;return e/=100,e=(1-h.abs(2*(n/=100)-1))*e,r=h.floor((t=t/60)/2),r=e*(1-h.abs(t-2*r-1)),n=n-e/2,t=0<=t&&t<1?(i=e+n,a=r+n,0+n):1<=t&&t<2?(i=r+n,a=e+n,0+n):2<=t&&t<3?(i=0+n,a=e+n,r+n):3<=t&&t<4?(i=0+n,a=r+n,e+n):4<=t&&t<5?(i=r+n,a=0+n,e+n):(i=e+n,a=0+n,r+n),[m(h.round(255*i),0,255),m(h.round(255*a),0,255),m(h.round(255*t),0,255)]}function Ua(t,e,n){var e=(n/=100)*(1-e/200),r=h.min(e,1-e);return Ha(t,0===r?0:100*(n-e)/r,100*e)}function Ba(t,e,n){n=1-n/100;return Ua(t,100-e/n,100*n)}function Ya(t,e,n,r,i){var a,o,l,s,u;return r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=h.max(t,e,n),s=l=h.min(t,e,n),u=1-r,n=0==(o=r-l)?0:a===t?60*(0+(e-n)/o):a===e?60*(2+(n-t)/o):60*(4+(t-e)/o),e=0==(t=(r+l)/2)||1==t?0:(a-t)/h.min(t,1-t),r=0===a?0:o/a,"hwb"===i?[m(h.round(n),0,360),m(100*s,0,100),m(100*u,0,100)]:"hsv"===i?[m(h.round(n),0,360),m(100*r,0,100),m(100*a,0,100)]:[m(h.round(n),0,360),m(100*e,0,100),m(100*t,0,100)]}function za(t,e,n,r){return Ya(t,e,n,r,"hsl")}function ka(t,e,n,r){return Ya(t,e,n,r,"hsv")}function Pa(t,e,n,r){return Ya(t,e,n,r,"hwb")}function ja(t,e,n,r){return r&&(t=m(Wt(t*ie),0,255),e=m(Wt(e*ie),0,255),n=m(Wt(n*ie),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((r=1-t*re)-(e=$t(r,t=1-e*re,r=1-n*re)))*(n=1/(1-e)),(t-e)*n,(r-e)*n,e]}function Xa(t,e,n,r){var i;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(i=1-r)+r)),n=255*(1-(n=n*i+r)),[m(Wt(255*(1-(t=t*i+r))),0,255),m(Wt(e),0,255),m(Wt(n),0,255)])}function Wa(t,e,n){return ne[0]*t+ne[1]*e+ne[2]*n}function $a(t,e,n,r){r=r||6;var i,a,o,l,s,u,c,f=!1,h=!!t.selection;return c=h?(i=t.selection,c=t.width-1,u=t.height-1,a=i[0],o=i[1],l=i[2],s=i[3],c=i[4]?c:1,i=i[4]?u:1,a=+g(a*c),o=+g(o*i),u=(l=+g(l*c))-a+1,(s=+g(s*i))-o+1):(u=t.width,t.height),2&r&&u!==e&&(t.width=ue.round(h?t.width/u*e:e),t.oCanvas.width=+t.width,t._restorable&&(t.iCanvas.width=t.oCanvas.width),f=!0),4&r&&c!==n&&(t.height=ue.round(h?t.height/c*n:n),t.oCanvas.height=+t.height,t._restorable&&(t.iCanvas.height=t.oCanvas.height),f=!0),f}function qa(t,e){var n=t.oCanvas.width,r=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d",t.ctxOpts).getImageData(0,0,n,r),t.iData||(t.iData=t.iCanvas.getContext("2d",t.ctxOpts).createImageData(0,0,n,r)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d",t.ctxOpts).getImageData(0,0,n,r),t.oData||(t.oData=t.oCanvas.getContext("2d",t.ctxOpts).createImageData(0,0,n,r)),t._refresh&=-3)}function Va(t,e){var n,r,i,a,o,l,s;t.selection&&(n=t.selection,s=t.width-1,l=t.height-1,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4]?s:1,n=n[4]?l:1,r=+g(r*s),i=+g(i*n),l=(a=+g(a*s))-r+1,s=(o=+g(o*n))-i+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d",t.ctxOpts).getImageData(r,i,l,s),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d",t.ctxOpts).createImageData(0,0,l,s)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d",t.ctxOpts).getImageData(r,i,l,s),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d",t.ctxOpts).createImageData(0,0,l,s)),t._refresh&=-9)}function Ka(t,e){var e=e?en(e):"",t=en(t.filter||t),n=tn?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(qe)}!function(t,N,y){function e(){}function n(t){var e;return v?{file:__filename,path:__dirname}:w||A?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:U&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:S&&(e=document.getElementsByTagName("script"))&&e.length?((n.link=n.link?n.link:document.createElement("a")).href=e[e.length-1].src,{file:e=n.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var l,r="prototype",i=Object,a=Array,o=Function[r],i=i[r],a=a[r],H=(JSON.parse,JSON.stringify),s=(i.hasOwnProperty,function(t,e){return function(){return t(e)}}),u=o.call.bind(a.slice),o=i.toString,b=function(t){return"function"==typeof t},c=function(t,e){return t instanceof e},f=setTimeout,h=clearTimeout,a=y,m=60,p=0,d=1,g=2,_=3,x=4,i="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,v="undefined"!=typeof global&&"[object global]"===o.call(global),C=v&&void 0!==process.send,w=!i&&!v&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,A=!i&&!v&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,S=!(i||v||A||w||"undefined"==typeof navigator||"undefined"==typeof document),U=(S&&window.opener,S&&(window.self,window.top),"function"==typeof define&&define.amd),R=v||"function"==typeof Worker||"function"==typeof SharedWorker,I=v?t:w||A?self||t:window||t,L=v?module.$deps:w||A?self||this:window||this,B=(v?global:w||A?self:window,C||w||A),D=C&&0===process.listenerCount("message")||w&&!I.onconnect||A&&!I.onmessage,E=D?function t(e){t.handler&&t.handler(C?e:e.data)}:e,T=null,M={},G=(v&&require("os").cpus().length,v?null:void 0!==I.webkitURL?I.webkitURL:void 0!==I.URL?I.URL:null),Y=n(P.moduleUri).file,F=(M[Y]=1,v?((l=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=l)[r]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((l=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=l)[r]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(l.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},l.Shared[r]={constructor:l.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),D&&(w?(I.close=e,I.postMessage=e,I.onconnect=function(t){var e=t.ports[0];I.close=function(){e.close()},I.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",E),e.start()}):A?I.onmessage=E:C&&(I.close=function(){process.exit()},I.postMessage=function(t){process.send(t)},I.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(L)}catch(t){throw t}},process.on("message",E))),function t(e){var r,n,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v;return e instanceof t?e:this instanceof t?(f=c=u=s=l=o=!1,m=0,p=1,_=g=d=h=a=i=n=null,x=y,(r=this).queue=function(t){return arguments.length?(n=t,r):n},r.jumpNext=function(t){n&&n.jumpNext(!1,t)},r.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},r.dispose=function(){n&&(n.dispose(),n=null)},r.task=function(t){return i=t,r},e&&r.task(e),r.run=v=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,x=i(),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,x},r.runWithArgs=function(t){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,x=i.apply(null,t),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,x},r.canRun=function(){return!!i&&!!(!o||l||s||u||c||f)&&!((l||s)&&d<=m||s&&!h||(u||c)&&x===g)},r.iif=function(t,e,n){return(t=b(t)?t():t)?r.task(e):2<arguments.length&&r.task(n),r},r.until=function(t){return x=y,g=t,u=s=l=f=!(c=!(h=null)),r.run=v,r},r.untilNot=function(t){return x=y,_=t,u=s=l=c=!(f=!(h=null)),r.run=v,r},r.loop=function(t,e,n){return x=y,m=e||0,p=n||1,d=t,u=s=f=c=!(l=!(h=null)),r.run=function(){var t=i(m);return m+=p,o=!0,x=t},r},r.each=function(t){return x=y,m=0,p=1,d=(h=t)&&t.length||0,u=l=f=c=!(s=!0),r.run=function(){var t=i(h[m],m);return++m,o=!0,x=t},r},r.recurse=function(t,e){return x=t,g=e,s=l=f=c=!(u=!(h=null)),r.run=function(){var t=i(x);return o=!0,x=t},r},r.isFinished=function(){var t=!o||f||c||l||s||u;return!(t=(t=(t=t&&(c||u)&&x===g?!1:t)&&f&&x!==_?!1:t)&&(l||s)&&d<=m?!1:t)},r.onComplete=function(t){return a=t||null,r},void(r.complete=function(){return a&&b(a)&&a(),r})):new t(e)});function z(t,e){var n,r=t.$queue,i=0;if(t.$runmode=d,r&&r.length){for(t.$running=!0;i<r.length;)(n=r[i])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(r.shift(),n.complete()):++i):r.shift();t.$running=!1,t.$timer=f(s(z,t),t.$interval)}}function k(t,e){var n,r=t.$queue;t.$runmode=x,r&&r.length&&((n=r[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(r.shift(),n.complete())):r.shift(),t.$running=!1,t.$timer=f(s(k,t),t.$interval))}function O(t,e){var n;return c(t,F)?t:b(t)?new F(t):c(this,O)?((n=this).$interval=arguments.length&&parseInt(t,10)||m,n.$timer=null,n.$runmode=p,n.$running=!1,n.$queue=[],void(D&&!1!==e&&n.initThread())):new O(t,e)}O.VERSION="0.5.1",O.Thread=l,O.Task=F,O.MODE={NONE:p,INTERLEAVE:d,LINEAR:g,PARALLEL:_,SEQUENCE:x},O.Platform={UNDEFINED:a,UNKNOWN:0,NODE:1,BROWSER:2},O.supportsMultiThreading=function(){return R},O.isPlatform=function(t){return 1===t?v:2===t?S:void 0},O.isThread=function(t,e){return e=!0!==e||D,1===t?e&&C:2===t?e&&(w||A):e&&B},O.path=n,O.blob=function(t,e){return t&&G?G.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t},O.load=function(t,e,n){if(t){e&&e.length&&O.importScripts(e.join?e.join(","):e),t=t.split(".");for(var r=L;t.length;)t[0]&&t[0].length&&r[t[0]]&&(r=r[t[0]]),t.shift();return r&&I!==r?b(r)?!1!==n?new r:r():r:void 0}return null},O.listen=D?function(t){E.handler=t}:e,O.send=D?function(t){I.postMessage(t)}:e,O.importScripts=D?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var r=t[e];r&&r.length&&1!==M[r]&&(I.importScripts(r),M[r]=1)}}:e,O.close=D?function(){I.close()}:e,O.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,O.serialize=function(r){r=r||new O(0,!1);function t(n){function t(){var t=this,e=arguments;r.step(function(){n.apply(t,e)}),r.$running||r.run(g)}return t.free=function(){return n},t}return t.free=function(){r&&r.dispose(),r=null},t},O[r]={constructor:O,$interval:m,$timer:null,$queue:null,$thread:null,$events:null,$runmode:p,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&h(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=p,e.$running=!1,D&&!0===t&&O.close(),e},empty:function(){var t=this;return t.$timer&&h(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=p,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,r){var i,a,o=this;if(!o.$thread){if(!R)throw o.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");a=v?(i="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),o.$events=o.$events||{},(r=o.$thread=new(!0===r?l.Shared:l)(Y)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,o.$events&&o.$events[e]?o.$events[e](t):"console.log"!==e&&"console.error"!==e||O.log(("console.error"===e?a:i)+(t||"")))},r.onerror=function(t){if(!o.$events||!o.$events.error)throw new Error(a+t.toString());o.$events.error(t)},o.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return o},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return D&&(n.$events={},O.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),O.close())})),n},listen:function(t,e){return t&&b(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(D?O.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return c(t,F)?t:b(t)?F(t):void 0},iif:function(){var t=arguments,e=new F;return e.iif.apply(e,t)},until:function(){var t=u(arguments),e=new F(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=u(arguments),e=new F(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=u(arguments),e=new F(t.pop());return e.loop.apply(e,t)},each:function(){var t=u(arguments),e=new F(t.pop());return e.each.apply(e,t)},recurse:function(){var t=u(arguments),e=new F(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,r=n.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n}:(e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var r=this,i=r.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,n)),r)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?f(function(){n.empty()},e):n.empty(),n}:(e&&0<e?f(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,x===t)k(n,e);else if(d===t)z(n,e);else if(g===t){var r,i=n,a=i.$queue;if(i.$runmode=g,a){for(;a.length&&(!a[0]||!a[0].canRun());)a.shift();a.length?(i.$running=!0,r=a.shift(),e?r.runWithArgs(e):r.run(),r.complete()):i.$running=!1}}else _===t&&((e=n).$runmode=_,e.$running=!1);return n}},D&&(O.log=function(t){O.send({event:"console.log",data:"string"!=typeof t?H(t):t})},O.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(T&&(b(T.dispose)&&T.dispose(),T=null),T=O.load(n.component,n.imports,n.asInstance));break;case"dispose":T&&(b(T.dispose)&&T.dispose(),T=null),O.close()}})),N.Asynchronous=O}(this,A),a=A,R="prototype",I=Object[R].hasOwnProperty,Object[R].toString,Object.defineProperty,w=Math,L=function(){},D=0,aa.Merge=function(){for(var t,e,n=arguments.length,r=n?arguments[0]:null,i=1;i<n;++i)for(t in e=arguments[i])I.call(e,t)&&(r[t]=e[t]);return r},a.Class=aa,a.Path=a.Asynchronous.path(P.moduleUri),a.uuid=function(t){return[t||"filter",(new Date).getTime(),++D].join("_")},a.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},C=a.Asynchronous,e=C.isPlatform(C.Platform.NODE),E=C.isPlatform(C.Platform.BROWSER),b=C.supportsMultiThreading(),S=C.isThread(null,!0),t=C.isThread(),n="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",r="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",i="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",a.global=e?global:t?self:window,(e=a.Browser={isNode:e,isBrowser:E,isWorker:S,isInsideWorker:t,supportsWorker:b,isPhantom:/PhantomJS/.test(n),isOpera:E&&/Opera|OPR\//.test(n),isFirefox:E&&/Firefox\//.test(n),isChrome:E&&/Chrome\//.test(n),isSafari:E&&/Apple Computer/.test(i),isKhtml:E&&/KHTML\//.test(n),isIE:E&&(/MSIE \d/.test(n)||/Trident\/\d/.test(n)),isEdge:E&&/Edg/.test(n),isGecko:E&&/gecko\/\d/i.test(n),isWebkit:E&&/WebKit\//.test(n),isMac_geLion:E&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(n),isMac_geMountainLion:E&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(n),isMobile:!1,isIOS:/AppleWebKit/.test(n)&&/Mobile\/\w+/.test(n),isWin:/windows/i.test(r),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=e.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(n),e.isMac=e.isIOS||/Mac/.test(r),e.isIE_lt8=e.isIE&&!t&&(null==document.documentMode||document.documentMode<8),e.isIE_lt9=e.isIE&&!t&&(null==document.documentMode||document.documentMode<9),e.isQtWebkit=e.isWebkit&&/Qt\/\d+\.\d+/.test(n),a.getPath=C.path,a.log=S?C.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},a.warning=function(t){a.log("WARNING: "+t)},a.error=function(t,e){if(a.log("ERROR: "+t),e)throw new Error(String(t))},a.devicePixelRatio=(E&&!t?window.devicePixelRatio:1)||1,a._notSupportClamp="undefined"==typeof Uint8ClampedArray||e.isOpera,a.Array=Array,a.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,a.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,a.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,a.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,a.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,a.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,a.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,a.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,a.ArrayBuffer="undefined"!=typeof ArrayBuffer?ArrayBuffer:"undefined"!=typeof Buffer?Buffer:Array,a.ColorTable=a.ImArray=a._notSupportClamp?a.Array8U:Uint8ClampedArray,a.AffineMatrix=a.ColorMatrix=a.ConvolutionMatrix=a.Array32F,a.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26,COLORIZE:30,COLORIZEHUE:31,CHANNEL:32},a.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},a.POS={X:0,Y:1},a.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},a.LUMA=a.LUMA_YUV=a.LUMA_YIQ=new a.Array32F([.2126,.7152,.0722]),a.LUMA_YCbCr=new a.Array32F([.299,.587,.114]),a.LUMA_GREEN=new a.Array32F([0,1,0]),a.CONSTANTS=a.CONST={X:0,Y:1,Z:2,PI:w.PI,PI2:2*w.PI,PI_2:w.PI/2,toRad:w.PI/180,toDeg:180/w.PI},a.FORMAT={IMAGE:1024,DATA:2048},a.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[R].set,hasSubarray:"function"==typeof a.Array32F[R].subarray},Math:{},Filter:{},Image:{},GLSL:{isSupported:!1,isLoaded:!1},WASM:{isSupported:!1,isLoaded:!1}},a.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n},a.Canvas.Image=function(){return new Image},a.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},F=G=null,a.supportsGLSL=function(){if(null==G){var t,e=null,n=null,r=["webgl","experimental-webgl"],i=null;try{e=a.Canvas(1,1)}catch(t){e=null}if(e)for(t=0;t<r.length;++t){i=r[t],n=null;try{n=e.getContext(i)}catch(t){n=null}if(n)break}(G=!!n)&&(F=i),e=n=null}return G},a.setGLDimensions=function(t,e,n){return t&&t.gl&&(t.gl.width!==e&&(t.gl.width=e),t.gl.height!==n)&&(t.gl.height=n),t},a.getGL=function(t,e,n){if(t&&a.supportsGLSL())return t.gl||(t.gl=a.Canvas(e,n),E&&t.gl&&t.gl.addEventListener&&t.gl.addEventListener("webglcontextlost",oa,!1)),a.setGLDimensions(t,e,n),t.gl.getContext(F)},a.disposeGL=function(t){t&&t.gl&&E&&t.gl.removeEventListener&&t.gl.removeEventListener("webglcontextlost",oa,!1)},O=null,a.supportsWASM=function(){if(null==O){O=!1;var t=null;try{"object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate&&"undefined"!=typeof Uint8Array&&(t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0)),O=t instanceof WebAssembly.Module&&new WebAssembly.Instance(t)instanceof WebAssembly.Instance)}catch(t){O=!1}t=null}return O},H=0,a.waitFor=function(t){H+=t||0},a.unwaitFor=function(t){H-=t||0},a.onReady=function(e){(function t(){0<H?setTimeout(t,100):e()})()},ot=(M=A).MODE,b=M._notSupportClamp,lt=M.ImArray,st=M.Array32F,M.Array64F,M.Array32I,k=M.Array16I,B=M.Array8U,j=M.ColorTable,X=M.ColorMatrix,W=M.AffineMatrix,M.ConvolutionMatrix,i=M.Util.Array=M.Util.Array||{},r=M.Util.String=M.Util.String||{},n=M.Util.Math=M.Util.Math||{},S=M.Util.Image=M.Util.Image||{},C=M.Util.Filter=M.Util.Filter||{},(V=Math).exp,$=V.sqrt,q=V.pow,V.ceil,V.floor,V.log,V.sin,V.cos,Z=V.min,J=V.max,Q=V.abs,tt=V.PI,et=V.SQRT1_2,V.log2,nt=/([.*+?^${}()|\[\]\/\\\-])/g,rt=/^\s+|\s+$/g,it=/^function[^{]+{([\s\S]*)}$/,i.copy=i.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return sa(e,t,0,0,t.length-1),e},ut=ua(5,5,1.4),ct={},ft={},ht=["ImArray","Array32F","Array64F","Array8I","Array16I","Array32I","Array8U","Array16U","Array32U"],i.typed=M.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},i.typed_obj=M.Browser.isNode?function(t,e){return null==t?t:e?function t(e){if(e instanceof Object){if(e.typed&&e.array&&-1<ht.indexOf(e.typed))return va(e.array,M[e.typed]);for(var n=Object.keys(e),r=n.length,i=0;i<r;++i)e[n[i]]=t(e[n[i]])}return e}(JSON.parse(t)):JSON.stringify(t,ya)}:function(t){return t},i.arrayset_shim=sa,i.arrayset=i.hasArrayset?function(t,e,n){t.set(e,n||0)}:sa,i.subarray=i.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},n.clamp=la,n.hypot=function(t,e,n){n=n||0,e=e||0;var r=J(Q(t),Q(e),Q(n));return 0===r?0:r*$((t/=r)*t+(e/=r)*e+(n/=r)*n)},r.esc=function(t){return t.replace(nt,"\\$1")},r.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(rt,"")},r.function_body=function(t){return t.toString().match(it)[1]||""},S.crop=i.hasArrayset?function(t,e,n,r,i,a,o){a=Z(a,e-1),o=Z(o,n-1);for(var l,s=new lt((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=o;++c,f+=e,h+=u)s.set(t.subarray(l=f+r<<2,l+u),h);return s}:function(t,e,n,r,i,a,o){a=Z(a,e-1),o=Z(o,n-1);for(var l,s=new lt((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=o;++c,f+=e,h+=u)sa(s,t,h,l=f+r<<2,l+u);return s},S.pad=i.hasArrayset?function(t,e,n,r,i,a,o){for(var r=e+(a=a||0)+(r=r||0),l=new lt(r*(n+(o=o||0)+(i=i||0))<<2),s=e<<2,u=r<<2,c=a<<2,f=0,h=0,m=o*u;f<n;++f,h+=s,m+=u)l.set(t.subarray(h,h+s),m+c);return l}:function(t,e,n,r,i,a,o){for(var r=e+(a=a||0)+(r=r||0),l=new lt(r*(n+(o=o||0)+(i=i||0))<<2),s=e<<2,u=r<<2,c=a<<2,f=0,h=0,m=o*u;f<n;++f,h+=s,m+=u)sa(l,t,m+c,h,h+s);return l},S.interpolate_nearest=function(t,e,n,r,i){for(var a,o,l=r*i<<2,s=new lt(l),u=V.round,c=0,f=0,h=0;h<l;h+=4,++c)r<=c&&(c=0,++f),a=la(u(c/r*e),0,e-1),o=la(u(f/i*n),0,n-1),s[h]=t[o=o*e+a<<2],s[h+1]=t[1+o],s[h+2]=t[2+o],s[h+3]=t[3+o];return s},S.interpolate=S.interpolate_bilinear=function(t,e,n,r,i){for(var a,o,l,s,u,c,f,h,m,p,d=r*i<<2,g=new lt(d),_=(e-1)/r,x=(n-1)/i,v=e<<2,y=V.round,b=0,C=0,w=0,A=0,S=0,R=0;R<d;R+=4,++b,C+=_)r<=b&&(S=(w+=x)-(p=(C=b=0)|w),A=p*e),a=t[h=A+(p=0|C)<<2],o=t[4+h],l=t[h+v],s=t[h+v+4],g[R]=la(y(a*(u=(1-(m=C-p))*(1-S))+o*(c=m*(1-S))+l*(f=S*(1-m))+s*(m=m*S)),0,255),a=t[1+h],o=t[5+h],l=t[h+v+1],s=t[h+v+5],g[R+1]=la(y(a*u+o*c+l*f+s*m),0,255),a=t[2+h],o=t[6+h],l=t[h+v+2],s=t[h+v+6],g[R+2]=la(y(a*u+o*c+l*f+s*m),0,255),a=t[3+h],o=t[7+h],l=t[h+v+3],s=t[h+v+7],g[R+3]=la(y(a*u+o*c+l*f+s*m),0,255);return g},S.nonzero_pixels=function(t,e,n,r,i,a,o,l,s){null==a&&(o=a=0,l=e-1,s=n-1),null==i&&(i=4),r=r||0;var u,c,f,h,m,p,d=(l-a+1)*(s-o+1),g=new Array(d),_=4===i?3:r,x=4===i?2:0;if(0<=l&&a<e&&0<=s&&o<n)for(h=a,p=(m=o)*e,c=f=0;c<d&&(l<h&&(h=a,++m,p+=e),!(n<=m));++c,++h)h<0||e<=h||m<0||t[(u=p+h<<x)+r]&&t[u+_]&&(g[f++]={x:h,y:m});return g.length=f,g},S.glsl=function(){return{crop:["vec4 crop(vec2 pix, sampler2D img, vec2 wh, vec2 nwh, float x1, float y1, float x2, float y2) {","   vec2 start = vec2(x1, y1)/wh; vec2 end = vec2(x2, y2)/wh;","   return texture2D(img, start + pix*(end-start));","}"].join("\n"),pad:["vec4 pad(vec2 pix, sampler2D img, vec2 wh, vec2 nwh, float pad_right, float pad_bot, float pad_left, float pad_top) {","   vec2 p = pix*nwh - vec2(pad_left, pad_top);","   if (p.x < 0.0 || p.x > wh.x || p.y < 0.0 || p.y > wh.y) return vec4(0.0);","   return texture2D(img, p/wh);","}"].join("\n"),interpolate:["vec4 interpolate_nearest(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   return texture2D(img, pix);","}","vec4 interpolate_bilinear(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   if (wh.x == nwh.x && wh.y == nwh.y) return texture2D(img, pix);","   vec2 xy = pix*wh /*+ vec2(0.5)*/;","   vec2 xyi = floor(xy);","   vec2 x1yi = xyi + vec2(1.0, 0.0);","   vec2 xy1i = xyi + vec2(0.0, 1.0);","   vec2 x1y1i = xyi + vec2(1.0, 1.0);","   vec2 d = (xy - xyi);","   return (1.0-d.x)*(1.0-d.y)*texture2D(img, xyi/wh) + (d.x)*(1.0-d.y)*texture2D(img, x1yi/wh) + (1.0-d.x)*(d.y)*texture2D(img, xy1i/wh) + (d.x)*(d.y)*texture2D(img, x1y1i/wh);","}","vec4 interpolate(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   return interpolate_bilinear(pix, img, wh, nwh);","}"].join("\n")}},C.am_eye=function(){return new W([1,0,0,0,0,1,0,0])},C.am_multiply=function(t,e){var n=new W(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},C.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,r=new j(256);if("function"==typeof t)for(n=0;n<256;++n)r[n]=0|la(t(n),0,255);else for(n=0;n<256;++n)r[n]=0|la(e+t*n,0,255);return r},C.ct_multiply=function(t,e){for(var n=new j(256),r=0;r<256;++r)n[r]=la(t[la(e[r],0,255)],0,255);return n},C.cm_eye=function(){return new X([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},C.cm_multiply=function(t,e){for(var n=new X(20),r=0;r<20;r+=5)n[r+0]=e[r]*t[0]+e[r+1]*t[5]+e[r+2]*t[10]+e[r+3]*t[15],n[r+1]=e[r]*t[1]+e[r+1]*t[6]+e[r+2]*t[11]+e[r+3]*t[16],n[r+2]=e[r]*t[2]+e[r+1]*t[7]+e[r+2]*t[12]+e[r+3]*t[17],n[r+3]=e[r]*t[3]+e[r+1]*t[8]+e[r+2]*t[13]+e[r+3]*t[18],n[r+4]=e[r]*t[4]+e[r+1]*t[9]+e[r+2]*t[14]+e[r+3]*t[19]+e[r+4];return n},C.cm_rechannel=function(t,e,n,r,i,a,o,l,s){var u=new X(20),o=5*o,l=5*l,s=5*s;return u[(a=5*a)+e]=t[0],u[a+n]=t[1],u[a+r]=t[2],u[a+i]=t[3],u[4+a]=t[4],u[o+e]=t[5],u[o+n]=t[6],u[o+r]=t[7],u[o+i]=t[8],u[4+o]=t[9],u[l+e]=t[10],u[l+n]=t[11],u[l+r]=t[12],u[l+i]=t[13],u[4+l]=t[14],u[s+e]=t[15],u[s+n]=t[16],u[s+r]=t[17],u[s+i]=t[18],u[4+s]=t[19],u},C.cm_combine=function(t,e,n,r,i){i=i||Array,n=n||1,r=r||1;for(var a=0,o=t.length,l=new i(o);a<o;++a)l[a]=n*t[a]+r*e[a];return l},C.cm_convolve=function(t,e,n){n=n||Array;for(var r=t.length,i=(e=e===+e?[e]:e).length,a=new n(r*i),o=0,l=0;o<r;)a[o*i+l]=t[o]*e[l],++l>=i&&(l=0,++o);return a},C.gaussian=ua,C.integral_convolution=b?function(N,t,e,H,U,n,B,Y,z,k,P,r,i,j){var a,o,l,s,u,c,f,h,m,p,d,g,X,_,x,v,y,b,C,w,A,S,R,I,L,W,$,q,D,E,T=t.length,V=T>>>U,K=e<<U,M=1<<U,U=Y*z,Z=-(Y=Y>>>1)-1,J=-(z=e*(z>>>1))-e,Q=Y,tt=z,Y=k*P,et=-(z=k>>>1)-1,nt=-(k=e*(P>>>1))-e,rt=z,it=k,G=e-1,F=V-e,O=t;if(t=new lt(T),j=j||1,ot.GRAY===N)if(u=e,a=new st(V),B)for(p=n[0],d=n[U>>>1]-p,g=B[0],X=B[Y>>>1]-g,D=0;D<j;++D){for(E=t,t=O,O=E,h=o=f=c=0;h<e;h++,c+=M,++f)o+=t[c],a[f]=o;for(o=h=f=0,c=K;c<T;c+=M,++f,++h)e<=h&&(o=h=0),o+=t[c],a[f+u]=a[f]+o;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=(v=G<(v=h+Q)?G:v)+(y=F<(y=m+tt)?F:y)]-a[C=v+(x=(x=m+J)<0?0:x)]-a[w=(_=(_=h+Z)<0?0:_)+y]+a[b=_+x])+d*t[c],q=g*(a[A=(v=G<(v=h+rt)?G:v)+(y=F<(y=m+it)?F:y)]-a[C=v+(x=(x=m+nt)<0?0:x)]-a[w=(_=(_=h+et)<0?0:_)+y]+a[b=_+x])+X*t[c],O[c]=0|(S=(S=r*L+i*q)<0?0:255<S?255:S),O[c+1]=0|S,O[c+2]=0|S,O[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,D=0;D<j;++D){for(E=t,t=O,O=E,h=o=f=c=0;h<e;h++,c+=M,++f)o+=t[c],a[f]=o;for(o=h=f=0,c=K;c<T;c+=M,++f,++h)e<=h&&(o=h=0),o+=t[c],a[f+u]=a[f]+o;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=(v=G<(v=h+Q)?G:v)+(y=F<(y=m+tt)?F:y)]-a[C=v+(x=(x=m+J)<0?0:x)]-a[w=(_=(_=h+Z)<0?0:_)+y]+a[b=_+x])+d*t[c],O[c]=0|(S=(S=r*L+i)<0?0:255<S?255:S),O[c+1]=0|S,O[c+2]=0|S,O[c+3]=t[c+3]}else if(u=(e<<1)+e,a=new st((V<<1)+V),B)for(p=n[0],d=n[U>>>1]-p,g=B[0],X=B[Y>>>1]-g,D=0;D<j;++D){for(E=t,t=O,O=E,h=o=l=s=f=c=0;h<e;++h,c+=M,f+=3)o+=t[c],l+=t[c+1],s+=t[c+2],a[f]=o,a[f+1]=l,a[f+2]=s;for(o=l=s=h=f=0,c=K;c<T;c+=M,f+=3,++h)e<=h&&(o=l=s=h=0),o+=t[c],l+=t[c+1],s+=t[c+2],a[f+u]=a[f]+o,a[f+u+1]=a[f+1]+l,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=((A=(v=G<(v=h+Q)?G:v)+(y=F<(y=m+tt)?F:y))<<1)+A]-a[C=((C=v+(x=(x=m+J)<0?0:x))<<1)+C]-a[w=((w=(_=(_=h+Z)<0?0:_)+y)<<1)+w]+a[b=((b=_+x)<<1)+b])+d*t[c],W=p*(a[A+1]-a[C+1]-a[w+1]+a[b+1])+d*t[c+1],$=p*(a[A+2]-a[C+2]-a[w+2]+a[b+2])+d*t[c+2],q=g*(a[A=((A=(v=G<(v=h+rt)?G:v)+(y=F<(y=m+it)?F:y))<<1)+A]-a[C=((C=v+(x=(x=m+nt)<0?0:x))<<1)+C]-a[w=((w=(_=(_=h+et)<0?0:_)+y)<<1)+w]+a[b=((b=_+x)<<1)+b])+X*t[c],R=(R=r*W+i*(g*(a[A+1]-a[C+1]-a[w+1]+a[b+1])+X*t[c+1]))<0?0:255<R?255:R,I=(I=r*$+i*(g*(a[A+2]-a[C+2]-a[w+2]+a[b+2])+X*t[c+2]))<0?0:255<I?255:I,O[c]=0|(S=(S=r*L+i*q)<0?0:255<S?255:S),O[c+1]=0|R,O[c+2]=0|I,O[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,D=0;D<j;++D){for(E=t,t=O,O=E,h=o=l=s=f=c=0;h<e;++h,c+=M,f+=3)o+=t[c],l+=t[c+1],s+=t[c+2],a[f]=o,a[f+1]=l,a[f+2]=s;for(o=l=s=h=f=0,c=K;c<T;c+=M,f+=3,++h)e<=h&&(o=l=s=h=0),o+=t[c],l+=t[c+1],s+=t[c+2],a[f+u]=a[f]+o,a[f+u+1]=a[f+1]+l,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=((A=(v=G<(v=h+Q)?G:v)+(y=F<(y=m+tt)?F:y))<<1)+A]-a[C=((C=v+(x=(x=m+J)<0?0:x))<<1)+C]-a[w=((w=(_=(_=h+Z)<0?0:_)+y)<<1)+w]+a[b=((b=_+x)<<1)+b])+d*t[c],R=(R=r*(W=p*(a[A+1]-a[C+1]-a[w+1]+a[b+1])+d*t[c+1])+i)<0?0:255<R?255:R,I=(I=r*($=p*(a[A+2]-a[C+2]-a[w+2]+a[b+2])+d*t[c+2])+i)<0?0:255<I?255:I,O[c]=0|(S=(S=r*L+i)<0?0:255<S?255:S),O[c+1]=0|R,O[c+2]=0|I,O[c+3]=t[c+3]}return O}:function(N,t,e,H,n,r,i,U,B,Y,z,a,o,k){var l,s,u,c,f,h,m,p,d,g,_,x,P,v,y,b,C,w,A,S,R,I,j,X,L,W,$,q,D,E,T=t.length,V=T>>>n,K=e<<n,M=1<<n,n=U*B,Z=-(U=U>>>1)-1,J=-(B=e*(B>>>1))-e,Q=U,tt=B,U=Y*z,et=-(B=Y>>>1)-1,nt=-(Y=e*(z>>>1))-e,rt=B,it=Y,G=e-1,F=V-e,O=t;if(t=new lt(T),k=k||1,ot.GRAY===N)if(f=e,l=new st(V),i)for(g=r[0],_=r[n>>>1]-g,x=i[0],P=i[U>>>1]-x,D=0;D<k;++D){for(E=t,t=O,O=E,p=s=m=h=0;p<e;++p,h+=M,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=K;h<T;h+=M,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[R=(b=G<(b=p+Q)?G:b)+(C=F<(C=d+tt)?F:C)]-l[A=b+(y=(y=d+J)<0?0:y)]-l[S=(v=(v=p+Z)<0?0:v)+C]+l[w=v+y])+_*t[h],q=x*(l[R=(b=G<(b=p+rt)?G:b)+(C=F<(C=d+it)?F:C)]-l[A=b+(y=(y=d+nt)<0?0:y)]-l[S=(v=(v=p+et)<0?0:v)+C]+l[w=v+y])+P*t[h],O[h]=0|(I=a*L+o*q),O[h+1]=0|I,O[h+2]=0|I,O[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,D=0;D<k;++D){for(E=t,t=O,O=E,p=s=m=h=0;p<e;p++,h+=M,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=K;h<T;h+=M,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[R=(b=G<(b=p+Q)?G:b)+(C=F<(C=d+tt)?F:C)]-l[A=b+(y=(y=d+J)<0?0:y)]-l[S=(v=(v=p+Z)<0?0:v)+C]+l[w=v+y])+_*t[h],O[h]=0|(I=a*L+o),O[h+1]=0|I,O[h+2]=0|I,O[h+3]=t[h+3]}else if(f=(e<<1)+e,l=new st((V<<1)+V),i)for(g=r[0],_=r[n>>>1]-g,x=i[0],P=i[U>>>1]-x,D=0;D<k;++D){for(E=t,t=O,O=E,p=s=u=c=m=h=0;p<e;++p,h+=M,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=K;h<T;h+=M,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[R=((R=(b=G<(b=p+Q)?G:b)+(C=F<(C=d+tt)?F:C))<<1)+R]-l[A=((A=b+(y=(y=d+J)<0?0:y))<<1)+A]-l[S=((S=(v=(v=p+Z)<0?0:v)+C)<<1)+S]+l[w=((w=v+y)<<1)+w])+_*t[h],W=g*(l[R+1]-l[A+1]-l[S+1]+l[w+1])+_*t[h+1],$=g*(l[R+2]-l[A+2]-l[S+2]+l[w+2])+_*t[h+2],q=x*(l[R=((R=(b=G<(b=p+rt)?G:b)+(C=F<(C=d+it)?F:C))<<1)+R]-l[A=((A=b+(y=(y=d+nt)<0?0:y))<<1)+A]-l[S=((S=(v=(v=p+et)<0?0:v)+C)<<1)+S]+l[w=((w=v+y)<<1)+w])+P*t[h],j=a*W+o*(x*(l[R+1]-l[A+1]-l[S+1]+l[w+1])+P*t[h+1]),X=a*$+o*(x*(l[R+2]-l[A+2]-l[S+2]+l[w+2])+P*t[h+2]),O[h]=0|(I=a*L+o*q),O[h+1]=0|j,O[h+2]=0|X,O[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,D=0;D<k;++D){for(E=t,t=O,O=E,p=s=u=c=m=h=0;p<e;++p,h+=M,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=K;h<T;h+=M,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[R=((R=(b=G<(b=p+Q)?G:b)+(C=F<(C=d+tt)?F:C))<<1)+R]-l[A=((A=b+(y=(y=d+J)<0?0:y))<<1)+A]-l[S=((S=(v=(v=p+Z)<0?0:v)+C)<<1)+S]+l[w=((w=v+y)<<1)+w])+_*t[h],j=a*(W=g*(l[R+1]-l[A+1]-l[S+1]+l[w+1])+_*t[h+1])+o,X=a*($=g*(l[R+2]-l[A+2]-l[S+2]+l[w+2])+_*t[h+2])+o,O[h]=0|(I=a*L+o),O[h+1]=0|j,O[h+2]=0|X,O[h+3]=t[h+3]}return O},C.separable_convolution=b?function(N,t,e,H,n,U,r,i,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L,D,E=t.length,T=1<<n,M=e-1,G=(E>>>n)-e,Y=new k(i),F=0,O=i.length;F<O;F+=2)Y[F+1]*=e;for(h=new k(a),F=0,O=a.length;F<O;F+=2)h[F+1]*=e;if(L=2,s=U,u=i,I=B,f=Y,c=t,t=new lt(E),ot.GRAY===N)for(;L--;){for(D=t,t=c,c=D,l=s.length,O=u.length,m=g=d=0;m<E;m+=T,++d){for(e<=d&&(d=0,g+=e),p=F=A=S=R=0;F<l;++F,p+=2)_=d+f[p],x=g+f[p+1],0<=_&&_<=M&&0<=x&&x<=G&&(w=s[F],A+=t[v=_+x<<2]*w);c[m]=0|(y=(y=I*A)<0?0:255<y?255:y),c[m+1]=0|y,c[m+2]=0|y,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}else for(;L--;){for(D=t,t=c,c=D,l=s.length,O=u.length,m=g=d=0;m<E;m+=T,++d){for(e<=d&&(d=0,g+=e),p=F=A=S=R=0;F<l;++F,p+=2)_=d+f[p],x=g+f[p+1],0<=_&&_<=M&&0<=x&&x<=G&&(w=s[F],A+=t[v=_+x<<2]*w,S+=t[v+1]*w,R+=t[v+2]*w);b=(b=I*S)<0?0:255<b?255:b,C=(C=I*R)<0?0:255<C?255:C,c[m]=0|(y=(y=I*A)<0?0:255<y?255:y),c[m+1]=0|b,c[m+2]=0|C,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}return c}:function(N,t,e,H,n,U,r,i,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L,D,E=t.length,T=1<<n,M=e-1,G=(E>>>n)-e,Y=new k(i),F=0,O=i.length;F<O;F+=2)Y[F+1]*=e;for(h=new k(a),F=0,O=a.length;F<O;F+=2)h[F+1]*=e;if(L=2,s=U,u=i,I=B,f=Y,c=t,t=new lt(E),ot.GRAY===N)for(;L--;){for(D=t,t=c,c=D,l=s.length,O=u.length,m=g=d=0;m<E;m+=T,++d){for(e<=d&&(d=0,g+=e),p=F=A=S=R=0;F<l;++F,p+=2)_=d+f[p],x=g+f[p+1],0<=_&&_<=M&&0<=x&&x<=G&&(w=s[F],A+=t[v=_+x<<2]*w);c[m]=0|(y=I*A),c[m+1]=0|y,c[m+2]=0|y,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}else for(;L--;){for(D=t,t=c,c=D,l=s.length,O=u.length,m=g=d=0;m<E;m+=T,++d){for(e<=d&&(d=0,g+=e),p=F=A=S=R=0;F<l;++F,p+=2)_=d+f[p],x=g+f[p+1],0<=_&&_<=M&&0<=x&&x<=G&&(w=s[F],A+=t[v=_+x<<2]*w,S+=t[v+1]*w,R+=t[v+2]*w);b=I*S,C=I*R,c[m]=0|(y=I*A),c[m+1]=0|b,c[m+2]=0|C,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}return c},C.gradient=function(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_,x,v,y,b,C,w,A=r,S=t.length>>>r,R=e-1,I=n-1,L=1<<r,D=L<<1,E=e<<r,T=new st(S),M=new st(S);if(a){for(g=e-2,_=n-2,a=e<<1,w=new st(S),C=ut,p=m=2,d=a;p<_&&!(g<=m&&(m=2,d+=e,_<=++p));++m)x=(h=m+d)<<r,0<r&&0===t[x+3]?w[h]=0:w[h]=C[0]*t[(b=(y=(x+=i)-E)-E)-D]+C[1]*t[b-L]+C[2]*t[b]+C[3]*t[b+L]+C[4]*t[b+D]+C[5]*t[y-D]+C[6]*t[y-L]+C[7]*t[y]+C[8]*t[y+L]+C[9]*t[y+D]+C[10]*t[x-D]+C[11]*t[x-L]+C[12]*t[x]+C[13]*t[x+L]+C[14]*t[x+D]+C[15]*t[(v=x+E)-D]+C[16]*t[v-L]+C[17]*t[v]+C[18]*t[v+L]+C[19]*t[v+D]+C[20]*t[(b=v+E)-D]+C[21]*t[b-L]+C[22]*t[b]+C[23]*t[b+L]+C[24]*t[b+D];L=1,D=2,E=e,i=r=0}else w=t;for(p=m=1,d=e;p<I&&!(R<=m&&(m=1,d+=e,I<=++p));++m)T[h=d+m]=w[(y=(x=(h<<r)+i)-E)+L]-w[y-L]+2*(w[x+L]-w[x-L])+(w[(v=x+E)+L]-w[v-L]),M[h]=w[y-L]-w[v-L]+2*(w[y]-w[v])+(w[y+L]-w[v+L]);return ca(T,M,t,e,n,A,o,l,s,u,c,f)},C.optimum_gradient=ca,C.gradient_glsl=function(){function t(t,e){return n(ut[t],!e)}var n=M.Util.GLSL.formatFloat;return{lowpass:["vec4 lowpass(sampler2D img, vec2 pix, vec2 dp) {","   float a = texture2D(img, pix).a;","   if (0.0 == a || 0.0 > pix.x-2.0*dp.x || 0.0 > pix.y-2.0*dp.y || 1.0 < pix.x+2.0*dp.x || 1.0 < pix.y+2.0*dp.y) return vec4(0.0, 0.0, 0.0, a);","   return vec4("+t(0,1)+"*texture2D(img, pix+vec2(-2.0,-2.0)*dp).rgb"+t(1)+"*texture2D(img, pix+vec2(-1.0,-2.0)*dp).rgb"+t(2)+"*texture2D(img, pix+vec2(0.0,-2.0)*dp).rgb"+t(3)+"*texture2D(img, pix+vec2(1.0,-2.0)*dp).rgb"+t(4)+"*texture2D(img, pix+vec2(2.0,-2.0)*dp).rgb"+t(5)+"*texture2D(img, pix+vec2(-2.0,-1.0)*dp).rgb"+t(6)+"*texture2D(img, pix+vec2(-1.0,-1.0)*dp).rgb"+t(7)+"*texture2D(img, pix+vec2(0.0,-1.0)*dp).rgb"+t(8)+"*texture2D(img, pix+vec2(1.0,-1.0)*dp).rgb"+t(9)+"*texture2D(img, pix+vec2(2.0,-1.0)*dp).rgb"+t(10)+"*texture2D(img, pix+vec2(-2.0,0.0)*dp).rgb"+t(11)+"*texture2D(img, pix+vec2(-1.0,0.0)*dp).rgb"+t(12)+"*texture2D(img, pix+vec2(0.0,0.0)*dp).rgb"+t(13)+"*texture2D(img, pix+vec2(1.0,0.0)*dp).rgb"+t(14)+"*texture2D(img, pix+vec2(2.0,0.0)*dp).rgb"+t(15)+"*texture2D(img, pix+vec2(-2.0,1.0)*dp).rgb"+t(16)+"*texture2D(img, pix+vec2(-1.0,1.0)*dp).rgb"+t(17)+"*texture2D(img, pix+vec2(0.0,1.0)*dp).rgb"+t(18)+"*texture2D(img, pix+vec2(1.0,1.0)*dp).rgb"+t(19)+"*texture2D(img, pix+vec2(2.0,1.0)*dp).rgb"+t(20)+"*texture2D(img, pix+vec2(-2.0,2.0)*dp).rgb"+t(21)+"*texture2D(img, pix+vec2(-1.0,2.0)*dp).rgb"+t(22)+"*texture2D(img, pix+vec2(0.0,2.0)*dp).rgb"+t(23)+"*texture2D(img, pix+vec2(1.0,2.0)*dp).rgb"+t(24)+"*texture2D(img, pix+vec2(2.0,2.0)*dp).rgb, a);","}"].join("\n"),gradient:["vec2 sobel_gradient(sampler2D i, vec2 p, vec2 d) {","   if (0.0 > pix.x-d.x || 0.0 > pix.y-d.y || 1.0 < pix.x+d.x || 1.0 < pix.y+d.y) return vec2(0.0);","    return vec2(","    (texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,-1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(1.0,0.0)*d).r-texture2D(i, p+vec2(-1.0,0.0)*d).r)","    +(texture2D(i, p+vec2(1.0,1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    ,","    (texture2D(i, p+vec2(-1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(0.0,-1.0)*d).r-texture2D(i, p+vec2(0.0,1.0)*d).r)","    +(texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(1.0,1.0)*d).r)","    );","}","float gradient_suppressed(sampler2D img, vec2 pix, vec2 dp, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    vec2 g = sobel_gradient(img, pix, dp);","    vec2 gn = sobel_gradient(img, pix+vec2(0.0,-1.0)*dp, dp);","    vec2 gs = sobel_gradient(img, pix+vec2(0.0,1.0)*dp, dp);","    vec2 gw = sobel_gradient(img, pix+vec2(-1.0,0.0)*dp, dp);","    vec2 ge = sobel_gradient(img, pix+vec2(1.0,0.0)*dp, dp);","    vec2 gnw = sobel_gradient(img, pix+vec2(-1.0,-1.0)*dp, dp);","    vec2 gne = sobel_gradient(img, pix+vec2(1.0,-1.0)*dp, dp);","    vec2 gsw = sobel_gradient(img, pix+vec2(-1.0,1.0)*dp, dp);","    vec2 gse = sobel_gradient(img, pix+vec2(1.0,1.0)*dp, dp);","    float gM = length(g);","    float gnM = length(gn);","    float gsM = length(gs);","    float gwM = length(gw);","    float geM = length(ge);","    float gnwM = length(gnw);","    float gneM = length(gne);","    float gswM = length(gsw);","    float gseM = length(gse);","    float gg = 0.0; float tmp;","    if (g.x*g.y <= 0.0)","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gneM - (g.x + g.y) * geM) && tmp > abs(g.y * gswM - (g.x + g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gneM - (g.y + g.x) * gnM) && tmp > abs(g.x * gswM - (g.y + g.x) * gsM))","            {","                gg = 1.0;","            }","        }","    }","    else","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gseM + (g.x - g.y) * geM) && tmp > abs(g.y * gnwM + (g.x - g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gseM + (g.y - g.x) * gsM)","                && tmp > abs(g.x * gnwM + (g.y - g.x) * gnM))","            {","                gg = 1.0;","            }","        }","    }","    if (0.0 < gg)","    {","        if (gM >= magnitude_limit)","        {","            gg = magnitude_max;","        }","        else","        {","            gg = magnitude_scale * gM;","        }","    }","    return gg;","}","vec4 gradient(sampler2D img, vec2 pix, vec2 dp, float low, float high, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    float a = texture2D(img, pix).a;","    if (0.0 == a) return vec4(0.0);","    float g = gradient_suppressed(img, pix, dp, magnitude_scale, magnitude_limit, magnitude_max);","    if (g >= high) return vec4(vec3(1.0), a);","    else if (g < low) return vec4(vec3(0.0), a);","    return vec4(vec3(/*clamp((g-low)/(high-low)-0.1, 0.0, 0.9)/0.9*/0.01), a);","}"].join("\n"),hysteresis:["vec4 hysteresis(sampler2D img, vec2 pix, vec2 dp) {","   vec4 g = texture2D(img, pix);","   float x; float y; vec4 gg;","   if (0.0 < g.r && 1.0 > g.r) {","       for (int i=-1; i<=1; ++i) { x = float(i);","           if (0.0 > pix.x+x*dp.x || 1.0 < pix.x+x*dp.x) continue;","           for (int j=-1; j<=1; ++j) { y = float(j);","               if (0==i && 0==j) continue;","               if (0.0 > pix.y+y*dp.y || 1.0 < pix.y+y*dp.y) continue;","               gg = texture2D(img, pix+vec2(x,y)*dp);","               if (1.0 == gg.r) return vec4(vec3(1.0), g.a);","           }","       }","   }","   return g;","}"].join("\n")}},C.histogram=function(t,e,n,r){e=e||0;for(var i,a=new st(256),o=M.CHANNEL.A,l=t.length,s=0,u=0,c=255,f=0,h=0;h<256;++h)a[h]=0;for(h=0;h<l;h+=4)0<t[h+o]&&(++a[i=t[h+e]],++s,c=Z(i,c),f=J(i,f));if(n)for(h=0;h<256;++h)u+=a[h],a[h]=u;if(r)for(h=0;h<256;++h)a[h]/=s;return{bin:a,channel:e,min:c,max:f,total:s}},C.integral_histogram=function(t,e,n,r){var i,a,o,l,s,u,c,f,h,m,p,d,g=M.CHANNEL.R,_=M.CHANNEL.G,x=M.CHANNEL.B,v=M.CHANNEL.A,y=t.length,b=y>>>2,C=4*e,w=256*e,A=255,S=0,R=255,I=0,L=255,D=0,E=new st(256),T=new st(256*b);if(null==r){for(h=new st(256),m=new st(256),p=new st(256*b),d=new st(256*b),s=f=0;s<256;++s)d[(p[(T[0+s]=0)+s]=0)+s]=0;for(0<t[0+v]&&(i=t[0+g],a=t[0+_],o=t[0+x],T[0+i]=1,p[0+a]=1,d[0+o]=1,A=Z(i,A),S=J(i,S),R=Z(a,R),I=J(a,I),L=Z(o,L),D=J(o,D)),f=1,l=4,u=256;l<C;++f,l+=4,u+=256){for(c=u-256,s=0;s<256;++s)T[u+s]=T[c+s],p[u+s]=p[c+s],d[u+s]=d[c+s];0<t[l+v]&&(i=t[l+g],a=t[l+_],o=t[l+x],++T[u+i],++p[u+a],++d[u+o],A=Z(i,A),S=J(i,S),R=Z(a,R),I=J(a,I),L=Z(o,L),D=J(o,D))}for(f=0,l=C,u=w;l<y;++f,l+=4,u+=256){if(e<=f)for(s=f=0;s<256;++s)E[s]=h[s]=m[s]=0;for(c=u-w,s=0;s<256;++s)T[u+s]=T[c+s]+(E[s]||0),p[u+s]=p[c+s]+(h[s]||0),d[u+s]=d[c+s]+(m[s]||0);0<t[l+v]&&(i=t[l+g],a=t[l+_],o=t[l+x],++T[u+i],++p[u+a],++d[u+o],E[i]=(E[i]||0)+1,h[a]=(h[a]||0)+1,m[o]=(m[o]||0)+1,A=Z(i,A),S=J(i,S),R=Z(a,R),I=J(a,I),L=Z(o,L),D=J(o,D))}return{bin:[T,p,d],min:[A,R,L],max:[S,I,D],width:e,height:n,total:b}}for(r=r||0,s=f=0;s<256;++s)T[0+s]=0;for(0<t[0+v]&&(T[0+(i=t[l+r])]=1,A=Z(i,A),S=J(i,S)),f=1,l=4,u=256;l<C;++f,l+=4,u+=256){for(c=u-256,s=0;s<256;++s)T[u+s]=T[c+s];0<t[l+v]&&(++T[u+(i=t[l+r])],A=Z(i,A),S=J(i,S))}for(f=0,l=C,u=w;l<y;++f,l+=4,u+=256){if(e<=f)for(s=f=0;s<256;++s)E[s]=0;for(c=u-w,s=0;s<256;++s)T[u+s]=T[c+s]+(E[s]||0);0<t[l+v]&&(++T[u+(i=t[l+r])],E[i]=(E[i]||0)+1,A=Z(i,A),S=J(i,S))}return{bin:T,channel:r,min:A,max:S,width:e,height:n,total:b}},C.match_histogram=function(t,e,n,r,i){var a,o,l,s,u,c,f,h;if(null==r&&(r=0,i=255),t!==+t){for(f=i-r+1,h=t&&f<=t.length?t:new B(f),a=r;a<=i;++a){for(s=r,u=i,l=o=a;0!==(c=n[o]-e[a])&&(c<0?s=o:u=o,!(l===(o=s+u>>>1)||u<=s));)l=o;h[a-r]=o}return h}for(s=r,u=i,l=o=a=t;;){if(0===(c=n[o]-e[a]))return o;if(c<0?s=o:u=o,l===(o=s+u>>>1)||u<=s)return o;l=o}},C.otsu=function(t,e,n,r){return fa(t,e,n=null==n?0:n,r=null==r?255:r)},C.otsu_multi=function t(e,n,r,i,a){var o,l;return i<=r||(o=(l=fa(e,n,r,i,!0))[0],l[1]<a*a)?[]:((!(l=t(e,n,r,o,a)).length||l[l.length-1]<o)&&l.push(o),(r=t(e,n,o,i,a)).length&&r[0]===o&&r.shift(),l.push.apply(l,r),l)},C.otsu_multiclass=function t(e,n,r,i,a){var o,l;return a<=1||i<=r?[]:(o=fa(e,n,r,i),2===(a=V.round(a))?[o]:(l=t(e,n,r,o,V.round((a-1)*(r=(o-r)/(i-r)))),e=t(e,n,o,i,V.round((a-1)*(1-r))),(!l.length||l[l.length-1]<o)&&l.push(o),e.length&&e[0]===o&&e.shift(),l.push.apply(l,e),l))},C.fft1d=function(t,e,n){return ma(t,e,n,!1)},C.ifft1d=function(t,e,n){return ma(t,e,n,!0)},C.fft2d=function(t,e,n,r){return pa(t,e,n,r,!1)},C.ifft2d=function(t,e,n,r){return pa(t,e,n,r,!0)},C.minmax=function(t,e,n,r,i,a,o){return da(t,e,0,r,i,!0,!0,a,o)},C.min=function(t,e,n,r,i,a){return da(t,e,0,r,null,!0,!1,i,a)},C.max=function(t,e,n,r,i,a){return da(t,e,0,null,r,!1,!0,i,a)},C.localmax=function(t,e,n,r,i,a){var o,l,s,u;if(t=t||[],null==i)for(o=r,s=0;s<o;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(o<=s+1||u>=e[s+1])&&t.push(s);else if(null==a)for(o=r*i,s=0;s<o;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(o<=s+1||u>=e[s+1])&&(s-i<0||u>e[s-i])&&(o<=s+i||u>=e[s+i])&&t.push(s);else for(o=r*(l=i*a),s=0;s<o;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(o<=s+1||u>=e[s+1])&&(s-a<0||u>e[s-a])&&(o<=s+a||u>=e[s+a])&&(s-l<0||u>e[s-l])&&(o<=s+l||u>=e[s+l])&&t.push(s);return t},C.merge_features=function(t,e,n){if(!t||!t.length)return t;for(var r,i,a,o,l,s,u,c,f,h,m,p,d=t.length,g=new Array(d),_=[],x=0,v=!1,y=0;y<d;++y)g[y]=0;for(y=0;y<d;++y){for(v=!1,a=0;a<y;++a)u=t[a],c=t[y],f=(f=n)*(V.min(u.width,c.width)+V.min(u.height,c.height))*.5,V.abs(u.x-c.x)<=f&&V.abs(u.y-c.y)<=f&&V.abs(u.x+u.width-c.x-c.width)<=f&&V.abs(u.y+u.height-c.y-c.height)<=f&&(v=!0,g[y]=g[a]);v||(g[y]=x,++x)}for(r=new Array(x),i=new Array(x),y=0;y<x;++y)r[y]=0,i[y]={x:0,y:0,width:0,height:0};for(y=0;y<d;++y)++r[s=g[y]],h=i[s],m=t[y],h.x+=m.x,h.y+=m.y,h.width+=m.width,h.height+=m.height,null!=m.score&&(h.score=(h.score||0)+m.score);for(y=0;y<x;++y)e<=(o=r[y])&&(s={x:(l=1/(o+o))*(2*i[y].x+o),y:l*(2*i[y].y+o),width:l*(2*i[y].width+o),height:l*(2*i[y].height+o)},null!=i[y].score&&(s.score=i[y].score/o),_.push(s));for(d=_.length,y=0;y<d;++y)for(a=y+1;a<d;++a)!_[y].isInside&&ga(_[y],_[a],n)&&(_[y].isInside=!0),!_[a].isInside&&ga(_[a],_[y],n)&&(_[a].isInside=!0);for(y=d;0<=--y;)_[y].isInside?_.splice(y,1):((p=_[y]).x=V.round(p.x),p.y=V.round(p.y),p.width=V.round(p.width),p.height=V.round(p.height),p.area=p.width*p.height);return _},C.sat=function(t,e,n,r,i,a,o,l,s){for(var u,c,f,h,m=t.length,p=e<<r,d=1<<r,g=u=0,_=0+i,x=0;_<p;_+=d,++x)g+=c=t[_],a[x]=g,o&&(o[x]=u+=c*c),l&&(l[x]=c),s&&(s[x]=c*c);for(h=1,_=p+i,x=g=u=f=0;_<m;_+=d,++x)g+=c=t[_],a[x+e]=a[x]+g,o&&(o[x+e]=o[x]+(u+=c*c)),l&&(l[x+e]=(l[x+1-e]||0)+(c+(t[x-e<<r]||0))+(1<h&&l[x-e-e]||0)+(0<f&&l[x-1-e]||0)),s&&(s[x+e]=(s[x+1-e]||0)+(c*c+(t[x-e<<r]||0)*(t[x-e<<r]||0))+(1<h&&s[x-e-e]||0)+(0<f&&s[x-1-e]||0)),++f>=e&&(++h,g=u=f=0)},C.satsum=_a,C.satsums=Y,C.satsumt=xa,C.satsumr=function(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_;e<=0||n<=0||(h=V.min(r,a,l,u),m=V.min(i,o,s,c),p=V.max(r,a,l,u),d=V.max(i,o,s,c),p<=h||d<=m||V.abs(i-o)<=1||V.abs(o-s)<=1||V.abs(s-c)<=1||V.abs(c-i)<=1?Y(t,e,n,h,m,p,d,1):(_=r===h?i:a===h?o:l===h?s:c,c=r===p?i:a===p?o:l===p?s:c,r=V.min(g=i===m?r:o===m?a:s===m?l:u,i=i===d?r:o===d?a:s===d?l:u),o=V.min(_,c),a=V.max(g,i),s=V.max(_,c),c<=_&&g<=i||_<=c&&i<=g?(Y(t,e,n,r,o,a,s,1),g<=i?(xa(t,e,n,h,_,g,m,g,_,f,1),xa(t,e,n,g,m,p,c,g,c,f,1),xa(t,e,n,p,c,i,d,i,c,f,1),xa(t,e,n,i,d,h,_,i,_,f,1),Y(t,e,n,g,m,g,_,-1),Y(t,e,n,h,_,g,_,-1),Y(t,e,n,i,c,i,d,-1),Y(t,e,n,i,c,p,c,-1)):(xa(t,e,n,h,_,i,_,i,d,f,1),xa(t,e,n,h,_,g,m,g,_,f,1),xa(t,e,n,g,m,p,c,g,c,f,1),xa(t,e,n,i,d,i,c,p,c,f,1),Y(t,e,n,g,m,g,c,-1),Y(t,e,n,i,c,p,c,-1),Y(t,e,n,i,_,i,d,-1),Y(t,e,n,h,_,g,_,-1)),Y(t,e,n,r,o,r,o,1),Y(t,e,n,r,s,r,s,1),Y(t,e,n,a,s,a,s,1),Y(t,e,n,a,o,a,o,1)):(Y(t,e,n,h,m,p,d,1),g<=i?(xa(t,e,n,h,_,h,m,g,m,f,-1),xa(t,e,n,g,m,p,m,p,c,f,-1),xa(t,e,n,p,c,p,d,i,d,f,-1),xa(t,e,n,i,d,h,d,h,_,f,-1)):(xa(t,e,n,h,_,h,d,i,d,f,-1),xa(t,e,n,h,_,h,m,g,m,f,-1),xa(t,e,n,g,m,p,m,p,c,f,-1),xa(t,e,n,p,c,p,d,i,d,f,-1)),Y(t,e,n,g,m,g,m,1),Y(t,e,n,h,_,h,_,1),Y(t,e,n,p,c,p,c,1),Y(t,e,n,i,d,i,d,1))))},C.rsatsum=function(t,e,n,r,i,a,o){var l,s,u,c,f;return e<=0||n<=0||a<=0||o<=0?0:(f=(u=(s=i-o+1)+a-1)+o-1,(0<=(c=(l=r+o-1)+a-1)&&c<e&&0<=u&&u<n?t[c+e*u]:0)+(0<=r&&r<e&&0<=i&&i<n?t[r+e*i]:0)-(0<=l&&l<e&&0<=s&&s<n?t[l+e*s]:0)-(0<=(c=l+a-o)&&c<e&&0<=f&&f<n?t[c+e*f]:0))},z=A,t="prototype",mt=Math,pt=Object.prototype.hasOwnProperty,dt=z.Util.String.trim,e=z.Util.GLSL||{},gt=z.Array32F,_t=z.Array32I,xt=dt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","attribute vec2 pos;","attribute vec2 uv;","uniform vec2 resolution;","/*uniform float flipY;*/","varying vec2 pix;","void main(void) {","vec2 zeroToOne = pos / resolution;","vec2 zeroToTwo = zeroToOne * 2.0;","vec2 clipSpace = zeroToTwo - 1.0;","gl_Position = vec4(clipSpace * vec2(1.0, /*flipY*/1.0), 0.0, 1.0);","pix = uv;","}"].join("\n")),w=dt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","varying vec2 pix;","uniform sampler2D img;","void main(void) {","gl_FragColor = texture2D(img, pix);","}"].join("\n")),vt=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif"].join("\n"),Ct=/\/\*.*?\*\//gim,wt=/\/\/.*?$/gim,At=/\battribute\s+(\w+)\s+(\w+)\s*(\[)?/gi,St=/\buniform\s+(\w+)\s+(\w+)\s*(\[)?/gi,e.DEFAULT=w,wa[t]={constructor:wa,id:null,uniform:null,attribute:null,vertexSource:null,fragmentSource:null},Aa[t]={constructor:Aa,begin:null,shader:null,dimensions:null,save:null,input:null,output:null,end:null,code:null},e.run=function(r,i,t,e,a,o,n){b=r,w=o,null==(C=a)&&null==w&&(w=b.selection?(S=b.selection,A=b.width-1,U=b.height-1,R=S[0],I=S[1],B=S[2],Y=S[3],A=S[4]?A:1,S=S[4]?U:1,R=+mt.floor(R*A),I=+mt.floor(I*S),C=(B=+mt.floor(B*A))-R+1,(Y=+mt.floor(Y*S))-I+1):(C=b.oCanvas.width,b.oCanvas.height));var l,s,u,c,N,f,h,H,m,p,d,g,_,x,v,y,b,C,w,U,A,S,R,I,B,Y,L=z.getGL(b,C,w),D=null,E=null,T=t.length,M=[null,null],G=-1,F=-1,O=!1;if(L){if(p=function(){Ta(L,u),Ta(L,c),Ra(L,D),Da(L,E),Da(L,M[0]),Da(L,M[1]),Da(L,f),Da(L,h),h=f=M=E=D=c=u=null},d=function(){p(),r.cache={},z.log("GL context lost on #"+r.id)},_=function(t,e,n,r){f!==n&&Da(L,f),h!==n&&Da(L,h),r||(Da(L,M[0]),Da(L,M[1]),M=[null,null]),G<F&&l<F&&(f!==n&&(f=La(L,t,e)),h!==n)&&(h=La(L,t,e))},g=function(t,e,n){a===t&&o===e||(x=a,v=o,a=t,o=e,z.setGLDimensions(r,a,o),Ta(L,u),u=Ea(L,new z.Array32F([0,0,a,0,0,o,0,o,a,0,a,o])),L.viewport(0,0,a,o),n&&_(a,o,null,!1),i.hasMeta&&(i.meta=i.meta||{},i.meta._IMG_WIDTH=a,i.meta._IMG_HEIGHT=o))},L.isContextLost&&L.isContextLost())return d();for(l=0;l<T&&(t[l].shader&&G<0&&(G=l),t[T-1-l].shader&&F<0&&(F=T-1-l),!(0<=G&&0<=F));++l);for(H=r.cache,u=Ea(L,new z.Array32F([0,0,a,0,0,o,0,o,a,0,a,o])),c=Ea(L,new z.Array32F([0,0,1,0,0,1,0,1,1,0,1,1])),L.viewport(0,0,a,o),G<F&&(f=La(L,a,o),h=La(L,a,o)),x=a,v=o,l=0;l<T;++l)if(y=!1,(s=t[l]).init&&s.init(L,e,x,v,O,H),y=s.program&&s.program.id?!0:y){if(!((y="function"==typeof(y=s.iterations||0)?y(a,o,x,v)||0:y)<1)){if(null!=s.dimensions?(g((y="function"==typeof s.dimensions?s.dimensions(a,o):s.dimensions)[0],y[1],!1),x===a&&v===o||_(a,o,f,!1)):(x=a,v=o),y=l!==G&&D?f:{fbo:null,tex:D=D||Ia(L,e,x,v,0),w:x,h:v},N=l===F?E=E||La(L,a,o):(h.w===a&&h.h===o||(Da(L,h),h=La(L,a,o)),h),!O&&G<l&&y.fbo&&Ia(L,e,y.w,y.h,0,0,y.tex),function(t,e,n,r,i,a,o){var l,s,u,c,f,h,m=a.w,p=a.h,d=i.w,g=i.h,_=("function"==typeof e.iterations?e.iterations(m,p,d,g):e.iterations)||1,x=(v=e.program).uniform,v=v.attribute,y=_-1;if(t.isContextLost&&t.isContextLost())return!0;for(t.useProgram(e.program.id),pt.call(v,"pos")&&(t.enableVertexAttribArray(v.pos.loc),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(v.pos.loc,2,t.FLOAT,!1,0,0)),pt.call(v,"uv")&&(t.enableVertexAttribArray(v.uv.loc),t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(v.uv.loc,2,t.FLOAT,!1,0,0)),pt.call(x,"resolution")&&"vec2"===x.resolution.type&&t.uniform2f(x.resolution.loc,m,p),pt.call(x,"dp")&&"vec2"===x.dp.type&&t.uniform2f(x.dp.loc,1/m,1/p),e.instance&&pt.call(x,"selection")&&"vec4"===x.selection.type&&(v=(n=e.instance.selection)?(r=n[4]?u=1:(u=1/(m-1||1),1/(p-1||1)),l=mt.min(1,mt.max(0,n[0]*u)),s=mt.min(1,mt.max(0,n[1]*r)),u=mt.min(1,mt.max(0,n[2]*u)),mt.min(1,mt.max(0,n[3]*r))):(s=l=0,u=1),t.uniform4f(x.selection.loc,l,s,u,v)),e.instance&&pt.call(x,"mode")&&"int"===x.mode.type&&t.uniform1i(x.mode.loc,e.instance.mode),e.inputs&&(i=e.inputs(t,m,p,d,g,i)),1<_&&(o[0]=o[0]||La(t,m,p),o[1]=o[1]||La(t,m,p)),c=0;c<_;++c){if(t.isContextLost&&t.isContextLost())return!0;h=0===c?i:o[0],f=c===y?a:o[1],pt.call(x,e._input)&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.tex),t.uniform1i(x[e._input].loc,0)),t.bindFramebuffer(t.FRAMEBUFFER,f.fbo),t.viewport(0,0,m,p),t.drawArrays(t.TRIANGLES,0,6),h=o[0],o[0]=o[1],o[1]=h}e.output&&e.output(t,a)}(L,s,u,c,y,N,M)||L.isContextLost&&L.isContextLost())return d();y=f,f=h,h=y,O=!0}}else"function"==typeof s.shader?(m=O?Ma(L,a,o):e,e=s.shader(s,m,a,o),O=!1):s.instance&&(s._apply||s.instance._apply_wasm||s.instance._apply)&&(m=O?Ma(L,a,o):e,e=s._apply?s._apply(m,a,o,n):s.instance._apply_wasm?s.instance._apply_wasm(m,a,o,n):s.instance._apply(m,a,o,n),s.instance.hasMeta&&null!=s.instance.meta._IMG_WIDTH&&null!=s.instance.meta._IMG_HEIGHT&&g(s.instance.meta._IMG_WIDTH,s.instance.meta._IMG_HEIGHT,!0),O=!1);return O&&(T=a*o<<2,e.length!==T&&(e=new z.ImArray(T)),Ma(L,a,o,e)),p(),e}},e.uploadTexture=Ia,e.getPixels=Ma,e.formatFloat=function(t,e){var n=t.toString();return(!e||t<0?"":"+")+n+(-1===n.indexOf(".")?".0":"")},e.formatInt=function(t,e){return t=mt.floor(t),(!e||t<0?"":"+")+t.toString()},e.staticSort=function(t,e,n){e=e||"temp",n=n||Ga;for(var r,i,a,o,l,s,u=t.length,c=[],f=1;f<u;f<<=1)for(r=f<<1,i=f;1<=i;i>>>=1)for(a=i<<1,o=i%f;o<=u-1-i;o+=a)for(l=0,s=mt.min(i-1,u-o-i-1);l<=s;++l)mt.floor((l+o)/r)===mt.floor((l+o+i)/r)&&c.push(n(t[l+o],t[l+o+i],e));return c},e.Filter=Aa,e.isSupported=z.supportsGLSL(),e.isLoaded=!0,z.Util.GLSL=e,(n=(Rt=A).Util.WASM||{}).base64ToArrayBuffer=Fa,n.instantiate=function(t,r,i){var e,s,o,a,u;function l(t,e){if(!e)return null;var n,r={};for(n in t)switch(t[n].type){case"i32":r[n]=function(t){try{return u.getInt32(t,!0)}catch{return(u=new DataView(o.buffer)).getInt32(t,!0)}}(e+t[n].offset);break;case"f32":r[n]=function(t){try{return u.getFloat32(t,!0)}catch{return(u=new DataView(o.buffer)).getFloat32(t,!0)}}(e+t[n].offset);break;default:Rt.Array32F!==t[n].type&&Rt.Array32I!==t[n].type&&Rt.Array16I!==t[n].type&&Rt.Array8U!==t[n].type&&Rt.ImArray!==t[n].type||(r[n]=c(t[n].type,x(e+t[n].offset)))}return r}function c(t,e){return e?new t(o.buffer,x(e+4),u.getUint32(e+8,!0)/t.BYTES_PER_ELEMENT).slice():null}function f(t,e){var n,r,i,a;return null==e?0:(a=4,n=0,n=Rt.Array16I===t?(a=6,1):Rt.Array32I===t||Rt.Array32F===t?(a=5,2):(a=4,0),r=e.length,i=s.__pin(s.__new(r<<n,1))>>>0,g(a=s.__new(12,a)>>>0,i),u.setUint32(4+a,i,!0),u.setUint32(8+a,r<<n,!0),new t(o.buffer,i,r).set(e),s.__unpin(i),a)}function h(n,t){if(null==t)return 0;var e=4,r=0,i="f32"===n?(e=5,r=2,_):"i32"===n?(e=7,r=2,g):(e=6,r=2,function(t,e){g(t,f(n,e)||d())}),a=t.length,o=s.__pin(s.__new(a<<r,1))>>>0,e=s.__pin(s.__new(16,e))>>>0;g(e,o),u.setUint32(4+e,o,!0),u.setUint32(8+e,a<<r,!0),u.setUint32(12+e,a,!0);for(var l=0;l<a;++l)i(o+(l<<r>>>0),t[l]);return s.__unpin(o),s.__unpin(e),e}function m(t){if(!t)return null;for(var e=t+new Uint32Array(o.buffer)[t-4>>>2]>>>1,n=new Uint16Array(o.buffer),r=t>>>1,i="";1024<e-r;)i+=String.fromCharCode.apply(String,n.subarray(r,r+=1024));return i+String.fromCharCode.apply(String,n.subarray(r,e))}function p(t){var e;return t&&((e=a.get(t))?a.set(t,e+1):a.set(s.__pin(t),1)),t}function d(){throw TypeError("value must not be null")}function g(t,e){try{u.setUint32(t,e,!0)}catch{(u=new DataView(o.buffer)).setUint32(t,e,!0)}}function _(t,e){try{u.setFloat32(t,e,!0)}catch{(u=new DataView(o.buffer)).setFloat32(t,e,!0)}}function x(t){try{return u.getUint32(t,!0)}catch{return(u=new DataView(o.buffer)).getUint32(t,!0)}}return i=i||{},(r=r||{}).env=r.env||{},e={env:Object.assign(Object.create(Rt.global),r.env,{abort:function(t,e,n,r){throw t=m(t>>>0),e=m(e>>>0),n>>>=0,r>>>=0,Error(t+" in "+e+":"+n+":"+r)}})},a=new Map,WebAssembly.compile(Fa(t)).then(function(t){return t?WebAssembly.instantiate(t,e):Promise.resolve(null)}).catch(function(t){return Rt.error(t),Promise.resolve(null)}).then(function(t){if(!t)return null;s=t.exports,o=s.memory||r.env.memory,u=new DataView(o.buffer);var e,n={};for(e in i)n[e]=function(r,e,i){return function(){var t,n=Array.prototype.slice.call(arguments);return r.forEach(function(t,e){e+1<r.length?t.array?n[t.arg]=p(h(t.type,n[t.arg])||d()):n[t.arg]=p(f(t.type,n[t.arg])||d()):t.array?n[t.arg]=h(t.type,n[t.arg])||d():n[t.arg]=f(t.type,n[t.arg])||d()}),s.__setArgumentsLength&&s.__setArgumentsLength(n.length),t=i.apply(s,n),e.struct?t=l(e.struct,t>>>0):e.type&&(t=c(e.type,t>>>0)),r.forEach(function(t,e){if(e+1<r.length){e=n[t.arg];if(e){t=a.get(e);if(1===t)s.__unpin(e),a.delete(e);else{if(!t)throw Error('invalid refcount "'+t+'" for reference "'+e+'"');a.set(e,t-1)}}}}),t}}(i[e].inputs,i[e].output,s[e]);return Object.setPrototypeOf(n,s)})},n.isSupported=Rt.supportsWASM(),n.isLoaded=!0,Rt.Util.WASM=n,c=A,It="prototype",r=Object[It],Lt=Function[It],Dt=Array[It],Et=r.hasOwnProperty,Tt=Object.keys,r=Math,Mt=c.Asynchronous,Gt=Mt.isPlatform(Mt.Platform.NODE),Mt.isPlatform(Mt.Platform.BROWSER),Mt.supportsMultiThreading(),Ft=Mt.isThread(null,!0),Ot=Mt.isThread(),Nt=c.Path,Ht=c.Class.Merge,Ut=c.Util.GLSL,Bt=c.Util.WASM,c._notSupportClamp,c.log,Yt=r.min,zt=r.max,kt=0,r=c.FilterThread=c.Class(Mt,{path:Nt,name:null,_listener:null,_rand:null,constructor:function(){var n=this,r=null;Ft&&n.initThread().listen("load",function(t){t&&t.filter&&(r&&(r.dispose(!0),r=null),r=Mt.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&Mt.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(e){r&&e&&e.im?c.onReady(function(){var t=e.im;t[0]=c.Util.Array.typed(t[0],c.ImArray),e.params&&r.unserializeFilter(e.params),e.inputs&&r.unserializeInputs(e.inputs,t),t=r._apply(t[0],t[1],t[2]),n.send("apply",{im:!!r._update&&t,meta:r.hasMeta?r.metaData(!0):null})}):n.send("apply",{im:null})}).listen("apply_wasm",function(e){r&&e&&e.im?c.onReady(function(){var t=e.im;t[0]=c.Util.Array.typed(t[0],c.ImArray),e.params&&r.unserializeFilter(e.params),e.inputs&&r.unserializeInputs(e.inputs,t),t=r._apply_wasm(t[0],t[1],t[2]),n.send("apply",{im:!!r._update&&t,meta:r.hasMeta?r.metaData(!0):null})}):n.send("apply",{im:null})}).listen("dispose",function(t){r&&(r.dispose(!0),r=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=Gt?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",Nt.file!==n.path.file?[Nt.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:Dt.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(Mt.blob("function"==typeof t[n]?Lt.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:Dt.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),Pt=c.Filter=c.Class(r,{name:"Filter",constructor:function(){this.id=++kt,this.inputs={},this.meta=null},_isOn:!0,_isGLSL:!1,_isWASM:!1,_glsl:null,_wasm:null,_runWASM:!1,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._isGLSL=t._isWASM=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t._glsl=t._wasm=null,t.$super("dispose"),t},worker:r[It].thread,getParam:function(t){if(t&&"_"!==t.charAt(0)&&Et.call(this.constructor[It],t))return this[t]},setParam:function(t,e){return t&&"_"!==t.charAt(0)&&Et.call(this.constructor[It],t)&&(this[t]=e),this},metaData:function(t,e){return this.meta},getMetaData:function(t,e){return this.metaData(t,e)},setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){var n=this;return t=String(t),null===e?n.inputs[t]&&(delete n.inputs[t],n._glsl=null):(n.inputs[t]=[null,e,e.nref],n._glsl=null),n},unsetInput:function(t){return t=String(t),this.inputs[t]&&(delete this.inputs[t],this._glsl=null),this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,isInputUpdated:function(t){t=this.inputs[String(t)];return!(!t||!(!0===t[3]||null==t[0]||t[1]&&t[2]!==t[1].nref))},serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,r,i=this.inputs,a=Tt(i),o=a.length;if(!o)return null;for(r={_updated:{}},n=0;n<o;++n)(null==(e=i[a[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(r._updated[a[n]]=!0,e[2]=e[1].nref,r[a[n]]=t===e[1]||e[1].getSelectedData(1));return r},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,r=t._updated||{},i=(t._updated&&delete t._updated,this.inputs),a=Tt(t),o=a.length,l=c.ImArray,s=c.Util.Array.typed,u=0;u<o;++u)(n=t[a[u]])&&(!0===n?n=e:n[0]=s(n[0],l),i[a[u]]=[n,null,0,r[a[u]]||!1]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,r,i){return this.selection=!1===t?null:i?[zt(0,t||0),zt(0,e||0),zt(0,n||0),zt(0,r||0),0]:[Yt(1,zt(0,t||0)),Yt(1,zt(0,e||0)),Yt(1,zt(0,n||0)),Yt(1,zt(0,r||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},isGLSL:function(){return this._isGLSL},isWASM:function(){return this._isWASM},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},makeGLSL:function(t){return this._isGLSL=!!((t=arguments.length?t:!0)&&Ut.isLoaded&&c.supportsGLSL()&&this.getGLSL!==c.Filter.prototype.getGLSL),this},GLSLCode:function(){return null==this._glsl&&(this._glsl=this.getGLSL()||{instance:this}),this._glsl},getGLSL:function(){return!1},makeWASM:function(t){return this._isWASM=!!((t=arguments.length?t:!0)&&Bt.isLoaded&&c.supportsWASM()&&this.getWASM!==c.Filter.prototype.getWASM),this},WASMCode:function(){return null==this._wasm&&(this._wasm=this.getWASM()||""),this._wasm},getWASM:function(){return!1},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply_wasm:function(t,e,n,r){return this._runWASM=!0,t=this._apply(t,e,n,r),this._runWASM=!1,t},_apply:function(t,e,n,r){return t},apply_:function(t,e,n,r,i){var a,o=this;return o.canRun()?o.$thread?(o._listener.cb=function(t){o._listener.cb=null,t&&t.im&&(e=c.Util.Array.typed(t.im,c.ImArray)),i(e,o)},o.send(o.isWASM()?"apply_wasm":"apply",{im:[e,n,r,2],params:o.serializeFilter(),inputs:o.serializeInputs(t)})):(!Ot&&o.isGLSL()?(a=o.GLSLCode())&&(a=(a=a.push||a.pop?a:[a]).filter(Na)).length&&(a=Ut.run(t,o,a,e,n,r,{src:t,dst:t}))&&(e=a):e=o.isWASM()?o._apply_wasm(e,n,r,{src:t,dst:t}):o._apply(e,n,r,{src:t,dst:t}),i(e,o)):i(e,o),o},apply:function(t,e,n){var r,i,a,o,l,s=this;return s.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||s.onComplete,r=t.getSelectedData(),a=r[1],o=r[2],s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMetaData(t.meta,!0),t.im)&&s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(c.Util.Array.typed(t.im,c.ImArray))),n&&n.call(s)},s.send(s.isWASM()?"apply_wasm":"apply",{im:r,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(!Ot&&s.isGLSL()?(l=s.GLSLCode())&&(l=(l=l.push||l.pop?l:[l]).filter(Na)).length&&(i=Ut.run(e,s,l,r[0],a,o,{src:t,dst:e}),s._update)&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),i)&&e.setSelectedData(i):(i=s.isWASM()?s._apply_wasm(r[0],a,o,{src:t,dst:e}):s._apply(r[0],a,o,{src:t,dst:e}),s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(i))),n&&n.call(s))),t},toString:function(){return"[FILTER: "+this.name+"("+this.id+")]"}}),c.Filter[It].getInput=c.Filter[It].input,c.Filter[It].delInput=c.Filter[It].unsetInput,c.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,r=c,i=0;i<n;++i){if(!r[e=t[i]])return null;r=r[e]}return r}return c[t]||null},c.Create=function(t){var e,n=(t=Ht({init:Oa,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==Pt[It].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==Pt[It].getMetaData&&(t.metaData=t.getMetaData),delete t.init,Et.call(t,"apply")&&delete t.apply,c[n]=c.Class(Pt,t)},jt=A,h=Math,Xt=h.sqrt,Wt=h.round,h.floor,$t=h.min,qt=h.max,h.abs,h.sin,h.cos,h.PI,m=jt.Util.Math.clamp,jt.Util.String.esc,Vt=jt.Util.String.trim,Kt=/^#([0-9a-fA-F]{3,6})\b/,Zt=/^(rgba?)\b\s*\(([^\)]*)\)/i,Jt=/^(hsla?)\b\s*\(([^\)]*)\)/i,Qt=/^(hwba?)\b\s*\(([^\)]*)\)/i,te=/\s+|,/gm,ee=/\/\s*(\d*?\.?\d+%?)/,ne=jt.LUMA,jt.CHANNEL,re=1/255,ie=2.55,ae=["#define FORMAT_HWB 3","#define FORMAT_HSV 2","#define FORMAT_HSL 1","vec4 hsl2rgb(float h, float s, float l) {","   float c = (1.0 - abs(2.0*l - 1.0))*s;","   float hp = h/60.0;","   float d = float(floor(hp / 2.0));","   float x = c*(1.0 - abs(hp - 2.0*d - 1.0));","   float m = l - c/2.0;","   vec4 rgb = vec4(0.0,0.0,0.0,1.0);","   if (hp >= 0.0 && hp < 1.0) {","       rgb.r = c + m;","       rgb.g = x + m;","       rgb.b = m;","   } else if (hp >= 1.0 && hp < 2.0) {","       rgb.r = x + m;","       rgb.g = c + m;","       rgb.b = m;","   } else if (hp >= 2.0 && hp < 3.0) {","       rgb.r = m;","       rgb.g = c + m;","       rgb.b = x + m;","   } else if (hp >= 3.0 && hp < 4.0) {","       rgb.r = m;","       rgb.g = x + m;","       rgb.b = c + m;","   } else if (hp >= 4.0 && hp < 5.0) {","       rgb.r = x + m;","       rgb.g = m;","       rgb.b = c + m;","   } else {","       rgb.r = c + m;","       rgb.g = m;","       rgb.b = x + m;","   }","   return clamp(rgb, 0.0, 1.0);","}","vec4 hsv2rgb(float h, float s, float v) {","    float l = v*(1.0 - s/2.0);","    float lm = min(l, 1.0-l);","    if (0.0 == lm) return hsl2rgb(h, 0.0, l);","    else return hsl2rgb(h, (v-l)/lm, l);","}","vec4 hwb2rgb(float h, float w, float b) {","    float b1 = 1.0 - b;","    return hsv2rgb(h, 1.0 - w/b1, b1);","}","vec4 rgb2hslvwb(float r, float g, float b, int type) {","    float xmax = max(r, max(g, b));","    float xmin = min(r, min(g, b));","    float v = xmax;","    float c = xmax - xmin;","    float l = clamp((xmax + xmin)/2.0, 0.0, 1.0);","    float wh = clamp(xmin, 0.0, 1.0);","    float bl = clamp(1.0 - xmax, 0.0, 1.0);","    float h = 0.0;","    if (0.0 == c) {","        h = 0.0;","    } else if (v == r) {","        h = 60.0*((g - b)/c);","    } else if (v == g) {","        h = 60.0*(2.0 + (b - r)/c);","    } else {","        h = 60.0*(4.0 + (r - g)/c);","    }","    h = clamp(h, 0.0, 360.0);","   float sl; float sv;","    if (0.0 == l || 1.0 == l) {","        sl = 0.0;","    } else {","        sl = clamp((v - l)/min(l, 1.0 - l), 0.0, 1.0);","    }","    if (0.0 == v) {","        sv = 0.0;","    } else {","        sv = clamp(c/v, 0.0, 1.0);","    }","    v = clamp(v, 0.0, 1.0);","    if (FORMAT_HWB == type) return vec4(h, wh, bl, 1.0);","    else if (FORMAT_HSV == type) return vec4(h, sv, v, 1.0);","    return vec4(h, sl, l, 1.0);","}","vec4 rgb2hsl(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL);","}","vec4 rgb2hsv(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSV);","}","vec4 rgb2hwb(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HWB);","}","vec4 rgb2cmyk(float r, float g, float b) {","    if (0.0 == r && 0.0 == g && 0.0 == b) {","       return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float c = 1.0 - r;","    float m = 1.0 - g;","    float y = 1.0 - b;","    float minCMY = min(c, min(m, y));","    float invCMY = 1.0 / (1.0 - minCMY);","    return vec4(","        (c - minCMY) * invCMY,","        (m - minCMY) * invCMY,","        (y - minCMY) * invCMY,","        minCMY","    );","}","vec4 cmyk2rgb(float c, float m, float y, float k) {","    if (0.0 == c && 0.0 == m && 0.0 == y) {","        return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float minCMY = k;","    float invCMY = 1.0 - minCMY;","    c = c*invCMY + minCMY;","    m = m*invCMY + minCMY;","    y = y*invCMY + minCMY;","    return vec4(","        1.0 - c,","        1.0 - m,","        1.0 - y,","        1.0","    );","}","vec4 rgb2ycbcr(float r, float g, float b) {","    return clamp(vec4(","    0.0 + 0.299*r    + 0.587*g     + 0.114*b,","    0.5 - 0.168736*r - 0.331264*g  + 0.5*b,","    0.5 + 0.5*r      - 0.418688*g  - 0.081312*b,","    1.0","    ), 0.0, 1.0);","}","vec4 ycbcr2rgb(float y, float cb, float cr) {","    return clamp(vec4(","    y                      + 1.402   * (cr-0.5),","    y - 0.34414 * (cb-0.5) - 0.71414 * (cr-0.5),","    y + 1.772   * (cb-0.5),","    1.0","    ), 0.0, 1.0);","}","float rgb2hue(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL).x;","}","float rgb2sat(float r, float g, float b, int type) {","    return rgb2hslvwb(r, g, b, type).y;","}","float intensity(float r, float g, float b) {","    return clamp("+ne[0]+"*r + "+ne[1]+"*g + "+ne[2]+"*b, 0.0, 1.0);","}"].join("\n"),(oe=jt.Color=jt.Class({__static__:{GLSLCode:function(){return ae},clamp:m,clampPixel:function(t){return $t(255,qt(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,r){return(255&r)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},rgb24GL:function(t){var e=jt.Util.GLSL.formatFloat;return"vec3("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255)].join(",")+");"},rgba32GL:function(t){var e=jt.Util.GLSL.formatFloat;return"vec4("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255),e((t>>>24&255)/255)].join(",")+");"},intensity:function(t,e,n){return~~Wa(t,e,n)},hue:function(t,e,n){return t=t,e=e,n=n,r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),i=r=h.max(t,e,n),a=h.min(t,e,n),m(h.round(0==(r=r-a)?0:i===t?60*(0+(e-n)/r):i===e?60*(2+(n-t)/r):60*(4+(t-e)/r)),0,360);var r,i,a},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(r=!(i="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=h.max(t,e,n),e=r-(t=h.min(t,e,n)),r=0==(n=(r+t)/2)||1==n?0:(a-n)/h.min(n,1-n),t=0===a?0:e/a,m("hsv"===i?100*t:100*r,0,100));var r,i,a},dist:function(t,e,n,r){var i=t[n+0]-e[r+0],a=t[n+1]-e[r+1],t=t[n+2]-e[r+2];return Xt(i*i+a*a+t*t)},RGB2Gray:function(t,e){var n=ne[0]*t[e+0]+ne[1]*t[e+1]+ne[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=.412453*n+.35758*r+.180423*i|0,t[e+1]=.212671*n+.71516*r+.072169*i|0,t[e+2]=.019334*n+.119193*r+.950227*i|0,t},XYZ2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,r=t[e+1]/255,i=t[e+2]/255,a=Math.log,o=.412453*n+.35758*r+.180423*i,l=.212671*n+.71516*r+.072169*i,n=.019334*n+.119193*r+.950227*i,r=a(.9465229*o+.2946927*l-.1313419*n),i=a(-.1179179*o+.992996*l+.007371554*n),a=a(.09230461*o-.04645794*l+.9946464*n);return t[e+0]=27.07439*r-22.80783*i-1.806681*a,t[e+1]=-5.646736*r-7.722125*i+12.86503*a,t[e+2]=-4.163133*r-4.579428*i-4.576049*a,t},ILL2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2],a=Math.exp,o=a(.021547742011105847*n-.021969518919866274*r-.07027206572176435*i),l=a(-.018152109501074376*n-.03004415376911152*r-.07729896865586937*i),a=a(-.0014378861182725712*n+.050053456205559545*r-.07724195758868482*i),n=1.0068824301911365*o-.2924918682640871*l+.13512537828457516*a,r=.12021888110585245*o+.9717816461525606*l+.008672665360769691*a,i=-.08782494811157235*o+.07253363731909634*l+.9932476695469974*a;return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=0+.299*n+.587*r+.114*i|0,t[e+1]=128-.168736*n-.331264*r+.5*i|0,t[e+2]=128+.5*n-.418688*r-.081312*i|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=n+1.402*(i-128)|0,t[e+1]=n-.34414*(r-128)-.71414*(i-128)|0,t[e+2]=n+1.772*(r-128)|0,t},RGB2HSV:function(t,e,n){var r=ka(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HSL:function(t,e,n){var r=za(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HWB:function(t,e,n){var r=Pa(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},HSV2RGB:function(t,e,n){n=Ua(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=Ha(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=Ba(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,r=t[e+0],i=t[e+1],a=t[e+2];return 0===r&&0===i&&0===a||(n=$t(r=255-r,i=255-i,a=255-a),t[e+0]=(r-n)*(r=255===n?0:255/(255-n)),t[e+1]=(i-n)*r,t[e+2]=(a-n)*r),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:re,C2P:100/255,P2C:ie,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*(100/255)+(e||"")},per2col:function(t){return t*ie},rgb2hex:function(t,e,n,r,i){return i&&(t=m(Wt(t*ie),0,255),e=m(Wt(e*ie),0,255),n=m(Wt(n*ie),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),r&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,r,i){return i&&(t=m(Wt(t*ie),0,255),e=m(Wt(e*ie),0,255),n=m(Wt(n*ie),0,255),r=m(Wt(r*ie),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(r=r<16?"0"+r.toString(16):r.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[m(parseInt(t[0]+t[0],16),0,255),m(parseInt(t[1]+t[1],16),0,255),m(parseInt(t[2]+t[2],16),0,255)]:[m(parseInt(t[0]+t[1],16),0,255),m(parseInt(t[2]+t[3],16),0,255),m(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:Ha,hsv2rgb:Ua,hwb2rgb:Ba,rgb2hsl:za,rgb2hsv:ka,rgb2hwb:Pa,rgb2cmyk:ja,cmyk2rgb:Xa,parse:function(t){var e,n,r,i,a,o,l,s=null,u=1;if((e=(t=Vt(String(t)).toLowerCase()).match(Kt))?(s=hex2rgb(e[1]),u=1,e[0].length,0):(e=t.match(Qt))?(n=e[2].match(ee),o=(r=Vt(e[2]).split(te).map(Vt))[0]||"0",l=r[1]||"0",i=r[2]||"0",a=n?n[1]:"1",o=parseFloat(o,10),l="%"===l.slice(-1)?parseFloat(l,10):100*parseFloat(l,10)/255,i="%"===i.slice(-1)?parseFloat(i,10):100*parseFloat(i,10)/255,a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),s=Ba(o,l,i),u=a,e[0].length,0):(e=t.match(Jt))?(n=e[2].match(ee),o=(r=Vt(e[2]).split(te).map(Vt))[0]||"0",t=r[1]||"0",l=r[2]||"0",a=n?n[1]:"hsla"===e[1]&&null!=r[3]?r[3]:"1",o=parseFloat(o,10),t="%"===t.slice(-1)?parseFloat(t,10):100*parseFloat(t,10)/255,l="%"===l.slice(-1)?parseFloat(l,10):100*parseFloat(l,10)/255,a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),s=Ha(o,t,l),u=a,e[0].length,0):(e=t.match(Zt))&&(n=e[2].match(ee),o=(r=Vt(e[2]).split(te).map(Vt))[0]||"0",l=r[1]||"0",i=r[2]||"0",a=n?n[1]:"rgba"===e[1]&&null!=r[3]?r[3]:"1",s=[o="%"===o.slice(-1)?2.55*parseFloat(o,10):parseFloat(o,10),l="%"===l.slice(-1)?2.55*parseFloat(l,10):parseFloat(l,10),i="%"===i.slice(-1)?2.55*parseFloat(i,10):parseFloat(i,10)],u=a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),e[0].length,0),s)return(new oe).fromRGB([s[0],s[1],s[2],u])},fromString:function(t){return oe.parse(t)},fromRGB:function(t){return(new oe).fromRGB(t)},fromHSL:function(t){return(new oe).fromHSL(t)},fromHSV:function(t){return(new oe).fromHSV(t)},fromHWB:function(t){return(new oe).fromHWB(t)},fromCMYK:function(t){return(new oe).fromCMYK(t)},fromHEX:function(t){return(new oe).fromHEX(t)},fromPixel:function(t){return(new oe).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new oe;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=m(t[0],0,255)),null!=t[1]&&(this.col[1]=m(t[1],0,255)),null!=t[2]&&(this.col[2]=m(t[2],0,255)),null!=t[3]?this.col[3]=m(t[3],0,1):this.col[3]=1,this.kword=null),this},isLight:function(t){return(t=null==t?127.5:t)<=Wa(this.col[0],this.col[1],this.col[2])},isTransparent:function(){return this.col[3]<1},fromPixel:function(t){return this.col=[m((t=t||0)>>16&255,0,255),m(t>>8&255,0,255),m(255&t,0,255),m((t>>24&255)*re,0,1)],this.kword=null,this},fromHEX:function(t){return this.col[0]=t[0]?m(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?m(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?m(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?m(parseInt(t[3],10)*re,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?m(Wt(t[0]),0,255):0,this.col[1]=t[1]?m(Wt(t[1]),0,255):0,this.col[2]=t[2]?m(Wt(t[2]),0,255):0,this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=Xa(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?m(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=Ha(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=Ua(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=Ba(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?m(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var r=ja(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toHEX:function(t,e,n){return n?oe.rgb2hexIE(this.col[0],this.col[1],this.col[2],m(Wt(255*this.col[3]),0,255)):oe.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var r=this.col[3];return t?(e&&(r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var r=this.col[3],i=za(this.col[0],this.col[1],this.col[2]);return t?(e&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toHWB:function(t,e,n){var r=this.col[3],i=Pa(this.col[0],this.col[1],this.col[2]);return t?(e&&(i[1]=0===i[1]?i[1]:String(i[1])+"%",i[2]=0===i[2]?i[2]:String(i[2])+"%",r=r<1&&0<r?r.toString().slice(1):r),n||1===this.col[3]?"hwb("+[i[0],i[1],i[2]].join(" ")+")":"hwb("+[i[0],i[1],i[2]].join(" ")+" / "+r+")"):n?i:i.concat(this.col[3])},toString:function(t,e){return"rgb"===(t=t?t.toLowerCase():"hex")||"rgba"===t?this.toRGB(1,!1!==e,"rgb"===t):"hsl"===t||"hsla"===t?this.toHSL(1,!1!==e,"hsl"===t):"hwb"===t?this.toHWB(1,!1!==e,!1):this.toHEX(1,!1!==e,"hexie"===t)}})).toGray=oe.intensity,i="prototype",p=A,S=p.CHANNEL,p.Color,le=p.Util.Array.copy,p.Util.Array.subarray,se=p.Util.Math.clamp,(ue=Math).min,g=ue.floor,ce=0,S.R,S.G,S.B,S.A,(fe=p.Image=p.Class({name:"Image",constructor:function t(e,n){var r=this;if(!(r instanceof t))return new t(e,n);r.id=++ce,r.width=0,r.height=0,r.ctxOpts=n||{},r.iCanvas=p.Canvas(0,0),r.oCanvas=p.Canvas(0,0),r.domElement=r.oCanvas,r.iData=null,r.iDataSel=null,r.oData=null,r.oDataSel=null,r._restorable=!0,r.gray=!1,r.selection=null,r._refresh=0,r.nref=0,r.cache={},r._refresh|=15,e&&r.image(e)},id:null,width:0,height:0,gray:!1,selection:null,ctxOpts:null,iCanvas:null,oCanvas:null,gl:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_refresh:0,nref:0,cache:null,dispose:function(){var t=this;return p.disposeGL(t),t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=t.gl=null,t._restorable=null,t._refresh=t.nref=null,t.cache=t.ctxOpts=null,t},clone:function(t,e){return new fe(!0===t?this.iCanvas:this.oCanvas,e||this.ctxOpts)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,r,i){var a=this,o=arguments.length;return!1===t?(a.selection=null,a.iDataSel=null,a.oDataSel=null,a._refresh&=-13):(o<1&&(t=0),o<2&&(e=0),o<3&&(n=1),o<4&&(r=1),a.selection=i?[t<0?0:t,e<0?0:e,n<0?0:n,r<0?0:r,0]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,r<0?0:1<r?1:r,1],a._refresh|=12),a.nref=(a.nref+1)%1e3,a},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d",t.ctxOpts).drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),t.nref=(t.nref+1)%1e3),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d",t.ctxOpts).drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),t.nref=(t.nref+1)%1e3),t},dimensions:function(t,e){var n=this;return $a(n,t,e,6)&&(n._refresh|=3,n.selection&&(n._refresh|=12),n.nref=(n.nref+1)%1e3),n},setDimensions:null,scale:function(t,e){var n,r,i=this,a=i.width,o=i.height;return t=t||1,e=e||t,1===t&&1===e||((r=(n=p.Canvas(+a,+o)).getContext("2d")).scale(t,e),a=i.width=ue.round(t*a),o=i.height=ue.round(e*o),r.drawImage(i.oCanvas,0,0),i.oCanvas.width=+a,i.oCanvas.height=+o,i.oCanvas.getContext("2d",i.ctxOpts).drawImage(n,0,0),i._restorable&&(r.drawImage(i.iCanvas,0,0),i.iCanvas.width=i.oCanvas.width,i.iCanvas.height=i.oCanvas.height,i.iCanvas.getContext("2d",i.ctxOpts).drawImage(n,0,0)),i._refresh|=3,i.selection&&(i._refresh|=12),i.nref=(i.nref+1)%1e3),i},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=p.Canvas(e,n),r=n.getContext("2d");return r.translate(e,0),r.scale(-1,1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d",t.ctxOpts).drawImage(n,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d",t.ctxOpts).drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=p.Canvas(e,n),r=e.getContext("2d");return r.translate(0,n),r.scale(1,-1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d",t.ctxOpts).drawImage(e,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d",t.ctxOpts).drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d",t.ctxOpts).clearRect(0,0,e,n),t.oCanvas.getContext("2d",t.ctxOpts).clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3),t},crop:function(t,e,n,r){var i,a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height;if(arguments.length)l=n-(a=t)+1,s=r-(o=e)+1;else{if(!c)return u;n=c[4]?(i=f-1,h-1):i=1,a=g(c[0]*i),o=g(c[1]*n),l=g(c[2]*i)-a+1,s=g(c[3]*n)-o+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}u.width=l,u.height=s,a*=1,o*=1;t=p.Canvas(l*=1,s*=1),r=t.getContext("2d");return r.drawImage(u.oCanvas,a,o,l,s,0,0,l,s),u.oCanvas.width=l,u.oCanvas.height=s,u.oCanvas.getContext("2d",u.ctxOpts).drawImage(t,0,0),u._restorable&&(r.drawImage(u.iCanvas,a,o,l,s,0,0,l,s),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.getContext("2d",u.ctxOpts).drawImage(t,0,0)),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},fill:function(t,e,n,r,i){var a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height,f=((r&&!f||i&&!h)&&($a(u,e+r,n+i,6),f=u.width,h=u.height),s=c?(s=c[4]?(l=f-1,h-1):l=1,a=g(c[0]*l),o=g(c[1]*s),l=g(c[2]*l)-a+1,g(c[3]*s)-o+1):(o=a=0,l=f,h),null==n&&(n=o),l<(r=null==r?l:r)&&(r=l),s<(i=null==i?s:i)&&(i=s),e=se(e=null==e?a:e,a,l),n=se(n,o,s),u.oCanvas.getContext("2d",u.ctxOpts)),h=u.iCanvas.getContext("2d",u.ctxOpts);return e*=1,n*=1,r*=1,i*=1,t=t||0,u._restorable&&(h.fillStyle=t,h.fillRect(e,n,r,i)),f.fillStyle=t,f.fillRect(e,n,r,i),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&qa(e,1),e.iData):(2&e._refresh&&qa(e,2),e.oData);return le(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&Va(e,4),e.iDataSel):(8&e._refresh&&Va(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&qa(e,1),e.iData):(2&e._refresh&&qa(e,2),e.oData);return[le(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d",e.ctxOpts).putImageData(p.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),e.nref=(e.nref+1)%1e3,e},setSelectedData:function(t){var e,n,r,i,a=this,o=a.selection,l=a.width,s=a.height;return o?(i=o[4]?(r=l-1,s-1):r=1,e=g(o[0]*r),n=g(o[1]*i),r=g(o[2]*r)-e+1,o=g(o[3]*i)-n+1,a.oCanvas.getContext("2d",a.ctxOpts).putImageData(p.Canvas.ImageData(t,r,o),+e,+n)):a.oCanvas.getContext("2d",a.ctxOpts).putImageData(p.Canvas.ImageData(t,+l,+s),0,0),a._refresh|=2,a.selection&&(a._refresh|=8),a.nref=(a.nref+1)%1e3,a},getDataFromSelection:function(t,e,n,r,i){var a=this,o=a.width-1,l=a.height-1,o=i?1:o,i=i?1:l;return t=+g(t*o),e=+g(e*i),l=(n=+g(n*o))-t+1,o=(r=+g(r*i))-e+1,n=(n=a.oCanvas.getContext("2d",a.ctxOpts).getImageData(t,e,l,o))||a.oCanvas.getContext("2d",a.ctxOpts).createImageData(0,0,l,o),[le(n.data),n.width,n.height,2]},setDataToSelection:function(t,e,n,r,i,a){var o=this,l=o.width-1,s=o.height-1,l=a?1:l,a=a?1:s;return e=+g(e*l),n=+g(n*a),s=(r=+g(r*l))-e+1,l=(i=+g(i*a))-n+1,o.oCanvas.getContext("2d",o.ctxOpts).putImageData(p.Canvas.ImageData(t,s,l),e,n),o._refresh|=2,o.selection&&(o._refresh|=8),o.nref=(o.nref+1)%1e3,o},mapReduce:function(o,l,s){var u=this,c=0,f=0;return o.forEach(function(t,n){var r,i,a,e;t&&t.filter?(r=t.from||{x:0,y:0},i=t.to||{x:u.width-1,y:u.height-1},a=!t.to||t.absolute,e=u.getDataFromSelection(r.x,r.y,i.x,i.y,a),t.filter.apply_(u,e[0],e[1],e[2],function(t,e){++c,l&&l(u,t,r,i,a,e,n),c+f===o.length&&s&&s(u)})):++f}),f===o.length&&s&&s(u),u},image:function(t,e,n,r,i,a,o){var l;return t?1<arguments.length?this.image_s(t,e,n,r,i,a,o):(e=this,t instanceof fe&&(t=t.oCanvas),n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,r=t instanceof e.oCanvas.constructor,i=t instanceof p.Canvas.Image().constructor,a=n?(l=t.videoWidth,t.videoHeight):(l=t.width,t.height),$a(e,l,a,6),i||r||n?(e._restorable&&e.iCanvas.getContext("2d",e.ctxOpts).drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d",e.ctxOpts).drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d",e.ctxOpts).putImageData(t,0,0),e.oCanvas.getContext("2d",e.ctxOpts).putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),e.nref=(e.nref+1)%1e3,e):this},image_s:function(t,e,n,r,i,a,o,l,s){var u,c,f;return t?(u=this,t instanceof fe&&(t=t.oCanvas),c="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,f=t instanceof u.oCanvas.constructor,r=r||0,i=i||0,a=a||0,o=o||0,t instanceof p.Canvas.Image().constructor||f||c?(u._restorable&&u.iCanvas.getContext("2d",u.ctxOpts).drawImage(t,r,i,e,n,a,o,u.iCanvas.width,u.iCanvas.height),u.oCanvas.getContext("2d",u.ctxOpts).drawImage(t,r,i,e,n,a,o,u.oCanvas.width,u.oCanvas.height)):(u._restorable&&u.iCanvas.getContext("2d",u.ctxOpts).putImageData(t,a,o,r,i,e,n),u.oCanvas.getContext("2d",u.ctxOpts).putImageData(t,a,o,r,i,e,n)),u._refresh|=3,u.selection&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u):this},setImage:null,toImage:function(n,r){function t(t){var e;"uri"!==r?((e=p.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"("+this.id+")]"}})).load=function(t,e){var n=p.Canvas.Image(),r=new fe;return"onload"in n&&(n.onload=function(){r.image(n),"function"==typeof e&&e(r)}),n.src=t,r},fe[i].setImage=fe[i].image,fe[i].setDimensions=fe[i].dimensions,he=A,Object.prototype,Function.prototype,b=Array.prototype,me=b.slice,pe=b.splice,de=b.push,(b=he.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:he.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,r=[],i=!1,a=0,o=n.length;a<o;++a)r.push(e=n[a].serializeInputs(t)),e&&(i=!0);return i?r:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,r=0,i=n.length;r<i;++r)t[r]&&n[r].unserializeInputs(t[r],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,r=t.length;n<r;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,r,i,a,o=this,l=o.filters;if(o._stable=t._stable,(n=(i=t.filters||[]).length)===(r=l.length)&&o._stable)for(e=0;e<n;++e)l[e].unserializeFilter(i[e]);else{for(e=0;e<r;++e)l[e]&&l[e].dispose(!0),l[e]=null;for(l=[],e=0;e<n;++e){if(!(a=i[e]&&i[e].filter?he.Filter.get(i[e].filter):null))throw new Error('Filter "'+i[e].filter+'" could not be created');l.push((new a).unserializeFilter(i[e]))}o.filters=l}return o},setMetaData:function(t,e){var n,r,i=this.filters;if(t&&t.filters&&(r=t.filters.length)&&i.length)for(n=0;n<r;++n)i[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this._glsl=null,this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this._glsl=null,this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&de.apply(this.filters,arguments),this._glsl=null,this},concat:null,pop:function(){return this._glsl=null,this.filters.pop()},shift:function(){return this._glsl=null,this.filters.shift()},unshift:function(){return arguments.length&&pe.apply(this.filters,de.apply([0,0],arguments)),this._glsl=null,this},insertAt:function(t){var e=me.call(arguments);e.length;return 1<argslen&&(e.shift(),pe.apply(this.filters,[t,0].concat(e)),this._glsl=null),this},removeAt:function(t){return this._glsl=null,this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this._glsl=null,this},reset:function(){return this.filters.length=0,this._glsl=null,this},empty:null,getGLSL:function(){return null},getWASM:function(){return null},isGLSL:function(){if(this._isGLSL)for(var t=this.filters,e=0,n=t.length;e<n;++e)if(t[e]&&t[e].isOn()&&t[e].isGLSL())return!0;return!1},isWASM:function(){if(this._isWASM)for(var t=this.filters,e=0,n=t.length;e<n;++e)if(t[e]&&t[e].isOn()&&t[e].isWASM())return!0;return!1},GLSLCode:function(){for(var t,e,n=this.filters,r=[],i=n.length,a=0;a<i;++a)(t=n[a])&&((e=t.GLSLCode())?e.push?r.push.apply(r,e):r.push(e):t._apply&&r.push({instance:t}));return r},_apply:function(t,e,n,r){var i=this,a=i._runWASM,o=null,l=0,s=null,u=null;if(i.filters.length){r=r||{};for(var c,f=i.filters,h=f.length,o=new Array(h),m=0;m<h;++m)(c=f[m])&&c.canRun()&&(r.container=i,r.index=m,t=a?c._apply_wasm(t,e,n,r):c._apply(t,e,n,r),c.hasMeta)&&(o[l++]=[m,c=c.metaData()],null!=c._IMG_WIDTH)&&(s=e=c._IMG_WIDTH,u=n=c._IMG_HEIGHT)}return 0<l?(o.length>l&&(o.length=l),i.hasMeta=!0,i.meta={filters:o},null!=s&&(i.meta._IMG_WIDTH=s,i.meta._IMG_HEIGHT=u)):(i.hasMeta=!1,i.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,r=0;r<n;++r)e.push("\t"+t[r].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=b.prototype.filter,b.prototype.empty=b.prototype.reset,b.prototype.concat=b.prototype.push,he.CompositionFilter=he.CompositeFilter,C=A,ge=C.Util.Array.copy,_e=C.Util.GLSL,xe=Math,ve=xe.min,ye=xe.round,be=C._notSupportClamp,Ce=C.Color.clampPixel,C.Create({name:"BlendFilter",init:function(t){this.set(t)},path:C.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this._glsl=null,this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),null!=e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this._glsl=null,this},getGLSL:function(){var t=this;if(!t.matrix||!t.matrix.length)return new _e.Filter(t).begin().shader(_e.DEFAULT).end().code();var e,n,r=t.matrix,i="",a="";for(n=1,e=0;e<r.length;e+=4,++n)i+=(i.length?"\n":"")+"uniform sampler2D input"+n+";\nuniform vec2 inputSize"+n+";\nuniform int inputMode"+n+";\nuniform vec2 inputStart"+n+";\nuniform int inputEnabled"+n+";",a+=(a.length?"\n":"")+"col = doblend(col, pix, input"+n+", inputSize"+n+", inputStart"+n+", inputMode"+n+", inputEnabled"+n+");";return new _e.Filter(t).begin().shader([we.map(function(t,e){return"LINEARDODGE"===t?"#define LINEARDODGE "+e+"\n#define ADD "+e:"LINEARBURN"===t?"#define LINEARBURN "+e+"\n#define SUBTRACT "+e:"#define "+t+" "+e}).join("\n"),Object.keys(Se).map(function(t){return Se[t]}).join("\n"),"float blend(int mode, float Dca, float Da, float Sca, float Sa) {","    if (MULTIPLY == mode) return multiply(Dca, Da, Sca, Sa);","    else if (SCREEN == mode) return screen(Dca, Da, Sca, Sa);","    else if (OVERLAY == mode) return overlay(Dca, Da, Sca, Sa);","    else if (DARKEN == mode) return darken(Dca, Da, Sca, Sa);","    else if (LIGHTEN == mode) return lighten(Dca, Da, Sca, Sa);","    else if (COLORDODGE == mode) return colordodge(Dca, Da, Sca, Sa);","    else if (COLORBURN == mode) return colorburn(Dca, Da, Sca, Sa);","    else if (HARDLIGHT == mode) return hardlight(Dca, Da, Sca, Sa);","    else if (SOFTLIGHT == mode) return softlight(Dca, Da, Sca, Sa);","    else if (DIFFERENCE == mode) return difference(Dca, Da, Sca, Sa);","    else if (EXCLUSION == mode) return exclusion(Dca, Da, Sca, Sa);","    else if (AVERAGE == mode) return average(Dca, Da, Sca, Sa);","    else if (LINEARDODGE == mode) return lineardodge(Dca, Da, Sca, Sa);","    else if (LINEARBURN == mode) return linearburn(Dca, Da, Sca, Sa);","    else if (NEGATION == mode) return negation(Dca, Da, Sca, Sa);","    else if (LINEARLIGHT == mode) return linearlight(Dca, Da, Sca, Sa);","    return normal(Dca, Da, Sca, Sa);","}","vec4 doblend(vec4 B, vec2 pix, sampler2D Atex, vec2 size, vec2 start, int mode, int enabled) {","    if (0 == enabled || pix.x < start.x || pix.y < start.y || pix.x > start.x+size.x || pix.y > start.y+size.y) return B;","    vec4 A = texture2D(Atex, (pix-start)/size);","    float a = 1.0;","    if (NORMAL != mode) a = clamp(A.a + B.a - A.a*B.a, 0.0, 1.0);","    else a = clamp(A.a + B.a*(1.0 - A.a), 0.0, 1.0);","    if (0.0 < a) return vec4(","        clamp(blend(mode, B.r*B.a, B.a, A.r*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.g*B.a, B.a, A.g*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.b*B.a, B.a, A.b*A.a, A.a)/a, 0.0, 1.0),","        a","    );","    return vec4(0.0);","}","varying vec2 pix;","uniform sampler2D img;",i,"void main(void) {","vec4 col = texture2D(img, pix);",a,"gl_FragColor = col;","}"].join("\n")).input("*",function(t,e,n,r,i,a,o,l){for(var s,u,c=t.matrix,f=1,h=0;h<c.length;h+=4,++f)u=(c[h]||"normal").toUpperCase().replace("-",""),Ae[u]&&(u=Ae[u]),s=t.input(f),_e.uploadTexture(o,s[0],s[1],s[2],f),o.uniform1i(l.uniform["input"+f].loc,f),o.uniform2f(l.uniform["inputSize"+f].loc,s[1]/e,s[2]/n),o.uniform1i(l.uniform["inputMode"+f].loc,we.indexOf(u)),o.uniform2f(l.uniform["inputStart"+f].loc,c[h+1]/e,c[h+2]/n),o.uniform1i(l.uniform["inputEnabled"+f].loc,c[h+3]?1:0)}).end().code()},_apply:function(t,e,n){var r=this.matrix;if(!r||!r.length)return t;for(var i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L,D,E,T,M,G,N=r.length,F=(t.length,ge(t)),O=0,H=1;O<N;O+=4,++H)if(r[O+3]&&(A=r[O]||"normal",w=U[A])&&(p=this.input(H))&&(h=p[0],m=p[1],p=p[2],(o=r[O+1]||0)<(u=s=0)&&(s=-o,o=0),(l=r[O+2]||0)<0&&(u=-l,l=0),!(e<=o||n<=l||m<=s||p<=u||(o=ye(o),l=ye(l),s=ye(s),u=ye(u),c=ve(e-o,m-s),f=ve(n-l,p-u),c<=0)||f<=0)))if(y=l*e,C=u*m,d=(v=o)+c,g=(b=s)+c,be)for(_=0,x=f*c;_<x;++_)S=F[i=v+y<<2],R=F[i+1],I=F[i+2],L=F[i+3]/255,D=h[a=b+C<<2],E=h[a+1],T=h[a+2],M=h[a+3]/255,0<(G="normal"!==A?M+L-M*L:M+L*(1-M))?(F[i]=Ce(ye(255*w(L*S/255,L,M*D/255,M)/G)),F[i+1]=Ce(ye(255*w(L*R/255,L,M*E/255,M)/G)),F[i+2]=Ce(ye(255*w(L*I/255,L,M*T/255,M)/G)),F[i+3]=Ce(ye(255*G))):(F[i]=0,F[i+1]=0,F[i+2]=0,F[i+3]=0),++v>=d&&(v=o,y+=e),++b>=g&&(b=s,C+=m);else for(_=0,x=f*c;_<x;++_)S=F[i=v+y<<2],R=F[i+1],I=F[i+2],L=F[i+3]/255,D=h[a=b+C<<2],E=h[a+1],T=h[a+2],M=h[a+3]/255,0<(G="normal"!==A?M+L-M*L:M+L*(1-M))?(F[i]=ye(255*w(L*S/255,L,M*D/255,M)/G),F[i+1]=ye(255*w(L*R/255,L,M*E/255,M)/G),F[i+2]=ye(255*w(L*I/255,L,M*T/255,M)/G),F[i+3]=ye(255*G)):(F[i]=0,F[i+1]=0,F[i+2]=0,F[i+3]=0),++v>=d&&(v=o,y+=e),++b>=g&&(b=s,C+=m);return F}}),C.CombineFilter=C.BlendFilter,(U=C.Color.Blend={normal:function(t,e,n,r){return n+t*(1-r)},multiply:function(t,e,n,r){return n*t+n*(1-e)+t*(1-r)},screen:function(t,e,n,r){return n+t-n*t},overlay:function(t,e,n,r){return 2*t<=e?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-2*t*n-e*r},darken:function(t,e,n,r){return xe.min(n*e,t*r)+n*(1-e)+t*(1-r)},lighten:function(t,e,n,r){return xe.max(n*e,t*r)+n*(1-e)+t*(1-r)},"color-dodge":function(t,e,n,r){return n===r&&0===t?n*(1-e):n===r?r*e+n*(1-e)+t*(1-r):r*e*xe.min(1,t/e*r/(r-n))+n*(1-e)+t*(1-r)},"color-burn":function(t,e,n,r){return 0===n&&t===e?r*e+t*(1-r):0===n?t*(1-r):r*e*(1-xe.min(1,(1-(e?t/e:0))*r/n))+n*(1-e)+t*(1-r)},"hard-light":function(t,e,n,r){return 2*n<=r?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-r*e-2*n*t},"soft-light":function(t,e,n,r){var i=e?t/e:0;return 2*n<=r?t*(r+(2*n-r)*(1-i))+n*(1-e)+t*(1-r):r<2*n&&4*t<=e?e*(2*n-r)*(16*xe.pow(i,3)-12*xe.pow(i,2)-3*i)+n-n*e+t:e*(2*n-r)*(xe.pow(i,.5)-i)+n-n*e+t},difference:function(t,e,n,r){return n+t-2*xe.min(n*e,t*r)},exclusion:function(t,e,n,r){return n*e+t*r-2*n*t+n*(1-e)+t*(1-r)},average:function(t,e,n,r){return(n+t)/2},add:function(t,e,n,r){return xe.min(1,n+t)},subtract:function(t,e,n,r){return xe.max(0,t+n-1)},negation:function(t,e,n,r){return 1-xe.abs(1-n-t)},"linear-light":function(t,e,n,r){return n<.5?U.subtract(t,e,2*n,r):U.add(t,e,2*(1-n),r)}}).lineardodge=U["linear-dodge"]=U.add,U.linearburn=U["linear-burn"]=U.subtract,U.linearlight=U["linear-light"],U.hardlight=U["hard-light"],U.softlight=U["soft-light"],U.colordodge=U["color-dodge"],U.colorburn=U["color-burn"],we=["NORMAL","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLORDODGE","COLORBURN","HARDLIGHT","SOFTLIGHT","DIFFERENCE","EXCLUSION","AVERAGE","LINEARDODGE","LINEARBURN","NEGATION","LINEARLIGHT"],Ae={ADD:"LINEARDODGE",SUBTRACT:"LINEARBURN"},C.BlendFilter.modes=we,C.BlendFilter.modes.same=Ae,Se={normal:"float normal(float Dca, float Da, float Sca, float Sa){return Sca + Dca * (1.0 - Sa);}",multiply:"float multiply(float Dca, float Da, float Sca, float Sa){return Sca*Dca + Sca*(1.0 - Da) + Dca*(1.0 - Sa);}",screen:"float screen(float Dca, float Da, float Sca, float Sa){return Sca + Dca - Sca * Dca;}",overlay:"float overlay(float Dca, float Da, float Sca, float Sa){if (2.0*Dca <= Da) return (2.0*Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - 2.0 * Dca * Sca - Da * Sa);}",darken:"float darken(float Dca, float Da, float Sca, float Sa){return min(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",lighten:"float lighten(float Dca, float Da, float Sca, float Sa){return max(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}","color-dodge":"float colordodge(float Dca, float Da, float Sca, float Sa){if (Sca == Sa && 0.0 == Dca) return (Sca * (1.0 - Da)); else if (Sca == Sa) return (Sa * Da + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sa * Da * min(1.0, Dca/Da * Sa/(Sa - Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","color-burn":"float colorburn(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (0.0 == Sca && Dca == Da) return (Sa * Da + Dca * (1.0 - Sa)); else if (0.0 == Sca) return (Dca * (1.0 - Sa)); else return (Sa * Da * (1.0 - min(1.0, (1.0 - m) * Sa/Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","hard-light":"float hardlight(float Dca, float Da, float Sca, float Sa){if (2.0 * Sca <= Sa) return (2.0 * Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - Sa * Da - 2.0 * Sca * Dca);}","soft-light":"float softlight(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (2.0 * Sca <= Sa) return (Dca * (Sa + (2.0 * Sca - Sa) * (1.0 - m)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else if (2.0 * Sca > Sa && 4.0 * Dca <= Da) return (Da * (2.0 * Sca - Sa) * (16.0 * pow(m, 3.0) - 12.0 * pow(m, 2.0) - 3.0 * m) + Sca - Sca * Da + Dca); else return (Da * (2.0 * Sca - Sa) * (pow(m, 0.5) - m) + Sca - Sca * Da + Dca);}",difference:"float difference(float Dca, float Da, float Sca, float Sa){return Sca + Dca - 2.0 * min(Sca * Da, Dca * Sa);}",exclusion:"float exclusion(float Dca, float Da, float Sca, float Sa){return (Sca * Da + Dca * Sa - 2.0 * Sca * Dca) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",average:"float average(float Dca, float Da, float Sca, float Sa){return (Sca + Dca) / 2.0;}",add:"float lineardodge(float Dca, float Da, float Sca, float Sa){return min(1.0, Sca + Dca);}",subtract:"float linearburn(float Dca, float Da, float Sca, float Sa){return max(0.0, Dca + Sca - 1.0);}",negation:"float negation(float Dca, float Da, float Sca, float Sa){return 1.0 - abs(1.0 - Sca - Dca);}","linear-light":"float linearlight(float Dca, float Da, float Sca, float Sa){if (Sca < 0.5) return linearburn(Dca, Da, 2.0*Sca, Sa); else return lineardodge(Dca, Da, 2.0*(1.0 - Sca), Sa);}"},Re=A,_=Math,Ie=Re.Util.Image,Le=Re.Util.GLSL,Re.Create({name:"DimensionFilter",init:function(t,e,n,r,i){this.set(t,e,n,r,i)},path:Re.Path,m:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!0,dispose:function(){return this.m=null,this.$super("dispose"),this},serialize:function(){var t=this;return{m:t.m,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.m,t.a,t.b,t.c,t.d),this},metaData:function(t){return t?JSON.stringify(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e?JSON.parse(t):t,this},set:function(t,e,n,r,i){var a=this;return t?(a.m=String(t||"scale").toLowerCase(),a.a=e||0,a.b=n||0,a.c=r||0,a.d=i||0):(a.m=null,a.a=0,a.b=0,a.c=0,a.d=0),a._glsl=null,a},reset:function(){return this.set(null)},getGLSL:function(){return r=this,t=Ie.glsl(),new Le.Filter(r).begin().shader(r.m?["varying vec2 pix;","uniform sampler2D img;","uniform vec2 wh;","uniform vec2 nwh;","uniform int m;","uniform float a;","uniform float b;","uniform float c;","uniform float d;","vec4 set(vec2 pix, sampler2D img) {","   return vec4(0.0);","}",t.crop,t.pad,t.interpolate,"void main(void) {","    if (1 == m) gl_FragColor = set(pix, img);","    else if (2 == m) gl_FragColor = pad(pix, img, wh, nwh, c, d, a, b);","    else if (3 == m) gl_FragColor = crop(pix, img, wh, nwh, a, b, a+c-1.0, b+d-1.0);","    else gl_FragColor = interpolate(pix, img, wh, nwh);","}"].join("\n"):Le.DEFAULT).dimensions(function(t,e,n){return n.params=function(t,e,n){var r,i,a,o=t.a,l=t.b,s=t.c,u=t.d;switch(t.m){case"set":r=1,s&&u&&(o=s*e,l=u*n),i=o,a=l;break;case"pad":r=2,i=e+o+s,a=n+l+u;break;case"crop":r=3,i=s,a=u;break;default:r=4,s&&u&&(o=s*e,l=u*n),i=o,a=l}return{m:r,a:t.a,b:t.b,c:t.c,d:t.d,w:e,h:n,nw:_.round(i),nh:_.round(a)}}(r,t,e),[n.params.nw,n.params.nh]}).input("wh",function(t,e,n,r,i){return[r,i]}).input("nwh",function(t,e,n,r,i){return[e,n]}).input("m",function(t,e,n,r,i,a){return a.params.m}).input("a",function(t,e,n,r,i,a){return a.params.a}).input("b",function(t,e,n,r,i,a){return a.params.b}).input("c",function(t,e,n,r,i,a){return a.params.c}).input("d",function(t,e,n,r,i,a){return a.params.d}).end().code();var r,t},getWASM:function(){return null},_apply:function(t,e,n,r){var i=this,a=i._runWASM,o=i.m,l=i.a,s=i.b,u=i.c,c=i.d;if(o)switch(i.hasMeta=!0,o){case"set":s=u&&c?(l=_.round(u*e),_.round(c*n)):(l=_.round(l),_.round(s)),t=new Re.ImArray(l*s<<2),i.meta={_IMG_WIDTH:l,_IMG_HEIGHT:s};break;case"pad":l=_.round(l),s=_.round(s),u=_.round(u),c=_.round(c),t=Ie.pad(t,e,n,u,c,l,s),i.meta={_IMG_WIDTH:l+u+e,_IMG_HEIGHT:s+c+n};break;case"crop":l=_.round(l),s=_.round(s),u=_.round(u),c=_.round(c),t=Ie.crop(t,e,n,l,s,l+u-1,s+c-1),i.meta={_IMG_WIDTH:u,_IMG_HEIGHT:c};break;default:s=u&&c?(l=_.round(u*e),_.round(c*n)):(l=_.round(l),_.round(s)),t=(a&&Ie.wasm||Ie).interpolate(t,e,n,l,s),i.meta={_IMG_WIDTH:l,_IMG_HEIGHT:s}}else i.meta=null,i.hasMeta=!1;return t}}),x=(De=A).CHANNEL,Ee=De.ColorTable,Te=De.Color.clampPixel,(Me=Math).floor,Ge=Me.pow,Fe=Me.exp,Oe=1/255,Ne=De.Util.Array.typed,u=De.Util.Filter.ct_eye,He=De.Util.Filter.ct_multiply,Ue=De.Util.GLSL,(w=De.Create({name:"ColorTableFilter",init:function(t,e,n,r){var i=this;i.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,i.table[x.R]=t,i.table[x.G]=e,i.table[x.B]=n,i.table[x.A]=r},path:De.Path,table:null,img:null,dispose:function(){return this.table=null,this.img=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[x.R],tableG:this.table[x.G],tableB:this.table[x.B],tableA:this.table[x.A]}},unserialize:function(t){var e=this;return e.table[x.R]=Ne(t.tableR,Ee),e.table[x.G]=Ne(t.tableG,Ee),e.table[x.B]=Ne(t.tableB,Ee),e.table[x.A]=Ne(t.tableA,Ee),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=u(t),e=e?u(e):t,n=n?u(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,r;switch(t||x.R){case x.B:e=u(0,0),n=u(0,0),r=u();break;case x.G:e=u(0,0),n=u(),r=u(0,0);break;default:x.R;e=u(),n=u(0,0),r=u(0,0)}return this.set(e,n,r)},redChannel:function(){return this.channel(x.R)},greenChannel:function(){return this.channel(x.G)},blueChannel:function(){return this.channel(x.B)},channelInvert:function(t){if(null==t)return this;var e,n,r;switch(t||x.R){case x.B:e=u(),n=u(),r=u(-1,255);break;case x.G:e=u(),n=u(-1,255),r=u();break;default:x.R;e=u(-1,255),n=u(),r=u()}return this.set(e,n,r)},redInvert:function(){return this.channelInvert(x.R)},greenInvert:function(){return this.channelInvert(x.G)},blueInvert:function(){return this.channelInvert(x.B)},invert:function(){return this.set(De.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var r,i=(t=t.length?t:[t]).length,a=i+1,o=(e=e||t).length,l=o+1,s=(n=n||e).length,u=s+1,c=new Ee(256),f=new Ee(a),h=new Ee(256),m=new Ee(l),p=new Ee(256),d=new Ee(u),g=255/(a-1),_=255/(l-1),x=255/(u-1),v=0;v<a;++v)f[v]=g*v|0;for(t[0]=255*t[0]|0,v=1;v<i;++v)t[v]=t[v-1]+255*t[v]|0;for(v=0;v<l;++v)m[v]=_*v|0;for(e[0]=255*e[0]|0,v=1;v<o;++v)e[v]=e[v-1]+255*e[v]|0;for(v=0;v<u;++v)d[v]=x*v|0;for(n[0]=255*n[0]|0,v=1;v<s;++v)n[v]=n[v-1]+255*n[v]|0;for(v=0;v<256;++v){for(r=0;r<i&&v>t[r];)++r;for(c[v]=Te(f[r]),r=0;r<o&&v>e[r];)++r;for(h[v]=Te(m[r]),r=0;r<s&&v>n[r];)++r;p[v]=Te(d[r])}return this.set(c,h,p)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){Me.ceil(255/((t=256<(t=(t=null==t?64:t)<2?2:t)?256:t)-1));for(var e=new Ee(t),n=255/(t-1),r=t/256,i=0;i<t;++i)e[i]=Te(n*i|0);return this.set(u(function(t){return e[r*t|0]}))},quantizeAlt:function(t){var e=Me.ceil(255/((t=256<(t=(t=null==t?64:t)<2?2:t)?256:t)-1));return this.set(u(function(t){return Te(Me.round(t/e)*e)}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(u(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,r=255&t;return this.set(u(function(t){return t&e}),u(function(t){return t&n}),u(function(t){return t&r}))},replace:function(t,e){var n,r,i;return t==e?this:(n=u(),r=u(),i=u(),n[t>>>16&255]=e>>>16&255,r[t>>>8&255]=e>>>8&255,i[255&t]=255&e,this.set(n,r,i))},extract:function(t,e,n){if(!e||!e.length)return this;var r=u(0,(n=n||0)>>>16&255),i=u(0,n>>>8&255),a=u(0,255&n);switch(t||x.R){case x.B:for(s=e[0],f=e[1];s<=f;++s)a[s]=Te(s);break;case x.G:for(s=e[0],f=e[1];s<=f;++s)i[s]=Te(s);break;default:x.R;for(s=e[0],f=e[1];s<=f;++s)r[s]=Te(s)}return this.set(r,i,a)},gammaCorrection:function(e,n,r){return e=e||1,n=n||e,r=r||n,e=1/e,n=1/n,r=1/r,this.set(u(function(t){return 255*Ge(Oe*t,e)}),u(function(t){return 255*Ge(Oe*t,n)}),u(function(t){return 255*Ge(Oe*t,r)}))},exposure:function(e){return null==e&&(e=1),this.set(u(function(t){return 255*(1-Fe(-e*t*Oe))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(u(t+=1,128*(1-t)),u(e,128*(1-e)),u(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(u(1,t),u(1,e),u(1,n))},quickContrastCorrection:function(t){return this.set(u(null==t?1.2:+t))},set:function(t,e,n,r){var i,a,o,l,s=this;return t&&(a=(i=s.table)[x.R]||u(),e||n?(e=e||t,n=n||e,o=i[x.G]||a,l=i[x.B]||o,i[x.R]=He(t,a),i[x.G]=He(e,o),i[x.B]=He(n,l)):(i[x.R]=He(t,a),i[x.G]=i[x.R],i[x.B]=i[x.R]),s.img=null,s._glsl=null),s},reset:function(){return this.table=[null,null,null,null],this.img=null,this._glsl=null,this},getGLSL:function(){return t=this,new Ue.Filter(t).begin().shader(t.table&&t.table[x.R]?["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform int hasAlpha;","void main(void) {","   vec4 col = texture2D(img, pix);","   if (1 == hasAlpha) gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,texture2D(map, vec2(col.a, 0.0)).a);","   else gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,col.a);","}"].join("\n"):Ue.DEFAULT).input("hasAlpha",function(t){return t.table[x.A]?1:0}).input("map",function(t){return{data:t.getImage(),width:256,height:1}}).end().code();var t},combineWith:function(t){return this.set(t.getTable(x.R),t.getTable(x.G),t.getTable(x.B))},getTable:function(t){return this.table[t||x.R]||null},setTable:function(t,e){return this.table[e||x.R]=t||null,this.img=null,this},getImage:function(){var t=this.table;if(t&&t[x.R]&&!this.img){for(var e=t[x.R],n=t[x.G]||e,r=t[x.B]||n,i=t[x.A],a=new De.Array8U(1024),o=0,l=0;o<1024;o+=4,++l)a[o]=e[l],a[o+1]=n[l],a[o+2]=r[l],a[o+3]=i?i[l]:255;this.img=a}return this.img},_apply:function(t,e,n){var r=this.table;if(r&&r[x.R]){var i,a,o=t.length,l=(15&o>>>2)<<2,s=r[x.R],u=r[x.G]||s,c=r[x.B]||u,f=r[x.A];if(f){for(i=0;i<l;i+=4)t[i]=s[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]],t[i+3]=f[t[i+3]];for(a=l;a<o;a+=64)t[i=a]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]]}else{for(i=0;i<l;i+=4)t[i]=s[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]];for(a=l;a<o;a+=64)t[i=a]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],++i}}return t},canRun:function(){return this._isOn&&this.table&&this.table[x.R]}})).prototype.posterize=w.prototype.levels=w.prototype.quantize,De.TableLookupFilter=De.ColorTableFilter,l=(o=A).CHANNEL,Be=o.ColorMatrix,Ye=o.Array8U,t=Math,ze=t.sin,ke=t.cos,Pe=o.CONST.toRad,o.CONST.toDeg,je=o.Util.Array.typed,t=o._notSupportClamp,v=o.Util.Filter.cm_rechannel,Xe=o.Util.Filter.cm_combine,We=o.Util.Filter.cm_multiply,$e=o.Util.GLSL,(t=o.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new Be(t):null},path:o.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=je(t.matrix,Be),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=l.A===(t=t||0)||e?1:0;return n[5*l.R+t]=l.R===t?1:e,n[5*l.G+t]=l.G===t?1:e,n[5*l.B+t]=l.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(l.R,t)},greenChannel:function(t){return this.channel(l.G,t)},blueChannel:function(t){return this.channel(l.B,t)},alphaChannel:function(t){return this.channel(l.A,!0)},maskChannel:function(t){var e;return l.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return l.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(l.R)},invertGreen:function(){return this.invertChannel(l.G)},invertBlue:function(){return this.invertChannel(l.B)},invertAlpha:function(){return this.invertChannel(l.A)},invert:function(){return this.set(v([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},desaturate:function(t){t=t||o.LUMA;return this.set(v([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},grayscale:null,saturate:function(t,e){var e=e||o.LUMA,n=1-t,r=n*e[0],i=n*e[1],n=n*e[2];return this.set(v([r+t,i,n,0,0,r,i+t,n,0,0,r,i,n+t,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},colorize:function(t,e,n){var r,i,n=n||o.LUMA;return this.set(v([(i=1-(e=null==e?1:e))+e*(r=(t>>16&255)/255)*n[0],e*r*n[1],e*r*n[2],0,0,e*(r=(t>>8&255)/255)*n[0],i+e*r*n[1],e*r*n[2],0,0,e*(r=(255&t)/255)*n[0],e*r*n[1],i+e*r*n[2],0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(v([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},brightness:function(t,e,n){return this.set(v([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},adjustHue:function(t,e){var n=ke(t*=Pe),t=ze(t),e=e||o.LUMA;return this.set(v([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},rotateHue:null,average:function(t,e,n){return this.set(v([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},quickContrastCorrection:function(t){return this.set(v([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set(v([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||o.LUMA;return this.set(v([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},threshold:function(t,e,n){null==e&&(e=256);var r=n||o.LUMA;return this.set(v(!1!==n?[r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],l.R,l.G,l.B,l.A,l.R,l.G,l.B,l.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,r){null==n&&(n=256);var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=r||o.LUMA;return l.A===t?(i[5*t+t]=n,i[5*t+4]=-n*e):(!1!==r?(i[5*t+l.R]=a[0]*n,i[5*t+l.G]=a[1]*n,i[5*t+l.B]=a[2]*n):(i[5*t+l.R]=n,i[5*t+l.G]=n,i[5*t+l.B]=n),i[5*t+4]=-(n-1)*e),this.set(i)},thresholdRed:function(t,e,n){return this.thresholdChannel(l.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(l.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(l.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(l.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set(v([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.XX,l.YY,l.ZZ,l.A))},XYZ2RGB:function(){return this.set(v([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],l.XX,l.YY,l.ZZ,l.A,l.R,l.G,l.B,l.A))},RGB2YCbCr:function(){return this.set(v([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],l.R,l.G,l.B,l.A,l.Y,l.CB,l.CR,l.A))},YCbCr2RGB:function(){return this.set(v([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],l.Y,l.CB,l.CR,l.A,l.R,l.G,l.B,l.A))},RGB2YIQ:function(){return this.set(v([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],l.R,l.G,l.B,l.A,l.Y,l.IP,l.Q,l.A))},YIQ2RGB:function(){return this.set(v([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],l.Y,l.IP,l.Q,l.A,l.R,l.G,l.B,l.A))},blend:function(t,e){return this.matrix=this.matrix?Xe(this.matrix,t.matrix,1-e,e,Be):new Be(t.matrix),this},set:function(t){var e=this;return e.matrix=e.matrix?We(e.matrix,t):new Be(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){return t=this,new $e.Filter(t).begin().shader(t.matrix?["varying vec2 pix;","uniform sampler2D img;","uniform float cm[20];","void main(void) {","   vec4 col = texture2D(img, pix);","   gl_FragColor.r = clamp(cm[0 ]*col.r+cm[1 ]*col.g+cm[2 ]*col.b+cm[3 ]*col.a+cm[4 ],0.0,1.0);","   gl_FragColor.g = clamp(cm[5 ]*col.r+cm[6 ]*col.g+cm[7 ]*col.b+cm[8 ]*col.a+cm[9 ],0.0,1.0);","   gl_FragColor.b = clamp(cm[10]*col.r+cm[11]*col.g+cm[12]*col.b+cm[13]*col.a+cm[14],0.0,1.0);","   gl_FragColor.a = clamp(cm[15]*col.r+cm[16]*col.g+cm[17]*col.b+cm[18]*col.a+cm[19],0.0,1.0);","}"].join("\n"):$e.DEFAULT).input("cm",function(t){t=t.matrix;return[t[0],t[1],t[2],t[3],t[4]/255,t[5],t[6],t[7],t[8],t[9]/255,t[10],t[11],t[12],t[13],t[14]/255,t[15],t[16],t[17],t[18],t[19]/255]}).end().code();var t},combineWith:function(t){return this.set(t.matrix)},_apply:t?function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new Be(32),l=new Ye(4),s=new Be(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],s[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],s[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],s[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],s[0]=s[0]<0?0:255<s[0]?255:s[0],s[1]=s[1]<0?0:255<s[1]?255:s[1],s[2]=s[2]<0?0:255<s[2]?255:s[2],s[3]=s[3]<0?0:255<s[3]?255:s[3],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<i;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[5]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[6]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[7]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[9]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[10]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[11]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[13]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[14]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[15]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[17]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[18]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[19]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[21]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[22]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[23]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[25]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[26]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[27]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[29]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[30]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[31]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],o[0]=o[0]<0?0:255<o[0]?255:o[0],o[1]=o[1]<0?0:255<o[1]?255:o[1],o[2]=o[2]<0?0:255<o[2]?255:o[2],o[3]=o[3]<0?0:255<o[3]?255:o[3],o[4]=o[4]<0?0:255<o[4]?255:o[4],o[5]=o[5]<0?0:255<o[5]?255:o[5],o[6]=o[6]<0?0:255<o[6]?255:o[6],o[7]=o[7]<0?0:255<o[7]?255:o[7],o[8]=o[8]<0?0:255<o[8]?255:o[8],o[9]=o[9]<0?0:255<o[9]?255:o[9],o[10]=o[10]<0?0:255<o[10]?255:o[10],o[11]=o[11]<0?0:255<o[11]?255:o[11],o[12]=o[12]<0?0:255<o[12]?255:o[12],o[13]=o[13]<0?0:255<o[13]?255:o[13],o[14]=o[14]<0?0:255<o[14]?255:o[14],o[15]=o[15]<0?0:255<o[15]?255:o[15],o[16]=o[16]<0?0:255<o[16]?255:o[16],o[17]=o[17]<0?0:255<o[17]?255:o[17],o[18]=o[18]<0?0:255<o[18]?255:o[18],o[19]=o[19]<0?0:255<o[19]?255:o[19],o[20]=o[20]<0?0:255<o[20]?255:o[20],o[21]=o[21]<0?0:255<o[21]?255:o[21],o[22]=o[22]<0?0:255<o[22]?255:o[22],o[23]=o[23]<0?0:255<o[23]?255:o[23],o[24]=o[24]<0?0:255<o[24]?255:o[24],o[25]=o[25]<0?0:255<o[25]?255:o[25],o[26]=o[26]<0?0:255<o[26]?255:o[26],o[27]=o[27]<0?0:255<o[27]?255:o[27],o[28]=o[28]<0?0:255<o[28]?255:o[28],o[29]=o[29]<0?0:255<o[29]?255:o[29],o[30]=o[30]<0?0:255<o[30]?255:o[30],o[31]=o[31]<0?0:255<o[31]?255:o[31],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t}:function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new Be(32),l=new Ye(4),s=new Be(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],s[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],s[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],s[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<i;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[5]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[6]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[7]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[9]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[10]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[11]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[13]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[14]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[15]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[17]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[18]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[19]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[21]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[22]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[23]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[25]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[26]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[27]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[29]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[30]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[31]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=t.prototype.desaturate,t.prototype.rotateHue=t.prototype.adjustHue,t.prototype.threshold_rgb=t.prototype.thresholdRGB,t.prototype.threshold_alpha=t.prototype.thresholdAlpha,qe=A,Ke=qe.MODE,Ze=qe.Util.GLSL,Je=qe.Color,qe.ColorMatrix,Qe=qe.Util.Array.typed,tn=qe._notSupportClamp,en=qe.Util.String.function_body,nn=Object.prototype.hasOwnProperty,(e=qe.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:qe.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:Ke.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=Qe(t.thresholds,Array),e.quantizedColors=Qe(t.quantizedColors,Array),!t._map&&t._mapName&&nn.call(Ve,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&nn.call(Ve,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Ve[n._mapName],n._mapInit=Ve["init__"+n._mapName],n._apply=Ka(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=Ka(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t._glsl=null,t},getGLSL:function(){var n,t,r,e,i=this;return(i._map?"quantize"===i._mapName?(n=Ze.formatFloat,t=i.thresholds||[],r=i.quantizedColors||[],e=new Ze.Filter(i).begin().shader(["varying vec2 pix;","uniform sampler2D img;","#define HUE "+Ke.HUE,"#define SATURATION "+Ke.SATURATION,"#define INTENSITY "+Ke.INTENSITY,"#define COLOR "+Ke.COLOR,"uniform int mode;",Je.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","void main(void) {","vec4 i = texture2D(img, pix);","vec4 o = vec4(i.r, i.g, i.b, i.a);","float v;","int found = 0;","if (0.0 != i.a) {","if (mode == HUE) v = rgb2hue(i.r, i.g, i.b)/360.0;","else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","else v = col24(i.r, i.g, i.b);",t.map(function(t,e){return"if (0 == found && v <= "+(t=(t=t)||0,Ke.COLOR===i.mode?n(100*(t>>16&255)/255+10*(t>>8&255)/255+(255&t)/255):n(t/255))+") {found = 1; o.rgb = "+(e<r.length?Je.rgb24GL(r[e]):"vec3(1.0,1.0,1.0)")+";}"}).join("\n"),"gl_FragColor = o;","} else {","gl_FragColor = i;","}","}"].join("\n")).end()):(e=new Ze.Filter(i).begin().shader(["varying vec2 pix;","uniform sampler2D img;","#define HUE "+Ke.HUE,"#define SATURATION "+Ke.SATURATION,"#define INTENSITY "+Ke.INTENSITY,"#define COLOR "+Ke.COLOR,"uniform vec4 color;","uniform float minval;","uniform float maxval;","uniform int mapping;","uniform int mode;",Je.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","vec4 mask(vec4 i, float minval, float maxval, vec4 color) {","    float v = 0.0;","    if (0.0 != i.a) {","        if (mode == HUE) v = rgb2hue(i.r, i.g, i.b);","        else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","        else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","        else v = col24(i.r, i.g, i.b);","        if (v < minval || v > maxval) return color;","        else return i;","    } else {","        return i;","    }","}",nn.call(Ve,i._mapName)||!i._map.shader?"vec3 map(vec3 rgb) {return rgb;}":i._map.shader.toString(),"void main(void) {","vec4 c = texture2D(img, pix);","vec4 o = vec4(c.r, c.g, c.b, c.a);","float v;","if (1 == mapping)      {o.xyz = rgb2hsv(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (2 == mapping) {o.rgb = hsv2rgb(c.r, c.g, c.b).rgb;}","else if (3 == mapping) {o.xyz = rgb2hsl(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (4 == mapping) {o.rgb = hsl2rgb(c.r, c.g, c.b).rgb;}","else if (5 == mapping) {o.xyz = rgb2hwb(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (6 == mapping) {o.rgb = hwb2rgb(c.r, c.g, c.b).rgb;}","else if (7 == mapping) {o.xyz = rgb2cmyk(c.r, c.g, c.b).xyz;}","else if (8 == mapping) {v=rgb2hue(c.r, c.g, c.b)/360.0; o=vec4(v,v,v,c.a);}","else if (9 == mapping) {v=rgb2sat(c.r, c.g, c.b, FORMAT_HSV); o=vec4(v,v,v,c.a);}","else if (10 == mapping){o = mask(c, minval, maxval, color);}","else                   {o.rgb = map(c.rgb);}","gl_FragColor = o;","}"].join("\n")).input("mapping",function(t){return"rgb2hsv"===t._mapName?1:"hsv2rgb"===t._mapName?2:"rgb2hsl"===t._mapName?3:"hsl2rgb"===t._mapName?4:"rgb2hwb"===t._mapName?5:"hwb2rgb"===t._mapName?6:"rgb2cmyk"===t._mapName?7:"hue"===t._mapName?8:"saturation"===t._mapName?9:"mask"===t._mapName?10:0}).input("color",function(t){t=(t.quantizedColors||[0])[0]||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("minval",function(t){var e=t.thresholds||[0,0],n=e[0]||0;e[1];return Ke.COLOR===t.mode?100*(n>>16&255)/255+10*(n>>8&255)/255+(255&n)/255:n}).input("maxval",function(t){var e=t.thresholds||[0,0],e=(e[0],e[1]||0);return Ke.COLOR===t.mode?100*(e>>16&255)/255+10*(e>>8&255)/255+(255&e)/255:e}),i._map.shader&&i._map.inputs&&i._map.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e.end()):new Ze.Filter(i).begin().shader(Ze.DEFAULT).end()).code()},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=e.prototype.quantize,e.prototype.extract=e.prototype.mask,Ve={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},rn=A.ImArray,an=A.AffineMatrix,on=A.Util.Array.typed,ln=A.Util.GLSL,sn=A.MODE,A.CONST.toRad,n=Math,un=n.sin,cn=n.cos,fn=n.tan,hn=A.Util.Filter.am_multiply,(n=A.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new an(t):null},path:A.Path,matrix:null,mode:sn.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=on(t.matrix,an),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=un(t),t=cn(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?fn(t):0,0,0,e?fn(e):0,1,0,0])},set:function(t){var e=this;return e.matrix=e.matrix?hn(e.matrix,t):new an(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){var t=this,e=t.matrix;return(t=new ln.Filter(t)).begin().shader(e?["varying vec2 pix;","uniform sampler2D img;","uniform float am[6];","uniform vec4 color;","#define IGNORE "+sn.IGNORE,"#define CLAMP "+sn.CLAMP,"#define COLOR "+sn.COLOR,"#define WRAP "+sn.WRAP,"uniform int mode;","void main(void) {","   vec2 p = vec2(am[0]*pix.x+am[1]*pix.y+am[2], am[3]*pix.x+am[4]*pix.y+am[5]);","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (COLOR == mode) {gl_FragColor = color;}","       else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","       else if (WRAP == mode) {","           if (0.0 > p.x) p.x += 1.0;","           if (1.0 < p.x) p.x -= 1.0;","           if (0.0 > p.y) p.y += 1.0;","           if (1.0 < p.y) p.y -= 1.0;","           gl_FragColor = texture2D(img, p);","       }","       else {gl_FragColor = texture2D(img, pix);}","   } else {","       gl_FragColor = texture2D(img, p);","   }","}"].join("\n"):ln.DEFAULT),e&&t.input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("am",function(t,e,n){t=t.matrix;return[t[0],t[1],t[2]/e+t[3],t[4],t[5],t[6]/n+t[7]]}),t.end().code()},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this.matrix;if(!r)return t;var i,a,o,l,s,u,c,f,h,m,p,d=t.length,g=d>>>2,_=e-1,x=g-e,v=new rn(d),y=this.color||0,b=sn.COLOR,C=(sn.CLAMP,sn.WRAP),w=sn.IGNORE,A=r[0],S=r[1],R=r[2]+r[3]*_,I=r[4]*e,L=r[5],D=r[6]*e+r[7]*x,r=this.mode||w;if(b===r)for(p=y>>>24&255,f=y>>>16&255,h=y>>>8&255,m=255&y,u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),s=I*i+L*o+D,(l=A*i+S*a+R)<0||_<l||s<0||x<s?(v[u]=f,v[u+1]=h,v[u+2]=m,v[u+3]=p):(v[u]=t[c=(0|l)+(0|s)<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3]);else if(w===r)for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(l=_<(l=A*i+S*a+R)||l<0?i:l))+(0|(s=x<(s=I*i+L*o+D)||s<0?o:s))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];else if(C===r)for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(l=_<(l=A*i+S*a+R)?l-e:l<0?l+e:l))+(0|(s=x<(s=I*i+L*o+D)?s-g:s<0?s+g:s))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];else for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),v[u]=t[c=(0|(l=_<(l=A*i+S*a+R)?_:l<0?0:l))+(0|(s=x<(s=I*i+L*o+D)?x:s<0?0:s))<<2],v[u+1]=t[c+1],v[u+2]=t[c+2],v[u+3]=t[c+3];return v},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=n.prototype.translate,pn=(mn=A).MODE,dn=mn.CHANNEL,mn.Util.Array.typed,gn=mn.Util.GLSL,r=Math,_n=r.min,r.max,K=r.floor,mn.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:mn.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:pn.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},getGLSL:function(){return t=this,new gn.Filter(t).begin().shader(t.input("map")?["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform vec2 mapSize;","uniform vec2 start;","uniform vec2 scale;","uniform vec4 color;","uniform ivec2 component;","#define IGNORE "+pn.IGNORE,"#define CLAMP "+pn.CLAMP,"#define COLOR "+pn.COLOR,"#define WRAP "+pn.WRAP,"#define RED "+dn.R,"#define GREEN "+dn.G,"#define BLUE "+dn.B,"#define ALPHA "+dn.A,"uniform int mode;","void main(void) {","   if (pix.x < start.x || pix.x > min(1.0,start.x+mapSize.x) || pix.y < start.y || pix.y > min(1.0,start.y+mapSize.y)) {","      gl_FragColor = texture2D(img, pix);","   } else {","       vec4 mc = texture2D(map, (pix-start)/mapSize);","       vec2 p = vec2(pix.x, pix.y);","       if (ALPHA == component.x) p.x += (mc.a - 0.5)*scale.x;","       else if (BLUE == component.x) p.x += (mc.b - 0.5)*scale.x;","       else if (GREEN == component.x) p.x += (mc.g - 0.5)*scale.x;","       else p.x += (mc.r - 0.5)*scale.x;","       if (ALPHA == component.y) p.y += (mc.a - 0.5)*scale.y;","       else if (BLUE == component.y) p.y += (mc.b - 0.5)*scale.y;","       else if (GREEN == component.y) p.y += (mc.g - 0.5)*scale.y;","       else p.y += (mc.r - 0.5)*scale.y;","       if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","           if (COLOR == mode) {gl_FragColor = color;}","           else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","           else if (WRAP == mode) {","               if (0.0 > p.x) p.x += 1.0;","               if (1.0 < p.x) p.x -= 1.0;","               if (0.0 > p.y) p.y += 1.0;","               if (1.0 < p.y) p.y -= 1.0;","               gl_FragColor = texture2D(img, p);","           }","           else {gl_FragColor = texture2D(img, pix);}","       } else {","           gl_FragColor = texture2D(img, p);","       }","   }","}"].join("\n"):gn.DEFAULT).input("map",function(t){t=t.input("map");return{data:t[0],width:t[1],height:t[2]}}).input("mapSize",function(t,e,n){t=t.input("map");return[t[1]/e,t[2]/n]}).input("scale",function(t){return[1.4*t.scaleX/255,1.4*t.scaleY/255]}).input("start",function(t){return[t.startX,t.startY]}).input("component",function(t){return[t.componentX,t.componentY]}).input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).end().code();var t},_apply:function(t,e,n){var r=this,i=r.input("map");if(i){for(var N,H,U,B,a,o,l,s,u,c,f,h,m,p=r.color||0,d=e-1,g=n-1,_=.00390625*r.scaleX,x=.00390625*r.scaleY,v=r.componentX,y=r.componentY,Y=pn.IGNORE,z=(pn.CLAMP,pn.COLOR),k=pn.WRAP,P=r.mode||Y,j=(mn.ImArray,mn.Util.Array.copy),X=mn.Array16I,b=i[0],C=i[1],i=i[2],W=b.length,$=W>>>2,w=_n(C,e),A=w*_n(i,n)<<2,S=(t.length,K(r.startX*d)),R=K(r.startY*g),I=R*e,L=-S,D=-R,E=d-S,T=g-R,M=new X($<<1),G=j(t),q=(15&$)<<2,F=0,O=0;O<q;O+=4)M[F++]=K((b[O+v]-128)*_),M[F++]=K((b[O+y]-128)*x);for(O=q;O<W;O+=64)M[F++]=K((b[O+v]-128)*_),M[F++]=K((b[O+y]-128)*x),M[F++]=K((b[O+4+v]-128)*_),M[F++]=K((b[O+4+y]-128)*x),M[F++]=K((b[O+8+v]-128)*_),M[F++]=K((b[O+8+y]-128)*x),M[F++]=K((b[O+12+v]-128)*_),M[F++]=K((b[O+12+y]-128)*x),M[F++]=K((b[O+16+v]-128)*_),M[F++]=K((b[O+16+y]-128)*x),M[F++]=K((b[O+20+v]-128)*_),M[F++]=K((b[O+20+y]-128)*x),M[F++]=K((b[O+24+v]-128)*_),M[F++]=K((b[O+24+y]-128)*x),M[F++]=K((b[O+28+v]-128)*_),M[F++]=K((b[O+28+y]-128)*x),M[F++]=K((b[O+32+v]-128)*_),M[F++]=K((b[O+32+y]-128)*x),M[F++]=K((b[O+36+v]-128)*_),M[F++]=K((b[O+36+y]-128)*x),M[F++]=K((b[O+40+v]-128)*_),M[F++]=K((b[O+40+y]-128)*x),M[F++]=K((b[O+44+v]-128)*_),M[F++]=K((b[O+44+y]-128)*x),M[F++]=K((b[O+48+v]-128)*_),M[F++]=K((b[O+48+y]-128)*x),M[F++]=K((b[O+52+v]-128)*_),M[F++]=K((b[O+52+y]-128)*x),M[F++]=K((b[O+56+v]-128)*_),M[F++]=K((b[O+56+y]-128)*x),M[F++]=K((b[O+60+v]-128)*_),M[F++]=K((b[O+60+y]-128)*x);if(z===P)for(N=p>>>24&255,H=p>>>16&255,U=p>>>8&255,B=255&p,O=s=l=o=a=0;O<A;O+=4,++a)w<=a&&(a=0,++o,l+=e,s+=C),o<D||T<o||a<L||E<a||(c=(u=a+S)+l+I<<2,h=u+M[F=a+s<<1],g<(m=o+R+M[F+1])||m<0||d<h||h<0?(t[c]=H,t[c+1]=U,t[c+2]=B,t[c+3]=N):(t[c]=G[f=h+m*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]));else if(Y===P)for(O=s=l=o=a=0;O<A;O+=4,++a)w<=a&&(a=0,++o,l+=e,s+=C),o<D||T<o||a<L||E<a||(c=(u=a+S)+l+I<<2,h=u+M[F=a+s<<1],g<(m=o+R+M[F+1]))||m<0||d<h||h<0||(t[c]=G[f=h+m*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]);else if(k===P)for(O=s=l=o=a=0;O<A;O+=4,++a)w<=a&&(a=0,++o,l+=e,s+=C),o<D||T<o||a<L||E<a||(h=(u=a+S)+M[F=a+s<<1],m=o+R+M[F+1],t[c=u+l+I<<2]=G[f=(h=d<h?h-e:h<0?h+e:h)+(m=g<m?m-n:m<0?m+n:m)*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]);else for(O=s=l=o=a=0;O<A;O+=4,++a)w<=a&&(a=0,++o,l+=e,s+=C),o<D||T<o||a<L||E<a||(h=(u=a+S)+M[F=a+s<<1],m=o+R+M[F+1],t[c=u+l+I<<2]=G[f=(h=d<h?d:h<0?0:h)+(m=g<m?g:m<0?0:m)*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3])}return t}});var Za,Ja,Qa=A,to=Qa.MODE,eo=Qa.Util.String.function_body,S=Math,no=(S.floor,S.round,S.sqrt),ro=(S.atan2,S.sin,S.cos,S.max),io=(S.min,2*S.PI),ao=(Qa.Util.Math.clamp,Qa.POS.X,Qa.POS.Y),oo=Object.prototype.hasOwnProperty,lo=Qa.Util.GLSL;function so(t,e){e=e?eo(e):"",t=eo(t.filter||t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(Qa)}function uo(t,e,n){for(var r=[],i=[],a=[],o=t.length,l=e>>>1,s=-l,u=-((n=null==n?e:n)>>>1),c=0;c<o;)i.push(s),i.push(u),t[c]&&(r.push(s),r.push(u),a.push(t[c])),++c,l<++s&&(s=-l,++u);return[new bn(r),new bn(i),new vn(a)]}function co(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function fo(t,e){var n,r=t>>>1,i=new Array(t);if(e)for(n=0;n<t;++n)i[t-1-n]=n-r;else for(n=0;n<t;++n)i[n]=n-r;return i}function ho(t){var e,n,r,i,a=Hn.length;if(--t<a)e=Hn[t];else for(e=Hn[a-1];a<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,r=0,i=n.length-1;r<i;++r)e[r+1]=n[r]+n[r+1];e[n.length]=1,a<20&&Hn.push(e),++a}return e.slice()}function mo(t,e,n){for(var r=t>>>1,i=e>>>1,a=new Array(t*e),o=-r,l=-i,s=0;s<d;++s,++o)r<o&&(o=-r,++l),a[s]=n(o,l,t,e);return a}function po(t,e){return 1===e?wn(fo(t,1),ho(t)):wn(ho(t),fo(t,0))}function go(t,e){return 1===e?wn(fo(t,1),co(t)):wn(co(t),fo(t,0))}function _o(t,e,n){e=e||1,n=n||e;for(var r=t*t,i=new vn(r),a=0;a<r;++a)i[a]=e;return i[r>>>1]=n,i}function xo(t){for(var e=t*t,n=new jn(e),r=0;r<e;++r)n[r]=1;return n}function vo(t,e,n,r,i,a,o,l,s,u,c){var f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R=e.length,I=r-1,L=(R>>>a)-r,D=e;if(e=n,n=D,Un.MODE.GRAY===t){for(S=o.length,f=0;f<c;++f)for(D=e,e=n,n=D,p=m=h=0;p<R;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<S;d+=2)C=h+o[d],w=m+o[d+1],C<0||I<C||w<0||L<w||(g=s(v=e[A=C+w<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}if(l)for(S=(o=l).length,f=0;f<c;++f)for(D=e,e=n,n=D,p=m=h=0;p<R;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<S;d+=2)C=h+o[d],w=m+o[d+1],C<0||I<C||w<0||L<w||(g=s(v=e[A=C+w<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}}else{for(S=o.length,f=0;f<c;++f)for(D=e,e=n,n=D,p=m=h=0;p<R;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=x=u,d=0;d<S;d+=2)C=h+o[d],w=m+o[d+1],C<0||I<C||w<0||L<w||(v=e[A=C+w<<2],y=e[A+1],b=e[A+2],g=s(v,g),_=s(y,_),x=s(b,x));n[p]=g,n[p+1]=_,n[p+2]=x,n[p+3]=e[p+3]}if(l)for(S=(o=l).length,f=0;f<c;++f)for(D=e,e=n,n=D,p=m=h=0;p<R;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=x=u,d=0;d<S;d+=2)C=h+o[d],w=m+o[d+1],C<0||I<C||w<0||L<w||(v=e[A=C+w<<2],y=e[A+1],b=e[A+2],g=s(v,g),_=s(y,_),x=s(b,x));n[p]=g,n[p+1]=_,n[p+2]=x,n[p+3]=e[p+3]}}return n}function yo(t,e,n){t[e]=n,Co(t,0,e)}function bo(t,e){var n,r=t[e-1];if(e-1){n=t[0],t[0]=r;var i,a,o=t,l=0,s=t=e-1,t=l,e=o[l];for(i=2*l+1;i<s;)(a=i+1)<s&&o[i]>=o[a]&&(i=a),o[l]=o[i],i=2*(l=i)+1;return o[l]=e,Co(o,t,l),n}return r}function Co(t,e,n){for(var r,i,a=t[n];e<n&&a<(i=t[r=n-1>>>1]);)t[n]=i,n=r;t[n]=a}function wo(t,e,n,r){for(var i=[0,0],a=0;a<n;++a)for(var o=0,l=0;o<r;++o,l+=n){var s=a+l,u=e(t.r[s],t.i[s],a,o,n,r,t)||i;t.r[s]=u[0]||0,t.i[s]=u[1]||0}return t}function Ao(t,e,n){var t=7&t,r=t<4?e:n,n=t<4?n:e;return(1&t?-r:r)+(2&t?-2*n:2*n)}function So(t,e){var n=.211324865,r=.366025403*(t+e),i=e+r,r=gr(t+r),i=gr(i),a=(r+i)*n,t=t-(r-a),e=e-(i-a),a=e<t?(c=1,0):(c=0,1),o=t-c+n,l=e-a+n,s=t-1+2*n,n=e-1+2*n,r=255&r,i=255&i,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*Ao(xr[r+xr[i]],t,e),t=.5-o*o-l*l,e=t<0?0:(t*=t)*t*Ao(xr[r+c+xr[i+a]],o,l),t=.5-s*s-n*n,c=t<0?0:(t*=t)*t*Ao(xr[1+r+xr[1+i]],s,n);return 40*(u+e+c)}function Ro(t){return t*t*t*(t*(6*t-15)+10)}function Io(t,e,n){return e+t*(n-e)}function Lo(t,e){var n=gr(t),r=gr(e),t=t-n,e=e-r,i=t-1,a=e-1,o=n+1&255,l=r+1&255,s=Ro(e),u=Ro(t),n=Io(s,Ao(xr[(n&=255)+xr[r&=255]],t,e),Ao(xr[n+xr[l]],t,a)),t=Io(s,Ao(xr[o+xr[r]],i,e),Ao(xr[o+xr[l]],i,a));return.507*Io(u,n,t)}function Do(t,e,n,r,i,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%a)*l,p*((i+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=f=~~(255*(.5*m/g+.5)),t[e+1]=f,t[e+2]=f,t[e+3]=255}function Eo(t,e,n,r,i,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%a)*l,p*((i+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=(f=~~(16777215*(.5*m/g+.5)))>>>16&255,t[e+1]=f>>>8&255,t[e+2]=255&f,t[e+3]=255}function To(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_,x=1/a,v=1/o,y=f?Lo:So,b=i?Do:Eo,C=t.length,w=e>>>1,A=n>>>1;if(u=u||1,c=c||.5,l=l||1,s=s||[[0,0]],r)for(g=m=h=0;g<C;g+=4,++h)e<=h&&(h=0,++m),d=A<m?n-1-m:m,(p=w<h?e-1-h:h)<h||d<m?(t[g]=t[_=d*e+p<<2],t[g+1]=t[1+_],t[g+2]=t[2+_],t[g+3]=255):b(t,g,y,p,d,e,n,x,v,l,s,u,c);else for(g=m=h=0;g<C;g+=4,++h)e<=h&&(h=0,++m),b(t,g,y,h,m,e,n,x,v,l,s,u,c);return t}function Mo(t,e,n,r,i,a){r|=0,i|=0,a|=0;var o=new ii(256);return o[0]=(y(+n)<=a?r:i)<<2|(y(+e)<=a?r:i)<<1|(y(+t)<=a?r:i)<<0,o[1]=(y(n-1)<=a?r:i)<<2|(y(e-1)<=a?r:i)<<1|(y(t-1)<=a?r:i)<<0,o[2]=(y(n-2)<=a?r:i)<<2|(y(e-2)<=a?r:i)<<1|(y(t-2)<=a?r:i)<<0,o[3]=(y(n-3)<=a?r:i)<<2|(y(e-3)<=a?r:i)<<1|(y(t-3)<=a?r:i)<<0,o[4]=(y(n-4)<=a?r:i)<<2|(y(e-4)<=a?r:i)<<1|(y(t-4)<=a?r:i)<<0,o[5]=(y(n-5)<=a?r:i)<<2|(y(e-5)<=a?r:i)<<1|(y(t-5)<=a?r:i)<<0,o[6]=(y(n-6)<=a?r:i)<<2|(y(e-6)<=a?r:i)<<1|(y(t-6)<=a?r:i)<<0,o[7]=(y(n-7)<=a?r:i)<<2|(y(e-7)<=a?r:i)<<1|(y(t-7)<=a?r:i)<<0,o[8]=(y(n-8)<=a?r:i)<<2|(y(e-8)<=a?r:i)<<1|(y(t-8)<=a?r:i)<<0,o[9]=(y(n-9)<=a?r:i)<<2|(y(e-9)<=a?r:i)<<1|(y(t-9)<=a?r:i)<<0,o[10]=(y(n-10)<=a?r:i)<<2|(y(e-10)<=a?r:i)<<1|(y(t-10)<=a?r:i)<<0,o[11]=(y(n-11)<=a?r:i)<<2|(y(e-11)<=a?r:i)<<1|(y(t-11)<=a?r:i)<<0,o[12]=(y(n-12)<=a?r:i)<<2|(y(e-12)<=a?r:i)<<1|(y(t-12)<=a?r:i)<<0,o[13]=(y(n-13)<=a?r:i)<<2|(y(e-13)<=a?r:i)<<1|(y(t-13)<=a?r:i)<<0,o[14]=(y(n-14)<=a?r:i)<<2|(y(e-14)<=a?r:i)<<1|(y(t-14)<=a?r:i)<<0,o[15]=(y(n-15)<=a?r:i)<<2|(y(e-15)<=a?r:i)<<1|(y(t-15)<=a?r:i)<<0,o[16]=(y(n-16)<=a?r:i)<<2|(y(e-16)<=a?r:i)<<1|(y(t-16)<=a?r:i)<<0,o[17]=(y(n-17)<=a?r:i)<<2|(y(e-17)<=a?r:i)<<1|(y(t-17)<=a?r:i)<<0,o[18]=(y(n-18)<=a?r:i)<<2|(y(e-18)<=a?r:i)<<1|(y(t-18)<=a?r:i)<<0,o[19]=(y(n-19)<=a?r:i)<<2|(y(e-19)<=a?r:i)<<1|(y(t-19)<=a?r:i)<<0,o[20]=(y(n-20)<=a?r:i)<<2|(y(e-20)<=a?r:i)<<1|(y(t-20)<=a?r:i)<<0,o[21]=(y(n-21)<=a?r:i)<<2|(y(e-21)<=a?r:i)<<1|(y(t-21)<=a?r:i)<<0,o[22]=(y(n-22)<=a?r:i)<<2|(y(e-22)<=a?r:i)<<1|(y(t-22)<=a?r:i)<<0,o[23]=(y(n-23)<=a?r:i)<<2|(y(e-23)<=a?r:i)<<1|(y(t-23)<=a?r:i)<<0,o[24]=(y(n-24)<=a?r:i)<<2|(y(e-24)<=a?r:i)<<1|(y(t-24)<=a?r:i)<<0,o[25]=(y(n-25)<=a?r:i)<<2|(y(e-25)<=a?r:i)<<1|(y(t-25)<=a?r:i)<<0,o[26]=(y(n-26)<=a?r:i)<<2|(y(e-26)<=a?r:i)<<1|(y(t-26)<=a?r:i)<<0,o[27]=(y(n-27)<=a?r:i)<<2|(y(e-27)<=a?r:i)<<1|(y(t-27)<=a?r:i)<<0,o[28]=(y(n-28)<=a?r:i)<<2|(y(e-28)<=a?r:i)<<1|(y(t-28)<=a?r:i)<<0,o[29]=(y(n-29)<=a?r:i)<<2|(y(e-29)<=a?r:i)<<1|(y(t-29)<=a?r:i)<<0,o[30]=(y(n-30)<=a?r:i)<<2|(y(e-30)<=a?r:i)<<1|(y(t-30)<=a?r:i)<<0,o[31]=(y(n-31)<=a?r:i)<<2|(y(e-31)<=a?r:i)<<1|(y(t-31)<=a?r:i)<<0,o[32]=(y(n-32)<=a?r:i)<<2|(y(e-32)<=a?r:i)<<1|(y(t-32)<=a?r:i)<<0,o[33]=(y(n-33)<=a?r:i)<<2|(y(e-33)<=a?r:i)<<1|(y(t-33)<=a?r:i)<<0,o[34]=(y(n-34)<=a?r:i)<<2|(y(e-34)<=a?r:i)<<1|(y(t-34)<=a?r:i)<<0,o[35]=(y(n-35)<=a?r:i)<<2|(y(e-35)<=a?r:i)<<1|(y(t-35)<=a?r:i)<<0,o[36]=(y(n-36)<=a?r:i)<<2|(y(e-36)<=a?r:i)<<1|(y(t-36)<=a?r:i)<<0,o[37]=(y(n-37)<=a?r:i)<<2|(y(e-37)<=a?r:i)<<1|(y(t-37)<=a?r:i)<<0,o[38]=(y(n-38)<=a?r:i)<<2|(y(e-38)<=a?r:i)<<1|(y(t-38)<=a?r:i)<<0,o[39]=(y(n-39)<=a?r:i)<<2|(y(e-39)<=a?r:i)<<1|(y(t-39)<=a?r:i)<<0,o[40]=(y(n-40)<=a?r:i)<<2|(y(e-40)<=a?r:i)<<1|(y(t-40)<=a?r:i)<<0,o[41]=(y(n-41)<=a?r:i)<<2|(y(e-41)<=a?r:i)<<1|(y(t-41)<=a?r:i)<<0,o[42]=(y(n-42)<=a?r:i)<<2|(y(e-42)<=a?r:i)<<1|(y(t-42)<=a?r:i)<<0,o[43]=(y(n-43)<=a?r:i)<<2|(y(e-43)<=a?r:i)<<1|(y(t-43)<=a?r:i)<<0,o[44]=(y(n-44)<=a?r:i)<<2|(y(e-44)<=a?r:i)<<1|(y(t-44)<=a?r:i)<<0,o[45]=(y(n-45)<=a?r:i)<<2|(y(e-45)<=a?r:i)<<1|(y(t-45)<=a?r:i)<<0,o[46]=(y(n-46)<=a?r:i)<<2|(y(e-46)<=a?r:i)<<1|(y(t-46)<=a?r:i)<<0,o[47]=(y(n-47)<=a?r:i)<<2|(y(e-47)<=a?r:i)<<1|(y(t-47)<=a?r:i)<<0,o[48]=(y(n-48)<=a?r:i)<<2|(y(e-48)<=a?r:i)<<1|(y(t-48)<=a?r:i)<<0,o[49]=(y(n-49)<=a?r:i)<<2|(y(e-49)<=a?r:i)<<1|(y(t-49)<=a?r:i)<<0,o[50]=(y(n-50)<=a?r:i)<<2|(y(e-50)<=a?r:i)<<1|(y(t-50)<=a?r:i)<<0,o[51]=(y(n-51)<=a?r:i)<<2|(y(e-51)<=a?r:i)<<1|(y(t-51)<=a?r:i)<<0,o[52]=(y(n-52)<=a?r:i)<<2|(y(e-52)<=a?r:i)<<1|(y(t-52)<=a?r:i)<<0,o[53]=(y(n-53)<=a?r:i)<<2|(y(e-53)<=a?r:i)<<1|(y(t-53)<=a?r:i)<<0,o[54]=(y(n-54)<=a?r:i)<<2|(y(e-54)<=a?r:i)<<1|(y(t-54)<=a?r:i)<<0,o[55]=(y(n-55)<=a?r:i)<<2|(y(e-55)<=a?r:i)<<1|(y(t-55)<=a?r:i)<<0,o[56]=(y(n-56)<=a?r:i)<<2|(y(e-56)<=a?r:i)<<1|(y(t-56)<=a?r:i)<<0,o[57]=(y(n-57)<=a?r:i)<<2|(y(e-57)<=a?r:i)<<1|(y(t-57)<=a?r:i)<<0,o[58]=(y(n-58)<=a?r:i)<<2|(y(e-58)<=a?r:i)<<1|(y(t-58)<=a?r:i)<<0,o[59]=(y(n-59)<=a?r:i)<<2|(y(e-59)<=a?r:i)<<1|(y(t-59)<=a?r:i)<<0,o[60]=(y(n-60)<=a?r:i)<<2|(y(e-60)<=a?r:i)<<1|(y(t-60)<=a?r:i)<<0,o[61]=(y(n-61)<=a?r:i)<<2|(y(e-61)<=a?r:i)<<1|(y(t-61)<=a?r:i)<<0,o[62]=(y(n-62)<=a?r:i)<<2|(y(e-62)<=a?r:i)<<1|(y(t-62)<=a?r:i)<<0,o[63]=(y(n-63)<=a?r:i)<<2|(y(e-63)<=a?r:i)<<1|(y(t-63)<=a?r:i)<<0,o[64]=(y(n-64)<=a?r:i)<<2|(y(e-64)<=a?r:i)<<1|(y(t-64)<=a?r:i)<<0,o[65]=(y(n-65)<=a?r:i)<<2|(y(e-65)<=a?r:i)<<1|(y(t-65)<=a?r:i)<<0,o[66]=(y(n-66)<=a?r:i)<<2|(y(e-66)<=a?r:i)<<1|(y(t-66)<=a?r:i)<<0,o[67]=(y(n-67)<=a?r:i)<<2|(y(e-67)<=a?r:i)<<1|(y(t-67)<=a?r:i)<<0,o[68]=(y(n-68)<=a?r:i)<<2|(y(e-68)<=a?r:i)<<1|(y(t-68)<=a?r:i)<<0,o[69]=(y(n-69)<=a?r:i)<<2|(y(e-69)<=a?r:i)<<1|(y(t-69)<=a?r:i)<<0,o[70]=(y(n-70)<=a?r:i)<<2|(y(e-70)<=a?r:i)<<1|(y(t-70)<=a?r:i)<<0,o[71]=(y(n-71)<=a?r:i)<<2|(y(e-71)<=a?r:i)<<1|(y(t-71)<=a?r:i)<<0,o[72]=(y(n-72)<=a?r:i)<<2|(y(e-72)<=a?r:i)<<1|(y(t-72)<=a?r:i)<<0,o[73]=(y(n-73)<=a?r:i)<<2|(y(e-73)<=a?r:i)<<1|(y(t-73)<=a?r:i)<<0,o[74]=(y(n-74)<=a?r:i)<<2|(y(e-74)<=a?r:i)<<1|(y(t-74)<=a?r:i)<<0,o[75]=(y(n-75)<=a?r:i)<<2|(y(e-75)<=a?r:i)<<1|(y(t-75)<=a?r:i)<<0,o[76]=(y(n-76)<=a?r:i)<<2|(y(e-76)<=a?r:i)<<1|(y(t-76)<=a?r:i)<<0,o[77]=(y(n-77)<=a?r:i)<<2|(y(e-77)<=a?r:i)<<1|(y(t-77)<=a?r:i)<<0,o[78]=(y(n-78)<=a?r:i)<<2|(y(e-78)<=a?r:i)<<1|(y(t-78)<=a?r:i)<<0,o[79]=(y(n-79)<=a?r:i)<<2|(y(e-79)<=a?r:i)<<1|(y(t-79)<=a?r:i)<<0,o[80]=(y(n-80)<=a?r:i)<<2|(y(e-80)<=a?r:i)<<1|(y(t-80)<=a?r:i)<<0,o[81]=(y(n-81)<=a?r:i)<<2|(y(e-81)<=a?r:i)<<1|(y(t-81)<=a?r:i)<<0,o[82]=(y(n-82)<=a?r:i)<<2|(y(e-82)<=a?r:i)<<1|(y(t-82)<=a?r:i)<<0,o[83]=(y(n-83)<=a?r:i)<<2|(y(e-83)<=a?r:i)<<1|(y(t-83)<=a?r:i)<<0,o[84]=(y(n-84)<=a?r:i)<<2|(y(e-84)<=a?r:i)<<1|(y(t-84)<=a?r:i)<<0,o[85]=(y(n-85)<=a?r:i)<<2|(y(e-85)<=a?r:i)<<1|(y(t-85)<=a?r:i)<<0,o[86]=(y(n-86)<=a?r:i)<<2|(y(e-86)<=a?r:i)<<1|(y(t-86)<=a?r:i)<<0,o[87]=(y(n-87)<=a?r:i)<<2|(y(e-87)<=a?r:i)<<1|(y(t-87)<=a?r:i)<<0,o[88]=(y(n-88)<=a?r:i)<<2|(y(e-88)<=a?r:i)<<1|(y(t-88)<=a?r:i)<<0,o[89]=(y(n-89)<=a?r:i)<<2|(y(e-89)<=a?r:i)<<1|(y(t-89)<=a?r:i)<<0,o[90]=(y(n-90)<=a?r:i)<<2|(y(e-90)<=a?r:i)<<1|(y(t-90)<=a?r:i)<<0,o[91]=(y(n-91)<=a?r:i)<<2|(y(e-91)<=a?r:i)<<1|(y(t-91)<=a?r:i)<<0,o[92]=(y(n-92)<=a?r:i)<<2|(y(e-92)<=a?r:i)<<1|(y(t-92)<=a?r:i)<<0,o[93]=(y(n-93)<=a?r:i)<<2|(y(e-93)<=a?r:i)<<1|(y(t-93)<=a?r:i)<<0,o[94]=(y(n-94)<=a?r:i)<<2|(y(e-94)<=a?r:i)<<1|(y(t-94)<=a?r:i)<<0,o[95]=(y(n-95)<=a?r:i)<<2|(y(e-95)<=a?r:i)<<1|(y(t-95)<=a?r:i)<<0,o[96]=(y(n-96)<=a?r:i)<<2|(y(e-96)<=a?r:i)<<1|(y(t-96)<=a?r:i)<<0,o[97]=(y(n-97)<=a?r:i)<<2|(y(e-97)<=a?r:i)<<1|(y(t-97)<=a?r:i)<<0,o[98]=(y(n-98)<=a?r:i)<<2|(y(e-98)<=a?r:i)<<1|(y(t-98)<=a?r:i)<<0,o[99]=(y(n-99)<=a?r:i)<<2|(y(e-99)<=a?r:i)<<1|(y(t-99)<=a?r:i)<<0,o[100]=(y(n-100)<=a?r:i)<<2|(y(e-100)<=a?r:i)<<1|(y(t-100)<=a?r:i)<<0,o[101]=(y(n-101)<=a?r:i)<<2|(y(e-101)<=a?r:i)<<1|(y(t-101)<=a?r:i)<<0,o[102]=(y(n-102)<=a?r:i)<<2|(y(e-102)<=a?r:i)<<1|(y(t-102)<=a?r:i)<<0,o[103]=(y(n-103)<=a?r:i)<<2|(y(e-103)<=a?r:i)<<1|(y(t-103)<=a?r:i)<<0,o[104]=(y(n-104)<=a?r:i)<<2|(y(e-104)<=a?r:i)<<1|(y(t-104)<=a?r:i)<<0,o[105]=(y(n-105)<=a?r:i)<<2|(y(e-105)<=a?r:i)<<1|(y(t-105)<=a?r:i)<<0,o[106]=(y(n-106)<=a?r:i)<<2|(y(e-106)<=a?r:i)<<1|(y(t-106)<=a?r:i)<<0,o[107]=(y(n-107)<=a?r:i)<<2|(y(e-107)<=a?r:i)<<1|(y(t-107)<=a?r:i)<<0,o[108]=(y(n-108)<=a?r:i)<<2|(y(e-108)<=a?r:i)<<1|(y(t-108)<=a?r:i)<<0,o[109]=(y(n-109)<=a?r:i)<<2|(y(e-109)<=a?r:i)<<1|(y(t-109)<=a?r:i)<<0,o[110]=(y(n-110)<=a?r:i)<<2|(y(e-110)<=a?r:i)<<1|(y(t-110)<=a?r:i)<<0,o[111]=(y(n-111)<=a?r:i)<<2|(y(e-111)<=a?r:i)<<1|(y(t-111)<=a?r:i)<<0,o[112]=(y(n-112)<=a?r:i)<<2|(y(e-112)<=a?r:i)<<1|(y(t-112)<=a?r:i)<<0,o[113]=(y(n-113)<=a?r:i)<<2|(y(e-113)<=a?r:i)<<1|(y(t-113)<=a?r:i)<<0,o[114]=(y(n-114)<=a?r:i)<<2|(y(e-114)<=a?r:i)<<1|(y(t-114)<=a?r:i)<<0,o[115]=(y(n-115)<=a?r:i)<<2|(y(e-115)<=a?r:i)<<1|(y(t-115)<=a?r:i)<<0,o[116]=(y(n-116)<=a?r:i)<<2|(y(e-116)<=a?r:i)<<1|(y(t-116)<=a?r:i)<<0,o[117]=(y(n-117)<=a?r:i)<<2|(y(e-117)<=a?r:i)<<1|(y(t-117)<=a?r:i)<<0,o[118]=(y(n-118)<=a?r:i)<<2|(y(e-118)<=a?r:i)<<1|(y(t-118)<=a?r:i)<<0,o[119]=(y(n-119)<=a?r:i)<<2|(y(e-119)<=a?r:i)<<1|(y(t-119)<=a?r:i)<<0,o[120]=(y(n-120)<=a?r:i)<<2|(y(e-120)<=a?r:i)<<1|(y(t-120)<=a?r:i)<<0,o[121]=(y(n-121)<=a?r:i)<<2|(y(e-121)<=a?r:i)<<1|(y(t-121)<=a?r:i)<<0,o[122]=(y(n-122)<=a?r:i)<<2|(y(e-122)<=a?r:i)<<1|(y(t-122)<=a?r:i)<<0,o[123]=(y(n-123)<=a?r:i)<<2|(y(e-123)<=a?r:i)<<1|(y(t-123)<=a?r:i)<<0,o[124]=(y(n-124)<=a?r:i)<<2|(y(e-124)<=a?r:i)<<1|(y(t-124)<=a?r:i)<<0,o[125]=(y(n-125)<=a?r:i)<<2|(y(e-125)<=a?r:i)<<1|(y(t-125)<=a?r:i)<<0,o[126]=(y(n-126)<=a?r:i)<<2|(y(e-126)<=a?r:i)<<1|(y(t-126)<=a?r:i)<<0,o[127]=(y(n-127)<=a?r:i)<<2|(y(e-127)<=a?r:i)<<1|(y(t-127)<=a?r:i)<<0,o[128]=(y(n-128)<=a?r:i)<<2|(y(e-128)<=a?r:i)<<1|(y(t-128)<=a?r:i)<<0,o[129]=(y(n-129)<=a?r:i)<<2|(y(e-129)<=a?r:i)<<1|(y(t-129)<=a?r:i)<<0,o[130]=(y(n-130)<=a?r:i)<<2|(y(e-130)<=a?r:i)<<1|(y(t-130)<=a?r:i)<<0,o[131]=(y(n-131)<=a?r:i)<<2|(y(e-131)<=a?r:i)<<1|(y(t-131)<=a?r:i)<<0,o[132]=(y(n-132)<=a?r:i)<<2|(y(e-132)<=a?r:i)<<1|(y(t-132)<=a?r:i)<<0,o[133]=(y(n-133)<=a?r:i)<<2|(y(e-133)<=a?r:i)<<1|(y(t-133)<=a?r:i)<<0,o[134]=(y(n-134)<=a?r:i)<<2|(y(e-134)<=a?r:i)<<1|(y(t-134)<=a?r:i)<<0,o[135]=(y(n-135)<=a?r:i)<<2|(y(e-135)<=a?r:i)<<1|(y(t-135)<=a?r:i)<<0,o[136]=(y(n-136)<=a?r:i)<<2|(y(e-136)<=a?r:i)<<1|(y(t-136)<=a?r:i)<<0,o[137]=(y(n-137)<=a?r:i)<<2|(y(e-137)<=a?r:i)<<1|(y(t-137)<=a?r:i)<<0,o[138]=(y(n-138)<=a?r:i)<<2|(y(e-138)<=a?r:i)<<1|(y(t-138)<=a?r:i)<<0,o[139]=(y(n-139)<=a?r:i)<<2|(y(e-139)<=a?r:i)<<1|(y(t-139)<=a?r:i)<<0,o[140]=(y(n-140)<=a?r:i)<<2|(y(e-140)<=a?r:i)<<1|(y(t-140)<=a?r:i)<<0,o[141]=(y(n-141)<=a?r:i)<<2|(y(e-141)<=a?r:i)<<1|(y(t-141)<=a?r:i)<<0,o[142]=(y(n-142)<=a?r:i)<<2|(y(e-142)<=a?r:i)<<1|(y(t-142)<=a?r:i)<<0,o[143]=(y(n-143)<=a?r:i)<<2|(y(e-143)<=a?r:i)<<1|(y(t-143)<=a?r:i)<<0,o[144]=(y(n-144)<=a?r:i)<<2|(y(e-144)<=a?r:i)<<1|(y(t-144)<=a?r:i)<<0,o[145]=(y(n-145)<=a?r:i)<<2|(y(e-145)<=a?r:i)<<1|(y(t-145)<=a?r:i)<<0,o[146]=(y(n-146)<=a?r:i)<<2|(y(e-146)<=a?r:i)<<1|(y(t-146)<=a?r:i)<<0,o[147]=(y(n-147)<=a?r:i)<<2|(y(e-147)<=a?r:i)<<1|(y(t-147)<=a?r:i)<<0,o[148]=(y(n-148)<=a?r:i)<<2|(y(e-148)<=a?r:i)<<1|(y(t-148)<=a?r:i)<<0,o[149]=(y(n-149)<=a?r:i)<<2|(y(e-149)<=a?r:i)<<1|(y(t-149)<=a?r:i)<<0,o[150]=(y(n-150)<=a?r:i)<<2|(y(e-150)<=a?r:i)<<1|(y(t-150)<=a?r:i)<<0,o[151]=(y(n-151)<=a?r:i)<<2|(y(e-151)<=a?r:i)<<1|(y(t-151)<=a?r:i)<<0,o[152]=(y(n-152)<=a?r:i)<<2|(y(e-152)<=a?r:i)<<1|(y(t-152)<=a?r:i)<<0,o[153]=(y(n-153)<=a?r:i)<<2|(y(e-153)<=a?r:i)<<1|(y(t-153)<=a?r:i)<<0,o[154]=(y(n-154)<=a?r:i)<<2|(y(e-154)<=a?r:i)<<1|(y(t-154)<=a?r:i)<<0,o[155]=(y(n-155)<=a?r:i)<<2|(y(e-155)<=a?r:i)<<1|(y(t-155)<=a?r:i)<<0,o[156]=(y(n-156)<=a?r:i)<<2|(y(e-156)<=a?r:i)<<1|(y(t-156)<=a?r:i)<<0,o[157]=(y(n-157)<=a?r:i)<<2|(y(e-157)<=a?r:i)<<1|(y(t-157)<=a?r:i)<<0,o[158]=(y(n-158)<=a?r:i)<<2|(y(e-158)<=a?r:i)<<1|(y(t-158)<=a?r:i)<<0,o[159]=(y(n-159)<=a?r:i)<<2|(y(e-159)<=a?r:i)<<1|(y(t-159)<=a?r:i)<<0,o[160]=(y(n-160)<=a?r:i)<<2|(y(e-160)<=a?r:i)<<1|(y(t-160)<=a?r:i)<<0,o[161]=(y(n-161)<=a?r:i)<<2|(y(e-161)<=a?r:i)<<1|(y(t-161)<=a?r:i)<<0,o[162]=(y(n-162)<=a?r:i)<<2|(y(e-162)<=a?r:i)<<1|(y(t-162)<=a?r:i)<<0,o[163]=(y(n-163)<=a?r:i)<<2|(y(e-163)<=a?r:i)<<1|(y(t-163)<=a?r:i)<<0,o[164]=(y(n-164)<=a?r:i)<<2|(y(e-164)<=a?r:i)<<1|(y(t-164)<=a?r:i)<<0,o[165]=(y(n-165)<=a?r:i)<<2|(y(e-165)<=a?r:i)<<1|(y(t-165)<=a?r:i)<<0,o[166]=(y(n-166)<=a?r:i)<<2|(y(e-166)<=a?r:i)<<1|(y(t-166)<=a?r:i)<<0,o[167]=(y(n-167)<=a?r:i)<<2|(y(e-167)<=a?r:i)<<1|(y(t-167)<=a?r:i)<<0,o[168]=(y(n-168)<=a?r:i)<<2|(y(e-168)<=a?r:i)<<1|(y(t-168)<=a?r:i)<<0,o[169]=(y(n-169)<=a?r:i)<<2|(y(e-169)<=a?r:i)<<1|(y(t-169)<=a?r:i)<<0,o[170]=(y(n-170)<=a?r:i)<<2|(y(e-170)<=a?r:i)<<1|(y(t-170)<=a?r:i)<<0,o[171]=(y(n-171)<=a?r:i)<<2|(y(e-171)<=a?r:i)<<1|(y(t-171)<=a?r:i)<<0,o[172]=(y(n-172)<=a?r:i)<<2|(y(e-172)<=a?r:i)<<1|(y(t-172)<=a?r:i)<<0,o[173]=(y(n-173)<=a?r:i)<<2|(y(e-173)<=a?r:i)<<1|(y(t-173)<=a?r:i)<<0,o[174]=(y(n-174)<=a?r:i)<<2|(y(e-174)<=a?r:i)<<1|(y(t-174)<=a?r:i)<<0,o[175]=(y(n-175)<=a?r:i)<<2|(y(e-175)<=a?r:i)<<1|(y(t-175)<=a?r:i)<<0,o[176]=(y(n-176)<=a?r:i)<<2|(y(e-176)<=a?r:i)<<1|(y(t-176)<=a?r:i)<<0,o[177]=(y(n-177)<=a?r:i)<<2|(y(e-177)<=a?r:i)<<1|(y(t-177)<=a?r:i)<<0,o[178]=(y(n-178)<=a?r:i)<<2|(y(e-178)<=a?r:i)<<1|(y(t-178)<=a?r:i)<<0,o[179]=(y(n-179)<=a?r:i)<<2|(y(e-179)<=a?r:i)<<1|(y(t-179)<=a?r:i)<<0,o[180]=(y(n-180)<=a?r:i)<<2|(y(e-180)<=a?r:i)<<1|(y(t-180)<=a?r:i)<<0,o[181]=(y(n-181)<=a?r:i)<<2|(y(e-181)<=a?r:i)<<1|(y(t-181)<=a?r:i)<<0,o[182]=(y(n-182)<=a?r:i)<<2|(y(e-182)<=a?r:i)<<1|(y(t-182)<=a?r:i)<<0,o[183]=(y(n-183)<=a?r:i)<<2|(y(e-183)<=a?r:i)<<1|(y(t-183)<=a?r:i)<<0,o[184]=(y(n-184)<=a?r:i)<<2|(y(e-184)<=a?r:i)<<1|(y(t-184)<=a?r:i)<<0,o[185]=(y(n-185)<=a?r:i)<<2|(y(e-185)<=a?r:i)<<1|(y(t-185)<=a?r:i)<<0,o[186]=(y(n-186)<=a?r:i)<<2|(y(e-186)<=a?r:i)<<1|(y(t-186)<=a?r:i)<<0,o[187]=(y(n-187)<=a?r:i)<<2|(y(e-187)<=a?r:i)<<1|(y(t-187)<=a?r:i)<<0,o[188]=(y(n-188)<=a?r:i)<<2|(y(e-188)<=a?r:i)<<1|(y(t-188)<=a?r:i)<<0,o[189]=(y(n-189)<=a?r:i)<<2|(y(e-189)<=a?r:i)<<1|(y(t-189)<=a?r:i)<<0,o[190]=(y(n-190)<=a?r:i)<<2|(y(e-190)<=a?r:i)<<1|(y(t-190)<=a?r:i)<<0,o[191]=(y(n-191)<=a?r:i)<<2|(y(e-191)<=a?r:i)<<1|(y(t-191)<=a?r:i)<<0,o[192]=(y(n-192)<=a?r:i)<<2|(y(e-192)<=a?r:i)<<1|(y(t-192)<=a?r:i)<<0,o[193]=(y(n-193)<=a?r:i)<<2|(y(e-193)<=a?r:i)<<1|(y(t-193)<=a?r:i)<<0,o[194]=(y(n-194)<=a?r:i)<<2|(y(e-194)<=a?r:i)<<1|(y(t-194)<=a?r:i)<<0,o[195]=(y(n-195)<=a?r:i)<<2|(y(e-195)<=a?r:i)<<1|(y(t-195)<=a?r:i)<<0,o[196]=(y(n-196)<=a?r:i)<<2|(y(e-196)<=a?r:i)<<1|(y(t-196)<=a?r:i)<<0,o[197]=(y(n-197)<=a?r:i)<<2|(y(e-197)<=a?r:i)<<1|(y(t-197)<=a?r:i)<<0,o[198]=(y(n-198)<=a?r:i)<<2|(y(e-198)<=a?r:i)<<1|(y(t-198)<=a?r:i)<<0,o[199]=(y(n-199)<=a?r:i)<<2|(y(e-199)<=a?r:i)<<1|(y(t-199)<=a?r:i)<<0,o[200]=(y(n-200)<=a?r:i)<<2|(y(e-200)<=a?r:i)<<1|(y(t-200)<=a?r:i)<<0,o[201]=(y(n-201)<=a?r:i)<<2|(y(e-201)<=a?r:i)<<1|(y(t-201)<=a?r:i)<<0,o[202]=(y(n-202)<=a?r:i)<<2|(y(e-202)<=a?r:i)<<1|(y(t-202)<=a?r:i)<<0,o[203]=(y(n-203)<=a?r:i)<<2|(y(e-203)<=a?r:i)<<1|(y(t-203)<=a?r:i)<<0,o[204]=(y(n-204)<=a?r:i)<<2|(y(e-204)<=a?r:i)<<1|(y(t-204)<=a?r:i)<<0,o[205]=(y(n-205)<=a?r:i)<<2|(y(e-205)<=a?r:i)<<1|(y(t-205)<=a?r:i)<<0,o[206]=(y(n-206)<=a?r:i)<<2|(y(e-206)<=a?r:i)<<1|(y(t-206)<=a?r:i)<<0,o[207]=(y(n-207)<=a?r:i)<<2|(y(e-207)<=a?r:i)<<1|(y(t-207)<=a?r:i)<<0,o[208]=(y(n-208)<=a?r:i)<<2|(y(e-208)<=a?r:i)<<1|(y(t-208)<=a?r:i)<<0,o[209]=(y(n-209)<=a?r:i)<<2|(y(e-209)<=a?r:i)<<1|(y(t-209)<=a?r:i)<<0,o[210]=(y(n-210)<=a?r:i)<<2|(y(e-210)<=a?r:i)<<1|(y(t-210)<=a?r:i)<<0,o[211]=(y(n-211)<=a?r:i)<<2|(y(e-211)<=a?r:i)<<1|(y(t-211)<=a?r:i)<<0,o[212]=(y(n-212)<=a?r:i)<<2|(y(e-212)<=a?r:i)<<1|(y(t-212)<=a?r:i)<<0,o[213]=(y(n-213)<=a?r:i)<<2|(y(e-213)<=a?r:i)<<1|(y(t-213)<=a?r:i)<<0,o[214]=(y(n-214)<=a?r:i)<<2|(y(e-214)<=a?r:i)<<1|(y(t-214)<=a?r:i)<<0,o[215]=(y(n-215)<=a?r:i)<<2|(y(e-215)<=a?r:i)<<1|(y(t-215)<=a?r:i)<<0,o[216]=(y(n-216)<=a?r:i)<<2|(y(e-216)<=a?r:i)<<1|(y(t-216)<=a?r:i)<<0,o[217]=(y(n-217)<=a?r:i)<<2|(y(e-217)<=a?r:i)<<1|(y(t-217)<=a?r:i)<<0,o[218]=(y(n-218)<=a?r:i)<<2|(y(e-218)<=a?r:i)<<1|(y(t-218)<=a?r:i)<<0,o[219]=(y(n-219)<=a?r:i)<<2|(y(e-219)<=a?r:i)<<1|(y(t-219)<=a?r:i)<<0,o[220]=(y(n-220)<=a?r:i)<<2|(y(e-220)<=a?r:i)<<1|(y(t-220)<=a?r:i)<<0,o[221]=(y(n-221)<=a?r:i)<<2|(y(e-221)<=a?r:i)<<1|(y(t-221)<=a?r:i)<<0,o[222]=(y(n-222)<=a?r:i)<<2|(y(e-222)<=a?r:i)<<1|(y(t-222)<=a?r:i)<<0,o[223]=(y(n-223)<=a?r:i)<<2|(y(e-223)<=a?r:i)<<1|(y(t-223)<=a?r:i)<<0,o[224]=(y(n-224)<=a?r:i)<<2|(y(e-224)<=a?r:i)<<1|(y(t-224)<=a?r:i)<<0,o[225]=(y(n-225)<=a?r:i)<<2|(y(e-225)<=a?r:i)<<1|(y(t-225)<=a?r:i)<<0,o[226]=(y(n-226)<=a?r:i)<<2|(y(e-226)<=a?r:i)<<1|(y(t-226)<=a?r:i)<<0,o[227]=(y(n-227)<=a?r:i)<<2|(y(e-227)<=a?r:i)<<1|(y(t-227)<=a?r:i)<<0,o[228]=(y(n-228)<=a?r:i)<<2|(y(e-228)<=a?r:i)<<1|(y(t-228)<=a?r:i)<<0,o[229]=(y(n-229)<=a?r:i)<<2|(y(e-229)<=a?r:i)<<1|(y(t-229)<=a?r:i)<<0,o[230]=(y(n-230)<=a?r:i)<<2|(y(e-230)<=a?r:i)<<1|(y(t-230)<=a?r:i)<<0,o[231]=(y(n-231)<=a?r:i)<<2|(y(e-231)<=a?r:i)<<1|(y(t-231)<=a?r:i)<<0,o[232]=(y(n-232)<=a?r:i)<<2|(y(e-232)<=a?r:i)<<1|(y(t-232)<=a?r:i)<<0,o[233]=(y(n-233)<=a?r:i)<<2|(y(e-233)<=a?r:i)<<1|(y(t-233)<=a?r:i)<<0,o[234]=(y(n-234)<=a?r:i)<<2|(y(e-234)<=a?r:i)<<1|(y(t-234)<=a?r:i)<<0,o[235]=(y(n-235)<=a?r:i)<<2|(y(e-235)<=a?r:i)<<1|(y(t-235)<=a?r:i)<<0,o[236]=(y(n-236)<=a?r:i)<<2|(y(e-236)<=a?r:i)<<1|(y(t-236)<=a?r:i)<<0,o[237]=(y(n-237)<=a?r:i)<<2|(y(e-237)<=a?r:i)<<1|(y(t-237)<=a?r:i)<<0,o[238]=(y(n-238)<=a?r:i)<<2|(y(e-238)<=a?r:i)<<1|(y(t-238)<=a?r:i)<<0,o[239]=(y(n-239)<=a?r:i)<<2|(y(e-239)<=a?r:i)<<1|(y(t-239)<=a?r:i)<<0,o[240]=(y(n-240)<=a?r:i)<<2|(y(e-240)<=a?r:i)<<1|(y(t-240)<=a?r:i)<<0,o[241]=(y(n-241)<=a?r:i)<<2|(y(e-241)<=a?r:i)<<1|(y(t-241)<=a?r:i)<<0,o[242]=(y(n-242)<=a?r:i)<<2|(y(e-242)<=a?r:i)<<1|(y(t-242)<=a?r:i)<<0,o[243]=(y(n-243)<=a?r:i)<<2|(y(e-243)<=a?r:i)<<1|(y(t-243)<=a?r:i)<<0,o[244]=(y(n-244)<=a?r:i)<<2|(y(e-244)<=a?r:i)<<1|(y(t-244)<=a?r:i)<<0,o[245]=(y(n-245)<=a?r:i)<<2|(y(e-245)<=a?r:i)<<1|(y(t-245)<=a?r:i)<<0,o[246]=(y(n-246)<=a?r:i)<<2|(y(e-246)<=a?r:i)<<1|(y(t-246)<=a?r:i)<<0,o[247]=(y(n-247)<=a?r:i)<<2|(y(e-247)<=a?r:i)<<1|(y(t-247)<=a?r:i)<<0,o[248]=(y(n-248)<=a?r:i)<<2|(y(e-248)<=a?r:i)<<1|(y(t-248)<=a?r:i)<<0,o[249]=(y(n-249)<=a?r:i)<<2|(y(e-249)<=a?r:i)<<1|(y(t-249)<=a?r:i)<<0,o[250]=(y(n-250)<=a?r:i)<<2|(y(e-250)<=a?r:i)<<1|(y(t-250)<=a?r:i)<<0,o[251]=(y(n-251)<=a?r:i)<<2|(y(e-251)<=a?r:i)<<1|(y(t-251)<=a?r:i)<<0,o[252]=(y(n-252)<=a?r:i)<<2|(y(e-252)<=a?r:i)<<1|(y(t-252)<=a?r:i)<<0,o[253]=(y(n-253)<=a?r:i)<<2|(y(e-253)<=a?r:i)<<1|(y(t-253)<=a?r:i)<<0,o[254]=(y(n-254)<=a?r:i)<<2|(y(e-254)<=a?r:i)<<1|(y(t-254)<=a?r:i)<<0,o[255]=(y(n-255)<=a?r:i)<<2|(y(e-255)<=a?r:i)<<1|(y(t-255)<=a?r:i)<<0,o}function Go(t,e,n,r,i,a,o,l){var s,u,c,f,h,m,p,d,g=t.length,_=g>>>(r|=0),x=1<<r,v=e<<r,y=g-v,b=e-1<<r,C=o,w=l,A=o,S=l,R=new ni(ai(_/32)),I=new ei(_<<2),L=0,D=o+l>>>r;if(R[D>>>5]|=1<<(31&D),0<=l+v&&l+v<=y&&(I[L]=l,I[L+1]=o,I[L+2]=o,I[L+3]=v,L+=4),I[L]=l+v,I[L+1]=o,I[L+2]=o,I[L+3]=-v,L+=4,r)for(;0<L;){for(v=I[(L-=4)+3],m=I[L]+v,f=I[L+1],h=I[L+2],w=oi(w,m),S=li(S,m),C=oi(C,f),A=li(A,h),c=f;0<=c&&(D=(u=c+m)>>>r,!((d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]])||R[D>>>5]&1<<(31&D)));c-=x)R[D>>>5]|=1<<(31&D),C=oi(C,c);if(f<=c){for(D=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||R[D>>>5]&1<<(31&D));)D=(u=(c+=x)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(s=c)<=h}else(s=c+x)<f&&0+v<=m&&m<=y+v&&(I[L]=m,I[L+1]=s,I[L+2]=f-x,I[L+3]=-v,L+=4),c=f+x,p=!0;for(;p;){for(D=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=b&&!d&&!(R[D>>>5]&1<<(31&D));)R[D>>>5]|=1<<(31&D),A=li(A,c),D=(u=(c+=x)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];for(0<=m+v&&m+v<=y&&(I[L]=m,I[L+1]=s,I[L+2]=c-x,I[L+3]=v,L+=4),h+x<c&&0<=m-v&&m-v<=y&&(I[L]=m,I[L+1]=h+x,I[L+2]=c-x,I[L+3]=-v,L+=4),D=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||R[D>>>5]&1<<(31&D));)D=(u=(c+=x)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(s=c)<=h}}else for(;0<L;){for(v=I[(L-=4)+3],m=I[L]+v,f=I[L+1],h=I[L+2],w=oi(w,m),S=li(S,m),C=oi(C,f),A=li(A,h),c=f;0<=c&&!(1&i[t[D=u=c+m]]||R[D>>>5]&1<<(31&D));c-=x)R[D>>>5]|=1<<(31&D),C=oi(C,c);if(f<=c){for(D=u=c+m;c<=h&&(1&i[t[u]]||R[D>>>5]&1<<(31&D));)D=u=(c+=x)+m;p=(s=c)<=h}else(s=c+x)<f&&0+v<=m&&m<=y+v&&(I[L]=m,I[L+1]=s,I[L+2]=f-x,I[L+3]=-v,L+=4),c=f+x,p=!0;for(;p;){for(D=u=c+m;c<=b&&!(1&i[t[u]])&&!(R[D>>>5]&1<<(31&D));)R[D>>>5]|=1<<(31&D),A=li(A,c),D=u=(c+=x)+m;for(0<=m+v&&m+v<=y&&(I[L]=m,I[L+1]=s,I[L+2]=c-x,I[L+3]=v,L+=4),h+x<c&&0<=m-v&&m-v<=y&&(I[L]=m,I[L+1]=h+x,I[L+2]=c-x,I[L+3]=-v,L+=4),D=u=c+m;c<=h&&(1&i[t[u]]||R[D>>>5]&1<<(31&D));)D=u=(c+=x)+m;p=(s=c)<=h}}return{mask:R,box:[C,w,A,S]}}function Fo(t,e,n,r,i,a,o,l,s,u,c){null==l&&(s=l=0,u=e-1);var f,h,m,p,d=si.MODE,g=si.Color.hue,_=si.Color.intensity,x=hi.cos,v=si.CONST.toRad,y=(t.length,i.length),b=u-l+1;if(0<r)if(d.HUE===o||d.COLORIZEHUE===o)for(m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=0===t[(f=m+p<<r)+3]?1e4:x(v*g(t[f],t[f+1],t[f+2]));else if(d.INTENSITY===o)for(a*=255,m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=0===t[(f=m+p<<r)+3]?1e4:_(t[f],t[f+1],t[f+2]);else if(d.GRAY===o)for(a*=255,m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=0===t[(f=m+p<<r)+3]?1e4:t[f];else for(a=1e4*a+1e3*a+100*a+10*a+a,m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=0===t[(f=m+p<<r)+3]?1e5:1e4*(t[f]+t[f+1]+t[f+2])/3/255+1e3*(t[f]+t[f+1])/2/255+100*(t[f+1]+t[f+2])/2/255+10*(t[f]+t[f+2])/2/255+t[f]/255;else if(d.HUE===o||d.COLORIZEHUE===o)for(m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=x(v*t[f=m+p]);else for(a*=255,m=l,p=s*e,h=0;h<y;++h,++m)b<=m&&(m=l,p+=e),i[h]=t[f=m+p];return a}function Oo(t,e,n){this.id=-1,this.root=n||this,this.x1=t,this.y1=e,this.x2=t,this.y2=e}function No(t){for(var e=t.x1,n=t.y1,r=t.x2,i=t.y2;t!==t.root;)t=t.root,e=mi(e,t.x1),n=mi(n,t.y1),r=pi(r,t.x2),i=pi(i,t.y2),t.x1=e,t.y1=n,t.x2=r,t.y2=i;return t}function Ho(t,e){(t=No(t))!==(e=No(e))&&(t.x1=e.x1=mi(e.x1,t.x1),t.y1=e.y1=mi(e.y1,t.y1),t.x2=e.x2=pi(e.x2,t.x2),t.y2=e.y2=pi(e.y2,t.y2),t.root=e)}function Uo(a,t,e,n,r,i,o,l,s,u,c,f,h,m,p,d){null==h&&(m=h=0),n|=0;var g,_,x,v,y,b,C,w,A,S,R=a?a.length:t*e<<n,I=R>>>n,L=8===i,D=null,E=null!=l,T=new Array(I),D=E?new Oo(0,0):null;for(T[0]=E&&di(r[0]-l)>o?D:new Oo(0,0),x=1;x<t;++x)T[x]=E&&di(r[x]-l)>o?D:di(r[x]-r[x-1])<=o?T[x-1]:new Oo(x,0);for(v=1,y=t;v<e;++v,y+=t)for(T[y]=E&&di(r[y]-l)>o?D:di(r[y]-r[y-t])<=o?T[y-t]:new Oo(0,v),x=1;x<t;++x)E&&di(r[y+x]-l)>o?T[y+x]=D:(_=D!==T[y+x-1]&&di(r[y+x]-r[y+x-1])<=o?T[y+x-1]:null,L&&D!==T[y-t+x-1]&&di(r[y+x]-r[y-t+x-1])<=o&&(null!=_?Ho(_,T[y-t+x-1]):_=T[y-t+x-1]),D!==T[y-t+x]&&di(r[y+x]-r[y-t+x])<=o&&(null!=_?Ho(_,T[y-t+x]):_=T[y-t+x]),T[y+x]=null!=_?_:new Oo(x,v),L&&D!==T[y+x-1]&&D!==T[y-t+x]&&di(r[y+x-1]-r[y-t+x])<=o&&Ho(T[y+x-1],T[y-t+x]));for(A=s?(w=-255,255):(w=255,0),b=null!=D?(D.id=0,1):0,u&&(a={}),x=0;x<I;++x)T[x]=No(T[x]),T[x].id<0&&(T[x].id=b++),u&&D!==T[x]&&((S=a[T[x].id])?(S.x1=mi(S.x1,T[x].x1),S.y1=mi(S.y1,T[x].y1),S.x2=pi(S.x2,T[x].x2),S.y2=pi(S.y2,T[x].y2),S.k=pi(S.k,di(r[x]-l))):a[T[x].id]={x1:T[x].x1,y1:T[x].y1,x2:T[x].x2,y2:T[x].y2,k:di(r[x]-l)});if(u)a=Object.keys(a).reduce(function(t,e){var e=a[e],n=e.x2-e.x1+1,r=e.y2-e.y1+1,i=n*r;return i<c||f<i||t.push({x:h+e.x1,y:m+e.y1,width:n,height:r,area:i,score:e.k/o}),t},[]);else if(n)for(g=x=0;g<R;g+=4,++x)C=A+w*T[x].id/b|0,a[g]=a[g+1]=a[g+2]=C;else for(x=0;x<R;++x)C=A+w*T[x].id/b|0,a[x]=C;return a}function Bo(t,e){return e.area-t.area}function Yo(t,e,n,r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x){var v,y,b,C,w,A,S,R,I,L,D,E=p,T=d,M=at.abs(h),G=o.length,F=!(0===M||90===M||180===M||270===M);if(x.sat=n,x.sat2=r,F?(zo(x,b=-(v=E>>>1),C=-(y=T>>>1),w=E-1-v,A=T-1-y,g,_,0,0),Pi(x,l,s,t+x.x1,e+x.y1,t+x.x2,e+x.y2,t+x.x3,e+x.y3,t+x.x4,e+x.y4,m)):(90!==M&&270!==M||(E=d,T=p),b=-(v=E>>>1),C=-(y=T>>>1),w=E-1-v,A=T-1-y,x.area=0,x.sum=0,x.sum2=0,ki(x,l,s,t+b,e+C,t+w,e+A,1)),x.sat2=null,h=x.area,n=x.sum,r=x.sum2,2<=(E=p*d/h)||E<=.5)return 0;if(T=at.abs(r-n*(L=n/h)),G<=1)return T<.01?at.abs(L-i)<.5?1:1-at.abs(L-i)/at.max(L,i):0;if(T<.001)return 0;for(S=D=0;S<G;++S)I=o[S],A=F?(b=I.x0,C=I.y0,w=I.x1,I.y1):270===M?(b=I.y0,C=u-1-I.x1,w=I.y1,u-1-I.x0):180===M?(b=u-1-I.x1,C=c-1-I.y1,w=u-1-I.x0,c-1-I.y0):90===M?(b=c-1-I.y1,C=I.x0,w=c-1-I.y0,I.x1):(b=I.x0,C=I.y0,w=I.x1,I.y1),b=at.round(f*b)-v,C=at.round(f*C)-y,w=at.round(f*w)-v,A=at.round(f*A)-y,I=I.k-i,F?(zo(x,b,C,w,A,g,_,0,0),Pi(x,l,s,t+x.x1,e+x.y1,t+x.x2,e+x.y2,t+x.x3,e+x.y3,t+x.x4,e+x.y4,m)):(x.area=0,x.sum=0,ki(x,l,s,t+b,e+C,t+w,e+A,1)),R=x.area,D+=I*(x.sum-L*R);return p=D/at.sqrt(T*a.v*h)||0,(d=a.c0||0)<(E=a.c||0)&&p<=at.abs(d)?0:at.min(at.max(p=1.01<(p/=E||1)?0:p,-1),1)}function zo(t,e,n,r,i,a,o,l,s){var u=e-l,n=n-s;t.x1=at.round(o*u-a*n+l),t.y1=at.round(a*u+o*n+s),t.x2=at.round(o*(u=r-l)-a*n+l),t.y2=at.round(a*u+o*n+s),t.x3=at.round(o*u-a*(n=i-s)+l),t.y3=at.round(a*u+o*n+s),t.x4=at.round(o*(u=e-l)-a*n+l),t.y4=at.round(a*u+o*n+s),t.area=0,t.sum=0,t.sum2=0}function ko(t,e,n,r,i,a){for(var o,l,s,u,c,f=0,h=0,m=0,p=t.length,d=e*n,g=0;g<p;g+=4)f+=t[g]/d,h+=t[g+1]/d,m+=t[g+2]/d;return o=[f,h,m],null!=r&&(u=[null,null,null],c=[null,null,null],l=[[],[],[]],s=[0,0,0],null!=a?(Yi(t,e,n,2,a,u[a]=new Wi(d),c[a]=new Wi(d)),l[a]=Bi.tm_approximate(t,u[a],e,n,a,r,i),s[a]=Po(l[a],o[a],u[a],c[a],e,n)):(Yi(t,e,n,2,0,u[0]=new Wi(d),c[0]=new Wi(d)),Yi(t,e,n,2,1,u[1]=new Wi(d),c[1]=new Wi(d)),Yi(t,e,n,2,2,u[2]=new Wi(d),c[2]=new Wi(d)),s=[Po((l=[Bi.tm_approximate(t,u[0],e,n,0,r,i),Bi.tm_approximate(t,u[1],e,n,1,r,i),Bi.tm_approximate(t,u[2],e,n,2,r,i)])[0],o[0],u[0],c[0],e,n),Po(l[1],o[1],u[1],c[1],e,n),Po(l[2],o[2],u[2],c[2],e,n)])),{avg:o,basis:l||null,var:s||null}}function Po(t,e,n,r,i,a){for(var o,l,s,u,c,f,h,m=t.length,p=0,d=zi(n,i,a,0,0,i-1,a-1),r=zi(r,i,a,0,0,i-1,a-1)-d*e,g=r,_=0,x=0,v=0,y=0,b=0;b<m;++b)h=(o=t[b]).x0,u=o.y0,l=((s=o.x1)-h+1)*((c=o.y1)-u+1),f=o.k-e,d=zi(n,i,a,h,u,s,c),p<l?(v=_+(h=255-o.k-e)*h*(p=l),y=x+h*(d-e*l),_+=f*f*l,x+=f*(d-e*l)):(_+=f*f*l,x+=f*(d-e*l),v+=f*f*l,y+=f*(d-e*l));return{v:_/(i*a),c:x/at.sqrt(at.abs(r*_))||0,c0:y/at.sqrt(at.abs(g*v))||0}}function jo(t,e,n,r,i,a,o,l,s,u){if(!s||!s.length)return[];c=null,f=0,(b=(b=s).map(function(t){return(t%360+360)%180}).sort(function(t,e){return t-e}).reduce(function(t,e){return e!==c&&(t[f++]=e),c=e,t},new Array(b.length))).length=f,s=b;var c,f,h,m,p,d,g,_,x,v,y,b=o-i+1,l=l-a+1,C=b/2,w=l/2,A=N.ceil(Qi(b,l)),S=2*A+1,R=s.length,I=R*S,L=new na(I),D=new Array(I),E=new ra(R),T=new ra(R),M=4===r?3:0,G=4===r?2:0;for(Qo(E,T,s),h=i,p=(m=a)*e,g=0,_=b*l<<G;g<_;g+=r,++h)if(o<h&&(h=i,++m,p+=e),t[d=p+h<<G]&&t[d+M])for(x=0;x<R;++x)++L[v=(N.round((h-C)*T[x]+(m-w)*E[x])+A)*R+x],(y=D[v])?(y.xmin>h&&(y.xminy=m),y.xmax<h&&(y.xmaxy=m),y.xmin=N.min(h,y.xmin),y.xmax=N.max(h,y.xmax),y.ymin=N.min(m,y.ymin),y.ymax=N.max(m,y.ymax)):D[v]={xmin:h,ymin:m,xmax:h,ymax:m,xminy:m,xmaxy:m};return ea([],L,u,S,R,null).map(function(t){var e=D[t];return{shape:"line",rho:N.floor(t/R)-A,theta:s[t%R],x0:e.xmin,y0:e.xmin===e.xmax?e.ymin:e.xminy,x1:e.xmax,y1:e.xmin===e.xmax?e.ymax:e.xmaxy}})}function Xo(n,r,i,a,t,e,o,l,s,u,c){return jo(n,r,0,a,t,e,o,l,s,u).reduce(function(t,e){return t.push.apply(t,el(e,n,r,i,a,u,c)),t},[])}function Wo(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L,D,E,T=jo(t,e,0,r,i,a,o,l,s,c),M=.025*N.min(o-i+1,l-a+1);for(T.sort(rl),x=T.length,h=[],v=0;v<x;++v)b=T[v],0!==v&&Zo(b.theta,C.theta,3)&&Zo(b.rho,C.rho,M)||(b._segments=el(b,t,e,n,r,c,f).map(function(t){return t._line=b,t}),h.push(b)),C=b;for(x=h.length,m=[],v=0;v<x;++v)for(b=h[v],y=v+1;y<x;++y)N.abs(b.theta-(C=h[y]).theta)<=3&&m.push([b,C,(b.theta+C.theta)/2]);for(x=m.length,null!=u&&(_=180-(g=(u+360)%180)),p=[],v=0;v<x;++v)for(b=m[v],y=v+1;y<x;++y)d=N.abs(b[2]-(C=m[y])[2]),(null==u||N.abs(d-g)<=3||N.abs(d-_)<=3)&&(w=nl(b[0],C[0]),A=nl(b[0],C[1]),S=nl(b[1],C[0]),R=nl(b[1],C[1]),D=tl(b[0],C[0],w,5),I=tl(b[0],C[1],A,5),E=tl(b[1],C[0],S,5),L=tl(b[1],C[1],R,5),D)&&I&&E&&L&&D[0]===I[0]&&D[1]===E[1]&&E[0]===L[0]&&I[1]===L[1]&&(E={shape:90===u?"rectangle":"parallelogram",x0:(D=[w,A,S,R].sort(function(o){return function(t,e){var n=t.x-o.x,r=e.x-o.x,i=t.y-o.y,a=e.y-o.y;return 0<=n&&r<0?1:n<0&&0<=r?-1:0==n&&0==r?0<=i||0<=a?e.y-t.y:t.y-e.y:(t=n*a-r*i)<0?-1:0<t?1:r*r+a*a-(n*n+i*i)}}({x:(w.x+A.x+S.x+R.x)/4,y:(w.y+A.y+S.y+R.y)/4})))[0].x,y0:D[0].y,x1:D[1].x,y1:D[1].y,x2:D[2].x,y2:D[2].y,x3:D[3].x,y3:D[3].y},90!==u&&(E.angle=null==u?d:N.min(g,_)),p.push(E));return p}function $o(t,e,n,r,i,a,o,l,s,u){if(!s||!s.length)return[];var c,f,h,m,p,d,g,_=ta(t,e,n,0,r,i,a,o,l),x=_.length,v=o-i+1,t=l-a+1,y=v*t,b=s.length,C=N.ceil(N.max(60,2*u)),e=Ko(C,function(t){return 360*t/C}),w=new na(b*y),A=new ra(C),S=new ra(C),R=new Array(C);for(Qo(A,S,e),c=0;c<b;++c){M=T=E=D=L=I=void 0;for(var I=R,L=A,D=S,E=s[c],T=0,M=L.length;T<M;++T)I[T]={x:E*D[T],y:E*L[T]};for(f=0;f<x;++f)for(h=_[f].x,m=_[f].y,p=0;p<C;++p)d=N.round(h-R[p].x),g=N.round(m-R[p].y),i<=d&&d<=o&&a<=g&&g<=l&&++w[c*y+(g-a)*v+(d-i)]}return ea([],w,u,b,t,v).map(function(t){return{shape:"circle",cx:t%v+i,cy:N.floor(t%y/v)+a,r:s[N.floor(t/y)]}})}function qo(t,e,n,r,i,a,o,l,s,u,c,f,h){if(null==s&&(s=10),(u=null==u?N.max(o-i+1,l-a+1)>>>1:u)<s)return[];if(null==c&&(c=3),(f=null==f?u:N.min(u,f))<c)return[];for(var m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L,D,E=ta(t,e,n,0,r,i,a,o,l),T=f-c+1,M=new na(T),G=new Array(T),F=[],O=0;O<E.length;++O)if(!E[O].u)for(g=E[O].x,_=E[O].y,p=0;p<O;++p)if(!(E[p].u||(x=E[p].x,v=E[p].y,(R=Qi(C=g-x,w=_-v)/2)<s)||u<R)){for(y=(g+x)/2,b=(_+v)/2,Jo(M,0),Jo(G,null),d=0,m=E.length;d<m;++d)E[d].u||d===O||d===p||(I=E[d].x,S=E[d].y,A=Qi(I-y,S-b),R<=A)||(S=(R*R+A*A-(I=I-g)*I-(I=S-_)*I)/(2*R*A),S*=S,I=N.round(N.sqrt(R*R*A*A*(1-S)/(R*R-A*A*S))),c<=I&&I<=f&&(++M[I-=c],G[I]||(G[I]=[]),G[I].push(d)));(D=ea([],M,h,T,null,null)).length&&(E[O].u=1,E[p].u=1,y=N.round(y),b=N.round(b),R=N.round(R),L=N.round(180*N.atan2(w,C)/N.PI),F.push.apply(F,D.map(function(t){return G[t].forEach(function(t){E[t].u=1}),{shape:"ellipse",cx:y,cy:b,rx:R,ry:t+c,angle:L}})))}return F}function Vo(t){return+t||0}function Ko(t,e){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r);return n}function Zo(t,e,n){return N.abs(t-e)<=(n||0)}function Jo(t,e){for(var n=0,r=t.length;n<r;++n)t[n]=e}function Qo(t,e,n){for(var r=0,i=n.length;r<i;++r)t[r]=N.sin(n[r]*Ji),e[r]=N.cos(n[r]*Ji)}function tl(t,e,n,o){function r(t,e,n,r,i,a){return Zo(t,n,o)&&Zo(e,r,o)&&Zo(t,i,o)&&Zo(e,a,o)}var i,a,l,s,u=t._segments,c=e._segments,f=u.length,h=c.length;if(n)for(i=0;i<f;++i)for(a=u[i],l=0;l<h;++l)if(s=c[l],r(n.x,n.y,a.x0,a.y0,s.x0,s.y0)||r(n.x,n.y,a.x0,a.y0,s.x1,s.y1)||r(n.x,n.y,a.x1,a.y1,s.x0,s.y0)||r(n.x,n.y,a.x1,a.y1,s.x1,s.y1))return[i,l]}function el(t,e,n,r,i,a,o){var l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S=i,R=n*i,I=[],L=4===i?3:0,D=4===i?2:0,E=t.x1-t.x0,T=t.y1-t.y0;if(N.abs(E)>=N.abs(T))for(d=p=0,m=t.x1>=t.x0?1:-1,l=f=t.x0,s=h=t.y0;f!==t.x1;f+=m)(0<=(h=N.round(T*(f-t.x0)/E)+t.y0)&&h<r?(g=h*n+f<<D,y=f+1<n?g+S:g,v=0<=f-1?g-S:g,_=0<=h-1?g-R:g,x=h+1<r?g+R:g,C=f+1<n&&0<=h-1?g+S-R:g,b=0<=f-1&&0<=h-1?g-S-R:g,A=f+1<n&&h+1<r?g+S+R:g,w=0<=f-1&&h+1<r?g-S+R:g,e[g]&&e[g+L]||e[v]&&e[v+L]||e[y]&&e[y+L]||e[_]&&e[_+L]||e[x]&&e[x+L]||e[b]&&e[b+L]||e[C]&&e[C+L]||e[w]&&e[w+L]||e[A]&&e[A+L]):0)?(++p,d=0,u=f,c=h):o<++d&&(a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:l,y0:s,x1:u,y1:c}),p=0,l=f,s=h);else for(d=p=0,m=t.y1>=t.y0?1:-1,l=f=t.x0,s=h=t.y0;h!==t.y1;h+=m)(0<=(f=N.round(E*(h-t.y0)/T)+t.x0)&&f<n?(g=h*n+f<<D,y=f+1<n?g+S:g,v=0<=f-1?g-S:g,_=0<=h-1?g-R:g,x=h+1<r?g+R:g,C=f+1<n&&0<=h-1?g+S-R:g,b=0<=f-1&&0<=h-1?g-S-R:g,A=f+1<n&&h+1<r?g+S+R:g,w=0<=f-1&&h+1<r?g-S+R:g,e[g]&&e[g+L]||e[v]&&e[v+L]||e[y]&&e[y+L]||e[_]&&e[_+L]||e[x]&&e[x+L]||e[b]&&e[b+L]||e[C]&&e[C+L]||e[w]&&e[w+L]||e[A]&&e[A+L]):0)?(++p,d=0,u=f,c=h):o<++d&&(a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:l,y0:s,x1:u,y1:c}),p=0,l=f,s=h);return a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:l,y0:s,x1:u,y1:c}),I}function nl(t,e){var n={x:t.x0,y:t.y0},t={x:t.x1,y:t.y1},r={x:e.x0,y:e.y0},e={x:e.x1,y:e.y1},i=n.x,a=t.x,n=n.y,t=t.y,o=r.x,l=e.x,r=r.y,e=e.y,s=i*t-n*a,u=o*e-r*l,c=(i-a)*(r-e)-(n-t)*(o-l);return!!c&&{x:N.round((s*(o-l)-(i-a)*u)/c),y:N.round((s*(r-e)-(n-t)*u)/c)}}function rl(t,e){return t.theta-e.theta||t.rho-e.rho}return Qa.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:Qa.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,posX:0,posY:1,angle:0,radius:0,mode:to.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,posX:t.posX,posY:t.posY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.posX=t.posX,e.posY=t.posY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&oo.call(Za,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},twirl:function(t,e,n,r){var i=this;return i.angle=t||0,i.radius=e||0,i.centerX=n||0,i.centerY=r||0,i.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},polar:function(t,e,n,r){var i=this;return i.centerX=t||0,i.centerY=e||0,i.posX=n||0,i.posY=r||0,i.set("polar")},cartesian:function(t,e,n,r){return this.centerX=t||0,this.centerY=e||0,this.posX=n||0,this.posY=r||0,this.set("cartesian")},set:function(t,e){var n=this;return t&&oo.call(Za,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Za[n._mapName],n._mapInit=Za["init__"+n._mapName],n._apply=so(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=so(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){return this._mapName=null,this._map=null,this._mapInit=null,this._mapChanged=!1,this._glsl=null,this},getGLSL:function(){var t=this,e=new lo.Filter(t).begin().shader(t._map?["varying vec2 pix;","uniform sampler2D img;","#define TWOPI  6.283185307179586","#define IGNORE "+to.IGNORE,"#define CLAMP "+to.CLAMP,"#define COLOR "+to.COLOR,"#define WRAP "+to.WRAP,"uniform int mode;","uniform int swap;","uniform vec2 size;","uniform vec2 center;","uniform float angle;","uniform float radius;","uniform float radius2;","uniform float AMAX;","uniform float RMAX;","uniform vec4 color;","uniform int mapping;",Ja.twirl,Ja.sphere,Ja.polar,Ja.cartesian,oo.call(Ja,t._mapName)||!t._map.shader?"vec2 map(vec2 pix) {return pix;}":t._map.shader.toString(),"void main(void) {","vec2 p = pix;","if (1 == mapping)      p = twirl(pix, center, radius, angle, size);","else if (2 == mapping) p = sphere(pix, center, radius2, size);","else if (3 == mapping) p = polar(pix, center, RMAX, AMAX, size, swap);","else if (4 == mapping) p = cartesian(pix, center, RMAX, AMAX, size, swap);","else                   p = map(pix);","if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","if (COLOR == mode) {gl_FragColor = color;}","else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","else if (WRAP == mode) {","if (0.0 > p.x) p.x += 1.0;","if (1.0 < p.x) p.x -= 1.0;","if (0.0 > p.y) p.y += 1.0;","if (1.0 < p.y) p.y -= 1.0;","gl_FragColor = texture2D(img, p);","}","else {gl_FragColor = texture2D(img, pix);}","} else {","gl_FragColor = texture2D(img, p);","}","}"].join("\n"):lo.DEFAULT).input("size",function(t,e,n){return[e,n]}).input("center",function(t){return[t.centerX,t.centerY]}).input("angle",function(t){return t.angle}).input("radius",function(t){return t.radius}).input("radius2",function(t){return t.radius*t.radius}).input("AMAX",function(t){return io}).input("RMAX",function(t,e,n){var r=t.centerX,t=t.centerY,e=(e-1)*(e-1),n=(n-1)*(n-1);return ro(no(e*+r*+r+n*+t*+t),no(e*(r-1)*(r-1)+n*+t*+t),no(e*+r*+r+n*(t-1)*(t-1)),no(e*(r-1)*(r-1)+n*(t-1)*(t-1)))}).input("swap",function(t){return t.posX===ao?1:0}).input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("mapping",function(t){return"twirl"===t._mapName?1:"sphere"===t._mapName?2:"polar"===t._mapName?3:"cartesian"===t._mapName?4:0});return t._map.shader&&t._map.inputs&&t._map.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e.end().code()},canRun:function(){return this._isOn&&this._map}}),Za={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }",polar:"function() {        if (px === Y)        {            r = rMax*t[1]/H;            a = aMax*t[0]/W;            t[1] = round(r*cos(a) + cy);            t[0] = round(r*sin(a) + cx);        }        else        {            r = rMax*t[0]/W;            a = aMax*t[1]/H;            t[0] = round(r*cos(a) + cx);            t[1] = round(r*sin(a) + cy);        }    }",init__polar:"function() {        var sqrt = Math.sqrt, sin = Math.sin, cos = Math.cos,            floor = Math.floor, round = Math.round, max = Math.max,            W = w-1, H = h-1, Y = 1,            cx = self.centerX*W, cy = self.centerY*H,            px = self.posX, py = self.posY,            aMax = 6.283185307179586,            rMax = round(max(            sqrt((cx - 0) * (cx - 0) + (cy - 0) * (cy - 0)),            sqrt((cx - W) * (cx - W) + (cy - 0) * (cy - 0)),            sqrt((cx - 0) * (cx - 0) + (cy - H) * (cy - H)),            sqrt((cx - W) * (cx - W) + (cy - H) * (cy - H))            )), r, a        ;    }",cartesian:"function() {        if (px === Y)        {            ty = t[0] - cx;            tx = t[1] - cy;        }        else        {            tx = t[0] - cx;            ty = t[1] - cy;        }        r = sqrt(tx*tx + ty*ty);        a = atan(ty, tx);        if (0 > a) a += 6.283185307179586;        if (px === Y)        {            t[1] = round(H*r/rMax);            t[0] = round(W*a/aMax);        }        else        {            t[0] = round(W*r/rMax);            t[1] = round(H*a/aMax);        }    }",init__cartesian:"function() {        var sqrt = Math.sqrt, atan = Math.atan2,            floor = Math.floor, round = Math.round, max = Math.max,            W = w-1, H = h-1, Y = 1,            cx = self.centerX*W, cy = self.centerY*H,            px = self.posX, py = self.posY,            aMax = 6.283185307179586,            rMax = round(max(            sqrt((cx - 0) * (cx - 0) + (cy - 0) * (cy - 0)),            sqrt((cx - W) * (cx - W) + (cy - 0) * (cy - 0)),            sqrt((cx - 0) * (cx - 0) + (cy - H) * (cy - H)),            sqrt((cx - W) * (cx - W) + (cy - H) * (cy - H))            )), r, a, tx, ty        ;    }"},Ja={twirl:["vec2 twirl(vec2 pix, vec2 center, float R, float angle, vec2 size) {","vec2 T = size*(pix - center);","float D = length(T);","if (D < R) {","float theta = atan(T.y, T.x) + (R-D)*angle/R;","pix = (size*center + vec2(D*cos(theta),  D*sin(theta)))/size;","}","return pix;","}"].join("\n"),sphere:["vec2 sphere(vec2 pix, vec2 center, float R2, vec2 size) {","vec2 T = size*(pix - center);","float TX2 = T.x*T.x; float TY2 = T.y*T.y;","float D2 = TX2 + TY2;","if (D2 < R2) {","D2 = R2 - D2;","float D = sqrt(D2);","float thetax = asin(T.x / sqrt(TX2 + D2)) * (1.0-0.555556);","float thetay = asin(T.y / sqrt(TY2 + D2)) * (1.0-0.555556);","pix = pix - vec2(D * tan(thetax), D * tan(thetay))/size;","}","return pix;","}"].join("\n"),polar:["vec2 polar(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","float r = 0.0;","float a = 0.0;","/*pix *= size;*/","if (1 == swap) {","r = pix.y*rMax;","a = pix.x*aMax;","return (size*center + vec2(r*sin(a), r*cos(a)))/size;","} else {","r = pix.x*rMax;","a = pix.y*aMax;","return (size*center + vec2(r*cos(a), r*sin(a)))/size;","}","}"].join("\n"),cartesian:["vec2 cartesian(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","vec2 xy = size* (pix - center);","float r = 0.0;","float a = 0.0;","if (1 == swap) {","xy = xy.yx;","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(a/aMax, r/rMax);","} else {","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(r/rMax, a/aMax);","}","}"].join("\n")},xn=(i=A).MODE,vn=i.ConvolutionMatrix,yn=i.ImArray,i.Array32F,bn=i.Array16I,i.Array8U,Cn=i.Util.Filter,wn=Cn.cm_convolve,An=Cn.cm_combine,Sn=Cn.gaussian,Rn=i.Util.Array.typed,In=i._notSupportClamp,Ln=i.Util.GLSL,(Dn=Math).SQRT2,En=i.CONST.toRad,i.CONST.toDeg,Tn=Dn.abs,Mn=Dn.sqrt,Gn=Dn.sin,Fn=Dn.cos,On=Dn.min,Nn=Dn.max,Hn=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(i=i.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,r){var i;this._coeff=new vn([1,0]),t&&t.length&&(i=Mn(t.length)+.5|0,this.set(t,i,i,e||1,n||0)),this.mode=r||xn.RGB},path:i.Path,dimx:0,dimy:0,dimx2:0,dimy2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_doIntegralSeparable:null,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_w:null,mode:xn.RGB,dispose:function(){var t=this;return t.dimx=t.dimy=null,t.dimx2=t.dimy2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._doIntegralSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._w=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dimx:t.dimx,dimy:t.dimy,dimx2:t.dimx2,dimy2:t.dimy2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_w:t._w}},unserialize:function(t){var e=this;return e.dimx=t.dimx,e.dimy=t.dimy,e.dimx2=t.dimx2,e.dimy2=t.dimy2,e.matrix=Rn(t.matrix,vn),e.matrix2=Rn(t.matrix2,vn),e._mat=Rn(t._mat,vn),e._mat2=Rn(t._mat2,vn),e._coeff=Rn(t._coeff,vn),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=Rn(t._indices,bn),e._indices2=Rn(t._indices2,bn),e._indicesf=Rn(t._indicesf,bn),e._indicesf2=Rn(t._indicesf2,bn),e._w=t._w?[Rn(t._w[0],vn),+t._w[1],+t._w[2],+t._w[3]]:null,e},functional:function(t,e,n){return e=null==e?3:1&e?e:e+1,n?(this.set(mo(e,1,t),e,1,1,1,1,e,mo(1,e,t)),this._doSeparable=!0):this.set(mo(e,e,t),e,e,1,0),this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set(_o(e=null==e?3:1&e?e:e+1),e,e,1/(e*e),0),this._doIntegralSeparable=[co(e),e,1,1/e,0,co(e),1,e,1/e,0],this._doIntegral=t,this},gauss:function(t,e){return this.set(Sn(e=null==e?3:1&e?e:e+1,1,t),e,1,1,1,1,e,Sn(1,e,t)),this._doSeparable=!0,this},lowPass:function(t){return this.set(_o(t=null==t?3:1&t?t:t+1),t,t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=null==e?1:e)/((t=null==t?3:1&t?t:t+1)*t);return this.set(_o(t,e,1+e),t,t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=null==t?.5:t))},sharpen:function(t,e){return this.highPass(e,t=null==t?.5:t)},verticalBlur:function(t){return this.set(co(t=null==t?3:1&t?t:t+1),1,t,1/t,0),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(co(t=null==t?3:1&t?t:t+1),t,1,1/t,0),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,r){var i,a,o,l,s,u=t*t,c=t>>1,f=u>>1,h=new vn(u),m=new vn(u),p=1/t;u=1e-8<Tn(e)?(s=1,n/e):(s=e/n,1);l=o=i=0,a=u*t;for(;i<=c;)m[f+i]=f+o+l+.5|0,m[f-i]=f-o-l+.5|0,++i,o+=s,l+=a;i=0;for(;i<=c;)h[m[f+i]]=h[m[f-i]]=p,++i;return h[f]=r||1,h}(e=null==e?3:1&e?e:e+1,Fn(t*=En),-Gn(t),1/e),e,e,1,0)},binomialLowPass:function(t){var e=ho(t=null==t?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,1,n,n,1,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=ho(t);return wn(t,t)}(t=null==t?3:1&t?t:t+1);return this.set(An(_o(t),e,1,-1/function(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n];return e}(e)),t,t,1,0)},prewittX:function(t){return this.set(fo(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,co(t)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(co(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,fo(t,1)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=En,this.set(An(go(e=null==e?3:1&e?e:e+1,0),go(e,1),Fn(t),Gn(t)),e,e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(go(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,go(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(fo(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,ho(t)),this._doSeparable=!0,this},sobelY:function(t){return this.set(ho(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,fo(t,1)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=En,this.set(An(po(e=null==e?3:1&e?e:e+1,0),po(e,1),Fn(t),Gn(t)),e,e,1,0)},sobel:function(t){return this.set(po(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,po(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set(_o(t=null==t?3:1&t?t:t+1,-1,t*t-1),t,t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=null==t?-.25*Dn.PI:t*En,this.set(function(t,e,n,r){var i,a,o,l,s,u=t*t,c=t>>>1,f=u>>>1,h=new vn(u);for(i=l=0;i<=c;++i,l+=e)for(o=s=a=0;o<=c;++o,a+=t,s+=n)h[f+i+a]=l+s,h[f-i-a]=-l-s,h[f-i+a]=-l+s,h[f+i-a]=l-s;return h[f]=r||1,h}(n=null==n?3:1&n?n:n+1,(e=e||1)*Fn(t),-e*Gn(t),1),n,n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,3,1,0)},bilateral:function(t,e,n){t=null==t?3:1&t?t:t+1;return this.set(_o(t),t,t,1,0),this._w=(n=n||1,[Sn(t,t,t=e||1),-1/(2*n*n),t,n]),this},set:function(t,e,n,r,i,a,o,l){var s=this;return s._isGrad=!1,s._doIntegral=0,s._doSeparable=!1,s._doIntegralSeparable=null,s.matrix2=null,s.dimx2=s.dimy2=0,s._indices2=s._indicesf2=null,s._mat2=s._w=null,s.matrix=new vn(t),null==n&&(n=e),s.dimx=e,s.dimy=n,null==r&&(r=1,i=0),s._coeff[0]=r,s._coeff[1]=i||0,t=uo(s.matrix,s.dimx,s.dimy),s._indices=t[0],s._indicesf=t[1],s._mat=t[2],l?(s.matrix2=new vn(l),s.dimx2=a,s.dimy2=o,t=uo(s.matrix2,s.dimx2,s.dimy2),s._indices2=t[0],s._indicesf2=t[1],s._mat2=t[2]):null!=a&&(s.dimx2=a,s.dimy2=o),s._glsl=null,s},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dimx=t.dimy=t.dimx2=t.dimy2=0,t._mat=t._mat2=t._w=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t._doIntegralSeparable=null,t._glsl=null,t},getGLSL:function(){var t=this;function e(t,e,n,r,i,a,o,l,s){var u,c,f,h=[],m=[],p=[],d=t.length,g=n>>>1,n=r>>>1;for(h.push("vec4 col=texture2D(img,  pix);"),c=-g,f=-n,u=0;u<d;)t[u]&&(h.push(c||f?"vec2 p"+u+"=vec2(pix.x"+_(c,1)+"*dp.x, pix.y"+_(f,1)+"*dp.y); vec3 c"+u+"=vec3(0.0); if (0.0 <= p"+u+".x && 1.0 >= p"+u+".x && 0.0 <= p"+u+".y && 1.0 >= p"+u+".y) c"+u+"=texture2D(img,  p"+u+").rgb;":"vec3 c"+u+"=col.rgb;"),m.push(_(t[u],m.length)+"*c"+u)),++u,g<++c&&(c=-g,++f);if(e){for(d=e.length,c=-(g=i>>>1),f=-(a>>>1),u=0;u<d;)e[u]&&(h.push(c||f?"vec2 pp"+u+"=vec2(pix.x"+_(c,1)+"*dp.x, pix.y"+_(f,1)+"*dp.y); vec3 cc"+u+"=vec3(0.0); if (0.0 <= pp"+u+".x && 1.0 >= pp"+u+".x && 0.0 <= pp"+u+".y && 1.0 >= pp"+u+".y) cc"+u+"=texture2D(img,  pp"+u+").rgb;":"vec3 cc"+u+"=col.rgb;"),p.push(_(e[u],p.length)+"*cc"+u)),++u,g<++c&&(c=-g,++f);return s?(h.push("vec3 o1="+_(o)+"*("+m.join("")+");"),h.push("vec3 o2="+_(o)+"*("+p.join("")+");"),[h.join("\n"),"vec4(sqrt(o1.x*o1.x+o2.x*o2.x),sqrt(o1.y*o1.y+o2.y*o2.y),sqrt(o1.z*o1.z+o2.z*o2.z),col.a)"]):(h.push("vec3 o1="+m.join("")+";"),h.push("vec3 o2="+p.join("")+";"),[h.join("\n"),"vec4(("+_(o)+"*o1"+_(l,1)+"*o2),col.a)"])}return[h.join("\n"),"vec4(("+_(o)+"*("+m.join("")+")+vec3("+_(l)+")),col.a)"]}var n,r,i,_=Ln.formatFloat,a=t.matrix,o=t.matrix2;return(a?t._w?(n=function(t){var e,n,r,i=[],a=[],o=t*t,l=t>>>1;for(i.push("vec4 col=texture2D(img,  pix);"),i.push("float f=0.0; float w; vec3 o=vec3(0.0);"),r=n=-l,e=0;e<o;)i.push(0===n&&0===r?"vec3 c"+e+"=col.rgb;":"vec2 p"+e+"=vec2(pix.x"+_(n,1)+"*dp.x, pix.y"+_(r,1)+"*dp.y); vec3 c"+e+"=col.rgb; if (0.0 <= p"+e+".x && 1.0 >= p"+e+".x && 0.0 <= p"+e+".y && 1.0 >= p"+e+".y) c"+e+"=texture2D(img,  p"+e+").rgb;"),a.push("float wS"+e+"=wS["+e+"]; float wC"+e+"=wC(c"+e+".x-c0.x,c"+e+".y-c0.y,c"+e+".z-c0.z); w = wS"+e+"*wC"+e+"; f += w; o += w*c"+e+";"),++e,l<++n&&(n=-l,++r);return[i.join("\n")+"\n"+a.join("\n"),"vec4(o/f,col.a)"]}(t.dimx),r=new Ln.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform float wS["+t.matrix.length+"];","uniform float fC;","float wC(float r, float g, float b) {return exp(fC*(r*r+g*g+b*b));}","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).input("wS",function(t){return t._w[0]}).input("fC",function(t){return 255*t._w[1]*255}).end()):(i=t._doIntegralSeparable)?(r=new Ln.Filter(t),n=e(i[0],null,i[1],i[2],i[1],i[2],i[3],i[4],!1),r.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end(),n=e(i[5],null,i[6],i[7],i[6],i[7],i[8],i[9],!1),r.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end(),r):t._doSeparable&&o?(r=new Ln.Filter(t),n=e(a,null,t.dimx,t.dimy,t.dimx,t.dimy,t._coeff[0],0,!1),r.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).end(),n=e(o,null,t.dimx2,t.dimy2,t.dimx2,t.dimy2,t._coeff[1],0,!1),r.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).end(),r):(n=e(a,o,t.dimx,t.dimy,t.dimx2,t.dimy2,t._coeff[0],t._coeff[1],t._isGrad),r=new Ln.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end()):new Ln.Filter(t).begin().shader(Ln.DEFAULT).end()).code()},combineWith:function(t){return t.matrix?this.matrix?this.set(wn(this.matrix,t.matrix),this.dimx*t.dimx,this.dimy*t.dimy,this._coeff[0]*t._coeff[0]):this.set(t.matrix,t.dimx,t.dimy,t._coeff[0],t._coeff[1]):this},_apply_weighted:function(t,e,n,r,i,a){for(var o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b=t.length,C=new yn(b),w=e-1,A=n-1,S=r>>>1,R=r*r,I=Dn.exp,L=(xn.GRAY,this.mode,0),D=0,E=0,T=0;T<b;T+=4,++L){for(e<=L&&(L=0,++D,E+=e),u=t[T],c=t[T+1],f=t[T+2],s=(l=o=-S)*e,x=g=d=p=y=0;x<R;++x,++o)S<o&&(o=-S,++l,s+=e),_=L+o<0||w<L+o||D+l<0||A<D+l?(h=u,m=c,f):(h=t[_=L+o+E+s<<2],m=t[1+_],t[2+_]),y+=v=i[x]*I(a*((v=h-u)*v+(v=m-c)*v+(v=_-f)*v)),p+=v*h,d+=v*m,g+=v*_;p/=y,d/=y,g/=y,In&&(p=p<0?0:255<p?255:p,d=d<0?0:255<d?255:d,g=g<0?0:255<g?255:g),C[T]=0|p,C[T+1]=0|d,C[T+2]=0|g,C[T+3]=t[T+3]}return C},_apply:function(t,e,N){var n=this,H=n.mode;if(!n.matrix)return t;if(n._w)return n._apply_weighted(t,e,N,n.dimx,n._w[0],n._w[1]);if(n._doIntegral)return n.matrix2?Cn.integral_convolution(H,t,e,N,2,n.matrix,n.matrix2,n.dimx,n.dimy,n.dimx2,n.dimy2,n._coeff[0],n._coeff[1],n._doIntegral):Cn.integral_convolution(H,t,e,N,2,n.matrix,null,n.dimx,n.dimy,n.dimx,n.dimy,n._coeff[0],n._coeff[1],n._doIntegral);if(n._doSeparable)return Cn.separable_convolution(H,t,e,N,2,n._mat,n._mat2,n._indices,n._indices2,n._coeff[0],n._coeff[1]);var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,U,w,A,S,B,R,I,Y,L=t.length,N=L>>>2,D=new yn(L),E=e-1,T=N-e,M=n._coeff[0],G=n._coeff[1],F=n._mat,O=n._mat2,z=n._isGrad;if(xn.GRAY===H)if(O){for(w=n._indices.length,S=new bn(n._indices),s=0;s<w;s+=2)S[s+1]*=e;for(A=F.length,B=n._indices2.length,I=new bn(n._indices2),s=0;s<B;s+=2)I[s+1]*=e;for(R=O.length,c=u=0,Y=Nn(A,R),o=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=x=v=y=b=0;s<Y;++s,l+=2)s<A&&(m=u+S[l],p=c+S[l+1],0<=m)&&m<=E&&0<=p&&p<=T&&(C=F[s],g+=t[d=m+p<<2]*C),s<R&&(m=u+I[l],p=c+I[l+1],0<=m)&&m<=E&&0<=p&&p<=T&&(C=O[s],v+=t[d=m+p<<2]*C);r=z?(g=Tn(g),v=Tn(v),(h=Nn(g,v))?h*(1+.43*(f=On(g,v))/h*f/h):0):M*g+G*v,D[o]=0|(r=In?r<0?0:255<r?255:r:r),D[o+1]=0|r,D[o+2]=0|r,D[o+3]=t[o+3]}}else{for(w=n._indices.length,S=new bn(n._indices),s=0;s<w;s+=2)S[s+1]*=e;for(A=F.length,o=c=u=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=x=0;s<A;++s,l+=2)m=u+S[l],p=c+S[l+1],m<0||E<m||p<0||T<p||(C=F[s],g+=t[d=m+p<<2]*C);r=M*g+G,D[o]=0|(r=In?r<0?0:255<r?255:r:r),D[o+1]=0|r,D[o+2]=0|r,D[o+3]=t[o+3]}}else if(O){for(w=n._indices.length,S=new bn(n._indices),s=0;s<w;s+=2)S[s+1]*=e;for(A=F.length,B=n._indices2.length,I=new bn(n._indices2),s=0;s<B;s+=2)I[s+1]*=e;for(R=O.length,c=u=0,Y=Nn(A,R),o=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=x=v=y=b=0;s<Y;++s,l+=2)s<A&&(m=u+S[l],p=c+S[l+1],0<=m)&&m<=E&&0<=p&&p<=T&&(C=F[s],g+=t[d=m+p<<2]*C,_+=t[d+1]*C,x+=t[d+2]*C),s<R&&(m=u+I[l],p=c+I[l+1],0<=m)&&m<=E&&0<=p&&p<=T&&(U=O[s],v+=t[d=m+p<<2]*U,y+=t[d+1]*U,b+=t[d+2]*U);a=z?(g=Tn(g),v=Tn(v),r=(h=Nn(g,v))?h*(1+.43*(f=On(g,v))/h*f/h):0,_=Tn(_),y=Tn(y),i=(h=Nn(_,y))?h*(1+.43*(f=On(_,y))/h*f/h):0,x=Tn(x),b=Tn(b),(h=Nn(x,b))?h*(1+.43*(f=On(x,b))/h*f/h):0):(r=M*g+G*v,i=M*_+G*y,M*x+G*b),In&&(r=r<0?0:255<r?255:r,i=i<0?0:255<i?255:i,a=a<0?0:255<a?255:a),D[o]=0|r,D[o+1]=0|i,D[o+2]=0|a,D[o+3]=t[o+3]}}else{for(w=n._indices.length,S=new bn(n._indices),s=0;s<w;s+=2)S[s+1]*=e;for(A=F.length,o=c=u=0;o<L;o+=4,u++){for(e<=u&&(u=0,c+=e),l=s=g=_=x=0;s<A;s++,l+=2)m=u+S[l],p=c+S[l+1],m<0||E<m||p<0||T<p||(C=F[s],g+=t[d=m+p<<2]*C,_+=t[d+1]*C,x+=t[d+2]*C);r=M*g+G,i=M*_+G,a=M*x+G,In&&(r=r<0?0:255<r?255:r,i=i<0?0:255<i?255:i,a=a<0?0:255<a?255:a),D[o]=0|r,D[o+1]=0|i,D[o+2]=0|a,D[o+3]=t[o+3]}}return D}})).prototype.gradX=i.prototype.prewittX,i.prototype.gradY=i.prototype.prewittY,i.prototype.gradDirectional=i.prototype.prewittDirectional,i.prototype.grad=i.prototype.prewitt,i.prototype.bump=i.prototype.emboss,i.prototype.boxBlur=i.prototype.lowPass,i.prototype.gaussBlur=i.prototype.gauss,Yn=(Un=A).MODE,zn=Un.ImArray,kn=Un.Util.Array.copy,Pn=Un.Util.GLSL,jn=Un.Array8U,Xn=Un.Array32I,Wn=Math.sqrt,$n=Un.Util.Array.typed,Un.Util.Filter.primitive_morphology_operator,qn=xo(3),Un.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=Yn.RGB},path:Un.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:Yn.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){return{_filterName:this._filterName,_dim:this._dim,_dim2:this._dim2,_iter:this._iter,_structureElement:this._structureElement,_indices:this._indices,_structureElement2:this._structureElement2,_indices2:this._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=$n(t._structureElement,jn),e._indices=$n(t._indices,Xn),e._structureElement2=$n(t._structureElement2,jn),e._indices2=$n(t._indices2,Xn),e._filterName=t._filterName,e._filterName&&Bn[e._filterName]&&(e._filter=Bn[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,r){var i=this,a=(i._dim2=0,i._structureElement2=null,i._indices2=null,i._iter=0|r||1,i._filterName=t,i._filter=Bn[t],e&&e.length?(i._structureElement=new jn(e),i._dim=Wn(i._structureElement.length)+.5|0):e&&e===+e?(i._structureElement=xo(e),i._dim=e):(i._structureElement=qn,i._dim=3),n&&n.length?(i._structureElement2=new jn(n),i._dim2=Wn(i._structureElement2.length)+.5|0):n&&n===+n&&(i._structureElement2=xo(n),i._dim2=n),[]),o=(e=i._structureElement).length,l=(f=i._dim)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));if(i._indices=new Xn(a),i._structureElement2){var s,u,c,f,a=[],o=(e=i._structureElement2).length,l=(f=i._dim2)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));i._indices2=new Xn(a)}return i._glsl=null,i},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t._glsl=null,t},getGLSL:function(){var e=this;function n(t,e,n,r,i){var a,o,l,s,u,c=Pn.formatFloat,f=[],h=!1,m=t.length,p=e,d=p>>>1;for(f.push("int apply=1;"),f.push("vec4 res=vec4("+r+");"),f.push("float alpha=1.0;"),l=o=a=0,i=i||"img";l<m;)s=a-d,u=o-d,t[l]&&(f.push("if (1==apply){vec2 p"+l+"=vec2(pix.x"+c(s,1)+"*dp.x, pix.y"+c(u,1)+"*dp.y); vec4 c"+l+"=vec4(0.0); if (0.0 <= p"+l+".x && 1.0 >= p"+l+".x && 0.0 <= p"+l+".y && 1.0 >= p"+l+".y) {c"+l+"=texture2D("+i+",p"+l+");} else {apply=0;} res="+n+"(res, c"+l+");"+(0==s&&0==u?" alpha=c"+l+".a;":"")+"}"),0==s)&&0==u&&(h=!0),++l,p<=++a&&(a=0,++o);return f.push("if (1==apply) {"+(h?"":"alpha = texture2D("+i+",pix).a; ")+"gl_FragColor = vec4(res.rgb,alpha);} else {gl_FragColor = texture2D("+i+",pix);}"),f.join("\n")}function t(t){r.shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {","dilate"===t?n(e._structureElement,e._dim,"max","0.0","img"):n(e._structureElement,e._dim,"min","1.0","img"),"}"].join("\n"),e._iter||1)}var r=new Pn.Filter(e);if(!e._dim)return r.begin().shader(Pn.DEFAULT).end().code();switch(e._filterName){case"dilate":r.begin(),t("dilate"),r.end();break;case"erode":r.begin(),t("erode"),r.end();break;case"open":r.begin(),t("erode"),r.end(),r.begin(),t("dilate"),r.end();break;case"close":r.begin(),t("dilate"),r.end(),r.begin(),t("erode"),r.end();break;case"gradient":r.begin(),t("dilate"),r.save("image"),r.output("dilated"),r.end(),r.begin(),t("erode"),r.input("image",null,"img"),r.end(),r.begin(),r.shader(["varying vec2 pix;","uniform sampler2D eroded;","uniform sampler2D dilated;","void main(void) {","vec4 erode = texture2D(eroded, pix);","vec4 dilate = texture2D(dilated, pix);","gl_FragColor = vec4(((dilate-erode)*0.5).rgb, erode.a);","}"].join("\n")),r.input("eroded",!0),r.input("dilated"),r.end();break;case"laplacian":r.begin(),t("dilate"),r.save("image"),r.output("dilated"),r.end(),r.begin(),t("erode"),r.input("image",null,"img"),r.end(),r.begin(),r.shader(["varying vec2 pix;","uniform sampler2D eroded;","uniform sampler2D dilated;","uniform sampler2D image;","void main(void) {","vec4 erode = texture2D(eroded, pix);","vec4 dilate = texture2D(dilated, pix);","vec4 im = texture2D(image, pix);","gl_FragColor = vec4(((dilate+erode-2.0*im)*0.5).rgb, im.a);","}"].join("\n")),r.input("eroded",!0),r.input("dilated"),r.input("image"),r.end()}return r.code()},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),Un.Util.Filter.primitive_morphology_operator=vo,Bn={dilate:function(t,e,n,r){for(var i=null,a=new zn(e.length),o=(t._runWASM?vo.wasm:vo)||vo,l=t._indices,s=l.length,u=new Xn(s),c=0;c<s;c+=2)u[c]=l[c],u[c+1]=l[c+1]*n;if(t._indices2)for(s=(l=t._indices2).length,i=new Xn(s),c=0;c<s;c+=2)i[c]=l[c],i[c+1]=l[c+1]*n;return o(t.mode,e,a,n,r,2,u,i,Math.max,0,t._iter)},erode:function(t,e,n,r){for(var i=null,a=new zn(e.length),o=(t._runWASM?vo.wasm:vo)||vo,l=t._indices,s=l.length,u=new Xn(s),c=0;c<s;c+=2)u[c]=l[c],u[c+1]=l[c+1]*n;if(t._indices2)for(s=(l=t._indices2).length,i=new Xn(s),c=0;c<s;c+=2)i[c]=l[c],i[c+1]=l[c+1]*n;return o(t.mode,e,a,n,r,2,u,i,Math.min,255,t._iter)},open:function(t,e,n,r){for(var i=null,a=new zn(e.length),o=(t._runWASM?vo.wasm:vo)||vo,l=t._indices,s=l.length,u=new Xn(s),c=0;c<s;c+=2)u[c]=l[c],u[c+1]=l[c+1]*n;if(t._indices2)for(s=(l=t._indices2).length,i=new Xn(s),c=0;c<s;c+=2)i[c]=l[c],i[c+1]=l[c+1]*n;var f=e;return e=o(t.mode,e,a,n,r,2,u,i,Math.min,255,t._iter),o(t.mode,e,f,n,r,2,u,i,Math.max,0,t._iter)},close:function(t,e,n,r){for(var i=null,a=new zn(e.length),o=(t._runWASM?vo.wasm:vo)||vo,l=t._indices,s=l.length,u=new Xn(coverArea2),c=0;c<s;c+=2)u[c]=l[c],u[c+1]=l[c+1]*n;if(t._indices2)for(s=(l=t._indices2).length,i=new Xn(s),c=0;c<s;c+=2)i[c]=l[c],i[c+1]=l[c+1]*n;var f=e;return e=o(t.mode,e,a,n,r,2,u,i,Math.max,0,t._iter),o(t.mode,e,f,n,r,2,u,i,Math.min,255,t._iter)},gradient:function(t,e,n,r){for(var i,a=null,o=e.length,l=new zn(o),s=(t._runWASM?vo.wasm:vo)||vo,u=t._indices,c=u.length,f=new Xn(c),h=0;h<c;h+=2)f[h]=u[h],f[h+1]=u[h+1]*n;if(t._indices2)for(c=(u=t._indices2).length,a=new Xn(c),h=0;h<c;h+=2)a[h]=u[h],a[h+1]=u[h+1]*n;for(i=kn(e),l=s(t.mode,i,l,n,r,2,f,a,Math.max,0,t._iter),i=s(t.mode,e,i,n,r,2,f,a,Math.min,255,t._iter),h=0;h<o;h+=4)l[h]=(l[h]-i[h])/2|0,l[h+1]=(l[h+1]-i[h+1])/2|0,l[h+2]=(l[h+2]-i[h+2])/2|0;return l},laplacian:function(t,e,n,r){for(var i,a=null,o=e.length,l=new zn(o),s=new zn(o),u=(t._runWASM?vo.wasm:vo)||vo,c=t._indices,f=c.length,h=new Xn(f),m=0;m<f;m+=2)h[m]=c[m],h[m+1]=c[m+1]*n;if(t._indices2)for(f=(c=t._indices2).length,a=new Xn(f),m=0;m<f;m+=2)a[m]=c[m],a[m+1]=c[m+1]*n;for(i=kn(e),s=u(t.mode,i,s,n,r,2,h,a,Math.max,0,t._iter),i=kn(e),l=u(t.mode,i,l,n,r,2,h,a,Math.min,255,t._iter),m=0;m<o;m+=4)l[m]=(l[m]+s[m]-2*e[m])/2|0,l[m+1]=(l[m+1]+s[m+1]-2*e[m+1])/2|0,l[m+2]=(l[m+2]+s[m+2]-2*e[m+2])/2|0;return l}},Kn=(b=A).MODE,Zn=b.ImArray,Jn=b.Array32I,Qn=b.Array32U,tr=b.Util.GLSL,er=b.Util.Array.typed,nr=Math,rr=nr.min,ir=nr.max,(b=b.Create({name:"StatisticalFilter",init:function(){this.d=0,this.k=0,this._gray=!1,this._filter=null,this._indices=null,this.mode=Kn.RGB},path:b.Path,d:0,k:0,_filter:null,_indices:null,mode:Kn.RGB,dispose:function(){return this.d=null,this.k=null,this._filter=null,this._indices=null,this.$super("dispose"),this},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){return this.d=t.d,this.k=t.k,this._filter=t._filter,this._indices=er(t._indices,Jn),this},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){this.d=t=t||0,this.k=e=rr(1,ir(0,e||0)),this._filter=0===e?"0th":1===e?"1th":"kth";for(var n=t*t<<1,r=t>>>1,i=new Jn(n),a=0,o=0,l=0;l<n;l+=2,++a)t<=a&&(a=0,++o),i[l]=a-r,i[l+1]=o-r;return this._indices=i,this._glsl=null,this},reset:function(){return this.d=0,this.k=0,this._filter=null,this._indices=null,this._glsl=null,this},getGLSL:function(){return e=this,d=tr.formatFloat,g=tr.staticSort,n=new tr.Filter(e),(e.d?n.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform int isColored;","void main(void) {","1th"===e._filter?t(e.d,"max","0.0"):"0th"===e._filter?t(e.d,"min","1.0"):function(t,e){for(var n,r,i=[],a=[],o=[],l=[],s="c0",u=t*t,c=t,f=c>>>1,h=0,m=0,p=0;p<u;)r=m-f,i.push("vec2 p"+p+"=vec2(pix.x"+d(n=h-f,1)+"*dp.x, pix.y"+d(r,1)+"*dp.y); vec4 c"+p+"=vec4(0.0); if (0.0 <= p"+p+".x && 1.0 >= p"+p+".x && 0.0 <= p"+p+".y && 1.0 >= p"+p+".y) c"+p+"=texture2D(img,  p"+p+"); float c"+p+"r=c"+p+".r; float c"+p+"g=c"+p+".g; float c"+p+"b=c"+p+".b;"),a.push("c"+p+"r"),o.push("c"+p+"g"),l.push("c"+p+"b"),0==n&&0==r&&(s="c"+p+".a"),++p,c<=++h&&(h=0,++m);return i.push("float t=0.0;"),i.push(g(a,"t").join("\n")),i.push("if (1==isColored) {"),i.push(g(o,"t").join("\n")),i.push(g(l,"t").join("\n")),i.push("}"),i.push("float rkth=c"+nr.round(e*(u-1))+"r;"),i.push("float gkth=rkth;"),i.push("float bkth=rkth;"),i.push("if (1==isColored) {"),i.push("gkth=c"+nr.round(e*(u-1))+"g;"),i.push("bkth=c"+nr.round(e*(u-1))+"b;"),i.push("}"),i.push("gl_FragColor = vec4(rkth,gkth,bkth,"+s+");"),i.join("\n")}(e.d,e.k),"}"].join("\n")).input("isColored",function(t){return Kn.GRAY!==t.mode?1:0}):n.begin().shader(tr.DEFAULT)).end().code();function t(t,e,n){var r,i,a,o,l,s=[],u=t*t,c=t,f=c>>>1;for(s.push("int apply=1;"),s.push("vec4 res=vec4("+n+");"),s.push("float alpha=1.0;"),a=i=r=0;a<u;)l=i-f,s.push("if (1==apply){vec2 p"+a+"=vec2(pix.x"+d(o=r-f,1)+"*dp.x, pix.y"+d(l,1)+"*dp.y); vec4 c"+a+"=vec4(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) {c"+a+"=texture2D(img,p"+a+");} else {apply=0;} res="+e+"(res, c"+a+");"+(0==o&&0==l?" alpha=c"+a+".a;":"")+"}"),++a,c<=++r&&(r=0,++i);return s.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D(img,pix);"),s.join("\n")}var e,d,g,n},_apply:function(t,e,n){return this.d?"0th"===this._filter||"1th"===this._filter?Vn["01th"](this,t,e,n):Vn[this._filter](this,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=b.prototype.minimum,b.prototype.dilate=b.prototype.maximum,Vn={"01th":function(t,e,n,r){t.d;for(var i,a,o,l,s,u,c,f,h,m,p,d,g,_=e.length,x=_>>>2,v=new Zn(_),y=n-1,b=x-n,C=t._indices,w=C.length,A=new Jn(w),S="0th"===t._filter?(g=rr,255):(g=ir,0),R=0;R<w;R+=2)A[R]=C[R],A[R+1]=C[R+1]*n;if(Kn.GRAY===t.mode)for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),p=S,R=0;R<w;R+=2)l=a+A[R],s=o+A[R+1],l<0||y<l||s<0||b<s||(p=g(e[u=l+s<<2],p));v[i]=p,v[i+1]=p,v[i+2]=p,v[i+3]=e[i+3]}else for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),m=p=d=S,R=0;R<w;R+=2)l=a+A[R],s=o+A[R+1],l<0||y<l||s<0||b<s||(c=e[u=l+s<<2],f=e[u+1],h=e[u+2],m=g(c,m),p=g(f,p),d=g(h,d));v[i]=m,v[i+1]=p,v[i+2]=d,v[i+3]=e[i+3]}return v},kth:function(t,e,n,N){t.d;for(var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R=t.k,I=e.length,L=I>>>2,D=new Zn(I),E=n-1,T=L-n,M=t._indices,G=M.length,L=G>>>1,F=new Jn(G),O=0;O<G;O+=2)F[O]=M[O],F[O+1]=M[O+1]*n;if(Kn.GRAY===t.mode)for(g=new Zn(L),C=new Qn(256),a=i=r=0;r<I;r+=4,++i){for(n<=i&&(i=0,a+=n),O=v=A=0;O<G;O+=2)o=i+F[O],l=a+F[O+1],o<0||E<o||l<0||T<l||(++A,++C[c=e[s=o+l<<2]],1===C[c]&&yo(g,v++,c));for(A*=R,S=0,m=-1,O=v;0<O;--O)S+=C[c=bo(g,O)],m<(C[c]=0)&&A<=S&&(m=c);D[r]=m,D[r+1]=m,D[r+2]=m,D[r+3]=e[r+3]}else for(d=new Zn(L),g=new Zn(L),_=new Zn(L),b=new Qn(256),C=new Qn(256),w=new Qn(256),a=i=r=0;r<I;r+=4,++i){for(n<=i&&(i=0,a+=n),O=x=v=y=A=0;O<G;O+=2)o=i+F[O],l=a+F[O+1],o<0||E<o||l<0||T<l||(u=e[s=o+l<<2],c=e[s+1],f=e[s+2],++b[u],++C[c],++w[f],++A,1===b[u]&&yo(d,x++,u),1===C[c]&&yo(g,v++,c),1===w[f]&&yo(_,y++,f));for(A*=R,S=0,h=-1,O=x;0<O;--O)S+=b[u=bo(d,O)],h<(b[u]=0)&&A<=S&&(h=u);for(S=0,m=-1,O=v;0<O;--O)S+=C[c=bo(g,O)],m<(C[c]=0)&&A<=S&&(m=c);for(S=0,p=-1,O=y;0<O;--O)S+=w[f=bo(_,O)],p<(w[f]=0)&&A<=S&&(p=f);D[r]=h,D[r+1]=m,D[r+2]=p,D[r+3]=e[r+3]}return D}},or=(ar=A).Util.GLSL,lr=Object.prototype.hasOwnProperty,ar.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:ar.Path,_filter:null,_params:null,_changed:!1,dispose:function(){return this._filter=null,this._params=null,this._changed=null,this.$super("dispose"),this},serialize:function(){var t={_filter:!1!==this._filter&&(this._changed&&this._filter?(this._filter.filter||this._filter).toString():null),_params:this._params};return this._changed=!1,t},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(ar)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)lr.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},getParam:function(t){if(t&&lr.call(this._params,t))return this._params[t]},setParam:function(t,e){return t&&lr.call(this._params,t)&&(this._params[t]=e),this},set:function(t,e){return!1===t?(this._filter=!1,this._changed=!0,this._glsl=null):(!t||"function"!=typeof t&&"function"!=typeof t.filter||(this._filter=t,this._changed=!0,this._glsl=null),e&&this.params(e)),this},isGLSL:function(){return this._isGLSL&&!(this._filter&&!this._filter.shader)},getGLSL:function(){var e,t=this._filter;return(t&&t.shader?(e=new or.Filter(this).begin().shader(t.shader),t.inputs&&t.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e):new or.Filter(this).begin().shader(t?null:or.DEFAULT)).end().code()},_apply:function(t,e,n,r){var i=this._filter;return i?(i="function"==typeof i.filter?i.filter:i)(this._params,t,e,n,r):t},canRun:function(){return this._isOn&&this._filter}}),ar.CustomFilter=ar.InlineFilter,ur=(sr=A).MODE,cr=sr.Array32F,fr=sr.Util.Filter.fft2d,hr=sr.Util.Filter.ifft2d,sr.Create({name:"FrequencyFilter",init:function(t,e,n){this.set(t,e,n)},path:sr.Path,_filterE:null,_filterG:null,_filterB:null,_changed:!1,dispose:function(){return this._filterR=null,this._filterG=null,this._filterB=null,this._changed=null,this.$super("dispose"),this},serialize:function(){var t=this,e={_filterR:!1!==t._filterR&&(t._changed&&t._filterR?t._filterR.toString():null),_filterG:!1!==t._filterG&&(t._changed&&t._filterG?t._filterG.toString():null),_filterB:!1!==t._filterB&&(t._changed&&t._filterB?t._filterB.toString():null)};return t._changed=!1,e},unserialize:function(t){return null!=t._filterR&&(this._filterR=!1===t._filterR?null:new Function("FILTER",'"use strict"; return '+t._filterR+";")(sr)),null!=t._filterG&&(this._filterG=!1===t._filterG?null:new Function("FILTER",'"use strict"; return '+t._filterG+";")(sr)),null!=t._filterB&&(this._filterB=!1===t._filterB?null:new Function("FILTER",'"use strict"; return '+t._filterB+";")(sr)),this},set:function(t,e,n){return!1===t?(this._filterR=!1,this._changed=!0):t&&"function"==typeof t&&(this._filterR=t,this._changed=!0),!1===e?this._filterG=!1:e&&"function"==typeof e&&(this._filterG=e),!1===n?this._filterG=!1:n&&"function"==typeof n&&(this._filterB=n),this},_apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m,p,d=ur.GRAY===this.mode,g=this._filterR,_=this._filterG,x=this._filterB,v=e*n,y=t.length;if(g||_||x){for(g&&(r=new cr(v),o=new cr(v)),_&&!d&&(i=new cr(v),l=new cr(v)),x&&!d&&(a=new cr(v),s=new cr(v)),m=h=0;h<y;h+=4,++m)g&&(r[m]=t[h]/255),_&&!d&&(i[m]=t[h+1]/255),x&&!d&&(a[m]=t[h+2]/255);if(g&&(u=wo(fr(r,o,e,n),g,e,n),u=hr(u.r,u.i,e,n).r),_&&!d&&(c=wo(fr(i,l,e,n),_,e,n),c=hr(c.r,c.i,e,n).r),x&&!d&&(f=wo(fr(a,s,e,n),x,e,n),f=hr(f.r,f.i,e,n).r),d)for(u=u||c||f,m=h=0;h<y;h+=4,++m)p=255*u[m]|0,t[h]=p,t[h+1]=p,t[h+2]=p;else for(m=h=0;h<y;h+=4,++m)u&&(p=255*u[m]|0,t[h]=p),c&&(p=255*c[m]|0,t[h+1]=p),f&&(p=255*f[m]|0,t[h+2]=p)}return t},canRun:function(){return this._isOn&&(this._filterR||this._filterG||this._filterB)}}),sr.FourierFilter=sr.FrequencyFilter,mr=A._notSupportClamp,(pr=A.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:A.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f=pr.random,h=this.max-this.min,m=this.min,p=t.length;if(mr)for(r=0;r<p;r+=4)a=t[r],o=t[r+1],l=t[r+2],(s=a+(i=h*f()+m))<0?s=0:255<s&&(s=255),(u=o+i)<0?u=0:255<u&&(u=255),(c=l+i)<0?c=0:255<c&&(c=255),t[r]=0|s,t[r+1]=0|u,t[r+2]=0|c;else for(r=0;r<p;r+=4)a=t[r],o=t[r+1],l=t[r+2],u=o+(i=h*f()+m),c=l+i,t[r]=0|(s=a+i),t[r+1]=0|u,t[r+2]=0|c;return t}})).random=Math.random,dr=(C=A).MODE,C.Create({name:"PerlinNoiseFilter",mode:dr.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:C.Path,init:function(t,e,n,r,i,a,o,l){this.mode=dr.GRAY,this._baseX=t||1,this._baseY=e||1,this._seed=o||0,this._stitch=!!r,this._fractal=!1!==i,this._perlin=!!l,this.octaves(n||1,a)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){for(this._octaves=t||1,this._offsets=e?e.slice(0):[];this._offsets.length<this._octaves;)this._offsets.push([0,0]);return this},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?dr.COLOR:dr.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){return{_baseX:this._baseX,_baseY:this._baseY,_octaves:this._octaves,_offsets:this._offsets,_seed:this._seed||0,_stitch:this._stitch,_fractal:this._fractal,_perlin:this._perlin}},unserialize:function(t){return this._baseX=t._baseX,this._baseY=t._baseY,this._octaves=t._octaves,this._offsets=t._offsets,this._seed=t._seed||0,this._stitch=t._stitch,this._fractal=t._fractal,this._perlin=t._perlin,this},apply:function(t,e,n){var r=this;return r._seed&&(To.seed(r._seed),r._seed=0),To(t,e,n,r._stitch,dr.COLOR!==r.mode,r._baseX,r._baseY,r._octaves,r._offsets,1,.5,r._perlin)}}),w=Math,gr=w.floor,w.sin,w.cos,C.CONST.PI2,w=C.Array8U,_r=new w([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),xr=new w(_r),To.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=gr(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?_r[n]^255&t:_r[n]^t>>8&255,xr[n]=xr[n+256]=e},t=Math,vr=t.min,yr=t.floor,br=A.Util.GLSL,wr=A.MODE,A.Create({name:"ChannelCopyFilter",srcChannel:(Cr=A.CHANNEL).R,dstChannel:Cr.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:A.Path,init:function(t,e,n,r,i){this.srcChannel=t||Cr.R,this.dstChannel=e||Cr.R,this.centerX=n||0,this.centerY=r||0,this.color=i||0},dispose:function(){return this.srcChannel=null,this.dstChannel=null,this.centerX=null,this.centerY=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{srcChannel:this.srcChannel,dstChannel:this.dstChannel,centerX:this.centerX,centerY:this.centerY,color:this.color}},unserialize:function(t){return this.srcChannel=t.srcChannel,this.dstChannel=t.dstChannel,this.centerX=t.centerX,this.centerY=t.centerY,this.color=t.color,this},getGLSL:function(){return((t=this).input("source")?new br.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D src;","uniform vec2 srcSize;","uniform vec2 center;","uniform vec4 color;","uniform int sC;","uniform int tC;","#define COLOR32 "+wr.COLOR32,"#define COLOR8 "+wr.COLOR8,"#define MASK32 "+wr.COLORMASK32,"#define MASK8 "+wr.COLORMASK8,"#define RED "+Cr.R,"#define GREEN "+Cr.G,"#define BLUE "+Cr.B,"#define ALPHA "+Cr.A,"uniform int mode;","float get_channel(vec4 col, int channel) {","   if (ALPHA == channel) return col.a;","   if (BLUE == channel) return col.b;","   if (GREEN == channel) return col.g;","   if (RED == channel) return col.r;","   return 0.0;","}","vec4 set_channel(vec4 col, float val, int channel) {","   vec4 ret = vec4(col.r, col.g, col.b, col.a);","   if (ALPHA == channel) ret.a = val;","   else if (BLUE == channel) ret.b = val;","   else if (GREEN == channel) ret.g = val;","   else if (RED == channel) ret.r = val;","   return ret;","}","void main(void) {","   vec4 tCol = texture2D(img, pix);","   vec2 p = (pix - (center - 0.5*srcSize))/srcSize;","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (MASK32 == mode) {tCol *= color;}","       else if (COLOR32 == mode) {tCol = color;}","       else if (MASK8 == mode) {","           if (ALPHA == tC) tCol.a *= color.a;","           else if (BLUE == tC) tCol.b *= color.b;","           else if (GREEN == tC) tCol.g *= color.g;","           else tCol.r *= color.r;","       }","       else if (COLOR8 == mode) {","           if (ALPHA == tC) tCol.a = color.a;","           else if (BLUE == tC) tCol.b = color.b;","           else if (GREEN == tC) tCol.g = color.g;","           else tCol.r = color.r;","       }","   } else {","       vec4 sCol = texture2D(src, p);","       tCol = set_channel(tCol, get_channel(sCol, sC), tC);","   }","   gl_FragColor = tCol;","}"].join("\n")).input("src",function(t){t=t.input("source");return{data:t[0],width:t[1],height:t[2]}}).input("srcSize",function(t,e,n){t=t.input("source");return[t[1]/e,t[2]/n]}).input("center",function(t){return[t.centerX,t.centerY]}).input("sC",function(t){return t.srcChannel}).input("tC",function(t){return t.dstChannel}).input("color",function(t){var e=t.color||0;return wr.COLOR8===t.mode||wr.MASK8===t.mode?[e=(255&e)/255,e,e,e]:[(e>>>16&255)/255,(e>>>8&255)/255,(255&e)/255,(e>>>24&255)/255]}):new br.Filter(t).begin().shader(br.DEFAULT)).end().code();var t},apply:function(t,e,n){var r=this.input("source");if(r){var i,a,o,l,s,u,c,f,h,m=r[0],p=r[1],d=r[2],g=t.length,_=(m.length,this.srcChannel),x=this.dstChannel,v=this.centerX||0,y=this.centerY||0,r=p>>>1,b=d>>>1,C=(vr(e,p),vr(n,d),this.color||0),w=this.mode,A=wr.COLOR32,S=wr.COLOR8,R=wr.COLORMASK32,I=wr.COLORMASK8;for(A===w||R===w?(h=C>>>24&255,u=C>>>16&255,c=C>>>8&255,f=255&C):S!==w&&I!==w||(C&=255),v=yr(v*(e-1))-r,y=yr(y*(n-1))-b,i=o=a=0;i<g;i+=4,++a)e<=a&&(a=0,++o),s=o-y,(l=a-v)<0||p<=l||s<0||d<=s?A===w?(t[i]=u,t[i+1]=c,t[i+2]=f,t[i+3]=h):R===w?(t[i]=u&t[i],t[i+1]=c&t[i+1],t[i+2]=f&t[i+2],t[i+3]=h&t[i+3]):S===w?t[i+x]=C:I===w&&(t[i+x]=C&t[i+_]):t[i+x]=m[(l+s*p<<2)+_]}return t}}),Ar=A,e=Math,Sr=Ar.Util.Math.hypot,Rr=e.sqrt,e.abs,Ir=e.min,Lr=e.max,Dr=e.floor,Er=e.ceil,Tr=Ar.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:Ar.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},getGLSL:function(){return t=this,e=Ar.Util.GLSL,(t.scale<=1||!t.pattern||!Tr[t.pattern]?new e.Filter(t).begin().shader(e.DEFAULT).end():new e.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 imgSize;","uniform float tileSize;","uniform int pixelate;",Tr.rectangular_glsl,Tr.triangular_glsl,Tr.rhomboidal_glsl,Tr.hexagonal_glsl,"void main(void) {","vec2 p = pix;","if (1 == pixelate) p = triangular(p, imgSize, tileSize);","else if (2 == pixelate) p = rhomboidal(p, imgSize, tileSize);","else if (3 == pixelate) p = hexagonal(p, imgSize, tileSize);","else p = rectangular(p, imgSize, tileSize);","gl_FragColor = vec4(texture2D(img, p).rgb, texture2D(img, pix).a);","}"].join("\n")).input("imgSize",function(t,e,n){return[e,n]}).input("tileSize",function(t,e,n){return Rr(e*n)*(t.scale||1)*.01}).input("pixelate",function(t){return"triangular"===t.pattern?1:"rhomboidal"===t.pattern?2:"hexagonal"===t.pattern?3:0}).end()).code();var t,e},apply:function(t,e,n){var r=this.pattern;return this.scale<=1||!r||!Tr[r]?t:(100<this.scale&&(this.scale=100),Tr[r](t,e,n,this.scale))}}).PATTERN={rectangular:function(t,e,n,r){for(var i,a,o,l,s,u,c=t.length,f=c>>>2,h=e-1,m=f-e,p=new Ar.ImArray(c),d=Rr(f)*r*.01|0,g=.5*d|0,_=g*e,x=i=a=o=l=0,v=0;v<c;v+=4)u=i-l,s=Lr(0,Ir(h,x-a+g)),u=Lr(0,Ir(m,u+_)),p[v]=t[s=s+u<<2],p[v+1]=t[1+s],p[v+2]=t[2+s],p[v+3]=t[v+3],++a,e<=++x&&(x=a=0,l+=e,i+=e,d<=++o)&&(l=o=0),d<=a&&(a=0);return p},triangular:function(t,e,n,r){for(var i,a,o,l,s,u,c=t.length,f=c>>>2,h=e-1,m=f-e,p=new Ar.ImArray(c),d=Rr(f)*r*.0125|0,g=.333*d|0,_=.666*d|0,x=(.5*d|0)*e,v=i=a=o=l=0,y=0;y<c;y+=4)s=v-a,u=i-l,s=d<a+o?Lr(0,Ir(h,s+_))+Lr(0,Ir(m,u+x))<<2:Lr(0,Ir(h,s+g))+Lr(0,Ir(m,u+x))<<2,p[y]=t[s],p[y+1]=t[s+1],p[y+2]=t[s+2],p[y+3]=t[y+3],++a,e<=++v&&(v=a=0,l+=e,i+=e,d<=++o)&&(l=o=0),d<=a&&(a=0);return p},rhomboidal:function(t,e,n,r){for(var i,a,o,l,s,u,c,f=t.length,h=f>>>2,m=e-1,p=h-e,d=new Ar.ImArray(f),g=Rr(h)*r*.007|0,_=2*g,x=g*e,v=i=a=o=l=0,y=0,b=0;b<f;b+=4)c=y?_<a+o?(s=Ir(m,v-a+g),i-l):g<a+g-o?(s=v-a,Lr(0,i-l-x)):(s=Lr(0,v-a-g),i-l):_<a+g-o?(s=Ir(m,v-a+g),Lr(0,i-l-x)):g<a+o?(s=v-a,i-l):(s=Lr(0,v-a-g),Lr(0,i-l-x)),u=Lr(0,Ir(m,s+g)),c=Lr(0,Ir(p,c+x)),d[b]=t[u=u+c<<2],d[b+1]=t[1+u],d[b+2]=t[2+u],d[b+3]=t[b+3],++a,e<=++v&&(v=a=0,l+=e,i+=e,g<=++o)&&(l=o=0,y=1-y),_<=a&&(a=0);return d},hexagonal:function(t,e,n,r){var i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A=t.length,S=A>>>2,R=e-1,I=S-e,L=new Ar.ImArray(A);for(r=Rr(S)*r*.01,i=a=o=0;i<A;i+=4)x=a/r,v=o/r,f=Dr(x-=.5*(v/=.866025404)),c=Dr(v),u=Er(x),h=Er(v),s=x+v-f-c<1?(l=f,c):(l=u,h),w=1-(y=u=u)-(b=c=c),d=1-(m=f=f)-(p=h=h),v=Sr((g=x)-l,(_=v)-s,(x=1-x-v)-(1-l-s)),y=Sr(g-y,_-b,x-w),b=Sr(g-m,_-p,x-d),w=v<y?v<b?(C=l,s):(C=f,h):y<b?(C=u,c):(C=f,h),C+=.5*w,w=.866025404*w*r,g=Lr(0,Ir(R,0|(C*=r)))+Lr(0,Ir(I,(0|w)*e))<<2,L[i]=t[g],L[i+1]=t[1+g],L[i+2]=t[2+g],L[i+3]=t[i+3],e<=++a&&(a=0,++o);return L},rectangular_glsl:["vec2 rectangular(vec2 p, vec2 imgsize, float tilesize) {","    return clamp((tilesize*floor(imgsize * p / tilesize) + 0.5*tilesize)/imgsize, 0.0, 1.0);","}"].join("\n"),triangular_glsl:["vec2 triangular(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 1.25;","   vec2 tile = tilesize*floor(imgsize * p / tilesize);","   vec2 t = mod(imgsize * p, tilesize);","   if (t.x+t.y > tilesize) return clamp((tile + vec2(0.66*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","   else return clamp((tile + vec2(0.33*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),rhomboidal_glsl:["vec2 rhomboidal(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 0.7;","   vec2 xy = imgsize * p;","   vec2 xyi = floor(xy / tilesize);","   vec2 tile = tilesize*xyi;","   vec2 s = vec2(mod(xy.x, 2.0*tilesize), mod(xy.y, tilesize));","   vec2 a;","   if (0.0 < mod(xyi.y, 2.0)) {","       if (s.x+s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y);","       } else if (s.x+tilesize-s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y-tilesize);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y);","       }","   } else {","       if (s.x+tilesize-s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y-tilesize);","       } else if (s.x+s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y-tilesize);","       }","   }","   a = vec2(clamp(a.x, 0.0, imgsize.x), clamp(a.y, 0.0, imgsize.y));","   return clamp((a + vec2(tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),hexagonal_glsl:["vec2 hexagonal(vec2 p, vec2 imgsize, float tilesize) {","    vec2 t = imgsize * p / tilesize;","    t.y /= 0.866025404;","    t.x -= t.y * 0.5;","    vec2 it = vec2(floor(t.x), floor(t.y));","    vec2 ct = vec2(ceil(t.x), ceil(t.y));","    vec2 a;","    if (t.x + t.y - it.x - it.y < 1.0) a = it;","    else a = ct;","    vec2 b = vec2(ct.x, it.y);","    vec2 c = vec2(it.x, ct.y);","    vec3 T = vec3(t.x, t.y, 1.0 - t.x - t.y);","    vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);","    vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);","    vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);","    float alen = length(T - A);","    float blen = length(T - B);","    float clen = length(T - C);","    vec2 ch;","    if (alen < blen) {","        if (alen < clen) ch = a;","        else ch = c;","    } else {","        if (blen < clen) ch = b;","        else ch = c;","    }","    ch.x += ch.y * 0.5;","    ch.y *= 0.866025404;","    ch *= tilesize / imgsize;","    return clamp(ch, 0.0, 1.0);","}"].join("\n")},Mr=A.MODE,Gr=A.Array32F,Fr=A.Color.clamp,Or=A.Color.intensity,A.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:Mr.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=Fr(null==e?.4:e,0,1),this.mode=n||Mr.GRAY},path:A.Path,threshold:function(t){return this.thresh=Fr(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y=t.length,b=new Gr(3*(y>>>2)),C=this.size,w=1/(C*C),A=255*this.thresh,S=Mr.RGB===this.mode,R=C*e,I=0,L=0,D=0;I<n;){if(s=u=c=0,S){for(l=o=a=0;o<C;)s+=t[r=D+L+a+l<<2]+b[i=3*(D+L+a+l)],u+=t[r+1]+b[i+1],c+=t[r+2]+b[i+2],++a>=C&&(a=0,++o,l+=e);m=A<Or(s*=w,u*=w,c*=w)?(f=0|s,h=0|u,0|c):h=f=0}else{for(l=o=a=0;o<C;)s+=t[r=D+L+a+l<<2]+b[i=3*(D+L+a+l)],++a>=C&&(a=0,++o,l+=e);m=h=f=A<s*w?255:0}if(p=t[r=D+L<<2]-f,d=t[r+1]-h,g=t[r+2]-m,D+C<e)for(_=7/16*p,x=7/16*d,v=7/16*g,a=C,l=o=0;o<C;)b[i=3*(D+L+a+l)]+=_,b[i+1]+=x,b[i+2]+=v,0<=++a&&(a=C,++o,l+=e);if(I+C<n&&C<D)for(_=3/16*p,x=3/16*d,v=3/16*g,a=-C,o=C,l=0;o<0;)b[i=3*(D+L+a+l)]+=_,b[i+1]+=x,b[i+2]+=v,0<=++a&&(a=-C,++o,l+=e);if(I+C<n)for(_=5/16*p,x=5/16*d,v=5/16*g,o=C,l=a=0;o<0;)b[i=3*(D+L+a+l)]+=_,b[i+1]+=x,b[i+2]+=v,++a>=C&&(a=0,++o,l+=e);if(I+C<n&&D+C<e)for(_=1/16*p,x=1/16*d,v=1/16*g,o=a=C,l=0;o<0;)b[i=3*(D+L+a+l)]+=_,b[i+1]+=x,b[i+2]+=v,0<=++a&&(a=C,++o,l+=e);for(l=o=a=0;o<C;)t[r=D+L+a+l<<2]=f,t[r+1]=h,t[r+2]=m,++a>=C&&(a=0,++o,l+=e);e<=(D+=C)&&(D=0,I+=C,L+=R)}return t}}),(Nr=Math).sqrt,Nr.exp,Hr=Nr.log,Ur=Nr.abs,Br=Nr.floor,Yr=A._notSupportClamp,zr=A.Array32F,A.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,r){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==r?10:r},path:A.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w=t.length,A=this.centerX||0,S=this.centerY||0,R=this.radius,I=this.amount;if(!(I<=0)){for(0,C=(r=w>>>2)-e,A=Br(A*(b=e-1)),S=Br(S*(n-1)),s=(e<<1)+e,i=new zr((r<<1)+r),f=a=o=l=f=c=u=0;f<e;++f,u+=4,c+=3)a+=t[u],o+=t[u+1],l+=t[u+2],i[c]=a,i[c+1]=o,i[c+2]=l;for(a=o=l=f=c=0,u=u=s+e;u<w;u+=4,c+=3,++f)e<=f&&(a=o=l=f=0),a+=t[u],o+=t[u+1],l+=t[u+2],i[c+s]=i[c]+a,i[c+s+1]=i[c+1]+o,i[c+s+2]=i[c+2]+l;for(u=m=h=f=0;u<w;u+=4,++f)e<=f&&(f=0,++h,m+=e),y=Ur(f-A),x=Ur(h-S),d=Nr.max(y,x),y=Nr.min(y,x),0<(y=R<(x=d?d*(1+.43*y/d*y/d):0)?0|Hr((x-R)*I):x/R+.5|0)&&(d=f+y,g=m+(x=y*e),(p=f-y)<0?p=0:b<d&&(d=b),(x=m-x)<0?x=0:C<g&&(g=C),x=(y=.25/(y*y))*(i[_=((_=d+g)<<1)+_]-i[d=((d=d+x)<<1)+d]-i[g=((g=p+g)<<1)+g]+i[p=((p=p+x)<<1)+p]),v=y*(i[_+1]-i[d+1]-i[g+1]+i[p+1]),y=y*(i[_+2]-i[d+2]-i[g+2]+i[p+2]),Yr&&(x=x<0?0:255<x?255:x,v=v<0?0:255<v?255:v,y=y<0?0:255<y?255:y),t[u]=0|x,t[u+1]=0|v,t[u+2]=0|y)}}return t}}),kr=(n=A).MODE,Pr=new n.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),jr=Math,Xr=n.ImArray,Wr=n.Util.Filter,$r=n.Util.Image,qr=n.Util.GLSL,n.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:n.Path,init:function(t,e,n,r,i,a,o){this.offsetX=t||0,this.offsetY=e||0,this.color=n||0,this.opacity=null==r?1:+r,this.quality=0|(i||1),this.pad=null==a||!!a,this.onlyShadow=!!o},dispose:function(){return this.offsetX=null,this.offsetY=null,this.color=null,this.opacity=null,this.quality=null,this.pad=null,this.onlyShadow=null,this.$super("dispose"),this},serialize:function(){return{offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,opacity:this.opacity,quality:this.quality,pad:this.pad,onlyShadow:this.onlyShadow}},unserialize:function(t){return this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.color=t.color,this.opacity=t.opacity,this.quality=t.quality,this.pad=t.pad,this.onlyShadow=t.onlyShadow,this},getGLSL:function(){return n=this,t=function(t,e,n,r,i){var a,o,l,s=[],u=[],c=t.length,f=e>>>1,e=n>>>1,h=qr.formatFloat;for(s.push("vec4 col=texture2D(img,  pix);"),o=-f,l=-e,a=0;a<c;)t[a]&&(s.push(o||l?"vec2 p"+a+"=vec2(pix.x"+h(o,1)+"*dp.x, pix.y"+h(l,1)+"*dp.y); vec3 c"+a+"=vec3(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) c"+a+"=texture2D(img,  p"+a+").rgb;":"vec3 c"+a+"=col.rgb;"),u.push(h(t[a],u.length)+"*c"+a)),++a,f<++o&&(o=-f,++l);return[s.join("\n"),"vec4(("+h(r||1)+"*("+u.join("")+")+vec3("+h(i||0)+")),col.a)"]}(Pr,3,3,1,0),new qr.Filter(n).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 wh;","uniform vec2 nwh;","uniform float pad_right;","uniform float pad_bot;","uniform float pad_left;","uniform float pad_top;",$r.glsl().pad,"void main(void) {","    gl_FragColor = pad(pix, img, wh, nwh, pad_right, pad_bot, pad_left, pad_top);","}"].join("\n"),function(){return n.pad?1:0}).dimensions(function(t,e){return[t+jr.abs(n.offsetX||0),e+jr.abs(n.offsetY||0)]}).input("wh",function(t,e,n,r,i){return[r,i]}).input("nwh",function(t,e,n,r,i){return[e,n]}).input("pad_right",function(t){return 0<(t.offsetX||0)&&t.offsetX||0}).input("pad_bot",function(t){return 0<(t.offsetY||0)&&t.offsetY||0}).input("pad_left",function(t){return(t.offsetX||0)<0?-(t.offsetX||0):0}).input("pad_top",function(t){return(t.offsetY||0)<0?-(t.offsetY||0):0}).end().begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec4 c;","void main(void) {","   vec4 im = texture2D(img, pix);","   gl_FragColor = im.a > 0.0 ? vec4(c.rgb, c.a*im.a) : vec4(0.0);","}"].join("\n")).save("image").input("c",function(t){var e=t.color||0;return[(e>>>16&255)/255,(e>>>8&255)/255,(255&e)/255,jr.min(jr.max(t.opacity,0),1)]}).end().begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",t[0],"gl_FragColor = "+t[1]+";","}"].join("\n"),function(){return jr.min(jr.max(n.quality,1),3)}).end().begin().shader(["varying vec2 pix;","uniform vec2 offset;","uniform int onlyShadow;","uniform sampler2D shadow;","uniform sampler2D image;","void main(void) {","   vec2 pixo = pix - offset;","   vec4 sh = pixo.x < 0.0 || pixo.y < 0.0 ? vec4(0.0) : texture2D(shadow, pixo);","   vec4 im = onlyShadow ? vec4(0.0) : texture2D(image, pix);","   if (1 == onlyShadow)","   {","       gl_FragColor = sh;","   }","   else","   {","       if ((1.0 == im.a) || (0.0 == sh.a)) gl_FragColor = im;","       else gl_FragColor = vec4(mix(im.rgb, sh.rgb, sh.a), im.a);","   }","}"].join("\n")).input("offset",function(t,e,n){return[(t.offsetX||0)/e,(t.offsetY||0)/n]}).input("onlyShadow",function(t){return t.onlyShadow?1:0}).input("shadow",!0).input("image").end().code();var n,t},apply:function(t,e,n){var r=this;if(r.hasMeta=!1,r._isOn){var i,a,o,l,s,u,c,f=jr.max,h=r.color||0,m=r.opacity,p=r.quality,d=r.pad,g=r.onlyShadow,_=r.offsetX||0,x=r.offsetY||0,v=t.length,y=v>>>2,b=v,C=e;if(0!==(m=1<(m=m<0?0:m)?1:m)){i=h>>>16&255,a=h>>>8&255,o=255&h,3<(p=p<=0?1:p)&&(p=3);for(var w,A,S=new Xr(b),R=0,I=0,L=0,D=0,E=0;L<b;L+=4,++D)C<=D&&(D=0,++E),0<(c=t[L+3])?(S[L]=i,S[L+1]=a,S[L+2]=o,S[L+3]=m*c|0,R=f(R,D),I=f(I,E)):(S[L]=0,S[L+1]=0,S[L+2]=0,S[L+3]=0);if(S=Wr.integral_convolution(i===a&&a===o?kr.GRAY:kr.RGB,S,e,n,2,Pr,null,3,3,1,0,p),R+=_,I+=x,d&&(e<=R||R<0||n<=I||I<0)?(h=R<0?-R:0,p=e<=R?R-e:0,w=I<0?-I:0,A=n<=I?I-n:0,t=g?new Xr((e+h+p)*(n+w+A)<<2):$r.pad(t,e,n,p,A,h,w),v=(y=(e+=h+p)*(n+=w+A))<<2,r.hasMeta=!0,r.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}):d&&g&&(t=new Xr(v)),x*=e,g)for(u=E=D=0;u<b;u+=4,++D)C<=D&&(D=0,E+=e),s=E+x,(l=D+_)<0||e<=l||s<0||y<=s||(t[L=l+s<<2]=S[u],t[L+1]=S[u+1],t[L+2]=S[u+2],t[L+3]=S[u+3]);else for(u=E=D=0;u<b;u+=4,++D)C<=D&&(D=0,E+=e),s=E+x,(l=D+_)<0||e<=l||s<0||y<=s||(c=t[(L=l+s<<2)+3],m=S[u+3],255!==c&&0!==m&&(i=t[L]+(S[u]-t[L])*(m/=255),a=t[L+1]+(S[u+1]-t[L+1])*m,o=t[L+2]+(S[u+2]-t[L+2])*m,t[L]=0|i,t[L+1]=0|a,t[L+2]=0|o))}}return t}}),Vr=A,Kr=Math,Zr=Vr.Util.GLSL,Jr=Vr.Util.Image,Vr.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:Vr.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},getGLSL:function(){return t=this,new Zr.Filter(t).begin().shader(["varying vec2 pix;","uniform vec2 wh;","uniform float NN;","uniform int masktype;","uniform sampler2D img;","/*uniform sampler2D diagonal;*/","vec4 mask(vec2 pix, vec2 wh, float NN, int masktype) {","   vec2 ij = vec2(pix.x, pix.y);","   float d = 0.0;","   if (ij.x > 0.5) ij.x = 1.0 - ij.x;","   if (ij.y > 0.5) ij.y = 1.0 - ij.y;","   if (0 == masktype) //RADIAL","   {","       d = 1.0 - length(wh*(vec2(0.5) - ij)) * 2.0 / NN;","   }","   else if (1 == masktype) //LINEAR 1","   {","       d = 1.0 - (ij.y < ij.x ? (0.5 - ij.y) : (0.5 - ij.x)) * 2.0;","   }","   else //if (2 == masktype) //LINEAR 2","   {","       d = 1.0 - (/*ij.y < ij.x ? length(wh*(vec2(1.0) - ij)) :*/ length(wh*(vec2(1.0) - ij))) / (1.13*NN);","   }","   return vec4(clamp(d, 0.003921569/*1/255*/, 1.0));","}","void main(void) {","   vec4 im = texture2D(img, pix);","   vec2 pixd = pix - vec2(0.5);","   if (pixd.x < 0.0) pixd.x += 1.0;","   if (pixd.y < 0.0) pixd.y += 1.0;","   vec2 pixm = pix + vec2(0.5);","   if (pixm.x > 1.0) pixm.x -= 1.0;","   if (pixm.y > 1.0) pixm.y -= 1.0;","   float a1 = mask(pix, wh, NN, masktype).a;","   float a2 = mask(pixm, wh, NN, masktype).a;","   gl_FragColor = vec4(mix(im.rgb, /*texture2D(diagonal, pix)*/texture2D(img, pixd).rgb, a2/(a1+a2)), im.a);","}"].join("\n")).input("wh",function(t,e,n){return[e,n]}).input("NN",function(t,e,n){return Kr.sqrt(e*n)}).input("masktype",function(t){return t.type}).end().code();var t},apply:function(t,e,n){(this._runWASM&&Jr.wasm||Jr).interpolate;for(var r,i,a,o,l,s=Kr.round(e/2),u=Kr.round(n/2),c=t.length,f=new Vr.ImArray(c),h=function(t,e,n,r,i){var a,o,l,s,u=e*n,c=new Vr.Array8U(u),f=Vr.Util.Math.hypot;if(0===t)for(s=Kr.sqrt(r*i),o=a=0;a<r;++o)i<=o&&(o=0,++a),l=~~((l=255-255/s*f(r-a,i-o))<1?1:255<l?255:l),c[a+o*e]=l,c[a+(n-1-o)*e]=l,c[e-1-a+o*e]=l,c[e-1-a+(n-1-o)*e]=l;else if(1===t)for(o=a=0;a<r;++o)i<=o&&(o=0,++a),l=~~((l=255-255*(o<a?(i-o)/i:(r-a)/r))<1?1:255<l?255:l),c[a+o*e]=l,c[a+(n-1-o)*e]=l,c[e-1-a+o*e]=l,c[e-1-a+(n-1-o)*e]=l;else for(s=Kr.sqrt(e*n),o=a=0;a<r;++o)i<=o&&(o=0,++a),l=~~((l=255-255/(1.13*s)*f(e-a,n-o))<1?1:255<l?255:l),c[a+o*e]=l,c[a+(n-1-o)*e]=l,c[e-1-a+o*e]=l,c[e-1-a+(n-1-o)*e]=l;return c}(this.type,e,n,s,u),m=0,p=0;m<n;++p)e<=p&&(p=0,++m),r=h[o=p+m*e],r/=a=r+(i=h[l=(p+s)%e+(m+u)%n*e]),f[o<<=2]=~~(r*t[o]+(i/=a)*t[l<<=2]),f[1+o]=~~(r*t[1+o]+i*t[1+l]),f[2+o]=~~(r*t[2+o]+i*t[2+l]),f[3+o]=t[3+o];return f}}),ti=(Qr=A).MODE,r=Math,S=Qr.Util.Filter,Qr.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:ti.COLOR,path:Qr.Path,init:function(t,e,n,r,i){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==r?1e-6:+r,this.border=null!=i?i||0:null,this.mode=ti.COLOR},serialize:function(){var t="function"==typeof this.color;return{isfunc:t,color:t?this.color.toString():this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return t.isfunc?this.color=new Function("FILTER","return "+t.color+";")(Qr):this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S,R,I,L=this.mode||ti.COLOR,D=this.color||0,E=this.border,T=null!=E,M=this.x||0,G=this.y||0,F=Qr.Color.RGB2HSV,N=Qr.Color.HSV2RGB,O="function"==typeof D;if(!(M<0||e<=M||G<0||n<=G)){if(O||(m=D>>>16&255,p=D>>>8&255,d=255&D),_=t[f=(M<<=2)+(G=G*e<<2)],x=t[f+1],v=t[f+2],C=0,w=1,T){if(T=E>>>8&255,y=255&E,_===(E=E>>>16&255)&&x===T&&v===y)return t;_=E,x=T,v=y,C=1,w=0}else if(ti.COLOR===L&&!O&&_===m&&x===p&&v===d)return t;if(S=(E=Go(t,e,0,2,Mo(_,x,v,C,w,255*(1<=this.tolerance?.999:this.tolerance)),0,M,G)).mask,ti.MASK===L||ti.COLORMASK===L)for(R=ti.MASK===L,f=i=a=r=0,h=t.length;f<h;f+=4,++r)e<=r&&(r=0,++a,i+=e),S[(c=r+i)>>>5]&1<<(31&c)?R&&(g=O&&(m=(I=D(r,a))[0],p=I[1],d=I[2],3<I.length)?I[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g):(t[f]=0,t[f+1]=0,t[f+2]=0);else if(ti.HUE===L)for(o=(A=E.box)[0]>>>2,l=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,b=new ri(3),r=o,a=(i=l)/e;i<=u;)S[(c=r+i)>>>5]&1<<(31&c)&&(b[0]=t[f=c<<2],b[1]=t[f+1],b[2]=t[f+2],F(b,0,1),I=O?D(r,a):D,b[0]=I,N(b,0,1),t[f]=0|b[0],t[f+1]=0|b[1],t[f+2]=0|b[2]),++r>s&&(r=o,++a,i+=e);else for(o=(A=E.box)[0]>>>2,l=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,r=o,a=(i=l)/e;i<=u;)S[(c=r+i)>>>5]&1<<(31&c)&&(f=c<<2,g=O&&(m=(I=D(r,a))[0],p=I[1],d=I[2],3<I.length)?I[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g),++r>s&&(r=o,++a,i+=e)}return t}}),Qr.FloodFillFilter=Qr.ColorFillFilter,Qr.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:ti.TILE,hasInputs:!0,path:Qr.Path,init:function(t,e,n,r,i,a,o){this.x=t||0,this.y=e||0,this.offsetX=r||0,this.offsetY=i||0,n&&this.setInput("pattern",n),this.tolerance=null==a?1e-6:+a,this.border=null!=o?o||0:null,this.mode=ti.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var r=this.x||0,i=this.y||0;if(!(r<0||e<=r||i<0||n<=i)&&(I=this.input("pattern"))){var a,o,l,s,u,c,f,h,m,p,d,g,_,x,v,y=this.mode||ti.TILE,b=this.border,C=I[0],w=I[1],A=I[2],S=this.offsetX||0,R=this.offsetY||0,I=t[u=(r<<=2)+(i=i*e<<2)],L=t[u+1],D=t[u+2],E=0,T=1;if(null!=b){if(_=b>>>8&255,a=255&b,I===(b=b>>>16&255)&&L===_&&D===a)return t;I=b,L=_,D=a,E=1,T=0}if(x=(b=Go(t,e,0,2,Mo(I,L,D,E,T,255*(1<=this.tolerance?.999:this.tolerance)),0,r,i)).mask,f=(_=b.box)[0]>>>2,h=_[1]>>>2,m=_[2]>>>2,p=_[3]>>>2,ti.STRETCH===y)for(d=w/(m-f+1),g=A/(p-h+e),o=f,l=h;l<=p;)x[(s=o+l)>>>5]&1<<(31&s)&&(t[u=s<<2]=C[c=(d*(o-f)|0)+(g*(l-h)|0)*w<<2],t[u+1]=C[c+1],t[u+2]=C[c+2]),++o>m&&(o=f,l+=e);else{for(;S<0;)S+=w;for(;R<0;)R+=A;for(m=m-f+1,l=o=0,v=h;v<=p;)x[(s=o+f+v)>>>5]&1<<(31&s)&&(t[u=s<<2]=C[c=(o+S)%w+(l+R)%A*w<<2],t[u+1]=C[c+1],t[u+2]=C[c+2]),++o>=m&&(o=0,v+=e,++l)}}return t}}),ei=Qr.Array32I,ni=Qr.Array32U,ri=Qr.Array32F,ii=Qr.Array8U,ai=r.ceil,oi=r.min,li=r.max,y=r.abs,S.dissimilarity_rgb=Mo,S.floodRegion=Go,ui=(si=A).MODE,ci=si.Array32F,fi=si.ImArray,i=si.Util.Filter,hi=Math,mi=hi.min,pi=hi.max,si.Util.Array.typed,si.Util.Array.typed_obj,di=hi.abs,gi=hi.cos,_i=si.CONST.toRad,si.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:ui.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,r){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!r,this.mode=ui.COLOR},path:si.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m=t.length,p=m>>>2,d=this.mode||ui.COLOR,g=this.color,_=mi(.999,pi(0,this.tolerance||0)),p=new ci(p);if(null!=g&&(ui.HUE===d||ui.COLORIZEHUE===d?g=gi(_i*g):ui.COLOR!==d&&ui.COLORIZE!==d||(g=1e4*((c=(g>>>16&255)/255)+(f=(g>>>8&255)/255)+(h=(255&g)/255))/3+1e3*(c+f)/2+100*(f+h)/2+10*(c+h)/2+c)),_=Fo(t,e,0,2,p,_,d),ui.COLORIZE!==d&&ui.COLORIZEHUE!==d)return Uo(t,e,n,2,p,this.connectivity,_,g,this.invert);for(r=Uo(new fi(m),e,n,2,p,this.connectivity,_,g,this.invert),l=new ci(256),s=new ci(256),u=new ci(256),o=new ci(256),i=0;i<m;i+=4)++o[a=r[i]],l[a]+=t[i],s[a]+=t[i+1],u[a]+=t[i+2];for(i=0;i<256;++i)o[i]&&(a=o[i],l[i]/=a,s[i]/=a,u[i]/=a);for(i=0;i<m;i+=4)a=r[i],t[i]=0|l[a],t[i+1]=0|s[a],t[i+2]=0|u[a];return t}}),Oo.prototype={constructor:Oo,id:0,root:null,x1:0,y1:0,x2:0,y2:0},i.dissimilarity_rgb_2=Fo,i.connectedComponents=Uo,xi=(b=A)._notSupportClamp,vi=b.CHANNEL,yi=b.MODE,C=b.Util.Filter,bi=C.histogram,Ci=C.match_histogram,wi=b.Util.Array.typed_obj,C=Math,Ai=C.min,Si=C.max,b.Create({name:"HistogramEqualizeFilter",path:b.Path,mode:yi.INTENSITY,channel:0,factor:0,range:null,init:function(t,e,n,r){this.mode=t||yi.INTENSITY,this.channel=e||0,this.range=[0,255],null!=n&&(this.factor=+n||0),r&&0<r.length&&0==(1&r.length)&&(this.range=r)},serialize:function(){return{channel:this.channel,factor:this.factor,range:this.range}},unserialize:function(t){return this.channel=t.channel,this.factor=t.factor,this.range=t.range,this},_apply_rgb:function(t,e,n){var r,i,a,o,l,s,u,c,f=this.factor||0,h=this.range,m=h[0]||0,p=h[1]||255,d=(null==h[2]?m:h[2])||0,g=(null==h[3]?p:h[3])||255,_=(null==h[4]?m:h[4])||0,x=(null==h[5]?p:h[5])||255,v=t.length,y=bi(t,vi.R,!0),b=bi(t,vi.G,!0),C=bi(t,vi.B,!0),f=1-Ai(Si(f,0),1),w=(y.max-y.min)/y.total,A=(b.max-b.min)/b.total,S=(C.max-C.min)/C.total;if(xi)for(c=0;c<v;c+=4)r=t[c],i=t[c+1],a=t[c+2],o=m<=r&&r<=p?f*((u=y.bin[r]*w)+y.min)+(1-f)*(y.max-u):r,l=(l=d<=i&&i<=g?f*((u=b.bin[i]*A)+b.min)+(1-f)*(b.max-u):i)<0?0:255<l?255:l,s=(s=_<=a&&a<=x?f*((u=C.bin[a]*S)+C.min)+(1-f)*(C.max-u):a)<0?0:255<s?255:s,t[c]=0|(o=o<0?0:255<o?255:o),t[c+1]=0|l,t[c+2]=0|s;else for(c=0;c<v;c+=4)r=t[c],i=t[c+1],a=t[c+2],o=m<=r&&r<=p?f*((u=y.bin[r]*w)+y.min)+(1-f)*(y.max-u):r,l=d<=i&&i<=g?f*((u=b.bin[i]*A)+b.min)+(1-f)*(b.max-u):i,s=_<=a&&a<=x?f*((u=C.bin[a]*S)+C.min)+(1-f)*(C.max-u):a,t[c]=0|o,t[c+1]=0|l,t[c+2]=0|s;return t},apply:function(t,e,n){if(yi.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,a,o,l,s,u,c,f,h,m=t.length,p=this.factor||0,d=this.channel||0,g=this.range[0]||0,_=this.range[1]||255,e=this.mode;if(yi.GRAY===e||yi.CHANNEL===e)c=bi(t,d,!0);else{for(f=0;f<m;f+=4)o=(o=0+.299*(r=t[f])+.587*(i=t[f+1])+.114*(a=t[f+2])|0)<0?0:255<o?255:o,l=(l=128-.168736*r-.331264*i+.5*a|0)<0?0:255<l?255:l,t[f]=s=(s=128+.5*r-.418688*i-.081312*a|0)<0?0:255<s?255:s,t[f+1]=o,t[f+2]=l;c=bi(t,vi.G,!0)}if(p=1-Ai(Si(p,0),1),u=(c.max-c.min)/c.total,xi)if(yi.GRAY===e)for(f=0;f<m;f+=4)r=(r=g<=(h=t[f+d])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)<0?0:255<r?255:r,t[f]=r|=0,t[f+1]=r,t[f+2]=r;else if(yi.CHANNEL===e)for(f=0;f<m;f+=4)r=g<=(h=t[f+d])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f+d]=0|(r=r<0?0:255<r?255:r);else for(f=0;f<m;f+=4)i=(i=(o=g<=(h=t[f+1])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128))<0?0:255<i?255:i,a=(a=o+1.772*(l-128))<0?0:255<a?255:a,t[f]=0|(r=(r=o+1.402*(s-128))<0?0:255<r?255:r),t[f+1]=0|i,t[f+2]=0|a;else if(yi.GRAY===e)for(f=0;f<m;f+=4)r=g<=(h=t[f+d])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f]=r,t[f+1]=r,t[f+2]=r;else if(yi.CHANNEL===e)for(f=0;f<m;f+=4)r=g<=(h=t[f+d])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f+d]=r;else for(f=0;f<m;f+=4)i=(o=g<=(h=t[f+1])&&h<=_?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128),a=o+1.772*(l-128),t[f]=0|(r=o+1.402*(s-128)),t[f+1]=0|i,t[f+2]=0|a;return t}}),b.Create({name:"HistogramMatchFilter",path:b.Path,mode:yi.INTENSITY,cdf:null,channel:0,range:null,init:function(t,e,n,r){this.mode=t||yi.INTENSITY,this.cdf=e,this.channel=n||0,this.range=[0,255],r&&0<r.length&&0==(1&r.length)&&(this.range=r)},serialize:function(){return{channel:this.channel,cdf:wi(this.cdf),range:this.range}},unserialize:function(t){return this.channel=t.channel,this.cdf=wi(t.cdf,1),this.range=t.range,this},_apply_rgb:function(t,e,n){for(var r,i,a,o=this.range,l=o[0]||0,s=o[1]||255,u=(null==o[2]?l:o[2])||0,c=(null==o[3]?s:o[3])||255,f=(null==o[4]?l:o[4])||0,h=(null==o[5]?s:o[5])||255,o=this.cdf,m=t.length,p=bi(t,vi.R,!0,!0),d=bi(t,vi.G,!0,!0),g=bi(t,vi.B,!0,!0),_=Ci(null,p.bin,o[0]),x=Ci(null,d.bin,o[1]),v=Ci(null,g.bin,o[2]),y=0;y<m;y+=4)r=t[y],i=t[y+1],a=t[y+2],l<=r&&r<=s&&(t[y]=_[r]),u<=i&&i<=c&&(t[y+1]=x[i]),f<=a&&a<=h&&(t[y+2]=v[a]);return t},apply:function(t,e,n){var r=this;if(yi.RGB===r.mode)return r._apply_rgb(t,e,n);var i,a,o,l,s,u,c,f,h,m,p=r.range[0]||0,d=r.range[1]||255,g=t.length,_=r.channel||0,e=r.mode;if(yi.GRAY===e||yi.CHANNEL===e)f=bi(t,_,!0,!0);else{for(h=0;h<g;h+=4)l=(l=0+.299*(i=t[h])+.587*(a=t[h+1])+.114*(o=t[h+2])|0)<0?0:255<l?255:l,s=(s=128-.168736*i-.331264*a+.5*o|0)<0?0:255<s?255:s,t[h]=u=(u=128+.5*i-.418688*a-.081312*o|0)<0?0:255<u?255:u,t[h+1]=l,t[h+2]=s;f=bi(t,vi.G,!0,!0),_=0}if(m=Ci(null,f.bin,r.cdf[_]&&r.cdf[_].length?r.cdf[_]:r.cdf),yi.GRAY===e)for(h=0;h<g;h+=4)p<=(c=t[h+_])&&c<=d&&(c=m[c],t[h]=c,t[h+1]=c,t[h+2]=c);else if(yi.CHANNEL===e)for(h=0;h<g;h+=4)p<=(c=t[h+_])&&c<=d&&(t[h+_]=m[c]);else for(h=0;h<g;h+=4)a=(a=(l=p<=(c=t[h+1])&&c<=d?m[c]:c)-.34414*((s=t[h+2])-128)-.71414*((u=t[h])-128))<0?0:255<a?255:a,o=(o=l+1.772*(s-128))<0?0:255<o?255:o,t[h]=0|(i=(i=l+1.402*(u-128))<0?0:255<i?255:i),t[h+1]=0|a,t[h+2]=0|o;return t}}),Ii=(Ri=A)._notSupportClamp,Li=Ri.CHANNEL,Di=Ri.MODE,Ri.Util.Array.typed,Ei=Ri.Util.Array.typed_obj,Ti=Ri.Util.Filter,Ri.Create({name:"OtsuThresholdFilter",path:Ri.Path,hasMeta:!0,mode:Di.INTENSITY,color0:0,color1:null,channel:0,nclasses:2,sigma:null,init:function(t,e,n,r,i,a){this.mode=t||Di.INTENSITY,this.color0=e||0,null!=n&&(this.color1=n),this.channel=r||0,null!=i&&(this.nclasses=+i||0),a&&a.length&&(this.sigma=a)},serialize:function(){return{color0:this.color0,color1:this.color1,channel:this.channel,nclasses:this.nclasses,sigma:this.sigma}},unserialize:function(t){return this.color0=t.color0,this.color1=t.color1,this.channel=t.channel,this.nclasses=t.nclasses,this.sigma=t.sigma,this},metaData:function(t){return t&&Ri.isWorker?Ei(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Ei(t,1):t,this},_apply_rgb:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,x=this.color0||0,v=x>>>16&255,y=x>>>8&255,b=255&x,C=this.color1,x=this.nclasses,w=this.sigma,A=t.length;if(null!=C&&(h=C>>>16&255,m=C>>>8&255,p=255&C),o=Ti.histogram(t,Li.R),l=Ti.histogram(t,Li.G),s=Ti.histogram(t,Li.B),w||2<x)for(f=w?(u=Ti.otsu_multi(o.bin,o.total,o.min,o.max,w[0]||0),c=Ti.otsu_multi(l.bin,l.total,l.min,l.max,w[1]||0),Ti.otsu_multi(s.bin,s.total,s.min,s.max,w[2]||0)):(u=Ti.otsu_multiclass(o.bin,o.total,o.min,o.max,x),c=Ti.otsu_multiclass(l.bin,l.total,l.min,l.max,x),Ti.otsu_multiclass(s.bin,s.total,s.min,s.max,x)),d=0;d<A;d+=4){for(r=t[d],g=0,_=u.length;g<_;++g)if(r<u[g]){t[d]=v+(h-v)*g/_|0;break}for(_<=g&&(t[d]=h),i=t[d+1],g=0,_=c.length;g<_;++g)if(i<c[g]){t[d+1]=y+(m-y)*g/_|0;break}for(_<=g&&(t[d+1]=m),a=t[d+2],g=0,_=f.length;g<_;++g)if(a<f[g]){t[d+2]=b+(p-b)*g/_|0;break}_<=g&&(t[d+2]=p)}else for(u=Ti.otsu(o.bin,o.total,o.min,o.max),c=Ti.otsu(l.bin,l.total,l.min,l.max),f=Ti.otsu(s.bin,s.total,s.min,s.max),d=0;d<A;d+=4)t[d]<u?t[d]=v:null!=C&&(t[d]=h),t[d+1]<c?t[d+1]=y:null!=C&&(t[d+1]=m),t[d+2]<f?t[d+2]=b:null!=C&&(t[d+2]=p);return this.meta=[u,c,f],t},apply:function(t,e,n){if(Di.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,a,o,l,s,u,c,f,h,m,p,d,g,e=this.color0||0,_=e>>>16&255,x=e>>>8&255,v=255&e,y=this.color1,b=t.length,C=this.channel||0,n=this.nclasses,e=this.sigma,w=this.mode;if(null!=y&&(u=y>>>16&255,c=y>>>8&255,f=255&y),Di.GRAY===w||Di.CHANNEL===w)h=Ti.histogram(t,C);else{for(m=0;m<b;m+=4)o=0+.299*(r=t[m])+.587*(i=t[m+1])+.114*(a=t[m+2]),l=128-.168736*r-.331264*i+.5*a,s=128+.5*r-.418688*i-.081312*a,Ii&&(s=s<0?0:255<s?255:s,o=o<0?0:255<o?255:o,l=l<0?0:255<l?255:l),t[m]=0|s,t[m+1]=0|o,t[m+2]=0|l;h=Ti.histogram(t,Li.G)}if(e||2<n)if(g=e?Ti.otsu_multi(h.bin,h.total,h.min,h.max,e[0]||0):Ti.otsu_multiclass(h.bin,h.total,h.min,h.max,n),Di.GRAY===w)for(m=0;m<b;m+=4){for(r=t[m+C],p=0,d=g.length;p<d;++p)if(r<g[p]){t[m]=_+(u-_)*p/d|0,t[m+1]=x+(c-x)*p/d|0,t[m+2]=v+(f-v)*p/d|0;break}d<=p&&(t[m]=u,t[m+1]=c,t[m+2]=f)}else if(Di.CHANNEL===w)for(m=0;m<b;m+=4){for(r=t[m+C],p=0,d=g.length;p<d;++p)if(r<g[p]){t[m+C]=2===C?v+(f-v)*p/d|0:1===C?x+(c-x)*p/d|0:_+(u-_)*p/d|0;break}d<=p&&(t[m+C]=2===C?f:1===C?c:u)}else for(m=0;m<b;m+=4){for(o=t[m+1],p=0,d=g.length;p<d;++p)if(o<g[p]){t[m]=_+(u-_)*p/d|0,t[m+1]=x+(c-x)*p/d|0,t[m+2]=v+(f-v)*p/d|0;break}d<=p&&(t[m]=u,t[m+1]=c,t[m+2]=f)}else if(g=Ti.otsu(h.bin,h.total,h.min,h.max),Di.GRAY===w)for(m=0;m<b;m+=4)t[m+C]<g?(t[m]=_,t[m+1]=x,t[m+2]=v):null!=y&&(t[m]=u,t[m+1]=c,t[m+2]=f);else if(Di.CHANNEL===w)for(m=0;m<b;m+=4)t[m+C]<g?t[m+C]=2===C?v:1===C?x:_:null!=y&&(t[m+C]=2===C?f:1===C?c:u);else for(m=0;m<b;m+=4)s=t[m],o=t[m+1],l=t[m+2],o<g?(t[m]=_,t[m+1]=x,t[m+2]=v):null!=y?(t[m]=u,t[m+1]=c,t[m+2]=f):(r=o+1.402*(s-128),i=o-.34414*(l-128)-.71414*(s-128),a=o+1.772*(l-128),Ii&&(r=r<0?0:255<r?255:r,i=i<0?0:255<i?255:i,a=a<0?0:255<a?255:a),t[m]=0|r,t[m+1]=0|i,t[m+2]=0|a);return this.meta=[g],t}}),(Mi=A).Create({name:"CannyEdgesFilter",low:25,high:75,lowpass:!0,path:Mi.Path,init:function(t,e,n){this.low=arguments.length<1?25:+t,this.high=arguments.length<2?75:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},getGLSL:function(){var t=this,e=Mi.Util.Filter.gradient_glsl(),n=new Mi.Util.GLSL.Filter(t);return t.lowpass&&n.begin().shader(["varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;",e.lowpass,"void main(void) {","    gl_FragColor = lowpass(img, pix, dp);","}"].join("\n")).end(),n.begin().shader(["#define MAGNITUDE_SCALE 1.0","#define MAGNITUDE_LIMIT 510.0","#define MAGNITUDE_MAX 510.0","varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;","uniform float low;","uniform float high;",e.gradient,"void main(void) {","    gl_FragColor = gradient(img, pix, dp, low, high, MAGNITUDE_SCALE, MAGNITUDE_LIMIT, MAGNITUDE_MAX);","}"].join("\n")).input("low",function(t){return+t.low/255}).input("high",function(t){return+t.high/255}).end().begin().shader(["varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;",e.hysteresis,"void main(void) {","    gl_FragColor = hysteresis(img, pix, dp);","}"].join("\n"),50).end(),n.code()},_apply:function(t,e,n){return(this._runWASM&&Mi.Util.Filter.wasm||Mi.Util.Filter).gradient(t,e,n,2,0,this.lowpass?1:0,0,+this.low,+this.high,1,510,510)}}),Gi=A,(w=Math).abs,yt=w.max,bt=w.min,w.floor,w.round,Fi=w.sqrt,Gi.Util.Array.typed,Oi=Gi.Util.Array.typed_obj,Ni=Array.prototype.push,Gi.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,noreuse:!1,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,r,i,a,o){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==r?.5:+r,this.minNeighbors=null==i?1:+i,this.doCannyPruning=void 0===a||!!a,this.tolerance=null==o?.2:+o,this._haarchanged=!!this.haardata},path:Gi.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection&&(e.selection=t.selection||null),void 0!==t.noreuse)&&(e.noreuse=!!t.noreuse),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh,noreuse:t.noreuse};return t._haarchanged&&(e.haardata=Oi(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=Oi(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e.noreuse=t.noreuse,e},metaData:function(t){return t&&Gi.isWorker?Oi(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Oi(t,1):t,this},apply:function(t,e,n,r){var i,a,o,l,s,u,c,f,h,m,p,d,g=this;return g.meta={objects:[]},g.haardata&&e&&n&&(i=t.length>>>2,d=g.selection||null,a=Gi.Array32F,u=s=l=o=null,p=Gi.Util.Filter,d=d?(m=d[4]?(h=e-1,n-1):h=1,c=bt(e-1,yt(0,d[0]*h)),f=bt(n-1,yt(0,d[1]*m)),h=bt(e-1,yt(0,d[2]*h)),bt(n-1,yt(0,d[3]*m))):(f=c=0,h=e-1,n-1),!g.noreuse&&r&&r.haarfilter_SAT?(o=r.haarfilter_SAT,l=r.haarfilter_SAT2,s=r.haarfilter_RSAT):(p.sat(t,e,n,2,0,o=new a(i),l=new a(i),s=new a(i)),!g.noreuse&&r&&(r.haarfilter_SAT=o,r.haarfilter_SAT2=l,r.haarfilter_RSAT=s)),g.doCannyPruning&&(!g.noreuse&&r&&r.haarfilter_GSAT?u=r.haarfilter_GSAT:(u=p.gradient(t,e,n,2,0,1,1),!g.noreuse&&r&&(r.haarfilter_GSAT=u))),(m=new Array(10)).count=0,p.haar_detect(m,e,n,c,f,h,d,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,o,s,l,u,g.cannyLow,g.cannyHigh),m.length>m.count&&(m.length=m.count),g.meta.objects=p.merge_features(m,g.minNeighbors,g.tolerance).sort(Bo),u=s=l=o=null),t}}),Gi.Util.Filter.haar_detect=function(t,e,N,H,U,B,Y,z,k,P,j,n,r,i,a,X,W){for(var $,q,o,l,s,u,V,K,Z,c,f,h,m,J,Q,p,d,g,_,tt,et,nt,rt,it,x,v,at,y,ot,lt,st,b,C,w,A,S,R,I,L,D,E,T,M,ut=null!=a,ct=B-H+1|0,ft=Y-U+1|0,ht=(B=e*N)-1,mt=z.stages,pt=mt.length,dt=z.size1,gt=z.size2,G=e-1,F=B-e,_t=0|H,xt=0|U,vt=bt(ct/dt,ft/gt),O=k;O<=vt;O*=P)for($=(o=O*dt|0)*j|0,K=(l=O*gt|0)*e,J=_t+ct-o,Q=xt+ft-l,d=o*l,V=(u=xt)*(Z=(q=l*j|0)*e);u<Q;u+=q,V+=Z)for(s=_t;s<J;s+=$)if(f=(c=s-1+V-e)+o,m=(h=c+K)+o,c=bt(ht,yt(0,c)),f=bt(ht,yt(0,f)),h=bt(ht,yt(0,h)),m=bt(ht,yt(0,m)),!(ut&&((_=(a[m]-a[h]-a[f]+a[c])/d)<X||W<_)||(_=(n[m]-n[h]-n[f]+n[c])/d,(g=(i[m]-i[h]-i[f]+i[c])/d-_*_)<=0))){for(g=Fi(g),tt=!1,p=0;p<pt;++p){for(nt=(et=mt[p]).thres,it=(rt=et.trees).length,x=M=0;x<it;++x)for(at=rt[x].feats,v=0;;){if(lt=(ot=(y=at[v]).rects).length,st=y.thres,b=0,y.tilt)for(C=0;C<lt;++C)A=s+O*(w=ot[C])[0]|0,S=(u-1+O*w[1]|0)*e,R=s+O*(w[0]+w[2])|0,I=(u-1+O*(w[1]+w[2])|0)*e,L=s+O*(w[0]-w[3])|0,D=(u-1+O*(w[1]+w[3])|0)*e,E=s+O*(w[0]+w[2]-w[3])|0,T=(u-1+O*(w[1]+w[2]+w[3])|0)*e,A=bt(G,yt(0,A)),R=bt(G,yt(0,R)),L=bt(G,yt(0,L)),E=bt(G,yt(0,E)),S=bt(F,yt(0,S)),I=bt(F,yt(0,I)),D=bt(F,yt(0,D)),T=bt(F,yt(0,T)),b+=w[4]*(r[E+T]-r[L+D]-r[R+I]+r[A+S]);else for(C=0;C<lt;++C)A=s-1+O*(w=ot[C])[0]|0,R=s-1+O*(w[0]+w[2])|0,S=e*(u-1+O*w[1]|0),I=e*(u-1+O*(w[1]+w[3])|0),A=bt(G,yt(0,A)),R=bt(G,yt(0,R)),S=bt(F,yt(0,S)),I=bt(F,yt(0,I)),b+=w[4]*(n[R+I]-n[A+I]-n[R+S]+n[A+S]);if(b<d*st*g){if(y.has_l){M+=y.l_val;break}v=y.l_node}else{if(y.has_r){M+=y.r_val;break}v=y.r_node}}if(!(tt=nt<M))break}tt&&(t.count===t.length&&Ni.apply(t,new Array(10)),t[t.count++]={x:s,y:u,width:o,height:l,score:M})}},Ui=(Hi=A).MODE,Hi.Util.GLSL,Bi=Hi.Util.Filter,Yi=Bi.sat,zi=Bi.satsum,ki=Bi.satsums,Pi=Bi.satsumr,ji=Bi.merge_features,Hi.Util.Array.typed,Xi=Hi.Util.Array.typed_obj,at=Math,Hi.Util.Math.clamp,Wi=Hi.Array32F,$i=[0],qi=[0,90,180,270],Vi=[0,45,90,135,180,225,270,315],Ki=[0,22.5,45,67.5,90,112.5,135,157.5,180,202.5,225,247.5,270,292.5,315,337.5],Hi.Create({name:"TemplateMatcherFilter",path:Hi.Path,_update:!1,hasMeta:!0,hasInputs:!0,mode:Ui.RGB,noreuse:!1,sc:null,rot:null,scaleThreshold:null,threshold:.6,tolerance:.2,minNeighbors:1,maxMatches:100,maxMatchesOnly:!0,_k:5,_q:.98,_s:3,_tpldata:null,init:function(t){this.sc={min:1,max:1,inc:1.1},this.rot=[0],t&&this.setInput("template",t)},dispose:function(){return this.sc=this.rot=null,this.scaleThreshold=null,this._tpldata=null,this.$super("dispose"),this},params:function(t){var e=this;return t&&(null!=t.threshold&&(e.threshold=t.threshold||0),null!=t.scaleThreshold&&(e.scaleThreshold=t.scaleThreshold,e.scaleThreshold)&&(e.scaleThreshold.changed=!0),null!=t.tolerance&&(e.tolerance=t.tolerance||0),null!=t.minNeighbors&&(e.minNeighbors=t.minNeighbors||0),null!=t.maxMatches&&(e.maxMatches=t.maxMatches||0),void 0!==t.maxMatchesOnly&&(e.maxMatchesOnly=!!t.maxMatchesOnly),null!=t.scales&&(e.sc=t.scales||{min:1,max:1,inc:1.1},e._glsl=null),null!=t.rotations&&(e.rot=t.rotations||[0],e._glsl=null),null!=t.k&&(e._k=t.k||0),null!=t.q&&e.quality(t.q,e._s),null!=t.s&&e.quality(e._q,t.s),null!=t.selection&&(e.selection=t.selection||null),void 0!==t.noreuse)&&(e.noreuse=!!t.noreuse),e},quality:function(t,e){return e=null==e?3:e||0,(t=null==t?.98:t||0)===this._q&&e===this._s||(this._tpldata=null,this._q=t,this._s=e),this},tpldata:function(t,e){var n,r,i=this;return t&&t.avg&&t.avg.length?i._tpldata=t:(n=i.isInputUpdated("template"),(r=i.input("template"))&&r[1]&&r[2]?t?!n&&i._tpldata&&i._tpldata.basis||(i._tpldata=ko(r[0],r[1],r[2],1-i._q,i._s,e)):!n&&i._tpldata||(i._tpldata=ko(r[0],r[1],r[2])):i._tpldata=null,i._tpldata)},serialize:function(){var t=this,e={threshold:t.threshold,scaleThreshold:"function"==typeof t.scaleThreshold&&(t.scaleThreshold.changed?t.scaleThreshold.toString():null),tolerance:t.tolerance,minNeighbors:t.minNeighbors,maxMatches:t.maxMatches,maxMatchesOnly:t.maxMatchesOnly,sc:t.sc,rot:t.rot,_k:t._k,_q:t._q,_s:t._s,noreuse:t.noreuse};return t.scaleThreshold&&t.scaleThreshold.changed&&(t.scaleThreshold.changed=null),e},unserialize:function(t){var e=this;return e.threshold=t.threshold,e.scaleThreshold=!1===t.scaleThreshold?null:t.scaleThreshold?new Function("FILTER","return "+t.scaleThreshold+";")(Hi):e.scaleThreshold,e.tolerance=t.tolerance,e.minNeighbors=t.minNeighbors,e.maxMatches=t.maxMatches,e.maxMatchesOnly=t.maxMatchesOnly,e.sc=t.sc,e.rot=t.rot,e._k=t._k,e._q=t._q,e._s=t._s,e.noreuse=t.noreuse,e},metaData:function(t){return t&&Hi.isWorker?Xi(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Xi(t,1):t,this},apply:function(t,e,n,r){var i=this,a=i.tpldata(!0),o=i.input("template"),N=[];if(i.meta={matches:N},o&&a&&e&&n){var H,U,B,l,Y,s,z,k,u,c,f,h,m,p,d,g,_,P,j,x,v,y,b,C,w,X,W,A,S,R,I,L,D,E,$,T,q=o[0],M=o[1],G=o[2],o=i.selection||null,V=Ui.GRAY===i.mode,F=i.rot,K=i.sc,Z=i.threshold,J=i._k||0,Q=i.scaleThreshold,O=(t.length,q.length,e*n),tt=i.maxMatches,et=i.maxMatchesOnly,nt=i.minNeighbors,rt=i.tolerance,it={x1:0,y1:0,x2:0,y2:0,x3:0,y3:0,x4:0,y4:0,area:0,sum:0,sum2:0,sat:null,sat2:null};for(1===F?F=$i:4===F?F=qi:8===F?F=Vi:16===F&&(F=Ki),X=o?(q=o[4]?(W=e-1,n-1):W=1,b=0|at.min(e-1,at.max(0,o[0]*W)),C=0|at.min(n-1,at.max(0,o[1]*q)),w=0|at.min(e-1,at.max(0,o[2]*W)),0|at.min(n-1,at.max(0,o[3]*q))):(C=b=0,w=e-1,n-1),!i.noreuse&&r&&(r.tmfilter_SAT||r.haarfilter_SAT)?(R=r.tmfilter_SAT||[r.haarfilter_SAT,r.haarfilter_SAT,r.haarfilter_SAT],I=r.tmfilter_SAT2||[r.haarfilter_SAT2,r.haarfilter_SAT2,r.haarfilter_SAT2]):(V?(R=[new Wi(O),null,null],I=[new Wi(O),null,null],Yi(t,e,n,2,0,R[2]=R[1]=R[0],I[2]=I[1]=I[0])):(R=[new Wi(O),new Wi(O),new Wi(O)],I=[new Wi(O),new Wi(O),new Wi(O)],Yi(t,e,n,2,0,R[0],I[0]),Yi(t,e,n,2,1,R[1],I[1]),Yi(t,e,n,2,2,R[2],I[2])),!i.noreuse&&r&&(r.tmfilter_SAT=R,r.tmfilter_SAT2=I)),R[0]===R[1]&&R[0]===R[2]&&(V=!0),U=0,B=F.length;U<B;++U)for((l=(Y=F[U]||0)%360)<0&&(l+=360),H=45<l&&l<=135||225<l&&l<=315,A=at.sin(l/180*at.PI),S=at.cos(l/180*at.PI),s=K.min,z=K.max,k=K.inc;s<=z&&(h=(p=at.round(s*M))>>>1,m=(d=at.round(s*G))>>>1,f=H?(c=m,h):(c=h,m),!(w-b+1<c<<1||X-C+1<f<<1));s*=k){if(u=Q?Q(s,Y):Z,L=new Array(O),E=-1/(D=0),T=new Wi(w-b+1),V)for(v=b+c,y=C+f,x=X-f;y<=x&&!(w<v+c&&(v=b+c,x<++y));)y<(T[v-b-c]||0)?v+=c:u<=(_=Yo(v,y,R[0],I[0],a.avg[0],a.var[0],a.basis[0],e,n,M,G,s,l,J,p,d,A,S,it))&&(g=_,!et||E<=g)?(E<g&&(E=g,et)&&(D=0),L[D++]={x:v-h,y:y-m,width:p,height:d,score:g},T[v-b-c]=y+(f||0),v+=c||1):++v;else for(v=b+c,y=C+f,x=X-f;y<=x&&!(w<v+c&&(v=b+c,x<++y));)y<(T[v-b-c]||0)?v+=c:(P=u<=(_=Yo(v,y,R[0],I[0],a.avg[0],a.var[0],a.basis[0],e,n,M,G,s,l,J,p,d,A,S,it))?Yo(v,y,R[1],I[1],a.avg[1],a.var[1],a.basis[1],e,n,M,G,s,l,J,p,d,A,S,it):0,j=u<=_&&u<=P?Yo(v,y,R[2],I[2],a.avg[2],a.var[2],a.basis[2],e,n,M,G,s,l,J,p,d,A,S,it):0,u<=_&&u<=P&&u<=j&&(g=at.min(_,P,j),!et||E<=g)?(E<g&&(E=g,et)&&(D=0),L[D++]={x:v-h,y:y-m,width:p,height:d,score:g},T[v-b-c]=y+(f||0),v+=c||1):++v);D&&D<at.min(tt,O)&&(L.length=D,($=ji(L,nt,rt)).forEach(function(t){t.angle=Y,t.scale=s}),N.push.apply(N,$))}T=R=I=L=$=null}return t}}),Bi.tm_approximate=function(t,e,n,r,i,a,o){var l,s,u,c,f,h,m,p,d,g,_,x,v,y,b,C,w,A,S=t.length,R=S>>>2,I=[{k:zi(e,n,r,0,0,n-1,r-1)/R,x0:0,y0:0,x1:n-1,y1:r-1,q:1}],L=I[0];for(a*=65025,y=l=0;y<S;y+=4)l+=(C=t[y+i]-L.k)*C/R;for(u=l;a<l;){for(u=l,A=(c=I).length,w=0;w<A;++w){if(o<(L=I[w]).x1-L.x0+1)for(m=L.x0;m<L.x1;++m){for(s=l,h=L.y1-L.y0+1,f=m-L.x0+1,x=zi(e,n,r,L.x0,L.y0,m,L.y1)/(f*h),f=L.x1-(m+1)+1,v=zi(e,n,r,m+1,L.y0,L.x1,L.y1)/(f*h),d=L.x0;d<=m;++d)for(_=(g=L.y0)*n;g<=L.y1;++g,_+=n)s=s-(C=(b=t[(y=d+_<<2)+i])-L.k)*C/R+(C=b-x)*C/R;for(d=m+1;d<=L.x1;++d)for(_=(g=L.y0)*n;g<=L.y1;++g,_+=n)s=s-(C=(b=t[(y=d+_<<2)+i])-L.k)*C/R+(C=b-v)*C/R;s<u&&(u=s,(c=I.slice(0,w)).push({k:x,x0:L.x0,x1:m,y0:L.y0,y1:L.y1}),c.push({k:v,x0:m+1,x1:L.x1,y0:L.y0,y1:L.y1}),c.push.apply(c,I.slice(w+1)))}if(o<L.y1-L.y0+1)for(p=L.y0;p<L.y1;++p){for(s=l,f=L.x1-L.x0+1,h=p-L.y0+1,x=zi(e,n,r,L.x0,L.y0,L.x1,p)/(f*h),h=L.y1-(p+1)+1,v=zi(e,n,r,L.x0,p+1,L.x1,L.y1)/(f*h),_=(g=L.y0)*n;g<=p;++g,_+=n)for(d=L.x0;d<=L.x1;++d)s=s-(C=(b=t[(y=d+_<<2)+i])-L.k)*C/R+(C=b-x)*C/R;for(_=(g=p+1)*n;g<=L.y1;++g,_+=n)for(d=L.x0;d<=L.x1;++d)s=s-(C=(b=t[(y=d+_<<2)+i])-L.k)*C/R+(C=b-v)*C/R;s<u&&(u=s,(c=I.slice(0,w)).push({k:x,x0:L.x0,x1:L.x1,y0:L.y0,y1:p}),c.push({k:v,x0:L.x0,x1:L.x1,y0:p+1,y1:L.y1}),c.push.apply(c,I.slice(w+1)))}}if(c===I)break;l=u,I=c}return I[0].q=1-u/255/255,I},Bi.tm_ncc=Yo,Zi=A,N=Math,Ji=N.PI/180,Qi=Zi.Util.Math.hypot,ta=Zi.Util.Image.nonzero_pixels,ea=Zi.Util.Filter.localmax,na=Zi.Array32U,ra=Zi.Array32F,ia=Zi.Util.Array.typed_obj,Zi.Create({name:"HoughDetectorFilter",path:Zi.Path,_update:!1,hasMeta:!0,shape:"lines",threshold:10,gap:4,radii:null,thetas:null,amin:10,amax:null,bmin:3,bmax:null,init:function(t){null!=t&&(this.shape=String(t)),this.radii=null,this.thetas=Ko(60,function(t){return 3*t})},params:function(t){var e=this;return t&&(null!=t.threshold&&(e.threshold=+t.threshold),null!=t.gap&&(e.gap=+t.gap),null!=t.radii&&(e.radii=t.radii),null!=t.thetas&&(e.thetas=t.thetas),null!=t.amin&&(e.amin=+t.amin),void 0!==t.amax&&(e.amax=t.amax),void 0!==t.bmin&&(e.bmin=t.bmin),void 0!==t.bmax&&(e.bmax=t.bmax),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this;return{shape:t.shape,threshold:t.threshold,gap:t.gap,radii:t.radii?t.radii.join(","):null,thetas:t.thetas?t.thetas.join(","):null,amin:t.amin,amax:t.amax,bmin:t.bmin,bmax:t.bmax}},unserialize:function(t){var e=this;return e.shape=t.shape,e.threshold=t.threshold,e.gap=t.gap,e.radii=t.radii?t.radii.split(",").map(Vo):null,e.thetas=t.thetas?t.thetas.split(",").map(Vo):null,e.amin=t.amin,e.amax=t.amax,e.bmin=t.bmin,e.bmax=t.bmax,e},metaData:function(t){return t&&Zi.isWorker?ia(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?ia(t,1):t,this},apply:function(t,e,n){var r,i,a,o,l=this,s=l.shape,u=l.selection||null;return l.hasMeta=!0,l.meta={objects:[]},u=u?(o=u[4]?(a=e-1,n-1):a=1,r=0|N.min(e-1,N.max(0,u[0]*a)),i=0|N.min(n-1,N.max(0,u[1]*o)),a=0|N.min(e-1,N.max(0,u[2]*a)),0|N.min(n-1,N.max(0,u[3]*o))):(i=r=0,a=e-1,n-1),"lines"===s?l.meta.objects=jo(t,e,0,4,r,i,a,u,l.thetas,l.threshold):"linesegments"===s?l.meta.objects=Xo(t,e,n,4,r,i,a,u,l.thetas,l.threshold,l.gap):"rectangles"===s?l.meta.objects=Wo(t,e,n,4,r,i,a,u,l.thetas,90,l.threshold,l.gap):"circles"===s?l.meta.objects=$o(t,e,n,4,r,i,a,u,l.radii,l.threshold):"ellipses"===s&&(l.meta.objects=qo(t,e,n,4,r,i,a,u,l.amin,l.amax,l.bmin,l.bmax,l.threshold)),l._update=!1,t}}),Zi.Util.Filter.hough_lines=jo,Zi.Util.Filter.hough_line_segments=Xo,Zi.Util.Filter.hough_parallelograms=Wo,Zi.Util.Filter.hough_circles=$o,Zi.Util.Filter.hough_ellipses=qo,A});
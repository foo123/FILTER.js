/**
*
*   FILTER.js
*   @version: 1.14.0-alpha
*   @built on 2025-04-28 18:48:27
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function P(){"use strict";var a,S,D,I,R,L,E,M,G,F,O,lt,ot,st,k,H,z,j,X,V,W,$,Z,J,Q,K,tt,et,nt,it,ut,ct,ft,ht,Y,mt,pt,dt,gt,xt,_t,yt,wt,Ct,At,St,Dt,c,It,Rt,Lt,Et,Mt,Tt,Ot,Gt,Ft,Nt,Ht,Ut,zt,Bt,Yt,kt,Pt,jt,h,Xt,Wt,$t,qt,m,Vt,Kt,Zt,Jt,Qt,te,ee,ne,ie,re,ae,le,p,oe,se,ue,g,ce,fe,he,me,pe,de,ge,xe,_e,ye,ve,be,we,Ce,U,Ae,Se,De,Ie,Re,Le,Ee,Me,x,Te,Oe,Ge,Fe,Ne,He,Ue,u,ze,Be,l,o,Ye,ke,Pe,je,Xe,We,$e,qe,Ve,Ke,Ze,Je,Qe,tn,en,nn,rn,an,ln,on,sn,un,cn,fn,hn,mn,pn,dn,gn,xn,_n,yn,vn,q,bn,wn,Cn,An,Sn,Dn,In,Rn,Ln,En,Mn,Tn,On,Gn,Fn,Nn,Hn,Un,zn,Bn,Yn,kn,Pn,jn,Xn,Wn,$n,qn,Vn,Kn,Zn,Jn,Qn,ti,ei,ni,ii,ri,ai,li,oi,si,ui,ci,fi,hi,mi,pi,di,gi,xi,_i,yi,vi,bi,t,wi,Ci,Ai,Si,Di,Ii,e,Ri,Li,Ei,Mi,Ti,Oi,Gi,Fi,Ni,Hi,Ui,zi,Bi,Yi,ki,Pi,ji,n,Xi,Wi,$i,qi,Vi,Ki,Zi,Ji,Qi,tr,er,nr,ir,i,rr,ar,lr,or,sr,ur,cr,_,fr,hr,mr,pr,r,dr,gr,xr,_r,yr,vr,br,y,wr,Cr,Ar,v,Sr,Dr,Ir,Rr,Lr,Er,Mr,Tr,Or,Gr,Fr,Nr,Hr,b,vt,bt,Ur,zr,Br,Yr,kr,Pr,jr,Xr,Wr,$r,qr,Vr,at,Kr,Zr,Jr,Qr,ta,ea,N,na,ia,ra,aa,la,oa,sa,ua,rt,ca,fa,ha,ma,pa,da,ga,w={VERSION:"1.14.0-alpha"};function xa(t,e,n){arguments.length<2&&(e=t,t=null),D.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var i,r,a,l=D.call(e,"constructor")?e.constructor:function(){};for(i in t?(l[S]=Object.create(t[S]),l[S].$super=(r=t,a={},function(t,e){var n=":"+t;return 1===a[n]?(r[S].$super||I).call(this,t,e):(a[n]=1,t=("constructor"===t?r:r[S][t]||I).apply(this,e||[]),a[n]=0,t)})):l[S].$super=I,l[S].constructor=l,e)D.call(e,i)&&"constructor"!==i&&(l[S][i]=e[i]);if(n)for(i in n)D.call(n,i)&&(l[i]=n[i]);return l}function _a(t){t.preventDefault&&t.preventDefault()}function ya(t,e,n){return n<t?n:t<e?e:t}function va(t,e,n,i,r){n=n||0,i=i||0;for(var a,l=r?r-i+1:e.length,o=31&l,s=0;s<o;++s)t[s+n]=e[i+s];for(a=o;a<l;a+=32)t[(s=a)+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],++s}function ba(t,e,n){for(var i=t>>>1,r=e>>>1,a=t*e,l=-1/(2*n*n),o=new st(a),s=V.exp,u=0,c=-i,f=-r,h=0;h<a;++h,++c)i<c&&(c=-i,++f),o[h]=s(l*(c*c+f*f)),u+=o[h];for(h=0;h<a;++h)o[h]/=u;return o}function wa(t,e,n,i,N,r,H,U,z,a,B,Y){null==a&&(Y=(a=1)*(B=510));for(var l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,k,A,S,P,D,I,j,R,X,L,W,E,M,$=n.length,q=$>>>r,V=i-1,K=N-1,T=new st(q),O=1,G=1,F=i;G<K&&!(V<=O&&(O=1,F+=i,K<=++G));++O)x=(s=O+F)-1,_=s+1,w=(d=s-i)-1,y=1+d,b=(g=s+i)-1,v=g+1,u=t[s],c=e[s],f=Q(u),h=Q(c),M=J(f,h),E=Z(f,h),m=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[d]),Q(e[d])),E=Z(Q(t[d]),Q(e[d])),d=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[g]),Q(e[g])),E=Z(Q(t[g]),Q(e[g])),g=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[x]),Q(e[x])),E=Z(Q(t[x]),Q(e[x])),x=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[_]),Q(e[_])),E=Z(Q(t[_]),Q(e[_])),_=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[y]),Q(e[y])),E=Z(Q(t[y]),Q(e[y])),y=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[v]),Q(e[v])),E=Z(Q(t[v]),Q(e[v])),v=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[b]),Q(e[b])),E=Z(Q(t[b]),Q(e[b])),b=M?M*(1+.43*E/M*E/M):0,M=J(Q(t[w]),Q(e[w])),E=Z(Q(t[w]),Q(e[w])),w=M?M*(1+.43*E/M*E/M):0,E=u*c<=0?h<=f?(p=f*m)>=Q(c*y-(u+c)*_)&&p>Q(c*b-(u+c)*x):(p=h*m)>=Q(u*y-(c+u)*d)&&p>Q(u*b-(c+u)*g):h<=f?(p=f*m)>=Q(c*v+(u-c)*_)&&p>Q(c*w+(u-c)*x):(p=h*m)>=Q(u*v+(c-u)*g)&&p>Q(u*w+(c-u)*d),T[s]=E?B<=m?Y:a*m:0;if(H){for(o=O=0;O<i;++O)o+=T[O],T[O]=o;for(O=i,o=F=0;O<q;++O,++F)i<=F&&(o=F=0),o+=T[O],T[O]=T[O-i]+o;return T}if(r)for(O=0;O<$;O+=4)n[O]=n[O+1]=n[O+2]=0;else for(O=0;O<$;++O)n[O]=0;for(F=l=G=O=0;l<q;F=++l<<r,++O)if(i<=O&&(O=0,++G),!(0<n[F]||T[l]<z)){C=O,S=G,L=F,0;do{for(n[L]=r?n[L+1]=n[L+2]=255:255,k=C===V?C:C+1,P=S===K?S:S+1,A=0===S?S:S-1,D=0===C?C:C-1,R=j=(I=A)*i,W=0;D<=k&&I<=P;){if(L=(X=D+R)<<r,(I!==S||D!==C)&&0===n[L]&&T[X]>=U){C=D,S=I,W=1;break}R+=i,P<++I&&(I=A,R=j,++D)}}while(W)}return n}function Ca(t,e,n,i,r){var a,l,o,s,u,c,f,h,m;if(i<=n)return!0===r?[n,0]:n;for(o=0,h=n;h<=i;++h)o+=h*t[h]/e;for(c=t[m=n],f=n*t[n]/e,s=(a=c/e)*(l=1-a)*$((o-f)/l-f/a,2),h=n+1;h<=i;++h)c+=t[h],f+=h*t[h]/e,s<(u=(a=c/e)*(l=1-a)*$((o-f)/l-f/a,2))&&(s=u,m=h);return!0===r?[m,s]:m}function Aa(t,e,n,i,r){for(var a,l,o={},s=0;s<r;++s)1!==o[s]&&(l=t[a=function(t,e){for(var n=0;1<e;)n=(n<<1)+(1&t),t>>=1,e>>=1;return n}(s,r)],n[a]=t[s],n[s]=l,l=e[a],i[a]=e[s],i[s]=l,o[a]=1)}function Sa(t,e,n,N,i,r){if(!(n<=0)){var H=!1;if(null==i&&(i=new t.constructor(n),r=new e.constructor(n),H=!0),n&n-1){var a,l,o,s=t,u=e,c=n,U=N,f=i,h=r;if(1===c)f[0]=s[0]||0,h[0]=u[0]||0;else{for(a=0;a<c;++a)f[a]=0,h[a]=0;var m,p,d,g,x,_,y=function(t){for(var e=V.sqrt(t),n=3;n<=e;){if(0==t%n)return n;n+=2}return t}(c),v=c/y,z=1/V.sqrt(y),b=new s.constructor(v),w=new u.constructor(v),C=new s.constructor(v),A=new u.constructor(v);for(l=0;l<y;++l){for(a=0;a<v;++a)b[a]=s[a*y+l]||0,w[a]=u[a*y+l]||0;for(1<v&&(Sa(b,w,v,U,C,A),o=b,b=C,C=o,o=w,w=A,A=o),m=V.cos(2*K*l/c),p=(U?-1:1)*V.sin(2*K*l/c),d=1,a=g=0;a<c;++a)x=z*b[a%v],_=z*w[a%v],f[a]+=d*x-g*_,h[a]+=d*_+g*x,x=d*m-g*p,_=g=d*p+g*m,d=x,g=_=g}}}else{var B,Y,S,k,D,I,R,L,E,M,T,P,j,X,W,$=n,q=N,O=i,G=r,F=1;for(Aa(t,e,O,G,$);F<$;){for(B=function(t){var e=ft[t];return null==e&&(ft[t]=e=V.cos(K/t)),e}(F),Y=(q?-1:1)*function(t){var e=ct[t];return null==e&&(ct[t]=e=V.sin(K/t)),e}(F),k=$/(2*F),S=0;S<k;++S)for(L=1,D=E=0;D<F;++D)T=(M=2*S*F+D)+F,P=O[M]||0,j=G[M]||0,I=O[T]||0,R=G[T]||0,X=L*I-E*R,W=E*I+L*R,O[M]=tt*(P+X),G[M]=tt*(j+W),O[T]=tt*(P-X),G[T]=tt*(j-W),R=L*Y+E*B,L=I=L*B-E*Y,E=R;F<<=1}}return H?{r:i,i:r}:void 0}}function Da(t,e,n,i,r,a,l){if(!(n<=0||i<=0)){var o,s,u,c=!1,f=t.constructor,h=e.constructor,m=n*i,p=new f(n),d=new h(n),g=new f(i),x=new h(i),_=new f(n),y=new h(n),v=new f(i),b=new h(i);for(null==a&&(a=new f(m),l=new h(m),c=!0),u=s=0;s<i;++s,u+=n){for(o=0;o<n;++o)p[o]=t[o+u]||0,d[o]=e[o+u]||0;for(Sa(p,d,n,r,_,y),o=0;o<n;++o)a[o+u]=_[o],l[o+u]=y[o]}for(o=0;o<n;++o){for(u=s=0;s<i;++s,u+=n)g[s]=a[o+u],x[s]=l[o+u];for(Sa(g,x,i,r,v,b),u=s=0;s<i;++s,u+=n)a[o+u]=v[s],l[o+u]=b[s]}return c?{r:a,i:l}:void 0}}function Ia(t,e,n,i,r,a,l,o,s){s=s||0;var u,c,f,h,m,p,d=t.length,g=1<<(o=o||0),x=1/0,_=-1/0,y=0,v=0;for(a&&(m=new Array(d>>>o)),l&&(p=new Array(d>>>o)),c=f=u=0;u<d;u+=g,++c)e<=c&&(c=0,++f),h=t[u+s],a&&h<=x&&(null==i||h<=i)&&(h<x&&(x=h,y=0),m[y++]={x:c,y:f}),l&&_<=h&&(null==r||r<=h)&&(_<h&&(_=h,v=0),p[v++]={x:c,y:f});return a&&l?(m.length=y,p.length=v,{min:x,minpos:m,max:_,maxpos:p}):a?(m.length=y,{min:x,minpos:m}):l?(p.length=v,{max:_,maxpos:p}):void 0}function Ra(t,e,n){var i=e.width*n,n=e.height*n;return t.x>=e.x-i&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+i&&t.y+t.height<=e.y+e.height+n}function C(l,o,s,u,t){var c,f,h,m,r=this,p=null,a=null,e=null,d=null,g=null,n=null,x=0,_=null;function y(){if(!p&&l)if(0<h&&0<m&&c<o&&f<s&&0<c+h&&0<f+m){var t,e,n,i,r,a;if(p=new Array(x),4===u)if(null==_)for(t=c,n=(e=f)*o,r=i=0;i<x&&((c+h<=t||o<=t)&&(t=c,++e,n+=o),!(f+m<=e||s<=e));++i,++t)0<=t&&t<o&&0<=e&&e<s&&0<l[3+((a=t+n)<<2)]&&(p[r++]={x:t,y:e,index:a});else for(t=c,n=(e=f)*o,r=i=0;i<x&&((c+h<=t||o<=t)&&(t=c,++e,n+=o),!(f+m<=e||s<=e));++i,++t)0<=t&&t<o&&0<=e&&e<s&&(a=t+n,_(l,t,e,u))&&(p[r++]={x:t,y:e,index:a});else if(null==_)for(t=c,n=(e=f)*o,r=i=0;i<x&&((c+h<=t||o<=t)&&(t=c,++e,n+=o),!(f+m<=e||s<=e));++i,++t)a=t+n,0<=t&&t<o&&0<=e&&e<s&&l[a]&&(p[r++]={x:t,y:e,index:a});else for(t=c,n=(e=f)*o,r=i=0;i<x&&((c+h<=t||o<=t)&&(t=c,++e,n+=o),!(f+m<=e||s<=e));++i,++t)a=t+n,0<=t&&t<o&&0<=e&&e<s&&_(l,t,e,u)&&(p[r++]={x:t,y:e,index:a});p.length=r}else p=[];return p}function i(){if(!n){y(),n={};for(var t=0,e=p.length;t<e;++t)n[p[t].index]=t}return n}function v(){if(!d){y(),d={};for(var t,e,n=0,i=p.length;n<i;++n)t=p[n],(e=d[t.y])&&e.length?e.push(n):d[t.y]=[n]}return d}function b(){if(!g){y(),g={};for(var t,e,n=0,i=p.length;n<i;++n)t=p[n],(e=g[t.x])&&e.length?e.push(n):g[t.x]=[n]}return g}null==u&&(u=4),-1===[1,4].indexOf(u)&&(u=1),c=null!=(t=t||{x:0,y:0,width:o,height:s}).x&&+t.x||0,f=null!=t.y&&+t.y||0,h=null==t.width?o:V.max(+t.width||0,0),m=null==t.height?s:V.max(+t.height||0,0),x=h*m,null!=t.selector&&(_=t.selector),Array.isArray(t.points)&&(p=t.points),t=null,r.dispose=function(){l=_=p=d=g=n=a=null,r.attached=null},r.data=function(t){return arguments.length?(t&&(l=t),r):{data:l,width:o,height:s,channels:u}},r.rect=function(){return{from:{x:c,y:f},to:{x:c+h-1,y:f+m-1},width:h,height:m,area:x}},r.bbox=function(){return(e=e||y().reduce(function(t,e){return t.xm=V.min(t.xm,e.x),t.ym=V.min(t.ym,e.y),t.xM=V.max(t.xM,e.x),t.yM=V.max(t.yM,e.y),t},{xm:1/0,ym:1/0,xM:-1/0,yM:-1/0})).xm>e.xM?{from:{x:0,y:0},to:{x:-1,y:-1},width:0,height:0}:{from:{x:e.xm,y:e.ym},to:{x:e.xM,y:e.yM},width:e.xM-e.xm+1,height:e.yM-e.ym+1}},r.points=y,r.indices=i,r.rows=v,r.cols=b,r.bitmap=function(t){if(arguments.length){a=t,p=new Array(a.length);for(var e=a.length,n=0,i=0;n<e;++n)a[n]&&(p[i++]={x:n%o,y:V.floor(n/o),index:n});return p.length=i,r}return a||(a=new Array(o*s),(y()||[]).forEach(function(t){a[t.index]=1})),a},r.empty=function(){return h<=0||m<=0||0===y().length},r.has=function(t,e){return null==e?!!b()[t]:null==t?!!v()[e]:-1!==r.indexOf(t,e)},r.indexOf=function(t,e){e=0<=t&&t<o&&0<=e&&e<s?i()[e*o+t]:null;return null==e?-1:e},r.attached={}}function La(t,e,n,i,r){this.levels=[{img:t,width:e,height:n,channels:i=4!==(i=null==i?4:i)?1:i,sel:r=r&&r instanceof C?r:null}]}function Ea(t,e,n,i,r,a,l){var o;return e<=0||n<=0||l<r||a<i||l<0||a<0?0:(o=e-1,n=n-1,i=i<0?0:o<i?o:i,r=r<0?0:n<r?n:r,a=a<0?0:o<a?o:a,l=l<0?0:n<l?n:l,t?(o=e*--r,t[a+(n=e*l)]-(--i<0?0:t[i+n])-(r<0?0:t[a+o])+(i<0||r<0?0:t[i+o])):(l-r+1)*(a-i+1))}function B(t,e,n,i,r,a,l,o){t.area+=o*Ea(null,e,n,i,r,a,l),t.sum+=o*Ea(t.sat,e,n,i,r,a,l),t.sat2&&(t.sum2+=o*Ea(t.sat2,e,n,i,r,a,l))}function Ma(N,t,e,n,i,r,a,l,o,s,H){if(!(t<=0||e<=0)){var u,c,f=V.min(n,r,l),h=V.min(i,a,o),m=V.max(n,r,l),p=V.max(i,a,o),d=m-f,g=p-h;if(s=s||0,d&&g)if(s<=1)B(N,t,e,f,h,m,p,H/2);else{var x,_,y,v,b,w,C=n===f&&(r===m&&a===i||l===m&&o===i)?i:r===f&&(n===m&&i===a||l===m&&o===a)?a:o,i=(a=i===h&&(a===p&&r===n||o===p&&l===n)?n:a===h&&(i===p&&n===r||o===p&&l===r)?r:l)===f&&C===h?(c=g<d?(u=m,f):(u=p,h),-1):a===m&&C===p?(c=u=g<d?m:p,-1):(c=a===m&&C===h?g<d?(u=f,m):u=h:g<d?u=f:(u=h,p),1),A=N,S=t,D=e,I=s,U=f,z=h,R=m,L=p,E=d,M=g,T=i,O=u,G=c,F=H;if(M<E){for(_=V.max(1,V.round((M-I+1)/I)||0),x=1,v=V.min((y=z)+_,L);x<=I;++x){if(w=V.round(O+T*((v-z)/M)*E),B(A,S,D,V.min(w,G),y,V.max(w,G),v,F),L<=v)return;y=V.min(v+1,L),v=V.min(y+_,L)}v<L&&(w=V.round(O+T*((++v-z)/M)*E),B(A,S,D,V.min(w,G),v,V.max(w,G),L,F))}else{for(_=V.max(1,V.round((E-I+1)/I)||0),x=1,w=V.min((b=U)+_,R);x<=I;++x){if(v=V.round(O+T*((w-U)/E)*M),B(A,S,D,b,V.min(v,G),w,V.max(v,G),F),R<=w)return;b=V.min(w+1,R),w=V.min(b+_,R)}w<R&&(v=V.round(O+T*((++w-U)/E)*M),B(A,S,D,w,V.min(v,G),R,V.max(v,G),F))}}}}function Ta(t,e){for(var n=t.length,i=new(e||Array)(n),r=0;r<n;++r)i[r]=t[r];return i}function Oa(t,e){if(Array!==O.Array32F)for(var n=0,i=ht.length;n<i;++n)if(e instanceof O[ht[n]])return{typed:ht[n],array:Ta(e,Array)};return e}function Ga(t,e,r){t.replace(wt,"").replace(Ct,"").replace(e,function(t,e,n,i){return r[n]={name:n,type:e+(i||""),loc:0},t})}function Fa(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),n}function Na(t,e){var n,i,r,a,l=this;if(-1===t.indexOf("precision ")&&(t=yt+"\n"+t),l.vertexSource=_t,l.fragmentSource=t,n=Fa(e,l.vertexSource,e.VERTEX_SHADER),i=Fa(e,l.fragmentSource,e.FRAGMENT_SHADER),l.id=e.createProgram(),e.attachShader(l.id,n),e.attachShader(l.id,i),e.linkProgram(l.id),e.getProgramParameter(l.id,e.LINK_STATUS)||e.isContextLost()){for(r in l.uniform={},l.attribute={},Ga(l.vertexSource,At,l.attribute),Ga(l.vertexSource,St,l.uniform),Ga(l.fragmentSource,St,l.uniform),l.attribute)l.attribute[r].loc=e.getAttribLocation(l.id,r);for(a in l.uniform)l.uniform[a].loc=e.getUniformLocation(l.id,a)}else Y.error(e.getProgramInfoLog(l.id)),Y.error(e.getShaderInfoLog(n)),Y.error(e.getShaderInfoLog(i)),Y.log(t),e.deleteShader(n),e.deleteShader(i),e.deleteProgram(l.id),l.id=null}function Ha(x){function t(){return _}var i=this,e=[],r=null,a={},_={};i.begin=function(){return r={_prev:null,_next:null,_save:null,_inputs:{},_input:"img",_output:null,io:t,iterations:1,instance:x,shader:null,program:null,init:function(t,e,n,i,r,a){var l,o,s;this.program=this.shader&&this.shader.substring?(s=t,l=this.shader,a=a,l=dt(l),(o=a?a[l]:null)||(o=new Na(l,s),a&&(a[l]=o)),o):null,this.program&&this.program.id&&this._save&&(_[this._save]=((s=this)._prev&&s._prev._output&&pt.call(_,s._prev._output)?_[s._prev._output]:null)||{name:this._save,tex:null,data:r?Xa(t,n,i):Y.Util.Array.copy(e),width:n,height:i})},inputs:function(a,l,o,s,u,c){var f=this,h=f._inputs||{},m=f._input,p=f.program,d=p.uniform,g=0;return Object.keys(h).forEach(function(t){if("*"===t&&h["*"].setter)c=h["*"].setter(x,l,o,s,u,_,a,p,c)||c;else if(pt.call(d,t)||pt.call(d,h[t].iname)){var t=h[t],e=pt.call(d,t.name)?t.name:t.iname,n=d[e].type,i=d[e].loc,r=null==t.setter&&pt.call(_,t.name)?_[t.name]:"function"==typeof t.setter?t.setter(x,l,o,s,u,_):t.setter;if("sampler2D"===n)m===t.iname?!t.setter&&f._prev&&t.name===f._prev._output||(r.tex||(r.tex=Ba(a,r.data,r.width,r.height)),c={fbo:null,tex:r.tex,w:r.width,h:r.height}):(++g,r.tex?(a.activeTexture(a.TEXTURE0+g),a.bindTexture(a.TEXTURE_2D,r.tex)):r.tex=Ba(a,r.data,r.width,r.height,g),a.uniform1i(i,g));else switch(n){case"ivec4":a.uniform4iv(i,new xt(r||[0,0,0,0]));break;case"vec4":a.uniform4fv(i,new gt(r||[0,0,0,0]));break;case"ivec3":a.uniform3iv(i,new xt(r||[0,0,0]));break;case"vec3":a.uniform3fv(i,new gt(r||[0,0,0]));break;case"ivec2":a.uniform2iv(i,new xt(r||[0,0]));break;case"vec2":a.uniform2fv(i,new gt(r||[0,0]));break;case"int[":a.uniform1iv(i,new xt(r||[0]));break;case"float[":a.uniform1fv(i,new gt(r||[0]));break;case"int":a.uniform1i(i,r||0);break;default:a.uniform1f(i,r||0)}}}),c},output:function(t,e){if(this._islast){for(var n in _)_[n].name&&_[n].data&&(za(t,_[n].tex),_[n].tex=null,_[n].data=null);_={}}else this._output&&(_[this._output]={name:this._output,tex:null,data:Xa(t,e.w,e.h),width:e.w,height:e.h})},_islast:!0},i},i.shader=function(t,e,n){return r&&(t&&pt.call(a,t)&&(t=a[t]),n&&t&&(a[n]=t),r.shader=t||null,r.iterations=e||1),i},i.dimensions=function(n){return r&&n&&(r.dimensions=function(t,e){return n(t,e,_)}),i},i.save=function(t){return r&&t&&(r._save=t),i},i.input=function(t,e,n){return r&&t&&(!0===e?r._input=t:r._inputs[t]={name:t,setter:e,iname:n||t}),i},i.output=function(t){return r&&t&&(r._output=t),i},i.end=function(){return r&&(e.length&&(r._prev=e[e.length-1],e[e.length-1]._next=r,e[e.length-1]._islast=!1),e.push(r)),r=null,i},i.code=function(){return e}}function Ua(t,e,n){var i=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),i}function za(t,e){e&&t.deleteTexture(e)}function Ba(t,e,n,i,r,a,l){var o=null!=l?l:Ua(t,n,i);return null!=r?(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,o)):null!=l&&t.bindTexture(t.TEXTURE_2D,o),a?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,e),o}function Ya(t,e,n){var i=Ua(t,e,n),r=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{fbo:r,tex:i,w:e,h:n}}function ka(t,e){var n,i;e&&(e.fbo&&(n=t,(i=e).fbo&&(n.bindFramebuffer(n.FRAMEBUFFER,i.fbo),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0),n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null)),i=t,n=e.fbo)&&i.deleteFramebuffer(n),e.tex&&za(t,e.tex),e.fbo=null,e.tex=null)}function Pa(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e||null,t.STATIC_DRAW),n}function ja(t,e){e&&t.deleteBuffer(e)}function Xa(t,e,n,i){return i=i||new Y.ImArray(e*n<<2),t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,i),i}function Wa(t,e,n,i){return"if ("+t+">"+e+") {"+n+"="+t+";"+t+"="+e+";"+e+"="+n+";}"}function $a(t){if(Dt.Browser.isNode)return Buffer.from(t,"base64");for(var e=atob(t),n=new Dt.Array8U(e.length),i=0,r=e.length;i<r;++i)n[i]=e.charCodeAt(i);return n.buffer}function qa(){}function Va(t){return t&&t.instance&&t.instance.isOn()}function Ka(t,e,n){var i,r,a;return e/=100,e=(1-h.abs(2*(n/=100)-1))*e,i=h.floor((t=t/60)/2),i=e*(1-h.abs(t-2*i-1)),n=n-e/2,t=0<=t&&t<1?(r=e+n,a=i+n,0+n):1<=t&&t<2?(r=i+n,a=e+n,0+n):2<=t&&t<3?(r=0+n,a=e+n,i+n):3<=t&&t<4?(r=0+n,a=i+n,e+n):4<=t&&t<5?(r=i+n,a=0+n,e+n):(r=e+n,a=0+n,i+n),[m(h.round(255*r),0,255),m(h.round(255*a),0,255),m(h.round(255*t),0,255)]}function Za(t,e,n){var e=(n/=100)*(1-e/200),i=h.min(e,1-e);return Ka(t,0===i?0:100*(n-e)/i,100*e)}function Ja(t,e,n){n=1-n/100;return Za(t,100-e/n,100*n)}function Qa(t,e,n,i,r){var a,l,o,s,u;return i?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=i=h.max(t,e,n),s=o=h.min(t,e,n),u=1-i,n=0==(l=i-o)?0:a===t?60*(0+(e-n)/l):a===e?60*(2+(n-t)/l):60*(4+(t-e)/l),e=0==(t=(i+o)/2)||1==t?0:(a-t)/h.min(t,1-t),i=0===a?0:l/a,"hwb"===r?[m(h.round(n),0,360),m(100*s,0,100),m(100*u,0,100)]:"hsv"===r?[m(h.round(n),0,360),m(100*i,0,100),m(100*a,0,100)]:[m(h.round(n),0,360),m(100*e,0,100),m(100*t,0,100)]}function tl(t,e,n,i){return Qa(t,e,n,i,"hsl")}function el(t,e,n,i){return Qa(t,e,n,i,"hsv")}function nl(t,e,n,i){return Qa(t,e,n,i,"hwb")}function il(t,e,n,i){return i&&(t=m(Wt(t*re),0,255),e=m(Wt(e*re),0,255),n=m(Wt(n*re),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((i=1-t*ie)-(e=$t(i,t=1-e*ie,i=1-n*ie)))*(n=1/(1-e)),(t-e)*n,(i-e)*n,e]}function rl(t,e,n,i){var r;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(r=1-i)+i)),n=255*(1-(n=n*r+i)),[m(Wt(255*(1-(t=t*r+i))),0,255),m(Wt(e),0,255),m(Wt(n),0,255)])}function al(t,e,n){return ne[0]*t+ne[1]*e+ne[2]*n}function ll(t,e,n,i){i=i||6;var r,a,l,o,s,u,c,f=!1,h=!!t.selection;return c=h?(r=t.selection,c=t.width-1,u=t.height-1,s=r[5]?r[5].bbox():null,a=r[5]?s.from.x:r[0],l=r[5]?s.from.y:r[1],o=r[5]?s.to.x:r[2],s=r[5]?s.to.y:r[3],c=!r[5]&&r[4]?c:1,r=!r[5]&&r[4]?u:1,a=+g(a*c),l=+g(l*r),u=(o=+g(o*c))-a+1,(s=+g(s*r))-l+1):(u=t.width,t.height),2&i&&u!==e&&(t.width=ue.round(h?t.width/u*e:e),t.oCanvas.width=+t.width,t._restorable&&(t.iCanvas.width=t.oCanvas.width),f=!0),4&i&&c!==n&&(t.height=ue.round(h?t.height/c*n:n),t.oCanvas.height=+t.height,t._restorable&&(t.iCanvas.height=t.oCanvas.height),f=!0),f}function ol(t,e){var n=t.oCanvas.width,i=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d",t.ctxOpts).getImageData(0,0,n,i),t.iData||(t.iData=t.iCanvas.getContext("2d",t.ctxOpts).createImageData(n,i)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d",t.ctxOpts).getImageData(0,0,n,i),t.oData||(t.oData=t.oCanvas.getContext("2d",t.ctxOpts).createImageData(n,i)),t._refresh&=-3)}function sl(t,e){var n,i,r,a,l,o,s;t.selection&&(n=t.selection,s=t.width-1,o=t.height-1,l=n[5]?n[5].bbox():null,i=n[5]?l.from.x:n[0],r=n[5]?l.from.y:n[1],a=n[5]?l.to.x:n[2],l=n[5]?l.to.y:n[3],s=!n[5]&&n[4]?s:1,n=!n[5]&&n[4]?o:1,i=+g(i*s),r=+g(r*n),o=(a=+g(a*s))-i+1,s=(l=+g(l*n))-r+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d",t.ctxOpts).getImageData(i,r,o,s),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d",t.ctxOpts).createImageData(o,s)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d",t.ctxOpts).getImageData(i,r,o,s),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d",t.ctxOpts).createImageData(o,s)),t._refresh&=-9)}function ul(t,e){var e=e?an(e):"",t=an(t.filter||t),n=rn?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(Ze)}!function(t,N,v){function e(){}function n(t){var e;return y?{file:__filename,path:__dirname}:C||A?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:U&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:S&&(e=document.getElementsByTagName("script"))&&e.length?((n.link=n.link?n.link:document.createElement("a")).href=e[e.length-1].src,{file:e=n.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var o,i="prototype",r=Object,a=Array,l=Function[i],r=r[i],a=a[i],H=(JSON.parse,JSON.stringify),s=(r.hasOwnProperty,function(t,e){return function(){return t(e)}}),u=l.call.bind(a.slice),l=r.toString,b=function(t){return"function"==typeof t},c=function(t,e){return t instanceof e},f=setTimeout,h=clearTimeout,a=v,m=60,p=0,d=1,g=2,x=3,_=4,r="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,y="undefined"!=typeof global&&"[object global]"===l.call(global),w=y&&void 0!==process.send,C=!r&&!y&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,A=!r&&!y&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,S=!(r||y||A||C||"undefined"==typeof navigator||"undefined"==typeof document),U=(S&&window.opener,S&&(window.self,window.top),"function"==typeof define&&define.amd),D=y||"function"==typeof Worker||"function"==typeof SharedWorker,I=y?t:C||A?self||t:window||t,R=y?module.$deps:C||A?self||this:window||this,z=(y?global:C||A?self:window,w||C||A),L=w&&0===process.listenerCount("message")||C&&!I.onconnect||A&&!I.onmessage,E=L?function t(e){t.handler&&t.handler(w?e:e.data)}:e,M=null,T={},O=(y&&require("os").cpus().length,y?null:void 0!==I.webkitURL?I.webkitURL:void 0!==I.URL?I.URL:null),B=n(P.moduleUri).file,G=(T[B]=1,y?((o=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=o)[i]={constructor:o,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((o=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=o)[i]={constructor:o,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(o.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},o.Shared[i]={constructor:o.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),L&&(C?(I.close=e,I.postMessage=e,I.onconnect=function(t){var e=t.ports[0];I.close=function(){e.close()},I.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",E),e.start()}):A?I.onmessage=E:w&&(I.close=function(){process.exit()},I.postMessage=function(t){process.send(t)},I.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(R)}catch(t){throw t}},process.on("message",E))),function t(e){var i,n,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y;return e instanceof t?e:this instanceof t?(f=c=u=s=o=l=!1,m=0,p=1,x=g=d=h=a=r=n=null,_=v,(i=this).queue=function(t){return arguments.length?(n=t,i):n},i.jumpNext=function(t){n&&n.jumpNext(!1,t)},i.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},i.dispose=function(){n&&(n.dispose(),n=null)},i.task=function(t){return r=t,i},e&&i.task(e),i.run=y=function(){return r.jumpNext=i.jumpNext,r.abort=i.abort,r.dispose=i.dispose,_=r(),l=!0,r.jumpNext=null,r.abort=null,r.dispose=null,_},i.runWithArgs=function(t){return r.jumpNext=i.jumpNext,r.abort=i.abort,r.dispose=i.dispose,_=r.apply(null,t),l=!0,r.jumpNext=null,r.abort=null,r.dispose=null,_},i.canRun=function(){return!!r&&!!(!l||o||s||u||c||f)&&!((o||s)&&d<=m||s&&!h||(u||c)&&_===g)},i.iif=function(t,e,n){return(t=b(t)?t():t)?i.task(e):2<arguments.length&&i.task(n),i},i.until=function(t){return _=v,g=t,u=s=o=f=!(c=!(h=null)),i.run=y,i},i.untilNot=function(t){return _=v,x=t,u=s=o=c=!(f=!(h=null)),i.run=y,i},i.loop=function(t,e,n){return _=v,m=e||0,p=n||1,d=t,u=s=f=c=!(o=!(h=null)),i.run=function(){var t=r(m);return m+=p,l=!0,_=t},i},i.each=function(t){return _=v,m=0,p=1,d=(h=t)&&t.length||0,u=o=f=c=!(s=!0),i.run=function(){var t=r(h[m],m);return++m,l=!0,_=t},i},i.recurse=function(t,e){return _=t,g=e,s=o=f=c=!(u=!(h=null)),i.run=function(){var t=r(_);return l=!0,_=t},i},i.isFinished=function(){var t=!l||f||c||o||s||u;return!(t=(t=(t=t&&(c||u)&&_===g?!1:t)&&f&&_!==x?!1:t)&&(o||s)&&d<=m?!1:t)},i.onComplete=function(t){return a=t||null,i},void(i.complete=function(){return a&&b(a)&&a(),i})):new t(e)});function Y(t,e){var n,i=t.$queue,r=0;if(t.$runmode=d,i&&i.length){for(t.$running=!0;r<i.length;)(n=i[r])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(i.shift(),n.complete()):++r):i.shift();t.$running=!1,t.$timer=f(s(Y,t),t.$interval)}}function k(t,e){var n,i=t.$queue;t.$runmode=_,i&&i.length&&((n=i[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(i.shift(),n.complete())):i.shift(),t.$running=!1,t.$timer=f(s(k,t),t.$interval))}function F(t,e){var n;return c(t,G)?t:b(t)?new G(t):c(this,F)?((n=this).$interval=arguments.length&&parseInt(t,10)||m,n.$timer=null,n.$runmode=p,n.$running=!1,n.$queue=[],void(L&&!1!==e&&n.initThread())):new F(t,e)}F.VERSION="0.5.1",F.Thread=o,F.Task=G,F.MODE={NONE:p,INTERLEAVE:d,LINEAR:g,PARALLEL:x,SEQUENCE:_},F.Platform={UNDEFINED:a,UNKNOWN:0,NODE:1,BROWSER:2},F.supportsMultiThreading=function(){return D},F.isPlatform=function(t){return 1===t?y:2===t?S:void 0},F.isThread=function(t,e){return e=!0!==e||L,1===t?e&&w:2===t?e&&(C||A):e&&z},F.path=n,F.blob=function(t,e){return t&&O?O.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t},F.load=function(t,e,n){if(t){e&&e.length&&F.importScripts(e.join?e.join(","):e),t=t.split(".");for(var i=R;t.length;)t[0]&&t[0].length&&i[t[0]]&&(i=i[t[0]]),t.shift();return i&&I!==i?b(i)?!1!==n?new i:i():i:void 0}return null},F.listen=L?function(t){E.handler=t}:e,F.send=L?function(t){I.postMessage(t)}:e,F.importScripts=L?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var i=t[e];i&&i.length&&1!==T[i]&&(I.importScripts(i),T[i]=1)}}:e,F.close=L?function(){I.close()}:e,F.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,F.serialize=function(i){i=i||new F(0,!1);function t(n){function t(){var t=this,e=arguments;i.step(function(){n.apply(t,e)}),i.$running||i.run(g)}return t.free=function(){return n},t}return t.free=function(){i&&i.dispose(),i=null},t},F[i]={constructor:F,$interval:m,$timer:null,$queue:null,$thread:null,$events:null,$runmode:p,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&h(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=p,e.$running=!1,L&&!0===t&&F.close(),e},empty:function(){var t=this;return t.$timer&&h(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=p,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,i){var r,a,l=this;if(!l.$thread){if(!D)throw l.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");a=y?(r="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(r="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),l.$events=l.$events||{},(i=l.$thread=new(!0===i?o.Shared:o)(B)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,l.$events&&l.$events[e]?l.$events[e](t):"console.log"!==e&&"console.error"!==e||F.log(("console.error"===e?a:r)+(t||"")))},i.onerror=function(t){if(!l.$events||!l.$events.error)throw new Error(a+t.toString());l.$events.error(t)},l.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return l},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return L&&(n.$events={},F.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),F.close())})),n},listen:function(t,e){return t&&b(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(L?F.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return c(t,G)?t:b(t)?G(t):void 0},iif:function(){var t=arguments,e=new G;return e.iif.apply(e,t)},until:function(){var t=u(arguments),e=new G(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=u(arguments),e=new G(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=u(arguments),e=new G(t.pop());return e.loop.apply(e,t)},each:function(){var t=u(arguments),e=new G(t.pop());return e.each.apply(e,t)},recurse:function(){var t=u(arguments),e=new G(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,i=n.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),n.run(n.$runmode)),n}:(e<i.length&&(0<e&&i.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var i=this,r=i.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),i.run(i.$runmode,arguments)),i}:(e<r.length&&(0<e&&r.splice(0,e),i.run(i.$runmode,n)),i)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?f(function(){n.empty()},e):n.empty(),n}:(e&&0<e?f(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,_===t)k(n,e);else if(d===t)Y(n,e);else if(g===t){var i,r=n,a=r.$queue;if(r.$runmode=g,a){for(;a.length&&(!a[0]||!a[0].canRun());)a.shift();a.length?(r.$running=!0,i=a.shift(),e?i.runWithArgs(e):i.run(),i.complete()):r.$running=!1}}else x===t&&((e=n).$runmode=x,e.$running=!1);return n}},L&&(F.log=function(t){F.send({event:"console.log",data:"string"!=typeof t?H(t):t})},F.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(M&&(b(M.dispose)&&M.dispose(),M=null),M=F.load(n.component,n.imports,n.asInstance));break;case"dispose":M&&(b(M.dispose)&&M.dispose(),M=null),F.close()}})),N.Asynchronous=F}(this,w),a=w,S="prototype",D=Object[S].hasOwnProperty,Object[S].toString,Object.defineProperty,b=Math,I=function(){},R=0,xa.Merge=function(){for(var t,e,n=arguments.length,i=n?arguments[0]:null,r=1;r<n;++r)for(t in e=arguments[r])D.call(e,t)&&(i[t]=e[t]);return i},a.Class=xa,a.Path=a.Asynchronous.path(P.moduleUri),a.uuid=function(t){return[t||"filter",(new Date).getTime(),++R].join("_")},a.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},y=a.Asynchronous,e=y.isPlatform(y.Platform.NODE),L=y.isPlatform(y.Platform.BROWSER),r=y.supportsMultiThreading(),A=y.isThread(null,!0),t=y.isThread(),i="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",n="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",v="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",a.global=e?global:t?self:window,(e=a.Browser={isNode:e,isBrowser:L,isWorker:A,isInsideWorker:t,supportsWorker:r,isPhantom:/PhantomJS/.test(i),isOpera:L&&/Opera|OPR\//.test(i),isFirefox:L&&/Firefox\//.test(i),isChrome:L&&/Chrome\//.test(i),isSafari:L&&/Apple Computer/.test(v),isKhtml:L&&/KHTML\//.test(i),isIE:L&&(/MSIE \d/.test(i)||/Trident\/\d/.test(i)),isEdge:L&&/Edg/.test(i),isGecko:L&&/gecko\/\d/i.test(i),isWebkit:L&&/WebKit\//.test(i),isMac_geLion:L&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(i),isMac_geMountainLion:L&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(i),isMobile:!1,isIOS:/AppleWebKit/.test(i)&&/Mobile\/\w+/.test(i),isWin:/windows/i.test(n),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=e.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(i),e.isMac=e.isIOS||/Mac/.test(n),e.isIE_lt8=e.isIE&&!t&&(null==document.documentMode||document.documentMode<8),e.isIE_lt9=e.isIE&&!t&&(null==document.documentMode||document.documentMode<9),e.isQtWebkit=e.isWebkit&&/Qt\/\d+\.\d+/.test(i),a.getPath=y.path,a.log=A?y.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},a.warning=function(t){a.log("WARNING: "+t)},a.error=function(t,e){if(a.log("ERROR: "+t),e)throw new Error(String(t))},a.devicePixelRatio=(L&&!t?window.devicePixelRatio:1)||1,a._notSupportClamp="undefined"==typeof Uint8ClampedArray||e.isOpera,a.Array=Array,a.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,a.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,a.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,a.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,a.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,a.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,a.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,a.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,a.ArrayBuffer="undefined"!=typeof ArrayBuffer?ArrayBuffer:"undefined"!=typeof Buffer?Buffer:Array,a.ColorTable=a.ImArray=a._notSupportClamp?a.Array8U:Uint8ClampedArray,a.AffineMatrix=a.ColorMatrix=a.ConvolutionMatrix=a.Array32F,a.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26,COLORIZE:30,COLORIZEHUE:31,CHANNEL:32},a.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},a.POS={X:0,Y:1},a.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},a.LUMA=a.LUMA_YUV=a.LUMA_YIQ=new a.Array32F([.2126,.7152,.0722]),a.LUMA_YCbCr=new a.Array32F([.299,.587,.114]),a.LUMA_GREEN=new a.Array32F([0,1,0]),a.CONSTANTS=a.CONST={X:0,Y:1,Z:2,PI:b.PI,PI2:2*b.PI,PI_2:b.PI/2,toRad:b.PI/180,toDeg:180/b.PI},a.FORMAT={IMAGE:1024,DATA:2048},a.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[S].set,hasSubarray:"function"==typeof a.Array32F[S].subarray},Math:{},Filter:{},Image:{},GLSL:{isSupported:!1,isLoaded:!1},WASM:{isSupported:!1,isLoaded:!1}},a.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n},a.Canvas.Image=function(){return new Image},a.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},M=E=null,a.supportsGLSL=function(){if(null==E){var t,e=null,n=null,i=["webgl","experimental-webgl"],r=null;try{e=a.Canvas(1,1)}catch(t){e=null}if(e)for(t=0;t<i.length;++t){r=i[t],n=null;try{n=e.getContext(r)}catch(t){n=null}if(n)break}(E=!!n)&&(M=r),e=n=null}return E},a.setGLDimensions=function(t,e,n){return t&&t.gl&&(t.gl.width!==e&&(t.gl.width=e),t.gl.height!==n)&&(t.gl.height=n),t},a.getGL=function(t,e,n){if(t&&a.supportsGLSL())return t.gl||(t.gl=a.Canvas(e,n),L&&t.gl&&t.gl.addEventListener&&t.gl.addEventListener("webglcontextlost",_a,!1)),a.setGLDimensions(t,e,n),t.gl.getContext(M)},a.disposeGL=function(t){t&&t.gl&&L&&t.gl.removeEventListener&&t.gl.removeEventListener("webglcontextlost",_a,!1)},G=null,a.supportsWASM=function(){if(null==G){G=!1;var t=null;try{"object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate&&"undefined"!=typeof Uint8Array&&(t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0)),G=t instanceof WebAssembly.Module&&new WebAssembly.Instance(t)instanceof WebAssembly.Instance)}catch(t){G=!1}t=null}return G},F=0,a.waitFor=function(t){F+=t||0},a.unwaitFor=function(t){F-=t||0},a.onReady=function(e){(function t(){0<F?setTimeout(t,100):e()})()},(O=w).Util.Array=O.Util.Array||{},O.Util.String=O.Util.String||{},O.Util.Math=O.Util.Math||{},O.Util.Image=O.Util.Image||{},O.Util.Filter=O.Util.Filter||{},lt=O.MODE,r=O._notSupportClamp,ot=O.ImArray,st=O.Array32F,O.Array64F,O.Array32I,k=O.Array16I,H=O.Array8U,z=O.ColorTable,j=O.ColorMatrix,X=O.AffineMatrix,O.ConvolutionMatrix,v=O.Util.Array,n=O.Util.String,i=O.Util.Math,A=O.Util.Image,y=O.Util.Filter,(V=Math).exp,W=V.sqrt,$=V.pow,V.ceil,V.floor,V.log,V.sin,V.cos,Z=V.min,J=V.max,Q=V.abs,K=V.PI,tt=V.SQRT1_2,V.log2,et=/([.*+?^${}()|\[\]\/\\\-])/g,nt=/^\s+|\s+$/g,it=/^function[^{]+{([\s\S]*)}$/,n.esc=function(t){return t.replace(et,"\\$1")},n.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(nt,"")},n.function_body=function(t){return t.toString().match(it)[1]||""},i.clamp=ya,i.hypot=function(t,e,n){n=n||0,e=e||0;var i=J(Q(t),Q(e),Q(n));return 0===i?0:i*W((t/=i)*t+(e/=i)*e+(n/=i)*n)},A.crop=v.hasArrayset?function(t,e,n,i,r,a,l){a=Z(a,e-1),l=Z(l,n-1);for(var o,s=new ot((n=a-i+1)*(l-r+1)<<2),u=n<<2,c=r,f=r*e,h=0;c<=l;++c,f+=e,h+=u)s.set(t.subarray(o=f+i<<2,o+u),h);return s}:function(t,e,n,i,r,a,l){a=Z(a,e-1),l=Z(l,n-1);for(var o,s=new ot((n=a-i+1)*(l-r+1)<<2),u=n<<2,c=r,f=r*e,h=0;c<=l;++c,f+=e,h+=u)va(s,t,h,o=f+i<<2,o+u);return s},A.pad=v.hasArrayset?function(t,e,n,i,r,a,l){for(var i=e+(a=a||0)+(i=i||0),o=new ot(i*(n+(l=l||0)+(r=r||0))<<2),s=e<<2,u=i<<2,c=a<<2,f=0,h=0,m=l*u;f<n;++f,h+=s,m+=u)o.set(t.subarray(h,h+s),m+c);return o}:function(t,e,n,i,r,a,l){for(var i=e+(a=a||0)+(i=i||0),o=new ot(i*(n+(l=l||0)+(r=r||0))<<2),s=e<<2,u=i<<2,c=a<<2,f=0,h=0,m=l*u;f<n;++f,h+=s,m+=u)va(o,t,m+c,h,h+s);return o},A.interpolate_nearest=function(t,e,n,i,r){for(var a,l,o=i*r<<2,s=new ot(o),u=V.round,c=0,f=0,h=0;h<o;h+=4,++c)i<=c&&(c=0,++f),a=ya(u(c/i*e),0,e-1),l=ya(u(f/r*n),0,n-1),s[h]=t[l=l*e+a<<2],s[h+1]=t[1+l],s[h+2]=t[2+l],s[h+3]=t[3+l];return s},A.interpolate=A.interpolate_bilinear=function(t,e,n,i,r){for(var a,l,o,s,u,c,f,h,m,p,d=i*r<<2,g=new ot(d),x=(e-1)/i,_=(n-1)/r,y=e<<2,v=V.round,b=0,w=0,C=0,A=0,S=0,D=0;D<d;D+=4,++b,w+=x)i<=b&&(S=(C+=_)-(p=(w=b=0)|C),A=p*e),a=t[h=A+(p=0|w)<<2],l=t[4+h],o=t[h+y],s=t[h+y+4],g[D]=ya(v(a*(u=(1-(m=w-p))*(1-S))+l*(c=m*(1-S))+o*(f=S*(1-m))+s*(m=m*S)),0,255),a=t[1+h],l=t[5+h],o=t[h+y+1],s=t[h+y+5],g[D+1]=ya(v(a*u+l*c+o*f+s*m),0,255),a=t[2+h],l=t[6+h],o=t[h+y+2],s=t[h+y+6],g[D+2]=ya(v(a*u+l*c+o*f+s*m),0,255),a=t[3+h],l=t[7+h],o=t[h+y+3],s=t[h+y+7],g[D+3]=ya(v(a*u+l*c+o*f+s*m),0,255);return g},v.copy=v.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return va(e,t,0,0,t.length-1),e},y.sat=function(t,e,n,i,r,a,l,o,s){for(var u,c,f,h,m=t.length,p=e<<i,d=1<<i,g=u=0,x=0+r,_=0;x<p;x+=d,++_)g+=c=t[x],a[_]=g,l&&(l[_]=u+=c*c),o&&(o[_]=c),s&&(s[_]=c*c);for(h=1,x=p+r,_=g=u=f=0;x<m;x+=d,++_)g+=c=t[x],a[_+e]=a[_]+g,l&&(l[_+e]=l[_]+(u+=c*c)),o&&(o[_+e]=(o[_+1-e]||0)+(c+(t[_-e<<i]||0))+(1<h&&o[_-e-e]||0)+(0<f&&o[_-1-e]||0)),s&&(s[_+e]=(s[_+1-e]||0)+(c*c+(t[_-e<<i]||0)*(t[_-e<<i]||0))+(1<h&&s[_-e-e]||0)+(0<f&&s[_-1-e]||0)),++f>=e&&(++h,g=u=f=0)},ut=ba(5,5,1.4),y.gaussian=ba,y.gradient=function(t,e,n,i,r,a,l,o,s,u,c,f){var h,m,p,d,g,x,_,y,v,b,w,C,A=i,S=t.length>>>i,D=e-1,I=n-1,R=1<<i,L=R<<1,E=e<<i,M=new st(S),T=new st(S);if(a){for(g=e-2,x=n-2,a=e<<1,C=new st(S),w=ut,p=m=2,d=a;p<x&&!(g<=m&&(m=2,d+=e,x<=++p));++m)_=(h=m+d)<<i,0<i&&0===t[_+3]?C[h]=0:C[h]=w[0]*t[(b=(v=(_+=r)-E)-E)-L]+w[1]*t[b-R]+w[2]*t[b]+w[3]*t[b+R]+w[4]*t[b+L]+w[5]*t[v-L]+w[6]*t[v-R]+w[7]*t[v]+w[8]*t[v+R]+w[9]*t[v+L]+w[10]*t[_-L]+w[11]*t[_-R]+w[12]*t[_]+w[13]*t[_+R]+w[14]*t[_+L]+w[15]*t[(y=_+E)-L]+w[16]*t[y-R]+w[17]*t[y]+w[18]*t[y+R]+w[19]*t[y+L]+w[20]*t[(b=y+E)-L]+w[21]*t[b-R]+w[22]*t[b]+w[23]*t[b+R]+w[24]*t[b+L];R=1,L=2,E=e,r=i=0}else C=t;for(p=m=1,d=e;p<I&&!(D<=m&&(m=1,d+=e,I<=++p));++m)M[h=d+m]=C[(v=(_=(h<<i)+r)-E)+R]-C[v-R]+2*(C[_+R]-C[_-R])+(C[(y=_+E)+R]-C[y-R]),T[h]=C[v-R]-C[y-R]+2*(C[v]-C[y])+(C[v+R]-C[y+R]);return wa(M,T,t,e,n,A,l,o,s,u,c,f)},y.optimum_gradient=wa,y.gradient_glsl=function(){function t(t,e){return n(ut[t],!e)}var n=O.Util.GLSL.formatFloat;return{lowpass:["vec4 lowpass(sampler2D img, vec2 pix, vec2 dp) {","   float a = texture2D(img, pix).a;","   if (0.0 == a || 0.0 > pix.x-2.0*dp.x || 0.0 > pix.y-2.0*dp.y || 1.0 < pix.x+2.0*dp.x || 1.0 < pix.y+2.0*dp.y) return vec4(0.0, 0.0, 0.0, a);","   return vec4("+t(0,1)+"*texture2D(img, pix+vec2(-2.0,-2.0)*dp).rgb"+t(1)+"*texture2D(img, pix+vec2(-1.0,-2.0)*dp).rgb"+t(2)+"*texture2D(img, pix+vec2(0.0,-2.0)*dp).rgb"+t(3)+"*texture2D(img, pix+vec2(1.0,-2.0)*dp).rgb"+t(4)+"*texture2D(img, pix+vec2(2.0,-2.0)*dp).rgb"+t(5)+"*texture2D(img, pix+vec2(-2.0,-1.0)*dp).rgb"+t(6)+"*texture2D(img, pix+vec2(-1.0,-1.0)*dp).rgb"+t(7)+"*texture2D(img, pix+vec2(0.0,-1.0)*dp).rgb"+t(8)+"*texture2D(img, pix+vec2(1.0,-1.0)*dp).rgb"+t(9)+"*texture2D(img, pix+vec2(2.0,-1.0)*dp).rgb"+t(10)+"*texture2D(img, pix+vec2(-2.0,0.0)*dp).rgb"+t(11)+"*texture2D(img, pix+vec2(-1.0,0.0)*dp).rgb"+t(12)+"*texture2D(img, pix+vec2(0.0,0.0)*dp).rgb"+t(13)+"*texture2D(img, pix+vec2(1.0,0.0)*dp).rgb"+t(14)+"*texture2D(img, pix+vec2(2.0,0.0)*dp).rgb"+t(15)+"*texture2D(img, pix+vec2(-2.0,1.0)*dp).rgb"+t(16)+"*texture2D(img, pix+vec2(-1.0,1.0)*dp).rgb"+t(17)+"*texture2D(img, pix+vec2(0.0,1.0)*dp).rgb"+t(18)+"*texture2D(img, pix+vec2(1.0,1.0)*dp).rgb"+t(19)+"*texture2D(img, pix+vec2(2.0,1.0)*dp).rgb"+t(20)+"*texture2D(img, pix+vec2(-2.0,2.0)*dp).rgb"+t(21)+"*texture2D(img, pix+vec2(-1.0,2.0)*dp).rgb"+t(22)+"*texture2D(img, pix+vec2(0.0,2.0)*dp).rgb"+t(23)+"*texture2D(img, pix+vec2(1.0,2.0)*dp).rgb"+t(24)+"*texture2D(img, pix+vec2(2.0,2.0)*dp).rgb, a);","}"].join("\n"),gradient:["vec2 sobel_gradient(sampler2D i, vec2 p, vec2 d) {","   if (0.0 > pix.x-d.x || 0.0 > pix.y-d.y || 1.0 < pix.x+d.x || 1.0 < pix.y+d.y) return vec2(0.0);","    return vec2(","    (texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,-1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(1.0,0.0)*d).r-texture2D(i, p+vec2(-1.0,0.0)*d).r)","    +(texture2D(i, p+vec2(1.0,1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    ,","    (texture2D(i, p+vec2(-1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(0.0,-1.0)*d).r-texture2D(i, p+vec2(0.0,1.0)*d).r)","    +(texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(1.0,1.0)*d).r)","    );","}","float gradient_suppressed(sampler2D img, vec2 pix, vec2 dp, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    vec2 g = sobel_gradient(img, pix, dp);","    vec2 gn = sobel_gradient(img, pix+vec2(0.0,-1.0)*dp, dp);","    vec2 gs = sobel_gradient(img, pix+vec2(0.0,1.0)*dp, dp);","    vec2 gw = sobel_gradient(img, pix+vec2(-1.0,0.0)*dp, dp);","    vec2 ge = sobel_gradient(img, pix+vec2(1.0,0.0)*dp, dp);","    vec2 gnw = sobel_gradient(img, pix+vec2(-1.0,-1.0)*dp, dp);","    vec2 gne = sobel_gradient(img, pix+vec2(1.0,-1.0)*dp, dp);","    vec2 gsw = sobel_gradient(img, pix+vec2(-1.0,1.0)*dp, dp);","    vec2 gse = sobel_gradient(img, pix+vec2(1.0,1.0)*dp, dp);","    float gM = length(g);","    float gnM = length(gn);","    float gsM = length(gs);","    float gwM = length(gw);","    float geM = length(ge);","    float gnwM = length(gnw);","    float gneM = length(gne);","    float gswM = length(gsw);","    float gseM = length(gse);","    float gg = 0.0; float tmp;","    if (g.x*g.y <= 0.0)","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gneM - (g.x + g.y) * geM) && tmp > abs(g.y * gswM - (g.x + g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gneM - (g.y + g.x) * gnM) && tmp > abs(g.x * gswM - (g.y + g.x) * gsM))","            {","                gg = 1.0;","            }","        }","    }","    else","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gseM + (g.x - g.y) * geM) && tmp > abs(g.y * gnwM + (g.x - g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gseM + (g.y - g.x) * gsM)","                && tmp > abs(g.x * gnwM + (g.y - g.x) * gnM))","            {","                gg = 1.0;","            }","        }","    }","    if (0.0 < gg)","    {","        if (gM >= magnitude_limit)","        {","            gg = magnitude_max;","        }","        else","        {","            gg = magnitude_scale * gM;","        }","    }","    return gg;","}","vec4 gradient(sampler2D img, vec2 pix, vec2 dp, float low, float high, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    float a = texture2D(img, pix).a;","    if (0.0 == a) return vec4(0.0);","    float g = gradient_suppressed(img, pix, dp, magnitude_scale, magnitude_limit, magnitude_max);","    if (g >= high) return vec4(vec3(1.0), a);","    else if (g < low) return vec4(vec3(0.0), a);","    return vec4(vec3(/*clamp((g-low)/(high-low)-0.1, 0.0, 0.9)/0.9*/0.01), a);","}"].join("\n"),hysteresis:["vec4 hysteresis(sampler2D img, vec2 pix, vec2 dp) {","   vec4 g = texture2D(img, pix);","   float x; float y; vec4 gg;","   if (0.0 < g.r && 1.0 > g.r) {","       for (int i=-1; i<=1; ++i) { x = float(i);","           if (0.0 > pix.x+x*dp.x || 1.0 < pix.x+x*dp.x) continue;","           for (int j=-1; j<=1; ++j) { y = float(j);","               if (0==i && 0==j) continue;","               if (0.0 > pix.y+y*dp.y || 1.0 < pix.y+y*dp.y) continue;","               gg = texture2D(img, pix+vec2(x,y)*dp);","               if (1.0 == gg.r) return vec4(vec3(1.0), g.a);","           }","       }","   }","   return g;","}"].join("\n")}},A.glsl=function(){return{crop:["vec4 crop(vec2 pix, sampler2D img, vec2 wh, vec2 nwh, float x1, float y1, float x2, float y2) {","   vec2 start = vec2(x1, y1)/wh; vec2 end = vec2(x2, y2)/wh;","   return texture2D(img, start + pix*(end-start));","}"].join("\n"),pad:["vec4 pad(vec2 pix, sampler2D img, vec2 wh, vec2 nwh, float pad_right, float pad_bot, float pad_left, float pad_top) {","   vec2 p = pix*nwh - vec2(pad_left, pad_top);","   if (p.x < 0.0 || p.x > wh.x || p.y < 0.0 || p.y > wh.y) return vec4(0.0);","   return texture2D(img, p/wh);","}"].join("\n"),interpolate:["vec4 interpolate_nearest(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   return texture2D(img, pix);","}","vec4 interpolate_bilinear(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   if (wh.x == nwh.x && wh.y == nwh.y) return texture2D(img, pix);","   vec2 xy = pix*wh /*+ vec2(0.5)*/;","   vec2 xyi = floor(xy);","   vec2 x1yi = xyi + vec2(1.0, 0.0);","   vec2 xy1i = xyi + vec2(0.0, 1.0);","   vec2 x1y1i = xyi + vec2(1.0, 1.0);","   vec2 d = (xy - xyi);","   return (1.0-d.x)*(1.0-d.y)*texture2D(img, xyi/wh) + (d.x)*(1.0-d.y)*texture2D(img, x1yi/wh) + (1.0-d.x)*(d.y)*texture2D(img, xy1i/wh) + (d.x)*(d.y)*texture2D(img, x1y1i/wh);","}","vec4 interpolate(vec2 pix, sampler2D img, vec2 wh, vec2 nwh) {","   return interpolate_bilinear(pix, img, wh, nwh);","}"].join("\n")}},y.integral_convolution=r?function(N,t,e,H,U,n,z,B,Y,k,P,i,r,j){var a,l,o,s,u,c,f,h,m,p,d,g,X,x,_,y,v,b,w,C,A,S,D,I,R,W,$,q,L,E,M=t.length,V=M>>>U,K=e<<U,T=1<<U,U=B*Y,Z=-(B=B>>>1)-1,J=-(Y=e*(Y>>>1))-e,Q=B,tt=Y,B=k*P,et=-(Y=k>>>1)-1,nt=-(k=e*(P>>>1))-e,it=Y,rt=k,O=e-1,G=V-e,F=t;if(t=new ot(M),j=j||1,lt.GRAY===N)if(u=e,a=new st(V),z)for(p=n[0],d=n[U>>>1]-p,g=z[0],X=z[B>>>1]-g,L=0;L<j;++L){for(E=t,t=F,F=E,h=l=f=c=0;h<e;h++,c+=T,++f)l+=t[c],a[f]=l;for(l=h=f=0,c=K;c<M;c+=T,++f,++h)e<=h&&(l=h=0),l+=t[c],a[f+u]=a[f]+l;for(c=m=h=0;c<M;c+=T,++h)e<=h&&(h=0,m+=e),R=p*(a[A=(y=O<(y=h+Q)?O:y)+(v=G<(v=m+tt)?G:v)]-a[w=y+(_=(_=m+J)<0?0:_)]-a[C=(x=(x=h+Z)<0?0:x)+v]+a[b=x+_])+d*t[c],q=g*(a[A=(y=O<(y=h+it)?O:y)+(v=G<(v=m+rt)?G:v)]-a[w=y+(_=(_=m+nt)<0?0:_)]-a[C=(x=(x=h+et)<0?0:x)+v]+a[b=x+_])+X*t[c],F[c]=0|(S=(S=i*R+r*q)<0?0:255<S?255:S),F[c+1]=0|S,F[c+2]=0|S,F[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,L=0;L<j;++L){for(E=t,t=F,F=E,h=l=f=c=0;h<e;h++,c+=T,++f)l+=t[c],a[f]=l;for(l=h=f=0,c=K;c<M;c+=T,++f,++h)e<=h&&(l=h=0),l+=t[c],a[f+u]=a[f]+l;for(c=m=h=0;c<M;c+=T,++h)e<=h&&(h=0,m+=e),R=p*(a[A=(y=O<(y=h+Q)?O:y)+(v=G<(v=m+tt)?G:v)]-a[w=y+(_=(_=m+J)<0?0:_)]-a[C=(x=(x=h+Z)<0?0:x)+v]+a[b=x+_])+d*t[c],F[c]=0|(S=(S=i*R+r)<0?0:255<S?255:S),F[c+1]=0|S,F[c+2]=0|S,F[c+3]=t[c+3]}else if(u=(e<<1)+e,a=new st((V<<1)+V),z)for(p=n[0],d=n[U>>>1]-p,g=z[0],X=z[B>>>1]-g,L=0;L<j;++L){for(E=t,t=F,F=E,h=l=o=s=f=c=0;h<e;++h,c+=T,f+=3)l+=t[c],o+=t[c+1],s+=t[c+2],a[f]=l,a[f+1]=o,a[f+2]=s;for(l=o=s=h=f=0,c=K;c<M;c+=T,f+=3,++h)e<=h&&(l=o=s=h=0),l+=t[c],o+=t[c+1],s+=t[c+2],a[f+u]=a[f]+l,a[f+u+1]=a[f+1]+o,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<M;c+=T,++h)e<=h&&(h=0,m+=e),R=p*(a[A=((A=(y=O<(y=h+Q)?O:y)+(v=G<(v=m+tt)?G:v))<<1)+A]-a[w=((w=y+(_=(_=m+J)<0?0:_))<<1)+w]-a[C=((C=(x=(x=h+Z)<0?0:x)+v)<<1)+C]+a[b=((b=x+_)<<1)+b])+d*t[c],W=p*(a[A+1]-a[w+1]-a[C+1]+a[b+1])+d*t[c+1],$=p*(a[A+2]-a[w+2]-a[C+2]+a[b+2])+d*t[c+2],q=g*(a[A=((A=(y=O<(y=h+it)?O:y)+(v=G<(v=m+rt)?G:v))<<1)+A]-a[w=((w=y+(_=(_=m+nt)<0?0:_))<<1)+w]-a[C=((C=(x=(x=h+et)<0?0:x)+v)<<1)+C]+a[b=((b=x+_)<<1)+b])+X*t[c],D=(D=i*W+r*(g*(a[A+1]-a[w+1]-a[C+1]+a[b+1])+X*t[c+1]))<0?0:255<D?255:D,I=(I=i*$+r*(g*(a[A+2]-a[w+2]-a[C+2]+a[b+2])+X*t[c+2]))<0?0:255<I?255:I,F[c]=0|(S=(S=i*R+r*q)<0?0:255<S?255:S),F[c+1]=0|D,F[c+2]=0|I,F[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,L=0;L<j;++L){for(E=t,t=F,F=E,h=l=o=s=f=c=0;h<e;++h,c+=T,f+=3)l+=t[c],o+=t[c+1],s+=t[c+2],a[f]=l,a[f+1]=o,a[f+2]=s;for(l=o=s=h=f=0,c=K;c<M;c+=T,f+=3,++h)e<=h&&(l=o=s=h=0),l+=t[c],o+=t[c+1],s+=t[c+2],a[f+u]=a[f]+l,a[f+u+1]=a[f+1]+o,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<M;c+=T,++h)e<=h&&(h=0,m+=e),R=p*(a[A=((A=(y=O<(y=h+Q)?O:y)+(v=G<(v=m+tt)?G:v))<<1)+A]-a[w=((w=y+(_=(_=m+J)<0?0:_))<<1)+w]-a[C=((C=(x=(x=h+Z)<0?0:x)+v)<<1)+C]+a[b=((b=x+_)<<1)+b])+d*t[c],D=(D=i*(W=p*(a[A+1]-a[w+1]-a[C+1]+a[b+1])+d*t[c+1])+r)<0?0:255<D?255:D,I=(I=i*($=p*(a[A+2]-a[w+2]-a[C+2]+a[b+2])+d*t[c+2])+r)<0?0:255<I?255:I,F[c]=0|(S=(S=i*R+r)<0?0:255<S?255:S),F[c+1]=0|D,F[c+2]=0|I,F[c+3]=t[c+3]}return F}:function(N,t,e,H,n,i,r,U,z,B,Y,a,l,k){var o,s,u,c,f,h,m,p,d,g,x,_,P,y,v,b,w,C,A,S,D,I,j,X,R,W,$,q,L,E,M=t.length,V=M>>>n,K=e<<n,T=1<<n,n=U*z,Z=-(U=U>>>1)-1,J=-(z=e*(z>>>1))-e,Q=U,tt=z,U=B*Y,et=-(z=B>>>1)-1,nt=-(B=e*(Y>>>1))-e,it=z,rt=B,O=e-1,G=V-e,F=t;if(t=new ot(M),k=k||1,lt.GRAY===N)if(f=e,o=new st(V),r)for(g=i[0],x=i[n>>>1]-g,_=r[0],P=r[U>>>1]-_,L=0;L<k;++L){for(E=t,t=F,F=E,p=s=m=h=0;p<e;++p,h+=T,++m)s+=t[h],o[m]=s;for(s=p=m=0,h=K;h<M;h+=T,++m,++p)e<=p&&(s=p=0),s+=t[h],o[m+f]=o[m]+s;for(h=d=p=0;h<M;h+=T,++p)e<=p&&(p=0,d+=e),R=g*(o[D=(b=O<(b=p+Q)?O:b)+(w=G<(w=d+tt)?G:w)]-o[A=b+(v=(v=d+J)<0?0:v)]-o[S=(y=(y=p+Z)<0?0:y)+w]+o[C=y+v])+x*t[h],q=_*(o[D=(b=O<(b=p+it)?O:b)+(w=G<(w=d+rt)?G:w)]-o[A=b+(v=(v=d+nt)<0?0:v)]-o[S=(y=(y=p+et)<0?0:y)+w]+o[C=y+v])+P*t[h],F[h]=0|(I=a*R+l*q),F[h+1]=0|I,F[h+2]=0|I,F[h+3]=t[h+3]}else for(g=i[0],x=i[n>>>1]-g,L=0;L<k;++L){for(E=t,t=F,F=E,p=s=m=h=0;p<e;p++,h+=T,++m)s+=t[h],o[m]=s;for(s=p=m=0,h=K;h<M;h+=T,++m,++p)e<=p&&(s=p=0),s+=t[h],o[m+f]=o[m]+s;for(h=d=p=0;h<M;h+=T,++p)e<=p&&(p=0,d+=e),R=g*(o[D=(b=O<(b=p+Q)?O:b)+(w=G<(w=d+tt)?G:w)]-o[A=b+(v=(v=d+J)<0?0:v)]-o[S=(y=(y=p+Z)<0?0:y)+w]+o[C=y+v])+x*t[h],F[h]=0|(I=a*R+l),F[h+1]=0|I,F[h+2]=0|I,F[h+3]=t[h+3]}else if(f=(e<<1)+e,o=new st((V<<1)+V),r)for(g=i[0],x=i[n>>>1]-g,_=r[0],P=r[U>>>1]-_,L=0;L<k;++L){for(E=t,t=F,F=E,p=s=u=c=m=h=0;p<e;++p,h+=T,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],o[m]=s,o[m+1]=u,o[m+2]=c;for(s=u=c=p=m=0,h=K;h<M;h+=T,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],o[m+f]=o[m]+s,o[m+f+1]=o[m+1]+u,o[m+f+2]=o[m+2]+c;for(h=d=p=0;h<M;h+=T,++p)e<=p&&(p=0,d+=e),R=g*(o[D=((D=(b=O<(b=p+Q)?O:b)+(w=G<(w=d+tt)?G:w))<<1)+D]-o[A=((A=b+(v=(v=d+J)<0?0:v))<<1)+A]-o[S=((S=(y=(y=p+Z)<0?0:y)+w)<<1)+S]+o[C=((C=y+v)<<1)+C])+x*t[h],W=g*(o[D+1]-o[A+1]-o[S+1]+o[C+1])+x*t[h+1],$=g*(o[D+2]-o[A+2]-o[S+2]+o[C+2])+x*t[h+2],q=_*(o[D=((D=(b=O<(b=p+it)?O:b)+(w=G<(w=d+rt)?G:w))<<1)+D]-o[A=((A=b+(v=(v=d+nt)<0?0:v))<<1)+A]-o[S=((S=(y=(y=p+et)<0?0:y)+w)<<1)+S]+o[C=((C=y+v)<<1)+C])+P*t[h],j=a*W+l*(_*(o[D+1]-o[A+1]-o[S+1]+o[C+1])+P*t[h+1]),X=a*$+l*(_*(o[D+2]-o[A+2]-o[S+2]+o[C+2])+P*t[h+2]),F[h]=0|(I=a*R+l*q),F[h+1]=0|j,F[h+2]=0|X,F[h+3]=t[h+3]}else for(g=i[0],x=i[n>>>1]-g,L=0;L<k;++L){for(E=t,t=F,F=E,p=s=u=c=m=h=0;p<e;++p,h+=T,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],o[m]=s,o[m+1]=u,o[m+2]=c;for(s=u=c=p=m=0,h=K;h<M;h+=T,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],o[m+f]=o[m]+s,o[m+f+1]=o[m+1]+u,o[m+f+2]=o[m+2]+c;for(h=d=p=0;h<M;h+=T,++p)e<=p&&(p=0,d+=e),R=g*(o[D=((D=(b=O<(b=p+Q)?O:b)+(w=G<(w=d+tt)?G:w))<<1)+D]-o[A=((A=b+(v=(v=d+J)<0?0:v))<<1)+A]-o[S=((S=(y=(y=p+Z)<0?0:y)+w)<<1)+S]+o[C=((C=y+v)<<1)+C])+x*t[h],j=a*(W=g*(o[D+1]-o[A+1]-o[S+1]+o[C+1])+x*t[h+1])+l,X=a*($=g*(o[D+2]-o[A+2]-o[S+2]+o[C+2])+x*t[h+2])+l,F[h]=0|(I=a*R+l),F[h+1]=0|j,F[h+2]=0|X,F[h+3]=t[h+3]}return F},y.separable_convolution=r?function(N,t,e,H,n,U,i,r,a,z,l){for(var o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L,E=t.length,M=1<<n,T=e-1,O=(E>>>n)-e,B=new k(r),G=0,F=r.length;G<F;G+=2)B[G+1]*=e;for(h=new k(a),G=0,F=a.length;G<F;G+=2)h[G+1]*=e;if(R=2,s=U,u=r,I=z,f=B,c=t,t=new ot(E),lt.GRAY===N)for(;R--;){for(L=t,t=c,c=L,o=s.length,F=u.length,m=g=d=0;m<E;m+=M,++d){for(e<=d&&(d=0,g+=e),p=G=A=S=D=0;G<o;++G,p+=2)x=d+f[p],_=g+f[p+1],0<=x&&x<=T&&0<=_&&_<=O&&(C=s[G],A+=t[y=x+_<<2]*C);c[m]=0|(v=(v=I*A)<0?0:255<v?255:v),c[m+1]=0|v,c[m+2]=0|v,c[m+3]=t[m+3]}s=i,u=a,I=l,f=h}else for(;R--;){for(L=t,t=c,c=L,o=s.length,F=u.length,m=g=d=0;m<E;m+=M,++d){for(e<=d&&(d=0,g+=e),p=G=A=S=D=0;G<o;++G,p+=2)x=d+f[p],_=g+f[p+1],0<=x&&x<=T&&0<=_&&_<=O&&(C=s[G],A+=t[y=x+_<<2]*C,S+=t[y+1]*C,D+=t[y+2]*C);b=(b=I*S)<0?0:255<b?255:b,w=(w=I*D)<0?0:255<w?255:w,c[m]=0|(v=(v=I*A)<0?0:255<v?255:v),c[m+1]=0|b,c[m+2]=0|w,c[m+3]=t[m+3]}s=i,u=a,I=l,f=h}return c}:function(N,t,e,H,n,U,i,r,a,z,l){for(var o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L,E=t.length,M=1<<n,T=e-1,O=(E>>>n)-e,B=new k(r),G=0,F=r.length;G<F;G+=2)B[G+1]*=e;for(h=new k(a),G=0,F=a.length;G<F;G+=2)h[G+1]*=e;if(R=2,s=U,u=r,I=z,f=B,c=t,t=new ot(E),lt.GRAY===N)for(;R--;){for(L=t,t=c,c=L,o=s.length,F=u.length,m=g=d=0;m<E;m+=M,++d){for(e<=d&&(d=0,g+=e),p=G=A=S=D=0;G<o;++G,p+=2)x=d+f[p],_=g+f[p+1],0<=x&&x<=T&&0<=_&&_<=O&&(C=s[G],A+=t[y=x+_<<2]*C);c[m]=0|(v=I*A),c[m+1]=0|v,c[m+2]=0|v,c[m+3]=t[m+3]}s=i,u=a,I=l,f=h}else for(;R--;){for(L=t,t=c,c=L,o=s.length,F=u.length,m=g=d=0;m<E;m+=M,++d){for(e<=d&&(d=0,g+=e),p=G=A=S=D=0;G<o;++G,p+=2)x=d+f[p],_=g+f[p+1],0<=x&&x<=T&&0<=_&&_<=O&&(C=s[G],A+=t[y=x+_<<2]*C,S+=t[y+1]*C,D+=t[y+2]*C);b=I*S,w=I*D,c[m]=0|(v=I*A),c[m+1]=0|b,c[m+2]=0|w,c[m+3]=t[m+3]}s=i,u=a,I=l,f=h}return c},y.histogram=function(t,e,n,i){e=e||0;for(var r,a=new st(256),l=O.CHANNEL.A,o=t.length,s=0,u=0,c=255,f=0,h=0;h<256;++h)a[h]=0;for(h=0;h<o;h+=4)0<t[h+l]&&(++a[r=t[h+e]],++s,c=Z(r,c),f=J(r,f));if(n)for(h=0;h<256;++h)u+=a[h],a[h]=u;if(i)for(h=0;h<256;++h)a[h]/=s;return{bin:a,channel:e,min:c,max:f,total:s}},y.integral_histogram=function(t,e,n,i){var r,a,l,o,s,u,c,f,h,m,p,d,g=O.CHANNEL.R,x=O.CHANNEL.G,_=O.CHANNEL.B,y=O.CHANNEL.A,v=t.length,b=v>>>2,w=4*e,C=256*e,A=255,S=0,D=255,I=0,R=255,L=0,E=new st(256),M=new st(256*b);if(null==i){for(h=new st(256),m=new st(256),p=new st(256*b),d=new st(256*b),s=f=0;s<256;++s)d[(p[(M[0+s]=0)+s]=0)+s]=0;for(0<t[0+y]&&(r=t[0+g],a=t[0+x],l=t[0+_],M[0+r]=1,p[0+a]=1,d[0+l]=1,A=Z(r,A),S=J(r,S),D=Z(a,D),I=J(a,I),R=Z(l,R),L=J(l,L)),f=1,o=4,u=256;o<w;++f,o+=4,u+=256){for(c=u-256,s=0;s<256;++s)M[u+s]=M[c+s],p[u+s]=p[c+s],d[u+s]=d[c+s];0<t[o+y]&&(r=t[o+g],a=t[o+x],l=t[o+_],++M[u+r],++p[u+a],++d[u+l],A=Z(r,A),S=J(r,S),D=Z(a,D),I=J(a,I),R=Z(l,R),L=J(l,L))}for(f=0,o=w,u=C;o<v;++f,o+=4,u+=256){if(e<=f)for(s=f=0;s<256;++s)E[s]=h[s]=m[s]=0;for(c=u-C,s=0;s<256;++s)M[u+s]=M[c+s]+(E[s]||0),p[u+s]=p[c+s]+(h[s]||0),d[u+s]=d[c+s]+(m[s]||0);0<t[o+y]&&(r=t[o+g],a=t[o+x],l=t[o+_],++M[u+r],++p[u+a],++d[u+l],E[r]=(E[r]||0)+1,h[a]=(h[a]||0)+1,m[l]=(m[l]||0)+1,A=Z(r,A),S=J(r,S),D=Z(a,D),I=J(a,I),R=Z(l,R),L=J(l,L))}return{bin:[M,p,d],min:[A,D,R],max:[S,I,L],width:e,height:n,total:b}}for(i=i||0,s=f=0;s<256;++s)M[0+s]=0;for(0<t[0+y]&&(M[0+(r=t[o+i])]=1,A=Z(r,A),S=J(r,S)),f=1,o=4,u=256;o<w;++f,o+=4,u+=256){for(c=u-256,s=0;s<256;++s)M[u+s]=M[c+s];0<t[o+y]&&(++M[u+(r=t[o+i])],A=Z(r,A),S=J(r,S))}for(f=0,o=w,u=C;o<v;++f,o+=4,u+=256){if(e<=f)for(s=f=0;s<256;++s)E[s]=0;for(c=u-C,s=0;s<256;++s)M[u+s]=M[c+s]+(E[s]||0);0<t[o+y]&&(++M[u+(r=t[o+i])],E[r]=(E[r]||0)+1,A=Z(r,A),S=J(r,S))}return{bin:M,channel:i,min:A,max:S,width:e,height:n,total:b}},y.match_histogram=function(t,e,n,i,r){var a,l,o,s,u,c,f,h;if(null==i&&(i=0,r=255),t!==+t){for(f=r-i+1,h=t&&f<=t.length?t:new H(f),a=i;a<=r;++a){for(s=i,u=r,o=l=a;0!==(c=n[l]-e[a])&&(c<0?s=l:u=l,!(o===(l=s+u>>>1)||u<=s));)o=l;h[a-i]=l}return h}for(s=i,u=r,o=l=a=t;;){if(0===(c=n[l]-e[a]))return l;if(c<0?s=l:u=l,o===(l=s+u>>>1)||u<=s)return l;o=l}},y.otsu=function(t,e,n,i){return Ca(t,e,n=null==n?0:n,i=null==i?255:i)},y.otsu_multi=function t(e,n,i,r,a){var l,o;return r<=i||(l=(o=Ca(e,n,i,r,!0))[0],o[1]<a*a)?[]:((!(o=t(e,n,i,l,a)).length||o[o.length-1]<l)&&o.push(l),(i=t(e,n,l,r,a)).length&&i[0]===l&&i.shift(),o.push.apply(o,i),o)},y.otsu_multiclass=function t(e,n,i,r,a){var l,o;return a<=1||r<=i?[]:(l=Ca(e,n,i,r),2===(a=V.round(a))?[l]:(o=t(e,n,i,l,V.round((a-1)*(i=(l-i)/(r-i)))),e=t(e,n,l,r,V.round((a-1)*(1-i))),(!o.length||o[o.length-1]<l)&&o.push(l),e.length&&e[0]===l&&e.shift(),o.push.apply(o,e),o))},ct={},ft={},y.fft1d=function(t,e,n){return Sa(t,e,n,!1)},y.ifft1d=function(t,e,n){return Sa(t,e,n,!0)},y.fft2d=function(t,e,n,i){return Da(t,e,n,i,!1)},y.ifft2d=function(t,e,n,i){return Da(t,e,n,i,!0)},y.minmax=function(t,e,n,i,r,a,l){return Ia(t,e,0,i,r,!0,!0,a,l)},y.min=function(t,e,n,i,r,a){return Ia(t,e,0,i,null,!0,!1,r,a)},y.max=function(t,e,n,i,r,a){return Ia(t,e,0,null,i,!1,!0,r,a)},y.localmax=function(t,e,n,i,r,a){var l,o,s,u;if(t=t||[],null==r)for(l=i,s=0;s<l;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(l<=s+1||u>=e[s+1])&&t.push(s);else if(null==a)for(l=i*r,s=0;s<l;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(l<=s+1||u>=e[s+1])&&(s-r<0||u>e[s-r])&&(l<=s+r||u>=e[s+r])&&t.push(s);else for(l=i*(o=r*a),s=0;s<l;++s)n<(u=e[s])&&(s-1<0||u>e[s-1])&&(l<=s+1||u>=e[s+1])&&(s-a<0||u>e[s-a])&&(l<=s+a||u>=e[s+a])&&(s-o<0||u>e[s-o])&&(l<=s+o||u>=e[s+o])&&t.push(s);return t},A.nonzero_pixels=function(t,e,n,i,r,a,l,o,s){null==a&&(l=a=0,o=e-1,s=n-1),null==r&&(r=4),i=i||0;var u,c,f,h,m,p,d=(o-a+1)*(s-l+1),g=new Array(d),x=4===r?3:i,_=4===r?2:0;if(0<=o&&a<e&&0<=s&&l<n)for(h=a,p=(m=l)*e,c=f=0;c<d&&(o<h&&(h=a,++m,p+=e),!(n<=m));++c,++h)h<0||e<=h||m<0||t[(u=p+h<<_)+i]&&t[u+x]&&(g[f++]={x:h,y:m});return g.length=f,g},y.merge_features=function(t,e,n){if(!t||!t.length)return t;for(var i,r,a,l,o,s,u,c,f,h,m,p,d=t.length,g=new Array(d),x=[],_=0,y=!1,v=0;v<d;++v)g[v]=0;for(v=0;v<d;++v){for(y=!1,a=0;a<v;++a)u=t[a],c=t[v],f=(f=n)*(V.min(u.width,c.width)+V.min(u.height,c.height))*.5,V.abs(u.x-c.x)<=f&&V.abs(u.y-c.y)<=f&&V.abs(u.x+u.width-c.x-c.width)<=f&&V.abs(u.y+u.height-c.y-c.height)<=f&&(y=!0,g[v]=g[a]);y||(g[v]=_,++_)}for(i=new Array(_),r=new Array(_),v=0;v<_;++v)i[v]=0,r[v]={x:0,y:0,width:0,height:0};for(v=0;v<d;++v)++i[s=g[v]],h=r[s],m=t[v],h.x+=m.x,h.y+=m.y,h.width+=m.width,h.height+=m.height,null!=m.score&&(h.score=(h.score||0)+m.score);for(v=0;v<_;++v)e<=(l=i[v])&&(s={x:(o=1/(l+l))*(2*r[v].x+l),y:o*(2*r[v].y+l),width:o*(2*r[v].width+l),height:o*(2*r[v].height+l)},null!=r[v].score&&(s.score=r[v].score/l),x.push(s));for(d=x.length,v=0;v<d;++v)for(a=v+1;a<d;++a)!x[v].isInside&&Ra(x[v],x[a],n)&&(x[v].isInside=!0),!x[a].isInside&&Ra(x[a],x[v],n)&&(x[a].isInside=!0);for(v=d;0<=--v;)x[v].isInside?x.splice(v,1):((p=x[v]).x=V.round(p.x),p.y=V.round(p.y),p.width=V.round(p.width),p.height=V.round(p.height),p.area=p.width*p.height);return x},C.prototype={constructor:C,dispose:null,data:null,rect:null,bbox:null,points:null,indices:null,rows:null,cols:null,empty:null,has:null,indexOf:null,bitmap:null,attached:null,scale:function(t,e,n,i,r){var a=this.data(),l=this.rect();return null==i&&(i=e/a.width,r=n/a.height),null==r&&(r=i),new C(t,e,n,a.channels,{x:V.floor(i*l.x),y:V.floor(r*l.y),width:V.floor(i*l.width),height:V.floor(r*l.height)}).bitmap(function(t,e,n,i,r){for(var a,l,o=i*r,s=new t.constructor(o),u=V.round,c=0,f=0,h=0;h<o;++h,++c)i<=c&&(c=0,++f),a=ya(u(c/i*e),0,e-1),l=ya(u(f/r*n),0,n-1),s[h]=t[l*e+a];return s}(this.bitmap(),a.width,a.height,e,n))},join:function(t){var e,n,i,r,a,l,o=this;return t.empty()?o:o.empty()?t:(e=o.data(),l=o.rect(),n=t.rect(),i=V.min(l.from.x,n.from.x),r=V.min(l.from.y,n.from.y),a=V.max(l.to.x,n.to.x),l=V.max(l.to.y,n.to.y),new C(e.data,e.width,e.height,e.channels,{x:i,y:r,width:a-i+1,height:l-r+1,points:C.Join(o.points(),t.points())}))},intersect:function(t){var e,n,i,r,a,l,o=this;return o.empty()?o:t.empty()?t:(e=o.data(),l=o.rect(),n=t.rect(),i=V.max(l.from.x,n.from.x),r=V.max(l.from.y,n.from.y),a=V.min(l.to.x,n.to.x),l=V.min(l.to.y,n.to.y),new C(e.data,e.width,e.height,e.channels,{x:i,y:r,width:a-i+1,height:l-r+1,points:a<i||l<r?[]:C.Intersect(o.points(),t.points())}))},subtract:function(t){var e,n,i=this;return i.empty()||t.empty()?i:(e=i.data(),n=i.rect(),new C(e.data,e.width,e.height,e.channels,{x:n.from.x,y:n.from.y,width:n.width,height:n.height,points:C.Subtract(i.points(),t.points())}))},complement:function(){var t=this.data();return new C(t.data,t.width,t.height,t.channels,{x:0,y:0,width:t.width,height:t.height,points:C.Complement(this.points(),t.width,t.height,t.channels)})},erode:function(o,t){1===arguments.length&&(t=o,o=null);var s=this,e=s.data(),u=!o,c=t*t,f=t>>>1;return new C(e.data,e.width,e.height,e.channels,{points:s.points().reduce(function(t,e){for(var n=0,i=0,r=-f,a=-f,l=0;l<c;++l,++r)if(f<r&&(r=-f,++a),u||o[l]){if(++n,-1===s.indexOf(e.x+r,e.y+a))break;++i}return 0<n&&n===i&&t.push({x:e.x,y:e.y,index:e.index}),t},[])})},dilate:function(t,e){1===arguments.length&&(e=t,t=null);for(var n,i,r,a,l,o=this.data(),s=!t,u=e*e,c=e>>>1,f=o.width,h=o.height,m=this.bitmap(),p=f*h,d=new Array(p),g=0,x=0,_=0,y=0;y<p;++y,++x)for(f<=x&&(x=0,++_),i=n=-c,l=0;l<u;++l,++n)if(c<n&&(n=-c,++i),(s||t[l])&&(a=_+i,0<=(r=x+n))&&r<f&&0<=a&&a<h&&m[r+f*a]){d[g++]={x:x,y:_,index:y};break}return d.length=g,new C(o.data,o.width,o.height,o.channels,{points:d})}},C.Join=function(t,e){for(var n,i,r=t.length,a=e.length,l=0,o=0,s=0,u=new Array(r+a);l<r&&o<a;)n=t[l],i=e[o],n.y<i.y?(u[s]=n,++l):n.y>i.y?(u[s]=i,++o):n.x<i.x?(u[s]=n,++l):(n.x>i.x?u[s]=i:(u[s]=n,++l),++o),++s;for(;l<r;)u[s++]=t[l++];for(;o<a;)u[s++]=e[o++];return u.length=s,u},C.Intersect=function(t,e){for(var n,i,r=t.length,a=e.length,l=0,o=0,s=0,u=new Array(V.min(r,a));l<r&&o<a;)n=t[l],i=e[o],n.y<i.y?++l:n.y>i.y?++o:n.x<i.x?++l:n.x>i.x?++o:(u[s]=n,++l,++o,++s);return u.length=s,u},C.Subtract=function(t,e){for(var n,i,r=t.length,a=e.length,l=0,o=0,s=0,u=new Array(r);l<r&&o<a;)n=t[l],i=e[o],n.y<i.y?(u[s]=n,++l,++s):n.y>i.y?++o:n.x<i.x?(u[s]=n,++l,++s):(n.x>i.x||++l,++o);for(;l<r;)u[s++]=t[l++];return u.length=s,u},C.Complement=function(t,e,n,i){for(var r,a,l=e*n,o=t.length,s=0,u=0,c=0,f=new Array(l);s<l&&u<o;)r={x:s%e,y:V.floor(s/e),index:s},a=t[u],r.y<a.y?(f[c]=r,++s,++c):r.y>a.y?++u:r.x<a.x?(f[c]=r,++s,++c):(r.x>a.x||++s,++u);for(;s<l;)f[c++]={x:s%e,y:V.floor(s/e),index:s},++s;return f.length=c,f},C.serialize=function(t){var e=t.data();return{width:e.width,height:e.height,channels:e.channels,rect:t.rect(),points:t.points()}},C.unserialize=function(t,e){return new C(t,e.width,e.height,e.channels,{x:e.rect.from.x,y:e.rect.from.y,width:e.rect.width,height:e.rect.height,points:e.points})},A.Selection=C,La.prototype={constructor:La,levels:null,dispose:function(){this.levels=null},add:function(t,e){var n,i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L,E=this,M=[1,2,1],T=E.levels&&E.levels.length?E.levels[E.levels.length-1]:null;if(!T)return!1;if(C=T.img,A=T.width,S=T.height,D=T.sel,w=T.channels,L=S>>>1,(R=A>>>1)<t||L<t)return!1;for(I=new ot(R*L*w),D=D&&D.scale(I,R,L,.5),l=a=i=0;a<L;i+=2,++a,l+=R)for(r=n=0;r<R;n+=2,++r)if(e){for(b=v=y=_=x=g=0,s=-1;s<=1;++s)if(!((c=i+s)<0||S<=c))for(f=c*A,d=M[1+s],o=-1;o<=1;++o)(u=n+o)<0||A<=u||(p=M[1+o]*d,h=u+f,4===w?(g+=p*C[(h<<=2)+0],x+=p*C[h+1],_+=p*C[h+2],y+=C[h+3]):g+=p*C[h],v+=p,++b);m=r+l,4===w?(I[(m<<=2)+0]=ya(V.round(g/v),0,255),I[m+1]=ya(V.round(x/v),0,255),I[m+2]=ya(V.round(_/v),0,255),I[m+3]=ya(V.round(y/b),0,255)):I[m]=ya(V.round(g/v),0,255)}else m=r+l,h=n+i*A,4===w?(I[(m<<=2)+0]=C[(h<<=2)+0],I[m+1]=C[h+1],I[m+2]=C[h+2],I[m+3]=C[h+3]):I[m]=C[h];return E.levels.push({img:I,width:R,height:L,channels:w,sel:D}),!0},build:function(t,e){for(arguments.length<2&&(e=!0);this.add(t,e););return this}},A.Pyramid=La,y.satsum=Ea,y.satsums=B,y.satsumt=Ma,y.satsumr=function(t,e,n,i,r,a,l,o,s,u,c,f){var h,m,p,d,g,x;e<=0||n<=0||(h=V.min(i,a,o,u),m=V.min(r,l,s,c),p=V.max(i,a,o,u),d=V.max(r,l,s,c),p<=h||d<=m||V.abs(r-l)<=1||V.abs(l-s)<=1||V.abs(s-c)<=1||V.abs(c-r)<=1?B(t,e,n,h,m,p,d,1):(x=i===h?r:a===h?l:o===h?s:c,c=i===p?r:a===p?l:o===p?s:c,i=V.min(g=r===m?i:l===m?a:s===m?o:u,r=r===d?i:l===d?a:s===d?o:u),l=V.min(x,c),a=V.max(g,r),s=V.max(x,c),c<=x&&g<=r||x<=c&&r<=g?(B(t,e,n,i,l,a,s,1),g<=r?(Ma(t,e,n,h,x,g,m,g,x,f,1),Ma(t,e,n,g,m,p,c,g,c,f,1),Ma(t,e,n,p,c,r,d,r,c,f,1),Ma(t,e,n,r,d,h,x,r,x,f,1),B(t,e,n,g,m,g,x,-1),B(t,e,n,h,x,g,x,-1),B(t,e,n,r,c,r,d,-1),B(t,e,n,r,c,p,c,-1)):(Ma(t,e,n,h,x,r,x,r,d,f,1),Ma(t,e,n,h,x,g,m,g,x,f,1),Ma(t,e,n,g,m,p,c,g,c,f,1),Ma(t,e,n,r,d,r,c,p,c,f,1),B(t,e,n,g,m,g,c,-1),B(t,e,n,r,c,p,c,-1),B(t,e,n,r,x,r,d,-1),B(t,e,n,h,x,g,x,-1)),B(t,e,n,i,l,i,l,1),B(t,e,n,i,s,i,s,1),B(t,e,n,a,s,a,s,1),B(t,e,n,a,l,a,l,1)):(B(t,e,n,h,m,p,d,1),g<=r?(Ma(t,e,n,h,x,h,m,g,m,f,-1),Ma(t,e,n,g,m,p,m,p,c,f,-1),Ma(t,e,n,p,c,p,d,r,d,f,-1),Ma(t,e,n,r,d,h,d,h,x,f,-1)):(Ma(t,e,n,h,x,h,d,r,d,f,-1),Ma(t,e,n,h,x,h,m,g,m,f,-1),Ma(t,e,n,g,m,p,m,p,c,f,-1),Ma(t,e,n,p,c,p,d,r,d,f,-1)),B(t,e,n,g,m,g,m,1),B(t,e,n,h,x,h,x,1),B(t,e,n,p,c,p,c,1),B(t,e,n,r,d,r,d,1))))},y.rsatsum=function(t,e,n,i,r,a,l){var o,s,u,c,f;return e<=0||n<=0||a<=0||l<=0?0:(f=(u=(s=r-l+1)+a-1)+l-1,(0<=(c=(o=i+l-1)+a-1)&&c<e&&0<=u&&u<n?t[c+e*u]:0)+(0<=i&&i<e&&0<=r&&r<n?t[i+e*r]:0)-(0<=o&&o<e&&0<=s&&s<n?t[o+e*s]:0)-(0<=(c=o+a-l)&&c<e&&0<=f&&f<n?t[c+e*f]:0))},y.am_eye=function(){return new X([1,0,0,0,0,1,0,0])},y.am_multiply=function(t,e){var n=new X(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},y.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,i=new z(256);if("function"==typeof t)for(n=0;n<256;++n)i[n]=0|ya(t(n),0,255);else for(n=0;n<256;++n)i[n]=0|ya(e+t*n,0,255);return i},y.ct_multiply=function(t,e){for(var n=new z(256),i=0;i<256;++i)n[i]=ya(t[ya(e[i],0,255)],0,255);return n},y.cm_eye=function(){return new j([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},y.cm_multiply=function(t,e){for(var n=new j(20),i=0;i<20;i+=5)n[i+0]=e[i]*t[0]+e[i+1]*t[5]+e[i+2]*t[10]+e[i+3]*t[15],n[i+1]=e[i]*t[1]+e[i+1]*t[6]+e[i+2]*t[11]+e[i+3]*t[16],n[i+2]=e[i]*t[2]+e[i+1]*t[7]+e[i+2]*t[12]+e[i+3]*t[17],n[i+3]=e[i]*t[3]+e[i+1]*t[8]+e[i+2]*t[13]+e[i+3]*t[18],n[i+4]=e[i]*t[4]+e[i+1]*t[9]+e[i+2]*t[14]+e[i+3]*t[19]+e[i+4];return n},y.cm_rechannel=function(t,e,n,i,r,a,l,o,s){var u=new j(20),l=5*l,o=5*o,s=5*s;return u[(a=5*a)+e]=t[0],u[a+n]=t[1],u[a+i]=t[2],u[a+r]=t[3],u[4+a]=t[4],u[l+e]=t[5],u[l+n]=t[6],u[l+i]=t[7],u[l+r]=t[8],u[4+l]=t[9],u[o+e]=t[10],u[o+n]=t[11],u[o+i]=t[12],u[o+r]=t[13],u[4+o]=t[14],u[s+e]=t[15],u[s+n]=t[16],u[s+i]=t[17],u[s+r]=t[18],u[4+s]=t[19],u},y.cm_combine=function(t,e,n,i,r){r=r||Array,n=n||1,i=i||1;for(var a=0,l=t.length,o=new r(l);a<l;++a)o[a]=n*t[a]+i*e[a];return o},y.cm_convolve=function(t,e,n){n=n||Array;for(var i=t.length,r=(e=e===+e?[e]:e).length,a=new n(i*r),l=0,o=0;l<i;)a[l*r+o]=t[l]*e[o],++o>=r&&(o=0,++l);return a},ht=["ImArray","Array32F","Array64F","Array8I","Array16I","Array32I","Array8U","Array16U","Array32U"],v.typed=O.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},v.typed_obj=O.Browser.isNode?function(t,e){return null==t?t:e?function t(e){if(e instanceof Object){if(e.typed&&e.array&&-1<ht.indexOf(e.typed))return Ta(e.array,O[e.typed]);for(var n=Object.keys(e),i=n.length,r=0;r<i;++r)e[n[r]]=t(e[n[r]])}return e}(JSON.parse(t)):JSON.stringify(t,Oa)}:function(t){return t},v.arrayset_shim=va,v.arrayset=v.hasArrayset?function(t,e,n){t.set(e,n||0)}:va,v.subarray=v.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},Y=w,t="prototype",mt=Math,pt=Object.prototype.hasOwnProperty,dt=Y.Util.String.trim,e=Y.Util.GLSL||{},gt=Y.Array32F,xt=Y.Array32I,_t=dt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","attribute vec2 pos;","attribute vec2 uv;","uniform vec2 resolution;","/*uniform float flipY;*/","varying vec2 pix;","void main(void) {","vec2 zeroToOne = pos / resolution;","vec2 zeroToTwo = zeroToOne * 2.0;","vec2 clipSpace = zeroToTwo - 1.0;","gl_Position = vec4(clipSpace * vec2(1.0, /*flipY*/1.0), 0.0, 1.0);","pix = uv;","}"].join("\n")),b=dt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","varying vec2 pix;","uniform sampler2D img;","void main(void) {","gl_FragColor = texture2D(img, pix);","}"].join("\n")),yt=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif"].join("\n"),wt=/\/\*.*?\*\//gim,Ct=/\/\/.*?$/gim,At=/\battribute\s+(\w+)\s+(\w+)\s*(\[)?/gi,St=/\buniform\s+(\w+)\s+(\w+)\s*(\[)?/gi,e.DEFAULT=b,Na[t]={constructor:Na,id:null,uniform:null,attribute:null,vertexSource:null,fragmentSource:null},Ha[t]={constructor:Ha,begin:null,shader:null,dimensions:null,save:null,input:null,output:null,end:null,code:null},e.run=function(i,r,t,e,a,l,n){b=i,C=l,null==(w=a)&&null==C&&(C=b.selection?(S=b.selection,A=b.width-1,U=b.height-1,D=S[0],I=S[1],z=S[2],B=S[3],A=S[4]?A:1,S=S[4]?U:1,D=+mt.floor(D*A),I=+mt.floor(I*S),w=(z=+mt.floor(z*A))-D+1,(B=+mt.floor(B*S))-I+1):(w=b.oCanvas.width,b.oCanvas.height));var o,s,u,c,N,f,h,H,m,p,d,g,x,_,y,v,b,w,C,U,A,S,D,I,z,B,R=Y.getGL(b,w,C),L=null,E=null,M=t.length,T=[null,null],O=-1,G=-1,F=!1;if(R){if(p=function(){ja(R,u),ja(R,c),za(R,L),ka(R,E),ka(R,T[0]),ka(R,T[1]),ka(R,f),ka(R,h),h=f=T=E=L=c=u=null},d=function(){p(),i.cache={},Y.log("GL context lost on #"+i.id)},x=function(t,e,n,i){f!==n&&ka(R,f),h!==n&&ka(R,h),i||(ka(R,T[0]),ka(R,T[1]),T=[null,null]),O<G&&o<G&&(f!==n&&(f=Ya(R,t,e)),h!==n)&&(h=Ya(R,t,e))},g=function(t,e,n){a===t&&l===e||(_=a,y=l,a=t,l=e,Y.setGLDimensions(i,a,l),ja(R,u),u=Pa(R,new Y.Array32F([0,0,a,0,0,l,0,l,a,0,a,l])),R.viewport(0,0,a,l),n&&x(a,l,null,!1),r.hasMeta&&(r.meta=r.meta||{},r.meta._IMG_WIDTH=a,r.meta._IMG_HEIGHT=l))},R.isContextLost&&R.isContextLost())return d();for(o=0;o<M&&(t[o].shader&&O<0&&(O=o),t[M-1-o].shader&&G<0&&(G=M-1-o),!(0<=O&&0<=G));++o);for(H=i.cache,u=Pa(R,new Y.Array32F([0,0,a,0,0,l,0,l,a,0,a,l])),c=Pa(R,new Y.Array32F([0,0,1,0,0,1,0,1,1,0,1,1])),R.viewport(0,0,a,l),O<G&&(f=Ya(R,a,l),h=Ya(R,a,l)),_=a,y=l,o=0;o<M;++o)if(v=!1,(s=t[o]).init&&s.init(R,e,_,y,F,H),v=s.program&&s.program.id?!0:v){if(!((v="function"==typeof(v=s.iterations||0)?v(a,l,_,y)||0:v)<1)){if(null!=s.dimensions?(g((v="function"==typeof s.dimensions?s.dimensions(a,l):s.dimensions)[0],v[1],!1),_===a&&y===l||x(a,l,f,!1)):(_=a,y=l),v=o!==O&&L?f:{fbo:null,tex:L=L||Ba(R,e,_,y,0),w:_,h:y},N=o===G?E=E||Ya(R,a,l):(h.w===a&&h.h===l||(ka(R,h),h=Ya(R,a,l)),h),!F&&O<o&&v.fbo&&Ba(R,e,v.w,v.h,0,0,v.tex),function(t,e,n,i,r,a,l){var o,s,u,c,f,h,m=a.w,p=a.h,d=r.w,g=r.h,x=("function"==typeof e.iterations?e.iterations(m,p,d,g):e.iterations)||1,_=(y=e.program).uniform,y=y.attribute,v=x-1;if(t.isContextLost&&t.isContextLost())return!0;for(t.useProgram(e.program.id),pt.call(y,"pos")&&(t.enableVertexAttribArray(y.pos.loc),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(y.pos.loc,2,t.FLOAT,!1,0,0)),pt.call(y,"uv")&&(t.enableVertexAttribArray(y.uv.loc),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(y.uv.loc,2,t.FLOAT,!1,0,0)),pt.call(_,"resolution")&&"vec2"===_.resolution.type&&t.uniform2f(_.resolution.loc,m,p),pt.call(_,"dp")&&"vec2"===_.dp.type&&t.uniform2f(_.dp.loc,1/m,1/p),e.instance&&pt.call(_,"selection")&&"vec4"===_.selection.type&&(y=(n=e.instance.selection)?(i=n[4]?u=1:(u=1/(m-1||1),1/(p-1||1)),o=mt.min(1,mt.max(0,n[0]*u)),s=mt.min(1,mt.max(0,n[1]*i)),u=mt.min(1,mt.max(0,n[2]*u)),mt.min(1,mt.max(0,n[3]*i))):(s=o=0,u=1),t.uniform4f(_.selection.loc,o,s,u,y)),e.instance&&pt.call(_,"mode")&&"int"===_.mode.type&&t.uniform1i(_.mode.loc,e.instance.mode),e.inputs&&(r=e.inputs(t,m,p,d,g,r)),1<x&&(l[0]=l[0]||Ya(t,m,p),l[1]=l[1]||Ya(t,m,p)),c=0;c<x;++c){if(t.isContextLost&&t.isContextLost())return!0;h=0===c?r:l[0],f=c===v?a:l[1],pt.call(_,e._input)&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.tex),t.uniform1i(_[e._input].loc,0)),t.bindFramebuffer(t.FRAMEBUFFER,f.fbo),t.viewport(0,0,m,p),t.drawArrays(t.TRIANGLES,0,6),h=l[0],l[0]=l[1],l[1]=h}e.output&&e.output(t,a)}(R,s,u,c,v,N,T)||R.isContextLost&&R.isContextLost())return d();v=f,f=h,h=v,F=!0}}else"function"==typeof s.shader?(m=F?Xa(R,a,l):e,e=s.shader(s,m,a,l),F=!1):s.instance&&(s._apply||s.instance._apply_wasm||s.instance._apply)&&(m=F?Xa(R,a,l):e,e=s._apply?s._apply(m,a,l,n):s.instance._apply_wasm?s.instance._apply_wasm(m,a,l,n):s.instance._apply(m,a,l,n),s.instance.hasMeta&&null!=s.instance.meta._IMG_WIDTH&&null!=s.instance.meta._IMG_HEIGHT&&g(s.instance.meta._IMG_WIDTH,s.instance.meta._IMG_HEIGHT,!0),F=!1);return F&&(M=a*l<<2,e.length!==M&&(e=new Y.ImArray(M)),Xa(R,a,l,e)),p(),e}},e.uploadTexture=Ba,e.getPixels=Xa,e.formatFloat=function(t,e){var n=t.toString();return(!e||t<0?"":"+")+n+(-1===n.indexOf(".")?".0":"")},e.formatInt=function(t,e){return t=mt.floor(t),(!e||t<0?"":"+")+t.toString()},e.staticSort=function(t,e,n){e=e||"temp",n=n||Wa;for(var i,r,a,l,o,s,u=t.length,c=[],f=1;f<u;f<<=1)for(i=f<<1,r=f;1<=r;r>>>=1)for(a=r<<1,l=r%f;l<=u-1-r;l+=a)for(o=0,s=mt.min(r-1,u-l-r-1);o<=s;++o)mt.floor((o+l)/i)===mt.floor((o+l+r)/i)&&c.push(n(t[o+l],t[o+l+r],e));return c},e.Filter=Ha,e.isSupported=Y.supportsGLSL(),e.isLoaded=!0,Y.Util.GLSL=e,(n=(Dt=w).Util.WASM||{}).base64ToArrayBuffer=$a,n.instantiate=function(t,i,r){var e,s,l,a,u;function o(t,e){if(!e)return null;var n,i={};for(n in t)switch(t[n].type){case"i32":i[n]=function(t){try{return u.getInt32(t,!0)}catch{return(u=new DataView(l.buffer)).getInt32(t,!0)}}(e+t[n].offset);break;case"f32":i[n]=function(t){try{return u.getFloat32(t,!0)}catch{return(u=new DataView(l.buffer)).getFloat32(t,!0)}}(e+t[n].offset);break;default:Dt.Array32F!==t[n].type&&Dt.Array32I!==t[n].type&&Dt.Array16I!==t[n].type&&Dt.Array8U!==t[n].type&&Dt.ImArray!==t[n].type||(i[n]=c(t[n].type,_(e+t[n].offset)))}return i}function c(t,e){return e?new t(l.buffer,_(e+4),u.getUint32(e+8,!0)/t.BYTES_PER_ELEMENT).slice():null}function f(t,e){var n,i,r,a;return null==e?0:(a=4,n=0,n=Dt.Array16I===t?(a=6,1):Dt.Array32I===t||Dt.Array32F===t?(a=5,2):(a=4,0),i=e.length,r=s.__pin(s.__new(i<<n,1))>>>0,g(a=s.__new(12,a)>>>0,r),u.setUint32(4+a,r,!0),u.setUint32(8+a,i<<n,!0),new t(l.buffer,r,i).set(e),s.__unpin(r),a)}function h(n,t){if(null==t)return 0;var e=4,i=0,r="f32"===n?(e=5,i=2,x):"i32"===n?(e=7,i=2,g):(e=6,i=2,function(t,e){g(t,f(n,e)||d())}),a=t.length,l=s.__pin(s.__new(a<<i,1))>>>0,e=s.__pin(s.__new(16,e))>>>0;g(e,l),u.setUint32(4+e,l,!0),u.setUint32(8+e,a<<i,!0),u.setUint32(12+e,a,!0);for(var o=0;o<a;++o)r(l+(o<<i>>>0),t[o]);return s.__unpin(l),s.__unpin(e),e}function m(t){if(!t)return null;for(var e=t+new Uint32Array(l.buffer)[t-4>>>2]>>>1,n=new Uint16Array(l.buffer),i=t>>>1,r="";1024<e-i;)r+=String.fromCharCode.apply(String,n.subarray(i,i+=1024));return r+String.fromCharCode.apply(String,n.subarray(i,e))}function p(t){var e;return t&&((e=a.get(t))?a.set(t,e+1):a.set(s.__pin(t),1)),t}function d(){throw TypeError("value must not be null")}function g(t,e){try{u.setUint32(t,e,!0)}catch{(u=new DataView(l.buffer)).setUint32(t,e,!0)}}function x(t,e){try{u.setFloat32(t,e,!0)}catch{(u=new DataView(l.buffer)).setFloat32(t,e,!0)}}function _(t){try{return u.getUint32(t,!0)}catch{return(u=new DataView(l.buffer)).getUint32(t,!0)}}return r=r||{},(i=i||{}).env=i.env||{},e={env:Object.assign(Object.create(Dt.global),i.env,{abort:function(t,e,n,i){throw t=m(t>>>0),e=m(e>>>0),n>>>=0,i>>>=0,Error(t+" in "+e+":"+n+":"+i)}})},a=new Map,WebAssembly.compile($a(t)).then(function(t){return t?WebAssembly.instantiate(t,e):Promise.resolve(null)}).catch(function(t){return Dt.error(t),Promise.resolve(null)}).then(function(t){if(!t)return null;s=t.exports,l=s.memory||i.env.memory,u=new DataView(l.buffer);var e,n={};for(e in r)n[e]=function(i,e,r){return function(){var t,n=Array.prototype.slice.call(arguments);return i.forEach(function(t,e){e+1<i.length?t.array?n[t.arg]=p(h(t.type,n[t.arg])||d()):n[t.arg]=p(f(t.type,n[t.arg])||d()):t.array?n[t.arg]=h(t.type,n[t.arg])||d():n[t.arg]=f(t.type,n[t.arg])||d()}),s.__setArgumentsLength&&s.__setArgumentsLength(n.length),t=r.apply(s,n),e.struct?t=o(e.struct,t>>>0):e.type&&(t=c(e.type,t>>>0)),i.forEach(function(t,e){if(e+1<i.length){e=n[t.arg];if(e){t=a.get(e);if(1===t)s.__unpin(e),a.delete(e);else{if(!t)throw Error('invalid refcount "'+t+'" for reference "'+e+'"');a.set(e,t-1)}}}}),t}}(r[e].inputs,r[e].output,s[e]);return Object.setPrototypeOf(n,s)})},n.isSupported=Dt.supportsWASM(),n.isLoaded=!0,Dt.Util.WASM=n,c=w,It="prototype",i=Object[It],Rt=Function[It],Lt=Array[It],Et=i.hasOwnProperty,Mt=Object.keys,i=Math,Tt=c.Asynchronous,Ot=Tt.isPlatform(Tt.Platform.NODE),Tt.isPlatform(Tt.Platform.BROWSER),Tt.supportsMultiThreading(),Gt=Tt.isThread(null,!0),Ft=Tt.isThread(),Nt=c.Path,Ht=c.Class.Merge,Ut=c.Util.GLSL,zt=c.Util.WASM,c._notSupportClamp,c.log,Bt=i.min,Yt=i.max,kt=0,i=c.FilterThread=c.Class(Tt,{path:Nt,name:null,_listener:null,_rand:null,constructor:function(){var n=this,i=null;Gt&&n.initThread().listen("load",function(t){t&&t.filter&&(i&&(i.dispose(!0),i=null),i=Tt.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&Tt.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(e){i&&e&&e.im?c.onReady(function(){var t=e.im;t[0]=c.Util.Array.typed(t[0],c.ImArray),e.params&&i.unserializeFilter(e.params),e.inputs&&i.unserializeInputs(e.inputs,t),t=i._apply(t[0],t[1],t[2]),n.send("apply",{im:!!i._update&&t,meta:i.hasMeta?i.metaData(!0):null})}):n.send("apply",{im:null})}).listen("apply_wasm",function(e){i&&e&&e.im?c.onReady(function(){var t=e.im;t[0]=c.Util.Array.typed(t[0],c.ImArray),e.params&&i.unserializeFilter(e.params),e.inputs&&i.unserializeInputs(e.inputs,t),t=i._apply_wasm(t[0],t[1],t[2]),n.send("apply",{im:!!i._update&&t,meta:i.hasMeta?i.metaData(!0):null})}):n.send("apply",{im:null})}).listen("dispose",function(t){i&&(i.dispose(!0),i=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=Ot?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",Nt.file!==n.path.file?[Nt.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:Lt.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(Tt.blob("function"==typeof t[n]?Rt.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:Lt.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),Pt=c.Filter=c.Class(i,{name:"Filter",constructor:function(){this.id=++kt,this.inputs={},this.meta=null},_isOn:!0,_isGLSL:!1,_isWASM:!1,_glsl:null,_wasm:null,_runWASM:!1,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._isGLSL=t._isWASM=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t._glsl=t._wasm=null,t.$super("dispose"),t},worker:i[It].thread,getParam:function(t){if(t&&"_"!==t.charAt(0)&&Et.call(this.constructor[It],t))return this[t]},setParam:function(t,e){return t&&"_"!==t.charAt(0)&&Et.call(this.constructor[It],t)&&(this[t]=e),this},metaData:function(t){return this.meta},getMetaData:function(t){return this.metaData(t)},setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){var n=this;return t=String(t),null===e?n.inputs[t]&&(delete n.inputs[t],n._glsl=null):(n.inputs[t]=[null,e,e.nref],n._glsl=null),n},unsetInput:function(t){return t=String(t),this.inputs[t]&&(delete this.inputs[t],this._glsl=null),this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,isInputUpdated:function(t){t=this.inputs[String(t)];return!(!t||!(!0===t[3]||null==t[0]||t[1]&&t[2]!==t[1].nref))},serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,i,r=this.inputs,a=Mt(r),l=a.length;if(!l)return null;for(i={_updated:{}},n=0;n<l;++n)(null==(e=r[a[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(i._updated[a[n]]=!0,e[2]=e[1].nref,i[a[n]]=t===e[1]||e[1].getSelectedData(1));return i},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,i=t._updated||{},r=(t._updated&&delete t._updated,this.inputs),a=Mt(t),l=a.length,o=c.ImArray,s=c.Util.Array.typed,u=0;u<l;++u)(n=t[a[u]])&&(!0===n?n=e:n[0]=s(n[0],o),r[a[u]]=[n,null,0,i[a[u]]||!1]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,i,r){return this.selection=!1===t?null:r?[Yt(0,t||0),Yt(0,e||0),Yt(0,n||0),Yt(0,i||0),0]:[Bt(1,Yt(0,t||0)),Bt(1,Yt(0,e||0)),Bt(1,Yt(0,n||0)),Bt(1,Yt(0,i||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},isGLSL:function(){return this._isGLSL},isWASM:function(){return this._isWASM},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},makeGLSL:function(t){return this._isGLSL=!!((t=arguments.length?t:!0)&&Ut.isLoaded&&c.supportsGLSL()&&this.getGLSL!==c.Filter.prototype.getGLSL),this},GLSLCode:function(){return null==this._glsl&&(this._glsl=this.getGLSL()||{instance:this}),this._glsl},getGLSL:function(){return!1},makeWASM:function(t){return this._isWASM=!!((t=arguments.length?t:!0)&&zt.isLoaded&&c.supportsWASM()&&this.getWASM!==c.Filter.prototype.getWASM),this},WASMCode:function(){return null==this._wasm&&(this._wasm=this.getWASM()||""),this._wasm},getWASM:function(){return!1},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply_wasm:function(t,e,n,i){return this._runWASM=!0,t=this._apply(t,e,n,i),this._runWASM=!1,t},_apply:function(t,e,n,i){return t},apply_:function(t,e,n,i,r){var a,l=this;return l.canRun()?l.$thread?(l._listener.cb=function(t){l._listener.cb=null,t&&t.im&&(e=c.Util.Array.typed(t.im,c.ImArray)),r(e,l)},l.send(l.isWASM()?"apply_wasm":"apply",{im:[e,n,i,2],params:l.serializeFilter(),inputs:l.serializeInputs(t)})):(!Ft&&l.isGLSL()?(a=l.GLSLCode())&&(a=(a=a.push||a.pop?a:[a]).filter(Va)).length&&(a=Ut.run(t,l,a,e,n,i,{src:t,dst:t}))&&(e=a):e=l.isWASM()?l._apply_wasm(e,n,i,{src:t,dst:t}):l._apply(e,n,i,{src:t,dst:t}),r(e,l)):r(e,l),l},apply:function(t,e,n){var i,r,a,l,o,s=this;return s.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||s.onComplete,i=t.getSelectedData(),a=i[1],l=i[2],s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMetaData(t.meta,!0),t.im)&&s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&l!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(c.Util.Array.typed(t.im,c.ImArray))),n&&n.call(s)},s.send(s.isWASM()?"apply_wasm":"apply",{im:i,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(!Ft&&s.isGLSL()?(o=s.GLSLCode())&&(o=(o=o.push||o.pop?o:[o]).filter(Va)).length&&(r=Ut.run(e,s,o,i[0],a,l,{src:t,dst:e}),s._update)&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&l!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),r)&&e.setSelectedData(r):(r=s.isWASM()?s._apply_wasm(i[0],a,l,{src:t,dst:e}):s._apply(i[0],a,l,{src:t,dst:e}),s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&l!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(r))),n&&n.call(s))),t},toString:function(){return"[FILTER: "+this.name+"("+this.id+")]"}}),c.Filter[It].getInput=c.Filter[It].input,c.Filter[It].delInput=c.Filter[It].unsetInput,c.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,i=c,r=0;r<n;++r){if(!i[e=t[r]])return null;i=i[e]}return i}return c[t]||null},c.Create=function(t){var e,n=(t=Ht({init:qa,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==Pt[It].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==Pt[It].getMetaData&&(t.metaData=t.getMetaData),delete t.init,Et.call(t,"apply")&&delete t.apply,c[n]=c.Class(Pt,t)},jt=w,h=Math,Xt=h.sqrt,Wt=h.round,h.floor,$t=h.min,qt=h.max,h.abs,h.sin,h.cos,h.PI,m=jt.Util.Math.clamp,jt.Util.String.esc,Vt=jt.Util.String.trim,Kt=/^#([0-9a-fA-F]{3,6})\b/,Zt=/^(rgba?)\b\s*\(([^\)]*)\)/i,Jt=/^(hsla?)\b\s*\(([^\)]*)\)/i,Qt=/^(hwba?)\b\s*\(([^\)]*)\)/i,te=/\s+|,/gm,ee=/\/\s*(\d*?\.?\d+%?)/,ne=jt.LUMA,jt.CHANNEL,ie=1/255,re=2.55,ae=["#define FORMAT_HWB 3","#define FORMAT_HSV 2","#define FORMAT_HSL 1","vec4 hsl2rgb(float h, float s, float l) {","   float c = (1.0 - abs(2.0*l - 1.0))*s;","   float hp = h/60.0;","   float d = float(floor(hp / 2.0));","   float x = c*(1.0 - abs(hp - 2.0*d - 1.0));","   float m = l - c/2.0;","   vec4 rgb = vec4(0.0,0.0,0.0,1.0);","   if (hp >= 0.0 && hp < 1.0) {","       rgb.r = c + m;","       rgb.g = x + m;","       rgb.b = m;","   } else if (hp >= 1.0 && hp < 2.0) {","       rgb.r = x + m;","       rgb.g = c + m;","       rgb.b = m;","   } else if (hp >= 2.0 && hp < 3.0) {","       rgb.r = m;","       rgb.g = c + m;","       rgb.b = x + m;","   } else if (hp >= 3.0 && hp < 4.0) {","       rgb.r = m;","       rgb.g = x + m;","       rgb.b = c + m;","   } else if (hp >= 4.0 && hp < 5.0) {","       rgb.r = x + m;","       rgb.g = m;","       rgb.b = c + m;","   } else {","       rgb.r = c + m;","       rgb.g = m;","       rgb.b = x + m;","   }","   return clamp(rgb, 0.0, 1.0);","}","vec4 hsv2rgb(float h, float s, float v) {","    float l = v*(1.0 - s/2.0);","    float lm = min(l, 1.0-l);","    if (0.0 == lm) return hsl2rgb(h, 0.0, l);","    else return hsl2rgb(h, (v-l)/lm, l);","}","vec4 hwb2rgb(float h, float w, float b) {","    float b1 = 1.0 - b;","    return hsv2rgb(h, 1.0 - w/b1, b1);","}","vec4 rgb2hslvwb(float r, float g, float b, int type) {","    float xmax = max(r, max(g, b));","    float xmin = min(r, min(g, b));","    float v = xmax;","    float c = xmax - xmin;","    float l = clamp((xmax + xmin)/2.0, 0.0, 1.0);","    float wh = clamp(xmin, 0.0, 1.0);","    float bl = clamp(1.0 - xmax, 0.0, 1.0);","    float h = 0.0;","    if (0.0 == c) {","        h = 0.0;","    } else if (v == r) {","        h = 60.0*((g - b)/c);","    } else if (v == g) {","        h = 60.0*(2.0 + (b - r)/c);","    } else {","        h = 60.0*(4.0 + (r - g)/c);","    }","    h = clamp(h, 0.0, 360.0);","   float sl; float sv;","    if (0.0 == l || 1.0 == l) {","        sl = 0.0;","    } else {","        sl = clamp((v - l)/min(l, 1.0 - l), 0.0, 1.0);","    }","    if (0.0 == v) {","        sv = 0.0;","    } else {","        sv = clamp(c/v, 0.0, 1.0);","    }","    v = clamp(v, 0.0, 1.0);","    if (FORMAT_HWB == type) return vec4(h, wh, bl, 1.0);","    else if (FORMAT_HSV == type) return vec4(h, sv, v, 1.0);","    return vec4(h, sl, l, 1.0);","}","vec4 rgb2hsl(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL);","}","vec4 rgb2hsv(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSV);","}","vec4 rgb2hwb(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HWB);","}","vec4 rgb2cmyk(float r, float g, float b) {","    if (0.0 == r && 0.0 == g && 0.0 == b) {","       return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float c = 1.0 - r;","    float m = 1.0 - g;","    float y = 1.0 - b;","    float minCMY = min(c, min(m, y));","    float invCMY = 1.0 / (1.0 - minCMY);","    return vec4(","        (c - minCMY) * invCMY,","        (m - minCMY) * invCMY,","        (y - minCMY) * invCMY,","        minCMY","    );","}","vec4 cmyk2rgb(float c, float m, float y, float k) {","    if (0.0 == c && 0.0 == m && 0.0 == y) {","        return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float minCMY = k;","    float invCMY = 1.0 - minCMY;","    c = c*invCMY + minCMY;","    m = m*invCMY + minCMY;","    y = y*invCMY + minCMY;","    return vec4(","        1.0 - c,","        1.0 - m,","        1.0 - y,","        1.0","    );","}","vec4 rgb2ycbcr(float r, float g, float b) {","    return clamp(vec4(","    0.0 + 0.299*r    + 0.587*g     + 0.114*b,","    0.5 - 0.168736*r - 0.331264*g  + 0.5*b,","    0.5 + 0.5*r      - 0.418688*g  - 0.081312*b,","    1.0","    ), 0.0, 1.0);","}","vec4 ycbcr2rgb(float y, float cb, float cr) {","    return clamp(vec4(","    y                      + 1.402   * (cr-0.5),","    y - 0.34414 * (cb-0.5) - 0.71414 * (cr-0.5),","    y + 1.772   * (cb-0.5),","    1.0","    ), 0.0, 1.0);","}","float rgb2hue(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL).x;","}","float rgb2sat(float r, float g, float b, int type) {","    return rgb2hslvwb(r, g, b, type).y;","}","float intensity(float r, float g, float b) {","    return clamp("+ne[0]+"*r + "+ne[1]+"*g + "+ne[2]+"*b, 0.0, 1.0);","}"].join("\n"),(le=jt.Color=jt.Class({__static__:{GLSLCode:function(){return ae},clamp:m,clampPixel:function(t){return $t(255,qt(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,i){return(255&i)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},rgb24GL:function(t){var e=jt.Util.GLSL.formatFloat;return"vec3("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255)].join(",")+");"},rgba32GL:function(t){var e=jt.Util.GLSL.formatFloat;return"vec4("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255),e((t>>>24&255)/255)].join(",")+");"},intensity:function(t,e,n){return~~al(t,e,n)},hue:function(t,e,n){return t=t,e=e,n=n,i?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),r=i=h.max(t,e,n),a=h.min(t,e,n),m(h.round(0==(i=i-a)?0:r===t?60*(0+(e-n)/i):r===e?60*(2+(n-t)/i):60*(4+(t-e)/i)),0,360);var i,r,a},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(i=!(r="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=i=h.max(t,e,n),e=i-(t=h.min(t,e,n)),i=0==(n=(i+t)/2)||1==n?0:(a-n)/h.min(n,1-n),t=0===a?0:e/a,m("hsv"===r?100*t:100*i,0,100));var i,r,a},dist:function(t,e,n,i){var r=t[n+0]-e[i+0],a=t[n+1]-e[i+1],t=t[n+2]-e[i+2];return Xt(r*r+a*a+t*t)},RGB2Gray:function(t,e){var n=ne[0]*t[e+0]+ne[1]*t[e+1]+ne[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=.412453*n+.35758*i+.180423*r|0,t[e+1]=.212671*n+.71516*i+.072169*r|0,t[e+2]=.019334*n+.119193*i+.950227*r|0,t},XYZ2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=3.240479*n-1.53715*i-.498535*r|0,t[e+1]=-.969256*n+1.875992*i+.041556*r|0,t[e+2]=.055648*n-.204043*i+1.057311*r|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,i=t[e+1]/255,r=t[e+2]/255,a=Math.log,l=.412453*n+.35758*i+.180423*r,o=.212671*n+.71516*i+.072169*r,n=.019334*n+.119193*i+.950227*r,i=a(.9465229*l+.2946927*o-.1313419*n),r=a(-.1179179*l+.992996*o+.007371554*n),a=a(.09230461*l-.04645794*o+.9946464*n);return t[e+0]=27.07439*i-22.80783*r-1.806681*a,t[e+1]=-5.646736*i-7.722125*r+12.86503*a,t[e+2]=-4.163133*i-4.579428*r-4.576049*a,t},ILL2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2],a=Math.exp,l=a(.021547742011105847*n-.021969518919866274*i-.07027206572176435*r),o=a(-.018152109501074376*n-.03004415376911152*i-.07729896865586937*r),a=a(-.0014378861182725712*n+.050053456205559545*i-.07724195758868482*r),n=1.0068824301911365*l-.2924918682640871*o+.13512537828457516*a,i=.12021888110585245*l+.9717816461525606*o+.008672665360769691*a,r=-.08782494811157235*l+.07253363731909634*o+.9932476695469974*a;return t[e+0]=3.240479*n-1.53715*i-.498535*r|0,t[e+1]=-.969256*n+1.875992*i+.041556*r|0,t[e+2]=.055648*n-.204043*i+1.057311*r|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=0+.299*n+.587*i+.114*r|0,t[e+1]=128-.168736*n-.331264*i+.5*r|0,t[e+2]=128+.5*n-.418688*i-.081312*r|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=n+1.402*(r-128)|0,t[e+1]=n-.34414*(i-128)-.71414*(r-128)|0,t[e+2]=n+1.772*(i-128)|0,t},RGB2HSV:function(t,e,n){var i=el(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},RGB2HSL:function(t,e,n){var i=tl(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},RGB2HWB:function(t,e,n){var i=nl(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},HSV2RGB:function(t,e,n){n=Za(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=Ka(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=Ja(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,i=t[e+0],r=t[e+1],a=t[e+2];return 0===i&&0===r&&0===a||(n=$t(i=255-i,r=255-r,a=255-a),t[e+0]=(i-n)*(i=255===n?0:255/(255-n)),t[e+1]=(r-n)*i,t[e+2]=(a-n)*i),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:ie,C2P:100/255,P2C:re,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*(100/255)+(e||"")},per2col:function(t){return t*re},rgb2hex:function(t,e,n,i,r){return r&&(t=m(Wt(t*re),0,255),e=m(Wt(e*re),0,255),n=m(Wt(n*re),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),i&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,i,r){return r&&(t=m(Wt(t*re),0,255),e=m(Wt(e*re),0,255),n=m(Wt(n*re),0,255),i=m(Wt(i*re),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(i=i<16?"0"+i.toString(16):i.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[m(parseInt(t[0]+t[0],16),0,255),m(parseInt(t[1]+t[1],16),0,255),m(parseInt(t[2]+t[2],16),0,255)]:[m(parseInt(t[0]+t[1],16),0,255),m(parseInt(t[2]+t[3],16),0,255),m(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:Ka,hsv2rgb:Za,hwb2rgb:Ja,rgb2hsl:tl,rgb2hsv:el,rgb2hwb:nl,rgb2cmyk:il,cmyk2rgb:rl,parse:function(t){var e,n,i,r,a,l,o,s=null,u=1;if((e=(t=Vt(String(t)).toLowerCase()).match(Kt))?(s=hex2rgb(e[1]),u=1,e[0].length,0):(e=t.match(Qt))?(n=e[2].match(ee),l=(i=Vt(e[2]).split(te).map(Vt))[0]||"0",o=i[1]||"0",r=i[2]||"0",a=n?n[1]:"1",l=parseFloat(l,10),o="%"===o.slice(-1)?parseFloat(o,10):100*parseFloat(o,10)/255,r="%"===r.slice(-1)?parseFloat(r,10):100*parseFloat(r,10)/255,a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),s=Ja(l,o,r),u=a,e[0].length,0):(e=t.match(Jt))?(n=e[2].match(ee),l=(i=Vt(e[2]).split(te).map(Vt))[0]||"0",t=i[1]||"0",o=i[2]||"0",a=n?n[1]:"hsla"===e[1]&&null!=i[3]?i[3]:"1",l=parseFloat(l,10),t="%"===t.slice(-1)?parseFloat(t,10):100*parseFloat(t,10)/255,o="%"===o.slice(-1)?parseFloat(o,10):100*parseFloat(o,10)/255,a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),s=Ka(l,t,o),u=a,e[0].length,0):(e=t.match(Zt))&&(n=e[2].match(ee),l=(i=Vt(e[2]).split(te).map(Vt))[0]||"0",o=i[1]||"0",r=i[2]||"0",a=n?n[1]:"rgba"===e[1]&&null!=i[3]?i[3]:"1",s=[l="%"===l.slice(-1)?2.55*parseFloat(l,10):parseFloat(l,10),o="%"===o.slice(-1)?2.55*parseFloat(o,10):parseFloat(o,10),r="%"===r.slice(-1)?2.55*parseFloat(r,10):parseFloat(r,10)],u=a="%"===a.slice(-1)?parseFloat(a,10)/100:parseFloat(a,10),e[0].length,0),s)return(new le).fromRGB([s[0],s[1],s[2],u])},fromString:function(t){return le.parse(t)},fromRGB:function(t){return(new le).fromRGB(t)},fromHSL:function(t){return(new le).fromHSL(t)},fromHSV:function(t){return(new le).fromHSV(t)},fromHWB:function(t){return(new le).fromHWB(t)},fromCMYK:function(t){return(new le).fromCMYK(t)},fromHEX:function(t){return(new le).fromHEX(t)},fromPixel:function(t){return(new le).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new le;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=m(t[0],0,255)),null!=t[1]&&(this.col[1]=m(t[1],0,255)),null!=t[2]&&(this.col[2]=m(t[2],0,255)),null!=t[3]?this.col[3]=m(t[3],0,1):this.col[3]=1,this.kword=null),this},isLight:function(t){return(t=null==t?127.5:t)<=al(this.col[0],this.col[1],this.col[2])},isTransparent:function(){return this.col[3]<1},fromPixel:function(t){return this.col=[m((t=t||0)>>16&255,0,255),m(t>>8&255,0,255),m(255&t,0,255),m((t>>24&255)*ie,0,1)],this.kword=null,this},fromHEX:function(t){return this.col[0]=t[0]?m(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?m(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?m(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?m(parseInt(t[3],10)*ie,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?m(Wt(t[0]),0,255):0,this.col[1]=t[1]?m(Wt(t[1]),0,255):0,this.col[2]=t[2]?m(Wt(t[2]),0,255):0,this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=rl(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?m(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=Ka(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=Za(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=Ja(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?m(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?m(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var i=il(this.col[0],this.col[1],this.col[2]);return n?i:i.concat(this.col[3])},toHEX:function(t,e,n){return n?le.rgb2hexIE(this.col[0],this.col[1],this.col[2],m(Wt(255*this.col[3]),0,255)):le.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var i=this.col[3];return t?(e&&(i=i<1&&0<i?i.toString().slice(1):i),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(i).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var i=this.col[3],r=tl(this.col[0],this.col[1],this.col[2]);return t?(e&&(r[1]=0==r[1]?r[1]:r[1]+"%",r[2]=0==r[2]?r[2]:r[2]+"%",i=i<1&&0<i?i.toString().slice(1):i),n||1==this.col[3]?"hsl("+[r[0],r[1],r[2]].join(",")+")":"hsla("+[r[0],r[1],r[2],i].join(",")+")"):n?r:r.concat(this.col[3])},toHWB:function(t,e,n){var i=this.col[3],r=nl(this.col[0],this.col[1],this.col[2]);return t?(e&&(r[1]=0===r[1]?r[1]:String(r[1])+"%",r[2]=0===r[2]?r[2]:String(r[2])+"%",i=i<1&&0<i?i.toString().slice(1):i),n||1===this.col[3]?"hwb("+[r[0],r[1],r[2]].join(" ")+")":"hwb("+[r[0],r[1],r[2]].join(" ")+" / "+i+")"):n?r:r.concat(this.col[3])},toString:function(t,e){return"rgb"===(t=t?t.toLowerCase():"hex")||"rgba"===t?this.toRGB(1,!1!==e,"rgb"===t):"hsl"===t||"hsla"===t?this.toHSL(1,!1!==e,"hsl"===t):"hwb"===t?this.toHWB(1,!1!==e,!1):this.toHEX(1,!1!==e,"hexie"===t)}})).toGray=le.intensity,r="prototype",p=w,A=p.CHANNEL,p.Color,oe=p.Util.Array.copy,p.Util.Array.subarray,se=p.Util.Math.clamp,(ue=Math).min,g=ue.floor,ce=0,A.R,A.G,A.B,A.A,(fe=p.Image=p.Class({name:"Image",constructor:function t(e,n){var i=this;if(!(i instanceof t))return new t(e,n);i.id=++ce,i.width=0,i.height=0,i.ctxOpts=n||{},i.iCanvas=p.Canvas(0,0),i.oCanvas=p.Canvas(0,0),i.domElement=i.oCanvas,i.iData=null,i.iDataSel=null,i.oData=null,i.oDataSel=null,i._restorable=!0,i.gray=!1,i.selection=null,i._refresh=0,i.nref=0,i.cache={},i._refresh|=15,e&&i.image(e)},id:null,width:0,height:0,gray:!1,selection:null,ctxOpts:null,iCanvas:null,oCanvas:null,gl:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_refresh:0,nref:0,cache:null,dispose:function(){var t=this;return p.disposeGL(t),t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=t.gl=null,t._restorable=null,t._refresh=t.nref=null,t.cache=t.ctxOpts=null,t},clone:function(t,e){return new fe(!0===t?this.iCanvas:this.oCanvas,e||this.ctxOpts)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,i,r){var a,l=this,o=arguments.length;return!1===t?(l.selection=null,l.iDataSel=null,l.oDataSel=null,l._refresh&=-13):(t instanceof p.Util.Image.Selection?(a=t,l.selection=[0,0,1,1,1,a]):(o<1&&(t=0),o<2&&(e=0),o<3&&(n=1),o<4&&(i=1),l.selection=r?[t<0?0:t,e<0?0:e,n<0?0:n,i<0?0:i,0,null]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,i<0?0:1<i?1:i,1,null]),l._refresh|=12),l.nref=(l.nref+1)%1e3,l},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d",t.ctxOpts).drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),t.nref=(t.nref+1)%1e3),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d",t.ctxOpts).drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),t.nref=(t.nref+1)%1e3),t},dimensions:function(t,e){var n=this;return ll(n,t,e,6)&&(n._refresh|=3,n.selection&&(n._refresh|=12),n.nref=(n.nref+1)%1e3),n},setDimensions:null,scale:function(t,e){var n,i,r=this,a=r.width,l=r.height;return t=t||1,e=e||t,1===t&&1===e||((i=(n=p.Canvas(+a,+l)).getContext("2d")).scale(t,e),a=r.width=ue.round(t*a),l=r.height=ue.round(e*l),i.drawImage(r.oCanvas,0,0),r.oCanvas.width=+a,r.oCanvas.height=+l,r.oCanvas.getContext("2d",r.ctxOpts).drawImage(n,0,0),r._restorable&&(i.drawImage(r.iCanvas,0,0),r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.iCanvas.getContext("2d",r.ctxOpts).drawImage(n,0,0)),r._refresh|=3,r.selection&&(r._refresh|=12),r.nref=(r.nref+1)%1e3),r},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=p.Canvas(e,n),i=n.getContext("2d");return i.translate(e,0),i.scale(-1,1),i.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d",t.ctxOpts).drawImage(n,0,0),t._restorable&&(i.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d",t.ctxOpts).drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=p.Canvas(e,n),i=e.getContext("2d");return i.translate(0,n),i.scale(1,-1),i.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d",t.ctxOpts).drawImage(e,0,0),t._restorable&&(i.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d",t.ctxOpts).drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d",t.ctxOpts).clearRect(0,0,e,n),t.oCanvas.getContext("2d",t.ctxOpts).clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3),t},crop:function(t,e,n,i){var r,a,l,o,s,u=this,c=u.selection,f=u.width,h=u.height;if(arguments.length)o=n-(a=t)+1,s=i-(l=e)+1;else{if(!c)return u;n=c[4]?(r=f-1,h-1):r=1,a=g(c[0]*r),l=g(c[1]*n),o=g(c[2]*r)-a+1,s=g(c[3]*n)-l+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}u.width=o,u.height=s,a*=1,l*=1;t=p.Canvas(o*=1,s*=1),i=t.getContext("2d");return i.drawImage(u.oCanvas,a,l,o,s,0,0,o,s),u.oCanvas.width=o,u.oCanvas.height=s,u.oCanvas.getContext("2d",u.ctxOpts).drawImage(t,0,0),u._restorable&&(i.drawImage(u.iCanvas,a,l,o,s,0,0,o,s),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.getContext("2d",u.ctxOpts).drawImage(t,0,0)),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},fill:function(t,e,n,i,r){var a,l,o,s,u=this,c=u.selection,f=u.width,h=u.height,f=((i&&!f||r&&!h)&&(ll(u,e+i,n+r,6),f=u.width,h=u.height),s=c?(s=c[4]?(o=f-1,h-1):o=1,a=g(c[0]*o),l=g(c[1]*s),o=g(c[2]*o)-a+1,g(c[3]*s)-l+1):(l=a=0,o=f,h),null==n&&(n=l),o<(i=null==i?o:i)&&(i=o),s<(r=null==r?s:r)&&(r=s),e=se(e=null==e?a:e,a,o),n=se(n,l,s),u.oCanvas.getContext("2d",u.ctxOpts)),h=u.iCanvas.getContext("2d",u.ctxOpts);return e*=1,n*=1,i*=1,r*=1,t=t||0,u._restorable&&(h.fillStyle=t,h.fillRect(e,n,i,r)),f.fillStyle=t,f.fillRect(e,n,i,r),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&ol(e,1),e.iData):(2&e._refresh&&ol(e,2),e.oData);return oe(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&sl(e,4),e.iDataSel):(8&e._refresh&&sl(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&ol(e,1),e.iData):(2&e._refresh&&ol(e,2),e.oData);return[oe(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d",e.ctxOpts).putImageData(p.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),e.nref=(e.nref+1)%1e3,e},setSelectedData:function(n){var i,r,a,l,t,o,e,s=this,u=s.selection,c=s.width,f=s.height;return u?u[5]?(e=u[5].bbox(),i=e.from.x,r=e.from.y,a=e.to.x-i+1,l=e.to.y-r+1,n=p.Canvas.ImageData(n,+a,+l),u[5].points().length<a*l&&(o=(o=s.oCanvas.getContext("2d",s.ctxOpts).getImageData(+i,+r,+a,+l))||s.oCanvas.getContext("2d",s.ctxOpts).createImageData(+a,+l),u[5].points().forEach(function(t){var e=t.x-i,t=t.y-r;0<=e&&e<a&&0<=t&&t<l&&(e=e+t*a<<2,o.data[e]=n.data[e],o.data[1+e]=n.data[1+e],o.data[2+e]=n.data[2+e],o.data[3+e]=n.data[3+e])}),n=o),s.oCanvas.getContext("2d",s.ctxOpts).putImageData(n,+i,+r)):(e=u[4]?(t=c-1,f-1):t=1,i=g(u[0]*t),r=g(u[1]*e),a=g(u[2]*t)-i+1,l=g(u[3]*e)-r+1,s.oCanvas.getContext("2d",s.ctxOpts).putImageData(p.Canvas.ImageData(n,+a,+l),+i,+r)):s.oCanvas.getContext("2d",s.ctxOpts).putImageData(p.Canvas.ImageData(n,+c,+f),0,0),s._refresh|=2,s.selection&&(s._refresh|=8),s.nref=(s.nref+1)%1e3,s},getDataFromSelection:function(t,e,n,i,r){var a=this,l=a.width-1,o=a.height-1,l=r?1:l,r=r?1:o;return t=+g(t*l),e=+g(e*r),o=(n=+g(n*l))-t+1,l=(i=+g(i*r))-e+1,n=(n=a.oCanvas.getContext("2d",a.ctxOpts).getImageData(t,e,o,l))||a.oCanvas.getContext("2d",a.ctxOpts).createImageData(0,0,o,l),[oe(n.data),n.width,n.height,2]},setDataToSelection:function(t,e,n,i,r,a){var l=this,o=l.width-1,s=l.height-1,o=a?1:o,a=a?1:s;return e=+g(e*o),n=+g(n*a),s=(i=+g(i*o))-e+1,o=(r=+g(r*a))-n+1,l.oCanvas.getContext("2d",l.ctxOpts).putImageData(p.Canvas.ImageData(t,s,o),e,n),l._refresh|=2,l.selection&&(l._refresh|=8),l.nref=(l.nref+1)%1e3,l},mapReduce:function(l,o,s){var u=this,c=0,f=0;return l.forEach(function(t,n){var i,r,a,e;t&&t.filter?(i=t.from||{x:0,y:0},r=t.to||{x:u.width-1,y:u.height-1},a=!t.to||t.absolute,e=u.getDataFromSelection(i.x,i.y,r.x,r.y,a),t.filter.apply_(u,e[0],e[1],e[2],function(t,e){++c,o&&o(u,t,i,r,a,e,n),c+f===l.length&&s&&s(u)})):++f}),f===l.length&&s&&s(u),u},image:function(t,e,n,i,r,a,l){var o;return t?1<arguments.length?this.image_s(t,e,n,i,r,a,l):(e=this,t instanceof fe&&(t=t.oCanvas),n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,i=t instanceof e.oCanvas.constructor,r=t instanceof p.Canvas.Image().constructor,a=n?(o=t.videoWidth,t.videoHeight):(o=t.width,t.height),ll(e,o,a,6),r||i||n?(e._restorable&&e.iCanvas.getContext("2d",e.ctxOpts).drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d",e.ctxOpts).drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d",e.ctxOpts).putImageData(t,0,0),e.oCanvas.getContext("2d",e.ctxOpts).putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),e.nref=(e.nref+1)%1e3,e):this},image_s:function(t,e,n,i,r,a,l,o,s){var u,c,f;return t?(u=this,t instanceof fe&&(t=t.oCanvas),c="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,f=t instanceof u.oCanvas.constructor,i=i||0,r=r||0,a=a||0,l=l||0,t instanceof p.Canvas.Image().constructor||f||c?(u._restorable&&u.iCanvas.getContext("2d",u.ctxOpts).drawImage(t,i,r,e,n,a,l,u.iCanvas.width,u.iCanvas.height),u.oCanvas.getContext("2d",u.ctxOpts).drawImage(t,i,r,e,n,a,l,u.oCanvas.width,u.oCanvas.height)):(u._restorable&&u.iCanvas.getContext("2d",u.ctxOpts).putImageData(t,a,l,i,r,e,n),u.oCanvas.getContext("2d",u.ctxOpts).putImageData(t,a,l,i,r,e,n)),u._refresh|=3,u.selection&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u):this},setImage:null,toImage:function(n,i){function t(t){var e;"uri"!==i?((e=p.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"("+this.id+")]"}})).load=function(t,e){var n=p.Canvas.Image(),i=new fe;return"onload"in n&&(n.onload=function(){i.image(n),"function"==typeof e&&e(i)}),n.src=t,i},fe[r].setImage=fe[r].image,fe[r].setDimensions=fe[r].dimensions,he=w,Object.prototype,Function.prototype,y=Array.prototype,me=y.slice,pe=y.splice,de=y.push,ge=he.Util.Array.typed_obj,(y=he.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:he.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,i=[],r=!1,a=0,l=n.length;a<l;++a)i.push(e=n[a].serializeInputs(t)),e&&(r=!0);return r?i:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,i=0,r=n.length;i<r;++i)t[i]&&n[i].unserializeInputs(t[i],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,i=t.length;n<i;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,i,r,a,l=this,o=l.filters;if(l._stable=t._stable,(n=(r=t.filters||[]).length)===(i=o.length)&&l._stable)for(e=0;e<n;++e)o[e].unserializeFilter(r[e]);else{for(e=0;e<i;++e)o[e]&&o[e].dispose(!0),o[e]=null;for(o=[],e=0;e<n;++e){if(!(a=r[e]&&r[e].filter?he.Filter.get(r[e].filter):null))throw new Error('Filter "'+r[e].filter+'" could not be created');o.push((new a).unserializeFilter(r[e]))}l.filters=o}return l},metaData:function(t){var e,n,i=this.filters,r=this.meta,a=r;if(t&&he.isWorker){if(r&&r.filters){for(n=r.filters.length,a={filters:new Array(n)},e=0;e<n;++e)a.filters[e]=[r.filters[e][0],i[r.filters[e][0]].metaData(t)];null!=r._IMG_WIDTH&&(a._IMG_WIDTH=r._IMG_WIDTH,a._IMG_HEIGHT=r._IMG_HEIGHT)}return ge(a)}return r},setMetaData:function(t,e){var n,i,r=this.filters;if((t=e&&"string"==typeof t?ge(t,1):t)&&t.filters&&(i=t.filters.length)&&r.length)for(n=0;n<i;++n)r[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this._glsl=null,this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this._glsl=null,this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&de.apply(this.filters,arguments),this._glsl=null,this},concat:null,pop:function(){return this._glsl=null,this.filters.pop()},shift:function(){return this._glsl=null,this.filters.shift()},unshift:function(){return arguments.length&&pe.apply(this.filters,de.apply([0,0],arguments)),this._glsl=null,this},insertAt:function(t){var e=me.call(arguments);e.length;return 1<argslen&&(e.shift(),pe.apply(this.filters,[t,0].concat(e)),this._glsl=null),this},removeAt:function(t){return this._glsl=null,this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this._glsl=null,this},reset:function(){return this.filters.length=0,this._glsl=null,this},empty:null,getGLSL:function(){return null},getWASM:function(){return null},isGLSL:function(){if(this._isGLSL)for(var t=this.filters,e=0,n=t.length;e<n;++e)if(t[e]&&t[e].isOn()&&t[e].isGLSL())return!0;return!1},isWASM:function(){if(this._isWASM)for(var t=this.filters,e=0,n=t.length;e<n;++e)if(t[e]&&t[e].isOn()&&t[e].isWASM())return!0;return!1},GLSLCode:function(){for(var t,e,n=this.filters,i=[],r=n.length,a=0;a<r;++a)(t=n[a])&&((e=t.GLSLCode())?e.push?i.push.apply(i,e):i.push(e):t._apply&&i.push({instance:t}));return i},_apply:function(t,e,n,i){var r=this,a=r._runWASM,l=null,o=0,s=null,u=null;if(r.filters.length){i=i||{};for(var c,f=r.filters,h=f.length,l=new Array(h),m=0;m<h;++m)(c=f[m])&&c.canRun()&&(i.container=r,i.index=m,t=a?c._apply_wasm(t,e,n,i):c._apply(t,e,n,i),c.hasMeta)&&(l[o++]=[m,c=c.metaData()],null!=c._IMG_WIDTH)&&(s=e=c._IMG_WIDTH,u=n=c._IMG_HEIGHT)}return 0<o?(l.length>o&&(l.length=o),r.hasMeta=!0,r.meta={filters:l},null!=s&&(r.meta._IMG_WIDTH=s,r.meta._IMG_HEIGHT=u)):(r.hasMeta=!1,r.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,i=0;i<n;++i)e.push("\t"+t[i].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=y.prototype.filter,y.prototype.empty=y.prototype.reset,y.prototype.concat=y.prototype.push,he.CompositionFilter=he.CompositeFilter,v=w,xe=v.Util.Array.copy,_e=v.Util.GLSL,ye=Math,ve=ye.min,be=ye.round,we=v._notSupportClamp,Ce=v.Color.clampPixel,v.Create({name:"BlendFilter",init:function(t){this.set(t)},path:v.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this._glsl=null,this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),null!=e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this._glsl=null,this},getGLSL:function(){var t=this;if(!t.matrix||!t.matrix.length)return new _e.Filter(t).begin().shader(_e.DEFAULT).end().code();var e,n,i=t.matrix,r="",a="";for(n=1,e=0;e<i.length;e+=4,++n)r+=(r.length?"\n":"")+"uniform sampler2D input"+n+";\nuniform vec2 inputSize"+n+";\nuniform int inputMode"+n+";\nuniform vec2 inputStart"+n+";\nuniform int inputEnabled"+n+";",a+=(a.length?"\n":"")+"col = doblend(col, pix, input"+n+", inputSize"+n+", inputStart"+n+", inputMode"+n+", inputEnabled"+n+");";return new _e.Filter(t).begin().shader([Ae.map(function(t,e){return"LINEARDODGE"===t?"#define LINEARDODGE "+e+"\n#define ADD "+e:"LINEARBURN"===t?"#define LINEARBURN "+e+"\n#define SUBTRACT "+e:"#define "+t+" "+e}).join("\n"),Object.keys(De).map(function(t){return De[t]}).join("\n"),"float blend(int mode, float Dca, float Da, float Sca, float Sa) {","    if (MULTIPLY == mode) return multiply(Dca, Da, Sca, Sa);","    else if (SCREEN == mode) return screen(Dca, Da, Sca, Sa);","    else if (OVERLAY == mode) return overlay(Dca, Da, Sca, Sa);","    else if (DARKEN == mode) return darken(Dca, Da, Sca, Sa);","    else if (LIGHTEN == mode) return lighten(Dca, Da, Sca, Sa);","    else if (COLORDODGE == mode) return colordodge(Dca, Da, Sca, Sa);","    else if (COLORBURN == mode) return colorburn(Dca, Da, Sca, Sa);","    else if (HARDLIGHT == mode) return hardlight(Dca, Da, Sca, Sa);","    else if (SOFTLIGHT == mode) return softlight(Dca, Da, Sca, Sa);","    else if (DIFFERENCE == mode) return difference(Dca, Da, Sca, Sa);","    else if (EXCLUSION == mode) return exclusion(Dca, Da, Sca, Sa);","    else if (AVERAGE == mode) return average(Dca, Da, Sca, Sa);","    else if (LINEARDODGE == mode) return lineardodge(Dca, Da, Sca, Sa);","    else if (LINEARBURN == mode) return linearburn(Dca, Da, Sca, Sa);","    else if (NEGATION == mode) return negation(Dca, Da, Sca, Sa);","    else if (LINEARLIGHT == mode) return linearlight(Dca, Da, Sca, Sa);","    return normal(Dca, Da, Sca, Sa);","}","vec4 doblend(vec4 B, vec2 pix, sampler2D Atex, vec2 size, vec2 start, int mode, int enabled) {","    if (0 == enabled || pix.x < start.x || pix.y < start.y || pix.x > start.x+size.x || pix.y > start.y+size.y) return B;","    vec4 A = texture2D(Atex, (pix-start)/size);","    float a = 1.0;","    if (NORMAL != mode) a = clamp(A.a + B.a - A.a*B.a, 0.0, 1.0);","    else a = clamp(A.a + B.a*(1.0 - A.a), 0.0, 1.0);","    if (0.0 < a) return vec4(","        clamp(blend(mode, B.r*B.a, B.a, A.r*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.g*B.a, B.a, A.g*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.b*B.a, B.a, A.b*A.a, A.a)/a, 0.0, 1.0),","        a","    );","    return vec4(0.0);","}","varying vec2 pix;","uniform sampler2D img;",r,"void main(void) {","vec4 col = texture2D(img, pix);",a,"gl_FragColor = col;","}"].join("\n")).input("*",function(t,e,n,i,r,a,l,o){for(var s,u,c=t.matrix,f=1,h=0;h<c.length;h+=4,++f)u=(c[h]||"normal").toUpperCase().replace("-",""),Se[u]&&(u=Se[u]),s=t.input(f),_e.uploadTexture(l,s[0],s[1],s[2],f),l.uniform1i(o.uniform["input"+f].loc,f),l.uniform2f(o.uniform["inputSize"+f].loc,s[1]/e,s[2]/n),l.uniform1i(o.uniform["inputMode"+f].loc,Ae.indexOf(u)),l.uniform2f(o.uniform["inputStart"+f].loc,c[h+1]/e,c[h+2]/n),l.uniform1i(o.uniform["inputEnabled"+f].loc,c[h+3]?1:0)}).end().code()},_apply:function(t,e,n){var i=this.matrix;if(!i||!i.length)return t;for(var r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L,E,M,T,O,N=i.length,G=(t.length,xe(t)),F=0,H=1;F<N;F+=4,++H)if(i[F+3]&&(A=i[F]||"normal",C=U[A])&&(p=this.input(H))&&(h=p[0],m=p[1],p=p[2],(l=i[F+1]||0)<(u=s=0)&&(s=-l,l=0),(o=i[F+2]||0)<0&&(u=-o,o=0),!(e<=l||n<=o||m<=s||p<=u||(l=be(l),o=be(o),s=be(s),u=be(u),c=ve(e-l,m-s),f=ve(n-o,p-u),c<=0)||f<=0)))if(v=o*e,w=u*m,d=(y=l)+c,g=(b=s)+c,we)for(x=0,_=f*c;x<_;++x)S=G[r=y+v<<2],D=G[r+1],I=G[r+2],R=G[r+3]/255,L=h[a=b+w<<2],E=h[a+1],M=h[a+2],T=h[a+3]/255,0<(O="normal"!==A?T+R-T*R:T+R*(1-T))?(G[r]=Ce(be(255*C(R*S/255,R,T*L/255,T)/O)),G[r+1]=Ce(be(255*C(R*D/255,R,T*E/255,T)/O)),G[r+2]=Ce(be(255*C(R*I/255,R,T*M/255,T)/O)),G[r+3]=Ce(be(255*O))):(G[r]=0,G[r+1]=0,G[r+2]=0,G[r+3]=0),++y>=d&&(y=l,v+=e),++b>=g&&(b=s,w+=m);else for(x=0,_=f*c;x<_;++x)S=G[r=y+v<<2],D=G[r+1],I=G[r+2],R=G[r+3]/255,L=h[a=b+w<<2],E=h[a+1],M=h[a+2],T=h[a+3]/255,0<(O="normal"!==A?T+R-T*R:T+R*(1-T))?(G[r]=be(255*C(R*S/255,R,T*L/255,T)/O),G[r+1]=be(255*C(R*D/255,R,T*E/255,T)/O),G[r+2]=be(255*C(R*I/255,R,T*M/255,T)/O),G[r+3]=be(255*O)):(G[r]=0,G[r+1]=0,G[r+2]=0,G[r+3]=0),++y>=d&&(y=l,v+=e),++b>=g&&(b=s,w+=m);return G}}),v.CombineFilter=v.BlendFilter,(U=v.Color.Blend={normal:function(t,e,n,i){return n+t*(1-i)},multiply:function(t,e,n,i){return n*t+n*(1-e)+t*(1-i)},screen:function(t,e,n,i){return n+t-n*t},overlay:function(t,e,n,i){return 2*t<=e?2*n*t+n*(1-e)+t*(1-i):n*(1+e)+t*(1+i)-2*t*n-e*i},darken:function(t,e,n,i){return ye.min(n*e,t*i)+n*(1-e)+t*(1-i)},lighten:function(t,e,n,i){return ye.max(n*e,t*i)+n*(1-e)+t*(1-i)},"color-dodge":function(t,e,n,i){return n===i&&0===t?n*(1-e):n===i?i*e+n*(1-e)+t*(1-i):i*e*ye.min(1,t/e*i/(i-n))+n*(1-e)+t*(1-i)},"color-burn":function(t,e,n,i){return 0===n&&t===e?i*e+t*(1-i):0===n?t*(1-i):i*e*(1-ye.min(1,(1-(e?t/e:0))*i/n))+n*(1-e)+t*(1-i)},"hard-light":function(t,e,n,i){return 2*n<=i?2*n*t+n*(1-e)+t*(1-i):n*(1+e)+t*(1+i)-i*e-2*n*t},"soft-light":function(t,e,n,i){var r=e?t/e:0;return 2*n<=i?t*(i+(2*n-i)*(1-r))+n*(1-e)+t*(1-i):i<2*n&&4*t<=e?e*(2*n-i)*(16*ye.pow(r,3)-12*ye.pow(r,2)-3*r)+n-n*e+t:e*(2*n-i)*(ye.pow(r,.5)-r)+n-n*e+t},difference:function(t,e,n,i){return n+t-2*ye.min(n*e,t*i)},exclusion:function(t,e,n,i){return n*e+t*i-2*n*t+n*(1-e)+t*(1-i)},average:function(t,e,n,i){return(n+t)/2},add:function(t,e,n,i){return ye.min(1,n+t)},subtract:function(t,e,n,i){return ye.max(0,t+n-1)},negation:function(t,e,n,i){return 1-ye.abs(1-n-t)},"linear-light":function(t,e,n,i){return n<.5?U.subtract(t,e,2*n,i):U.add(t,e,2*(1-n),i)}}).lineardodge=U["linear-dodge"]=U.add,U.linearburn=U["linear-burn"]=U.subtract,U.linearlight=U["linear-light"],U.hardlight=U["hard-light"],U.softlight=U["soft-light"],U.colordodge=U["color-dodge"],U.colorburn=U["color-burn"],Ae=["NORMAL","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLORDODGE","COLORBURN","HARDLIGHT","SOFTLIGHT","DIFFERENCE","EXCLUSION","AVERAGE","LINEARDODGE","LINEARBURN","NEGATION","LINEARLIGHT"],Se={ADD:"LINEARDODGE",SUBTRACT:"LINEARBURN"},v.BlendFilter.modes=Ae,v.BlendFilter.modes.same=Se,De={normal:"float normal(float Dca, float Da, float Sca, float Sa){return Sca + Dca * (1.0 - Sa);}",multiply:"float multiply(float Dca, float Da, float Sca, float Sa){return Sca*Dca + Sca*(1.0 - Da) + Dca*(1.0 - Sa);}",screen:"float screen(float Dca, float Da, float Sca, float Sa){return Sca + Dca - Sca * Dca;}",overlay:"float overlay(float Dca, float Da, float Sca, float Sa){if (2.0*Dca <= Da) return (2.0*Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - 2.0 * Dca * Sca - Da * Sa);}",darken:"float darken(float Dca, float Da, float Sca, float Sa){return min(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",lighten:"float lighten(float Dca, float Da, float Sca, float Sa){return max(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}","color-dodge":"float colordodge(float Dca, float Da, float Sca, float Sa){if (Sca == Sa && 0.0 == Dca) return (Sca * (1.0 - Da)); else if (Sca == Sa) return (Sa * Da + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sa * Da * min(1.0, Dca/Da * Sa/(Sa - Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","color-burn":"float colorburn(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (0.0 == Sca && Dca == Da) return (Sa * Da + Dca * (1.0 - Sa)); else if (0.0 == Sca) return (Dca * (1.0 - Sa)); else return (Sa * Da * (1.0 - min(1.0, (1.0 - m) * Sa/Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","hard-light":"float hardlight(float Dca, float Da, float Sca, float Sa){if (2.0 * Sca <= Sa) return (2.0 * Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - Sa * Da - 2.0 * Sca * Dca);}","soft-light":"float softlight(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (2.0 * Sca <= Sa) return (Dca * (Sa + (2.0 * Sca - Sa) * (1.0 - m)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else if (2.0 * Sca > Sa && 4.0 * Dca <= Da) return (Da * (2.0 * Sca - Sa) * (16.0 * pow(m, 3.0) - 12.0 * pow(m, 2.0) - 3.0 * m) + Sca - Sca * Da + Dca); else return (Da * (2.0 * Sca - Sa) * (pow(m, 0.5) - m) + Sca - Sca * Da + Dca);}",difference:"float difference(float Dca, float Da, float Sca, float Sa){return Sca + Dca - 2.0 * min(Sca * Da, Dca * Sa);}",exclusion:"float exclusion(float Dca, float Da, float Sca, float Sa){return (Sca * Da + Dca * Sa - 2.0 * Sca * Dca) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",average:"float average(float Dca, float Da, float Sca, float Sa){return (Sca + Dca) / 2.0;}",add:"float lineardodge(float Dca, float Da, float Sca, float Sa){return min(1.0, Sca + Dca);}",subtract:"float linearburn(float Dca, float Da, float Sca, float Sa){return max(0.0, Dca + Sca - 1.0);}",negation:"float negation(float Dca, float Da, float Sca, float Sa){return 1.0 - abs(1.0 - Sca - Dca);}","linear-light":"float linearlight(float Dca, float Da, float Sca, float Sa){if (Sca < 0.5) return linearburn(Dca, Da, 2.0*Sca, Sa); else return lineardodge(Dca, Da, 2.0*(1.0 - Sca), Sa);}"},Ie=w,Re=Math,Le=Ie.Util.Image,Ee=Ie.Util.GLSL,Ie.Create({name:"DimensionFilter",init:function(t,e,n,i,r){this.set(t,e,n,i,r)},path:Ie.Path,m:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!0,dispose:function(){return this.m=null,this.$super("dispose"),this},serialize:function(){var t=this;return{m:t.m,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.m,t.a,t.b,t.c,t.d),this},metaData:function(t){return t&&Ie.isWorker?JSON.stringify(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?JSON.parse(t):t,this},set:function(t,e,n,i,r){var a=this;return t?(a.m=String(t||"scale").toLowerCase(),a.a=e||0,a.b=n||0,a.c=i||0,a.d=r||0):(a.m=null,a.a=0,a.b=0,a.c=0,a.d=0),a._glsl=null,a},reset:function(){return this.set(null)},getGLSL:function(){return i=this,t=Le.glsl(),new Ee.Filter(i).begin().shader(i.m?["varying vec2 pix;","uniform sampler2D img;","uniform vec2 wh;","uniform vec2 nwh;","uniform int m;","uniform float a;","uniform float b;","uniform float c;","uniform float d;","vec4 set(vec2 pix, sampler2D img) {","   return vec4(0.0);","}",t.crop,t.pad,t.interpolate,"void main(void) {","    if (1 == m) gl_FragColor = set(pix, img);","    else if (2 == m) gl_FragColor = pad(pix, img, wh, nwh, c, d, a, b);","    else if (3 == m) gl_FragColor = crop(pix, img, wh, nwh, a, b, a+c-1.0, b+d-1.0);","    else gl_FragColor = interpolate(pix, img, wh, nwh);","}"].join("\n"):Ee.DEFAULT).dimensions(function(t,e,n){return n.params=function(t,e,n){var i,r,a,l=t.a,o=t.b,s=t.c,u=t.d;switch(t.m){case"set":i=1,s&&u&&(l=s*e,o=u*n),r=l,a=o;break;case"pad":i=2,r=e+l+s,a=n+o+u;break;case"crop":i=3,r=s,a=u;break;default:i=4,s&&u&&(l=s*e,o=u*n),r=l,a=o}return{m:i,a:t.a,b:t.b,c:t.c,d:t.d,w:e,h:n,nw:Re.round(r),nh:Re.round(a)}}(i,t,e),[n.params.nw,n.params.nh]}).input("wh",function(t,e,n,i,r){return[i,r]}).input("nwh",function(t,e,n,i,r){return[e,n]}).input("m",function(t,e,n,i,r,a){return a.params.m}).input("a",function(t,e,n,i,r,a){return a.params.a}).input("b",function(t,e,n,i,r,a){return a.params.b}).input("c",function(t,e,n,i,r,a){return a.params.c}).input("d",function(t,e,n,i,r,a){return a.params.d}).end().code();var i,t},getWASM:function(){return null},_apply:function(t,e,n,i){var r=this,a=r._runWASM,l=r.m,o=r.a,s=r.b,u=r.c,c=r.d;if(l)switch(r.hasMeta=!0,l){case"set":s=u&&c?(o=Re.round(u*e),Re.round(c*n)):(o=Re.round(o),Re.round(s)),t=new Ie.ImArray(o*s<<2),r.meta={_IMG_WIDTH:o,_IMG_HEIGHT:s};break;case"pad":o=Re.round(o),s=Re.round(s),u=Re.round(u),c=Re.round(c),t=Le.pad(t,e,n,u,c,o,s),r.meta={_IMG_WIDTH:o+u+e,_IMG_HEIGHT:s+c+n};break;case"crop":o=Re.round(o),s=Re.round(s),u=Re.round(u),c=Re.round(c),t=Le.crop(t,e,n,o,s,o+u-1,s+c-1),r.meta={_IMG_WIDTH:u,_IMG_HEIGHT:c};break;default:s=u&&c?(o=Re.round(u*e),Re.round(c*n)):(o=Re.round(o),Re.round(s)),t=(a&&Le.wasm||Le).interpolate(t,e,n,o,s),r.meta={_IMG_WIDTH:o,_IMG_HEIGHT:s}}else r.meta=null,r.hasMeta=!1;return t}}),x=(Me=w).CHANNEL,Te=Me.ColorTable,Oe=Me.Color.clampPixel,(Ge=Math).floor,Fe=Ge.pow,Ne=Ge.exp,He=1/255,Ue=Me.Util.Array.typed,u=Me.Util.Filter.ct_eye,ze=Me.Util.Filter.ct_multiply,Be=Me.Util.GLSL,(b=Me.Create({name:"ColorTableFilter",init:function(t,e,n,i){var r=this;r.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,i=i||null,r.table[x.R]=t,r.table[x.G]=e,r.table[x.B]=n,r.table[x.A]=i},path:Me.Path,table:null,img:null,dispose:function(){return this.table=null,this.img=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[x.R],tableG:this.table[x.G],tableB:this.table[x.B],tableA:this.table[x.A]}},unserialize:function(t){var e=this;return e.table[x.R]=Ue(t.tableR,Te),e.table[x.G]=Ue(t.tableG,Te),e.table[x.B]=Ue(t.tableB,Te),e.table[x.A]=Ue(t.tableA,Te),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=u(t),e=e?u(e):t,n=n?u(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,i;switch(t||x.R){case x.B:e=u(0,0),n=u(0,0),i=u();break;case x.G:e=u(0,0),n=u(),i=u(0,0);break;default:x.R;e=u(),n=u(0,0),i=u(0,0)}return this.set(e,n,i)},redChannel:function(){return this.channel(x.R)},greenChannel:function(){return this.channel(x.G)},blueChannel:function(){return this.channel(x.B)},channelInvert:function(t){if(null==t)return this;var e,n,i;switch(t||x.R){case x.B:e=u(),n=u(),i=u(-1,255);break;case x.G:e=u(),n=u(-1,255),i=u();break;default:x.R;e=u(-1,255),n=u(),i=u()}return this.set(e,n,i)},redInvert:function(){return this.channelInvert(x.R)},greenInvert:function(){return this.channelInvert(x.G)},blueInvert:function(){return this.channelInvert(x.B)},invert:function(){return this.set(Me.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var i,r=(t=t.length?t:[t]).length,a=r+1,l=(e=e||t).length,o=l+1,s=(n=n||e).length,u=s+1,c=new Te(256),f=new Te(a),h=new Te(256),m=new Te(o),p=new Te(256),d=new Te(u),g=255/(a-1),x=255/(o-1),_=255/(u-1),y=0;y<a;++y)f[y]=g*y|0;for(t[0]=255*t[0]|0,y=1;y<r;++y)t[y]=t[y-1]+255*t[y]|0;for(y=0;y<o;++y)m[y]=x*y|0;for(e[0]=255*e[0]|0,y=1;y<l;++y)e[y]=e[y-1]+255*e[y]|0;for(y=0;y<u;++y)d[y]=_*y|0;for(n[0]=255*n[0]|0,y=1;y<s;++y)n[y]=n[y-1]+255*n[y]|0;for(y=0;y<256;++y){for(i=0;i<r&&y>t[i];)++i;for(c[y]=Oe(f[i]),i=0;i<l&&y>e[i];)++i;for(h[y]=Oe(m[i]),i=0;i<s&&y>n[i];)++i;p[y]=Oe(d[i])}return this.set(c,h,p)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){Ge.ceil(255/((t=256<(t=(t=null==t?64:t)<2?2:t)?256:t)-1));for(var e=new Te(t),n=255/(t-1),i=t/256,r=0;r<t;++r)e[r]=Oe(n*r|0);return this.set(u(function(t){return e[i*t|0]}))},quantizeAlt:function(t){var e=Ge.ceil(255/((t=256<(t=(t=null==t?64:t)<2?2:t)?256:t)-1));return this.set(u(function(t){return Oe(Ge.round(t/e)*e)}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(u(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,i=255&t;return this.set(u(function(t){return t&e}),u(function(t){return t&n}),u(function(t){return t&i}))},replace:function(t,e){var n,i,r;return t==e?this:(n=u(),i=u(),r=u(),n[t>>>16&255]=e>>>16&255,i[t>>>8&255]=e>>>8&255,r[255&t]=255&e,this.set(n,i,r))},extract:function(t,e,n){if(!e||!e.length)return this;var i=u(0,(n=n||0)>>>16&255),r=u(0,n>>>8&255),a=u(0,255&n);switch(t||x.R){case x.B:for(s=e[0],f=e[1];s<=f;++s)a[s]=Oe(s);break;case x.G:for(s=e[0],f=e[1];s<=f;++s)r[s]=Oe(s);break;default:x.R;for(s=e[0],f=e[1];s<=f;++s)i[s]=Oe(s)}return this.set(i,r,a)},gammaCorrection:function(e,n,i){return e=e||1,n=n||e,i=i||n,e=1/e,n=1/n,i=1/i,this.set(u(function(t){return 255*Fe(He*t,e)}),u(function(t){return 255*Fe(He*t,n)}),u(function(t){return 255*Fe(He*t,i)}))},exposure:function(e){return null==e&&(e=1),this.set(u(function(t){return 255*(1-Ne(-e*t*He))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(u(t+=1,128*(1-t)),u(e,128*(1-e)),u(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(u(1,t),u(1,e),u(1,n))},quickContrastCorrection:function(t){return this.set(u(null==t?1.2:+t))},set:function(t,e,n,i){var r,a,l,o,s=this;return t&&(a=(r=s.table)[x.R]||u(),e||n?(e=e||t,n=n||e,l=r[x.G]||a,o=r[x.B]||l,r[x.R]=ze(t,a),r[x.G]=ze(e,l),r[x.B]=ze(n,o)):(r[x.R]=ze(t,a),r[x.G]=r[x.R],r[x.B]=r[x.R]),s.img=null,s._glsl=null),s},reset:function(){return this.table=[null,null,null,null],this.img=null,this._glsl=null,this},getGLSL:function(){return t=this,new Be.Filter(t).begin().shader(t.table&&t.table[x.R]?["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform int hasAlpha;","void main(void) {","   vec4 col = texture2D(img, pix);","   if (1 == hasAlpha) gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,texture2D(map, vec2(col.a, 0.0)).a);","   else gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,col.a);","}"].join("\n"):Be.DEFAULT).input("hasAlpha",function(t){return t.table[x.A]?1:0}).input("map",function(t){return{data:t.getImage(),width:256,height:1}}).end().code();var t},combineWith:function(t){return this.set(t.getTable(x.R),t.getTable(x.G),t.getTable(x.B))},getTable:function(t){return this.table[t||x.R]||null},setTable:function(t,e){return this.table[e||x.R]=t||null,this.img=null,this},getImage:function(){var t=this.table;if(t&&t[x.R]&&!this.img){for(var e=t[x.R],n=t[x.G]||e,i=t[x.B]||n,r=t[x.A],a=new Me.Array8U(1024),l=0,o=0;l<1024;l+=4,++o)a[l]=e[o],a[l+1]=n[o],a[l+2]=i[o],a[l+3]=r?r[o]:255;this.img=a}return this.img},_apply:function(t,e,n){var i=this.table;if(i&&i[x.R]){var r,a,l=t.length,o=(15&l>>>2)<<2,s=i[x.R],u=i[x.G]||s,c=i[x.B]||u,f=i[x.A];if(f){for(r=0;r<o;r+=4)t[r]=s[t[r]],t[r+1]=u[t[r+1]],t[r+2]=c[t[r+2]],t[r+3]=f[t[r+3]];for(a=o;a<l;a+=64)t[r=a]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]]}else{for(r=0;r<o;r+=4)t[r]=s[t[r]],t[r+1]=u[t[r+1]],t[r+2]=c[t[r+2]];for(a=o;a<l;a+=64)t[r=a]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],++r}}return t},canRun:function(){return this._isOn&&this.table&&this.table[x.R]}})).prototype.posterize=b.prototype.levels=b.prototype.quantize,Me.TableLookupFilter=Me.ColorTableFilter,o=(l=w).CHANNEL,Ye=l.ColorMatrix,ke=l.Array8U,t=Math,Pe=t.sin,je=t.cos,Xe=l.CONST.toRad,l.CONST.toDeg,We=l.Util.Array.typed,t=l._notSupportClamp,$e=l.Util.Filter.cm_rechannel,qe=l.Util.Filter.cm_combine,Ve=l.Util.Filter.cm_multiply,Ke=l.Util.GLSL,(t=l.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new Ye(t):null},path:l.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=We(t.matrix,Ye),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=o.A===(t=t||0)||e?1:0;return n[5*o.R+t]=o.R===t?1:e,n[5*o.G+t]=o.G===t?1:e,n[5*o.B+t]=o.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(o.R,t)},greenChannel:function(t){return this.channel(o.G,t)},blueChannel:function(t){return this.channel(o.B,t)},alphaChannel:function(t){return this.channel(o.A,!0)},maskChannel:function(t){var e;return o.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return o.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(o.R)},invertGreen:function(){return this.invertChannel(o.G)},invertBlue:function(){return this.invertChannel(o.B)},invertAlpha:function(){return this.invertChannel(o.A)},invert:function(){return this.set($e([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},desaturate:function(t){t=t||l.LUMA;return this.set($e([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},grayscale:null,saturate:function(t,e){var e=e||l.LUMA,n=1-t,i=n*e[0],r=n*e[1],n=n*e[2];return this.set($e([i+t,r,n,0,0,i,r+t,n,0,0,i,r,n+t,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},colorize:function(t,e,n){var i,r,n=n||l.LUMA;return this.set($e([(r=1-(e=null==e?1:e))+e*(i=(t>>16&255)/255)*n[0],e*i*n[1],e*i*n[2],0,0,e*(i=(t>>8&255)/255)*n[0],r+e*i*n[1],e*i*n[2],0,0,e*(i=(255&t)/255)*n[0],e*i*n[1],r+e*i*n[2],0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set($e([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},brightness:function(t,e,n){return this.set($e([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},adjustHue:function(t,e){var n=je(t*=Xe),t=Pe(t),e=e||l.LUMA;return this.set($e([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},rotateHue:null,average:function(t,e,n){return this.set($e([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},quickContrastCorrection:function(t){return this.set($e([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set($e([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||l.LUMA;return this.set($e([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},threshold:function(t,e,n){null==e&&(e=256);var i=n||l.LUMA;return this.set($e(!1!==n?[i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],o.R,o.G,o.B,o.A,o.R,o.G,o.B,o.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,i){null==n&&(n=256);var r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=i||l.LUMA;return o.A===t?(r[5*t+t]=n,r[5*t+4]=-n*e):(!1!==i?(r[5*t+o.R]=a[0]*n,r[5*t+o.G]=a[1]*n,r[5*t+o.B]=a[2]*n):(r[5*t+o.R]=n,r[5*t+o.G]=n,r[5*t+o.B]=n),r[5*t+4]=-(n-1)*e),this.set(r)},thresholdRed:function(t,e,n){return this.thresholdChannel(o.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(o.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(o.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(o.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set($e([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.XX,o.YY,o.ZZ,o.A))},XYZ2RGB:function(){return this.set($e([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],o.XX,o.YY,o.ZZ,o.A,o.R,o.G,o.B,o.A))},RGB2YCbCr:function(){return this.set($e([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],o.R,o.G,o.B,o.A,o.Y,o.CB,o.CR,o.A))},YCbCr2RGB:function(){return this.set($e([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],o.Y,o.CB,o.CR,o.A,o.R,o.G,o.B,o.A))},RGB2YIQ:function(){return this.set($e([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],o.R,o.G,o.B,o.A,o.Y,o.IP,o.Q,o.A))},YIQ2RGB:function(){return this.set($e([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],o.Y,o.IP,o.Q,o.A,o.R,o.G,o.B,o.A))},blend:function(t,e){return this.matrix=this.matrix?qe(this.matrix,t.matrix,1-e,e,Ye):new Ye(t.matrix),this},set:function(t){var e=this;return e.matrix=e.matrix?Ve(e.matrix,t):new Ye(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){return t=this,new Ke.Filter(t).begin().shader(t.matrix?["varying vec2 pix;","uniform sampler2D img;","uniform float cm[20];","void main(void) {","   vec4 col = texture2D(img, pix);","   gl_FragColor.r = clamp(cm[0 ]*col.r+cm[1 ]*col.g+cm[2 ]*col.b+cm[3 ]*col.a+cm[4 ],0.0,1.0);","   gl_FragColor.g = clamp(cm[5 ]*col.r+cm[6 ]*col.g+cm[7 ]*col.b+cm[8 ]*col.a+cm[9 ],0.0,1.0);","   gl_FragColor.b = clamp(cm[10]*col.r+cm[11]*col.g+cm[12]*col.b+cm[13]*col.a+cm[14],0.0,1.0);","   gl_FragColor.a = clamp(cm[15]*col.r+cm[16]*col.g+cm[17]*col.b+cm[18]*col.a+cm[19],0.0,1.0);","}"].join("\n"):Ke.DEFAULT).input("cm",function(t){t=t.matrix;return[t[0],t[1],t[2],t[3],t[4]/255,t[5],t[6],t[7],t[8],t[9]/255,t[10],t[11],t[12],t[13],t[14]/255,t[15],t[16],t[17],t[18],t[19]/255]}).end().code();var t},combineWith:function(t){return this.set(t.matrix)},_apply:t?function(t,e,n){var i=this.matrix;if(i){for(var r=t.length,a=(7&r>>>2)<<2,l=new Ye(32),o=new ke(4),s=new Ye(4),u=0;u<a;u+=4)o[0]=t[u],o[1]=t[u+1],o[2]=t[u+2],o[3]=t[u+3],s[0]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],s[1]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],s[2]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],s[3]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],s[0]=s[0]<0?0:255<s[0]?255:s[0],s[1]=s[1]<0?0:255<s[1]?255:s[1],s[2]=s[2]<0?0:255<s[2]?255:s[2],s[3]=s[3]<0?0:255<s[3]?255:s[3],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<r;u+=32)o[0]=t[u],o[1]=t[u+1],o[2]=t[u+2],o[3]=t[u+3],l[0]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[1]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[2]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[3]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+4],o[1]=t[u+5],o[2]=t[u+6],o[3]=t[u+7],l[4]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[5]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[6]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[7]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+8],o[1]=t[u+9],o[2]=t[u+10],o[3]=t[u+11],l[8]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[9]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[10]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[11]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+12],o[1]=t[u+13],o[2]=t[u+14],o[3]=t[u+15],l[12]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[13]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[14]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[15]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+16],o[1]=t[u+17],o[2]=t[u+18],o[3]=t[u+19],l[16]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[17]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[18]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[19]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+20],o[1]=t[u+21],o[2]=t[u+22],o[3]=t[u+23],l[20]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[21]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[22]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[23]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+24],o[1]=t[u+25],o[2]=t[u+26],o[3]=t[u+27],l[24]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[25]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[26]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[27]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+28],o[1]=t[u+29],o[2]=t[u+30],o[3]=t[u+31],l[28]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[29]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[30]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[31]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],l[0]=l[0]<0?0:255<l[0]?255:l[0],l[1]=l[1]<0?0:255<l[1]?255:l[1],l[2]=l[2]<0?0:255<l[2]?255:l[2],l[3]=l[3]<0?0:255<l[3]?255:l[3],l[4]=l[4]<0?0:255<l[4]?255:l[4],l[5]=l[5]<0?0:255<l[5]?255:l[5],l[6]=l[6]<0?0:255<l[6]?255:l[6],l[7]=l[7]<0?0:255<l[7]?255:l[7],l[8]=l[8]<0?0:255<l[8]?255:l[8],l[9]=l[9]<0?0:255<l[9]?255:l[9],l[10]=l[10]<0?0:255<l[10]?255:l[10],l[11]=l[11]<0?0:255<l[11]?255:l[11],l[12]=l[12]<0?0:255<l[12]?255:l[12],l[13]=l[13]<0?0:255<l[13]?255:l[13],l[14]=l[14]<0?0:255<l[14]?255:l[14],l[15]=l[15]<0?0:255<l[15]?255:l[15],l[16]=l[16]<0?0:255<l[16]?255:l[16],l[17]=l[17]<0?0:255<l[17]?255:l[17],l[18]=l[18]<0?0:255<l[18]?255:l[18],l[19]=l[19]<0?0:255<l[19]?255:l[19],l[20]=l[20]<0?0:255<l[20]?255:l[20],l[21]=l[21]<0?0:255<l[21]?255:l[21],l[22]=l[22]<0?0:255<l[22]?255:l[22],l[23]=l[23]<0?0:255<l[23]?255:l[23],l[24]=l[24]<0?0:255<l[24]?255:l[24],l[25]=l[25]<0?0:255<l[25]?255:l[25],l[26]=l[26]<0?0:255<l[26]?255:l[26],l[27]=l[27]<0?0:255<l[27]?255:l[27],l[28]=l[28]<0?0:255<l[28]?255:l[28],l[29]=l[29]<0?0:255<l[29]?255:l[29],l[30]=l[30]<0?0:255<l[30]?255:l[30],l[31]=l[31]<0?0:255<l[31]?255:l[31],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3],t[u+4]=0|l[4],t[u+5]=0|l[5],t[u+6]=0|l[6],t[u+7]=0|l[7],t[u+8]=0|l[8],t[u+9]=0|l[9],t[u+10]=0|l[10],t[u+11]=0|l[11],t[u+12]=0|l[12],t[u+13]=0|l[13],t[u+14]=0|l[14],t[u+15]=0|l[15],t[u+16]=0|l[16],t[u+17]=0|l[17],t[u+18]=0|l[18],t[u+19]=0|l[19],t[u+20]=0|l[20],t[u+21]=0|l[21],t[u+22]=0|l[22],t[u+23]=0|l[23],t[u+24]=0|l[24],t[u+25]=0|l[25],t[u+26]=0|l[26],t[u+27]=0|l[27],t[u+28]=0|l[28],t[u+29]=0|l[29],t[u+30]=0|l[30],t[u+31]=0|l[31]}return t}:function(t,e,n){var i=this.matrix;if(i){for(var r=t.length,a=(7&r>>>2)<<2,l=new Ye(32),o=new ke(4),s=new Ye(4),u=0;u<a;u+=4)o[0]=t[u],o[1]=t[u+1],o[2]=t[u+2],o[3]=t[u+3],s[0]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],s[1]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],s[2]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],s[3]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<r;u+=32)o[0]=t[u],o[1]=t[u+1],o[2]=t[u+2],o[3]=t[u+3],l[0]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[1]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[2]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[3]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+4],o[1]=t[u+5],o[2]=t[u+6],o[3]=t[u+7],l[4]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[5]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[6]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[7]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+8],o[1]=t[u+9],o[2]=t[u+10],o[3]=t[u+11],l[8]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[9]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[10]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[11]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+12],o[1]=t[u+13],o[2]=t[u+14],o[3]=t[u+15],l[12]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[13]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[14]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[15]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+16],o[1]=t[u+17],o[2]=t[u+18],o[3]=t[u+19],l[16]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[17]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[18]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[19]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+20],o[1]=t[u+21],o[2]=t[u+22],o[3]=t[u+23],l[20]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[21]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[22]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[23]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+24],o[1]=t[u+25],o[2]=t[u+26],o[3]=t[u+27],l[24]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[25]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[26]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[27]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],o[0]=t[u+28],o[1]=t[u+29],o[2]=t[u+30],o[3]=t[u+31],l[28]=i[0]*o[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]+i[4],l[29]=i[5]*o[0]+i[6]*o[1]+i[7]*o[2]+i[8]*o[3]+i[9],l[30]=i[10]*o[0]+i[11]*o[1]+i[12]*o[2]+i[13]*o[3]+i[14],l[31]=i[15]*o[0]+i[16]*o[1]+i[17]*o[2]+i[18]*o[3]+i[19],t[u]=0|l[0],t[u+1]=0|l[1],t[u+2]=0|l[2],t[u+3]=0|l[3],t[u+4]=0|l[4],t[u+5]=0|l[5],t[u+6]=0|l[6],t[u+7]=0|l[7],t[u+8]=0|l[8],t[u+9]=0|l[9],t[u+10]=0|l[10],t[u+11]=0|l[11],t[u+12]=0|l[12],t[u+13]=0|l[13],t[u+14]=0|l[14],t[u+15]=0|l[15],t[u+16]=0|l[16],t[u+17]=0|l[17],t[u+18]=0|l[18],t[u+19]=0|l[19],t[u+20]=0|l[20],t[u+21]=0|l[21],t[u+22]=0|l[22],t[u+23]=0|l[23],t[u+24]=0|l[24],t[u+25]=0|l[25],t[u+26]=0|l[26],t[u+27]=0|l[27],t[u+28]=0|l[28],t[u+29]=0|l[29],t[u+30]=0|l[30],t[u+31]=0|l[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=t.prototype.desaturate,t.prototype.rotateHue=t.prototype.adjustHue,t.prototype.threshold_rgb=t.prototype.thresholdRGB,t.prototype.threshold_alpha=t.prototype.thresholdAlpha,Ze=w,Qe=Ze.MODE,tn=Ze.Util.GLSL,en=Ze.Color,Ze.ColorMatrix,nn=Ze.Util.Array.typed,rn=Ze._notSupportClamp,an=Ze.Util.String.function_body,ln=Object.prototype.hasOwnProperty,(e=Ze.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:Ze.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:Qe.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=nn(t.thresholds,Array),e.quantizedColors=nn(t.quantizedColors,Array),!t._map&&t._mapName&&ln.call(Je,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&ln.call(Je,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Je[n._mapName],n._mapInit=Je["init__"+n._mapName],n._apply=ul(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=ul(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){return this._mapName=null,this._map=null,this._mapInit=null,this._mapChanged=!1,this._glsl=null,this},getGLSL:function(){var n,t,i,e,r=this;return(r._map?"quantize"===r._mapName?(n=tn.formatFloat,t=r.thresholds||[],i=r.quantizedColors||[],e=new tn.Filter(r).begin().shader(["varying vec2 pix;","uniform sampler2D img;","#define HUE "+Qe.HUE,"#define SATURATION "+Qe.SATURATION,"#define INTENSITY "+Qe.INTENSITY,"#define COLOR "+Qe.COLOR,"uniform int mode;",en.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","void main(void) {","vec4 i = texture2D(img, pix);","vec4 o = vec4(i.r, i.g, i.b, i.a);","float v;","int found = 0;","if (0.0 != i.a) {","if (mode == HUE) v = rgb2hue(i.r, i.g, i.b)/360.0;","else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","else v = col24(i.r, i.g, i.b);",t.map(function(t,e){return"if (0 == found && v <= "+(t=(t=t)||0,Qe.COLOR===r.mode?n(100*(t>>16&255)/255+10*(t>>8&255)/255+(255&t)/255):n(t/255))+") {found = 1; o.rgb = "+(e<i.length?en.rgb24GL(i[e]):"vec3(1.0,1.0,1.0)")+";}"}).join("\n"),"gl_FragColor = o;","} else {","gl_FragColor = i;","}","}"].join("\n")).end()):(e=new tn.Filter(r).begin().shader(["varying vec2 pix;","uniform sampler2D img;","#define HUE "+Qe.HUE,"#define SATURATION "+Qe.SATURATION,"#define INTENSITY "+Qe.INTENSITY,"#define COLOR "+Qe.COLOR,"uniform vec4 color;","uniform float minval;","uniform float maxval;","uniform int mapping;","uniform int mode;",en.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","vec4 mask(vec4 i, float minval, float maxval, vec4 color) {","    float v = 0.0;","    if (0.0 != i.a) {","        if (mode == HUE) v = rgb2hue(i.r, i.g, i.b);","        else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","        else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","        else v = col24(i.r, i.g, i.b);","        if (v < minval || v > maxval) return color;","        else return i;","    } else {","        return i;","    }","}",ln.call(Je,r._mapName)||!r._map.shader?"vec3 map(vec3 rgb) {return rgb;}":r._map.shader.toString(),"void main(void) {","vec4 c = texture2D(img, pix);","vec4 o = vec4(c.r, c.g, c.b, c.a);","float v;","if (1 == mapping)      {o.xyz = rgb2hsv(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (2 == mapping) {o.rgb = hsv2rgb(c.r, c.g, c.b).rgb;}","else if (3 == mapping) {o.xyz = rgb2hsl(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (4 == mapping) {o.rgb = hsl2rgb(c.r, c.g, c.b).rgb;}","else if (5 == mapping) {o.xyz = rgb2hwb(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (6 == mapping) {o.rgb = hwb2rgb(c.r, c.g, c.b).rgb;}","else if (7 == mapping) {o.xyz = rgb2cmyk(c.r, c.g, c.b).xyz;}","else if (8 == mapping) {v=rgb2hue(c.r, c.g, c.b)/360.0; o=vec4(v,v,v,c.a);}","else if (9 == mapping) {v=rgb2sat(c.r, c.g, c.b, FORMAT_HSV); o=vec4(v,v,v,c.a);}","else if (10 == mapping){o = mask(c, minval, maxval, color);}","else                   {o.rgb = map(c.rgb);}","gl_FragColor = o;","}"].join("\n")).input("mapping",function(t){return"rgb2hsv"===t._mapName?1:"hsv2rgb"===t._mapName?2:"rgb2hsl"===t._mapName?3:"hsl2rgb"===t._mapName?4:"rgb2hwb"===t._mapName?5:"hwb2rgb"===t._mapName?6:"rgb2cmyk"===t._mapName?7:"hue"===t._mapName?8:"saturation"===t._mapName?9:"mask"===t._mapName?10:0}).input("color",function(t){t=(t.quantizedColors||[0])[0]||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("minval",function(t){var e=t.thresholds||[0,0],n=e[0]||0;e[1];return Qe.COLOR===t.mode?100*(n>>16&255)/255+10*(n>>8&255)/255+(255&n)/255:n}).input("maxval",function(t){var e=t.thresholds||[0,0],e=(e[0],e[1]||0);return Qe.COLOR===t.mode?100*(e>>16&255)/255+10*(e>>8&255)/255+(255&e)/255:e}),r._map.shader&&r._map.inputs&&r._map.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e.end()):new tn.Filter(r).begin().shader(tn.DEFAULT).end()).code()},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=e.prototype.quantize,e.prototype.extract=e.prototype.mask,Je={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},on=w.ImArray,sn=w.AffineMatrix,un=w.Util.Array.typed,cn=w.Util.GLSL,fn=w.MODE,w.CONST.toRad,n=Math,hn=n.sin,mn=n.cos,pn=n.tan,dn=w.Util.Filter.am_multiply,(n=w.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new sn(t):null},path:w.Path,matrix:null,mode:fn.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=un(t.matrix,sn),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=hn(t),t=mn(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?pn(t):0,0,0,e?pn(e):0,1,0,0])},set:function(t){return this.matrix=this.matrix?dn(this.matrix,t):new sn(t),this._glsl=null,this},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){var t=this,e=t.matrix;return(t=new cn.Filter(t)).begin().shader(e?["varying vec2 pix;","uniform sampler2D img;","uniform float am[6];","uniform vec4 color;","#define IGNORE "+fn.IGNORE,"#define CLAMP "+fn.CLAMP,"#define COLOR "+fn.COLOR,"#define WRAP "+fn.WRAP,"uniform int mode;","void main(void) {","   vec2 p = vec2(am[0]*pix.x+am[1]*pix.y+am[2], am[3]*pix.x+am[4]*pix.y+am[5]);","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (COLOR == mode) {gl_FragColor = color;}","       else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","       else if (WRAP == mode) {","           if (0.0 > p.x) p.x += 1.0;","           if (1.0 < p.x) p.x -= 1.0;","           if (0.0 > p.y) p.y += 1.0;","           if (1.0 < p.y) p.y -= 1.0;","           gl_FragColor = texture2D(img, p);","       }","       else {gl_FragColor = texture2D(img, pix);}","   } else {","       gl_FragColor = texture2D(img, p);","   }","}"].join("\n"):cn.DEFAULT),e&&t.input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("am",function(t,e,n){t=t.matrix;return[t[0],t[1],t[2]/e+t[3],t[4],t[5],t[6]/n+t[7]]}),t.end().code()},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var i=this.matrix;if(!i)return t;var r,a,l,o,s,u,c,f,h,m,p,d=t.length,g=d>>>2,x=e-1,_=g-e,y=new on(d),v=this.color||0,b=fn.COLOR,w=(fn.CLAMP,fn.WRAP),C=fn.IGNORE,A=i[0],S=i[1],D=i[2]+i[3]*x,I=i[4]*e,R=i[5],L=i[6]*e+i[7]*_,i=this.mode||C;if(b===i)for(p=v>>>24&255,f=v>>>16&255,h=v>>>8&255,m=255&v,u=l=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,l+=e),s=I*r+R*l+L,(o=A*r+S*a+D)<0||x<o||s<0||_<s?(y[u]=f,y[u+1]=h,y[u+2]=m,y[u+3]=p):(y[u]=t[c=(0|o)+(0|s)<<2],y[u+1]=t[c+1],y[u+2]=t[c+2],y[u+3]=t[c+3]);else if(C===i)for(u=l=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,l+=e),y[u]=t[c=(0|(o=x<(o=A*r+S*a+D)||o<0?r:o))+(0|(s=_<(s=I*r+R*l+L)||s<0?l:s))<<2],y[u+1]=t[c+1],y[u+2]=t[c+2],y[u+3]=t[c+3];else if(w===i)for(u=l=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,l+=e),y[u]=t[c=(0|(o=x<(o=A*r+S*a+D)?o-e:o<0?o+e:o))+(0|(s=_<(s=I*r+R*l+L)?s-g:s<0?s+g:s))<<2],y[u+1]=t[c+1],y[u+2]=t[c+2],y[u+3]=t[c+3];else for(u=l=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,l+=e),y[u]=t[c=(0|(o=x<(o=A*r+S*a+D)?x:o<0?0:o))+(0|(s=_<(s=I*r+R*l+L)?_:s<0?0:s))<<2],y[u+1]=t[c+1],y[u+2]=t[c+2],y[u+3]=t[c+3];return y},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=n.prototype.translate,xn=(gn=w).MODE,_n=gn.CHANNEL,yn=gn.Util.GLSL,i=Math,vn=i.min,i.max,q=i.floor,gn.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:gn.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:xn.CLAMP,hasInputs:!0,dispose:function(){return this.scaleX=null,this.scaleY=null,this.startX=null,this.startY=null,this.componentX=null,this.componentY=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,startX:this.startX,startY:this.startY,componentX:this.componentX,componentY:this.componentY,color:this.color}},unserialize:function(t){return this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.startX=t.startX,this.startY=t.startY,this.componentX=t.componentX,this.componentY=t.componentY,this.color=t.color,this},reset:function(){return this.unsetInput("map"),this},getGLSL:function(){return t=this,new yn.Filter(t).begin().shader(t.input("map")?["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform vec2 mapSize;","uniform vec2 start;","uniform vec2 scale;","uniform vec4 color;","uniform ivec2 component;","#define IGNORE "+xn.IGNORE,"#define CLAMP "+xn.CLAMP,"#define COLOR "+xn.COLOR,"#define WRAP "+xn.WRAP,"#define RED "+_n.R,"#define GREEN "+_n.G,"#define BLUE "+_n.B,"#define ALPHA "+_n.A,"uniform int mode;","void main(void) {","   if (pix.x < start.x || pix.x > min(1.0,start.x+mapSize.x) || pix.y < start.y || pix.y > min(1.0,start.y+mapSize.y)) {","      gl_FragColor = texture2D(img, pix);","   } else {","       vec4 mc = texture2D(map, (pix-start)/mapSize);","       vec2 p = vec2(pix.x, pix.y);","       if (ALPHA == component.x) p.x += (mc.a - 0.5)*scale.x;","       else if (BLUE == component.x) p.x += (mc.b - 0.5)*scale.x;","       else if (GREEN == component.x) p.x += (mc.g - 0.5)*scale.x;","       else p.x += (mc.r - 0.5)*scale.x;","       if (ALPHA == component.y) p.y += (mc.a - 0.5)*scale.y;","       else if (BLUE == component.y) p.y += (mc.b - 0.5)*scale.y;","       else if (GREEN == component.y) p.y += (mc.g - 0.5)*scale.y;","       else p.y += (mc.r - 0.5)*scale.y;","       if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","           if (COLOR == mode) {gl_FragColor = color;}","           else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","           else if (WRAP == mode) {","               if (0.0 > p.x) p.x += 1.0;","               if (1.0 < p.x) p.x -= 1.0;","               if (0.0 > p.y) p.y += 1.0;","               if (1.0 < p.y) p.y -= 1.0;","               gl_FragColor = texture2D(img, p);","           }","           else {gl_FragColor = texture2D(img, pix);}","       } else {","           gl_FragColor = texture2D(img, p);","       }","   }","}"].join("\n"):yn.DEFAULT).input("map",function(t){t=t.input("map");return{data:t[0],width:t[1],height:t[2]}}).input("mapSize",function(t,e,n){t=t.input("map");return[t[1]/e,t[2]/n]}).input("scale",function(t){return[1.4*t.scaleX/255,1.4*t.scaleY/255]}).input("start",function(t){return[t.startX,t.startY]}).input("component",function(t){return[t.componentX,t.componentY]}).input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).end().code();var t},_apply:function(t,e,n){var i=this.input("map");if(i){for(var N,H,U,z,r,a,l,o,s,u,c,f,h,m=this.color||0,p=e-1,d=n-1,g=.00390625*this.scaleX,x=.00390625*this.scaleY,_=this.componentX,y=this.componentY,B=xn.IGNORE,Y=(xn.CLAMP,xn.COLOR),k=xn.WRAP,v=this.mode||B,P=(gn.ImArray,gn.Util.Array.copy),j=gn.Array16I,b=i[0],w=i[1],i=i[2],X=b.length,W=X>>>2,C=vn(w,e),A=C*vn(i,n)<<2,S=(t.length,q(this.startX*p)),D=q(this.startY*d),I=D*e,R=-S,L=-D,E=p-S,M=d-D,T=new j(W<<1),O=P(t),$=(15&W)<<2,G=0,F=0;F<$;F+=4)T[G++]=q((b[F+_]-128)*g),T[G++]=q((b[F+y]-128)*x);for(F=$;F<X;F+=64)T[G++]=q((b[F+_]-128)*g),T[G++]=q((b[F+y]-128)*x),T[G++]=q((b[F+4+_]-128)*g),T[G++]=q((b[F+4+y]-128)*x),T[G++]=q((b[F+8+_]-128)*g),T[G++]=q((b[F+8+y]-128)*x),T[G++]=q((b[F+12+_]-128)*g),T[G++]=q((b[F+12+y]-128)*x),T[G++]=q((b[F+16+_]-128)*g),T[G++]=q((b[F+16+y]-128)*x),T[G++]=q((b[F+20+_]-128)*g),T[G++]=q((b[F+20+y]-128)*x),T[G++]=q((b[F+24+_]-128)*g),T[G++]=q((b[F+24+y]-128)*x),T[G++]=q((b[F+28+_]-128)*g),T[G++]=q((b[F+28+y]-128)*x),T[G++]=q((b[F+32+_]-128)*g),T[G++]=q((b[F+32+y]-128)*x),T[G++]=q((b[F+36+_]-128)*g),T[G++]=q((b[F+36+y]-128)*x),T[G++]=q((b[F+40+_]-128)*g),T[G++]=q((b[F+40+y]-128)*x),T[G++]=q((b[F+44+_]-128)*g),T[G++]=q((b[F+44+y]-128)*x),T[G++]=q((b[F+48+_]-128)*g),T[G++]=q((b[F+48+y]-128)*x),T[G++]=q((b[F+52+_]-128)*g),T[G++]=q((b[F+52+y]-128)*x),T[G++]=q((b[F+56+_]-128)*g),T[G++]=q((b[F+56+y]-128)*x),T[G++]=q((b[F+60+_]-128)*g),T[G++]=q((b[F+60+y]-128)*x);if(Y===v)for(N=m>>>24&255,H=m>>>16&255,U=m>>>8&255,z=255&m,F=o=l=a=r=0;F<A;F+=4,++r)C<=r&&(r=0,++a,l+=e,o+=w),a<L||M<a||r<R||E<r||(u=(s=r+S)+l+I<<2,f=s+T[G=r+o<<1],d<(h=a+D+T[G+1])||h<0||p<f||f<0?(t[u]=H,t[u+1]=U,t[u+2]=z,t[u+3]=N):(t[u]=O[c=f+h*e<<2],t[u+1]=O[c+1],t[u+2]=O[c+2],t[u+3]=O[c+3]));else if(B===v)for(F=o=l=a=r=0;F<A;F+=4,++r)C<=r&&(r=0,++a,l+=e,o+=w),a<L||M<a||r<R||E<r||(u=(s=r+S)+l+I<<2,f=s+T[G=r+o<<1],d<(h=a+D+T[G+1]))||h<0||p<f||f<0||(t[u]=O[c=f+h*e<<2],t[u+1]=O[c+1],t[u+2]=O[c+2],t[u+3]=O[c+3]);else if(k===v)for(F=o=l=a=r=0;F<A;F+=4,++r)C<=r&&(r=0,++a,l+=e,o+=w),a<L||M<a||r<R||E<r||(f=(s=r+S)+T[G=r+o<<1],h=a+D+T[G+1],t[u=s+l+I<<2]=O[c=(f=p<f?f-e:f<0?f+e:f)+(h=d<h?h-n:h<0?h+n:h)*e<<2],t[u+1]=O[c+1],t[u+2]=O[c+2],t[u+3]=O[c+3]);else for(F=o=l=a=r=0;F<A;F+=4,++r)C<=r&&(r=0,++a,l+=e,o+=w),a<L||M<a||r<R||E<r||(f=(s=r+S)+T[G=r+o<<1],h=a+D+T[G+1],t[u=s+l+I<<2]=O[c=(f=p<f?p:f<0?0:f)+(h=d<h?d:h<0?0:h)*e<<2],t[u+1]=O[c+1],t[u+2]=O[c+2],t[u+3]=O[c+3])}return t}});var cl,fl,hl=w,ml=hl.MODE,pl=hl.Util.String.function_body,A=Math,dl=(A.floor,A.round,A.sqrt),gl=(A.atan2,A.sin,A.cos,A.max),xl=(A.min,2*A.PI),_l=(hl.Util.Math.clamp,hl.POS.X,hl.POS.Y),yl=Object.prototype.hasOwnProperty,vl=hl.Util.GLSL;function bl(t,e){e=e?pl(e):"",t=pl(t.filter||t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(hl)}function wl(t,e,n){for(var i=[],r=[],a=[],l=t.length,o=e>>>1,s=-o,u=-((n=null==n?e:n)>>>1),c=0;c<l;)r.push(s),r.push(u),t[c]&&(i.push(s),i.push(u),a.push(t[c])),++c,o<++s&&(s=-o,++u);return[new An(i),new An(r),new wn(a)]}function Cl(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function Al(t,e){var n,i=t>>>1,r=new Array(t);if(e)for(n=0;n<t;++n)r[t-1-n]=n-i;else for(n=0;n<t;++n)r[n]=n-i;return r}function Sl(t){var e,n,i,r,a=Bn.length;if(--t<a)e=Bn[t];else for(e=Bn[a-1];a<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,i=0,r=n.length-1;i<r;++i)e[i+1]=n[i]+n[i+1];e[n.length]=1,a<20&&Bn.push(e),++a}return e.slice()}function Dl(t,e,n){for(var i=t>>>1,r=e>>>1,a=new Array(t*e),l=-i,o=-r,s=0;s<d;++s,++l)i<l&&(l=-i,++o),a[s]=n(l,o,t,e);return a}function Il(t,e){return 1===e?Dn(Al(t,1),Sl(t)):Dn(Sl(t),Al(t,0))}function Rl(t,e){return 1===e?Dn(Al(t,1),Cl(t)):Dn(Cl(t),Al(t,0))}function Ll(t,e,n){e=e||1,n=n||e;for(var i=t*t,r=new wn(i),a=0;a<i;++a)r[a]=e;return r[i>>>1]=n,r}function El(t){for(var e=t*t,n=new $n(e),i=0;i<e;++i)n[i]=1;return n}function Ml(t,e,n,i,r,a,l,o,s,u,c){var f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D=e.length,I=i-1,R=(D>>>a)-i,L=e;if(e=n,n=L,Yn.MODE.GRAY===t){for(S=l.length,f=0;f<c;++f)for(L=e,e=n,n=L,p=m=h=0;p<D;p+=4,++h){for(i<=h&&(h=0,m+=i),g=u,d=0;d<S;d+=2)w=h+l[d],C=m+l[d+1],w<0||I<w||C<0||R<C||(g=s(y=e[A=w+C<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}if(o)for(S=(l=o).length,f=0;f<c;++f)for(L=e,e=n,n=L,p=m=h=0;p<D;p+=4,++h){for(i<=h&&(h=0,m+=i),g=u,d=0;d<S;d+=2)w=h+l[d],C=m+l[d+1],w<0||I<w||C<0||R<C||(g=s(y=e[A=w+C<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}}else{for(S=l.length,f=0;f<c;++f)for(L=e,e=n,n=L,p=m=h=0;p<D;p+=4,++h){for(i<=h&&(h=0,m+=i),g=x=_=u,d=0;d<S;d+=2)w=h+l[d],C=m+l[d+1],w<0||I<w||C<0||R<C||(y=e[A=w+C<<2],v=e[A+1],b=e[A+2],g=s(y,g),x=s(v,x),_=s(b,_));n[p]=g,n[p+1]=x,n[p+2]=_,n[p+3]=e[p+3]}if(o)for(S=(l=o).length,f=0;f<c;++f)for(L=e,e=n,n=L,p=m=h=0;p<D;p+=4,++h){for(i<=h&&(h=0,m+=i),g=x=_=u,d=0;d<S;d+=2)w=h+l[d],C=m+l[d+1],w<0||I<w||C<0||R<C||(y=e[A=w+C<<2],v=e[A+1],b=e[A+2],g=s(y,g),x=s(v,x),_=s(b,_));n[p]=g,n[p+1]=x,n[p+2]=_,n[p+3]=e[p+3]}}return n}function Tl(t,e,n){t[e]=n,Gl(t,0,e)}function Ol(t,e){var n,i=t[e-1];if(e-1){n=t[0],t[0]=i;var r,a,l=t,o=0,s=t=e-1,t=o,e=l[o];for(r=2*o+1;r<s;)(a=r+1)<s&&l[r]>=l[a]&&(r=a),l[o]=l[r],r=2*(o=r)+1;return l[o]=e,Gl(l,t,o),n}return i}function Gl(t,e,n){for(var i,r,a=t[n];e<n&&a<(r=t[i=n-1>>>1]);)t[n]=r,n=i;t[n]=a}function Fl(t,e,n,i){for(var r=[0,0],a=0;a<n;++a)for(var l=0,o=0;l<i;++l,o+=n){var s=a+o,u=e(t.r[s],t.i[s],a,l,n,i,t)||r;t.r[s]=u[0]||0,t.i[s]=u[1]||0}return t}function Nl(t,e,n){var t=7&t,i=t<4?e:n,n=t<4?n:e;return(1&t?-i:i)+(2&t?-2*n:2*n)}function Hl(t,e){var n=.211324865,i=.366025403*(t+e),r=e+i,i=yi(t+i),r=yi(r),a=(i+r)*n,t=t-(i-a),e=e-(r-a),a=e<t?(c=1,0):(c=0,1),l=t-c+n,o=e-a+n,s=t-1+2*n,n=e-1+2*n,i=255&i,r=255&r,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*Nl(bi[i+bi[r]],t,e),t=.5-l*l-o*o,e=t<0?0:(t*=t)*t*Nl(bi[i+c+bi[r+a]],l,o),t=.5-s*s-n*n,c=t<0?0:(t*=t)*t*Nl(bi[1+i+bi[1+r]],s,n);return 40*(u+e+c)}function Ul(t){return t*t*t*(t*(6*t-15)+10)}function zl(t,e,n){return e+t*(n-e)}function Bl(t,e){var n=yi(t),i=yi(e),t=t-n,e=e-i,r=t-1,a=e-1,l=n+1&255,o=i+1&255,s=Ul(e),u=Ul(t),n=zl(s,Nl(bi[(n&=255)+bi[i&=255]],t,e),Nl(bi[n+bi[o]],t,a)),t=zl(s,Nl(bi[l+bi[i]],r,e),Nl(bi[l+bi[o]],r,a));return.507*zl(u,n,t)}function Yl(t,e,n,i,r,a,l,o,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,x=0;x<u;++x)m+=n(p*((i+c[x][0])%a)*o,p*((r+c[x][1])%l)*s)*d,p*=2,g+=d,d*=h;t[e]=f=~~(255*(.5*m/g+.5)),t[e+1]=f,t[e+2]=f,t[e+3]=255}function kl(t,e,n,i,r,a,l,o,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,x=0;x<u;++x)m+=n(p*((i+c[x][0])%a)*o,p*((r+c[x][1])%l)*s)*d,p*=2,g+=d,d*=h;t[e]=(f=~~(16777215*(.5*m/g+.5)))>>>16&255,t[e+1]=f>>>8&255,t[e+2]=255&f,t[e+3]=255}function Pl(t,e,n,i,r,a,l,o,s,u,c,f){var h,m,p,d,g,x,_=1/a,y=1/l,v=f?Bl:Hl,b=r?Yl:kl,w=t.length,C=e>>>1,A=n>>>1;if(u=u||1,c=c||.5,o=o||1,s=s||[[0,0]],i)for(g=m=h=0;g<w;g+=4,++h)e<=h&&(h=0,++m),d=A<m?n-1-m:m,(p=C<h?e-1-h:h)<h||d<m?(t[g]=t[x=d*e+p<<2],t[g+1]=t[1+x],t[g+2]=t[2+x],t[g+3]=255):b(t,g,v,p,d,e,n,_,y,o,s,u,c);else for(g=m=h=0;g<w;g+=4,++h)e<=h&&(h=0,++m),b(t,g,v,h,m,e,n,_,y,o,s,u,c);return t}function jl(t,e,n,i,r,a){i|=0,r|=0,a|=0;var l=new or(256);return l[0]=(_(+n)<=a?i:r)<<2|(_(+e)<=a?i:r)<<1|(_(+t)<=a?i:r)<<0,l[1]=(_(n-1)<=a?i:r)<<2|(_(e-1)<=a?i:r)<<1|(_(t-1)<=a?i:r)<<0,l[2]=(_(n-2)<=a?i:r)<<2|(_(e-2)<=a?i:r)<<1|(_(t-2)<=a?i:r)<<0,l[3]=(_(n-3)<=a?i:r)<<2|(_(e-3)<=a?i:r)<<1|(_(t-3)<=a?i:r)<<0,l[4]=(_(n-4)<=a?i:r)<<2|(_(e-4)<=a?i:r)<<1|(_(t-4)<=a?i:r)<<0,l[5]=(_(n-5)<=a?i:r)<<2|(_(e-5)<=a?i:r)<<1|(_(t-5)<=a?i:r)<<0,l[6]=(_(n-6)<=a?i:r)<<2|(_(e-6)<=a?i:r)<<1|(_(t-6)<=a?i:r)<<0,l[7]=(_(n-7)<=a?i:r)<<2|(_(e-7)<=a?i:r)<<1|(_(t-7)<=a?i:r)<<0,l[8]=(_(n-8)<=a?i:r)<<2|(_(e-8)<=a?i:r)<<1|(_(t-8)<=a?i:r)<<0,l[9]=(_(n-9)<=a?i:r)<<2|(_(e-9)<=a?i:r)<<1|(_(t-9)<=a?i:r)<<0,l[10]=(_(n-10)<=a?i:r)<<2|(_(e-10)<=a?i:r)<<1|(_(t-10)<=a?i:r)<<0,l[11]=(_(n-11)<=a?i:r)<<2|(_(e-11)<=a?i:r)<<1|(_(t-11)<=a?i:r)<<0,l[12]=(_(n-12)<=a?i:r)<<2|(_(e-12)<=a?i:r)<<1|(_(t-12)<=a?i:r)<<0,l[13]=(_(n-13)<=a?i:r)<<2|(_(e-13)<=a?i:r)<<1|(_(t-13)<=a?i:r)<<0,l[14]=(_(n-14)<=a?i:r)<<2|(_(e-14)<=a?i:r)<<1|(_(t-14)<=a?i:r)<<0,l[15]=(_(n-15)<=a?i:r)<<2|(_(e-15)<=a?i:r)<<1|(_(t-15)<=a?i:r)<<0,l[16]=(_(n-16)<=a?i:r)<<2|(_(e-16)<=a?i:r)<<1|(_(t-16)<=a?i:r)<<0,l[17]=(_(n-17)<=a?i:r)<<2|(_(e-17)<=a?i:r)<<1|(_(t-17)<=a?i:r)<<0,l[18]=(_(n-18)<=a?i:r)<<2|(_(e-18)<=a?i:r)<<1|(_(t-18)<=a?i:r)<<0,l[19]=(_(n-19)<=a?i:r)<<2|(_(e-19)<=a?i:r)<<1|(_(t-19)<=a?i:r)<<0,l[20]=(_(n-20)<=a?i:r)<<2|(_(e-20)<=a?i:r)<<1|(_(t-20)<=a?i:r)<<0,l[21]=(_(n-21)<=a?i:r)<<2|(_(e-21)<=a?i:r)<<1|(_(t-21)<=a?i:r)<<0,l[22]=(_(n-22)<=a?i:r)<<2|(_(e-22)<=a?i:r)<<1|(_(t-22)<=a?i:r)<<0,l[23]=(_(n-23)<=a?i:r)<<2|(_(e-23)<=a?i:r)<<1|(_(t-23)<=a?i:r)<<0,l[24]=(_(n-24)<=a?i:r)<<2|(_(e-24)<=a?i:r)<<1|(_(t-24)<=a?i:r)<<0,l[25]=(_(n-25)<=a?i:r)<<2|(_(e-25)<=a?i:r)<<1|(_(t-25)<=a?i:r)<<0,l[26]=(_(n-26)<=a?i:r)<<2|(_(e-26)<=a?i:r)<<1|(_(t-26)<=a?i:r)<<0,l[27]=(_(n-27)<=a?i:r)<<2|(_(e-27)<=a?i:r)<<1|(_(t-27)<=a?i:r)<<0,l[28]=(_(n-28)<=a?i:r)<<2|(_(e-28)<=a?i:r)<<1|(_(t-28)<=a?i:r)<<0,l[29]=(_(n-29)<=a?i:r)<<2|(_(e-29)<=a?i:r)<<1|(_(t-29)<=a?i:r)<<0,l[30]=(_(n-30)<=a?i:r)<<2|(_(e-30)<=a?i:r)<<1|(_(t-30)<=a?i:r)<<0,l[31]=(_(n-31)<=a?i:r)<<2|(_(e-31)<=a?i:r)<<1|(_(t-31)<=a?i:r)<<0,l[32]=(_(n-32)<=a?i:r)<<2|(_(e-32)<=a?i:r)<<1|(_(t-32)<=a?i:r)<<0,l[33]=(_(n-33)<=a?i:r)<<2|(_(e-33)<=a?i:r)<<1|(_(t-33)<=a?i:r)<<0,l[34]=(_(n-34)<=a?i:r)<<2|(_(e-34)<=a?i:r)<<1|(_(t-34)<=a?i:r)<<0,l[35]=(_(n-35)<=a?i:r)<<2|(_(e-35)<=a?i:r)<<1|(_(t-35)<=a?i:r)<<0,l[36]=(_(n-36)<=a?i:r)<<2|(_(e-36)<=a?i:r)<<1|(_(t-36)<=a?i:r)<<0,l[37]=(_(n-37)<=a?i:r)<<2|(_(e-37)<=a?i:r)<<1|(_(t-37)<=a?i:r)<<0,l[38]=(_(n-38)<=a?i:r)<<2|(_(e-38)<=a?i:r)<<1|(_(t-38)<=a?i:r)<<0,l[39]=(_(n-39)<=a?i:r)<<2|(_(e-39)<=a?i:r)<<1|(_(t-39)<=a?i:r)<<0,l[40]=(_(n-40)<=a?i:r)<<2|(_(e-40)<=a?i:r)<<1|(_(t-40)<=a?i:r)<<0,l[41]=(_(n-41)<=a?i:r)<<2|(_(e-41)<=a?i:r)<<1|(_(t-41)<=a?i:r)<<0,l[42]=(_(n-42)<=a?i:r)<<2|(_(e-42)<=a?i:r)<<1|(_(t-42)<=a?i:r)<<0,l[43]=(_(n-43)<=a?i:r)<<2|(_(e-43)<=a?i:r)<<1|(_(t-43)<=a?i:r)<<0,l[44]=(_(n-44)<=a?i:r)<<2|(_(e-44)<=a?i:r)<<1|(_(t-44)<=a?i:r)<<0,l[45]=(_(n-45)<=a?i:r)<<2|(_(e-45)<=a?i:r)<<1|(_(t-45)<=a?i:r)<<0,l[46]=(_(n-46)<=a?i:r)<<2|(_(e-46)<=a?i:r)<<1|(_(t-46)<=a?i:r)<<0,l[47]=(_(n-47)<=a?i:r)<<2|(_(e-47)<=a?i:r)<<1|(_(t-47)<=a?i:r)<<0,l[48]=(_(n-48)<=a?i:r)<<2|(_(e-48)<=a?i:r)<<1|(_(t-48)<=a?i:r)<<0,l[49]=(_(n-49)<=a?i:r)<<2|(_(e-49)<=a?i:r)<<1|(_(t-49)<=a?i:r)<<0,l[50]=(_(n-50)<=a?i:r)<<2|(_(e-50)<=a?i:r)<<1|(_(t-50)<=a?i:r)<<0,l[51]=(_(n-51)<=a?i:r)<<2|(_(e-51)<=a?i:r)<<1|(_(t-51)<=a?i:r)<<0,l[52]=(_(n-52)<=a?i:r)<<2|(_(e-52)<=a?i:r)<<1|(_(t-52)<=a?i:r)<<0,l[53]=(_(n-53)<=a?i:r)<<2|(_(e-53)<=a?i:r)<<1|(_(t-53)<=a?i:r)<<0,l[54]=(_(n-54)<=a?i:r)<<2|(_(e-54)<=a?i:r)<<1|(_(t-54)<=a?i:r)<<0,l[55]=(_(n-55)<=a?i:r)<<2|(_(e-55)<=a?i:r)<<1|(_(t-55)<=a?i:r)<<0,l[56]=(_(n-56)<=a?i:r)<<2|(_(e-56)<=a?i:r)<<1|(_(t-56)<=a?i:r)<<0,l[57]=(_(n-57)<=a?i:r)<<2|(_(e-57)<=a?i:r)<<1|(_(t-57)<=a?i:r)<<0,l[58]=(_(n-58)<=a?i:r)<<2|(_(e-58)<=a?i:r)<<1|(_(t-58)<=a?i:r)<<0,l[59]=(_(n-59)<=a?i:r)<<2|(_(e-59)<=a?i:r)<<1|(_(t-59)<=a?i:r)<<0,l[60]=(_(n-60)<=a?i:r)<<2|(_(e-60)<=a?i:r)<<1|(_(t-60)<=a?i:r)<<0,l[61]=(_(n-61)<=a?i:r)<<2|(_(e-61)<=a?i:r)<<1|(_(t-61)<=a?i:r)<<0,l[62]=(_(n-62)<=a?i:r)<<2|(_(e-62)<=a?i:r)<<1|(_(t-62)<=a?i:r)<<0,l[63]=(_(n-63)<=a?i:r)<<2|(_(e-63)<=a?i:r)<<1|(_(t-63)<=a?i:r)<<0,l[64]=(_(n-64)<=a?i:r)<<2|(_(e-64)<=a?i:r)<<1|(_(t-64)<=a?i:r)<<0,l[65]=(_(n-65)<=a?i:r)<<2|(_(e-65)<=a?i:r)<<1|(_(t-65)<=a?i:r)<<0,l[66]=(_(n-66)<=a?i:r)<<2|(_(e-66)<=a?i:r)<<1|(_(t-66)<=a?i:r)<<0,l[67]=(_(n-67)<=a?i:r)<<2|(_(e-67)<=a?i:r)<<1|(_(t-67)<=a?i:r)<<0,l[68]=(_(n-68)<=a?i:r)<<2|(_(e-68)<=a?i:r)<<1|(_(t-68)<=a?i:r)<<0,l[69]=(_(n-69)<=a?i:r)<<2|(_(e-69)<=a?i:r)<<1|(_(t-69)<=a?i:r)<<0,l[70]=(_(n-70)<=a?i:r)<<2|(_(e-70)<=a?i:r)<<1|(_(t-70)<=a?i:r)<<0,l[71]=(_(n-71)<=a?i:r)<<2|(_(e-71)<=a?i:r)<<1|(_(t-71)<=a?i:r)<<0,l[72]=(_(n-72)<=a?i:r)<<2|(_(e-72)<=a?i:r)<<1|(_(t-72)<=a?i:r)<<0,l[73]=(_(n-73)<=a?i:r)<<2|(_(e-73)<=a?i:r)<<1|(_(t-73)<=a?i:r)<<0,l[74]=(_(n-74)<=a?i:r)<<2|(_(e-74)<=a?i:r)<<1|(_(t-74)<=a?i:r)<<0,l[75]=(_(n-75)<=a?i:r)<<2|(_(e-75)<=a?i:r)<<1|(_(t-75)<=a?i:r)<<0,l[76]=(_(n-76)<=a?i:r)<<2|(_(e-76)<=a?i:r)<<1|(_(t-76)<=a?i:r)<<0,l[77]=(_(n-77)<=a?i:r)<<2|(_(e-77)<=a?i:r)<<1|(_(t-77)<=a?i:r)<<0,l[78]=(_(n-78)<=a?i:r)<<2|(_(e-78)<=a?i:r)<<1|(_(t-78)<=a?i:r)<<0,l[79]=(_(n-79)<=a?i:r)<<2|(_(e-79)<=a?i:r)<<1|(_(t-79)<=a?i:r)<<0,l[80]=(_(n-80)<=a?i:r)<<2|(_(e-80)<=a?i:r)<<1|(_(t-80)<=a?i:r)<<0,l[81]=(_(n-81)<=a?i:r)<<2|(_(e-81)<=a?i:r)<<1|(_(t-81)<=a?i:r)<<0,l[82]=(_(n-82)<=a?i:r)<<2|(_(e-82)<=a?i:r)<<1|(_(t-82)<=a?i:r)<<0,l[83]=(_(n-83)<=a?i:r)<<2|(_(e-83)<=a?i:r)<<1|(_(t-83)<=a?i:r)<<0,l[84]=(_(n-84)<=a?i:r)<<2|(_(e-84)<=a?i:r)<<1|(_(t-84)<=a?i:r)<<0,l[85]=(_(n-85)<=a?i:r)<<2|(_(e-85)<=a?i:r)<<1|(_(t-85)<=a?i:r)<<0,l[86]=(_(n-86)<=a?i:r)<<2|(_(e-86)<=a?i:r)<<1|(_(t-86)<=a?i:r)<<0,l[87]=(_(n-87)<=a?i:r)<<2|(_(e-87)<=a?i:r)<<1|(_(t-87)<=a?i:r)<<0,l[88]=(_(n-88)<=a?i:r)<<2|(_(e-88)<=a?i:r)<<1|(_(t-88)<=a?i:r)<<0,l[89]=(_(n-89)<=a?i:r)<<2|(_(e-89)<=a?i:r)<<1|(_(t-89)<=a?i:r)<<0,l[90]=(_(n-90)<=a?i:r)<<2|(_(e-90)<=a?i:r)<<1|(_(t-90)<=a?i:r)<<0,l[91]=(_(n-91)<=a?i:r)<<2|(_(e-91)<=a?i:r)<<1|(_(t-91)<=a?i:r)<<0,l[92]=(_(n-92)<=a?i:r)<<2|(_(e-92)<=a?i:r)<<1|(_(t-92)<=a?i:r)<<0,l[93]=(_(n-93)<=a?i:r)<<2|(_(e-93)<=a?i:r)<<1|(_(t-93)<=a?i:r)<<0,l[94]=(_(n-94)<=a?i:r)<<2|(_(e-94)<=a?i:r)<<1|(_(t-94)<=a?i:r)<<0,l[95]=(_(n-95)<=a?i:r)<<2|(_(e-95)<=a?i:r)<<1|(_(t-95)<=a?i:r)<<0,l[96]=(_(n-96)<=a?i:r)<<2|(_(e-96)<=a?i:r)<<1|(_(t-96)<=a?i:r)<<0,l[97]=(_(n-97)<=a?i:r)<<2|(_(e-97)<=a?i:r)<<1|(_(t-97)<=a?i:r)<<0,l[98]=(_(n-98)<=a?i:r)<<2|(_(e-98)<=a?i:r)<<1|(_(t-98)<=a?i:r)<<0,l[99]=(_(n-99)<=a?i:r)<<2|(_(e-99)<=a?i:r)<<1|(_(t-99)<=a?i:r)<<0,l[100]=(_(n-100)<=a?i:r)<<2|(_(e-100)<=a?i:r)<<1|(_(t-100)<=a?i:r)<<0,l[101]=(_(n-101)<=a?i:r)<<2|(_(e-101)<=a?i:r)<<1|(_(t-101)<=a?i:r)<<0,l[102]=(_(n-102)<=a?i:r)<<2|(_(e-102)<=a?i:r)<<1|(_(t-102)<=a?i:r)<<0,l[103]=(_(n-103)<=a?i:r)<<2|(_(e-103)<=a?i:r)<<1|(_(t-103)<=a?i:r)<<0,l[104]=(_(n-104)<=a?i:r)<<2|(_(e-104)<=a?i:r)<<1|(_(t-104)<=a?i:r)<<0,l[105]=(_(n-105)<=a?i:r)<<2|(_(e-105)<=a?i:r)<<1|(_(t-105)<=a?i:r)<<0,l[106]=(_(n-106)<=a?i:r)<<2|(_(e-106)<=a?i:r)<<1|(_(t-106)<=a?i:r)<<0,l[107]=(_(n-107)<=a?i:r)<<2|(_(e-107)<=a?i:r)<<1|(_(t-107)<=a?i:r)<<0,l[108]=(_(n-108)<=a?i:r)<<2|(_(e-108)<=a?i:r)<<1|(_(t-108)<=a?i:r)<<0,l[109]=(_(n-109)<=a?i:r)<<2|(_(e-109)<=a?i:r)<<1|(_(t-109)<=a?i:r)<<0,l[110]=(_(n-110)<=a?i:r)<<2|(_(e-110)<=a?i:r)<<1|(_(t-110)<=a?i:r)<<0,l[111]=(_(n-111)<=a?i:r)<<2|(_(e-111)<=a?i:r)<<1|(_(t-111)<=a?i:r)<<0,l[112]=(_(n-112)<=a?i:r)<<2|(_(e-112)<=a?i:r)<<1|(_(t-112)<=a?i:r)<<0,l[113]=(_(n-113)<=a?i:r)<<2|(_(e-113)<=a?i:r)<<1|(_(t-113)<=a?i:r)<<0,l[114]=(_(n-114)<=a?i:r)<<2|(_(e-114)<=a?i:r)<<1|(_(t-114)<=a?i:r)<<0,l[115]=(_(n-115)<=a?i:r)<<2|(_(e-115)<=a?i:r)<<1|(_(t-115)<=a?i:r)<<0,l[116]=(_(n-116)<=a?i:r)<<2|(_(e-116)<=a?i:r)<<1|(_(t-116)<=a?i:r)<<0,l[117]=(_(n-117)<=a?i:r)<<2|(_(e-117)<=a?i:r)<<1|(_(t-117)<=a?i:r)<<0,l[118]=(_(n-118)<=a?i:r)<<2|(_(e-118)<=a?i:r)<<1|(_(t-118)<=a?i:r)<<0,l[119]=(_(n-119)<=a?i:r)<<2|(_(e-119)<=a?i:r)<<1|(_(t-119)<=a?i:r)<<0,l[120]=(_(n-120)<=a?i:r)<<2|(_(e-120)<=a?i:r)<<1|(_(t-120)<=a?i:r)<<0,l[121]=(_(n-121)<=a?i:r)<<2|(_(e-121)<=a?i:r)<<1|(_(t-121)<=a?i:r)<<0,l[122]=(_(n-122)<=a?i:r)<<2|(_(e-122)<=a?i:r)<<1|(_(t-122)<=a?i:r)<<0,l[123]=(_(n-123)<=a?i:r)<<2|(_(e-123)<=a?i:r)<<1|(_(t-123)<=a?i:r)<<0,l[124]=(_(n-124)<=a?i:r)<<2|(_(e-124)<=a?i:r)<<1|(_(t-124)<=a?i:r)<<0,l[125]=(_(n-125)<=a?i:r)<<2|(_(e-125)<=a?i:r)<<1|(_(t-125)<=a?i:r)<<0,l[126]=(_(n-126)<=a?i:r)<<2|(_(e-126)<=a?i:r)<<1|(_(t-126)<=a?i:r)<<0,l[127]=(_(n-127)<=a?i:r)<<2|(_(e-127)<=a?i:r)<<1|(_(t-127)<=a?i:r)<<0,l[128]=(_(n-128)<=a?i:r)<<2|(_(e-128)<=a?i:r)<<1|(_(t-128)<=a?i:r)<<0,l[129]=(_(n-129)<=a?i:r)<<2|(_(e-129)<=a?i:r)<<1|(_(t-129)<=a?i:r)<<0,l[130]=(_(n-130)<=a?i:r)<<2|(_(e-130)<=a?i:r)<<1|(_(t-130)<=a?i:r)<<0,l[131]=(_(n-131)<=a?i:r)<<2|(_(e-131)<=a?i:r)<<1|(_(t-131)<=a?i:r)<<0,l[132]=(_(n-132)<=a?i:r)<<2|(_(e-132)<=a?i:r)<<1|(_(t-132)<=a?i:r)<<0,l[133]=(_(n-133)<=a?i:r)<<2|(_(e-133)<=a?i:r)<<1|(_(t-133)<=a?i:r)<<0,l[134]=(_(n-134)<=a?i:r)<<2|(_(e-134)<=a?i:r)<<1|(_(t-134)<=a?i:r)<<0,l[135]=(_(n-135)<=a?i:r)<<2|(_(e-135)<=a?i:r)<<1|(_(t-135)<=a?i:r)<<0,l[136]=(_(n-136)<=a?i:r)<<2|(_(e-136)<=a?i:r)<<1|(_(t-136)<=a?i:r)<<0,l[137]=(_(n-137)<=a?i:r)<<2|(_(e-137)<=a?i:r)<<1|(_(t-137)<=a?i:r)<<0,l[138]=(_(n-138)<=a?i:r)<<2|(_(e-138)<=a?i:r)<<1|(_(t-138)<=a?i:r)<<0,l[139]=(_(n-139)<=a?i:r)<<2|(_(e-139)<=a?i:r)<<1|(_(t-139)<=a?i:r)<<0,l[140]=(_(n-140)<=a?i:r)<<2|(_(e-140)<=a?i:r)<<1|(_(t-140)<=a?i:r)<<0,l[141]=(_(n-141)<=a?i:r)<<2|(_(e-141)<=a?i:r)<<1|(_(t-141)<=a?i:r)<<0,l[142]=(_(n-142)<=a?i:r)<<2|(_(e-142)<=a?i:r)<<1|(_(t-142)<=a?i:r)<<0,l[143]=(_(n-143)<=a?i:r)<<2|(_(e-143)<=a?i:r)<<1|(_(t-143)<=a?i:r)<<0,l[144]=(_(n-144)<=a?i:r)<<2|(_(e-144)<=a?i:r)<<1|(_(t-144)<=a?i:r)<<0,l[145]=(_(n-145)<=a?i:r)<<2|(_(e-145)<=a?i:r)<<1|(_(t-145)<=a?i:r)<<0,l[146]=(_(n-146)<=a?i:r)<<2|(_(e-146)<=a?i:r)<<1|(_(t-146)<=a?i:r)<<0,l[147]=(_(n-147)<=a?i:r)<<2|(_(e-147)<=a?i:r)<<1|(_(t-147)<=a?i:r)<<0,l[148]=(_(n-148)<=a?i:r)<<2|(_(e-148)<=a?i:r)<<1|(_(t-148)<=a?i:r)<<0,l[149]=(_(n-149)<=a?i:r)<<2|(_(e-149)<=a?i:r)<<1|(_(t-149)<=a?i:r)<<0,l[150]=(_(n-150)<=a?i:r)<<2|(_(e-150)<=a?i:r)<<1|(_(t-150)<=a?i:r)<<0,l[151]=(_(n-151)<=a?i:r)<<2|(_(e-151)<=a?i:r)<<1|(_(t-151)<=a?i:r)<<0,l[152]=(_(n-152)<=a?i:r)<<2|(_(e-152)<=a?i:r)<<1|(_(t-152)<=a?i:r)<<0,l[153]=(_(n-153)<=a?i:r)<<2|(_(e-153)<=a?i:r)<<1|(_(t-153)<=a?i:r)<<0,l[154]=(_(n-154)<=a?i:r)<<2|(_(e-154)<=a?i:r)<<1|(_(t-154)<=a?i:r)<<0,l[155]=(_(n-155)<=a?i:r)<<2|(_(e-155)<=a?i:r)<<1|(_(t-155)<=a?i:r)<<0,l[156]=(_(n-156)<=a?i:r)<<2|(_(e-156)<=a?i:r)<<1|(_(t-156)<=a?i:r)<<0,l[157]=(_(n-157)<=a?i:r)<<2|(_(e-157)<=a?i:r)<<1|(_(t-157)<=a?i:r)<<0,l[158]=(_(n-158)<=a?i:r)<<2|(_(e-158)<=a?i:r)<<1|(_(t-158)<=a?i:r)<<0,l[159]=(_(n-159)<=a?i:r)<<2|(_(e-159)<=a?i:r)<<1|(_(t-159)<=a?i:r)<<0,l[160]=(_(n-160)<=a?i:r)<<2|(_(e-160)<=a?i:r)<<1|(_(t-160)<=a?i:r)<<0,l[161]=(_(n-161)<=a?i:r)<<2|(_(e-161)<=a?i:r)<<1|(_(t-161)<=a?i:r)<<0,l[162]=(_(n-162)<=a?i:r)<<2|(_(e-162)<=a?i:r)<<1|(_(t-162)<=a?i:r)<<0,l[163]=(_(n-163)<=a?i:r)<<2|(_(e-163)<=a?i:r)<<1|(_(t-163)<=a?i:r)<<0,l[164]=(_(n-164)<=a?i:r)<<2|(_(e-164)<=a?i:r)<<1|(_(t-164)<=a?i:r)<<0,l[165]=(_(n-165)<=a?i:r)<<2|(_(e-165)<=a?i:r)<<1|(_(t-165)<=a?i:r)<<0,l[166]=(_(n-166)<=a?i:r)<<2|(_(e-166)<=a?i:r)<<1|(_(t-166)<=a?i:r)<<0,l[167]=(_(n-167)<=a?i:r)<<2|(_(e-167)<=a?i:r)<<1|(_(t-167)<=a?i:r)<<0,l[168]=(_(n-168)<=a?i:r)<<2|(_(e-168)<=a?i:r)<<1|(_(t-168)<=a?i:r)<<0,l[169]=(_(n-169)<=a?i:r)<<2|(_(e-169)<=a?i:r)<<1|(_(t-169)<=a?i:r)<<0,l[170]=(_(n-170)<=a?i:r)<<2|(_(e-170)<=a?i:r)<<1|(_(t-170)<=a?i:r)<<0,l[171]=(_(n-171)<=a?i:r)<<2|(_(e-171)<=a?i:r)<<1|(_(t-171)<=a?i:r)<<0,l[172]=(_(n-172)<=a?i:r)<<2|(_(e-172)<=a?i:r)<<1|(_(t-172)<=a?i:r)<<0,l[173]=(_(n-173)<=a?i:r)<<2|(_(e-173)<=a?i:r)<<1|(_(t-173)<=a?i:r)<<0,l[174]=(_(n-174)<=a?i:r)<<2|(_(e-174)<=a?i:r)<<1|(_(t-174)<=a?i:r)<<0,l[175]=(_(n-175)<=a?i:r)<<2|(_(e-175)<=a?i:r)<<1|(_(t-175)<=a?i:r)<<0,l[176]=(_(n-176)<=a?i:r)<<2|(_(e-176)<=a?i:r)<<1|(_(t-176)<=a?i:r)<<0,l[177]=(_(n-177)<=a?i:r)<<2|(_(e-177)<=a?i:r)<<1|(_(t-177)<=a?i:r)<<0,l[178]=(_(n-178)<=a?i:r)<<2|(_(e-178)<=a?i:r)<<1|(_(t-178)<=a?i:r)<<0,l[179]=(_(n-179)<=a?i:r)<<2|(_(e-179)<=a?i:r)<<1|(_(t-179)<=a?i:r)<<0,l[180]=(_(n-180)<=a?i:r)<<2|(_(e-180)<=a?i:r)<<1|(_(t-180)<=a?i:r)<<0,l[181]=(_(n-181)<=a?i:r)<<2|(_(e-181)<=a?i:r)<<1|(_(t-181)<=a?i:r)<<0,l[182]=(_(n-182)<=a?i:r)<<2|(_(e-182)<=a?i:r)<<1|(_(t-182)<=a?i:r)<<0,l[183]=(_(n-183)<=a?i:r)<<2|(_(e-183)<=a?i:r)<<1|(_(t-183)<=a?i:r)<<0,l[184]=(_(n-184)<=a?i:r)<<2|(_(e-184)<=a?i:r)<<1|(_(t-184)<=a?i:r)<<0,l[185]=(_(n-185)<=a?i:r)<<2|(_(e-185)<=a?i:r)<<1|(_(t-185)<=a?i:r)<<0,l[186]=(_(n-186)<=a?i:r)<<2|(_(e-186)<=a?i:r)<<1|(_(t-186)<=a?i:r)<<0,l[187]=(_(n-187)<=a?i:r)<<2|(_(e-187)<=a?i:r)<<1|(_(t-187)<=a?i:r)<<0,l[188]=(_(n-188)<=a?i:r)<<2|(_(e-188)<=a?i:r)<<1|(_(t-188)<=a?i:r)<<0,l[189]=(_(n-189)<=a?i:r)<<2|(_(e-189)<=a?i:r)<<1|(_(t-189)<=a?i:r)<<0,l[190]=(_(n-190)<=a?i:r)<<2|(_(e-190)<=a?i:r)<<1|(_(t-190)<=a?i:r)<<0,l[191]=(_(n-191)<=a?i:r)<<2|(_(e-191)<=a?i:r)<<1|(_(t-191)<=a?i:r)<<0,l[192]=(_(n-192)<=a?i:r)<<2|(_(e-192)<=a?i:r)<<1|(_(t-192)<=a?i:r)<<0,l[193]=(_(n-193)<=a?i:r)<<2|(_(e-193)<=a?i:r)<<1|(_(t-193)<=a?i:r)<<0,l[194]=(_(n-194)<=a?i:r)<<2|(_(e-194)<=a?i:r)<<1|(_(t-194)<=a?i:r)<<0,l[195]=(_(n-195)<=a?i:r)<<2|(_(e-195)<=a?i:r)<<1|(_(t-195)<=a?i:r)<<0,l[196]=(_(n-196)<=a?i:r)<<2|(_(e-196)<=a?i:r)<<1|(_(t-196)<=a?i:r)<<0,l[197]=(_(n-197)<=a?i:r)<<2|(_(e-197)<=a?i:r)<<1|(_(t-197)<=a?i:r)<<0,l[198]=(_(n-198)<=a?i:r)<<2|(_(e-198)<=a?i:r)<<1|(_(t-198)<=a?i:r)<<0,l[199]=(_(n-199)<=a?i:r)<<2|(_(e-199)<=a?i:r)<<1|(_(t-199)<=a?i:r)<<0,l[200]=(_(n-200)<=a?i:r)<<2|(_(e-200)<=a?i:r)<<1|(_(t-200)<=a?i:r)<<0,l[201]=(_(n-201)<=a?i:r)<<2|(_(e-201)<=a?i:r)<<1|(_(t-201)<=a?i:r)<<0,l[202]=(_(n-202)<=a?i:r)<<2|(_(e-202)<=a?i:r)<<1|(_(t-202)<=a?i:r)<<0,l[203]=(_(n-203)<=a?i:r)<<2|(_(e-203)<=a?i:r)<<1|(_(t-203)<=a?i:r)<<0,l[204]=(_(n-204)<=a?i:r)<<2|(_(e-204)<=a?i:r)<<1|(_(t-204)<=a?i:r)<<0,l[205]=(_(n-205)<=a?i:r)<<2|(_(e-205)<=a?i:r)<<1|(_(t-205)<=a?i:r)<<0,l[206]=(_(n-206)<=a?i:r)<<2|(_(e-206)<=a?i:r)<<1|(_(t-206)<=a?i:r)<<0,l[207]=(_(n-207)<=a?i:r)<<2|(_(e-207)<=a?i:r)<<1|(_(t-207)<=a?i:r)<<0,l[208]=(_(n-208)<=a?i:r)<<2|(_(e-208)<=a?i:r)<<1|(_(t-208)<=a?i:r)<<0,l[209]=(_(n-209)<=a?i:r)<<2|(_(e-209)<=a?i:r)<<1|(_(t-209)<=a?i:r)<<0,l[210]=(_(n-210)<=a?i:r)<<2|(_(e-210)<=a?i:r)<<1|(_(t-210)<=a?i:r)<<0,l[211]=(_(n-211)<=a?i:r)<<2|(_(e-211)<=a?i:r)<<1|(_(t-211)<=a?i:r)<<0,l[212]=(_(n-212)<=a?i:r)<<2|(_(e-212)<=a?i:r)<<1|(_(t-212)<=a?i:r)<<0,l[213]=(_(n-213)<=a?i:r)<<2|(_(e-213)<=a?i:r)<<1|(_(t-213)<=a?i:r)<<0,l[214]=(_(n-214)<=a?i:r)<<2|(_(e-214)<=a?i:r)<<1|(_(t-214)<=a?i:r)<<0,l[215]=(_(n-215)<=a?i:r)<<2|(_(e-215)<=a?i:r)<<1|(_(t-215)<=a?i:r)<<0,l[216]=(_(n-216)<=a?i:r)<<2|(_(e-216)<=a?i:r)<<1|(_(t-216)<=a?i:r)<<0,l[217]=(_(n-217)<=a?i:r)<<2|(_(e-217)<=a?i:r)<<1|(_(t-217)<=a?i:r)<<0,l[218]=(_(n-218)<=a?i:r)<<2|(_(e-218)<=a?i:r)<<1|(_(t-218)<=a?i:r)<<0,l[219]=(_(n-219)<=a?i:r)<<2|(_(e-219)<=a?i:r)<<1|(_(t-219)<=a?i:r)<<0,l[220]=(_(n-220)<=a?i:r)<<2|(_(e-220)<=a?i:r)<<1|(_(t-220)<=a?i:r)<<0,l[221]=(_(n-221)<=a?i:r)<<2|(_(e-221)<=a?i:r)<<1|(_(t-221)<=a?i:r)<<0,l[222]=(_(n-222)<=a?i:r)<<2|(_(e-222)<=a?i:r)<<1|(_(t-222)<=a?i:r)<<0,l[223]=(_(n-223)<=a?i:r)<<2|(_(e-223)<=a?i:r)<<1|(_(t-223)<=a?i:r)<<0,l[224]=(_(n-224)<=a?i:r)<<2|(_(e-224)<=a?i:r)<<1|(_(t-224)<=a?i:r)<<0,l[225]=(_(n-225)<=a?i:r)<<2|(_(e-225)<=a?i:r)<<1|(_(t-225)<=a?i:r)<<0,l[226]=(_(n-226)<=a?i:r)<<2|(_(e-226)<=a?i:r)<<1|(_(t-226)<=a?i:r)<<0,l[227]=(_(n-227)<=a?i:r)<<2|(_(e-227)<=a?i:r)<<1|(_(t-227)<=a?i:r)<<0,l[228]=(_(n-228)<=a?i:r)<<2|(_(e-228)<=a?i:r)<<1|(_(t-228)<=a?i:r)<<0,l[229]=(_(n-229)<=a?i:r)<<2|(_(e-229)<=a?i:r)<<1|(_(t-229)<=a?i:r)<<0,l[230]=(_(n-230)<=a?i:r)<<2|(_(e-230)<=a?i:r)<<1|(_(t-230)<=a?i:r)<<0,l[231]=(_(n-231)<=a?i:r)<<2|(_(e-231)<=a?i:r)<<1|(_(t-231)<=a?i:r)<<0,l[232]=(_(n-232)<=a?i:r)<<2|(_(e-232)<=a?i:r)<<1|(_(t-232)<=a?i:r)<<0,l[233]=(_(n-233)<=a?i:r)<<2|(_(e-233)<=a?i:r)<<1|(_(t-233)<=a?i:r)<<0,l[234]=(_(n-234)<=a?i:r)<<2|(_(e-234)<=a?i:r)<<1|(_(t-234)<=a?i:r)<<0,l[235]=(_(n-235)<=a?i:r)<<2|(_(e-235)<=a?i:r)<<1|(_(t-235)<=a?i:r)<<0,l[236]=(_(n-236)<=a?i:r)<<2|(_(e-236)<=a?i:r)<<1|(_(t-236)<=a?i:r)<<0,l[237]=(_(n-237)<=a?i:r)<<2|(_(e-237)<=a?i:r)<<1|(_(t-237)<=a?i:r)<<0,l[238]=(_(n-238)<=a?i:r)<<2|(_(e-238)<=a?i:r)<<1|(_(t-238)<=a?i:r)<<0,l[239]=(_(n-239)<=a?i:r)<<2|(_(e-239)<=a?i:r)<<1|(_(t-239)<=a?i:r)<<0,l[240]=(_(n-240)<=a?i:r)<<2|(_(e-240)<=a?i:r)<<1|(_(t-240)<=a?i:r)<<0,l[241]=(_(n-241)<=a?i:r)<<2|(_(e-241)<=a?i:r)<<1|(_(t-241)<=a?i:r)<<0,l[242]=(_(n-242)<=a?i:r)<<2|(_(e-242)<=a?i:r)<<1|(_(t-242)<=a?i:r)<<0,l[243]=(_(n-243)<=a?i:r)<<2|(_(e-243)<=a?i:r)<<1|(_(t-243)<=a?i:r)<<0,l[244]=(_(n-244)<=a?i:r)<<2|(_(e-244)<=a?i:r)<<1|(_(t-244)<=a?i:r)<<0,l[245]=(_(n-245)<=a?i:r)<<2|(_(e-245)<=a?i:r)<<1|(_(t-245)<=a?i:r)<<0,l[246]=(_(n-246)<=a?i:r)<<2|(_(e-246)<=a?i:r)<<1|(_(t-246)<=a?i:r)<<0,l[247]=(_(n-247)<=a?i:r)<<2|(_(e-247)<=a?i:r)<<1|(_(t-247)<=a?i:r)<<0,l[248]=(_(n-248)<=a?i:r)<<2|(_(e-248)<=a?i:r)<<1|(_(t-248)<=a?i:r)<<0,l[249]=(_(n-249)<=a?i:r)<<2|(_(e-249)<=a?i:r)<<1|(_(t-249)<=a?i:r)<<0,l[250]=(_(n-250)<=a?i:r)<<2|(_(e-250)<=a?i:r)<<1|(_(t-250)<=a?i:r)<<0,l[251]=(_(n-251)<=a?i:r)<<2|(_(e-251)<=a?i:r)<<1|(_(t-251)<=a?i:r)<<0,l[252]=(_(n-252)<=a?i:r)<<2|(_(e-252)<=a?i:r)<<1|(_(t-252)<=a?i:r)<<0,l[253]=(_(n-253)<=a?i:r)<<2|(_(e-253)<=a?i:r)<<1|(_(t-253)<=a?i:r)<<0,l[254]=(_(n-254)<=a?i:r)<<2|(_(e-254)<=a?i:r)<<1|(_(t-254)<=a?i:r)<<0,l[255]=(_(n-255)<=a?i:r)<<2|(_(e-255)<=a?i:r)<<1|(_(t-255)<=a?i:r)<<0,l}function Xl(t,e,n,i,r,a,l,o){var s,u,c,f,h,m,p,d,g=t.length,x=g>>>(i|=0),_=1<<i,y=e<<i,v=g-y,b=e-1<<i,w=l,C=o,A=l,S=o,D=new ar(sr(x/32)),I=new rr(x<<2),R=0,L=l+o>>>i;if(D[L>>>5]|=1<<(31&L),0<=o+y&&o+y<=v&&(I[R]=o,I[R+1]=l,I[R+2]=l,I[R+3]=y,R+=4),I[R]=o+y,I[R+1]=l,I[R+2]=l,I[R+3]=-y,R+=4,i)for(;0<R;){for(y=I[(R-=4)+3],m=I[R]+y,f=I[R+1],h=I[R+2],C=ur(C,m),S=cr(S,m),w=ur(w,f),A=cr(A,h),c=f;0<=c&&(L=(u=c+m)>>>i,!((d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]])||D[L>>>5]&1<<(31&L)));c-=_)D[L>>>5]|=1<<(31&L),w=ur(w,c);if(f<=c){for(L=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=h&&(d||D[L>>>5]&1<<(31&L));)L=(u=(c+=_)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];p=(s=c)<=h}else(s=c+_)<f&&0+y<=m&&m<=v+y&&(I[R]=m,I[R+1]=s,I[R+2]=f-_,I[R+3]=-y,R+=4),c=f+_,p=!0;for(;p;){for(L=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=b&&!d&&!(D[L>>>5]&1<<(31&L));)D[L>>>5]|=1<<(31&L),A=cr(A,c),L=(u=(c+=_)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];for(0<=m+y&&m+y<=v&&(I[R]=m,I[R+1]=s,I[R+2]=c-_,I[R+3]=y,R+=4),h+_<c&&0<=m-y&&m-y<=v&&(I[R]=m,I[R+1]=h+_,I[R+2]=c-_,I[R+3]=-y,R+=4),L=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=h&&(d||D[L>>>5]&1<<(31&L));)L=(u=(c+=_)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];p=(s=c)<=h}}else for(;0<R;){for(y=I[(R-=4)+3],m=I[R]+y,f=I[R+1],h=I[R+2],C=ur(C,m),S=cr(S,m),w=ur(w,f),A=cr(A,h),c=f;0<=c&&!(1&r[t[L=u=c+m]]||D[L>>>5]&1<<(31&L));c-=_)D[L>>>5]|=1<<(31&L),w=ur(w,c);if(f<=c){for(L=u=c+m;c<=h&&(1&r[t[u]]||D[L>>>5]&1<<(31&L));)L=u=(c+=_)+m;p=(s=c)<=h}else(s=c+_)<f&&0+y<=m&&m<=v+y&&(I[R]=m,I[R+1]=s,I[R+2]=f-_,I[R+3]=-y,R+=4),c=f+_,p=!0;for(;p;){for(L=u=c+m;c<=b&&!(1&r[t[u]])&&!(D[L>>>5]&1<<(31&L));)D[L>>>5]|=1<<(31&L),A=cr(A,c),L=u=(c+=_)+m;for(0<=m+y&&m+y<=v&&(I[R]=m,I[R+1]=s,I[R+2]=c-_,I[R+3]=y,R+=4),h+_<c&&0<=m-y&&m-y<=v&&(I[R]=m,I[R+1]=h+_,I[R+2]=c-_,I[R+3]=-y,R+=4),L=u=c+m;c<=h&&(1&r[t[u]]||D[L>>>5]&1<<(31&L));)L=u=(c+=_)+m;p=(s=c)<=h}}return{mask:D,box:[w,C,A,S]}}function Wl(t,e,n,i,r,a,l,o,s,u,c){null==o&&(s=o=0,u=e-1);var f,h,m,p,d=fr.MODE,g=fr.Color.hue,x=fr.Color.intensity,_=dr.cos,y=fr.CONST.toRad,v=(t.length,r.length),b=u-o+1;if(0<i)if(d.HUE===l||d.COLORIZEHUE===l)for(m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=0===t[(f=m+p<<i)+3]?1e4:_(y*g(t[f],t[f+1],t[f+2]));else if(d.INTENSITY===l)for(a*=255,m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=0===t[(f=m+p<<i)+3]?1e4:x(t[f],t[f+1],t[f+2]);else if(d.GRAY===l)for(a*=255,m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=0===t[(f=m+p<<i)+3]?1e4:t[f];else for(a=1e4*a+1e3*a+100*a+10*a+a,m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=0===t[(f=m+p<<i)+3]?1e5:1e4*(t[f]+t[f+1]+t[f+2])/3/255+1e3*(t[f]+t[f+1])/2/255+100*(t[f+1]+t[f+2])/2/255+10*(t[f]+t[f+2])/2/255+t[f]/255;else if(d.HUE===l||d.COLORIZEHUE===l)for(m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=_(y*t[f=m+p]);else for(a*=255,m=o,p=s*e,h=0;h<v;++h,++m)b<=m&&(m=o,p+=e),r[h]=t[f=m+p];return a}function $l(t,e,n){this.id=-1,this.root=n||this,this.x1=t,this.y1=e,this.x2=t,this.y2=e}function ql(t){for(var e=t.x1,n=t.y1,i=t.x2,r=t.y2;t!==t.root;)t=t.root,e=gr(e,t.x1),n=gr(n,t.y1),i=xr(i,t.x2),r=xr(r,t.y2),t.x1=e,t.y1=n,t.x2=i,t.y2=r;return t}function Vl(t,e){(t=ql(t))!==(e=ql(e))&&(t.x1=e.x1=gr(e.x1,t.x1),t.y1=e.y1=gr(e.y1,t.y1),t.x2=e.x2=xr(e.x2,t.x2),t.y2=e.y2=xr(e.y2,t.y2),t.root=e)}function Kl(a,t,e,n,i,r,l,o,s,u,c,f,h,m,p,d){null==h&&(m=h=0),n|=0;var g,x,_,y,v,b,w,C,A,S,D=a?a.length:t*e<<n,I=D>>>n,R=8===r,L=null,E=null!=o,M=new Array(I),L=E?new $l(0,0):null;for(M[0]=E&&yr(i[0]-o)>l?L:new $l(0,0),_=1;_<t;++_)M[_]=E&&yr(i[_]-o)>l?L:yr(i[_]-i[_-1])<=l?M[_-1]:new $l(_,0);for(y=1,v=t;y<e;++y,v+=t)for(M[v]=E&&yr(i[v]-o)>l?L:yr(i[v]-i[v-t])<=l?M[v-t]:new $l(0,y),_=1;_<t;++_)E&&yr(i[v+_]-o)>l?M[v+_]=L:(x=L!==M[v+_-1]&&yr(i[v+_]-i[v+_-1])<=l?M[v+_-1]:null,R&&L!==M[v-t+_-1]&&yr(i[v+_]-i[v-t+_-1])<=l&&(null!=x?Vl(x,M[v-t+_-1]):x=M[v-t+_-1]),L!==M[v-t+_]&&yr(i[v+_]-i[v-t+_])<=l&&(null!=x?Vl(x,M[v-t+_]):x=M[v-t+_]),M[v+_]=null!=x?x:new $l(_,y),R&&L!==M[v+_-1]&&L!==M[v-t+_]&&yr(i[v+_-1]-i[v-t+_])<=l&&Vl(M[v+_-1],M[v-t+_]));for(A=s?(C=-255,255):(C=255,0),b=null!=L?(L.id=0,1):0,u&&(a={}),_=0;_<I;++_)M[_]=ql(M[_]),M[_].id<0&&(M[_].id=b++),u&&L!==M[_]&&((S=a[M[_].id])?(S.x1=gr(S.x1,M[_].x1),S.y1=gr(S.y1,M[_].y1),S.x2=xr(S.x2,M[_].x2),S.y2=xr(S.y2,M[_].y2),S.k=xr(S.k,yr(i[_]-o))):a[M[_].id]={x1:M[_].x1,y1:M[_].y1,x2:M[_].x2,y2:M[_].y2,k:yr(i[_]-o)});if(u)a=Object.keys(a).reduce(function(t,e){var e=a[e],n=e.x2-e.x1+1,i=e.y2-e.y1+1,r=n*i;return r<c||f<r||t.push({x:h+e.x1,y:m+e.y1,width:n,height:i,area:r,score:e.k/l}),t},[]);else if(n)for(g=_=0;g<D;g+=4,++_)w=A+C*M[_].id/b|0,a[g]=a[g+1]=a[g+2]=w;else for(_=0;_<D;++_)w=A+C*M[_].id/b|0,a[_]=w;return a}function Zl(t,e){return e.area-t.area}function Jl(t,e,n,i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_){var y,v,b,w,C,A,S,D,I,R,L,E=p,M=d,T=at.abs(h),O=l.length,G=!(0===T||90===T||180===T||270===T);if(_.sat=n,_.sat2=i,G?(Ql(_,b=-(y=E>>>1),w=-(v=M>>>1),C=E-1-y,A=M-1-v,g,x,0,0),$r(_,o,s,t+_.x1,e+_.y1,t+_.x2,e+_.y2,t+_.x3,e+_.y3,t+_.x4,e+_.y4,m)):(90!==T&&270!==T||(E=d,M=p),b=-(y=E>>>1),w=-(v=M>>>1),C=E-1-y,A=M-1-v,_.area=0,_.sum=0,_.sum2=0,Wr(_,o,s,t+b,e+w,t+C,e+A,1)),_.sat2=null,h=_.area,n=_.sum,i=_.sum2,2<=(E=p*d/h)||E<=.5)return 0;if(M=at.abs(i-n*(R=n/h)),O<=1)return M<.01?at.abs(R-r)<.5?1:1-at.abs(R-r)/at.max(R,r):0;if(M<.001)return 0;for(S=L=0;S<O;++S)I=l[S],A=G?(b=I.x0,w=I.y0,C=I.x1,I.y1):270===T?(b=I.y0,w=u-1-I.x1,C=I.y1,u-1-I.x0):180===T?(b=u-1-I.x1,w=c-1-I.y1,C=u-1-I.x0,c-1-I.y0):90===T?(b=c-1-I.y1,w=I.x0,C=c-1-I.y0,I.x1):(b=I.x0,w=I.y0,C=I.x1,I.y1),b=at.round(f*b)-y,w=at.round(f*w)-v,C=at.round(f*C)-y,A=at.round(f*A)-v,I=I.k-r,G?(Ql(_,b,w,C,A,g,x,0,0),$r(_,o,s,t+_.x1,e+_.y1,t+_.x2,e+_.y2,t+_.x3,e+_.y3,t+_.x4,e+_.y4,m)):(_.area=0,_.sum=0,Wr(_,o,s,t+b,e+w,t+C,e+A,1)),D=_.area,L+=I*(_.sum-R*D);return p=L/at.sqrt(M*a.v*h)||0,(d=a.c0||0)<(E=a.c||0)&&p<=at.abs(d)?0:at.min(at.max(p=1.01<(p/=E||1)?0:p,-1),1)}function Ql(t,e,n,i,r,a,l,o,s){var u=e-o,n=n-s;t.x1=at.round(l*u-a*n+o),t.y1=at.round(a*u+l*n+s),t.x2=at.round(l*(u=i-o)-a*n+o),t.y2=at.round(a*u+l*n+s),t.x3=at.round(l*u-a*(n=r-s)+o),t.y3=at.round(a*u+l*n+s),t.x4=at.round(l*(u=e-o)-a*n+o),t.y4=at.round(a*u+l*n+s),t.area=0,t.sum=0,t.sum2=0}function to(t,e,n,i,r,a){for(var l,o,s,u,c,f=0,h=0,m=0,p=t.length,d=e*n,g=0;g<p;g+=4)f+=t[g]/d,h+=t[g+1]/d,m+=t[g+2]/d;return l=[f,h,m],null!=i&&(u=[null,null,null],c=[null,null,null],o=[[],[],[]],s=[0,0,0],null!=a?(jr(t,e,n,2,a,u[a]=new Kr(d),c[a]=new Kr(d)),o[a]=Pr.tm_approximate(t,u[a],e,n,a,i,r),s[a]=eo(o[a],l[a],u[a],c[a],e,n)):(jr(t,e,n,2,0,u[0]=new Kr(d),c[0]=new Kr(d)),jr(t,e,n,2,1,u[1]=new Kr(d),c[1]=new Kr(d)),jr(t,e,n,2,2,u[2]=new Kr(d),c[2]=new Kr(d)),s=[eo((o=[Pr.tm_approximate(t,u[0],e,n,0,i,r),Pr.tm_approximate(t,u[1],e,n,1,i,r),Pr.tm_approximate(t,u[2],e,n,2,i,r)])[0],l[0],u[0],c[0],e,n),eo(o[1],l[1],u[1],c[1],e,n),eo(o[2],l[2],u[2],c[2],e,n)])),{avg:l,basis:o||null,var:s||null}}function eo(t,e,n,i,r,a){for(var l,o,s,u,c,f,h,m=t.length,p=0,d=Xr(n,r,a,0,0,r-1,a-1),i=Xr(i,r,a,0,0,r-1,a-1)-d*e,g=i,x=0,_=0,y=0,v=0,b=0;b<m;++b)h=(l=t[b]).x0,u=l.y0,o=((s=l.x1)-h+1)*((c=l.y1)-u+1),f=l.k-e,d=Xr(n,r,a,h,u,s,c),p<o?(y=x+(h=255-l.k-e)*h*(p=o),v=_+h*(d-e*o),x+=f*f*o,_+=f*(d-e*o)):(x+=f*f*o,_+=f*(d-e*o),y+=f*f*o,v+=f*(d-e*o));return{v:x/(r*a),c:_/at.sqrt(at.abs(i*x))||0,c0:v/at.sqrt(at.abs(g*y))||0}}function no(t,e,n,i,r,a,l,o,s,u){if(!s||!s.length)return[];c=null,f=0,(b=(b=s).map(function(t){return(t%360+360)%180}).sort(function(t,e){return t-e}).reduce(function(t,e){return e!==c&&(t[f++]=e),c=e,t},new Array(b.length))).length=f,s=b;var c,f,h,m,p,d,g,x,_,y,v,b=l-r+1,o=o-a+1,w=b/2,C=o/2,A=N.ceil(ia(b,o)),S=2*A+1,D=s.length,I=D*S,R=new la(I),L=new Array(I),E=new oa(D),M=new oa(D),T=4===i?3:0,O=4===i?2:0;for(fo(E,M,s),h=r,p=(m=a)*e,g=0,x=b*o<<O;g<x;g+=i,++h)if(l<h&&(h=r,++m,p+=e),t[d=p+h<<O]&&t[d+T])for(_=0;_<D;++_)++R[y=(N.round((h-w)*M[_]+(m-C)*E[_])+A)*D+_],(v=L[y])?(v.xmin>h&&(v.xminy=m),v.xmax<h&&(v.xmaxy=m),v.xmin=N.min(h,v.xmin),v.xmax=N.max(h,v.xmax),v.ymin=N.min(m,v.ymin),v.ymax=N.max(m,v.ymax)):L[y]={xmin:h,ymin:m,xmax:h,ymax:m,xminy:m,xmaxy:m};return aa([],R,u,S,D,null).map(function(t){var e=L[t];return{shape:"line",rho:N.floor(t/D)-A,theta:s[t%D],x0:e.xmin,y0:e.xmin===e.xmax?e.ymin:e.xminy,x1:e.xmax,y1:e.xmin===e.xmax?e.ymax:e.xmaxy}})}function io(n,i,r,a,t,e,l,o,s,u,c){return no(n,i,0,a,t,e,l,o,s,u).reduce(function(t,e){return t.push.apply(t,mo(e,n,i,r,a,u,c)),t},[])}function ro(t,e,n,i,r,a,l,o,s,u,c,f){var h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L,E,M=no(t,e,0,i,r,a,l,o,s,c),T=.025*N.min(l-r+1,o-a+1);for(M.sort(go),_=M.length,h=[],y=0;y<_;++y)b=M[y],0!==y&&uo(b.theta,w.theta,3)&&uo(b.rho,w.rho,T)||(b._segments=mo(b,t,e,n,i,c,f).map(function(t){return t._line=b,t}),h.push(b)),w=b;for(_=h.length,m=[],y=0;y<_;++y)for(b=h[y],v=y+1;v<_;++v)N.abs(b.theta-(w=h[v]).theta)<=3&&m.push([b,w,(b.theta+w.theta)/2]);for(_=m.length,null!=u&&(x=180-(g=(u+360)%180)),p=[],y=0;y<_;++y)for(b=m[y],v=y+1;v<_;++v)d=N.abs(b[2]-(w=m[v])[2]),(null==u||N.abs(d-g)<=3||N.abs(d-x)<=3)&&(C=po(b[0],w[0]),A=po(b[0],w[1]),S=po(b[1],w[0]),D=po(b[1],w[1]),L=ho(b[0],w[0],C,5),I=ho(b[0],w[1],A,5),E=ho(b[1],w[0],S,5),R=ho(b[1],w[1],D,5),L)&&I&&E&&R&&L[0]===I[0]&&L[1]===E[1]&&E[0]===R[0]&&I[1]===R[1]&&(E={shape:90===u?"rectangle":"parallelogram",x0:(L=[C,A,S,D].sort(function(l){return function(t,e){var n=t.x-l.x,i=e.x-l.x,r=t.y-l.y,a=e.y-l.y;return 0<=n&&i<0?1:n<0&&0<=i?-1:0==n&&0==i?0<=r||0<=a?e.y-t.y:t.y-e.y:(t=n*a-i*r)<0?-1:0<t?1:i*i+a*a-(n*n+r*r)}}({x:(C.x+A.x+S.x+D.x)/4,y:(C.y+A.y+S.y+D.y)/4})))[0].x,y0:L[0].y,x1:L[1].x,y1:L[1].y,x2:L[2].x,y2:L[2].y,x3:L[3].x,y3:L[3].y},90!==u&&(E.angle=null==u?d:N.min(g,x)),p.push(E));return p}function ao(t,e,n,i,r,a,l,o,s,u){if(!s||!s.length)return[];var c,f,h,m,p,d,g,x=ra(t,e,n,0,i,r,a,l,o),_=x.length,y=l-r+1,t=o-a+1,v=y*t,b=s.length,w=N.ceil(N.max(60,2*u)),e=so(w,function(t){return 360*t/w}),C=new la(b*v),A=new oa(w),S=new oa(w),D=new Array(w);for(fo(A,S,e),c=0;c<b;++c){T=M=E=L=R=I=void 0;for(var I=D,R=A,L=S,E=s[c],M=0,T=R.length;M<T;++M)I[M]={x:E*L[M],y:E*R[M]};for(f=0;f<_;++f)for(h=x[f].x,m=x[f].y,p=0;p<w;++p)d=N.round(h-D[p].x),g=N.round(m-D[p].y),r<=d&&d<=l&&a<=g&&g<=o&&++C[c*v+(g-a)*y+(d-r)]}return aa([],C,u,b,t,y).map(function(t){return{shape:"circle",cx:t%y+r,cy:N.floor(t%v/y)+a,r:s[N.floor(t/v)]}})}function lo(t,e,n,i,r,a,l,o,s,u,c,f,h){if(null==s&&(s=10),(u=null==u?N.max(l-r+1,o-a+1)>>>1:u)<s)return[];if(null==c&&(c=3),(f=null==f?u:N.min(u,f))<c)return[];for(var m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L=ra(t,e,n,0,i,r,a,l,o),E=f-c+1,M=new la(E),T=new Array(E),O=L.length,G=[],F=0;F<O;++F)if(!L[F].u)for(d=L[F].x,g=L[F].y,m=0;m<F;++m)if(!(L[m].u||(x=L[m].x,_=L[m].y,(S=ia(b=d-x,w=g-_)/2)<s)||u<S)){for(y=(d+x)/2,v=(g+_)/2,co(M,0),co(T,null),p=0;p<O;++p)L[p].u||p===F||p===m||(D=L[p].x,A=L[p].y,C=ia(D-y,A-v),S<=C)||(A=(S*S+C*C-(D=D-d)*D-(D=A-g)*D)/(2*S*C),A*=A,D=N.round(N.sqrt(S*S*C*C*(1-A)/(S*S-C*C*A))),c<=D&&D<=f&&(++M[D-=c],T[D]||(T[D]=[]),T[D].push(p)));if((R=aa([],M,h,E,null,null)).length){L[F].u=1,L[m].u=1,y=N.round(y),v=N.round(v),S=N.round(S),I=N.round(180*N.atan2(w,b)/N.PI),G.push.apply(G,R.map(function(t){return T[t].forEach(function(t){L[t].u=1}),{shape:"ellipse",cx:y,cy:v,rx:S,ry:t+c,angle:I}}));break}}return G}function oo(t){return+t||0}function so(t,e){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i);return n}function uo(t,e,n){return N.abs(t-e)<=(n||0)}function co(t,e){for(var n=0,i=t.length;n<i;++n)t[n]=e}function fo(t,e,n){for(var i=0,r=n.length;i<r;++i)t[i]=N.sin(n[i]*na),e[i]=N.cos(n[i]*na)}function ho(t,e,n,l){function i(t,e,n,i,r,a){return uo(t,n,l)&&uo(e,i,l)&&uo(t,r,l)&&uo(e,a,l)}var r,a,o,s,u=t._segments,c=e._segments,f=u.length,h=c.length;if(n)for(r=0;r<f;++r)for(a=u[r],o=0;o<h;++o)if(s=c[o],i(n.x,n.y,a.x0,a.y0,s.x0,s.y0)||i(n.x,n.y,a.x0,a.y0,s.x1,s.y1)||i(n.x,n.y,a.x1,a.y1,s.x0,s.y0)||i(n.x,n.y,a.x1,a.y1,s.x1,s.y1))return[r,o]}function mo(t,e,n,i,r,a,l){var o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S=r,D=n*r,I=[],R=4===r?3:0,L=4===r?2:0,E=t.x1-t.x0,M=t.y1-t.y0;if(N.abs(E)>=N.abs(M))for(d=p=0,m=t.x1>=t.x0?1:-1,o=f=t.x0,s=h=t.y0;f!==t.x1;f+=m)(0<=(h=N.round(M*(f-t.x0)/E)+t.y0)&&h<i?(g=h*n+f<<L,v=f+1<n?g+S:g,y=0<=f-1?g-S:g,x=0<=h-1?g-D:g,_=h+1<i?g+D:g,w=f+1<n&&0<=h-1?g+S-D:g,b=0<=f-1&&0<=h-1?g-S-D:g,A=f+1<n&&h+1<i?g+S+D:g,C=0<=f-1&&h+1<i?g-S+D:g,e[g]&&e[g+R]||e[y]&&e[y+R]||e[v]&&e[v+R]||e[x]&&e[x+R]||e[_]&&e[_+R]||e[b]&&e[b+R]||e[w]&&e[w+R]||e[C]&&e[C+R]||e[A]&&e[A+R]):0)?(++p,d=0,u=f,c=h):l<++d&&(a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:o,y0:s,x1:u,y1:c}),p=0,o=f,s=h);else for(d=p=0,m=t.y1>=t.y0?1:-1,o=f=t.x0,s=h=t.y0;h!==t.y1;h+=m)(0<=(f=N.round(E*(h-t.y0)/M)+t.x0)&&f<n?(g=h*n+f<<L,v=f+1<n?g+S:g,y=0<=f-1?g-S:g,x=0<=h-1?g-D:g,_=h+1<i?g+D:g,w=f+1<n&&0<=h-1?g+S-D:g,b=0<=f-1&&0<=h-1?g-S-D:g,A=f+1<n&&h+1<i?g+S+D:g,C=0<=f-1&&h+1<i?g-S+D:g,e[g]&&e[g+R]||e[y]&&e[y+R]||e[v]&&e[v+R]||e[x]&&e[x+R]||e[_]&&e[_+R]||e[b]&&e[b+R]||e[w]&&e[w+R]||e[C]&&e[C+R]||e[A]&&e[A+R]):0)?(++p,d=0,u=f,c=h):l<++d&&(a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:o,y0:s,x1:u,y1:c}),p=0,o=f,s=h);return a<p&&I.push({shape:"line",rho:t.rho,theta:t.theta,x0:o,y0:s,x1:u,y1:c}),I}function po(t,e){var n={x:t.x0,y:t.y0},t={x:t.x1,y:t.y1},i={x:e.x0,y:e.y0},e={x:e.x1,y:e.y1},r=n.x,a=t.x,n=n.y,t=t.y,l=i.x,o=e.x,i=i.y,e=e.y,s=r*t-n*a,u=l*e-i*o,c=(r-a)*(i-e)-(n-t)*(l-o);return!!c&&{x:N.round((s*(l-o)-(r-a)*u)/c),y:N.round((s*(i-e)-(n-t)*u)/c)}}function go(t,e){return t.theta-e.theta||t.rho-e.rho}function xo(t,e,n,i,r){var a,l=this;t instanceof xo?(l.dst=(a=t).dst,l.src=a.src,l.patch=a.patch,l._with_gradients=a._with_gradients,l._needs_dilate=a._needs_dilate,l.field=a.field&&a.field.map(function(t){return t.slice()}),l.fieldr=a.fieldr&&a.fieldr.map(function(t){return t.slice()})):(l.dst=t,l.src=e,l.patch=n,l._with_gradients=!!i,l._needs_dilate=!!r,l.field=l.fieldr=null),l.dst&&(l.dstData=l.dst.data(),l.dstData.rect=l.dst.rect(),l._needs_dilate)&&(l.dstData.dilated=l.dst.dilate(n)),l.src&&(l.srcData=l.src.data(),l.srcData.rect=l.src.rect())}function _o(t,e,n,i,r,a,l,o,s,u){t=new _o.ANNF(t,e,n,l,o);return t.initialize(1),s&&t.initialize(-1),u?t.onionization():t.randomization(2),t.optimization(i,r,a),t}function yo(t,e){return rt.round(rt.random()*(e-t)+t)}return hl.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:hl.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,posX:0,posY:1,angle:0,radius:0,mode:ml.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,posX:t.posX,posY:t.posY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.posX=t.posX,e.posY=t.posY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&yl.call(cl,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},twirl:function(t,e,n,i){return this.angle=t||0,this.radius=e||0,this.centerX=n||0,this.centerY=i||0,this.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},polar:function(t,e,n,i){return this.centerX=t||0,this.centerY=e||0,this.posX=n||0,this.posY=i||0,this.set("polar")},cartesian:function(t,e,n,i){return this.centerX=t||0,this.centerY=e||0,this.posX=n||0,this.posY=i||0,this.set("cartesian")},set:function(t,e){var n=this;return t&&yl.call(cl,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=cl[n._mapName],n._mapInit=cl["init__"+n._mapName],n._apply=bl(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=bl(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){return this._mapName=null,this._map=null,this._mapInit=null,this._mapChanged=!1,this._glsl=null,this},getGLSL:function(){var t=this,e=new vl.Filter(t).begin().shader(t._map?["varying vec2 pix;","uniform sampler2D img;","#define TWOPI  6.283185307179586","#define IGNORE "+ml.IGNORE,"#define CLAMP "+ml.CLAMP,"#define COLOR "+ml.COLOR,"#define WRAP "+ml.WRAP,"uniform int mode;","uniform int swap;","uniform vec2 size;","uniform vec2 center;","uniform float angle;","uniform float radius;","uniform float radius2;","uniform float AMAX;","uniform float RMAX;","uniform vec4 color;","uniform int mapping;",fl.twirl,fl.sphere,fl.polar,fl.cartesian,yl.call(fl,t._mapName)||!t._map.shader?"vec2 map(vec2 pix) {return pix;}":t._map.shader.toString(),"void main(void) {","vec2 p = pix;","if (1 == mapping)      p = twirl(pix, center, radius, angle, size);","else if (2 == mapping) p = sphere(pix, center, radius2, size);","else if (3 == mapping) p = polar(pix, center, RMAX, AMAX, size, swap);","else if (4 == mapping) p = cartesian(pix, center, RMAX, AMAX, size, swap);","else                   p = map(pix);","if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","if (COLOR == mode) {gl_FragColor = color;}","else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","else if (WRAP == mode) {","if (0.0 > p.x) p.x += 1.0;","if (1.0 < p.x) p.x -= 1.0;","if (0.0 > p.y) p.y += 1.0;","if (1.0 < p.y) p.y -= 1.0;","gl_FragColor = texture2D(img, p);","}","else {gl_FragColor = texture2D(img, pix);}","} else {","gl_FragColor = texture2D(img, p);","}","}"].join("\n"):vl.DEFAULT).input("size",function(t,e,n){return[e,n]}).input("center",function(t){return[t.centerX,t.centerY]}).input("angle",function(t){return t.angle}).input("radius",function(t){return t.radius}).input("radius2",function(t){return t.radius*t.radius}).input("AMAX",function(t){return xl}).input("RMAX",function(t,e,n){var i=t.centerX,t=t.centerY,e=(e-1)*(e-1),n=(n-1)*(n-1);return gl(dl(e*+i*+i+n*+t*+t),dl(e*(i-1)*(i-1)+n*+t*+t),dl(e*+i*+i+n*(t-1)*(t-1)),dl(e*(i-1)*(i-1)+n*(t-1)*(t-1)))}).input("swap",function(t){return t.posX===_l?1:0}).input("color",function(t){t=t.color||0;return[(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255,(t>>>24&255)/255]}).input("mapping",function(t){return"twirl"===t._mapName?1:"sphere"===t._mapName?2:"polar"===t._mapName?3:"cartesian"===t._mapName?4:0});return t._map.shader&&t._map.inputs&&t._map.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e.end().code()},canRun:function(){return this._isOn&&this._map}}),cl={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }",polar:"function() {        if (px === Y)        {            r = rMax*t[1]/H;            a = aMax*t[0]/W;            t[1] = round(r*cos(a) + cy);            t[0] = round(r*sin(a) + cx);        }        else        {            r = rMax*t[0]/W;            a = aMax*t[1]/H;            t[0] = round(r*cos(a) + cx);            t[1] = round(r*sin(a) + cy);        }    }",init__polar:"function() {        var sqrt = Math.sqrt, sin = Math.sin, cos = Math.cos,            floor = Math.floor, round = Math.round, max = Math.max,            W = w-1, H = h-1, Y = 1,            cx = self.centerX*W, cy = self.centerY*H,            px = self.posX, py = self.posY,            aMax = 6.283185307179586,            rMax = round(max(            sqrt((cx - 0) * (cx - 0) + (cy - 0) * (cy - 0)),            sqrt((cx - W) * (cx - W) + (cy - 0) * (cy - 0)),            sqrt((cx - 0) * (cx - 0) + (cy - H) * (cy - H)),            sqrt((cx - W) * (cx - W) + (cy - H) * (cy - H))            )), r, a        ;    }",cartesian:"function() {        if (px === Y)        {            ty = t[0] - cx;            tx = t[1] - cy;        }        else        {            tx = t[0] - cx;            ty = t[1] - cy;        }        r = sqrt(tx*tx + ty*ty);        a = atan(ty, tx);        if (0 > a) a += 6.283185307179586;        if (px === Y)        {            t[1] = round(H*r/rMax);            t[0] = round(W*a/aMax);        }        else        {            t[0] = round(W*r/rMax);            t[1] = round(H*a/aMax);        }    }",init__cartesian:"function() {        var sqrt = Math.sqrt, atan = Math.atan2,            floor = Math.floor, round = Math.round, max = Math.max,            W = w-1, H = h-1, Y = 1,            cx = self.centerX*W, cy = self.centerY*H,            px = self.posX, py = self.posY,            aMax = 6.283185307179586,            rMax = round(max(            sqrt((cx - 0) * (cx - 0) + (cy - 0) * (cy - 0)),            sqrt((cx - W) * (cx - W) + (cy - 0) * (cy - 0)),            sqrt((cx - 0) * (cx - 0) + (cy - H) * (cy - H)),            sqrt((cx - W) * (cx - W) + (cy - H) * (cy - H))            )), r, a, tx, ty        ;    }"},fl={twirl:["vec2 twirl(vec2 pix, vec2 center, float R, float angle, vec2 size) {","vec2 T = size*(pix - center);","float D = length(T);","if (D < R) {","float theta = atan(T.y, T.x) + (R-D)*angle/R;","pix = (size*center + vec2(D*cos(theta),  D*sin(theta)))/size;","}","return pix;","}"].join("\n"),sphere:["vec2 sphere(vec2 pix, vec2 center, float R2, vec2 size) {","vec2 T = size*(pix - center);","float TX2 = T.x*T.x; float TY2 = T.y*T.y;","float D2 = TX2 + TY2;","if (D2 < R2) {","D2 = R2 - D2;","float D = sqrt(D2);","float thetax = asin(T.x / sqrt(TX2 + D2)) * (1.0-0.555556);","float thetay = asin(T.y / sqrt(TY2 + D2)) * (1.0-0.555556);","pix = pix - vec2(D * tan(thetax), D * tan(thetay))/size;","}","return pix;","}"].join("\n"),polar:["vec2 polar(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","float r = 0.0;","float a = 0.0;","/*pix *= size;*/","if (1 == swap) {","r = pix.y*rMax;","a = pix.x*aMax;","return (size*center + vec2(r*sin(a), r*cos(a)))/size;","} else {","r = pix.x*rMax;","a = pix.y*aMax;","return (size*center + vec2(r*cos(a), r*sin(a)))/size;","}","}"].join("\n"),cartesian:["vec2 cartesian(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","vec2 xy = size* (pix - center);","float r = 0.0;","float a = 0.0;","if (1 == swap) {","xy = xy.yx;","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(a/aMax, r/rMax);","} else {","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(r/rMax, a/aMax);","}","}"].join("\n")},bn=(r=w).MODE,wn=r.ConvolutionMatrix,Cn=r.ImArray,r.Array32F,An=r.Array16I,r.Array8U,Sn=r.Util.Filter,Dn=Sn.cm_convolve,In=Sn.cm_combine,Rn=Sn.gaussian,Ln=r.Util.Array.typed,En=r._notSupportClamp,Mn=r.Util.GLSL,(Tn=Math).SQRT2,On=r.CONST.toRad,r.CONST.toDeg,Gn=Tn.abs,Fn=Tn.sqrt,Nn=Tn.sin,Hn=Tn.cos,Un=Tn.min,zn=Tn.max,Bn=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(r=r.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,i){var r;this._coeff=new wn([1,0]),t&&t.length&&(r=Fn(t.length)+.5|0,this.set(t,r,r,e||1,n||0)),this.mode=i||bn.RGB},path:r.Path,dimx:0,dimy:0,dimx2:0,dimy2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_doIntegralSeparable:null,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_w:null,mode:bn.RGB,dispose:function(){var t=this;return t.dimx=t.dimy=null,t.dimx2=t.dimy2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._doIntegralSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._w=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dimx:t.dimx,dimy:t.dimy,dimx2:t.dimx2,dimy2:t.dimy2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_w:t._w}},unserialize:function(t){var e=this;return e.dimx=t.dimx,e.dimy=t.dimy,e.dimx2=t.dimx2,e.dimy2=t.dimy2,e.matrix=Ln(t.matrix,wn),e.matrix2=Ln(t.matrix2,wn),e._mat=Ln(t._mat,wn),e._mat2=Ln(t._mat2,wn),e._coeff=Ln(t._coeff,wn),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=Ln(t._indices,An),e._indices2=Ln(t._indices2,An),e._indicesf=Ln(t._indicesf,An),e._indicesf2=Ln(t._indicesf2,An),e._w=t._w?[Ln(t._w[0],wn),+t._w[1],+t._w[2],+t._w[3]]:null,e},functional:function(t,e,n){return e=null==e?3:1&e?e:e+1,n?(this.set(Dl(e,1,t),e,1,1,1,1,e,Dl(1,e,t)),this._doSeparable=!0):this.set(Dl(e,e,t),e,e,1,0),this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set(Ll(e=null==e?3:1&e?e:e+1),e,e,1/(e*e),0),this._doIntegralSeparable=[Cl(e),e,1,1/e,0,Cl(e),1,e,1/e,0],this._doIntegral=t,this},gauss:function(t,e){return this.set(Rn(e=null==e?3:1&e?e:e+1,1,t),e,1,1,1,1,e,Rn(1,e,t)),this._doSeparable=!0,this},lowPass:function(t){return this.set(Ll(t=null==t?3:1&t?t:t+1),t,t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=null==e?1:e)/((t=null==t?3:1&t?t:t+1)*t);return this.set(Ll(t,e,1+e),t,t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=null==t?.5:t))},sharpen:function(t,e){return this.highPass(e,t=null==t?.5:t)},verticalBlur:function(t){return this.set(Cl(t=null==t?3:1&t?t:t+1),1,t,1/t,0),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(Cl(t=null==t?3:1&t?t:t+1),t,1,1/t,0),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,i){var r,a,l,o,s,u=t*t,c=t>>1,f=u>>1,h=new wn(u),m=new wn(u),p=1/t;u=1e-8<Gn(e)?(s=1,n/e):(s=e/n,1);o=l=r=0,a=u*t;for(;r<=c;)m[f+r]=f+l+o+.5|0,m[f-r]=f-l-o+.5|0,++r,l+=s,o+=a;r=0;for(;r<=c;)h[m[f+r]]=h[m[f-r]]=p,++r;return h[f]=i||1,h}(e=null==e?3:1&e?e:e+1,Hn(t*=On),-Nn(t),1/e),e,e,1,0)},binomialLowPass:function(t){var e=Sl(t=null==t?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,1,n,n,1,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=Sl(t);return Dn(t,t)}(t=null==t?3:1&t?t:t+1);return this.set(In(Ll(t),e,1,-1/function(t){for(var e=0,n=0,i=t.length;n<i;++n)e+=t[n];return e}(e)),t,t,1,0)},prewittX:function(t){return this.set(Al(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,Cl(t)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(Cl(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,Al(t,1)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=On,this.set(In(Rl(e=null==e?3:1&e?e:e+1,0),Rl(e,1),Hn(t),Nn(t)),e,e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(Rl(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,Rl(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(Al(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,Sl(t)),this._doSeparable=!0,this},sobelY:function(t){return this.set(Sl(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,Al(t,1)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=On,this.set(In(Il(e=null==e?3:1&e?e:e+1,0),Il(e,1),Hn(t),Nn(t)),e,e,1,0)},sobel:function(t){return this.set(Il(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,Il(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set(Ll(t=null==t?3:1&t?t:t+1,-1,t*t-1),t,t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=null==t?-.25*Tn.PI:t*On,this.set(function(t,e,n,i){var r,a,l,o,s,u=t*t,c=t>>>1,f=u>>>1,h=new wn(u);for(r=o=0;r<=c;++r,o+=e)for(l=s=a=0;l<=c;++l,a+=t,s+=n)h[f+r+a]=o+s,h[f-r-a]=-o-s,h[f-r+a]=-o+s,h[f+r-a]=o-s;return h[f]=i||1,h}(n=null==n?3:1&n?n:n+1,(e=e||1)*Hn(t),-e*Nn(t),1),n,n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,3,1,0)},bilateral:function(t,e,n){t=null==t?3:1&t?t:t+1;return this.set(Ll(t),t,t,1,0),this._w=(n=n||1,[Rn(t,t,t=e||1),-1/(2*n*n),t,n]),this},set:function(t,e,n,i,r,a,l,o){var s=this;return s._isGrad=!1,s._doIntegral=0,s._doSeparable=!1,s._doIntegralSeparable=null,s.matrix2=null,s.dimx2=s.dimy2=0,s._indices2=s._indicesf2=null,s._mat2=s._w=null,s.matrix=new wn(t),null==n&&(n=e),s.dimx=e,s.dimy=n,null==i&&(i=1,r=0),s._coeff[0]=i,s._coeff[1]=r||0,t=wl(s.matrix,s.dimx,s.dimy),s._indices=t[0],s._indicesf=t[1],s._mat=t[2],o?(s.matrix2=new wn(o),s.dimx2=a,s.dimy2=l,t=wl(s.matrix2,s.dimx2,s.dimy2),s._indices2=t[0],s._indicesf2=t[1],s._mat2=t[2]):null!=a&&(s.dimx2=a,s.dimy2=l),s._glsl=null,s},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dimx=t.dimy=t.dimx2=t.dimy2=0,t._mat=t._mat2=t._w=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t._doIntegralSeparable=null,t._glsl=null,t},getGLSL:function(){var t=this;function e(t,e,n,i,r,a,l,o,s){var u,c,f,h=[],m=[],p=[],d=t.length,g=n>>>1,n=i>>>1;for(h.push("vec4 col=texture2D(img,  pix);"),c=-g,f=-n,u=0;u<d;)t[u]&&(h.push(c||f?"vec2 p"+u+"=vec2(pix.x"+x(c,1)+"*dp.x, pix.y"+x(f,1)+"*dp.y); vec3 c"+u+"=vec3(0.0); if (0.0 <= p"+u+".x && 1.0 >= p"+u+".x && 0.0 <= p"+u+".y && 1.0 >= p"+u+".y) c"+u+"=texture2D(img,  p"+u+").rgb;":"vec3 c"+u+"=col.rgb;"),m.push(x(t[u],m.length)+"*c"+u)),++u,g<++c&&(c=-g,++f);if(e){for(d=e.length,c=-(g=r>>>1),f=-(a>>>1),u=0;u<d;)e[u]&&(h.push(c||f?"vec2 pp"+u+"=vec2(pix.x"+x(c,1)+"*dp.x, pix.y"+x(f,1)+"*dp.y); vec3 cc"+u+"=vec3(0.0); if (0.0 <= pp"+u+".x && 1.0 >= pp"+u+".x && 0.0 <= pp"+u+".y && 1.0 >= pp"+u+".y) cc"+u+"=texture2D(img,  pp"+u+").rgb;":"vec3 cc"+u+"=col.rgb;"),p.push(x(e[u],p.length)+"*cc"+u)),++u,g<++c&&(c=-g,++f);return s?(h.push("vec3 o1="+x(l)+"*("+m.join("")+");"),h.push("vec3 o2="+x(l)+"*("+p.join("")+");"),[h.join("\n"),"vec4(sqrt(o1.x*o1.x+o2.x*o2.x),sqrt(o1.y*o1.y+o2.y*o2.y),sqrt(o1.z*o1.z+o2.z*o2.z),col.a)"]):(h.push("vec3 o1="+m.join("")+";"),h.push("vec3 o2="+p.join("")+";"),[h.join("\n"),"vec4(("+x(l)+"*o1"+x(o,1)+"*o2),col.a)"])}return[h.join("\n"),"vec4(("+x(l)+"*("+m.join("")+")+vec3("+x(o)+")),col.a)"]}var n,i,r,x=Mn.formatFloat,a=t.matrix,l=t.matrix2;return(a?t._w?(n=function(t){var e,n,i,r=[],a=[],l=t*t,o=t>>>1;for(r.push("vec4 col=texture2D(img,  pix);"),r.push("float f=0.0; float w; vec3 o=vec3(0.0);"),i=n=-o,e=0;e<l;)r.push(0===n&&0===i?"vec3 c"+e+"=col.rgb;":"vec2 p"+e+"=vec2(pix.x"+x(n,1)+"*dp.x, pix.y"+x(i,1)+"*dp.y); vec3 c"+e+"=col.rgb; if (0.0 <= p"+e+".x && 1.0 >= p"+e+".x && 0.0 <= p"+e+".y && 1.0 >= p"+e+".y) c"+e+"=texture2D(img,  p"+e+").rgb;"),a.push("float wS"+e+"=wS["+e+"]; float wC"+e+"=wC(c"+e+".x-c0.x,c"+e+".y-c0.y,c"+e+".z-c0.z); w = wS"+e+"*wC"+e+"; f += w; o += w*c"+e+";"),++e,o<++n&&(n=-o,++i);return[r.join("\n")+"\n"+a.join("\n"),"vec4(o/f,col.a)"]}(t.dimx),i=new Mn.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform float wS["+t.matrix.length+"];","uniform float fC;","float wC(float r, float g, float b) {return exp(fC*(r*r+g*g+b*b));}","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).input("wS",function(t){return t._w[0]}).input("fC",function(t){return 255*t._w[1]*255}).end()):(r=t._doIntegralSeparable)?(i=new Mn.Filter(t),n=e(r[0],null,r[1],r[2],r[1],r[2],r[3],r[4],!1),i.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end(),n=e(r[5],null,r[6],r[7],r[6],r[7],r[8],r[9],!1),i.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end(),i):t._doSeparable&&l?(i=new Mn.Filter(t),n=e(a,null,t.dimx,t.dimy,t.dimx,t.dimy,t._coeff[0],0,!1),i.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).end(),n=e(l,null,t.dimx2,t.dimy2,t.dimx2,t.dimy2,t._coeff[1],0,!1),i.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n")).end(),i):(n=e(a,l,t.dimx,t.dimy,t.dimx2,t.dimy2,t._coeff[0],t._coeff[1],t._isGrad),i=new Mn.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),t._doIntegral||1).end()):new Mn.Filter(t).begin().shader(Mn.DEFAULT).end()).code()},combineWith:function(t){return t.matrix?this.matrix?this.set(Dn(this.matrix,t.matrix),this.dimx*t.dimx,this.dimy*t.dimy,this._coeff[0]*t._coeff[0]):this.set(t.matrix,t.dimx,t.dimy,t._coeff[0],t._coeff[1]):this},_apply_weighted:function(t,e,n,i,r,a){for(var l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b=t.length,w=new Cn(b),C=e-1,A=n-1,S=i>>>1,D=i*i,I=Tn.exp,R=(bn.GRAY,this.mode,0),L=0,E=0,M=0;M<b;M+=4,++R){for(e<=R&&(R=0,++L,E+=e),u=t[M],c=t[M+1],f=t[M+2],s=(o=l=-S)*e,_=g=d=p=v=0;_<D;++_,++l)S<l&&(l=-S,++o,s+=e),x=R+l<0||C<R+l||L+o<0||A<L+o?(h=u,m=c,f):(h=t[x=R+l+E+s<<2],m=t[1+x],t[2+x]),v+=y=r[_]*I(a*((y=h-u)*y+(y=m-c)*y+(y=x-f)*y)),p+=y*h,d+=y*m,g+=y*x;p/=v,d/=v,g/=v,En&&(p=p<0?0:255<p?255:p,d=d<0?0:255<d?255:d,g=g<0?0:255<g?255:g),w[M]=0|p,w[M+1]=0|d,w[M+2]=0|g,w[M+3]=t[M+3]}return w},_apply:function(t,e,N){var n=this,H=n.mode;if(!n.matrix)return t;if(n._w)return n._apply_weighted(t,e,N,n.dimx,n._w[0],n._w[1]);if(n._doIntegral)return n.matrix2?Sn.integral_convolution(H,t,e,N,2,n.matrix,n.matrix2,n.dimx,n.dimy,n.dimx2,n.dimy2,n._coeff[0],n._coeff[1],n._doIntegral):Sn.integral_convolution(H,t,e,N,2,n.matrix,null,n.dimx,n.dimy,n.dimx,n.dimy,n._coeff[0],n._coeff[1],n._doIntegral);if(n._doSeparable)return Sn.separable_convolution(H,t,e,N,2,n._mat,n._mat2,n._indices,n._indices2,n._coeff[0],n._coeff[1]);var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,U,C,A,S,z,D,I,B,R=t.length,N=R>>>2,L=new Cn(R),E=e-1,M=N-e,T=n._coeff[0],O=n._coeff[1],G=n._mat,F=n._mat2,Y=n._isGrad;if(bn.GRAY===H)if(F){for(C=n._indices.length,S=new An(n._indices),s=0;s<C;s+=2)S[s+1]*=e;for(A=G.length,z=n._indices2.length,I=new An(n._indices2),s=0;s<z;s+=2)I[s+1]*=e;for(D=F.length,c=u=0,B=zn(A,D),l=0;l<R;l+=4,++u){for(e<=u&&(u=0,c+=e),o=s=g=x=_=y=v=b=0;s<B;++s,o+=2)s<A&&(m=u+S[o],p=c+S[o+1],0<=m)&&m<=E&&0<=p&&p<=M&&(w=G[s],g+=t[d=m+p<<2]*w),s<D&&(m=u+I[o],p=c+I[o+1],0<=m)&&m<=E&&0<=p&&p<=M&&(w=F[s],y+=t[d=m+p<<2]*w);i=Y?(g=Gn(g),y=Gn(y),(h=zn(g,y))?h*(1+.43*(f=Un(g,y))/h*f/h):0):T*g+O*y,L[l]=0|(i=En?i<0?0:255<i?255:i:i),L[l+1]=0|i,L[l+2]=0|i,L[l+3]=t[l+3]}}else{for(C=n._indices.length,S=new An(n._indices),s=0;s<C;s+=2)S[s+1]*=e;for(A=G.length,l=c=u=0;l<R;l+=4,++u){for(e<=u&&(u=0,c+=e),o=s=g=x=_=0;s<A;++s,o+=2)m=u+S[o],p=c+S[o+1],m<0||E<m||p<0||M<p||(w=G[s],g+=t[d=m+p<<2]*w);i=T*g+O,L[l]=0|(i=En?i<0?0:255<i?255:i:i),L[l+1]=0|i,L[l+2]=0|i,L[l+3]=t[l+3]}}else if(F){for(C=n._indices.length,S=new An(n._indices),s=0;s<C;s+=2)S[s+1]*=e;for(A=G.length,z=n._indices2.length,I=new An(n._indices2),s=0;s<z;s+=2)I[s+1]*=e;for(D=F.length,c=u=0,B=zn(A,D),l=0;l<R;l+=4,++u){for(e<=u&&(u=0,c+=e),o=s=g=x=_=y=v=b=0;s<B;++s,o+=2)s<A&&(m=u+S[o],p=c+S[o+1],0<=m)&&m<=E&&0<=p&&p<=M&&(w=G[s],g+=t[d=m+p<<2]*w,x+=t[d+1]*w,_+=t[d+2]*w),s<D&&(m=u+I[o],p=c+I[o+1],0<=m)&&m<=E&&0<=p&&p<=M&&(U=F[s],y+=t[d=m+p<<2]*U,v+=t[d+1]*U,b+=t[d+2]*U);a=Y?(g=Gn(g),y=Gn(y),i=(h=zn(g,y))?h*(1+.43*(f=Un(g,y))/h*f/h):0,x=Gn(x),v=Gn(v),r=(h=zn(x,v))?h*(1+.43*(f=Un(x,v))/h*f/h):0,_=Gn(_),b=Gn(b),(h=zn(_,b))?h*(1+.43*(f=Un(_,b))/h*f/h):0):(i=T*g+O*y,r=T*x+O*v,T*_+O*b),En&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),L[l]=0|i,L[l+1]=0|r,L[l+2]=0|a,L[l+3]=t[l+3]}}else{for(C=n._indices.length,S=new An(n._indices),s=0;s<C;s+=2)S[s+1]*=e;for(A=G.length,l=c=u=0;l<R;l+=4,u++){for(e<=u&&(u=0,c+=e),o=s=g=x=_=0;s<A;s++,o+=2)m=u+S[o],p=c+S[o+1],m<0||E<m||p<0||M<p||(w=G[s],g+=t[d=m+p<<2]*w,x+=t[d+1]*w,_+=t[d+2]*w);i=T*g+O,r=T*x+O,a=T*_+O,En&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),L[l]=0|i,L[l+1]=0|r,L[l+2]=0|a,L[l+3]=t[l+3]}}return L}})).prototype.gradX=r.prototype.prewittX,r.prototype.gradY=r.prototype.prewittY,r.prototype.gradDirectional=r.prototype.prewittDirectional,r.prototype.grad=r.prototype.prewitt,r.prototype.bump=r.prototype.emboss,r.prototype.boxBlur=r.prototype.lowPass,r.prototype.gaussBlur=r.prototype.gauss,Pn=(Yn=w).MODE,jn=Yn.ImArray,Xn=Yn.Util.Array.copy,Wn=Yn.Util.GLSL,$n=Yn.Array8U,qn=Yn.Array32I,Vn=Math.sqrt,Kn=Yn.Util.Array.typed,Yn.Util.Filter.primitive_morphology_operator,Zn=El(3),Yn.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=Pn.RGB},path:Yn.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:Pn.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){return{_filterName:this._filterName,_dim:this._dim,_dim2:this._dim2,_iter:this._iter,_structureElement:this._structureElement,_indices:this._indices,_structureElement2:this._structureElement2,_indices2:this._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=Kn(t._structureElement,$n),e._indices=Kn(t._indices,qn),e._structureElement2=Kn(t._structureElement2,$n),e._indices2=Kn(t._indices2,qn),e._filterName=t._filterName,e._filterName&&kn[e._filterName]&&(e._filter=kn[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,i){var r=this,a=(r._dim2=0,r._structureElement2=null,r._indices2=null,r._iter=0|i||1,r._filterName=t,r._filter=kn[t],e&&e.length?(r._structureElement=new $n(e),r._dim=Vn(r._structureElement.length)+.5|0):e&&e===+e?(r._structureElement=El(e),r._dim=e):(r._structureElement=Zn,r._dim=3),n&&n.length?(r._structureElement2=new $n(n),r._dim2=Vn(r._structureElement2.length)+.5|0):n&&n===+n&&(r._structureElement2=El(n),r._dim2=n),[]),l=(e=r._structureElement).length,o=(f=r._dim)>>>1;for(s=c=u=0;s<l;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-o),a.push(c-o));if(r._indices=new qn(a),r._structureElement2){var s,u,c,f,a=[],l=(e=r._structureElement2).length,o=(f=r._dim2)>>>1;for(s=c=u=0;s<l;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-o),a.push(c-o));r._indices2=new qn(a)}return r._glsl=null,r},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t._glsl=null,t},getGLSL:function(){var e=this;function n(t,e,n,i,r){var a,l,o,s,u,c=Wn.formatFloat,f=[],h=!1,m=t.length,p=e,d=p>>>1;for(f.push("int apply=1;"),f.push("vec4 res=vec4("+i+");"),f.push("float alpha=1.0;"),o=l=a=0,r=r||"img";o<m;)s=a-d,u=l-d,t[o]&&(f.push("if (1==apply){vec2 p"+o+"=vec2(pix.x"+c(s,1)+"*dp.x, pix.y"+c(u,1)+"*dp.y); vec4 c"+o+"=vec4(0.0); if (0.0 <= p"+o+".x && 1.0 >= p"+o+".x && 0.0 <= p"+o+".y && 1.0 >= p"+o+".y) {c"+o+"=texture2D("+r+",p"+o+");} else {apply=0;} res="+n+"(res, c"+o+");"+(0==s&&0==u?" alpha=c"+o+".a;":"")+"}"),0==s)&&0==u&&(h=!0),++o,p<=++a&&(a=0,++l);return f.push("if (1==apply) {"+(h?"":"alpha = texture2D("+r+",pix).a; ")+"gl_FragColor = vec4(res.rgb,alpha);} else {gl_FragColor = texture2D("+r+",pix);}"),f.join("\n")}function t(t){i.shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {","dilate"===t?n(e._structureElement,e._dim,"max","0.0","img"):n(e._structureElement,e._dim,"min","1.0","img"),"}"].join("\n"),e._iter||1)}var i=new Wn.Filter(e);if(!e._dim)return i.begin().shader(Wn.DEFAULT).end().code();switch(e._filterName){case"dilate":i.begin(),t("dilate"),i.end();break;case"erode":i.begin(),t("erode"),i.end();break;case"open":i.begin(),t("erode"),i.end(),i.begin(),t("dilate"),i.end();break;case"close":i.begin(),t("dilate"),i.end(),i.begin(),t("erode"),i.end();break;case"gradient":i.begin(),t("dilate"),i.save("image"),i.output("dilated"),i.end(),i.begin(),t("erode"),i.input("image",null,"img"),i.end(),i.begin(),i.shader(["varying vec2 pix;","uniform sampler2D eroded;","uniform sampler2D dilated;","void main(void) {","vec4 erode = texture2D(eroded, pix);","vec4 dilate = texture2D(dilated, pix);","gl_FragColor = vec4(((dilate-erode)*0.5).rgb, erode.a);","}"].join("\n")),i.input("eroded",!0),i.input("dilated"),i.end();break;case"laplacian":i.begin(),t("dilate"),i.save("image"),i.output("dilated"),i.end(),i.begin(),t("erode"),i.input("image",null,"img"),i.end(),i.begin(),i.shader(["varying vec2 pix;","uniform sampler2D eroded;","uniform sampler2D dilated;","uniform sampler2D image;","void main(void) {","vec4 erode = texture2D(eroded, pix);","vec4 dilate = texture2D(dilated, pix);","vec4 im = texture2D(image, pix);","gl_FragColor = vec4(((dilate+erode-2.0*im)*0.5).rgb, im.a);","}"].join("\n")),i.input("eroded",!0),i.input("dilated"),i.input("image"),i.end()}return i.code()},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),Yn.Util.Filter.primitive_morphology_operator=Ml,kn={dilate:function(t,e,n,i){for(var r=null,a=new jn(e.length),l=(t._runWASM?Ml.wasm:Ml)||Ml,o=t._indices,s=o.length,u=new qn(s),c=0;c<s;c+=2)u[c]=o[c],u[c+1]=o[c+1]*n;if(t._indices2)for(s=(o=t._indices2).length,r=new qn(s),c=0;c<s;c+=2)r[c]=o[c],r[c+1]=o[c+1]*n;return l(t.mode,e,a,n,i,2,u,r,Math.max,0,t._iter)},erode:function(t,e,n,i){for(var r=null,a=new jn(e.length),l=(t._runWASM?Ml.wasm:Ml)||Ml,o=t._indices,s=o.length,u=new qn(s),c=0;c<s;c+=2)u[c]=o[c],u[c+1]=o[c+1]*n;if(t._indices2)for(s=(o=t._indices2).length,r=new qn(s),c=0;c<s;c+=2)r[c]=o[c],r[c+1]=o[c+1]*n;return l(t.mode,e,a,n,i,2,u,r,Math.min,255,t._iter)},open:function(t,e,n,i){for(var r=null,a=new jn(e.length),l=(t._runWASM?Ml.wasm:Ml)||Ml,o=t._indices,s=o.length,u=new qn(s),c=0;c<s;c+=2)u[c]=o[c],u[c+1]=o[c+1]*n;if(t._indices2)for(s=(o=t._indices2).length,r=new qn(s),c=0;c<s;c+=2)r[c]=o[c],r[c+1]=o[c+1]*n;var f=e;return e=l(t.mode,e,a,n,i,2,u,r,Math.min,255,t._iter),l(t.mode,e,f,n,i,2,u,r,Math.max,0,t._iter)},close:function(t,e,n,i){for(var r=null,a=new jn(e.length),l=(t._runWASM?Ml.wasm:Ml)||Ml,o=t._indices,s=o.length,u=new qn(coverArea2),c=0;c<s;c+=2)u[c]=o[c],u[c+1]=o[c+1]*n;if(t._indices2)for(s=(o=t._indices2).length,r=new qn(s),c=0;c<s;c+=2)r[c]=o[c],r[c+1]=o[c+1]*n;var f=e;return e=l(t.mode,e,a,n,i,2,u,r,Math.max,0,t._iter),l(t.mode,e,f,n,i,2,u,r,Math.min,255,t._iter)},gradient:function(t,e,n,i){for(var r,a=null,l=e.length,o=new jn(l),s=(t._runWASM?Ml.wasm:Ml)||Ml,u=t._indices,c=u.length,f=new qn(c),h=0;h<c;h+=2)f[h]=u[h],f[h+1]=u[h+1]*n;if(t._indices2)for(c=(u=t._indices2).length,a=new qn(c),h=0;h<c;h+=2)a[h]=u[h],a[h+1]=u[h+1]*n;for(r=Xn(e),o=s(t.mode,r,o,n,i,2,f,a,Math.max,0,t._iter),r=s(t.mode,e,r,n,i,2,f,a,Math.min,255,t._iter),h=0;h<l;h+=4)o[h]=(o[h]-r[h])/2|0,o[h+1]=(o[h+1]-r[h+1])/2|0,o[h+2]=(o[h+2]-r[h+2])/2|0;return o},laplacian:function(t,e,n,i){for(var r,a=null,l=e.length,o=new jn(l),s=new jn(l),u=(t._runWASM?Ml.wasm:Ml)||Ml,c=t._indices,f=c.length,h=new qn(f),m=0;m<f;m+=2)h[m]=c[m],h[m+1]=c[m+1]*n;if(t._indices2)for(f=(c=t._indices2).length,a=new qn(f),m=0;m<f;m+=2)a[m]=c[m],a[m+1]=c[m+1]*n;for(r=Xn(e),s=u(t.mode,r,s,n,i,2,h,a,Math.max,0,t._iter),r=Xn(e),o=u(t.mode,r,o,n,i,2,h,a,Math.min,255,t._iter),m=0;m<l;m+=4)o[m]=(o[m]+s[m]-2*e[m])/2|0,o[m+1]=(o[m+1]+s[m+1]-2*e[m+1])/2|0,o[m+2]=(o[m+2]+s[m+2]-2*e[m+2])/2|0;return o}},Qn=(y=w).MODE,ti=y.ImArray,ei=y.Array32I,ni=y.Array32U,ii=y.Util.GLSL,ri=y.Util.Array.typed,ai=Math,li=ai.min,oi=ai.max,(y=y.Create({name:"StatisticalFilter",init:function(){this.d=0,this.k=0,this._gray=!1,this._filter=null,this._indices=null,this.mode=Qn.RGB},path:y.Path,d:0,k:0,_filter:null,_indices:null,mode:Qn.RGB,dispose:function(){return this.d=null,this.k=null,this._filter=null,this._indices=null,this.$super("dispose"),this},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){return this.d=t.d,this.k=t.k,this._filter=t._filter,this._indices=ri(t._indices,ei),this},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){this.d=t=t||0,this.k=e=li(1,oi(0,e||0)),this._filter=0===e?"0th":1===e?"1th":"kth";for(var n=t*t<<1,i=t>>>1,r=new ei(n),a=0,l=0,o=0;o<n;o+=2,++a)t<=a&&(a=0,++l),r[o]=a-i,r[o+1]=l-i;return this._indices=r,this._glsl=null,this},reset:function(){return this.d=0,this.k=0,this._filter=null,this._indices=null,this._glsl=null,this},getGLSL:function(){return e=this,d=ii.formatFloat,g=ii.staticSort,n=new ii.Filter(e),(e.d?n.begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform int isColored;","void main(void) {","1th"===e._filter?t(e.d,"max","0.0"):"0th"===e._filter?t(e.d,"min","1.0"):function(t,e){for(var n,i,r=[],a=[],l=[],o=[],s="c0",u=t*t,c=t,f=c>>>1,h=0,m=0,p=0;p<u;)i=m-f,r.push("vec2 p"+p+"=vec2(pix.x"+d(n=h-f,1)+"*dp.x, pix.y"+d(i,1)+"*dp.y); vec4 c"+p+"=vec4(0.0); if (0.0 <= p"+p+".x && 1.0 >= p"+p+".x && 0.0 <= p"+p+".y && 1.0 >= p"+p+".y) c"+p+"=texture2D(img,  p"+p+"); float c"+p+"r=c"+p+".r; float c"+p+"g=c"+p+".g; float c"+p+"b=c"+p+".b;"),a.push("c"+p+"r"),l.push("c"+p+"g"),o.push("c"+p+"b"),0==n&&0==i&&(s="c"+p+".a"),++p,c<=++h&&(h=0,++m);return r.push("float t=0.0;"),r.push(g(a,"t").join("\n")),r.push("if (1==isColored) {"),r.push(g(l,"t").join("\n")),r.push(g(o,"t").join("\n")),r.push("}"),r.push("float rkth=c"+ai.round(e*(u-1))+"r;"),r.push("float gkth=rkth;"),r.push("float bkth=rkth;"),r.push("if (1==isColored) {"),r.push("gkth=c"+ai.round(e*(u-1))+"g;"),r.push("bkth=c"+ai.round(e*(u-1))+"b;"),r.push("}"),r.push("gl_FragColor = vec4(rkth,gkth,bkth,"+s+");"),r.join("\n")}(e.d,e.k),"}"].join("\n")).input("isColored",function(t){return Qn.GRAY!==t.mode?1:0}):n.begin().shader(ii.DEFAULT)).end().code();function t(t,e,n){var i,r,a,l,o,s=[],u=t*t,c=t,f=c>>>1;for(s.push("int apply=1;"),s.push("vec4 res=vec4("+n+");"),s.push("float alpha=1.0;"),a=r=i=0;a<u;)o=r-f,s.push("if (1==apply){vec2 p"+a+"=vec2(pix.x"+d(l=i-f,1)+"*dp.x, pix.y"+d(o,1)+"*dp.y); vec4 c"+a+"=vec4(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) {c"+a+"=texture2D(img,p"+a+");} else {apply=0;} res="+e+"(res, c"+a+");"+(0==l&&0==o?" alpha=c"+a+".a;":"")+"}"),++a,c<=++i&&(i=0,++r);return s.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D(img,pix);"),s.join("\n")}var e,d,g,n},_apply:function(t,e,n){return this.d?"0th"===this._filter||"1th"===this._filter?Jn["01th"](this,t,e,n):Jn[this._filter](this,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=y.prototype.minimum,y.prototype.dilate=y.prototype.maximum,Jn={"01th":function(t,e,n,i){t.d;for(var r,a,l,o,s,u,c,f,h,m,p,d,g,x=e.length,_=x>>>2,y=new ti(x),v=n-1,b=_-n,w=t._indices,C=w.length,A=new ei(C),S="0th"===t._filter?(g=li,255):(g=oi,0),D=0;D<C;D+=2)A[D]=w[D],A[D+1]=w[D+1]*n;if(Qn.GRAY===t.mode)for(l=a=r=0;r<x;r+=4,++a){for(n<=a&&(a=0,l+=n),p=S,D=0;D<C;D+=2)o=a+A[D],s=l+A[D+1],o<0||v<o||s<0||b<s||(p=g(e[u=o+s<<2],p));y[r]=p,y[r+1]=p,y[r+2]=p,y[r+3]=e[r+3]}else for(l=a=r=0;r<x;r+=4,++a){for(n<=a&&(a=0,l+=n),m=p=d=S,D=0;D<C;D+=2)o=a+A[D],s=l+A[D+1],o<0||v<o||s<0||b<s||(c=e[u=o+s<<2],f=e[u+1],h=e[u+2],m=g(c,m),p=g(f,p),d=g(h,d));y[r]=m,y[r+1]=p,y[r+2]=d,y[r+3]=e[r+3]}return y},kth:function(t,e,n,N){t.d;for(var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D=t.k,I=e.length,R=I>>>2,L=new ti(I),E=n-1,M=R-n,T=t._indices,O=T.length,R=O>>>1,G=new ei(O),F=0;F<O;F+=2)G[F]=T[F],G[F+1]=T[F+1]*n;if(Qn.GRAY===t.mode)for(g=new ti(R),w=new ni(256),a=r=i=0;i<I;i+=4,++r){for(n<=r&&(r=0,a+=n),F=y=A=0;F<O;F+=2)l=r+G[F],o=a+G[F+1],l<0||E<l||o<0||M<o||(++A,++w[c=e[s=l+o<<2]],1===w[c]&&Tl(g,y++,c));for(A*=D,S=0,m=-1,F=y;0<F;--F)S+=w[c=Ol(g,F)],m<(w[c]=0)&&A<=S&&(m=c);L[i]=m,L[i+1]=m,L[i+2]=m,L[i+3]=e[i+3]}else for(d=new ti(R),g=new ti(R),x=new ti(R),b=new ni(256),w=new ni(256),C=new ni(256),a=r=i=0;i<I;i+=4,++r){for(n<=r&&(r=0,a+=n),F=_=y=v=A=0;F<O;F+=2)l=r+G[F],o=a+G[F+1],l<0||E<l||o<0||M<o||(u=e[s=l+o<<2],c=e[s+1],f=e[s+2],++b[u],++w[c],++C[f],++A,1===b[u]&&Tl(d,_++,u),1===w[c]&&Tl(g,y++,c),1===C[f]&&Tl(x,v++,f));for(A*=D,S=0,h=-1,F=_;0<F;--F)S+=b[u=Ol(d,F)],h<(b[u]=0)&&A<=S&&(h=u);for(S=0,m=-1,F=y;0<F;--F)S+=w[c=Ol(g,F)],m<(w[c]=0)&&A<=S&&(m=c);for(S=0,p=-1,F=v;0<F;--F)S+=C[f=Ol(x,F)],p<(C[f]=0)&&A<=S&&(p=f);L[i]=h,L[i+1]=m,L[i+2]=p,L[i+3]=e[i+3]}return L}},ui=(si=w).Util.GLSL,ci=Object.prototype.hasOwnProperty,si.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:si.Path,_filter:null,_params:null,_changed:!1,dispose:function(){return this._filter=null,this._params=null,this._changed=null,this.$super("dispose"),this},serialize:function(){var t={_filter:!1!==this._filter&&(this._changed&&this._filter?(this._filter.filter||this._filter).toString():null),_params:this._params};return this._changed=!1,t},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(si)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)ci.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},getParam:function(t){if(t&&ci.call(this._params,t))return this._params[t]},setParam:function(t,e){return t&&ci.call(this._params,t)&&(this._params[t]=e),this},set:function(t,e){return!1===t?(this._filter=!1,this._changed=!0,this._glsl=null):(!t||"function"!=typeof t&&"function"!=typeof t.filter||(this._filter=t,this._changed=!0,this._glsl=null),e&&this.params(e)),this},isGLSL:function(){return this._isGLSL&&!(this._filter&&!this._filter.shader)},getGLSL:function(){var e,t=this._filter;return(t&&t.shader?(e=new ui.Filter(this).begin().shader(t.shader),t.inputs&&t.inputs.forEach(function(t){t.name&&e.input(t.name,t.setter,t.iname)}),e):new ui.Filter(this).begin().shader(t?null:ui.DEFAULT)).end().code()},_apply:function(t,e,n,i){var r=this._filter;return r?(r="function"==typeof r.filter?r.filter:r)(this._params,t,e,n,i,this):t},canRun:function(){return this._isOn&&this._filter}}),si.CustomFilter=si.InlineFilter,hi=(fi=w).MODE,mi=fi.Array32F,pi=fi.Util.Filter.fft2d,di=fi.Util.Filter.ifft2d,fi.Create({name:"FrequencyFilter",init:function(t,e,n){this.set(t,e,n)},path:fi.Path,_filterE:null,_filterG:null,_filterB:null,_changed:!1,dispose:function(){return this._filterR=null,this._filterG=null,this._filterB=null,this._changed=null,this.$super("dispose"),this},serialize:function(){var t=this,e={_filterR:!1!==t._filterR&&(t._changed&&t._filterR?t._filterR.toString():null),_filterG:!1!==t._filterG&&(t._changed&&t._filterG?t._filterG.toString():null),_filterB:!1!==t._filterB&&(t._changed&&t._filterB?t._filterB.toString():null)};return t._changed=!1,e},unserialize:function(t){return null!=t._filterR&&(this._filterR=!1===t._filterR?null:new Function("FILTER",'"use strict"; return '+t._filterR+";")(fi)),null!=t._filterG&&(this._filterG=!1===t._filterG?null:new Function("FILTER",'"use strict"; return '+t._filterG+";")(fi)),null!=t._filterB&&(this._filterB=!1===t._filterB?null:new Function("FILTER",'"use strict"; return '+t._filterB+";")(fi)),this},set:function(t,e,n){return!1===t?(this._filterR=!1,this._changed=!0):t&&"function"==typeof t&&(this._filterR=t,this._changed=!0),!1===e?this._filterG=!1:e&&"function"==typeof e&&(this._filterG=e),!1===n?this._filterG=!1:n&&"function"==typeof n&&(this._filterB=n),this},_apply:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m,p,d=hi.GRAY===this.mode,g=this._filterR,x=this._filterG,_=this._filterB,y=e*n,v=t.length;if(g||x||_){for(g&&(i=new mi(y),l=new mi(y)),x&&!d&&(r=new mi(y),o=new mi(y)),_&&!d&&(a=new mi(y),s=new mi(y)),m=h=0;h<v;h+=4,++m)g&&(i[m]=t[h]/255),x&&!d&&(r[m]=t[h+1]/255),_&&!d&&(a[m]=t[h+2]/255);if(g&&(u=Fl(pi(i,l,e,n),g,e,n),u=di(u.r,u.i,e,n).r),x&&!d&&(c=Fl(pi(r,o,e,n),x,e,n),c=di(c.r,c.i,e,n).r),_&&!d&&(f=Fl(pi(a,s,e,n),_,e,n),f=di(f.r,f.i,e,n).r),d)for(u=u||c||f,m=h=0;h<v;h+=4,++m)p=255*u[m]|0,t[h]=p,t[h+1]=p,t[h+2]=p;else for(m=h=0;h<v;h+=4,++m)u&&(p=255*u[m]|0,t[h]=p),c&&(p=255*c[m]|0,t[h+1]=p),f&&(p=255*f[m]|0,t[h+2]=p)}return t},canRun:function(){return this._isOn&&(this._filterR||this._filterG||this._filterB)}}),fi.FourierFilter=fi.FrequencyFilter,gi=w._notSupportClamp,(xi=w.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:w.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var i,r,a,l,o,s,u,c,f=xi.random,h=this.max-this.min,m=this.min,p=t.length;if(gi)for(i=0;i<p;i+=4)a=t[i],l=t[i+1],o=t[i+2],(s=a+(r=h*f()+m))<0?s=0:255<s&&(s=255),(u=l+r)<0?u=0:255<u&&(u=255),(c=o+r)<0?c=0:255<c&&(c=255),t[i]=0|s,t[i+1]=0|u,t[i+2]=0|c;else for(i=0;i<p;i+=4)a=t[i],l=t[i+1],o=t[i+2],u=l+(r=h*f()+m),c=o+r,t[i]=0|(s=a+r),t[i+1]=0|u,t[i+2]=0|c;return t}})).random=Math.random,_i=(v=w).MODE,v.Create({name:"PerlinNoiseFilter",mode:_i.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:v.Path,init:function(t,e,n,i,r,a,l,o){this.mode=_i.GRAY,this._baseX=t||1,this._baseY=e||1,this._seed=l||0,this._stitch=!!i,this._fractal=!1!==r,this._perlin=!!o,this.octaves(n||1,a)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){for(this._octaves=t||1,this._offsets=e?e.slice(0):[];this._offsets.length<this._octaves;)this._offsets.push([0,0]);return this},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?_i.COLOR:_i.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){return{_baseX:this._baseX,_baseY:this._baseY,_octaves:this._octaves,_offsets:this._offsets,_seed:this._seed||0,_stitch:this._stitch,_fractal:this._fractal,_perlin:this._perlin}},unserialize:function(t){return this._baseX=t._baseX,this._baseY=t._baseY,this._octaves=t._octaves,this._offsets=t._offsets,this._seed=t._seed||0,this._stitch=t._stitch,this._fractal=t._fractal,this._perlin=t._perlin,this},apply:function(t,e,n){var i=this;return i._seed&&(Pl.seed(i._seed),i._seed=0),Pl(t,e,n,i._stitch,_i.COLOR!==i.mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)}}),b=Math,yi=b.floor,b.sin,b.cos,v.CONST.PI2,b=v.Array8U,vi=new b([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),bi=new b(vi),Pl.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=yi(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?vi[n]^255&t:vi[n]^t>>8&255,bi[n]=bi[n+256]=e},t=Math,wi=t.min,Ci=t.floor,Ai=w.Util.GLSL,Di=w.MODE,w.Create({name:"ChannelCopyFilter",srcChannel:(Si=w.CHANNEL).R,dstChannel:Si.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:w.Path,init:function(t,e,n,i,r){this.srcChannel=t||Si.R,this.dstChannel=e||Si.R,this.centerX=n||0,this.centerY=i||0,this.color=r||0},dispose:function(){return this.srcChannel=null,this.dstChannel=null,this.centerX=null,this.centerY=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{srcChannel:this.srcChannel,dstChannel:this.dstChannel,centerX:this.centerX,centerY:this.centerY,color:this.color}},unserialize:function(t){return this.srcChannel=t.srcChannel,this.dstChannel=t.dstChannel,this.centerX=t.centerX,this.centerY=t.centerY,this.color=t.color,this},getGLSL:function(){return((t=this).input("source")?new Ai.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D src;","uniform vec2 srcSize;","uniform vec2 center;","uniform vec4 color;","uniform int sC;","uniform int tC;","#define COLOR32 "+Di.COLOR32,"#define COLOR8 "+Di.COLOR8,"#define MASK32 "+Di.COLORMASK32,"#define MASK8 "+Di.COLORMASK8,"#define RED "+Si.R,"#define GREEN "+Si.G,"#define BLUE "+Si.B,"#define ALPHA "+Si.A,"uniform int mode;","float get_channel(vec4 col, int channel) {","   if (ALPHA == channel) return col.a;","   if (BLUE == channel) return col.b;","   if (GREEN == channel) return col.g;","   if (RED == channel) return col.r;","   return 0.0;","}","vec4 set_channel(vec4 col, float val, int channel) {","   vec4 ret = vec4(col.r, col.g, col.b, col.a);","   if (ALPHA == channel) ret.a = val;","   else if (BLUE == channel) ret.b = val;","   else if (GREEN == channel) ret.g = val;","   else if (RED == channel) ret.r = val;","   return ret;","}","void main(void) {","   vec4 tCol = texture2D(img, pix);","   vec2 p = (pix - (center - 0.5*srcSize))/srcSize;","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (MASK32 == mode) {tCol *= color;}","       else if (COLOR32 == mode) {tCol = color;}","       else if (MASK8 == mode) {","           if (ALPHA == tC) tCol.a *= color.a;","           else if (BLUE == tC) tCol.b *= color.b;","           else if (GREEN == tC) tCol.g *= color.g;","           else tCol.r *= color.r;","       }","       else if (COLOR8 == mode) {","           if (ALPHA == tC) tCol.a = color.a;","           else if (BLUE == tC) tCol.b = color.b;","           else if (GREEN == tC) tCol.g = color.g;","           else tCol.r = color.r;","       }","   } else {","       vec4 sCol = texture2D(src, p);","       tCol = set_channel(tCol, get_channel(sCol, sC), tC);","   }","   gl_FragColor = tCol;","}"].join("\n")).input("src",function(t){t=t.input("source");return{data:t[0],width:t[1],height:t[2]}}).input("srcSize",function(t,e,n){t=t.input("source");return[t[1]/e,t[2]/n]}).input("center",function(t){return[t.centerX,t.centerY]}).input("sC",function(t){return t.srcChannel}).input("tC",function(t){return t.dstChannel}).input("color",function(t){var e=t.color||0;return Di.COLOR8===t.mode||Di.MASK8===t.mode?[e=(255&e)/255,e,e,e]:[(e>>>16&255)/255,(e>>>8&255)/255,(255&e)/255,(e>>>24&255)/255]}):new Ai.Filter(t).begin().shader(Ai.DEFAULT)).end().code();var t},apply:function(t,e,n){var i=this.input("source");if(i){var r,a,l,o,s,u,c,f,h,m=i[0],p=i[1],d=i[2],g=t.length,x=(m.length,this.srcChannel),_=this.dstChannel,y=this.centerX||0,v=this.centerY||0,i=p>>>1,b=d>>>1,w=(wi(e,p),wi(n,d),this.color||0),C=this.mode,A=Di.COLOR32,S=Di.COLOR8,D=Di.COLORMASK32,I=Di.COLORMASK8;for(A===C||D===C?(h=w>>>24&255,u=w>>>16&255,c=w>>>8&255,f=255&w):S!==C&&I!==C||(w&=255),y=Ci(y*(e-1))-i,v=Ci(v*(n-1))-b,r=l=a=0;r<g;r+=4,++a)e<=a&&(a=0,++l),s=l-v,(o=a-y)<0||p<=o||s<0||d<=s?A===C?(t[r]=u,t[r+1]=c,t[r+2]=f,t[r+3]=h):D===C?(t[r]=u&t[r],t[r+1]=c&t[r+1],t[r+2]=f&t[r+2],t[r+3]=h&t[r+3]):S===C?t[r+_]=w:I===C&&(t[r+_]=w&t[r+x]):t[r+_]=m[(o+s*p<<2)+x]}return t}}),Ii=w,e=Math,Ri=Ii.Util.Math.hypot,Li=e.sqrt,e.abs,Ei=e.min,Mi=e.max,Ti=e.floor,Oi=e.ceil,Gi=Ii.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:Ii.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},getGLSL:function(){return t=this,e=Ii.Util.GLSL,(t.scale<=1||!t.pattern||!Gi[t.pattern]?new e.Filter(t).begin().shader(e.DEFAULT).end():new e.Filter(t).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 imgSize;","uniform float tileSize;","uniform int pixelate;",Gi.rectangular_glsl,Gi.triangular_glsl,Gi.rhomboidal_glsl,Gi.hexagonal_glsl,"void main(void) {","vec2 p = pix;","if (1 == pixelate) p = triangular(p, imgSize, tileSize);","else if (2 == pixelate) p = rhomboidal(p, imgSize, tileSize);","else if (3 == pixelate) p = hexagonal(p, imgSize, tileSize);","else p = rectangular(p, imgSize, tileSize);","gl_FragColor = vec4(texture2D(img, p).rgb, texture2D(img, pix).a);","}"].join("\n")).input("imgSize",function(t,e,n){return[e,n]}).input("tileSize",function(t,e,n){return Li(e*n)*(t.scale||1)*.01}).input("pixelate",function(t){return"triangular"===t.pattern?1:"rhomboidal"===t.pattern?2:"hexagonal"===t.pattern?3:0}).end()).code();var t,e},apply:function(t,e,n){var i=this.pattern;return this.scale<=1||!i||!Gi[i]?t:(100<this.scale&&(this.scale=100),Gi[i](t,e,n,this.scale))}}).PATTERN={rectangular:function(t,e,n,i){for(var r,a,l,o,s,u,c=t.length,f=c>>>2,h=e-1,m=f-e,p=new Ii.ImArray(c),d=Li(f)*i*.01|0,g=.5*d|0,x=g*e,_=r=a=l=o=0,y=0;y<c;y+=4)u=r-o,s=Mi(0,Ei(h,_-a+g)),u=Mi(0,Ei(m,u+x)),p[y]=t[s=s+u<<2],p[y+1]=t[1+s],p[y+2]=t[2+s],p[y+3]=t[y+3],++a,e<=++_&&(_=a=0,o+=e,r+=e,d<=++l)&&(o=l=0),d<=a&&(a=0);return p},triangular:function(t,e,n,i){for(var r,a,l,o,s,u,c=t.length,f=c>>>2,h=e-1,m=f-e,p=new Ii.ImArray(c),d=Li(f)*i*.0125|0,g=.333*d|0,x=.666*d|0,_=(.5*d|0)*e,y=r=a=l=o=0,v=0;v<c;v+=4)s=y-a,u=r-o,s=d<a+l?Mi(0,Ei(h,s+x))+Mi(0,Ei(m,u+_))<<2:Mi(0,Ei(h,s+g))+Mi(0,Ei(m,u+_))<<2,p[v]=t[s],p[v+1]=t[s+1],p[v+2]=t[s+2],p[v+3]=t[v+3],++a,e<=++y&&(y=a=0,o+=e,r+=e,d<=++l)&&(o=l=0),d<=a&&(a=0);return p},rhomboidal:function(t,e,n,i){for(var r,a,l,o,s,u,c,f=t.length,h=f>>>2,m=e-1,p=h-e,d=new Ii.ImArray(f),g=Li(h)*i*.007|0,x=2*g,_=g*e,y=r=a=l=o=0,v=0,b=0;b<f;b+=4)c=v?x<a+l?(s=Ei(m,y-a+g),r-o):g<a+g-l?(s=y-a,Mi(0,r-o-_)):(s=Mi(0,y-a-g),r-o):x<a+g-l?(s=Ei(m,y-a+g),Mi(0,r-o-_)):g<a+l?(s=y-a,r-o):(s=Mi(0,y-a-g),Mi(0,r-o-_)),u=Mi(0,Ei(m,s+g)),c=Mi(0,Ei(p,c+_)),d[b]=t[u=u+c<<2],d[b+1]=t[1+u],d[b+2]=t[2+u],d[b+3]=t[b+3],++a,e<=++y&&(y=a=0,o+=e,r+=e,g<=++l)&&(o=l=0,v=1-v),x<=a&&(a=0);return d},hexagonal:function(t,e,n,i){var r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A=t.length,S=A>>>2,D=e-1,I=S-e,R=new Ii.ImArray(A);for(i=Li(S)*i*.01,r=a=l=0;r<A;r+=4)_=a/i,y=l/i,f=Ti(_-=.5*(y/=.866025404)),c=Ti(y),u=Oi(_),h=Oi(y),s=_+y-f-c<1?(o=f,c):(o=u,h),C=1-(v=u=u)-(b=c=c),d=1-(m=f=f)-(p=h=h),y=Ri((g=_)-o,(x=y)-s,(_=1-_-y)-(1-o-s)),v=Ri(g-v,x-b,_-C),b=Ri(g-m,x-p,_-d),C=y<v?y<b?(w=o,s):(w=f,h):v<b?(w=u,c):(w=f,h),w+=.5*C,C=.866025404*C*i,g=Mi(0,Ei(D,0|(w*=i)))+Mi(0,Ei(I,(0|C)*e))<<2,R[r]=t[g],R[r+1]=t[1+g],R[r+2]=t[2+g],R[r+3]=t[r+3],e<=++a&&(a=0,++l);return R},rectangular_glsl:["vec2 rectangular(vec2 p, vec2 imgsize, float tilesize) {","    return clamp((tilesize*floor(imgsize * p / tilesize) + 0.5*tilesize)/imgsize, 0.0, 1.0);","}"].join("\n"),triangular_glsl:["vec2 triangular(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 1.25;","   vec2 tile = tilesize*floor(imgsize * p / tilesize);","   vec2 t = mod(imgsize * p, tilesize);","   if (t.x+t.y > tilesize) return clamp((tile + vec2(0.66*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","   else return clamp((tile + vec2(0.33*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),rhomboidal_glsl:["vec2 rhomboidal(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 0.7;","   vec2 xy = imgsize * p;","   vec2 xyi = floor(xy / tilesize);","   vec2 tile = tilesize*xyi;","   vec2 s = vec2(mod(xy.x, 2.0*tilesize), mod(xy.y, tilesize));","   vec2 a;","   if (0.0 < mod(xyi.y, 2.0)) {","       if (s.x+s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y);","       } else if (s.x+tilesize-s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y-tilesize);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y);","       }","   } else {","       if (s.x+tilesize-s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y-tilesize);","       } else if (s.x+s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y-tilesize);","       }","   }","   a = vec2(clamp(a.x, 0.0, imgsize.x), clamp(a.y, 0.0, imgsize.y));","   return clamp((a + vec2(tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),hexagonal_glsl:["vec2 hexagonal(vec2 p, vec2 imgsize, float tilesize) {","    vec2 t = imgsize * p / tilesize;","    t.y /= 0.866025404;","    t.x -= t.y * 0.5;","    vec2 it = vec2(floor(t.x), floor(t.y));","    vec2 ct = vec2(ceil(t.x), ceil(t.y));","    vec2 a;","    if (t.x + t.y - it.x - it.y < 1.0) a = it;","    else a = ct;","    vec2 b = vec2(ct.x, it.y);","    vec2 c = vec2(it.x, ct.y);","    vec3 T = vec3(t.x, t.y, 1.0 - t.x - t.y);","    vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);","    vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);","    vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);","    float alen = length(T - A);","    float blen = length(T - B);","    float clen = length(T - C);","    vec2 ch;","    if (alen < blen) {","        if (alen < clen) ch = a;","        else ch = c;","    } else {","        if (blen < clen) ch = b;","        else ch = c;","    }","    ch.x += ch.y * 0.5;","    ch.y *= 0.866025404;","    ch *= tilesize / imgsize;","    return clamp(ch, 0.0, 1.0);","}"].join("\n")},Fi=w.MODE,Ni=w.Array32F,Hi=w.Color.clamp,Ui=w.Color.intensity,w.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:Fi.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=Hi(null==e?.4:e,0,1),this.mode=n||Fi.GRAY},path:w.Path,threshold:function(t){return this.thresh=Hi(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v=t.length,b=new Ni(3*(v>>>2)),w=this.size,C=1/(w*w),A=255*this.thresh,S=Fi.RGB===this.mode,D=w*e,I=0,R=0,L=0;I<n;){if(s=u=c=0,S){for(o=l=a=0;l<w;)s+=t[i=L+R+a+o<<2]+b[r=3*(L+R+a+o)],u+=t[i+1]+b[r+1],c+=t[i+2]+b[r+2],++a>=w&&(a=0,++l,o+=e);m=A<Ui(s*=C,u*=C,c*=C)?(f=0|s,h=0|u,0|c):h=f=0}else{for(o=l=a=0;l<w;)s+=t[i=L+R+a+o<<2]+b[r=3*(L+R+a+o)],++a>=w&&(a=0,++l,o+=e);m=h=f=A<s*C?255:0}if(p=t[i=L+R<<2]-f,d=t[i+1]-h,g=t[i+2]-m,L+w<e)for(x=7/16*p,_=7/16*d,y=7/16*g,a=w,o=l=0;l<w;)b[r=3*(L+R+a+o)]+=x,b[r+1]+=_,b[r+2]+=y,0<=++a&&(a=w,++l,o+=e);if(I+w<n&&w<L)for(x=3/16*p,_=3/16*d,y=3/16*g,a=-w,l=w,o=0;l<0;)b[r=3*(L+R+a+o)]+=x,b[r+1]+=_,b[r+2]+=y,0<=++a&&(a=-w,++l,o+=e);if(I+w<n)for(x=5/16*p,_=5/16*d,y=5/16*g,l=w,o=a=0;l<0;)b[r=3*(L+R+a+o)]+=x,b[r+1]+=_,b[r+2]+=y,++a>=w&&(a=0,++l,o+=e);if(I+w<n&&L+w<e)for(x=1/16*p,_=1/16*d,y=1/16*g,l=a=w,o=0;l<0;)b[r=3*(L+R+a+o)]+=x,b[r+1]+=_,b[r+2]+=y,0<=++a&&(a=w,++l,o+=e);for(o=l=a=0;l<w;)t[i=L+R+a+o<<2]=f,t[i+1]=h,t[i+2]=m,++a>=w&&(a=0,++l,o+=e);e<=(L+=w)&&(L=0,I+=w,R+=D)}return t}}),(zi=Math).sqrt,zi.exp,Bi=zi.log,Yi=zi.abs,ki=zi.floor,Pi=w._notSupportClamp,ji=w.Array32F,w.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,i){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==i?10:i},path:w.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C=t.length,A=this.centerX||0,S=this.centerY||0,D=this.radius,I=this.amount;if(!(I<=0)){for(0,w=(i=C>>>2)-e,A=ki(A*(b=e-1)),S=ki(S*(n-1)),s=(e<<1)+e,r=new ji((i<<1)+i),f=a=l=o=f=c=u=0;f<e;++f,u+=4,c+=3)a+=t[u],l+=t[u+1],o+=t[u+2],r[c]=a,r[c+1]=l,r[c+2]=o;for(a=l=o=f=c=0,u=u=s+e;u<C;u+=4,c+=3,++f)e<=f&&(a=l=o=f=0),a+=t[u],l+=t[u+1],o+=t[u+2],r[c+s]=r[c]+a,r[c+s+1]=r[c+1]+l,r[c+s+2]=r[c+2]+o;for(u=m=h=f=0;u<C;u+=4,++f)e<=f&&(f=0,++h,m+=e),v=Yi(f-A),_=Yi(h-S),d=zi.max(v,_),v=zi.min(v,_),0<(v=D<(_=d?d*(1+.43*v/d*v/d):0)?0|Bi((_-D)*I):_/D+.5|0)&&(d=f+v,g=m+(_=v*e),(p=f-v)<0?p=0:b<d&&(d=b),(_=m-_)<0?_=0:w<g&&(g=w),_=(v=.25/(v*v))*(r[x=((x=d+g)<<1)+x]-r[d=((d=d+_)<<1)+d]-r[g=((g=p+g)<<1)+g]+r[p=((p=p+_)<<1)+p]),y=v*(r[x+1]-r[d+1]-r[g+1]+r[p+1]),v=v*(r[x+2]-r[d+2]-r[g+2]+r[p+2]),Pi&&(_=_<0?0:255<_?255:_,y=y<0?0:255<y?255:y,v=v<0?0:255<v?255:v),t[u]=0|_,t[u+1]=0|y,t[u+2]=0|v)}}return t}}),Xi=(n=w).MODE,Wi=new n.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),$i=Math,qi=n.ImArray,Vi=n.Util.Filter,Ki=n.Util.Image,Zi=n.Util.GLSL,n.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:n.Path,init:function(t,e,n,i,r,a,l){this.offsetX=t||0,this.offsetY=e||0,this.color=n||0,this.opacity=null==i?1:+i,this.quality=0|(r||1),this.pad=null==a||!!a,this.onlyShadow=!!l},dispose:function(){return this.offsetX=null,this.offsetY=null,this.color=null,this.opacity=null,this.quality=null,this.pad=null,this.onlyShadow=null,this.$super("dispose"),this},serialize:function(){return{offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,opacity:this.opacity,quality:this.quality,pad:this.pad,onlyShadow:this.onlyShadow}},unserialize:function(t){return this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.color=t.color,this.opacity=t.opacity,this.quality=t.quality,this.pad=t.pad,this.onlyShadow=t.onlyShadow,this},getGLSL:function(){return n=this,t=function(t,e,n,i,r){var a,l,o,s=[],u=[],c=t.length,f=e>>>1,e=n>>>1,h=Zi.formatFloat;for(s.push("vec4 col=texture2D(img,  pix);"),l=-f,o=-e,a=0;a<c;)t[a]&&(s.push(l||o?"vec2 p"+a+"=vec2(pix.x"+h(l,1)+"*dp.x, pix.y"+h(o,1)+"*dp.y); vec3 c"+a+"=vec3(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) c"+a+"=texture2D(img,  p"+a+").rgb;":"vec3 c"+a+"=col.rgb;"),u.push(h(t[a],u.length)+"*c"+a)),++a,f<++l&&(l=-f,++o);return[s.join("\n"),"vec4(("+h(i||1)+"*("+u.join("")+")+vec3("+h(r||0)+")),col.a)"]}(Wi,3,3,1,0),new Zi.Filter(n).begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 wh;","uniform vec2 nwh;","uniform float pad_right;","uniform float pad_bot;","uniform float pad_left;","uniform float pad_top;",Ki.glsl().pad,"void main(void) {","    gl_FragColor = pad(pix, img, wh, nwh, pad_right, pad_bot, pad_left, pad_top);","}"].join("\n"),function(){return n.pad?1:0}).dimensions(function(t,e){return[t+$i.abs(n.offsetX||0),e+$i.abs(n.offsetY||0)]}).input("wh",function(t,e,n,i,r){return[i,r]}).input("nwh",function(t,e,n,i,r){return[e,n]}).input("pad_right",function(t){return 0<(t.offsetX||0)&&t.offsetX||0}).input("pad_bot",function(t){return 0<(t.offsetY||0)&&t.offsetY||0}).input("pad_left",function(t){return(t.offsetX||0)<0?-(t.offsetX||0):0}).input("pad_top",function(t){return(t.offsetY||0)<0?-(t.offsetY||0):0}).end().begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec4 c;","void main(void) {","   vec4 im = texture2D(img, pix);","   gl_FragColor = im.a > 0.0 ? vec4(c.rgb, c.a*im.a) : vec4(0.0);","}"].join("\n")).save("image").input("c",function(t){var e=t.color||0;return[(e>>>16&255)/255,(e>>>8&255)/255,(255&e)/255,$i.min($i.max(t.opacity,0),1)]}).end().begin().shader(["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",t[0],"gl_FragColor = "+t[1]+";","}"].join("\n"),function(){return $i.min($i.max(n.quality,1),3)}).end().begin().shader(["varying vec2 pix;","uniform vec2 offset;","uniform int onlyShadow;","uniform sampler2D shadow;","uniform sampler2D image;","void main(void) {","   vec2 pixo = pix - offset;","   vec4 sh = pixo.x < 0.0 || pixo.y < 0.0 ? vec4(0.0) : texture2D(shadow, pixo);","   vec4 im = onlyShadow ? vec4(0.0) : texture2D(image, pix);","   if (1 == onlyShadow)","   {","       gl_FragColor = sh;","   }","   else","   {","       if ((1.0 == im.a) || (0.0 == sh.a)) gl_FragColor = im;","       else gl_FragColor = vec4(mix(im.rgb, sh.rgb, sh.a), im.a);","   }","}"].join("\n")).input("offset",function(t,e,n){return[(t.offsetX||0)/e,(t.offsetY||0)/n]}).input("onlyShadow",function(t){return t.onlyShadow?1:0}).input("shadow",!0).input("image").end().code();var n,t},apply:function(t,e,n){var i=this;if(i.hasMeta=!1,i._isOn){var r,a,l,o,s,u,c,f=$i.max,h=i.color||0,m=i.opacity,p=i.quality,d=i.pad,g=i.onlyShadow,x=i.offsetX||0,_=i.offsetY||0,y=t.length,v=y>>>2,b=y,w=e;if(0!==(m=1<(m=m<0?0:m)?1:m)){r=h>>>16&255,a=h>>>8&255,l=255&h,3<(p=p<=0?1:p)&&(p=3);for(var C,A,S=new qi(b),D=0,I=0,R=0,L=0,E=0;R<b;R+=4,++L)w<=L&&(L=0,++E),0<(c=t[R+3])?(S[R]=r,S[R+1]=a,S[R+2]=l,S[R+3]=m*c|0,D=f(D,L),I=f(I,E)):(S[R]=0,S[R+1]=0,S[R+2]=0,S[R+3]=0);if(S=Vi.integral_convolution(r===a&&a===l?Xi.GRAY:Xi.RGB,S,e,n,2,Wi,null,3,3,1,0,p),D+=x,I+=_,d&&(e<=D||D<0||n<=I||I<0)?(h=D<0?-D:0,p=e<=D?D-e:0,C=I<0?-I:0,A=n<=I?I-n:0,t=g?new qi((e+h+p)*(n+C+A)<<2):Ki.pad(t,e,n,p,A,h,C),y=(v=(e+=h+p)*(n+=C+A))<<2,i.hasMeta=!0,i.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}):d&&g&&(t=new qi(y)),_*=e,g)for(u=E=L=0;u<b;u+=4,++L)w<=L&&(L=0,E+=e),s=E+_,(o=L+x)<0||e<=o||s<0||v<=s||(t[R=o+s<<2]=S[u],t[R+1]=S[u+1],t[R+2]=S[u+2],t[R+3]=S[u+3]);else for(u=E=L=0;u<b;u+=4,++L)w<=L&&(L=0,E+=e),s=E+_,(o=L+x)<0||e<=o||s<0||v<=s||(c=t[(R=o+s<<2)+3],m=S[u+3],255!==c&&0!==m&&(r=t[R]+(S[u]-t[R])*(m/=255),a=t[R+1]+(S[u+1]-t[R+1])*m,l=t[R+2]+(S[u+2]-t[R+2])*m,t[R]=0|r,t[R+1]=0|a,t[R+2]=0|l))}}return t}}),Ji=w,Qi=Math,tr=Ji.Util.GLSL,er=Ji.Util.Image,Ji.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:Ji.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},getGLSL:function(){return t=this,new tr.Filter(t).begin().shader(["varying vec2 pix;","uniform vec2 wh;","uniform float NN;","uniform int masktype;","uniform sampler2D img;","/*uniform sampler2D diagonal;*/","vec4 mask(vec2 pix, vec2 wh, float NN, int masktype) {","   vec2 ij = vec2(pix.x, pix.y);","   float d = 0.0;","   if (ij.x > 0.5) ij.x = 1.0 - ij.x;","   if (ij.y > 0.5) ij.y = 1.0 - ij.y;","   if (0 == masktype) //RADIAL","   {","       d = 1.0 - length(wh*(vec2(0.5) - ij)) * 2.0 / NN;","   }","   else if (1 == masktype) //LINEAR 1","   {","       d = 1.0 - (ij.y < ij.x ? (0.5 - ij.y) : (0.5 - ij.x)) * 2.0;","   }","   else //if (2 == masktype) //LINEAR 2","   {","       d = 1.0 - (/*ij.y < ij.x ? length(wh*(vec2(1.0) - ij)) :*/ length(wh*(vec2(1.0) - ij))) / (1.13*NN);","   }","   return vec4(clamp(d, 0.003921569/*1/255*/, 1.0));","}","void main(void) {","   vec4 im = texture2D(img, pix);","   vec2 pixd = pix - vec2(0.5);","   if (pixd.x < 0.0) pixd.x += 1.0;","   if (pixd.y < 0.0) pixd.y += 1.0;","   vec2 pixm = pix + vec2(0.5);","   if (pixm.x > 1.0) pixm.x -= 1.0;","   if (pixm.y > 1.0) pixm.y -= 1.0;","   float a1 = mask(pix, wh, NN, masktype).a;","   float a2 = mask(pixm, wh, NN, masktype).a;","   gl_FragColor = vec4(mix(im.rgb, /*texture2D(diagonal, pix)*/texture2D(img, pixd).rgb, a2/(a1+a2)), im.a);","}"].join("\n")).input("wh",function(t,e,n){return[e,n]}).input("NN",function(t,e,n){return Qi.sqrt(e*n)}).input("masktype",function(t){return t.type}).end().code();var t},apply:function(t,e,n){(this._runWASM&&er.wasm||er).interpolate;for(var i,r,a,l,o,s=Qi.round(e/2),u=Qi.round(n/2),c=t.length,f=new Ji.ImArray(c),h=function(t,e,n,i,r){var a,l,o,s,u=e*n,c=new Ji.Array8U(u),f=Ji.Util.Math.hypot;if(0===t)for(s=Qi.sqrt(i*r),l=a=0;a<i;++l)r<=l&&(l=0,++a),o=~~((o=255-255/s*f(i-a,r-l))<1?1:255<o?255:o),c[a+l*e]=o,c[a+(n-1-l)*e]=o,c[e-1-a+l*e]=o,c[e-1-a+(n-1-l)*e]=o;else if(1===t)for(l=a=0;a<i;++l)r<=l&&(l=0,++a),o=~~((o=255-255*(l<a?(r-l)/r:(i-a)/i))<1?1:255<o?255:o),c[a+l*e]=o,c[a+(n-1-l)*e]=o,c[e-1-a+l*e]=o,c[e-1-a+(n-1-l)*e]=o;else for(s=Qi.sqrt(e*n),l=a=0;a<i;++l)r<=l&&(l=0,++a),o=~~((o=255-255/(1.13*s)*f(e-a,n-l))<1?1:255<o?255:o),c[a+l*e]=o,c[a+(n-1-l)*e]=o,c[e-1-a+l*e]=o,c[e-1-a+(n-1-l)*e]=o;return c}(this.type,e,n,s,u),m=0,p=0;m<n;++p)e<=p&&(p=0,++m),i=h[l=p+m*e],i/=a=i+(r=h[o=(p+s)%e+(m+u)%n*e]),f[l<<=2]=~~(i*t[l]+(r/=a)*t[o<<=2]),f[1+l]=~~(i*t[1+l]+r*t[1+o]),f[2+l]=~~(i*t[2+l]+r*t[2+o]),f[3+l]=t[3+l];return f}}),ir=(nr=w).MODE,i=Math,A=nr.Util.Filter,nr.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:ir.COLOR,path:nr.Path,init:function(t,e,n,i,r){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==i?1e-6:+i,this.border=null!=r?r||0:null,this.mode=ir.COLOR},serialize:function(){var t="function"==typeof this.color;return{isfunc:t,color:t?this.color.toString():this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return t.isfunc?this.color=new Function("FILTER","return "+t.color+";")(nr):this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R=this.mode||ir.COLOR,L=this.color||0,E=this.border,M=null!=E,T=this.x||0,O=this.y||0,G=nr.Color.RGB2HSV,N=nr.Color.HSV2RGB,F="function"==typeof L;if(!(T<0||e<=T||O<0||n<=O)){if(F||(m=L>>>16&255,p=L>>>8&255,d=255&L),x=t[f=(T<<=2)+(O=O*e<<2)],_=t[f+1],y=t[f+2],w=0,C=1,M){if(M=E>>>8&255,v=255&E,x===(E=E>>>16&255)&&_===M&&y===v)return t;x=E,_=M,y=v,w=1,C=0}else if(ir.COLOR===R&&!F&&x===m&&_===p&&y===d)return t;if(S=(E=Xl(t,e,0,2,jl(x,_,y,w,C,255*(1<=this.tolerance?.999:this.tolerance)),0,T,O)).mask,ir.MASK===R||ir.COLORMASK===R)for(D=ir.MASK===R,f=r=a=i=0,h=t.length;f<h;f+=4,++i)e<=i&&(i=0,++a,r+=e),S[(c=i+r)>>>5]&1<<(31&c)?D&&(g=F&&(m=(I=L(i,a))[0],p=I[1],d=I[2],3<I.length)?I[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g):(t[f]=0,t[f+1]=0,t[f+2]=0);else if(ir.HUE===R)for(l=(A=E.box)[0]>>>2,o=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,b=new lr(3),i=l,a=(r=o)/e;r<=u;)S[(c=i+r)>>>5]&1<<(31&c)&&(b[0]=t[f=c<<2],b[1]=t[f+1],b[2]=t[f+2],G(b,0,1),I=F?L(i,a):L,b[0]=I,N(b,0,1),t[f]=0|b[0],t[f+1]=0|b[1],t[f+2]=0|b[2]),++i>s&&(i=l,++a,r+=e);else for(l=(A=E.box)[0]>>>2,o=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,i=l,a=(r=o)/e;r<=u;)S[(c=i+r)>>>5]&1<<(31&c)&&(f=c<<2,g=F&&(m=(I=L(i,a))[0],p=I[1],d=I[2],3<I.length)?I[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g),++i>s&&(i=l,++a,r+=e)}return t}}),nr.FloodFillFilter=nr.ColorFillFilter,nr.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:ir.TILE,hasInputs:!0,path:nr.Path,init:function(t,e,n,i,r,a,l){this.x=t||0,this.y=e||0,this.offsetX=i||0,this.offsetY=r||0,n&&this.setInput("pattern",n),this.tolerance=null==a?1e-6:+a,this.border=null!=l?l||0:null,this.mode=ir.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var i=this.x||0,r=this.y||0;if(!(i<0||e<=i||r<0||n<=r)&&(I=this.input("pattern"))){var a,l,o,s,u,c,f,h,m,p,d,g,x,_,y,v=this.mode||ir.TILE,b=this.border,w=I[0],C=I[1],A=I[2],S=this.offsetX||0,D=this.offsetY||0,I=t[u=(i<<=2)+(r=r*e<<2)],R=t[u+1],L=t[u+2],E=0,M=1;if(null!=b){if(x=b>>>8&255,a=255&b,I===(b=b>>>16&255)&&R===x&&L===a)return t;I=b,R=x,L=a,E=1,M=0}if(_=(b=Xl(t,e,0,2,jl(I,R,L,E,M,255*(1<=this.tolerance?.999:this.tolerance)),0,i,r)).mask,f=(x=b.box)[0]>>>2,h=x[1]>>>2,m=x[2]>>>2,p=x[3]>>>2,ir.STRETCH===v)for(d=C/(m-f+1),g=A/(p-h+e),l=f,o=h;o<=p;)_[(s=l+o)>>>5]&1<<(31&s)&&(t[u=s<<2]=w[c=(d*(l-f)|0)+(g*(o-h)|0)*C<<2],t[u+1]=w[c+1],t[u+2]=w[c+2]),++l>m&&(l=f,o+=e);else{for(;S<0;)S+=C;for(;D<0;)D+=A;for(m=m-f+1,o=l=0,y=h;y<=p;)_[(s=l+f+y)>>>5]&1<<(31&s)&&(t[u=s<<2]=w[c=(l+S)%C+(o+D)%A*C<<2],t[u+1]=w[c+1],t[u+2]=w[c+2]),++l>=m&&(l=0,y+=e,++o)}}return t}}),rr=nr.Array32I,ar=nr.Array32U,lr=nr.Array32F,or=nr.Array8U,sr=i.ceil,ur=i.min,cr=i.max,_=i.abs,A.dissimilarity_rgb=jl,A.floodRegion=Xl,hr=(fr=w).MODE,mr=fr.Array32F,pr=fr.ImArray,r=fr.Util.Filter,dr=Math,gr=dr.min,xr=dr.max,_r=fr.Util.Array.typed_obj,yr=dr.abs,vr=dr.cos,br=fr.CONST.toRad,fr.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:hr.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,i){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!i,this.mode=hr.COLOR},path:fr.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m=t.length,p=m>>>2,d=this.mode||hr.COLOR,g=this.color,x=gr(.999,xr(0,this.tolerance||0)),p=new mr(p);if(null!=g&&(hr.HUE===d||hr.COLORIZEHUE===d?g=vr(br*g):hr.COLOR!==d&&hr.COLORIZE!==d||(g=1e4*((c=(g>>>16&255)/255)+(f=(g>>>8&255)/255)+(h=(255&g)/255))/3+1e3*(c+f)/2+100*(f+h)/2+10*(c+h)/2+c)),x=Wl(t,e,0,2,p,x,d),hr.COLORIZE!==d&&hr.COLORIZEHUE!==d)return Kl(t,e,n,2,p,this.connectivity,x,g,this.invert);for(i=Kl(new pr(m),e,n,2,p,this.connectivity,x,g,this.invert),o=new mr(256),s=new mr(256),u=new mr(256),l=new mr(256),r=0;r<m;r+=4)++l[a=i[r]],o[a]+=t[r],s[a]+=t[r+1],u[a]+=t[r+2];for(r=0;r<256;++r)l[r]&&(a=l[r],o[r]/=a,s[r]/=a,u[r]/=a);for(r=0;r<m;r+=4)a=i[r],t[r]=0|o[a],t[r+1]=0|s[a],t[r+2]=0|u[a];return t}}),fr.Create({name:"ColorDetectorFilter",_update:!1,hasMeta:!0,mode:hr.COLOR,tolerance:1e-6,minArea:20,maxArea:1/0,color:0,init:function(t){this.color=t||0},path:fr.Path,params:function(t){return t&&(null!=t.tolerance&&(this.tolerance=t.tolerance||0),null!=t.minArea&&(this.minArea=t.minArea),null!=t.maxArea&&(this.maxArea=t.maxArea),null!=t.color&&(this.color=t.color||0),null!=t.selection)&&(this.selection=t.selection||null),this},serialize:function(){return{tolerance:this.tolerance,minArea:this.minArea,maxArea:this.maxArea,color:this.color}},unserialize:function(t){return this.tolerance=t.tolerance,this.minArea=t.minArea,this.maxArea=t.maxArea,this.color=t.color,this},metaData:function(t){return t&&fr.isWorker?_r(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?_r(t,1):t,this},apply:function(t,e,n){var i,r,a,l,o,s,u=this,c=(t.length,u.mode||hr.COLOR),f=u.color,h=gr(.999,xr(0,u.tolerance||0)),m=u.selection||null;return u._update=!1,u.hasMeta=!0,u.meta={matches:[]},null!=f&&(hr.HUE===c?f=vr(br*f):hr.COLOR===c&&(f=1e4*((l=(f>>>16&255)/255)+(o=(f>>>8&255)/255)+(s=(255&f)/255))/3+1e3*(l+o)/2+100*(o+s)/2+10*(l+s)/2+l),s=m?(o=m[4]?(a=e-1,n-1):a=1,i=0|dr.min(e-1,dr.max(0,m[0]*a)),r=0|dr.min(n-1,dr.max(0,m[1]*o)),a=0|dr.min(e-1,dr.max(0,m[2]*a)),0|dr.min(n-1,dr.max(0,m[3]*o))):(r=i=0,a=e-1,n-1),l=(a-i+1)*(s-r+1),m=0<u.minArea&&u.minArea<1?u.minArea*l:u.minArea,o=0<u.maxArea&&u.maxArea<1?u.maxArea*l:u.minArea,h=Wl(t,e,0,2,e=new mr(l),h,c,i,r,a),u.meta={matches:Kl(null,a-i+1,s-r+1,0,e,8,h,f,!1,!0,m,o,i,r)}),t}}),$l.prototype={constructor:$l,id:0,root:null,x1:0,y1:0,x2:0,y2:0},r.dissimilarity_rgb_2=Wl,r.connectedComponents=r.connected_components=Kl,wr=(y=w)._notSupportClamp,Cr=y.CHANNEL,Ar=y.MODE,v=y.Util.Filter,Sr=v.histogram,Dr=v.match_histogram,Ir=y.Util.Array.typed_obj,v=Math,Rr=v.min,Lr=v.max,y.Create({name:"HistogramEqualizeFilter",path:y.Path,mode:Ar.INTENSITY,channel:0,factor:0,range:null,init:function(t,e,n,i){this.mode=t||Ar.INTENSITY,this.channel=e||0,this.range=[0,255],null!=n&&(this.factor=+n||0),i&&0<i.length&&0==(1&i.length)&&(this.range=i)},serialize:function(){return{channel:this.channel,factor:this.factor,range:this.range}},unserialize:function(t){return this.channel=t.channel,this.factor=t.factor,this.range=t.range,this},_apply_rgb:function(t,e,n){var i,r,a,l,o,s,u,c,f=this.factor||0,h=this.range,m=h[0]||0,p=h[1]||255,d=(null==h[2]?m:h[2])||0,g=(null==h[3]?p:h[3])||255,x=(null==h[4]?m:h[4])||0,_=(null==h[5]?p:h[5])||255,y=t.length,v=Sr(t,Cr.R,!0),b=Sr(t,Cr.G,!0),w=Sr(t,Cr.B,!0),f=1-Rr(Lr(f,0),1),C=(v.max-v.min)/v.total,A=(b.max-b.min)/b.total,S=(w.max-w.min)/w.total;if(wr)for(c=0;c<y;c+=4)i=t[c],r=t[c+1],a=t[c+2],l=m<=i&&i<=p?f*((u=v.bin[i]*C)+v.min)+(1-f)*(v.max-u):i,o=(o=d<=r&&r<=g?f*((u=b.bin[r]*A)+b.min)+(1-f)*(b.max-u):r)<0?0:255<o?255:o,s=(s=x<=a&&a<=_?f*((u=w.bin[a]*S)+w.min)+(1-f)*(w.max-u):a)<0?0:255<s?255:s,t[c]=0|(l=l<0?0:255<l?255:l),t[c+1]=0|o,t[c+2]=0|s;else for(c=0;c<y;c+=4)i=t[c],r=t[c+1],a=t[c+2],l=m<=i&&i<=p?f*((u=v.bin[i]*C)+v.min)+(1-f)*(v.max-u):i,o=d<=r&&r<=g?f*((u=b.bin[r]*A)+b.min)+(1-f)*(b.max-u):r,s=x<=a&&a<=_?f*((u=w.bin[a]*S)+w.min)+(1-f)*(w.max-u):a,t[c]=0|l,t[c+1]=0|o,t[c+2]=0|s;return t},apply:function(t,e,n){if(Ar.RGB===this.mode)return this._apply_rgb(t,e,n);var i,r,a,l,o,s,u,c,f,h,m=t.length,p=this.factor||0,d=this.channel||0,g=this.range[0]||0,x=this.range[1]||255,e=this.mode;if(Ar.GRAY===e||Ar.CHANNEL===e)c=Sr(t,d,!0);else{for(f=0;f<m;f+=4)l=(l=0+.299*(i=t[f])+.587*(r=t[f+1])+.114*(a=t[f+2])|0)<0?0:255<l?255:l,o=(o=128-.168736*i-.331264*r+.5*a|0)<0?0:255<o?255:o,t[f]=s=(s=128+.5*i-.418688*r-.081312*a|0)<0?0:255<s?255:s,t[f+1]=l,t[f+2]=o;c=Sr(t,Cr.G,!0)}if(p=1-Rr(Lr(p,0),1),u=(c.max-c.min)/c.total,wr)if(Ar.GRAY===e)for(f=0;f<m;f+=4)i=(i=g<=(h=t[f+d])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)<0?0:255<i?255:i,t[f]=i|=0,t[f+1]=i,t[f+2]=i;else if(Ar.CHANNEL===e)for(f=0;f<m;f+=4)i=g<=(h=t[f+d])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f+d]=0|(i=i<0?0:255<i?255:i);else for(f=0;f<m;f+=4)r=(r=(l=g<=(h=t[f+1])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)-.34414*((o=t[f+2])-128)-.71414*((s=t[f])-128))<0?0:255<r?255:r,a=(a=l+1.772*(o-128))<0?0:255<a?255:a,t[f]=0|(i=(i=l+1.402*(s-128))<0?0:255<i?255:i),t[f+1]=0|r,t[f+2]=0|a;else if(Ar.GRAY===e)for(f=0;f<m;f+=4)i=g<=(h=t[f+d])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f]=i,t[f+1]=i,t[f+2]=i;else if(Ar.CHANNEL===e)for(f=0;f<m;f+=4)i=g<=(h=t[f+d])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h,t[f+d]=i;else for(f=0;f<m;f+=4)r=(l=g<=(h=t[f+1])&&h<=x?p*((h=c.bin[h]*u)+c.min)+(1-p)*(c.max-h):h)-.34414*((o=t[f+2])-128)-.71414*((s=t[f])-128),a=l+1.772*(o-128),t[f]=0|(i=l+1.402*(s-128)),t[f+1]=0|r,t[f+2]=0|a;return t}}),y.Create({name:"HistogramMatchFilter",path:y.Path,mode:Ar.INTENSITY,cdf:null,channel:0,range:null,init:function(t,e,n,i){this.mode=t||Ar.INTENSITY,this.cdf=e,this.channel=n||0,this.range=[0,255],i&&0<i.length&&0==(1&i.length)&&(this.range=i)},serialize:function(){return{channel:this.channel,cdf:Ir(this.cdf),range:this.range}},unserialize:function(t){return this.channel=t.channel,this.cdf=Ir(t.cdf,1),this.range=t.range,this},_apply_rgb:function(t,e,n){for(var i,r,a,l=this.range,o=l[0]||0,s=l[1]||255,u=(null==l[2]?o:l[2])||0,c=(null==l[3]?s:l[3])||255,f=(null==l[4]?o:l[4])||0,h=(null==l[5]?s:l[5])||255,l=this.cdf,m=t.length,p=Sr(t,Cr.R,!0,!0),d=Sr(t,Cr.G,!0,!0),g=Sr(t,Cr.B,!0,!0),x=Dr(null,p.bin,l[0]),_=Dr(null,d.bin,l[1]),y=Dr(null,g.bin,l[2]),v=0;v<m;v+=4)i=t[v],r=t[v+1],a=t[v+2],o<=i&&i<=s&&(t[v]=x[i]),u<=r&&r<=c&&(t[v+1]=_[r]),f<=a&&a<=h&&(t[v+2]=y[a]);return t},apply:function(t,e,n){var i=this;if(Ar.RGB===i.mode)return i._apply_rgb(t,e,n);var r,a,l,o,s,u,c,f,h,m,p=i.range[0]||0,d=i.range[1]||255,g=t.length,x=i.channel||0,e=i.mode;if(Ar.GRAY===e||Ar.CHANNEL===e)f=Sr(t,x,!0,!0);else{for(h=0;h<g;h+=4)o=(o=0+.299*(r=t[h])+.587*(a=t[h+1])+.114*(l=t[h+2])|0)<0?0:255<o?255:o,s=(s=128-.168736*r-.331264*a+.5*l|0)<0?0:255<s?255:s,t[h]=u=(u=128+.5*r-.418688*a-.081312*l|0)<0?0:255<u?255:u,t[h+1]=o,t[h+2]=s;f=Sr(t,Cr.G,!0,!0),x=0}if(m=Dr(null,f.bin,i.cdf[x]&&i.cdf[x].length?i.cdf[x]:i.cdf),Ar.GRAY===e)for(h=0;h<g;h+=4)p<=(c=t[h+x])&&c<=d&&(c=m[c],t[h]=c,t[h+1]=c,t[h+2]=c);else if(Ar.CHANNEL===e)for(h=0;h<g;h+=4)p<=(c=t[h+x])&&c<=d&&(t[h+x]=m[c]);else for(h=0;h<g;h+=4)a=(a=(o=p<=(c=t[h+1])&&c<=d?m[c]:c)-.34414*((s=t[h+2])-128)-.71414*((u=t[h])-128))<0?0:255<a?255:a,l=(l=o+1.772*(s-128))<0?0:255<l?255:l,t[h]=0|(r=(r=o+1.402*(u-128))<0?0:255<r?255:r),t[h+1]=0|a,t[h+2]=0|l;return t}}),Mr=(Er=w)._notSupportClamp,Tr=Er.CHANNEL,Or=Er.MODE,Gr=Er.Util.Array.typed_obj,Fr=Er.Util.Filter,Er.Create({name:"OtsuThresholdFilter",path:Er.Path,hasMeta:!0,mode:Or.INTENSITY,color0:0,color1:null,channel:0,nclasses:2,sigma:null,init:function(t,e,n,i,r,a){this.mode=t||Or.INTENSITY,this.color0=e||0,null!=n&&(this.color1=n),this.channel=i||0,null!=r&&(this.nclasses=+r||0),a&&a.length&&(this.sigma=a)},serialize:function(){return{color0:this.color0,color1:this.color1,channel:this.channel,nclasses:this.nclasses,sigma:this.sigma}},unserialize:function(t){return this.color0=t.color0,this.color1=t.color1,this.channel=t.channel,this.nclasses=t.nclasses,this.sigma=t.sigma,this},metaData:function(t){return t&&Er.isWorker?Gr(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Gr(t,1):t,this},_apply_rgb:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m,p,d,g,x,_=this.color0||0,y=_>>>16&255,v=_>>>8&255,b=255&_,w=this.color1,_=this.nclasses,C=this.sigma,A=t.length;if(null!=w&&(h=w>>>16&255,m=w>>>8&255,p=255&w),l=Fr.histogram(t,Tr.R),o=Fr.histogram(t,Tr.G),s=Fr.histogram(t,Tr.B),C||2<_)for(f=C?(u=Fr.otsu_multi(l.bin,l.total,l.min,l.max,C[0]||0),c=Fr.otsu_multi(o.bin,o.total,o.min,o.max,C[1]||0),Fr.otsu_multi(s.bin,s.total,s.min,s.max,C[2]||0)):(u=Fr.otsu_multiclass(l.bin,l.total,l.min,l.max,_),c=Fr.otsu_multiclass(o.bin,o.total,o.min,o.max,_),Fr.otsu_multiclass(s.bin,s.total,s.min,s.max,_)),d=0;d<A;d+=4){for(i=t[d],g=0,x=u.length;g<x;++g)if(i<u[g]){t[d]=y+(h-y)*g/x|0;break}for(x<=g&&(t[d]=h),r=t[d+1],g=0,x=c.length;g<x;++g)if(r<c[g]){t[d+1]=v+(m-v)*g/x|0;break}for(x<=g&&(t[d+1]=m),a=t[d+2],g=0,x=f.length;g<x;++g)if(a<f[g]){t[d+2]=b+(p-b)*g/x|0;break}x<=g&&(t[d+2]=p)}else for(u=Fr.otsu(l.bin,l.total,l.min,l.max),c=Fr.otsu(o.bin,o.total,o.min,o.max),f=Fr.otsu(s.bin,s.total,s.min,s.max),d=0;d<A;d+=4)t[d]<u?t[d]=y:null!=w&&(t[d]=h),t[d+1]<c?t[d+1]=v:null!=w&&(t[d+1]=m),t[d+2]<f?t[d+2]=b:null!=w&&(t[d+2]=p);return this.meta=[u,c,f],t},apply:function(t,e,n){if(Or.RGB===this.mode)return this._apply_rgb(t,e,n);var i,r,a,l,o,s,u,c,f,h,m,p,d,g,e=this.color0||0,x=e>>>16&255,_=e>>>8&255,y=255&e,v=this.color1,b=t.length,w=this.channel||0,n=this.nclasses,e=this.sigma,C=this.mode;if(null!=v&&(u=v>>>16&255,c=v>>>8&255,f=255&v),Or.GRAY===C||Or.CHANNEL===C)h=Fr.histogram(t,w);else{for(m=0;m<b;m+=4)l=0+.299*(i=t[m])+.587*(r=t[m+1])+.114*(a=t[m+2]),o=128-.168736*i-.331264*r+.5*a,s=128+.5*i-.418688*r-.081312*a,Mr&&(s=s<0?0:255<s?255:s,l=l<0?0:255<l?255:l,o=o<0?0:255<o?255:o),t[m]=0|s,t[m+1]=0|l,t[m+2]=0|o;h=Fr.histogram(t,Tr.G)}if(e||2<n)if(g=e?Fr.otsu_multi(h.bin,h.total,h.min,h.max,e[0]||0):Fr.otsu_multiclass(h.bin,h.total,h.min,h.max,n),Or.GRAY===C)for(m=0;m<b;m+=4){for(i=t[m+w],p=0,d=g.length;p<d;++p)if(i<g[p]){t[m]=x+(u-x)*p/d|0,t[m+1]=_+(c-_)*p/d|0,t[m+2]=y+(f-y)*p/d|0;break}d<=p&&(t[m]=u,t[m+1]=c,t[m+2]=f)}else if(Or.CHANNEL===C)for(m=0;m<b;m+=4){for(i=t[m+w],p=0,d=g.length;p<d;++p)if(i<g[p]){t[m+w]=2===w?y+(f-y)*p/d|0:1===w?_+(c-_)*p/d|0:x+(u-x)*p/d|0;break}d<=p&&(t[m+w]=2===w?f:1===w?c:u)}else for(m=0;m<b;m+=4){for(l=t[m+1],p=0,d=g.length;p<d;++p)if(l<g[p]){t[m]=x+(u-x)*p/d|0,t[m+1]=_+(c-_)*p/d|0,t[m+2]=y+(f-y)*p/d|0;break}d<=p&&(t[m]=u,t[m+1]=c,t[m+2]=f)}else if(g=Fr.otsu(h.bin,h.total,h.min,h.max),Or.GRAY===C)for(m=0;m<b;m+=4)t[m+w]<g?(t[m]=x,t[m+1]=_,t[m+2]=y):null!=v&&(t[m]=u,t[m+1]=c,t[m+2]=f);else if(Or.CHANNEL===C)for(m=0;m<b;m+=4)t[m+w]<g?t[m+w]=2===w?y:1===w?_:x:null!=v&&(t[m+w]=2===w?f:1===w?c:u);else for(m=0;m<b;m+=4)s=t[m],l=t[m+1],o=t[m+2],l<g?(t[m]=x,t[m+1]=_,t[m+2]=y):null!=v?(t[m]=u,t[m+1]=c,t[m+2]=f):(i=l+1.402*(s-128),r=l-.34414*(o-128)-.71414*(s-128),a=l+1.772*(o-128),Mr&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),t[m]=0|i,t[m+1]=0|r,t[m+2]=0|a);return this.meta=[g],t}}),(Nr=w).Create({name:"CannyEdgesFilter",low:25,high:75,lowpass:!0,path:Nr.Path,init:function(t,e,n){this.low=arguments.length<1?25:+t,this.high=arguments.length<2?75:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},getGLSL:function(){var t=this,e=Nr.Util.Filter.gradient_glsl(),n=new Nr.Util.GLSL.Filter(t);return t.lowpass&&n.begin().shader(["varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;",e.lowpass,"void main(void) {","    gl_FragColor = lowpass(img, pix, dp);","}"].join("\n")).end(),n.begin().shader(["#define MAGNITUDE_SCALE 1.0","#define MAGNITUDE_LIMIT 510.0","#define MAGNITUDE_MAX 510.0","varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;","uniform float low;","uniform float high;",e.gradient,"void main(void) {","    gl_FragColor = gradient(img, pix, dp, low, high, MAGNITUDE_SCALE, MAGNITUDE_LIMIT, MAGNITUDE_MAX);","}"].join("\n")).input("low",function(t){return+t.low/255}).input("high",function(t){return+t.high/255}).end().begin().shader(["varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;",e.hysteresis,"void main(void) {","    gl_FragColor = hysteresis(img, pix, dp);","}"].join("\n"),50).end(),n.code()},_apply:function(t,e,n){return(this._runWASM&&Nr.Util.Filter.wasm||Nr.Util.Filter).gradient(t,e,n,2,0,this.lowpass?1:0,0,+this.low,+this.high,1,510,510)}}),Hr=w,(b=Math).abs,vt=b.max,bt=b.min,b.floor,b.round,Ur=b.sqrt,zr=Hr.Util.Array.typed_obj,Br=Array.prototype.push,Hr.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,noreuse:!1,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,i,r,a,l){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==i?.5:+i,this.minNeighbors=null==r?1:+r,this.doCannyPruning=void 0===a||!!a,this.tolerance=null==l?.2:+l,this._haarchanged=!!this.haardata},path:Hr.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection&&(e.selection=t.selection||null),void 0!==t.noreuse)&&(e.noreuse=!!t.noreuse),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh,noreuse:t.noreuse};return t._haarchanged&&(e.haardata=zr(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=zr(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e.noreuse=t.noreuse,e},metaData:function(t){return t&&Hr.isWorker?zr(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?zr(t,1):t,this},apply:function(t,e,n,i){var r,a,l,o,s,u,c,f,h,m,p,d,g=this;return g._update=!1,g.hasMeta=!0,g.meta={objects:[]},g.haardata&&e&&n&&(r=t.length>>>2,d=g.selection||null,a=Hr.Array32F,u=s=o=l=null,p=Hr.Util.Filter,d=d?(m=d[4]?(h=e-1,n-1):h=1,c=0|bt(e-1,vt(0,d[0]*h)),f=0|bt(n-1,vt(0,d[1]*m)),h=0|bt(e-1,vt(0,d[2]*h)),0|bt(n-1,vt(0,d[3]*m))):(f=c=0,h=e-1,n-1),!g.noreuse&&i&&i.haarfilter_SAT?(l=i.haarfilter_SAT,o=i.haarfilter_SAT2,s=i.haarfilter_RSAT):(p.sat(t,e,n,2,0,l=new a(r),o=new a(r),s=new a(r)),!g.noreuse&&i&&(i.haarfilter_SAT=l,i.haarfilter_SAT2=o,i.haarfilter_RSAT=s)),g.doCannyPruning&&(!g.noreuse&&i&&i.haarfilter_GSAT?u=i.haarfilter_GSAT:(u=p.gradient(t,e,n,2,0,1,1),!g.noreuse&&i&&(i.haarfilter_GSAT=u))),(m=new Array(10)).count=0,p.haar_detect(m,e,n,c,f,h,d,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,l,s,o,u,g.cannyLow,g.cannyHigh),m.length>m.count&&(m.length=m.count),g.meta.objects=p.merge_features(m,g.minNeighbors,g.tolerance).sort(Zl),u=s=o=l=null),t}}),Hr.Util.Filter.haar_detect=function(t,e,N,H,U,z,B,Y,k,P,j,n,i,r,a,X,W){for(var $,q,l,o,s,u,V,K,Z,c,f,h,m,J,Q,p,d,g,x,tt,et,nt,it,rt,_,y,at,v,lt,ot,st,b,w,C,A,S,D,I,R,L,E,M,T,ut=null!=a,ct=z-H+1|0,ft=B-U+1|0,ht=(z=e*N)-1,mt=Y.stages,pt=mt.length,dt=Y.size1,gt=Y.size2,O=e-1,G=z-e,xt=0|H,_t=0|U,yt=bt(ct/dt,ft/gt),F=k;F<=yt;F*=P)for($=(l=F*dt|0)*j|0,K=(o=F*gt|0)*e,J=xt+ct-l,Q=_t+ft-o,d=l*o,V=(u=_t)*(Z=(q=o*j|0)*e);u<Q;u+=q,V+=Z)for(s=xt;s<J;s+=$)if(f=(c=s-1+V-e)+l,m=(h=c+K)+l,c=bt(ht,vt(0,c)),f=bt(ht,vt(0,f)),h=bt(ht,vt(0,h)),m=bt(ht,vt(0,m)),!(ut&&((x=(a[m]-a[h]-a[f]+a[c])/d)<X||W<x)||(x=(n[m]-n[h]-n[f]+n[c])/d,(g=(r[m]-r[h]-r[f]+r[c])/d-x*x)<=0))){for(g=Ur(g),tt=!1,p=0;p<pt;++p){for(nt=(et=mt[p]).thres,rt=(it=et.trees).length,_=T=0;_<rt;++_)for(at=it[_].feats,y=0;;){if(ot=(lt=(v=at[y]).rects).length,st=v.thres,b=0,v.tilt)for(w=0;w<ot;++w)A=s+F*(C=lt[w])[0]|0,S=(u-1+F*C[1]|0)*e,D=s+F*(C[0]+C[2])|0,I=(u-1+F*(C[1]+C[2])|0)*e,R=s+F*(C[0]-C[3])|0,L=(u-1+F*(C[1]+C[3])|0)*e,E=s+F*(C[0]+C[2]-C[3])|0,M=(u-1+F*(C[1]+C[2]+C[3])|0)*e,A=bt(O,vt(0,A)),D=bt(O,vt(0,D)),R=bt(O,vt(0,R)),E=bt(O,vt(0,E)),S=bt(G,vt(0,S)),I=bt(G,vt(0,I)),L=bt(G,vt(0,L)),M=bt(G,vt(0,M)),b+=C[4]*(i[E+M]-i[R+L]-i[D+I]+i[A+S]);else for(w=0;w<ot;++w)A=s-1+F*(C=lt[w])[0]|0,D=s-1+F*(C[0]+C[2])|0,S=e*(u-1+F*C[1]|0),I=e*(u-1+F*(C[1]+C[3])|0),A=bt(O,vt(0,A)),D=bt(O,vt(0,D)),S=bt(G,vt(0,S)),I=bt(G,vt(0,I)),b+=C[4]*(n[D+I]-n[A+I]-n[D+S]+n[A+S]);if(b<d*st*g){if(v.has_l){T+=v.l_val;break}y=v.l_node}else{if(v.has_r){T+=v.r_val;break}y=v.r_node}}if(!(tt=nt<T))break}tt&&(t.count===t.length&&Br.apply(t,new Array(10)),t[t.count++]={x:s,y:u,width:l,height:o,score:T})}},kr=(Yr=w).MODE,Yr.Util.GLSL,Pr=Yr.Util.Filter,jr=Pr.sat,Xr=Pr.satsum,Wr=Pr.satsums,$r=Pr.satsumr,qr=Pr.merge_features,Vr=Yr.Util.Array.typed_obj,at=Math,Yr.Util.Math.clamp,Kr=Yr.Array32F,Zr=[0],Jr=[0,90,180,270],Qr=[0,45,90,135,180,225,270,315],ta=[0,22.5,45,67.5,90,112.5,135,157.5,180,202.5,225,247.5,270,292.5,315,337.5],Yr.Create({name:"TemplateMatcherFilter",path:Yr.Path,_update:!1,hasMeta:!0,hasInputs:!0,mode:kr.RGB,noreuse:!1,sc:null,rot:null,scaleThreshold:null,threshold:.6,tolerance:.2,minNeighbors:1,maxMatches:100,maxMatchesOnly:!0,_k:5,_q:.98,_s:3,_tpldata:null,init:function(t){this.sc={min:1,max:1,inc:1.1},this.rot=[0],t&&this.setInput("template",t)},dispose:function(){return this.sc=this.rot=null,this.scaleThreshold=null,this._tpldata=null,this.$super("dispose"),this},params:function(t){var e=this;return t&&(null!=t.threshold&&(e.threshold=t.threshold||0),null!=t.scaleThreshold&&(e.scaleThreshold=t.scaleThreshold,e.scaleThreshold)&&(e.scaleThreshold.changed=!0),null!=t.tolerance&&(e.tolerance=t.tolerance||0),null!=t.minNeighbors&&(e.minNeighbors=t.minNeighbors||0),null!=t.maxMatches&&(e.maxMatches=t.maxMatches||0),void 0!==t.maxMatchesOnly&&(e.maxMatchesOnly=!!t.maxMatchesOnly),null!=t.scales&&(e.sc=t.scales||{min:1,max:1,inc:1.1},e._glsl=null),null!=t.rotations&&(e.rot=t.rotations||[0],e._glsl=null),null!=t.k&&(e._k=t.k||0),null!=t.q&&e.quality(t.q,e._s),null!=t.s&&e.quality(e._q,t.s),null!=t.selection&&(e.selection=t.selection||null),void 0!==t.noreuse)&&(e.noreuse=!!t.noreuse),e},quality:function(t,e){return e=null==e?3:e||0,(t=null==t?.98:t||0)===this._q&&e===this._s||(this._tpldata=null,this._q=t,this._s=e),this},tpldata:function(t,e){var n,i,r=this;return t&&t.avg&&t.avg.length?r._tpldata=t:(n=r.isInputUpdated("template"),(i=r.input("template"))&&i[1]&&i[2]?t?!n&&r._tpldata&&r._tpldata.basis||(r._tpldata=to(i[0],i[1],i[2],1-r._q,r._s,e)):!n&&r._tpldata||(r._tpldata=to(i[0],i[1],i[2])):r._tpldata=null,r._tpldata)},serialize:function(){var t=this,e={threshold:t.threshold,scaleThreshold:"function"==typeof t.scaleThreshold&&(t.scaleThreshold.changed?t.scaleThreshold.toString():null),tolerance:t.tolerance,minNeighbors:t.minNeighbors,maxMatches:t.maxMatches,maxMatchesOnly:t.maxMatchesOnly,sc:t.sc,rot:t.rot,_k:t._k,_q:t._q,_s:t._s,noreuse:t.noreuse};return t.scaleThreshold&&t.scaleThreshold.changed&&(t.scaleThreshold.changed=null),e},unserialize:function(t){var e=this;return e.threshold=t.threshold,e.scaleThreshold=!1===t.scaleThreshold?null:t.scaleThreshold?new Function("FILTER","return "+t.scaleThreshold+";")(Yr):e.scaleThreshold,e.tolerance=t.tolerance,e.minNeighbors=t.minNeighbors,e.maxMatches=t.maxMatches,e.maxMatchesOnly=t.maxMatchesOnly,e.sc=t.sc,e.rot=t.rot,e._k=t._k,e._q=t._q,e._s=t._s,e.noreuse=t.noreuse,e},metaData:function(t){return t&&Yr.isWorker?Vr(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?Vr(t,1):t,this},apply:function(t,e,n,i){var r=this,a=r.tpldata(!0),l=r.input("template"),N=[];if(r._update=!1,r.hasMeta=!0,r.meta={matches:N},l&&a&&e&&n){var H,U,z,o,B,s,Y,k,u,c,f,h,m,p,d,g,x,P,j,_,y,v,b,w,C,X,W,A,S,D,I,R,L,E,$,M,q=l[0],T=l[1],O=l[2],l=r.selection||null,V=kr.GRAY===r.mode,G=r.rot,K=r.sc,Z=r.threshold,J=r._k||0,Q=r.scaleThreshold,F=(t.length,q.length,e*n),tt=r.maxMatches,et=r.maxMatchesOnly,nt=r.minNeighbors,it=r.tolerance,rt={x1:0,y1:0,x2:0,y2:0,x3:0,y3:0,x4:0,y4:0,area:0,sum:0,sum2:0,sat:null,sat2:null};for(1===G?G=Zr:4===G?G=Jr:8===G?G=Qr:16===G&&(G=ta),X=l?(q=l[4]?(W=e-1,n-1):W=1,b=0|at.min(e-1,at.max(0,l[0]*W)),w=0|at.min(n-1,at.max(0,l[1]*q)),C=0|at.min(e-1,at.max(0,l[2]*W)),0|at.min(n-1,at.max(0,l[3]*q))):(w=b=0,C=e-1,n-1),!r.noreuse&&i&&(i.tmfilter_SAT||i.haarfilter_SAT)?(D=i.tmfilter_SAT||[i.haarfilter_SAT,i.haarfilter_SAT,i.haarfilter_SAT],I=i.tmfilter_SAT2||[i.haarfilter_SAT2,i.haarfilter_SAT2,i.haarfilter_SAT2]):(V?(D=[new Kr(F),null,null],I=[new Kr(F),null,null],jr(t,e,n,2,0,D[2]=D[1]=D[0],I[2]=I[1]=I[0])):(D=[new Kr(F),new Kr(F),new Kr(F)],I=[new Kr(F),new Kr(F),new Kr(F)],jr(t,e,n,2,0,D[0],I[0]),jr(t,e,n,2,1,D[1],I[1]),jr(t,e,n,2,2,D[2],I[2])),!r.noreuse&&i&&(i.tmfilter_SAT=D,i.tmfilter_SAT2=I)),D[0]===D[1]&&D[0]===D[2]&&(V=!0),U=0,z=G.length;U<z;++U)for((o=(B=G[U]||0)%360)<0&&(o+=360),H=45<o&&o<=135||225<o&&o<=315,A=at.sin(o/180*at.PI),S=at.cos(o/180*at.PI),s=K.min,Y=K.max,k=K.inc;s<=Y&&(h=(p=at.round(s*T))>>>1,m=(d=at.round(s*O))>>>1,f=H?(c=m,h):(c=h,m),!(C-b+1<c<<1||X-w+1<f<<1));s*=k){if(u=Q?Q(s,B):Z,R=new Array(F),E=-1/(L=0),M=new Kr(C-b+1),V)for(y=b+c,v=w+f,_=X-f;v<=_&&!(C<y+c&&(y=b+c,_<++v));)v<(M[y-b-c]||0)?y+=c:u<=(x=Jl(y,v,D[0],I[0],a.avg[0],a.var[0],a.basis[0],e,n,T,O,s,o,J,p,d,A,S,rt))&&(g=x,!et||E<=g)?(E<g&&(E=g,et)&&(L=0),R[L++]={x:y-h,y:v-m,width:p,height:d,score:g},M[y-b-c]=v+(f||0),y+=c||1):++y;else for(y=b+c,v=w+f,_=X-f;v<=_&&!(C<y+c&&(y=b+c,_<++v));)v<(M[y-b-c]||0)?y+=c:(P=u<=(x=Jl(y,v,D[0],I[0],a.avg[0],a.var[0],a.basis[0],e,n,T,O,s,o,J,p,d,A,S,rt))?Jl(y,v,D[1],I[1],a.avg[1],a.var[1],a.basis[1],e,n,T,O,s,o,J,p,d,A,S,rt):0,j=u<=x&&u<=P?Jl(y,v,D[2],I[2],a.avg[2],a.var[2],a.basis[2],e,n,T,O,s,o,J,p,d,A,S,rt):0,u<=x&&u<=P&&u<=j&&(g=at.min(x,P,j),!et||E<=g)?(E<g&&(E=g,et)&&(L=0),R[L++]={x:y-h,y:v-m,width:p,height:d,score:g},M[y-b-c]=v+(f||0),y+=c||1):++y);L&&L<at.min(tt,F)&&(R.length=L,($=qr(R,nt,it)).forEach(function(t){t.angle=B,t.scale=s}),N.push.apply(N,$))}M=D=I=R=$=null}return t}}),Pr.tm_approximate=function(t,e,n,i,r,a,l){var o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w,C,A,S=t.length,D=S>>>2,I=[{k:Xr(e,n,i,0,0,n-1,i-1)/D,x0:0,y0:0,x1:n-1,y1:i-1,q:1}],R=I[0];for(a*=65025,v=o=0;v<S;v+=4)o+=(w=t[v+r]-R.k)*w/D;for(u=o;a<o;){for(u=o,A=(c=I).length,C=0;C<A;++C){if(l<(R=I[C]).x1-R.x0+1)for(m=R.x0;m<R.x1;++m){for(s=o,h=R.y1-R.y0+1,f=m-R.x0+1,_=Xr(e,n,i,R.x0,R.y0,m,R.y1)/(f*h),f=R.x1-(m+1)+1,y=Xr(e,n,i,m+1,R.y0,R.x1,R.y1)/(f*h),d=R.x0;d<=m;++d)for(x=(g=R.y0)*n;g<=R.y1;++g,x+=n)s=s-(w=(b=t[(v=d+x<<2)+r])-R.k)*w/D+(w=b-_)*w/D;for(d=m+1;d<=R.x1;++d)for(x=(g=R.y0)*n;g<=R.y1;++g,x+=n)s=s-(w=(b=t[(v=d+x<<2)+r])-R.k)*w/D+(w=b-y)*w/D;s<u&&(u=s,(c=I.slice(0,C)).push({k:_,x0:R.x0,x1:m,y0:R.y0,y1:R.y1}),c.push({k:y,x0:m+1,x1:R.x1,y0:R.y0,y1:R.y1}),c.push.apply(c,I.slice(C+1)))}if(l<R.y1-R.y0+1)for(p=R.y0;p<R.y1;++p){for(s=o,f=R.x1-R.x0+1,h=p-R.y0+1,_=Xr(e,n,i,R.x0,R.y0,R.x1,p)/(f*h),h=R.y1-(p+1)+1,y=Xr(e,n,i,R.x0,p+1,R.x1,R.y1)/(f*h),x=(g=R.y0)*n;g<=p;++g,x+=n)for(d=R.x0;d<=R.x1;++d)s=s-(w=(b=t[(v=d+x<<2)+r])-R.k)*w/D+(w=b-_)*w/D;for(x=(g=p+1)*n;g<=R.y1;++g,x+=n)for(d=R.x0;d<=R.x1;++d)s=s-(w=(b=t[(v=d+x<<2)+r])-R.k)*w/D+(w=b-y)*w/D;s<u&&(u=s,(c=I.slice(0,C)).push({k:_,x0:R.x0,x1:R.x1,y0:R.y0,y1:p}),c.push({k:y,x0:R.x0,x1:R.x1,y0:p+1,y1:R.y1}),c.push.apply(c,I.slice(C+1)))}}if(c===I)break;o=u,I=c}return I[0].q=1-u/255/255,I},Pr.tm_ncc=Jl,ea=w,N=Math,na=N.PI/180,ia=ea.Util.Math.hypot,ra=ea.Util.Image.nonzero_pixels,aa=ea.Util.Filter.localmax,la=ea.Array32U,oa=ea.Array32F,sa=ea.Util.Array.typed_obj,ea.Create({name:"HoughDetectorFilter",path:ea.Path,_update:!1,hasMeta:!0,shape:"lines",threshold:10,gap:4,radii:null,thetas:null,amin:10,amax:null,bmin:3,bmax:null,init:function(t){null!=t&&(this.shape=String(t)),this.radii=null,this.thetas=so(60,function(t){return 3*t})},params:function(t){var e=this;return t&&(null!=t.threshold&&(e.threshold=+t.threshold),null!=t.gap&&(e.gap=+t.gap),null!=t.radii&&(e.radii=t.radii),null!=t.thetas&&(e.thetas=t.thetas),null!=t.amin&&(e.amin=+t.amin),void 0!==t.amax&&(e.amax=t.amax),void 0!==t.bmin&&(e.bmin=t.bmin),void 0!==t.bmax&&(e.bmax=t.bmax),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this;return{shape:t.shape,threshold:t.threshold,gap:t.gap,radii:t.radii?t.radii.join(","):null,thetas:t.thetas?t.thetas.join(","):null,amin:t.amin,amax:t.amax,bmin:t.bmin,bmax:t.bmax}},unserialize:function(t){var e=this;return e.shape=t.shape,e.threshold=t.threshold,e.gap=t.gap,e.radii=t.radii?t.radii.split(",").map(oo):null,e.thetas=t.thetas?t.thetas.split(",").map(oo):null,e.amin=t.amin,e.amax=t.amax,e.bmin=t.bmin,e.bmax=t.bmax,e},metaData:function(t){return t&&ea.isWorker?sa(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?sa(t,1):t,this},apply:function(t,e,n){var i,r,a,l,o=this,s=o.shape,u=o.selection||null;return o._update=!1,o.hasMeta=!0,o.meta={objects:[]},u=u?(l=u[4]?(a=e-1,n-1):a=1,i=0|N.min(e-1,N.max(0,u[0]*a)),r=0|N.min(n-1,N.max(0,u[1]*l)),a=0|N.min(e-1,N.max(0,u[2]*a)),0|N.min(n-1,N.max(0,u[3]*l))):(r=i=0,a=e-1,n-1),"lines"===s?o.meta.objects=no(t,e,0,4,i,r,a,u,o.thetas,o.threshold):"linesegments"===s?o.meta.objects=io(t,e,n,4,i,r,a,u,o.thetas,o.threshold,o.gap):"rectangles"===s?o.meta.objects=ro(t,e,n,4,i,r,a,u,o.thetas,90,o.threshold,o.gap):"circles"===s?o.meta.objects=ao(t,e,n,4,i,r,a,u,o.radii,o.threshold):"ellipses"===s&&(o.meta.objects=lo(t,e,n,4,i,r,a,u,o.amin,o.amax,o.bmin,o.bmax,o.threshold)),t}}),ea.Util.Filter.hough_lines=no,ea.Util.Filter.hough_line_segments=io,ea.Util.Filter.hough_parallelograms=ro,ea.Util.Filter.hough_circles=ao,ea.Util.Filter.hough_ellipses=lo,ua=w,rt=Math,ca=ua.Array32U,fa=ua.Array32F,ha=ua.Util.Array.copy,ma=ua.Util.Math.clamp,pa=JSON.stringify,da=JSON.parse,ga=ua.Util.Array.typed_obj,ua.Create({name:"PatchMatchFilter",_update:!0,hasMeta:!0,hasInputs:!0,patch:5,iterations:10,alpha:.5,radius:100,threshold:0,delta:0,epsilon:0,with_gradients:!1,with_texture:!1,needs_dilate:!1,bidirectional:!1,reconstruct:null,repeat:1,multiscale:!1,layered:!1,fromSelection:null,toSelection:null,returnMatch:!1,init:function(){this.reconstruct=["average","best"]},path:ua.Path,dispose:function(){return this.fromSelection=this.toSelection=null,this.$super("dispose"),this},params:function(t){var e=this;return t&&(null!=t.patch&&(e.patch=+t.patch),null!=t.iterations&&(e.iterations=+t.iterations),null!=t.alpha&&(e.alpha=+t.alpha),null!=t.radius&&(e.radius=+t.radius),null!=t.threshold&&(e.threshold=+t.threshold),null!=t.delta&&(e.delta=+t.delta),null!=t.epsilon&&(e.epsilon=+t.epsilon),null!=t.with_gradients&&(e.with_gradients=t.with_gradients),null!=t.with_texture&&(e.with_texture=t.with_texture),null!=t.needs_dilate&&(e.needs_dilate=t.needs_dilate),null!=t.bidirectional&&(e.bidirectional=t.bidirectional),null!=t.reconstruct&&(e.reconstruct=t.reconstruct),null!=t.repeat&&(e.repeat=+t.repeat),null!=t.multiscale&&(e.multiscale=t.multiscale),null!=t.layered&&(e.layered=t.layered),null!=t.fromSelection&&(e.fromSelection=t.fromSelection),null!=t.toSelection&&(e.toSelection=t.toSelection),null!=t.returnMatch)&&(e.returnMatch=t.returnMatch),e},serialize:function(){var t=this;return{patch:t.patch,iterations:t.iterations,alpha:t.alpha,radius:t.radius,threshold:t.threshold,delta:t.delta,epsilon:t.epsilon,with_gradients:t.with_gradients,with_texture:t.with_texture,needs_dilate:t.needs_dilate,bidirectional:t.bidirectional,reconstruct:pa(t.reconstruct),repeat:t.repeat,multiscale:t.multiscale,layered:t.layered,fromSelection:pa(t.fromSelection),toSelection:pa(t.toSelection),returnMatch:t.returnMatch}},unserialize:function(t){var e=this;return e.patch=t.patch,e.iterations=t.iterations,e.alpha=t.alpha,e.radius=t.radius,e.threshold=t.threshold,e.delta=t.delta,e.epsilon=t.epsilon,e.with_gradients=t.with_gradients,e.with_texture=t.with_texture,e.needs_dilate=t.needs_dilate,e.bidirectional=t.bidirectional,e.reconstruct=da(t.reconstruct),e.repeat=t.repeat,e.multiscale=t.multiscale,e.layered=t.layered,e.fromSelection=da(t.fromSelection),e.toSelection=da(t.toSelection),e.returnMatch=t.returnMatch,e},metaData:function(t){return t&&ua.isWorker?ga(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?ga(t,1):t,this},apply:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m,p,d=this,g=d.fromSelection,x=d.toSelection,_=d.patch,y=d.iterations,v=d.alpha,b=d.radius,w=d.with_gradients,C=d.with_texture,A=d.needs_dilate,S=d.multiscale,D=d.layered,I=d.repeat,R=d.delta,L=d.epsilon,E=d.bidirectional,M=d.returnMatch,T=ua.Util.Image.Selection,O=ua.Util.Image.Pyramid;if(d._update=!1,i=M?{match:null}:{metric:null},g&&x&&(c=g.data?d.input(g.data):[t,e,n]))if(s=c[0],u=c[1],c=c[2],s===t&&(s=ha(s)),r={reconstruct:d.reconstruct[0],error:0,delta:0,threshold:d.threshold||0},S){if(m=new O(t,e,n,4,new T(t,e,n,4,x)).build(1.4*_,!1),p=new O(s,u,c,4,new T(s,u,c,4,g)).build(1.4*_,!1),C)for(m.levels[0].sel.attached.tex=xo.computeTexture(m.levels[0].sel,_),p.levels[0].sel.attached.tex=xo.computeTexture(p.levels[0].sel,_),l=1;l<m.levels.length;++l)m.levels[l].sel.attached.tex=xo.transferTexture(null,m.levels[l].sel,m.levels[l-1].sel.attached.tex,m.levels[l-1].sel,2),p.levels[l].sel.attached.tex=xo.transferTexture(null,p.levels[l].sel,p.levels[l-1].sel.attached.tex,p.levels[l-1].sel,2);for(l=m.levels.length-1;0<=l;--l)if(f=f?(h=f.scale(m.levels[l].sel,p.levels[l].sel,2),f.dispose(!0),h):_o(m.levels[l].sel,p.levels[l].sel,_,y,v,b,w||C,A||D,E,D),1<I&&0<l)for(o=1;o<I&&(f.apply(r),!(r.delta<=R||r.error<=L));++o)f.optimization(y,v,b);for(a=!0,l=0,o=1;o<I;++o){if(f.apply(r),r.delta<=R||r.error<=L){a=!1;break}f.optimization(y,v,b)}M?i.match=f.getMatch():(!a&&d.reconstruct[1]===d.reconstruct[0]||(r.reconstruct=d.reconstruct[1],f.apply(r)),i.metric={delta:r.delta,error:r.error},d._update=!0),f.dispose(!0),m.dispose(),p.dispose()}else{for(m=new T(M?ha(t):t,e,n,4,x),p=new T(s,u,c,4,g),C&&(m.attached.tex=xo.computeTexture(m,_),p.attached.tex=xo.computeTexture(p,_)),f=_o(m,p,_,y,v,b,w||C,A||D,E,D),a=!0,o=1;o<I;++o){if(f.apply(r),r.delta<=R||r.error<=L){a=!1;break}f.optimization(y,v,b)}M?i.match=f.getMatch():(!a&&d.reconstruct[1]===d.reconstruct[0]||(r.reconstruct=d.reconstruct[1],f.apply(r)),i.metric={delta:r.delta,error:r.error},d._update=!0),f.dispose(!0)}return d.hasMeta=!0,d.meta=i,t}}),xo.prototype={constructor:xo,dst:null,src:null,dstData:null,srcData:null,field:null,fieldr:null,patch:5,_with_gradients:!1,_needs_dilate:!1,dispose:function(t){var e=this;!0===t&&(e.dst&&e.dst.dispose(),e.src)&&e.src.dispose(),e.dstData&&e.dstData.dilated&&e.dstData.dilated.dispose(),e.dstData=e.srcData=null,e.dst=e.src=null,e.field=e.fieldr=null},getMatch:function(){var l=this.dstData.dilated||this.dst,o=this.dst,s=l.points(),u=o.points(),c=this.src.points();return(this.field||[]).reduce(function(t,e,n){var i=e[0],e=e[1],r=null,a=null;return l===o?(r=u[n],a=c[i]):-1!==(n=l.indexOf(s[n].x,s[n].y))&&(r=u[n],a=c[i]),r&&a&&t.push({src:{x:a.x,y:a.y},dst:{x:r.x,y:r.y},dist:e}),t},[])},clone:function(){return new xo(this)},scale:function(i,r,a,l){null==l&&(l=a);var o,s,u,c,f,h,m=this,p=new xo(i,r,m.patch,m._with_gradients,m._needs_dilate);return m.field&&p.initialize(1).randomize(1,1),m.fieldr&&p.initialize(-1).randomize(1,-1),m.field&&p.field&&(i=m.dstData.dilated||m.dst,r=m.src,o=p.dstData.dilated||p.dst,s=p.src,u=i.points(),c=r.points(),f=o.points(),h=s.points(),p.field.forEach(function(t,e){var n=i.indexOf(rt.floor(f[e].x/a),rt.floor(f[e].y/l));-1!==n&&(n=m.field[n][0],-1!==(n=s.indexOf(rt.floor(c[n].x*a),rt.floor(c[n].y*l))))&&(p.field[e]=[n,p.distance(e,n,1)])}),p.fieldr)&&p.fieldr.forEach(function(t,e){var n=r.indexOf(rt.floor(h[e].x/a),rt.floor(h[e].y/l));-1!==n&&(n=m.fieldr[n][0],-1!==(n=o.indexOf(rt.floor(u[n].x*a),rt.floor(u[n].y*l))))&&(p.fieldr[e]=[n,p.distance(e,n,-1)])}),p},initialize:function(t){var e,n,i=this,r=-1===t?i.src:i.dstData.dilated||i.dst,a=-1===t?i.dstData.dilated||i.dst:i.src,r=r.points(),a=a.points(),l=r.length;if(r.length&&a.length)for(e=-1===t?(i.fieldr||(i.fieldr=new Array(l)),i.fieldr):(i.field||(i.field=new Array(l)),i.field),n=0;n<l;++n)e[n]=[0,2];else i.field=i.fieldr=null;return i},randomize:function(t,e){if(-1===e&&!this.fieldr||-1!==e&&!this.field)return this;var n,i,r,a,l,o,s,u=this,c=-1===e?u.fieldr:u.field,f=(-1===e?u.src:u.dstData.dilated||u.dst,(-1===e?u.dstData.dilated||u.dst:u.src).points().length-1),h=c.length;for(t=t||1,i=0;i<h;++i){for((n=c[i])||(c[i]=n=[0,2]),o=n[0],s=n[1],l=0;(l<t||1<s)&&l<10;)++l,r=yo(0,f),a=u.distance(i,r,e),(t<2||a<s)&&(o=r,s=a);n[0]=o,n[1]=s}return u},onionize:function(t){if(-1===t&&!this.fieldr||-1!==t&&!this.field)return this;var e,n,i,r,a,l,o,s,u,c,f=this,h=-1===t?f.fieldr:f.field,m=-1===t?f.src:f.dst,p=(-1===t?f.dst:f.src,-1===t?f.src:f.dstData.dilated||f.dst),d=-1===t?f.dstData.dilated||f.dst:f.src,g=-1===t?f.srcData:f.dstData,x=-1===t?f.dstData:f.srcData;if(f.randomize(1,t),-1!==t)for(m=m.bitmap(),e=p.bitmap(),n=m,m=f.patch*f.patch,l=new ca(m),o=new fa(m),s=new fa(h.length*(4===g.channels?6:4));n.filter(function(t){return!!t}).length;){for(i=function(t,e,n,i,r,a){var l,o,s,u,c,f,h,m,p,d=a>>1,a=e.length,g=new Array(a),x="dilate"===t?rt.max:rt.min,_="dilate"===t?-1/0:1/0;for(o=h=0;o<i;++o)for(l=0;l<n;++l,++h){for(p=_,m=0,u=-d;u<=d;++u)if(0<=(f=o+u)&&f<i)for(s=-d;s<=d;++s,++m)0<=(c=l+s)&&c<n&&(!r||r[m])&&(p=x(p,e[c+n*f]||0));g[h]=p}return g}("erode",n,g.width,g.height,null,3),u=0,c=(r=e.slice()).length;u<c;++u)1==(e[u]||0)-(n[u]||0)&&(r[u]=2);for(f._optimize(h,p,d,r,e,g,x,10,.5,rt.max(x.width,x.height),t),u=0,c=(a=n.slice()).length;u<c;++u)1==i[u]?a[u]=2:a[u]=rt.abs(n[u]-i[u]);for(u=0,c=s.length;u<c;++u)s[u]=0;f.expectation("average",l,o,s,t,a,null,!1),f.maximization(s,0,null),n=i}return f},_optimize:function(t,e,n,i,r,a,l,o,s,u,c){var f,h,m,p,d,g,x,_,y,v,b,w,C,A,S,D,I,R,L=e.points(),E=n.points(),M=t.length;for(u=rt.min(u,l.width,l.height),f=1;f<=o;++f){for(p=f-1&1?(m=M-1,-1):(m=0,1),h=0,_=m;h<M;++h,_+=p)b=L[_],r&&!r[b.index]||(w=b.x,C=b.y,I=(d=t[_])[0],R=d[1],(g=-1===(v=e.indexOf(w-p,C))?2:this.distance(_,t[v][0],c,i,r))<R&&(I=t[v][0],R=g),(g=-1===(v=e.indexOf(w,C-p))?2:this.distance(_,t[v][0],c,i,r))<R&&(I=t[v][0],R=g),d[0]=I,d[1]=R);for(h=0,_=m;h<M;++h,_+=p)if(b=L[_],!r||r[b.index]){for(w=b.x,C=b.y,I=(d=t[_])[0],R=d[1],S=(A=E[I]).x,D=A.y,x=u;1<=x&&!(-1!==(y=n.indexOf(S+yo(-x,x),D+yo(-x,x)))&&((g=y===I?R:this.distance(_,y,c,i,r))<R&&(I=y,R=g),1<=s));)x*=s;d[0]=I,d[1]=R}}return t},optimize:function(t,e,n,i){var r,a,l,o,s,u;return-1===i&&!this.fieldr||-1!==i&&!this.field?this:(r=this,a=-1===i?r.fieldr:r.field,l=-1===i?r.src:r.dstData.dilated||r.dst,o=-1===i?r.dstData.dilated||r.dst:r.src,s=-1===i?r.srcData:r.dstData,u=-1===i?r.dstData:r.srcData,r._optimize(a,l,o,null,null,s,u,t,e,n,i),r)},initialization:function(){return this.field&&this.initialize(1),this.fieldr&&this.initialize(-1),this},randomization:function(t){return this.field&&this.randomize(t,1),this.fieldr&&this.randomize(t,-1),this},onionization:function(){return this.field&&this.onionize(1),this.fieldr&&this.onionize(-1),this},optimization:function(t,e,n){return this.field&&this.optimize(t,e,n,1),this.fieldr&&this.optimize(t,e,n,-1),this},expectation:function(N,t,e,n,i,r,H,a){var l,o,s,u,c,f,h,m,p,d,g,x,_,y,v,b,w=this,C=w.field,A=w.fieldr,S=w.dstData.dilated||w.dst,D=w.src,U=w.dstData,z=w.srcData,I=S.points(),R=D.points(),L=U.width,E=U.height,M=z.width,T=z.height,O=(-1===i?A:C).length,G=w.patch>>>1;function F(t,e,n,i,r,a){if(0<i){var l,o,s,u,c=t.src.points(),f=t.srcData,h=f.data,m=t.src.attached.tex,p=0,d=0,g=0,x=0,_=0,y=0,v=function(t,e,n){for(var i,r=0,a=0,l=t[0],o=1;o<e;++o)l<(i=t[o])?(a=r,r=l,l=i):r<i?(a=r,r=i):a<i&&(a=i);return n*rt.min(1,e<2?l:(r+a)/2)}(n,i,.75)||1e-6;if(4===f.channels){for(l=0;l<i;++l)u=rt.exp(-n[l]/(2*v)),p+=h[(s=c[o=e[l]].index<<2)+0]*u,d+=h[s+1]*u,g+=h[s+2]*u,m&&(_+=m[o].gx*u,y+=m[o].gy*u),x+=u;r[(a*=6)+0]+=p,r[a+1]+=d,r[a+2]+=g,r[a+3]+=_,r[a+4]+=y,r[a+5]+=x}else{for(l=0;l<i;++l)u=rt.exp(-n[l]/(2*v)),p+=h[s=c[o=e[l]].index]*u,m&&(_+=m[o].gx*u,y+=m[o].gy*u),x+=u;r[(a*=4)+0]+=p,r[a+1]+=_,r[a+2]+=y,r[a+3]+=x}}}if("center"===N)if(-1===i)for(o=0;o<O;++o)l=(f=A[o])[0],(!r||r[I[l].index]&&2!==r[I[l].index])&&(s=f[1],t[0]=o,e[0]=s,F(w,t,e,b=1,n,l));else for(l=0;l<O;++l)(!r||r[I[l].index]&&2!==r[I[l].index])&&(o=(f=C[l])[0],s=f[1],t[0]=o,e[0]=s,F(w,t,e,b=1,n,l));else if("best"===N){if(-1===i){for(o=0;o<O;++o)if(l=(f=A[o])[0],!r||r[I[l].index]&&2!==r[I[l].index]){for(s=f[1],p=R[o],e[b=0]=10,g=-G;g<=G;++g)if(!((v=p.y+g)<0||T<=v))for(d=-G;d<=G;++d)(y=p.x+d)<0||M<=y||-1===(c=D.indexOf(y,v))||(x=(m=I[A[c][0]]).x-d,_=m.y-g,x<0)||L<=x||_<0||E<=_||-1===(u=S.indexOf(x,_))||!a&&r&&r[I[u].index]&&-1!==r[I[u].index]||(h=A[c][1])<e[0]&&(t[0]=c,e[0]=h,b=1);F(w,t,e,b,n,l)}}else for(l=0;l<O;++l)if(!r||r[I[l].index]&&2!==r[I[l].index]){for(o=(f=C[l])[0],s=f[1],m=I[l],e[b=0]=10,g=-G;g<=G;++g)if(!((_=m.y+g)<0||E<=_))for(d=-G;d<=G;++d)(x=m.x+d)<0||L<=x||-1===(u=S.indexOf(x,_))||!a&&r&&r[I[u].index]&&-1!==r[I[u].index]||(y=(p=R[C[u][0]]).x-d,v=p.y-g,y<0)||M<=y||v<0||T<=v||-1!==(c=D.indexOf(y,v))&&(h=C[u][1])<e[0]&&(t[0]=c,e[0]=h,b=1);F(w,t,e,b,n,l)}}else if(-1===i){for(o=0;o<O;++o)if(l=(f=A[o])[0],!r||r[I[l].index]&&2!==r[I[l].index]){for(s=f[1],p=R[o],b=0,g=-G;g<=G;++g)if(!((v=p.y+g)<0||T<=v))for(d=-G;d<=G;++d)(y=p.x+d)<0||M<=y||-1===(c=D.indexOf(y,v))||(x=(m=I[A[c][0]]).x-d,_=m.y-g,x<0)||L<=x||_<0||E<=_||-1===(u=S.indexOf(x,_))||!a&&r&&r[I[u].index]&&-1!==r[I[u].index]||(t[b]=c,e[b]=A[c][1],++b);F(w,t,e,b,n,l)}}else for(l=0;l<O;++l)if(!r||r[I[l].index]&&2!==r[I[l].index]){for(o=(f=C[l])[0],s=f[1],m=I[l],b=0,g=-G;g<=G;++g)if(!((_=m.y+g)<0||E<=_))for(d=-G;d<=G;++d)(x=m.x+d)<0||L<=x||-1===(u=S.indexOf(x,_))||!a&&r&&r[I[u].index]&&-1!==r[I[u].index]||(y=(p=R[C[u][0]]).x-d,v=p.y-g,y<0)||M<=y||v<0||T<=v||-1!==(c=D.indexOf(y,v))&&(t[b]=c,e[b]=C[u][1],++b);F(w,t,e,b,n,l)}return w},maximization:function(t,e,n){var i,r,a,l,o,s,u,c,f,h,m,p=this.field,d=this.dstData,g=d.data,x=this.dst,_=(d.dilated||x).points(),y=p.length,v=0,b=x.attached.tex,w=0,C=0;if(4===d.channels)for(i=0;i<y;++i)-1!==(r=d.dilated?x.indexOf(_[i].x,_[i].y):i)&&(a=_[i].index<<2,u=t[(l=6*i)+5])&&(c=ma(rt.round(t[l+0]/u),0,255),f=ma(rt.round(t[l+1]/u),0,255),h=ma(rt.round(t[l+2]/u),0,255),w+=m=((o=g[a+0]-c)*o+(s=g[a+1]-f)*s+(s=g[a+2]-h)*s)/195075,e<m&&C++,g[a+0]=c,g[a+1]=f,g[a+2]=h,b&&(b[r].gx=t[l+3]/u,b[r].gy=t[l+4]/u),++v);else for(i=0;i<y;++i)-1!==(r=d.dilated?x.indexOf(_[i].x,_[i].y):i)&&(a=_[i].index,u=t[(l=4*i)+3])&&(c=ma(rt.round(t[l+0]/u),0,255),w+=m=(o=g[a+0]-c)*o/65025,e<m&&C++,g[a+0]=c,b&&(b[r].gx=t[l+1]/u,b[r].gy=t[l+2]/u),++v);return n&&(n.delta=v?C/v:0,n.error=v?w/v:0),this},apply:function(t){if(this.field){var e=this.field,n=this.fieldr,i=this.patch*this.patch,r=this.dstData,a=new ca(i),i=new fa(i),l=t?String(t.reconstruct).toLowerCase():"best";-1===["center","best","average"].indexOf(l)&&(l="best");for(var o,s=0,u=(o=new fa(e.length*(4===r.channels?6:4))).length;s<u;++s)o[s]=0;n&&this.expectation(l,a,i,o,-1,null,null,!0),e&&this.expectation(l,a,i,o,1,null,null,!0),this.maximization(o,(t?t.threshold:0)||0,t)}return this},distance:function(N,H,t,e,U){var n,i,r,a,l,o,s,u,c,f,h,z,B,m,p,d,g,x,_,y,v,b,w,C,A,S,Y,k,D=this,P=-1===t?D.src:D.dstData.dilated||D.dst,j=-1===t?D.dstData.dilated||D.dst:D.src,X=-1===t?D.src:D.dst,W=-1===t?D.dst:D.src,$=-1===t?D.srcData:D.dstData,t=-1===t?D.dstData:D.srcData,q=D.patch,I=q>>>1,R=0,V=0,L=0,E=$.data,M=t.data,T=P.attached.tex,O=j.attached.tex,G=$.width,K=$.height,F=t.width,Z=t.height,t=P.points(),P=j.points(),J=t[N].x,Q=t[N].y,tt=P[H].x,et=P[H].y,nt=D._with_gradients,it=T&&O;if(4===$.channels){for(n=195075,r=((i=nt?10:1)-1)/i,l=-I;l<=I;++l)if(f=et+l,!((s=Q+l)<0||f<0||K<=s||Z<=f))if(W.has(null,f))for(u=s*G,h=f*F,a=-I;a<=I;++a)c=tt+a,(o=J+a)<0||c<0||G<=o||F<=c||e&&1===e[o+u]||(-1===(y=W.indexOf(c,f))?L+=1:(R+=((d=E[(z=o+u<<2)+0]-M[(B=c+h<<2)+0])*d+(g=E[z+1]-M[B+1])*g+(x=E[z+2]-M[B+2])*x)/(n*i),nt&&(it?R+=-1===(_=X.indexOf(o,s))||-1===y?r:r*((Y=T[_].gx-O[y].gx)*Y+(k=T[_].gy-O[y].gy)*k)/2:(0<=o-1&&o+1<G&&0<=c-1&&c+1<F?(v=128+(E[(p=o+1+u<<2)+0]-E[(m=o-1+u<<2)+0]>>1),b=128+(E[p+1]-E[m+1]>>1),w=128+(E[p+2]-E[m+2]>>1),b=w=v=ma(rt.round(.2126*v+.7152*b+.0722*w),0,255),C=128+(M[(p=c+1+h<<2)+0]-M[(m=c-1+h<<2)+0]>>1),A=128+(M[p+1]-M[m+1]>>1),S=128+(M[p+2]-M[m+2]>>1),R+=r*((d=v-(A=S=C=ma(rt.round(.2126*C+.7152*A+.0722*S),0,255)))*d+(g=b-A)*g+(x=w-S)*x)/(2*n)):R+=r/2,0<=s-1&&s+1<K&&0<=f-1&&f+1<Z?(v=128+(E[(p=o+(s+1)*G<<2)+0]-E[(m=o+(s-1)*G<<2)+0]>>1),b=128+(E[p+1]-E[m+1]>>1),w=128+(E[p+2]-E[m+2]>>1),b=w=v=ma(rt.round(.2126*v+.7152*b+.0722*w),0,255),C=128+(M[(p=c+(f+1)*F<<2)+0]-M[(m=c+(f-1)*F<<2)+0]>>1),A=128+(M[p+1]-M[m+1]>>1),S=128+(M[p+2]-M[m+2]>>1),R+=r*((d=v-(A=S=C=ma(rt.round(.2126*C+.7152*A+.0722*S),0,255)))*d+(g=b-A)*g+(x=w-S)*x)/(2*n)):R+=r/2)),++V));else L+=q}else for(n=65025,r=((i=nt?10:1)-1)/i,l=-I;l<=I;++l)if(f=et+l,!((s=Q+l)<0||f<0||K<=s||Z<=f))if(W.has(null,f))for(u=s*G,h=f*F,a=-I;a<=I;++a)c=tt+a,(o=J+a)<0||c<0||G<=o||F<=c||e&&1===e[o+u]||(-1===(y=W.indexOf(c,f))?L+=1:(R+=(d=E[z=o+u]-M[B=c+h])*d/(n*i),nt&&(it?R+=-1===(_=X.indexOf(o,s))||-1===y?r:r*((Y=T[_].gx-O[y].gx)*Y+(k=T[_].gy-O[y].gy)*k)/2:R=(R+=0<=o-1&&o+1<G&&0<=c-1&&c+1<F?r*((d=(v=128+(E[(p=o+1+u<<2)+0]-E[(m=o-1+u<<2)+0]>>1))-(C=128+(M[(p=c+1+h<<2)+0]-M[(m=c-1+h<<2)+0]>>1)))*d)/(2*n):r/2)+(0<=s-1&&s+1<K&&0<=f-1&&f+1<Z?r*((d=(v=128+(E[(p=o+(s+1)*G<<2)+0]-E[(m=o+(s-1)*G<<2)+0]>>1))-(C=128+(M[(p=c+(f+1)*F<<2)+0]-M[(m=c+(f-1)*F<<2)+0]>>1)))*d)/(2*n):r/2)),++V));else L+=q;return V?(L?1:0)+rt.min(R/V,1):1}},xo.serialize=function(t){return{dst:ua.Util.Image.Selection.serialize(t.dst),src:ua.Util.Image.Selection.serialize(t.src),patch:t.patch,_with_gradients:t._with_gradients,_needs_dilate:t._needs_dilate,field:t.field,fieldr:t.fieldr,texDst:t.dst.attached.tex,texSrc:t.src.attached.tex}},xo.unserialize=function(t,e,n){t=ua.Util.Image.Selection.unserialize(t,n.dst),e=ua.Util.Image.Selection.unserialize(e,n.src),t.attached.tex=n.texDst,e.attached.tex=n.texSrc;t=new xo(t,e,n.patch,n._with_gradients,n._needs_dilate);return t.field=n.field,t.fieldr=n.fieldr,t},xo.computeTexture=function(t,e){for(var n,i,r,a,l,o,s,u,c,f,h,m,p,d,g=e>>>1,x=t.data(),_=x.width,y=x.height,v=x.data,b=4===x.channels,w=t.points(),C=w.length,A=new Array(C),S=0;S<C;++S){for(n=(d=w[S]).x,i=d.y,a=r=-g,h=f=c=u=s=0;h<e;++h,++r)g<r&&(r=-g,++a),o=i+a,0<=(l=n+r)-1&&l+1<_&&0<=o&&o<y&&-1!==t.indexOf(l-1,o)&&-1!==t.indexOf(l+1,o)&&(++c,p=(m=l-1+o*_)+2,b?(m<<=2,p<<=2,s+=rt.abs(.2126*(v[p+0]-v[m+0])+.7152*(v[p+1]-v[m+1])+.0722*(v[p+2]-v[m+2]))/255):s+=rt.abs(v[p]-v[m])/255),0<=l&&l<_&&0<=o-1&&o+1<y&&-1!==t.indexOf(l,o-1)&&-1!==t.indexOf(l,o+1)&&(++f,p=(m=l+(o-1)*_)+2*_,b?(m<<=2,p<<=2,u+=rt.abs(.2126*(v[p+0]-v[m+0])+.7152*(v[p+1]-v[m+1])+.0722*(v[p+2]-v[m+2]))/255):u+=rt.abs(v[p]-v[m])/255);A[S]={gx:c?s/c:0,gy:f?u/f:0}}return A},xo.transferTexture=function(n,i,r,t,a,l){return null==a&&(a=1),null==l&&(l=a),n=n||new Array(i.points().length),t.points().forEach(function(t,e){t=i.indexOf(rt.floor(t.x/a),rt.floor(t.y/l));-1!==t&&(n[t]={gx:r[e].gx,gy:r[e].gy})}),n},(_o.ANNF=xo).patchmatch=_o,ua.Util.Filter.patchmatch=_o,w});
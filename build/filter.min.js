/**
*
*   FILTER.js
*   @version: 1.5.7
*   @built on 2023-08-13 11:30:22
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function q(){"use strict";var a,O,N,F,H,U,B,tt,et,nt,Y,z,P,X,k,L,$,rt,Q,it,J,j,W,K,at,ot,lt,Z,st,u,ut,ct,ft,ht,mt,pt,dt,gt,_t,vt,Ct,bt,St,At,Rt,It,Lt,c,Et,o,wt,Dt,h,Tt,Gt,Mt,Ot,Nt,Ft,m,p,Ht,Ut,Bt,d,Yt,zt,Pt,Xt,kt,$t,jt,Wt,qt,Vt,Kt,Zt,Qt,Jt,te,ee,g,ne,re,ie,ae,_,oe,le,se,ue,ce,fe,v,he,me,l,C,pe,de,ge,_e,ve,Ce,y,ye,xe,be,Se,Ae,Re,Ie,Le,Ee,we,De,Te,Ge,Me,Oe,Ne,Fe,He,Ue,Be,Ye,ze,Pe,Xe,ke,$e,je,V,D,We,qe,Ve,Ke,Ze,Qe,Je,tn,en,nn,rn,an,on,ln,sn,un,cn,fn,hn,mn,pn,dn,gn,_n,vn,Cn,yn,xn,bn,Sn,An,Rn,In,Ln,En,wn,Dn,Tn,Gn,Mn,On,Nn,Fn,x,Hn,Un,Bn,Yn,zn,Pn,Xn,kn,$n,jn,Wn,qn,Vn,Kn,Zn,Qn,Jn,tr,er,t,nr,rr,b,e,ir,ar,or,lr,sr,ur,n,cr,fr,hr,w,mr,pr,dr,gr,_r,vr,Cr,yr,xr,br,Sr,Ar,Rr,Ir,Lr,Er,wr,Dr,Tr,Gr,Mr,r,i,Or,Nr,Fr,Hr,Ur,Br,Yr,S,zr,Pr,Xr,kr,A,$r,jr,Wr,qr,Vr,Kr,Zr,Qr,Jr,R,ti,yt,xt,ei,ni,ri,ii,I={VERSION:"1.5.7"};function ai(t,e,n){arguments.length<2&&(e=t,t=null),N.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var r,i,a,o=N.call(e,"constructor")?e.constructor:function(){};for(r in t?(o[O]=Object.create(t[O]),o[O].$super=(i=t,a={},function(t,e){var n=":"+t;return 1===a[n]?(i[O].$super||F).call(this,t,e):(a[n]=1,t=("constructor"===t?i:i[O][t]||F).apply(this,e||[]),a[n]=0,t)})):o[O].$super=F,o[O].constructor=o,e)N.call(e,r)&&"constructor"!==r&&(o[O][r]=e[r]);if(n)for(r in n)N.call(n,r)&&(o[r]=n[r]);return o}function oi(t,e,n){return n<t?n:t<e?e:t}function li(t,e,n,r,i){n=n||0,r=r||0;for(var a,o=i?i-r+1:e.length,l=31&o,s=0;s<l;++s)t[s+n]=e[r+s];for(a=l;a<o;a+=32)t[(s=a)+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],t[++s+n]=e[r+s],++s}function si(t,e,n,r,F,i,H,U,B,a,Y,z){null==a&&(z=(a=1)*(Y=510));for(var o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,P,X,A,R,k,I,L,$,E,j,w,W,D,T,q=n.length,V=q>>>i,K=r-1,Z=F-1,G=new nt(V),M=1,O=1,N=r;O<Z&&!(K<=M&&(M=1,N+=r,Z<=++O));++M)_=(s=M+N)-1,v=s+1,b=(d=s-r)-1,C=1+d,x=(g=s+r)-1,y=g+1,u=t[s],c=e[s],f=J(u),h=J(c),T=it(f,h),D=Q(f,h),m=T?T*(1+.43*D/T*D/T):0,T=it(J(t[d]),J(e[d])),D=Q(J(t[d]),J(e[d])),d=T?T*(1+.43*D/T*D/T):0,T=it(J(t[g]),J(e[g])),D=Q(J(t[g]),J(e[g])),g=T?T*(1+.43*D/T*D/T):0,T=it(J(t[_]),J(e[_])),D=Q(J(t[_]),J(e[_])),_=T?T*(1+.43*D/T*D/T):0,T=it(J(t[v]),J(e[v])),D=Q(J(t[v]),J(e[v])),v=T?T*(1+.43*D/T*D/T):0,T=it(J(t[C]),J(e[C])),D=Q(J(t[C]),J(e[C])),C=T?T*(1+.43*D/T*D/T):0,T=it(J(t[y]),J(e[y])),D=Q(J(t[y]),J(e[y])),y=T?T*(1+.43*D/T*D/T):0,T=it(J(t[x]),J(e[x])),D=Q(J(t[x]),J(e[x])),x=T?T*(1+.43*D/T*D/T):0,T=it(J(t[b]),J(e[b])),D=Q(J(t[b]),J(e[b])),b=T?T*(1+.43*D/T*D/T):0,D=u*c<=0?h<=f?(p=f*m)>=J(c*C-(u+c)*v)&&p>J(c*x-(u+c)*_):(p=h*m)>=J(u*C-(c+u)*d)&&p>J(u*x-(c+u)*g):h<=f?(p=f*m)>=J(c*y+(u-c)*v)&&p>J(c*b+(u-c)*_):(p=h*m)>=J(u*y+(c-u)*g)&&p>J(u*b+(c-u)*d),G[s]=D?Y<=m?z:rt(a*m):0;if(H){for(l=M=0;M<r;++M)l+=G[M],G[M]=l;for(M=r,l=N=0;M<V;++M,++N)r<=N&&(l=N=0),l+=G[M],G[M]=G[M-r]+l;return G}if(i)for(M=0;M<q;M+=4)n[M]=n[M+1]=n[M+2]=0;else for(M=0;M<q;++M)n[M]=0;for(N=o=O=M=0;o<V;N=++o<<i,++M)if(r<=M&&(M=0,++O),!(0!==n[N]||G[o]<B)){S=M,A=O,w=N;do{for(n[w]=i?n[w+1]=n[w+2]=255:255,X=S===K?S:S+1,k=A===Z?A:A+1,I=P=0===S?S:S-1,L=R=0===A?A:A-1,E=$=R*r,W=0;I<=X&&L<=k;){if(w=(j=I+E)<<i,(L!==R||I!==P)&&0===n[w]&&G[j]>=U){S=I,A=L,W=1;break}E+=r,k<++L&&(L=A,E=$,++I)}}while(W)}return n}function ui(t,e,n){e=new RegExp("\\b"+e+"\\s+\\w+\\s+(\\w+)","ig");t.replace(st,"").replace(e,function(t,e){return n[e]=0,t})}function ci(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(at.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)}function fi(t,e){var n,r,i,a=this;if(a.vertexSource=Z,a.fragmentSource=t,a.uniform={},a.attribute={},ui(a.vertexSource,"attribute",a.attribute),ui(a.vertexSource,"uniform",a.uniform),ui(a.fragmentSource,"uniform",a.uniform),n=(t=ci(e,a.vertexSource,e.VERTEX_SHADER))?ci(e,a.fragmentSource,e.FRAGMENT_SHADER):null,t&&n)if(a.id=e.createProgram(),e.attachShader(a.id,t),e.attachShader(a.id,n),e.linkProgram(a.id),e.getProgramParameter(a.id,e.LINK_STATUS)){for(r in a.attribute)a.attribute[r]=e.getAttribLocation(a.id,r);for(i in a.uniform)a.uniform[i]=e.getUniformLocation(a.id,i)}else at.error(e.getProgramInfoLog(a.id)),e.deleteProgram(a.id),a.id=null}function hi(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),r}function mi(t,e){e&&t.deleteTexture(e)}function pi(t,e,n){e=hi(t,e,n),n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{fbo:n,tex:e}}function di(t,e){var n,r;e&&(n=t,(r=e.fbo)&&n.deleteFramebuffer(r),mi(t,e.tex))}function gi(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e||null,t.STATIC_DRAW),n}function _i(t,e){e&&t.deleteBuffer(e)}function vi(t,e,n,r,i,a,o){return o=o||hi(t,n,r),null!=i&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,o)),a?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,e),o}function Ci(t,e,n,r){return r=r||new at.ImArray(e*n<<2),t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,r),r}function yi(t,e,n,r){return"if ("+t+">"+e+") {"+n+"="+t+";"+t+"="+e+";"+e+"="+n+";}"}function xi(){}function bi(t){return t&&t.instance&&t.instance.isOn()}function Si(t,e,n){var r,i,a;return e/=100,e=(1-c.abs(2*(n/=100)-1))*e,r=c.floor((t=t/60)/2),r=e*(1-c.abs(t-2*r-1)),n=n-e/2,t=0<=t&&t<1?(i=e+n,a=r+n,0+n):1<=t&&t<2?(i=r+n,a=e+n,0+n):2<=t&&t<3?(i=0+n,a=e+n,r+n):3<=t&&t<4?(i=0+n,a=r+n,e+n):4<=t&&t<5?(i=r+n,a=0+n,e+n):(i=e+n,a=0+n,r+n),[h(c.round(255*i),0,255),h(c.round(255*a),0,255),h(c.round(255*t),0,255)]}function Ai(t,e,n){var e=(n/=100)*(1-e/200),r=c.min(e,1-e);return Si(t,0===r?0:100*(n-e)/r,100*e)}function Ri(t,e,n){n=1-n/100;return Ai(t,100-e/n,100*n)}function Ii(t,e,n,r,i){var a,o,l,s,u;return r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=c.max(t,e,n),s=l=c.min(t,e,n),u=1-r,n=0==(o=r-l)?0:a===t?60*(0+(e-n)/o):a===e?60*(2+(n-t)/o):60*(4+(t-e)/o),e=0==(t=(r+l)/2)||1==t?0:(a-t)/c.min(t,1-t),r=0===a?0:o/a,"hwb"===i?[h(c.round(n),0,360),h(100*s,0,100),h(100*u,0,100)]:"hsv"===i?[h(c.round(n),0,360),h(100*r,0,100),h(100*a,0,100)]:[h(c.round(n),0,360),h(100*e,0,100),h(100*t,0,100)]}function Li(t,e,n,r){return Ii(t,e,n,r,"hsl")}function Ei(t,e,n,r){return Ii(t,e,n,r,"hsv")}function wi(t,e,n,r){return Ii(t,e,n,r,"hwb")}function Di(t,e,n,r){return r&&(t=h(o(t*Nt),0,255),e=h(o(e*Nt),0,255),n=h(o(n*Nt),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((r=1-t*Mt)-(e=wt(r,t=1-e*Mt,r=1-n*Mt)))*(n=1/(1-e)),(t-e)*n,(r-e)*n,e]}function Ti(t,e,n,r){var i;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(i=1-r)+r)),n=255*(1-(n=n*i+r)),[h(o(255*(1-(t=t*i+r))),0,255),h(o(e),0,255),h(o(n),0,255)])}function Gi(t,e,n,r){2&(r=r||6)&&t.width!==e&&(t.width=e,t.oCanvas.width=+e,t._restorable)&&(t.iCanvas.width=t.oCanvas.width),4&r&&t.height!==n&&(t.height=n,t.oCanvas.height=+n,t._restorable)&&(t.iCanvas.height=t.oCanvas.height)}function Mi(t,e){var n=t.oCanvas.width,r=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d").getImageData(0,0,n,r),t.iData||(t.iData=t.iCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d").getImageData(0,0,n,r),t.oData||(t.oData=t.oCanvas.getContext("2d").createImageData(0,0,n,r)),t._refresh&=-3)}function Oi(t,e){var n,r,i,a,o,l,s;t.selection&&(n=t.selection,s=t.width-1,l=t.height-1,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4]?s:1,n=n[4]?l:1,r=+d(r*s),i=+d(i*n),l=(a=+d(a*s))-r+1,s=(o=+d(o*n))-i+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d").getImageData(r,i,l,s),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d").createImageData(0,0,l,s)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d").getImageData(r,i,l,s),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d").createImageData(0,0,l,s)),t._refresh&=-9)}function Ni(t,e){var e=e?De(e):"",t=De(t.filter||t),n=we?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(Se)}function Fi(t,e){e=e?Ke(e):"",t=Ke(t.filter||t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(D)}function Hi(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n];return e}function Ui(t,e){for(var n=[],r=[],i=[],a=t.length,o=e,l=o>>>1,s=0,u=0,c=0;c<a;)r.push(s-l),r.push(u-l),t[c]&&(n.push(s-l),n.push(u-l),i.push(t[c])),++c,o<=++s&&(s=0,++u);return[new mn(n),new mn(r),new fn(i)]}function Bi(t,e){for(var n=new Array(t),r=0,i=0;i<t;++i,++r)n[i]=e(r,0,t);return n}function Yi(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function zi(t,e){var n,r=t>>>1,i=new Array(t);if(e)for(n=0;n<t;++n)i[t-1-n]=n-r;else for(n=0;n<t;++n)i[n]=n-r;return i}function Pi(t){var e,n,r,i,a=wn.length;if(--t<a)e=wn[t];else for(e=wn[a-1];a<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,r=0,i=n.length-1;r<i;++r)e[r+1]=n[r]+n[r+1];e[n.length]=1,a<20&&wn.push(e),++a}return e.slice()}function Xi(t,e){return 1===e?pn(zi(t,1),Pi(t)):pn(Pi(t),zi(t,0))}function ki(t,e){return 1===e?pn(zi(t,1),Yi(t)):pn(Yi(t),zi(t,0))}function $i(t,e,n){e=e||1,n=n||e;for(var r=t*t,i=new fn(r),a=0;a<r;++a)i[a]=e;return i[r>>>1]=n,i}function ji(t){for(var e=t*t,n=new Fn(e),r=0;r<e;++r)n[r]=1;return n}function Wi(t,e,n,r,i,a,o,l,s,u,c){var f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I=e.length,L=r-1,E=(I>>>a)-r,w=e;if(e=n,n=w,Dn.MODE.GRAY===t){for(R=o.length,f=0;f<c;++f)for(w=e,e=n,n=w,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||L<b||S<0||E<S||(g=s(C=e[A=b+S<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}if(l)for(R=(o=l).length,f=0;f<c;++f)for(w=e,e=n,n=w,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||L<b||S<0||E<S||(g=s(C=e[A=b+S<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}}else{for(R=o.length,f=0;f<c;++f)for(w=e,e=n,n=w,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=v=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||L<b||S<0||E<S||(C=e[A=b+S<<2],y=e[A+1],x=e[A+2],g=s(C,g),_=s(y,_),v=s(x,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}if(l)for(R=(o=l).length,f=0;f<c;++f)for(w=e,e=n,n=w,p=m=h=0;p<I;p+=4,++h){for(r<=h&&(h=0,m+=r),g=_=v=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||L<b||S<0||E<S||(C=e[A=b+S<<2],y=e[A+1],x=e[A+2],g=s(C,g),_=s(y,_),v=s(x,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}}}function qi(t,e,n){t[e]=n,Ki(t,0,e)}function Vi(t,e){var n,r=t[e-1];if(e-1){n=t[0],t[0]=r;var i,a,o=t,l=0,s=t=e-1,t=l,e=o[l];for(i=2*l+1;i<s;)(a=i+1)<s&&o[i]>=o[a]&&(i=a),o[l]=o[i],i=2*(l=i)+1;return o[l]=e,Ki(o,t,l),n}return r}function Ki(t,e,n){for(var r,i,a=t[n];e<n&&a<(i=t[r=n-1>>>1]);)t[n]=i,n=r;t[n]=a}function Zi(t,e,n){var t=7&t,r=t<4?e:n,n=t<4?n:e;return(1&t?-r:r)+(2&t?-2*n:2*n)}function Qi(t,e){var n=.211324865,r=.366025403*(t+e),i=e+r,r=nr(t+r),i=nr(i),a=(r+i)*n,t=t-(r-a),e=e-(i-a),a=e<t?(c=1,0):(c=0,1),o=t-c+n,l=e-a+n,s=t-1+2*n,n=e-1+2*n,r=255&r,i=255&i,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*Zi(b[r+b[i]],t,e),t=.5-o*o-l*l,e=t<0?0:(t*=t)*t*Zi(b[r+c+b[i+a]],o,l),t=.5-s*s-n*n,c=t<0?0:(t*=t)*t*Zi(b[1+r+b[1+i]],s,n);return 40*(u+e+c)}function Ji(t){return t*t*t*(t*(6*t-15)+10)}function ta(t,e,n){return e+t*(n-e)}function ea(t,e){var n=nr(t),r=nr(e),t=t-n,e=e-r,i=t-1,a=e-1,o=n+1&255,l=r+1&255,s=Ji(e),u=Ji(t),n=ta(s,Zi(b[(n&=255)+b[r&=255]],t,e),Zi(b[n+b[l]],t,a)),t=ta(s,Zi(b[o+b[r]],i,e),Zi(b[o+b[l]],i,a));return.507*ta(u,n,t)}function na(t,e,n,r,i,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%a)*l,p*((i+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=f=~~(255*(.5*m/g+.5)),t[e+1]=f,t[e+2]=f,t[e+3]=255}function ra(t,e,n,r,i,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((r+c[_][0])%a)*l,p*((i+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=(f=~~(16777215*(.5*m/g+.5)))>>>16&255,t[e+1]=f>>>8&255,t[e+2]=255&f,t[e+3]=255}function ia(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_,v=1/a,C=1/o,y=f?ea:Qi,x=i?na:ra,b=t.length,S=e>>>1,A=n>>>1;if(u=u||1,c=c||.5,l=l||1,s=s||[[0,0]],r)for(g=m=h=0;g<b;g+=4,++h)e<=h&&(h=0,++m),d=A<m?n-1-m:m,(p=S<h?e-1-h:h)<h||d<m?(t[g]=t[_=d*e+p<<2],t[g+1]=t[1+_],t[g+2]=t[2+_],t[g+3]=255):x(t,g,y,p,d,e,n,v,C,l,s,u,c);else for(g=m=h=0;g<b;g+=4,++h)e<=h&&(h=0,++m),x(t,g,y,h,m,e,n,v,C,l,s,u,c);return t}!function(t,F,y){function e(){}function n(t,e){return t&&P?P.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t}function r(t){var e;return S?{file:__filename,path:__dirname}:R||I?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:U&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:L&&(e=document.getElementsByTagName("script"))&&e.length?((r.link=r.link?r.link:document.createElement("a")).href=e[e.length-1].src,{file:e=r.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var l,i="prototype",a=Object,o=Array,s=Function[i],a=a[i],o=o[i],H=(JSON.parse,JSON.stringify),u=a.hasOwnProperty,c=function(t,e){return function(){return t(e)}},f=s.call.bind(o.slice),s=a.toString,x=function(t){return"function"==typeof t},h=function(t,e){return t instanceof e},m=setTimeout,p=clearTimeout,o=y,d=60,g=0,_=1,v=2,C=3,b=4,a="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,S="undefined"!=typeof global&&"[object global]"===s.call(global),A=S&&void 0!==process.send,R=!a&&!S&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,I=!a&&!S&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,L=!(a||S||I||R||"undefined"==typeof navigator||"undefined"==typeof document),U=(L&&window.opener,L&&(window.self,window.top),"function"==typeof define&&define.amd),B=S||"function"==typeof Worker||"function"==typeof SharedWorker,E=S?t:R||I?self||t:window||t,Y=S?module.$deps:R||I?self||this:window||this,z=(S?global:R||I?self:window,A||R||I),w=A&&0===process.listenerCount("message")||R&&!E.onconnect||I&&!E.onmessage,D=w?function t(e){t.handler&&t.handler(A?e:e.data)}:e,T=null,G={},P=(S&&require("os").cpus().length,S?null:void 0!==E.webkitURL?E.webkitURL:void 0!==E.URL?E.URL:null),X=r(q.moduleUri).file,k=function(t,e){if(t=t||{},e)for(var n in e)u.call(e,n)&&(t[n]=e[n]);return t},$=0;G[X]=1,S?((l=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=l)[i]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((l=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=l)[i]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(l.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},l.Shared[i]={constructor:l.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),w&&(R?(E.close=e,E.postMessage=e,E.onconnect=function(t){var e=t.ports[0];E.close=function(){e.close()},E.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",D),e.start()}):I?E.onmessage=D:A&&(E.close=function(){process.exit()},E.postMessage=function(t){process.send(t)},E.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(Y)}catch(t){throw t}},process.on("message",D)));function M(t){if(!(this instanceof M))return new M(t);this.$id=(++$).toString(16),this.options=k({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},t)}M[i]={constructor:M,options:null,$id:null,$window:null,dispose:function(){var t=this;return t.$window&&t.close(),t.$window=null,t.$id=null,t.options=null,t},close:function(){var t=this;return t.$window&&(t.$window.closed||t.$window.close(),t.$window=null),t},ready:function(e,n){var r=this;return setTimeout(function t(){!r.$window||e&&!r.$window[e]?setTimeout(t,60):n()},0),r},open:function(t){var e=this;return!e.$window&&t&&(e.$window=window.open(t.push?n(["\ufeff"].concat(t),{type:"text/html;charset=utf-8"}):t,e.$id,function(t){var e,n=[];if(t)for(e in t)u.call(t,e)&&n.push(e+"="+(!0===t[e]||1===t[e]?"yes":!1===t[e]||0===t[e]?"no":t[e]));return n.join(",")}(e.options))),e},write:function(t){return this.$window&&t&&this.$window.document.write(t),this}};var O=function t(e){var r,n,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C;return e instanceof t?e:this instanceof t?(f=c=u=s=l=o=!1,m=0,p=1,_=g=d=h=a=i=n=null,v=y,(r=this).queue=function(t){return arguments.length?(n=t,r):n},r.jumpNext=function(t){n&&n.jumpNext(!1,t)},r.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},r.dispose=function(){n&&(n.dispose(),n=null)},r.task=function(t){return i=t,r},e&&r.task(e),r.run=C=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,v=i(),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,v},r.runWithArgs=function(t){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,v=i.apply(null,t),o=!0,i.jumpNext=null,i.abort=null,i.dispose=null,v},r.canRun=function(){return!!i&&!!(!o||l||s||u||c||f)&&!((l||s)&&d<=m||s&&!h||(u||c)&&v===g)},r.iif=function(t,e,n){return(t=x(t)?t():t)?r.task(e):2<arguments.length&&r.task(n),r},r.until=function(t){return v=y,g=t,u=s=l=f=!(c=!(h=null)),r.run=C,r},r.untilNot=function(t){return v=y,_=t,u=s=l=c=!(f=!(h=null)),r.run=C,r},r.loop=function(t,e,n){return v=y,m=e||0,p=n||1,d=t,u=s=f=c=!(l=!(h=null)),r.run=function(){var t=i(m);return m+=p,o=!0,v=t},r},r.each=function(t){return v=y,m=0,p=1,d=(h=t)&&t.length||0,u=l=f=c=!(s=!0),r.run=function(){var t=i(h[m],m);return++m,o=!0,v=t},r},r.recurse=function(t,e){return v=t,g=e,s=l=f=c=!(u=!(h=null)),r.run=function(){var t=i(v);return o=!0,v=t},r},r.isFinished=function(){var t=!o||f||c||l||s||u;return!(t=(t=(t=t&&(c||u)&&v===g?!1:t)&&f&&v!==_?!1:t)&&(l||s)&&d<=m?!1:t)},r.onComplete=function(t){return a=t||null,r},void(r.complete=function(){return a&&x(a)&&a(),r})):new t(e)};function j(t,e){var n,r=t.$queue,i=0;if(t.$runmode=_,r&&r.length){for(t.$running=!0;i<r.length;)(n=r[i])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(r.shift(),n.complete()):++i):r.shift();t.$running=!1,t.$timer=m(c(j,t),t.$interval)}}function W(t,e){var n,r=t.$queue;t.$runmode=b,r&&r.length&&((n=r[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(r.shift(),n.complete())):r.shift(),t.$running=!1,t.$timer=m(c(W,t),t.$interval))}function N(t,e){var n;return h(t,O)?t:x(t)?new O(t):h(this,N)?((n=this).$interval=arguments.length&&parseInt(t,10)||d,n.$timer=null,n.$runmode=g,n.$running=!1,n.$queue=[],void(w&&!1!==e&&n.initThread())):new N(t,e)}N.VERSION="0.5.2",N.Thread=l,N.Task=O,N.BrowserWindow=M,N.MODE={NONE:g,INTERLEAVE:_,LINEAR:v,PARALLEL:C,SEQUENCE:b},N.Platform={UNDEFINED:o,UNKNOWN:0,NODE:1,BROWSER:2},N.supportsMultiThreading=function(){return B},N.isPlatform=function(t){return 1===t?S:2===t?L:void 0},N.isThread=function(t,e){return e=!0!==e||w,1===t?e&&A:2===t?e&&(R||I):e&&z},N.path=r,N.blob=n,N.load=function(t,e,n){if(t){e&&e.length&&N.importScripts(e.join?e.join(","):e),t=t.split(".");for(var r=Y;t.length;)t[0]&&t[0].length&&r[t[0]]&&(r=r[t[0]]),t.shift();return r&&E!==r?x(r)?!1!==n?new r:r():r:void 0}return null},N.listen=w?function(t){D.handler=t}:e,N.send=w?function(t){E.postMessage(t)}:e,N.importScripts=w?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var r=t[e];r&&r.length&&1!==G[r]&&(E.importScripts(r),G[r]=1)}}:e,N.close=w?function(){E.close()}:e,N.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,N.serialize=function(r){r=r||new N(0,!1);function t(n){function t(){var t=this,e=arguments;r.step(function(){n.apply(t,e)}),r.$running||r.run(v)}return t.free=function(){return n},t}return t.free=function(){r&&r.dispose(),r=null},t},N[i]={constructor:N,$interval:d,$timer:null,$queue:null,$thread:null,$events:null,$runmode:g,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&p(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=g,e.$running=!1,w&&!0===t&&N.close(),e},empty:function(){var t=this;return t.$timer&&p(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=g,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,r){var i,a,o=this;if(!o.$thread){if(!B)throw o.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");a=S?(i="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),o.$events=o.$events||{},(r=o.$thread=new(!0===r?l.Shared:l)(X)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,o.$events&&o.$events[e]?o.$events[e](t):"console.log"!==e&&"console.error"!==e||N.log(("console.error"===e?a:i)+(t||"")))},r.onerror=function(t){if(!o.$events||!o.$events.error)throw new Error(a+t.toString());o.$events.error(t)},o.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return o},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return w&&(n.$events={},N.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),N.close())})),n},listen:function(t,e){return t&&x(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(w?N.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return h(t,O)?t:x(t)?O(t):void 0},iif:function(){var t=arguments,e=new O;return e.iif.apply(e,t)},until:function(){var t=f(arguments),e=new O(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=f(arguments),e=new O(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=f(arguments),e=new O(t.pop());return e.loop.apply(e,t)},each:function(){var t=f(arguments),e=new O(t.pop());return e.each.apply(e,t)},recurse:function(){var t=f(arguments),e=new O(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,r=n.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n}:(e<r.length&&(0<e&&r.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var r=this,i=r.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<i.length&&(0<e&&i.splice(0,e),r.run(r.$runmode,n)),r)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?m(function(){n.empty()},e):n.empty(),n}:(e&&0<e?m(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,b===t)W(n,e);else if(_===t)j(n,e);else if(v===t){var r,i=n,a=i.$queue;if(i.$runmode=v,a){for(;a.length&&(!a[0]||!a[0].canRun());)a.shift();a.length?(i.$running=!0,r=a.shift(),e?r.runWithArgs(e):r.run(),r.complete()):i.$running=!1}}else C===t&&((e=n).$runmode=C,e.$running=!1);return n}},w&&(N.log=function(t){N.send({event:"console.log",data:"string"!=typeof t?H(t):t})},N.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(T&&(x(T.dispose)&&T.dispose(),T=null),T=N.load(n.component,n.imports,n.asInstance));break;case"dispose":T&&(x(T.dispose)&&T.dispose(),T=null),N.close()}})),F.Asynchronous=N}(this,I),a=I,O="prototype",N=Object[O].hasOwnProperty,Object[O].toString,Object.defineProperty,r=Math,F=function(){},H=0,ai.Merge=function(){for(var t,e,n=arguments.length,r=n?arguments[0]:null,i=1;i<n;++i)for(t in e=arguments[i])N.call(e,t)&&(r[t]=e[t]);return r},a.Class=ai,a.Path=a.Asynchronous.path(q.moduleUri),a.uuid=function(t){return[t||"filter",(new Date).getTime(),++H].join("_")},a.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},e=a.Asynchronous,M=e.isPlatform(e.Platform.NODE),G=e.isPlatform(e.Platform.BROWSER),A=e.supportsMultiThreading(),i=e.isThread(null,!0),n=e.isThread(),R="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",t="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",E="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",(M=a.Browser={isNode:M,isBrowser:G,isWorker:i,isInsideWorker:n,supportsWorker:A,isPhantom:/PhantomJS/.test(R),isOpera:G&&/Opera|OPR\//.test(R),isFirefox:G&&/Firefox\//.test(R),isChrome:G&&/Chrome\//.test(R),isSafari:G&&/Apple Computer/.test(E),isKhtml:G&&/KHTML\//.test(R),isIE:G&&(/MSIE \d/.test(R)||/Trident\/\d/.test(R)),isEdge:G&&/Edg/.test(R),isGecko:G&&/gecko\/\d/i.test(R),isWebkit:G&&/WebKit\//.test(R),isMac_geLion:G&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(R),isMac_geMountainLion:G&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(R),isMobile:!1,isIOS:/AppleWebKit/.test(R)&&/Mobile\/\w+/.test(R),isWin:/windows/i.test(t),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=M.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(R),M.isMac=M.isIOS||/Mac/.test(t),M.isIE_lt8=M.isIE&&!n&&(null==document.documentMode||document.documentMode<8),M.isIE_lt9=M.isIE&&!n&&(null==document.documentMode||document.documentMode<9),M.isQtWebkit=M.isWebkit&&/Qt\/\d+\.\d+/.test(R),a.getPath=e.path,a.log=i?e.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},a.warning=function(t){a.log("WARNING: "+t)},a.error=function(t,e){if(a.log("ERROR: "+t),e)throw new Error(String(t))},a.devicePixelRatio=(G&&!n?window.devicePixelRatio:1)||1,a._notSupportClamp="undefined"==typeof Uint8ClampedArray||M.isOpera,a.Array=Array,a.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,a.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,a.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,a.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,a.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,a.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,a.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,a.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,a.ColorTable=a.ImArray=a._notSupportClamp?a.Array8U:Uint8ClampedArray,a.AffineMatrix=a.ColorMatrix=a.ConvolutionMatrix=a.Array32F,a.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26,COLORIZE:30,COLORIZEHUE:31,CHANNEL:32},a.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},a.POS={X:0,Y:1},a.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},a.LUMA=a.LUMA_YUV=a.LUMA_YIQ=new a.Array32F([.2126,.7152,.0722]),a.LUMA_YCbCr=new a.Array32F([.299,.587,.114]),a.LUMA_GREEN=new a.Array32F([0,1,0]),a.CONSTANTS=a.CONST={X:0,Y:1,Z:2,PI:r.PI,PI2:2*r.PI,PI_2:r.PI/2,toRad:r.PI/180,toDeg:180/r.PI},a.FORMAT={IMAGE:1024,DATA:2048},a.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[O].set,hasSubarray:"function"==typeof a.Array32F[O].subarray},Math:{},Filter:{},Image:{},GLSL:{}},a.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n},a.Canvas.Image=function(){return new Image},a.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},B=U=null,a.supportsGLSL=function(){if(null==U){var t,e=null,n=null,r=["webgl","experimental-webgl"],i=null;try{e=a.Canvas(1,1)}catch(t){e=null}if(e)for(t=0;t<r.length;++t){i=r[t],n=null;try{n=e.getContext(i)}catch(t){n=null}if(n)break}(U=!!n)&&(B=i)}return U},a.setGLDimensions=function(t,e,n){return t&&t.gl&&(t.gl.width!==e&&(t.gl.width=e),t.gl.height!==n)&&(t.gl.height=n),t},a.getGL=function(t,e,n){if(t&&a.supportsGLSL())return t.gl||(t.gl=a.Canvas(e,n)),a.setGLDimensions(t,e,n),t.gl.getContext(B)},tt=(A=I).MODE,E=A._notSupportClamp,et=A.ImArray,nt=A.Array32F,A.Array64F,A.Array32I,Y=A.Array16I,z=A.Array8U,P=A.ColorTable,X=A.ColorMatrix,k=A.AffineMatrix,A.ConvolutionMatrix,t=A.Util.Array=A.Util.Array||{},R=A.Util.String=A.Util.String||{},i=A.Util.Math=A.Util.Math||{},e=A.Util.Image=A.Util.Image||{},G=A.Util.Filter=A.Util.Filter||{},(L=Math).exp,$=L.sqrt,L.pow,L.ceil,rt=L.floor,L.log,L.sin,L.cos,Q=L.min,it=L.max,J=L.abs,L.PI,L.log2,j=/([.*+?^${}()|\[\]\/\\\-])/g,W=/^\s+|\s+$/g,K=/^function[^{]+{([\s\S]*)}$/,t.copy=t.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return li(e,t,0,0,t.length-1),e},t.typed=A.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},t.typed_obj=A.Browser.isNode?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t},t.arrayset_shim=li,t.arrayset=t.hasArrayset?function(t,e,n){t.set(e,n||0)}:li,t.subarray=t.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},i.clamp=oi,i.hypot=function(t,e,n){var r=it(t,e=e||0,n=n||0);return r?(r=J(r))*$((t/=r)*t+(e/=r)*e+(n/=r)*n):0},R.esc=function(t){return t.replace(j,"\\$1")},R.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(W,"")},R.function_body=function(t){return t.toString().match(K)[1]||""},e.crop=t.hasArrayset?function(t,e,n,r,i,a,o){a=Q(a,e-1),o=Q(o,n-1);for(var l,s=new et((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=o;++c,f+=e,h+=u)s.set(t.subarray(l=f+r<<2,l+u),h);return s}:function(t,e,n,r,i,a,o){a=Q(a,e-1),o=Q(o,n-1);for(var l,s=new et((n=a-r+1)*(o-i+1)<<2),u=n<<2,c=i,f=i*e,h=0;c<=o;++c,f+=e,h+=u)li(s,t,h,l=f+r<<2,l+u);return s},e.pad=t.hasArrayset?function(t,e,n,r,i,a,o){for(var l,r=e+(a=a||0)+(r=r||0),s=new et(r*(n+(o=o||0)+(i=i||0))<<2),u=e<<2,c=r<<2,f=a<<2,h=0,m=0,p=o*c;h<n;++h,m+=e,p+=c)s.set(t.subarray(l=m<<2,l+u),f+p);return s}:function(t,e,n,r,i,a,o){for(var l,r=e+(a=a||0)+(r=r||0),s=new et(r*(n+(o=o||0)+(i=i||0))<<2),u=e<<2,c=r<<2,f=a<<2,h=0,m=0,p=o*c;h<n;++h,m+=e,p+=c)li(s,t,f+p,l=m<<2,l+u);return s},e.interpolate=function(t,e,n,r,i){for(var a,o,l,s,u,c,f,h,m,p,d=r*i<<2,g=new et(d),_=(e-1)/r,v=(n-1)/i,C=e<<2,y=L.round,x=0,b=0,S=0,A=0,R=0,I=0;I<d;I+=4,++x,b+=_)r<=x&&(R=(S+=v)-(p=(b=x=0)|S),A=p*e),a=t[h=A+(p=0|b)<<2],o=t[4+h],l=t[h+C],s=t[h+C+4],g[I]=oi(y(a*(u=(1-(m=b-p))*(1-R))+o*(c=m*(1-R))+l*(f=R*(1-m))+s*(m=m*R)),0,255),a=t[1+h],o=t[5+h],l=t[h+C+1],s=t[h+C+5],g[I+1]=oi(y(a*u+o*c+l*f+s*m),0,255),a=t[2+h],o=t[6+h],l=t[h+C+2],s=t[h+C+6],g[I+2]=oi(y(a*u+o*c+l*f+s*m),0,255),a=t[3+h],o=t[7+h],l=t[h+C+3],s=t[h+C+7],g[I+3]=oi(y(a*u+o*c+l*f+s*m),0,255);return g},G.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,r=new P(256);if("function"==typeof t)for(n=0;n<256;++n)r[n]=0|oi(t(n),0,255);else for(n=0;n<256;++n)r[n]=0|oi(e+t*n,0,255);return r},G.ct_multiply=function(t,e){for(var n=new P(256),r=0;r<256;++r)n[r]=oi(t[oi(e[r],0,255)],0,255);return n},G.cm_eye=function(){return new X([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},G.cm_multiply=function(t,e){for(var n=new X(20),r=0;r<20;r+=5)n[r+0]=e[r]*t[0]+e[r+1]*t[5]+e[r+2]*t[10]+e[r+3]*t[15],n[r+1]=e[r]*t[1]+e[r+1]*t[6]+e[r+2]*t[11]+e[r+3]*t[16],n[r+2]=e[r]*t[2]+e[r+1]*t[7]+e[r+2]*t[12]+e[r+3]*t[17],n[r+3]=e[r]*t[3]+e[r+1]*t[8]+e[r+2]*t[13]+e[r+3]*t[18],n[r+4]=e[r]*t[4]+e[r+1]*t[9]+e[r+2]*t[14]+e[r+3]*t[19]+e[r+4];return n},G.cm_rechannel=function(t,e,n,r,i,a,o,l,s){var u=new X(20),o=5*o,l=5*l,s=5*s;return u[(a=5*a)+e]=t[0],u[a+n]=t[1],u[a+r]=t[2],u[a+i]=t[3],u[4+a]=t[4],u[o+e]=t[5],u[o+n]=t[6],u[o+r]=t[7],u[o+i]=t[8],u[4+o]=t[9],u[l+e]=t[10],u[l+n]=t[11],u[l+r]=t[12],u[l+i]=t[13],u[4+l]=t[14],u[s+e]=t[15],u[s+n]=t[16],u[s+r]=t[17],u[s+i]=t[18],u[4+s]=t[19],u},G.am_eye=function(){return new k([1,0,0,0,0,1,0,0])},G.am_multiply=function(t,e){var n=new k(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},G.cm_combine=function(t,e,n,r,i){i=i||Array,n=n||1,r=r||1;for(var a=0,o=t.length,l=new i(o);a<o;++a)l[a]=n*t[a]+r*e[a];return l},G.cm_convolve=function(t,e,n){n=n||Array;for(var r=t.length,i=(e=e===+e?[e]:e).length,a=new n(r*i),o=0,l=0;o<r;)a[o*i+l]=t[o]*e[l],++l>=i&&(l=0,++o);return a},G.integral_convolution=E?function(F,t,e,H,n,r,U,B,Y,i,a,z){var o,l,s,u,c,f,h,m,p,d,g,_,P,v,C,y,x,b,S,A,R,I,L,E,w,X,k,$,D,T,G=t.length,j=G>>>n,W=e<<n,M=1<<n,n=B*Y,q=-(B=B>>>1)-1,V=-(Y=e*(Y>>>1))-e,K=B,Z=Y,O=e-1,Q=j-e,N=t;if(t=new et(G),z=z||1,tt.GRAY===F)if(c=e,o=new nt(j),U)for(d=r[0],g=r[n>>>1]-d,_=U[0],P=U[n>>>1]-_,D=0;D<z;++D){for(T=t,t=N,N=T,m=l=h=f=0;m<e;m++,f+=M,++h)l+=t[f],o[h]=l;for(l=m=h=0,f=W;f<G;f+=M,++h,++m)e<=m&&(l=m=0),l+=t[f],o[h+c]=o[h]+l;for(f=p=m=0;f<G;f+=M,++m)e<=m&&(m=0,p+=e),w=d*(o[R=(y=O<(y=m+K)?O:y)+(x=Q<(x=p+Z)?Q:x)]-o[S=y+(C=(C=p+V)<0?0:C)]-o[A=(v=(v=m+q)<0?0:v)+x]+o[b=v+C])+g*t[f],$=_*(o[R]-o[S]-o[A]+o[b])+P*t[f],N[f]=0|(I=(I=i*w+a*$)<0?0:255<I?255:I),N[f+1]=0|I,N[f+2]=0|I,N[f+3]=t[f+3]}else for(d=r[0],g=r[n>>>1]-d,D=0;D<z;++D){for(T=t,t=N,N=T,m=l=h=f=0;m<e;m++,f+=M,++h)l+=t[f],o[h]=l;for(l=m=h=0,f=W;f<G;f+=M,++h,++m)e<=m&&(l=m=0),l+=t[f],o[h+c]=o[h]+l;for(f=p=m=0;f<G;f+=M,++m)e<=m&&(m=0,p+=e),w=d*(o[R=(y=O<(y=m+K)?O:y)+(x=Q<(x=p+Z)?Q:x)]-o[S=y+(C=(C=p+V)<0?0:C)]-o[A=(v=(v=m+q)<0?0:v)+x]+o[b=v+C])+g*t[f],N[f]=0|(I=(I=i*w+a)<0?0:255<I?255:I),N[f+1]=0|I,N[f+2]=0|I,N[f+3]=t[f+3]}else if(c=(e<<1)+e,o=new nt((j<<1)+j),U)for(d=r[0],g=r[n>>>1]-d,_=U[0],P=U[n>>>1]-_,D=0;D<z;++D){for(T=t,t=N,N=T,m=l=s=u=h=f=0;m<e;++m,f+=M,h+=3)l+=t[f],s+=t[f+1],u+=t[f+2],o[h]=l,o[h+1]=s,o[h+2]=u;for(l=s=u=m=h=0,f=W;f<G;f+=M,h+=3,++m)e<=m&&(l=s=u=m=0),l+=t[f],s+=t[f+1],u+=t[f+2],o[h+c]=o[h]+l,o[h+c+1]=o[h+1]+s,o[h+c+2]=o[h+2]+u;for(f=p=m=0;f<G;f+=M,++m)e<=m&&(m=0,p+=e),w=d*(o[R=((R=(y=O<(y=m+K)?O:y)+(x=Q<(x=p+Z)?Q:x))<<1)+R]-o[S=((S=y+(C=(C=p+V)<0?0:C))<<1)+S]-o[A=((A=(v=(v=m+q)<0?0:v)+x)<<1)+A]+o[b=((b=v+C)<<1)+b])+g*t[f],X=d*(o[R+1]-o[S+1]-o[A+1]+o[b+1])+g*t[f+1],k=d*(o[R+2]-o[S+2]-o[A+2]+o[b+2])+g*t[f+2],$=_*(o[R]-o[S]-o[A]+o[b])+P*t[f],L=(L=i*X+a*(_*(o[R+1]-o[S+1]-o[A+1]+o[b+1])+P*t[f+1]))<0?0:255<L?255:L,E=(E=i*k+a*(_*(o[R+2]-o[S+2]-o[A+2]+o[b+2])+P*t[f+2]))<0?0:255<E?255:E,N[f]=0|(I=(I=i*w+a*$)<0?0:255<I?255:I),N[f+1]=0|L,N[f+2]=0|E,N[f+3]=t[f+3]}else for(d=r[0],g=r[n>>>1]-d,D=0;D<z;++D){for(T=t,t=N,N=T,m=l=s=u=h=f=0;m<e;++m,f+=M,h+=3)l+=t[f],s+=t[f+1],u+=t[f+2],o[h]=l,o[h+1]=s,o[h+2]=u;for(l=s=u=m=h=0,f=W;f<G;f+=M,h+=3,++m)e<=m&&(l=s=u=m=0),l+=t[f],s+=t[f+1],u+=t[f+2],o[h+c]=o[h]+l,o[h+c+1]=o[h+1]+s,o[h+c+2]=o[h+2]+u;for(f=p=m=0;f<G;f+=M,++m)e<=m&&(m=0,p+=e),w=d*(o[R=((R=(y=O<(y=m+K)?O:y)+(x=Q<(x=p+Z)?Q:x))<<1)+R]-o[S=((S=y+(C=(C=p+V)<0?0:C))<<1)+S]-o[A=((A=(v=(v=m+q)<0?0:v)+x)<<1)+A]+o[b=((b=v+C)<<1)+b])+g*t[f],L=(L=i*(X=d*(o[R+1]-o[S+1]-o[A+1]+o[b+1])+g*t[f+1])+a)<0?0:255<L?255:L,E=(E=i*(k=d*(o[R+2]-o[S+2]-o[A+2]+o[b+2])+g*t[f+2])+a)<0?0:255<E?255:E,N[f]=0|(I=(I=i*w+a)<0?0:255<I?255:I),N[f+1]=0|L,N[f+2]=0|E,N[f+3]=t[f+3]}return N}:function(F,t,e,H,n,r,i,U,B,a,o,Y){var l,s,u,c,f,h,m,p,d,g,_,v,z,C,y,x,b,S,A,R,I,L,P,X,E,k,$,j,w,D,T=t.length,W=T>>>n,q=e<<n,G=1<<n,n=U*B,V=-(U=U>>>1)-1,K=-(B=e*(B>>>1))-e,Z=U,Q=B,M=e-1,O=W-e,N=t;if(t=new et(T),Y=Y||1,tt.GRAY===F)if(f=e,l=new nt(W),i)for(g=r[0],_=r[n>>>1]-g,v=i[0],z=i[n>>>1]-v,w=0;w<Y;++w){for(D=t,t=N,N=D,p=s=m=h=0;p<e;++p,h+=G,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=q;h<T;h+=G,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=G,++p)e<=p&&(p=0,d+=e),E=g*(l[I=(x=M<(x=p+Z)?M:x)+(b=O<(b=d+Q)?O:b)]-l[A=x+(y=(y=d+K)<0?0:y)]-l[R=(C=(C=p+V)<0?0:C)+b]+l[S=C+y])+_*t[h],j=v*(l[I]-l[A]-l[R]+l[S])+z*t[h],N[h]=0|(L=a*E+o*j),N[h+1]=0|L,N[h+2]=0|L,N[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,w=0;w<Y;++w){for(D=t,t=N,N=D,p=s=m=h=0;p<e;p++,h+=G,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=q;h<T;h+=G,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=G,++p)e<=p&&(p=0,d+=e),E=g*(l[I=(x=M<(x=p+Z)?M:x)+(b=O<(b=d+Q)?O:b)]-l[A=x+(y=(y=d+K)<0?0:y)]-l[R=(C=(C=p+V)<0?0:C)+b]+l[S=C+y])+_*t[h],N[h]=0|(L=a*E+o),N[h+1]=0|L,N[h+2]=0|L,N[h+3]=t[h+3]}else if(f=(e<<1)+e,l=new nt((W<<1)+W),i)for(g=r[0],_=r[n>>>1]-g,v=i[0],z=i[n>>>1]-v,w=0;w<Y;++w){for(D=t,t=N,N=D,p=s=u=c=m=h=0;p<e;++p,h+=G,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=q;h<T;h+=G,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=G,++p)e<=p&&(p=0,d+=e),E=g*(l[I=((I=(x=M<(x=p+Z)?M:x)+(b=O<(b=d+Q)?O:b))<<1)+I]-l[A=((A=x+(y=(y=d+K)<0?0:y))<<1)+A]-l[R=((R=(C=(C=p+V)<0?0:C)+b)<<1)+R]+l[S=((S=C+y)<<1)+S])+_*t[h],k=g*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+_*t[h+1],$=g*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+_*t[h+2],j=v*(l[I]-l[A]-l[R]+l[S])+z*t[h],P=a*k+o*(v*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+z*t[h+1]),X=a*$+o*(v*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+z*t[h+2]),N[h]=0|(L=a*E+o*j),N[h+1]=0|P,N[h+2]=0|X,N[h+3]=t[h+3]}else for(g=r[0],_=r[n>>>1]-g,w=0;w<Y;++w){for(D=t,t=N,N=D,p=s=u=c=m=h=0;p<e;++p,h+=G,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=q;h<T;h+=G,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=G,++p)e<=p&&(p=0,d+=e),E=g*(l[I=((I=(x=M<(x=p+Z)?M:x)+(b=O<(b=d+Q)?O:b))<<1)+I]-l[A=((A=x+(y=(y=d+K)<0?0:y))<<1)+A]-l[R=((R=(C=(C=p+V)<0?0:C)+b)<<1)+R]+l[S=((S=C+y)<<1)+S])+_*t[h],P=a*(k=g*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+_*t[h+1])+o,X=a*($=g*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+_*t[h+2])+o,N[h]=0|(L=a*E+o),N[h+1]=0|P,N[h+2]=0|X,N[h+3]=t[h+3]}return N},G.separable_convolution=E?function(F,t,e,H,n,U,r,i,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I,L,E,w=t.length,D=1<<n,T=e-1,G=(w>>>n)-e,M=new Y(i),O=0,N=i.length;O<N;O+=2)M[O+1]*=e;for(h=new Y(a),O=0,N=a.length;O<N;O+=2)h[O+1]*=e;if(L=2,s=U,u=i,I=B,f=M,c=t,t=new et(w),tt.GRAY===F)for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<w;m+=D,++d){for(e<=d&&(d=0,g+=e),p=O=S=A=R=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=T&&0<=v&&v<=G&&(srcOff=_+v<<2,b=s[O],S+=t[srcOff]*b);c[m]=0|(C=(C=I*S)<0?0:255<C?255:C),c[m+1]=0|C,c[m+2]=0|C,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}else for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<w;m+=D,++d){for(e<=d&&(d=0,g+=e),p=O=S=A=R=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=T&&0<=v&&v<=G&&(srcOff=_+v<<2,b=s[O],S+=t[srcOff]*b,A+=t[srcOff+1]*b,R+=t[srcOff+2]*b);y=(y=I*A)<0?0:255<y?255:y,x=(x=I*R)<0?0:255<x?255:x,c[m]=0|(C=(C=I*S)<0?0:255<C?255:C),c[m+1]=0|y,c[m+2]=0|x,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}return c}:function(F,t,e,H,n,U,r,i,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I,L,E,w=t.length,D=1<<n,T=e-1,G=(w>>>n)-e,M=new Y(i),O=0,N=i.length;O<N;O+=2)M[O+1]*=e;for(h=new Y(a),O=0,N=a.length;O<N;O+=2)h[O+1]*=e;if(L=2,s=U,u=i,I=B,f=M,c=t,t=new et(w),tt.GRAY===F)for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<w;m+=D,++d){for(e<=d&&(d=0,g+=e),p=O=S=A=R=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=T&&0<=v&&v<=G&&(srcOff=_+v<<2,b=s[O],S+=t[srcOff]*b);c[m]=0|(C=I*S),c[m+1]=0|C,c[m+2]=0|C,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}else for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<w;m+=D,++d){for(e<=d&&(d=0,g+=e),p=O=S=A=R=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=T&&0<=v&&v<=G&&(srcOff=_+v<<2,b=s[O],S+=t[srcOff]*b,A+=t[srcOff+1]*b,R+=t[srcOff+2]*b);y=I*A,x=I*R,c[m]=0|(C=I*S),c[m+1]=0|y,c[m+2]=0|x,c[m+3]=t[m+3]}s=r,u=a,I=o,f=h}return c},G.gradient=function(t,e,n,r,i,a,o,l,s,u,c,f){var h,m,p,d,g,_,v,C,y,x,b,S=r,A=t.length,R=e-1,I=n-1,L=1<<r,E=L<<1,w=e<<r,D=new nt(A=A>>>r),T=new nt(A);if(a){for(g=e-2,_=n-2,a=e<<1,b=new z(A),p=m=2,d=a;p<_&&!(g<=m&&(m=2,d+=e,_<=++p));++m)b[h=m+d]=(103*(2*t[(x=(y=(v=(h<<r)+i)-w)-w)-E]+4*t[x-L]+5*t[x]+4*t[x+L]+2*t[x+E]+4*t[y-E]+9*t[y-L]+12*t[y]+9*t[y+L]+4*t[y+E]+5*t[v-E]+12*t[v-L]+15*t[v]+12*t[v+L]+5*t[v+E]+4*t[(C=v+w)-E]+9*t[C-L]+12*t[C]+9*t[C+L]+4*t[C+E]+2*t[(x=C+w)-E]+4*t[x-L]+5*t[x]+4*t[x+L]+2*t[x+E])+8192&4294967295)>>>14&255;L=1,E=2,w=e,i=r=0}else b=t;for(p=m=1,d=e;p<I&&!(R<=m&&(m=1,d+=e,I<=++p));++m)D[h=d+m]=b[(y=(v=(h<<r)+i)-w)+L]-b[y-L]+(b[v+L]<<1)-(b[v-L]<<1)+b[(C=v+w)+L]-b[C-L],T[h]=b[y-L]-b[C-L]+(b[y]<<1)-(b[C]<<1)+b[y+L]-b[C+L];return si(D,T,t,e,n,S,o,l,s,u,c,f)},G.optimum_gradient=si,G.sat=function(t,e,n,r,i,a,o,l){for(var s,u,c,f,h,m=t.length,p=e<<r,d=(31&e)<<r,g=32<<r,_=1<<r,v=s=0,C=0,y=i;y<d;y+=_)v+=u=t[y],a[C]=v,s+=(l[C]=u)*u,o[C]=s,++C;for(c=d+i;c<p;c+=g)v+=u=t[y=c],a[C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,v+=u=t[y+=_],a[++C]=v,s+=(l[C]=u)*u,o[C]=s,++C;for(h=1,s=v=C=f=0,d+=p,y=p+i;y<d;y+=_)v+=u=t[y],a[C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++C,++f>=e&&(++h,v=s=f=0);for(c=d+i;c<m;c+=g)v+=u=t[y=c],a[C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++C+e]=a[C]+v,o[C+e]=o[C]+(s+=u*u),l[C+e]=l[C+1-e]+(u+t[C-e<<r])+(1<h?l[C-e-e]:0)+(0<f?l[C-1-e]:0),++C,++f>=e&&(++h,v=s=f=0)},G.histogram=function(t,e,n){e=e||0;for(var r,i=new nt(256),a=t.length,o=0,l=255,s=0,u=0;u<a;u+=4)++i[r=t[u+e]],l=Q(r,l),s=it(r,s);if(n)for(u=0;u<256;)o+=i[u],i[u++]=o,o+=i[u],i[u++]=o,o+=i[u],i[u++]=o,o+=i[u],i[u++]=o;return{bin:i,channel:e,min:l,max:s,total:a>>>2}},at=I,ot=Math,lt=at.Util.String.trim,n=at.Util.GLSL||{},Z=lt(["precision mediump float;","attribute vec2 pos;","attribute vec2 uv;","uniform vec2 resolution;","uniform float flipY;","varying vec2 pix;","void main(void) {","vec2 zeroToOne = pos / resolution;","vec2 zeroToTwo = zeroToOne * 2.0;","vec2 clipSpace = zeroToTwo - 1.0;","gl_Position = vec4(clipSpace * vec2(1.0, flipY), 0.0, 1.0);","pix = uv;","}"].join("\n")),M=lt(["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","void main(void) {","gl_FragColor = texture2D(img, pix);","}"].join("\n")),st=/\/\*.*?\*\//gim,n.DEFAULT=M,fi.prototype={constructor:fi,id:null,uniform:null,attribute:null,vertexSource:null,fragmentSource:null},n.run=function(F,t,e,n,r,H){h=F,p=r,null==(m=n)&&null==p&&(p=h.selection?(g=h.selection,d=h.width-1,B=h.height-1,_=g[0],Y=g[1],z=g[2],P=g[3],d=g[4]?d:1,g=g[4]?B:1,_=+ot.floor(_*d),Y=+ot.floor(Y*g),m=(z=+ot.floor(z*d))-_+1,(P=+ot.floor(P*g))-Y+1):(m=h.oCanvas.width,h.oCanvas.height));var i,a,o,l,s,u,c,f,U,h,m,p,B,d,g,_,Y,z,P,X,v,C,y=at.getGL(h,m,p),x=t.length,b=[null,null],S=[null,null],A=-1,R=-1,I=!1;if(y){for(o=0;o<x&&(t[o].shader&&A<0&&(A=o),t[x-1-o].shader&&R<0&&(R=x-1-o),!(0<=A&&0<=R));++o);for(U=F.cache,s=gi(y,new at.Array32F([0,0,n,0,0,r,0,r,n,0,n,r])),u=gi(y,new at.Array32F([0,0,1,0,0,1,0,1,1,0,1,1])),y.viewport(0,0,n,r),a=i=null,A<R&&(c=pi(y,n,r),f=pi(y,n,r)),o=0;o<x;++o)if(w=!1,w=(l=t[o]).shader&&(X=y,C=U,v=lt((v=l).shader),C=C[v]||(C[v]=new fi(v,X)))&&C.id?!0:w){o+1<x&&t[o+1].shader&&t[o+1]._usesPrev&&(mi(y,b[1]),b[1]=b[0],b[0]=vi(y,I?Ci(y,n,r):e,n,r)),v=o===A?{fbo:i=i||vi(y,e,n,r,0),tex:i}:c,X=o===R?a=a||pi(y,n,r):f,!I&&A<o&&vi(y,e,n,r,0,0,v.tex),Q=Z=V=O=N=K=q=M=G=W=j=$=k=T=D=w=E=L=void 0;var L=y,E=C,w=l,D=n,T=r,k=s,$=u,j=v,W=X,G=b,M=S,q=!1;L.useProgram(E.id),"pos"in E.attribute&&(L.enableVertexAttribArray(E.attribute.pos),L.bindBuffer(L.ARRAY_BUFFER,k),L.vertexAttribPointer(E.attribute.pos,2,L.FLOAT,!1,0,0)),"uv"in E.attribute&&(L.enableVertexAttribArray(E.attribute.uv),L.bindBuffer(L.ARRAY_BUFFER,$),L.vertexAttribPointer(E.attribute.uv,2,L.FLOAT,!1,0,0)),"resolution"in E.uniform&&L.uniform2f(E.uniform.resolution,D,T),"dp"in E.uniform&&L.uniform2f(E.uniform.dp,1/D,1/T),w.instance&&"mode"in E.uniform&&L.uniform1i(E.uniform.mode,w.instance.mode),w.vars&&w.vars(L,D,T,E),w.textures&&w.textures(L,D,T,E);for(var V,O,K=w.iterations||1,Z=!1,Q=K-1,N=0;N<K;++N)O=0===N?j:(M[0]=M[0]||pi(L,D,T),M[0]),N===Q?(V=W,Z=q):(M[1]=M[1]||pi(L,D,T),V=M[1]),"_img_prev_prev"in E.uniform&&G[1]&&(L.activeTexture(L.TEXTURE0+1+1),L.bindTexture(L.TEXTURE_2D,G[1]),L.uniform1i(E.uniform._img_prev_prev,2)),"_img_prev"in E.uniform&&("img"in E.uniform?G[0]&&(L.activeTexture(L.TEXTURE0+1+0),L.bindTexture(L.TEXTURE_2D,G[0]),L.uniform1i(E.uniform._img_prev,1)):(L.activeTexture(L.TEXTURE0+0),L.bindTexture(L.TEXTURE_2D,O.tex),L.uniform1i(E.uniform._img_prev,0))),"img"in E.uniform&&(L.activeTexture(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,O.tex),L.uniform1i(E.uniform.img,0)),L.uniform1f(E.uniform.flipY,Z?-1:1),L.bindFramebuffer(L.FRAMEBUFFER,V.fbo),L.viewport(0,0,D,T),L.drawArrays(L.TRIANGLES,0,6),O=M[0],M[0]=M[1],M[1]=O,Z=!1;k=c,c=f,f=k,I=!0}else l.instance&&(l._apply||l.instance._apply)&&($=I?Ci(y,n,r):e,e=(l._apply?l:l.instance)._apply($,n,r,H),l.instance.hasMeta&&(null!=l.instance.meta._IMG_WIDTH&&n!==l.instance.meta._IMG_WIDTH||null!=l.instance.meta._IMG_HEIGHT&&r!==l.instance.meta._IMG_HEIGHT)&&(n=l.instance.meta._IMG_WIDTH,r=l.instance.meta._IMG_HEIGHT,at.setGLDimensions(F,n,r),_i(y,s),s=gi(y,new at.Array32F([0,0,n,0,0,r,0,r,n,0,n,r])),y.viewport(0,0,n,r),di(y,c),di(y,f),di(y,S[0]),di(y,S[1]),S=[null,null],A<R)&&(c=pi(y,n,r),f=pi(y,n,r)),I=!1);return I&&Ci(y,n,r,e),_i(y,s),_i(y,u),mi(y,i),di(y,a),mi(y,b[1]),mi(y,b[0]),di(y,S[0]),di(y,S[1]),di(y,c),di(y,f),f=c=S=b=a=i=u=s=null,e}},n.uploadTexture=vi,n.getPixels=Ci,n.formatFloat=function(t,e){var n=t.toString();return(!e||t<0?"":"+")+n+(-1===n.indexOf(".")?".0":"")},n.formatInt=function(t,e){return t=ot.floor(t),(!e||t<0?"":"+")+t.toString()},n.staticSort=function(t,e,n){e=e||"temp",n=n||yi;for(var r,i,a,o,l,s,u=t.length,c=[],f=1;f<u;f<<=1)for(r=f<<1,i=f;1<=i;i>>>=1)for(a=i<<1,o=i%f;o<=u-1-i;o+=a)for(l=0,s=ot.min(i-1,u-o-i-1);l<=s;++l)ot.floor((l+o)/r)===ot.floor((l+o+i)/r)&&c.push(n(t[l+o],t[l+o+i],e));return c},at.Util.GLSL=n,u=I,ut="prototype",r=Object[ut],ct=Function[ut],ft=Array[ut],ht=r.hasOwnProperty,mt=Object.keys,r=Math,pt=u.Asynchronous,dt=pt.isPlatform(pt.Platform.NODE),pt.isPlatform(pt.Platform.BROWSER),pt.supportsMultiThreading(),gt=pt.isThread(null,!0),_t=pt.isThread(),vt=u.Path,Ct=u.Class.Merge,bt=u.Util.GLSL,u._notSupportClamp,u.log,St=r.min,At=r.max,Rt=0,r=u.FilterThread=u.Class(pt,{path:vt,name:null,_listener:null,_rand:null,constructor:function(){var n=this,r=null;gt&&n.initThread().listen("load",function(t){t&&t.filter&&(r&&(r.dispose(!0),r=null),r=pt.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&pt.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(t){var e;r&&t&&t.im?((e=t.im)[0]=u.Util.Array.typed(e[0],u.ImArray),t.params&&r.unserializeFilter(t.params),t.inputs&&r.unserializeInputs(t.inputs,e),e=r._apply(e[0],e[1],e[2]),n.send("apply",{im:!!r._update&&e,meta:r.hasMeta?r.metaData(!0):null})):n.send("apply",{im:null})}).listen("dispose",function(t){r&&(r.dispose(!0),r=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=dt?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",vt.file!==n.path.file?[vt.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:ft.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(pt.blob("function"==typeof t[n]?ct.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:ft.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),It=u.Filter=u.Class(r,{name:"Filter",constructor:function(){this.id=++Rt,this.inputs={},this.meta=null},_isOn:!0,_isGLSL:!1,_glsl:null,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._isGLSL=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t._glsl=null,t.$super("dispose"),t},worker:r[ut].thread,getParam:function(t){if(t&&"_"!==t.charAt(0)&&ht.call(this.constructor[ut],t))return this[t]},setParam:function(t,e){return t&&"_"!==t.charAt(0)&&ht.call(this.constructor[ut],t)&&(this[t]=e),this},metaData:function(t,e){return this.meta},getMetaData:function(t,e){return this.metaData(t,e)},setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){var n=this;return t=String(t),null===e?n.inputs[t]&&(delete n.inputs[t],n._glsl=null):(n.inputs[t]=[null,e,e.nref],n._glsl=null),n},unsetInput:function(t){return t=String(t),this.inputs[t]&&(delete this.inputs[t],this._glsl=null),this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,r,i=this.inputs,a=mt(i),o=a.length;if(!o)return null;for(r={},n=0;n<o;++n)(null==(e=i[a[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(e[2]=e[1].nref,r[a[n]]=t===e[1]||e[1].getSelectedData(1));return r},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,r=this.inputs,i=mt(t),a=i.length,o=u.ImArray,l=u.Util.Array.typed,s=0;s<a;++s)(n=t[i[s]])&&(!0===n?n=e:n[0]=l(n[0],o),r[i[s]]=[n,null,0]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,r,i){return this.selection=!1===t?null:i?[At(0,t||0),At(0,e||0),At(0,n||0),At(0,r||0),0]:[St(1,At(0,t||0)),St(1,At(0,e||0)),St(1,At(0,n||0)),St(1,At(0,r||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},isGLSL:function(){return this._isGLSL},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},makeGLSL:function(t){return this._isGLSL=!!(t=arguments.length?t:!0),this},GLSLCode:function(){return null==this._glsl&&(this._glsl=this.getGLSL()),this._glsl},getGLSL:function(){return{instance:this}},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply:function(t,e,n,r){return t},apply_:function(t,e,n,r,i){var a,o=this;return o.canRun()?o.$thread?(o._listener.cb=function(t){o._listener.cb=null,t&&t.im&&(e=u.Util.Array.typed(t.im,u.ImArray)),i(e,o)},o.send("apply",{im:[e,n,r,2],params:o.serializeFilter(),inputs:o.serializeInputs(t)})):(!_t&&o.isGLSL()&&u.supportsGLSL()?(a=o.GLSLCode())&&(a=(a=a.push||a.pop?a:[a]).filter(bi)).length&&(a=bt.run(t,a,e,n,r,{src:t,dst:t}))&&(e=a):e=o._apply(e,n,r,{src:t,dst:t}),i(e,o)):i(e,o),o},apply:function(t,e,n){var r,i,a,o,l,s=this;return s.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||s.onComplete,r=t.getSelectedData(),a=r[1],o=r[2],s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMetaData(t.meta,!0),t.im)&&s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(u.Util.Array.typed(t.im,u.ImArray))),n&&n.call(s)},s.send("apply",{im:r,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(!_t&&s.isGLSL()&&u.supportsGLSL()?(l=s.GLSLCode())&&(l=(l=l.push||l.pop?l:[l]).filter(bi)).length&&(i=bt.run(e,l,r[0],a,o,{src:t,dst:e}),s._update)&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),i)&&e.setSelectedData(i):(i=s._apply(r[0],a,o,{src:t,dst:e}),s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(i))),n&&n.call(s))),t},toString:function(){return"[FILTER: "+this.name+"("+this.id+")]"}}),u.Filter[ut].getInput=u.Filter[ut].input,u.Filter[ut].delInput=u.Filter[ut].unsetInput,u.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,r=u,i=0;i<n;++i){if(!r[e=t[i]])return null;r=r[e]}return r}return u[t]||null},u.Create=function(t){var e,n=(t=Ct({init:xi,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==It[ut].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==It[ut].getMetaData&&(t.metaData=t.getMetaData),delete t.init,ht.call(t,"apply")&&delete t.apply,u[n]=u.Class(It,t)},Lt=I,c=Math,Et=c.sqrt,o=c.round,c.floor,wt=c.min,Dt=c.max,c.abs,c.sin,c.cos,c.PI,h=Lt.Util.Math.clamp,Lt.Util.String.esc,Tt=Lt.Util.String.trim,Gt=Lt.LUMA,Lt.CHANNEL,Mt=1/255,Ot=100/255,Nt=2.55,Ft=["#define FORMAT_HWB 3","#define FORMAT_HSV 2","#define FORMAT_HSL 1","vec4 hsl2rgb(float h, float s, float l) {","   float c = (1.0 - abs(2.0*l - 1.0))*s;","   float hp = h/60.0;","   float d = float(floor(hp / 2.0));","   float x = c*(1.0 - abs(hp - 2.0*d - 1.0));","   float m = l - c/2.0;","   vec4 rgb = vec4(0.0,0.0,0.0,1.0);","   if (hp >= 0.0 && hp < 1.0) {","       rgb.r = c + m;","       rgb.g = x + m;","       rgb.b = m;","   } else if (hp >= 1.0 && hp < 2.0) {","       rgb.r = x + m;","       rgb.g = c + m;","       rgb.b = m;","   } else if (hp >= 2.0 && hp < 3.0) {","       rgb.r = m;","       rgb.g = c + m;","       rgb.b = x + m;","   } else if (hp >= 3.0 && hp < 4.0) {","       rgb.r = m;","       rgb.g = x + m;","       rgb.b = c + m;","   } else if (hp >= 4.0 && hp < 5.0) {","       rgb.r = x + m;","       rgb.g = m;","       rgb.b = c + m;","   } else {","       rgb.r = c + m;","       rgb.g = m;","       rgb.b = x + m;","   }","   return clamp(rgb, 0.0, 1.0);","}","vec4 hsv2rgb(float h, float s, float v) {","    float l = v*(1.0 - s/2.0);","    float lm = min(l, 1.0-l);","    if (0.0 == lm) return hsl2rgb(h, 0.0, l);","    else return hsl2rgb(h, (v-l)/lm, l);","}","vec4 hwb2rgb(float h, float w, float b) {","    float b1 = 1.0 - b;","    return hsv2rgb(h, 1.0 - w/b1, b1);","}","vec4 rgb2hslvwb(float r, float g, float b, int type) {","    float xmax = max(r, max(g, b));","    float xmin = min(r, min(g, b));","    float v = xmax;","    float c = xmax - xmin;","    float l = clamp((xmax + xmin)/2.0, 0.0, 1.0);","    float wh = clamp(xmin, 0.0, 1.0);","    float bl = clamp(1.0 - xmax, 0.0, 1.0);","    float h = 0.0;","    if (0.0 == c) {","        h = 0.0;","    } else if (v == r) {","        h = 60.0*((g - b)/c);","    } else if (v == g) {","        h = 60.0*(2.0 + (b - r)/c);","    } else {","        h = 60.0*(4.0 + (r - g)/c);","    }","    h = clamp(h, 0.0, 360.0);","   float sl; float sv;","    if (0.0 == l || 1.0 == l) {","        sl = 0.0;","    } else {","        sl = clamp((v - l)/min(l, 1.0 - l), 0.0, 1.0);","    }","    if (0.0 == v) {","        sv = 0.0;","    } else {","        sv = clamp(c/v, 0.0, 1.0);","    }","    v = clamp(v, 0.0, 1.0);","    if (FORMAT_HWB == type) return vec4(h, wh, bl, 1.0);","    else if (FORMAT_HSV == type) return vec4(h, sv, v, 1.0);","    return vec4(h, sl, l, 1.0);","}","vec4 rgb2hsl(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL);","}","vec4 rgb2hsv(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSV);","}","vec4 rgb2hwb(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HWB);","}","vec4 rgb2cmyk(float r, float g, float b) {","    if (0.0 == r && 0.0 == g && 0.0 == b) {","       return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float c = 1.0 - r;","    float m = 1.0 - g;","    float y = 1.0 - b;","    float minCMY = min(c, min(m, y));","    float invCMY = 1.0 / (1.0 - minCMY);","    return vec4(","        (c - minCMY) * invCMY,","        (m - minCMY) * invCMY,","        (y - minCMY) * invCMY,","        minCMY","    );","}","vec4 cmyk2rgb(float c, float m, float y, float k) {","    if (0.0 == c && 0.0 == m && 0.0 == y) {","        return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float minCMY = k;","    float invCMY = 1.0 - minCMY;","    c = c*invCMY + minCMY;","    m = m*invCMY + minCMY;","    y = y*invCMY + minCMY;","    return vec4(","        1.0 - c,","        1.0 - m,","        1.0 - y,","        1.0","    );","}","vec4 rgb2ycbcr(float r, float g, float b) {","    return clamp(vec4(","    0.0 + 0.299*r    + 0.587*g     + 0.114*b,","    0.5 - 0.168736*r - 0.331264*g  + 0.5*b,","    0.5 + 0.5*r      - 0.418688*g  - 0.081312*b,","    1.0","    ), 0.0, 1.0);","}","vec4 ycbcr2rgb(float y, float cb, float cr) {","    return clamp(vec4(","    y                      + 1.402   * (cr-0.5),","    y - 0.34414 * (cb-0.5) - 0.71414 * (cr-0.5),","    y + 1.772   * (cb-0.5),","    1.0","    ), 0.0, 1.0);","}","float rgb2hue(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL).x;","}","float rgb2sat(float r, float g, float b, int type) {","    return rgb2hslvwb(r, g, b, type).y;","}","float intensity(float r, float g, float b) {","    return clamp("+Gt[0]+"*r + "+Gt[1]+"*g + "+Gt[2]+"*b, 0.0, 1.0);","}"].join("\n"),(m=Lt.Color=Lt.Class({__static__:{GLSLCode:function(){return Ft},clamp:h,clampPixel:function(t){return wt(255,Dt(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,r){return(255&r)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},rgb24GL:function(t){var e=Lt.Util.GLSL.formatFloat;return"vec3("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255)].join(",")+");"},rgba32GL:function(t){var e=Lt.Util.GLSL.formatFloat;return"vec4("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255),e((t>>>24&255)/255)].join(",")+");"},intensity:function(t,e,n){return~~(Gt[0]*t+Gt[1]*e+Gt[2]*n)},hue:function(t,e,n){return t=t,e=e,n=n,r?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),i=r=c.max(t,e,n),a=c.min(t,e,n),h(c.round(0==(r=r-a)?0:i===t?60*(0+(e-n)/r):i===e?60*(2+(n-t)/r):60*(4+(t-e)/r)),0,360);var r,i,a},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(r=!(i="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=r=c.max(t,e,n),e=r-(t=c.min(t,e,n)),r=0==(n=(r+t)/2)||1==n?0:(a-n)/c.min(n,1-n),t=0===a?0:e/a,h("hsv"===i?100*t:100*r,0,100));var r,i,a},dist:function(t,e,n,r){var i=t[n+0]-e[r+0],a=t[n+1]-e[r+1],t=t[n+2]-e[r+2];return Et(i*i+a*a+t*t)},RGB2Gray:function(t,e){var n=Gt[0]*t[e+0]+Gt[1]*t[e+1]+Gt[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=.412453*n+.35758*r+.180423*i|0,t[e+1]=.212671*n+.71516*r+.072169*i|0,t[e+2]=.019334*n+.119193*r+.950227*i|0,t},XYZ2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,r=t[e+1]/255,i=t[e+2]/255,a=Math.log,o=.412453*n+.35758*r+.180423*i,l=.212671*n+.71516*r+.072169*i,n=.019334*n+.119193*r+.950227*i,r=a(.9465229*o+.2946927*l-.1313419*n),i=a(-.1179179*o+.992996*l+.007371554*n),a=a(.09230461*o-.04645794*l+.9946464*n);return t[e+0]=27.07439*r-22.80783*i-1.806681*a,t[e+1]=-5.646736*r-7.722125*i+12.86503*a,t[e+2]=-4.163133*r-4.579428*i-4.576049*a,t},ILL2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2],a=Math.exp,o=a(.021547742011105847*n-.021969518919866274*r-.07027206572176435*i),l=a(-.018152109501074376*n-.03004415376911152*r-.07729896865586937*i),a=a(-.0014378861182725712*n+.050053456205559545*r-.07724195758868482*i),n=1.0068824301911365*o-.2924918682640871*l+.13512537828457516*a,r=.12021888110585245*o+.9717816461525606*l+.008672665360769691*a,i=-.08782494811157235*o+.07253363731909634*l+.9932476695469974*a;return t[e+0]=3.240479*n-1.53715*r-.498535*i|0,t[e+1]=-.969256*n+1.875992*r+.041556*i|0,t[e+2]=.055648*n-.204043*r+1.057311*i|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=0+.299*n+.587*r+.114*i|0,t[e+1]=128-.168736*n-.331264*r+.5*i|0,t[e+2]=128+.5*n-.418688*r-.081312*i|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],r=t[e+1],i=t[e+2];return t[e+0]=n+1.402*(i-128)|0,t[e+1]=n-.34414*(r-128)-.71414*(i-128)|0,t[e+2]=n+1.772*(r-128)|0,t},RGB2HSV:function(t,e,n){var r=Ei(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HSL:function(t,e,n){var r=Li(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},RGB2HWB:function(t,e,n){var r=wi(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?r[0]:255*r[0]/360,t[e+1]=n?r[1]:2.55*r[1],t[e+2]=n?r[2]:2.55*r[2],t},HSV2RGB:function(t,e,n){n=Ai(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=Si(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=Ri(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,r=t[e+0],i=t[e+1],a=t[e+2];return 0===r&&0===i&&0===a||(n=wt(r=255-r,i=255-i,a=255-a),t[e+0]=(r-n)*(r=255===n?0:255/(255-n)),t[e+1]=(i-n)*r,t[e+2]=(a-n)*r),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:Mt,C2P:Ot,P2C:Nt,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*Ot+(e||"")},per2col:function(t){return t*Nt},rgb2hex:function(t,e,n,r,i){return i&&(t=h(o(t*Nt),0,255),e=h(o(e*Nt),0,255),n=h(o(n*Nt),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),r&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,r,i){return i&&(t=h(o(t*Nt),0,255),e=h(o(e*Nt),0,255),n=h(o(n*Nt),0,255),r=h(o(r*Nt),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(r=r<16?"0"+r.toString(16):r.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[h(parseInt(t[0]+t[0],16),0,255),h(parseInt(t[1]+t[1],16),0,255),h(parseInt(t[2]+t[2],16),0,255)]:[h(parseInt(t[0]+t[1],16),0,255),h(parseInt(t[2]+t[3],16),0,255),h(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:Si,hsv2rgb:Ai,hwb2rgb:Ri,rgb2hsl:Li,rgb2hsv:Ei,rgb2hwb:wi,rgb2cmyk:Di,cmyk2rgb:Ti,parse:function(t,e,n){var r,i,a,o,l,s,u,c,f=0,h=0;return"hsl"===e||!e&&(r=t.match(m.hslRE))?(c=(a=("hsl"===e?(o="hsla"===t[0].toLowerCase(),t[1]):(f=r[0].length,h=0,o="hsla"===r[1].toLowerCase(),r[2])).split(",").map(Tt))[0]||"0",t=a[1]||"0",l=a[2]||"0",u=o&&null!=a[3]?a[3]:"1",c=parseFloat(c,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*Ot,l="%"===l.slice(-1)?parseFloat(l,10):parseFloat(l,10)*Ot,u=parseFloat(u,10),c=(new m).fromHSL([c,t,l,u]),n?c:[c,0,f+h]):"rgb"===e||!e&&(r=t.match(m.rgbRE))?(l=(a=("rgb"===e?(o="rgba"===t[0].toLowerCase(),t[1]):(f=r[0].length,h=0,o="rgba"===r[1].toLowerCase(),r[2])).split(",").map(Tt))[0]||"0",s=a[1]||"0",i=a[2]||"0",u=o&&null!=a[3]?a[3]:"1",l="%"===l.slice(-1)?2.55*parseFloat(l,10):parseFloat(l,10),s="%"===s.slice(-1)?2.55*parseFloat(s,10):parseFloat(s,10),i="%"===i.slice(-1)?2.55*parseFloat(i,10):parseFloat(i,10),u=parseFloat(u,10),c=(new m).fromRGB([l,s,i,u]),n?c:[c,0,f+h]):"hex"===e||!e&&(r=t.match(m.hexRE))?(o=(a="hex"===e?m.hex2rgb(t[0]):(f=r[0].length,h=0,m.hex2rgb(r[1])))[0]||0,l=a[1]||0,s=a[2]||0,u=null!=a[3]?a[3]:255,c=(new m).fromHEX([o,l,s,u]),n?c:[c,0,f+h]):null},fromString:function(t,e){return m.parse(t,e,1)},fromRGB:function(t){return(new m).fromRGB(t)},fromHSL:function(t){return(new m).fromHSL(t)},fromHSV:function(t){return(new m).fromHSV(t)},fromHWB:function(t){return(new m).fromHWB(t)},fromCMYK:function(t){return(new m).fromCMYK(t)},fromHEX:function(t){return(new m).fromHEX(t)},fromPixel:function(t){return(new m).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new m;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=h(t[0],0,255)),null!=t[1]&&(this.col[1]=h(t[1],0,255)),null!=t[2]&&(this.col[2]=h(t[2],0,255)),null!=t[3]?this.col[3]=h(t[3],0,1):this.col[3]=1,this.kword=null),this},isTransparent:function(){return this.col[3]<1},fromPixel:function(t){return this.col=[h((t=t||0)>>16&255,0,255),h(t>>8&255,0,255),h(255&t,0,255),h((t>>24&255)*Mt,0,1)],this.kword=null,this},fromHEX:function(t){return this.col[0]=t[0]?h(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?h(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?h(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?h(parseInt(t[3],10)*Mt,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?h(o(t[0]),0,255):0,this.col[1]=t[1]?h(o(t[1]),0,255):0,this.col[2]=t[2]?h(o(t[2]),0,255):0,this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=Ti(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?h(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=Si(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=Ai(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=Ri(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?h(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var r=Di(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toHEX:function(t,e,n){return n?m.rgb2hexIE(this.col[0],this.col[1],this.col[2],h(o(255*this.col[3]),0,255)):m.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var r=this.col[3];return t?(e&&(r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var r=this.col[3],i=Li(this.col[0],this.col[1],this.col[2]);return t?(e&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=r<1&&0<r?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toString:function(t,e){return"rgb"==(t=t?t.toLowerCase():"hex")||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):this.toHEX(1,!1!==e,"hexie"==t)}})).toGray=m.intensity,A="prototype",p=I,i=p.CHANNEL,p.Color,Ht=p.Util.Array.copy,p.Util.Array.subarray,Ut=p.Util.Math.clamp,(Bt=Math).min,d=Bt.floor,Yt=0,i.R,i.G,i.B,i.A,(zt=p.Image=p.Class({name:"Image",constructor:function t(e){var n=this;if(!(n instanceof t))return new t(e);n.id=++Yt,n.width=0,n.height=0,n.iCanvas=p.Canvas(0,0),n.oCanvas=p.Canvas(0,0),n.domElement=n.oCanvas,n.iData=null,n.iDataSel=null,n.oData=null,n.oDataSel=null,n._restorable=!0,n.gray=!1,n.selection=null,n._refresh=0,n.nref=0,n.cache={},n._refresh|=15,e&&n.image(e)},id:null,width:0,height:0,gray:!1,selection:null,iCanvas:null,oCanvas:null,gl:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_refresh:0,nref:0,cache:null,dispose:function(){var t=this;return t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=t.gl=null,t._restorable=null,t._refresh=t.nref=null,t.cache=null,t},clone:function(t){return new zt(!0===t?this.iCanvas:this.oCanvas)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,r,i){var a=this,o=arguments.length;return!1===t?(a.selection=null,a.iDataSel=null,a.oDataSel=null,a._refresh&=-13):(o<1&&(t=0),o<2&&(e=0),o<3&&(n=1),o<4&&(r=1),a.selection=i?[t<0?0:t,e<0?0:e,n<0?0:n,r<0?0:r,0]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,r<0?0:1<r?1:r,1],a._refresh|=12),a.nref=(a.nref+1)%1e3,a},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d").drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),t.nref=(t.nref+1)%1e3),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d").drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),t.nref=(t.nref+1)%1e3),t},dimensions:function(t,e){var n=this;return t===n.width&&e===n.height||(Gi(n,t,e,6),n._refresh|=3,n.selection&&(n._refresh|=12),n.nref=(n.nref+1)%1e3),n},setDimensions:null,scale:function(t,e){var n,r,i=this,a=i.width,o=i.height;return t=t||1,e=e||t,1===t&&1===e||((r=(n=p.Canvas(+a,+o)).getContext("2d")).scale(t,e),a=i.width=Bt.round(t*a),o=i.height=Bt.round(e*o),r.drawImage(i.oCanvas,0,0),i.oCanvas.width=+a,i.oCanvas.height=+o,i.oCanvas.getContext("2d").drawImage(n,0,0),i._restorable&&(r.drawImage(i.iCanvas,0,0),i.iCanvas.width=i.oCanvas.width,i.iCanvas.height=i.oCanvas.height,i.iCanvas.getContext("2d").drawImage(n,0,0)),i._refresh|=3,i.selection&&(i._refresh|=12),i.nref=(i.nref+1)%1e3),i},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=p.Canvas(e,n),r=n.getContext("2d");return r.translate(e,0),r.scale(-1,1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(n,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=p.Canvas(e,n),r=e.getContext("2d");return r.translate(0,n),r.scale(1,-1),r.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(e,0,0),t._restorable&&(r.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d").clearRect(0,0,e,n),t.oCanvas.getContext("2d").clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3),t},crop:function(t,e,n,r){var i,a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height;if(arguments.length)l=n-(a=t)+1,s=r-(o=e)+1;else{if(!c)return u;n=c[4]?(i=f-1,h-1):i=1,a=d(c[0]*i),o=d(c[1]*n),l=d(c[2]*i)-a+1,s=d(c[3]*n)-o+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}u.width=l,u.height=s,a*=1,o*=1;t=p.Canvas(l*=1,s*=1),r=t.getContext("2d");return r.drawImage(u.oCanvas,a,o,l,s,0,0,l,s),u.oCanvas.width=l,u.oCanvas.height=s,u.oCanvas.getContext("2d").drawImage(t,0,0),u._restorable&&(r.drawImage(u.iCanvas,a,o,l,s,0,0,l,s),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.getContext("2d").drawImage(t,0,0)),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},fill:function(t,e,n,r,i){var a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height,f=((r&&!f||i&&!h)&&(Gi(u,e+r,n+i,6),f=u.width,h=u.height),s=c?(s=c[4]?(l=f-1,h-1):l=1,a=d(c[0]*l),o=d(c[1]*s),l=d(c[2]*l)-a+1,d(c[3]*s)-o+1):(o=a=0,l=f,h),null==n&&(n=o),l<(r=null==r?l:r)&&(r=l),s<(i=null==i?s:i)&&(i=s),e=Ut(e=null==e?a:e,a,l),n=Ut(n,o,s),u.oCanvas.getContext("2d")),h=u.iCanvas.getContext("2d");return e*=1,n*=1,r*=1,i*=1,t=t||0,u._restorable&&(h.fillStyle=t,h.fillRect(e,n,r,i)),f.fillStyle=t,f.fillRect(e,n,r,i),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&Mi(e,1),e.iData):(2&e._refresh&&Mi(e,2),e.oData);return Ht(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&Oi(e,4),e.iDataSel):(8&e._refresh&&Oi(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&Mi(e,1),e.iData):(2&e._refresh&&Mi(e,2),e.oData);return[Ht(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),e.nref=(e.nref+1)%1e3,e},setSelectedData:function(t){var e,n,r,i,a=this,o=a.selection,l=a.width,s=a.height;return o?(i=o[4]?(r=l-1,s-1):r=1,e=d(o[0]*r),n=d(o[1]*i),r=d(o[2]*r)-e+1,o=d(o[3]*i)-n+1,a.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,r,o),+e,+n)):a.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,+l,+s),0,0),a._refresh|=2,a.selection&&(a._refresh|=8),a.nref=(a.nref+1)%1e3,a},getDataFromSelection:function(t,e,n,r,i){var a=this.width-1,o=this.height-1,a=i?1:a,i=i?1:o;return t=+d(t*a),e=+d(e*i),o=(n=+d(n*a))-t+1,a=(r=+d(r*i))-e+1,n=(n=this.oCanvas.getContext("2d").getImageData(t,e,o,a))||this.oCanvas.getContext("2d").createImageData(0,0,o,a),[Ht(n.data),n.width,n.height,2]},setDataToSelection:function(t,e,n,r,i,a){var o=this,l=o.width-1,s=o.height-1,l=a?1:l,a=a?1:s;return e=+d(e*l),n=+d(n*a),s=(r=+d(r*l))-e+1,l=(i=+d(i*a))-n+1,o.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,s,l),e,n),o._refresh|=2,o.selection&&(o._refresh|=8),o.nref=(o.nref+1)%1e3,o},mapReduce:function(o,l,s){var u=this,c=0,f=0;return o.forEach(function(t,n){var r,i,a,e;t&&t.filter?(r=t.from||{x:0,y:0},i=t.to||{x:u.width-1,y:u.height-1},a=t.absolute,e=u.getDataFromSelection(r.x,r.y,i.x,i.y,a),t.filter.apply_(u,e[0],e[1],e[2],function(t,e){++c,l(u,t,r,i,a,e,n),c+f===o.length&&s&&s(u)})):++f}),f===o.length&&s&&s(u),u},image:function(t){var e,n,r,i,a,o;return t?(e=this,t instanceof zt&&(t=t.oCanvas),i="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,a=t instanceof e.oCanvas.constructor,o=t instanceof p.Canvas.Image().constructor,r=i?(n=t.videoWidth,t.videoHeight):(n=t.width,t.height),Gi(e,n,r,6),o||a||i?(e._restorable&&e.iCanvas.getContext("2d").drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d").drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d").putImageData(t,0,0),e.oCanvas.getContext("2d").putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),e.nref=(e.nref+1)%1e3,e):this},setImage:null,toImage:function(n,r){function t(t){var e;"uri"!==r?((e=p.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"("+this.id+")]"}})).load=function(t,e){var n=p.Canvas.Image(),r=new zt;return"onload"in n&&(n.onload=function(){r.image(n),"function"==typeof e&&e(r)}),n.src=t,r},zt[A].setImage=zt[A].image,zt[A].setDimensions=zt[A].dimensions,Pt=I,Object.prototype,Function.prototype,R=Array.prototype,Xt=R.slice,kt=R.splice,$t=R.push,(R=Pt.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:Pt.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,r=[],i=!1,a=0,o=n.length;a<o;++a)r.push(e=n[a].serializeInputs(t)),e&&(i=!0);return i?r:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,r=0,i=n.length;r<i;++r)t[r]&&n[r].unserializeInputs(t[r],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,r=t.length;n<r;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,r,i,a,o=this,l=o.filters;if(o._stable=t._stable,(n=(i=t.filters||[]).length)===(r=l.length)&&o._stable)for(e=0;e<n;++e)l[e].unserializeFilter(i[e]);else{for(e=0;e<r;++e)l[e]&&l[e].dispose(!0),l[e]=null;for(l=[],e=0;e<n;++e){if(!(a=i[e]&&i[e].filter?Pt.Filter.get(i[e].filter):null))throw new Error('Filter "'+i[e].filter+'" could not be created');l.push((new a).unserializeFilter(i[e]))}o.filters=l}return o},setMetaData:function(t,e){var n,r,i=this.filters;if(t&&t.filters&&(r=t.filters.length)&&i.length)for(n=0;n<r;++n)i[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this._glsl=null,this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this._glsl=null,this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&$t.apply(this.filters,arguments),this._glsl=null,this},concat:null,pop:function(){return this._glsl=null,this.filters.pop()},shift:function(){return this._glsl=null,this.filters.shift()},unshift:function(){return arguments.length&&kt.apply(this.filters,$t.apply([0,0],arguments)),this._glsl=null,this},insertAt:function(t){var e=Xt.call(arguments);e.length;return 1<argslen&&(e.shift(),kt.apply(this.filters,[t,0].concat(e)),this._glsl=null),this},removeAt:function(t){return this._glsl=null,this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this._glsl=null,this},reset:function(){return this.filters.length=0,this._glsl=null,this},empty:null,GLSLCode:function(){for(var t,e,n=this.filters,r=[],i=n.length,a=0;a<i;++a)(t=n[a])&&((e=t.GLSLCode())?e.push?r.push.apply(r,e):r.push(e):t._apply&&r.push({instance:t}));return r},_apply:function(t,e,n,r){var i=this,a=null,o=0,l=null,s=null;if(i.filters.length){r=r||{};for(var u,c=i.filters,f=c.length,a=new Array(f),h=0;h<f;++h)(u=c[h])&&u._isOn&&(r.container=i,r.index=h,t=u._apply(t,e,n,r),u.hasMeta)&&(a[o++]=[h,u=u.metaData()],null!=u._IMG_WIDTH)&&(l=e=u._IMG_WIDTH,s=n=u._IMG_HEIGHT)}return 0<o?(a.length>o&&(a.length=o),i.hasMeta=!0,i.meta={filters:a},null!=l&&(i.meta._IMG_WIDTH=l,i.meta._IMG_HEIGHT=s)):(i.hasMeta=!1,i.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,r=0;r<n;++r)e.push("\t"+t[r].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=R.prototype.filter,R.prototype.empty=R.prototype.reset,R.prototype.concat=R.prototype.push,Pt.CompositionFilter=Pt.CompositeFilter,t=I,jt=t.Util.Array.copy,Wt=t.Util.GLSL,qt=Math,Vt=qt.min,Kt=qt.round,Zt=t._notSupportClamp,Qt=t.Color.clampPixel,t.Create({name:"BlendFilter",init:function(t){this.set(t)},path:t.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this._glsl=null,this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),null!=e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this._glsl=null,this},getGLSL:function(){var u=this;if(!u.matrix||!u.matrix.length)return{instance:u,shader:Wt.DEFAULT};var t,e,n,c=["NORMAL","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLORDODGE","COLORBURN","HARDLIGHT","SOFTLIGHT","DIFFERENCE","EXCLUSION","AVERAGE","LINEARDODGE","LINEARBURN","NEGATION","LINEARLIGHT"],r=u.matrix,i="",a="";for(e=1,t=0;t<r.length;t+=4,++e)i+=(i.length?"\n":"")+"uniform sampler2D input"+e+";\nuniform vec2 inputSize"+e+";\nuniform int inputMode"+e+";\nuniform vec2 inputStart"+e+";\nuniform int inputEnabled"+e+";",a+=(a.length?"\n":"")+"col = doblend(col, pix, input"+e+", inputSize"+e+", inputStart"+e+", inputMode"+e+", inputEnabled"+e+");";return n=["precision mediump float;",c.map(function(t,e){return"LINEARDODGE"===t?"#define LINEARDODGE "+e+"\n#define ADD "+e:"LINEARBURN"===t?"#define LINEARBURN "+e+"\n#define SUBTRACT "+e:"#define "+t+" "+e}).join("\n"),Object.keys(te).map(function(t){return te[t]}).join("\n"),"float blend(int mode, float Dca, float Da, float Sca, float Sa) {","    if (MULTIPLY == mode) return multiply(Dca, Da, Sca, Sa);","    else if (SCREEN == mode) return screen(Dca, Da, Sca, Sa);","    else if (OVERLAY == mode) return overlay(Dca, Da, Sca, Sa);","    else if (DARKEN == mode) return darken(Dca, Da, Sca, Sa);","    else if (LIGHTEN == mode) return lighten(Dca, Da, Sca, Sa);","    else if (COLORDODGE == mode) return colordodge(Dca, Da, Sca, Sa);","    else if (COLORBURN == mode) return colorburn(Dca, Da, Sca, Sa);","    else if (HARDLIGHT == mode) return hardlight(Dca, Da, Sca, Sa);","    else if (SOFTLIGHT == mode) return softlight(Dca, Da, Sca, Sa);","    else if (DIFFERENCE == mode) return difference(Dca, Da, Sca, Sa);","    else if (EXCLUSION == mode) return exclusion(Dca, Da, Sca, Sa);","    else if (AVERAGE == mode) return average(Dca, Da, Sca, Sa);","    else if (LINEARDODGE == mode) return lineardodge(Dca, Da, Sca, Sa);","    else if (LINEARBURN == mode) return linearburn(Dca, Da, Sca, Sa);","    else if (NEGATION == mode) return negation(Dca, Da, Sca, Sa);","    else if (LINEARLIGHT == mode) return linearlight(Dca, Da, Sca, Sa);","    return normal(Dca, Da, Sca, Sa);","}","vec4 doblend(vec4 B, vec2 pix, sampler2D Atex, vec2 size, vec2 start, int mode, int enabled) {","    if (0 == enabled || pix.x < start.x || pix.y < start.y || pix.x > start.x+size.x || pix.y > start.y+size.y) return B;","    vec4 A = texture2D(Atex, (pix-start)/size);","    float a = 1.0;","    if (NORMAL != mode) a = clamp(A.a + B.a - A.a*B.a, 0.0, 1.0);","    else a = clamp(A.a + B.a*(1.0 - A.a), 0.0, 1.0);","    if (0.0 < a) return vec4(","        clamp(blend(mode, B.r*B.a, B.a, A.r*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.g*B.a, B.a, A.g*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.b*B.a, B.a, A.b*A.a, A.a)/a, 0.0, 1.0),","        a","    );","    return vec4(0.0);","}","varying vec2 pix;","uniform sampler2D img;",i,"void main(void) {","vec4 col = texture2D(img, pix);",a,"gl_FragColor = col;","}"].join("\n"),{instance:u,shader:n,textures:function(t,e,n,r){for(var i,a=u.matrix,o=1,l=0;l<a.length;l+=4,++o)i=u.input(o),Wt.uploadTexture(t,i[0],i[1],i[2],o)},vars:function(t,e,n,r){for(var i,a=u.matrix,o={ADD:"LINEARDODGE",SUBTRACT:"LINEARBURN"},l=1,s=0;s<a.length;s+=4,++l)i=u.input(l),t.uniform1i(r.uniform["input"+l],l),t.uniform2f(r.uniform["inputSize"+l],i[1]/e,i[2]/n),o[i=(a[s]||"normal").toUpperCase().replace("-","")]&&(i=o[i]),t.uniform1i(r.uniform["inputMode"+l],c.indexOf(i)),t.uniform2f(r.uniform["inputStart"+l],a[s+1]/e,a[s+2]/n),t.uniform1i(r.uniform["inputEnabled"+l],a[s+3]?1:0)}}},_apply:function(t,e,n){var r=this.matrix;if(!r||!r.length)return t;for(var i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I,L,E,w,D,T,G,M,F=r.length,O=(t.length,jt(t)),N=0,H=1;N<F;N+=4,++H)if(r[N+3]&&(A=r[N]||"normal",S=Jt[A])&&(p=this.input(H))&&(h=p[0],m=p[1],p=p[2],(o=r[N+1]||0)<(u=s=0)&&(s=-o,o=0),(l=r[N+2]||0)<0&&(u=-l,l=0),!(e<=o||n<=l||m<=s||p<=u||(o=Kt(o),l=Kt(l),s=Kt(s),u=Kt(u),c=Vt(e-o,m-s),f=Vt(n-l,p-u),c<=0)||f<=0)))if(y=l*e,b=u*m,d=(C=o)+c,g=(x=s)+c,Zt)for(_=0,v=f*c;_<v;++_)R=O[i=C+y<<2],I=O[i+1],L=O[i+2],E=O[i+3]/255,w=h[a=x+b<<2],D=h[a+1],T=h[a+2],G=h[a+3]/255,0<(M="normal"!==A?G+E-G*E:G+E*(1-G))?(O[i]=Qt(Kt(255*S(E*R/255,E,G*w/255,G)/M)),O[i+1]=Qt(Kt(255*S(E*I/255,E,G*D/255,G)/M)),O[i+2]=Qt(Kt(255*S(E*L/255,E,G*T/255,G)/M)),O[i+3]=Qt(Kt(255*M))):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++C>=d&&(C=o,y+=e),++x>=g&&(x=s,b+=m);else for(_=0,v=f*c;_<v;++_)R=O[i=C+y<<2],I=O[i+1],L=O[i+2],E=O[i+3]/255,w=h[a=x+b<<2],D=h[a+1],T=h[a+2],G=h[a+3]/255,0<(M="normal"!==A?G+E-G*E:G+E*(1-G))?(O[i]=Kt(255*S(E*R/255,E,G*w/255,G)/M),O[i+1]=Kt(255*S(E*I/255,E,G*D/255,G)/M),O[i+2]=Kt(255*S(E*L/255,E,G*T/255,G)/M),O[i+3]=Kt(255*M)):(O[i]=0,O[i+1]=0,O[i+2]=0,O[i+3]=0),++C>=d&&(C=o,y+=e),++x>=g&&(x=s,b+=m);return O}}),t.CombineFilter=t.BlendFilter,(Jt=t.Color.Blend={normal:function(t,e,n,r){return n+t*(1-r)},multiply:function(t,e,n,r){return n*t+n*(1-e)+t*(1-r)},screen:function(t,e,n,r){return n+t-n*t},overlay:function(t,e,n,r){return 2*t<=e?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-2*t*n-e*r},darken:function(t,e,n,r){return qt.min(n*e,t*r)+n*(1-e)+t*(1-r)},lighten:function(t,e,n,r){return qt.max(n*e,t*r)+n*(1-e)+t*(1-r)},"color-dodge":function(t,e,n,r){return n===r&&0===t?n*(1-e):n===r?r*e+n*(1-e)+t*(1-r):r*e*qt.min(1,t/e*r/(r-n))+n*(1-e)+t*(1-r)},"color-burn":function(t,e,n,r){return 0===n&&t===e?r*e+t*(1-r):0===n?t*(1-r):r*e*(1-qt.min(1,(1-(e?t/e:0))*r/n))+n*(1-e)+t*(1-r)},"hard-light":function(t,e,n,r){return 2*n<=r?2*n*t+n*(1-e)+t*(1-r):n*(1+e)+t*(1+r)-r*e-2*n*t},"soft-light":function(t,e,n,r){var i=e?t/e:0;return 2*n<=r?t*(r+(2*n-r)*(1-i))+n*(1-e)+t*(1-r):r<2*n&&4*t<=e?e*(2*n-r)*(16*qt.pow(i,3)-12*qt.pow(i,2)-3*i)+n-n*e+t:e*(2*n-r)*(qt.pow(i,.5)-i)+n-n*e+t},difference:function(t,e,n,r){return n+t-2*qt.min(n*e,t*r)},exclusion:function(t,e,n,r){return n*e+t*r-2*n*t+n*(1-e)+t*(1-r)},average:function(t,e,n,r){return(n+t)/2},add:function(t,e,n,r){return qt.min(1,n+t)},subtract:function(t,e,n,r){return qt.max(0,t+n-1)},negation:function(t,e,n,r){return 1-qt.abs(1-n-t)},"linear-light":function(t,e,n,r){return n<.5?Jt.subtract(t,e,2*n,r):Jt.add(t,e,2*(1-n),r)}})["linear-dodge"]=Jt.add,Jt["linear-burn"]=Jt.subtract,te={normal:"float normal(float Dca, float Da, float Sca, float Sa){return Sca + Dca * (1.0 - Sa);}",multiply:"float multiply(float Dca, float Da, float Sca, float Sa){return Sca*Dca + Sca*(1.0 - Da) + Dca*(1.0 - Sa);}",screen:"float screen(float Dca, float Da, float Sca, float Sa){return Sca + Dca - Sca * Dca;}",overlay:"float overlay(float Dca, float Da, float Sca, float Sa){if (2.0*Dca <= Da) return (2.0*Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - 2.0 * Dca * Sca - Da * Sa);}",darken:"float darken(float Dca, float Da, float Sca, float Sa){return min(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",lighten:"float lighten(float Dca, float Da, float Sca, float Sa){return max(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}","color-dodge":"float colordodge(float Dca, float Da, float Sca, float Sa){if (Sca == Sa && 0.0 == Dca) return (Sca * (1.0 - Da)); else if (Sca == Sa) return (Sa * Da + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sa * Da * min(1.0, Dca/Da * Sa/(Sa - Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","color-burn":"float colorburn(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (0.0 == Sca && Dca == Da) return (Sa * Da + Dca * (1.0 - Sa)); else if (0.0 == Sca) return (Dca * (1.0 - Sa)); else return (Sa * Da * (1.0 - min(1.0, (1.0 - m) * Sa/Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","hard-light":"float hardlight(float Dca, float Da, float Sca, float Sa){if (2.0 * Sca <= Sa) return (2.0 * Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - Sa * Da - 2.0 * Sca * Dca);}","soft-light":"float softlight(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (2.0 * Sca <= Sa) return (Dca * (Sa + (2.0 * Sca - Sa) * (1.0 - m)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else if (2.0 * Sca > Sa && 4.0 * Dca <= Da) return (Da * (2.0 * Sca - Sa) * (16.0 * pow(m, 3.0) - 12.0 * pow(m, 2.0) - 3.0 * m) + Sca - Sca * Da + Dca); else return (Da * (2.0 * Sca - Sa) * (pow(m, 0.5) - m) + Sca - Sca * Da + Dca);}",difference:"float difference(float Dca, float Da, float Sca, float Sa){return Sca + Dca - 2.0 * min(Sca * Da, Dca * Sa);}",exclusion:"float exclusion(float Dca, float Da, float Sca, float Sa){return (Sca * Da + Dca * Sa - 2.0 * Sca * Dca) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",average:"float average(float Dca, float Da, float Sca, float Sa){return (Sca + Dca) / 2.0;}",add:"float lineardodge(float Dca, float Da, float Sca, float Sa){return min(1.0, Sca + Dca);}",subtract:"float linearburn(float Dca, float Da, float Sca, float Sa){return max(0.0, Dca + Sca - 1.0);}",negation:"float negation(float Dca, float Da, float Sca, float Sa){return 1.0 - abs(1.0 - Sca - Dca);}","linear-light":"float linearlight(float Dca, float Da, float Sca, float Sa){if (Sca < 0.5) return linearburn(Dca, Da, 2.0*Sca, Sa); else return lineardodge(Dca, Da, 2.0*(1.0 - Sca), Sa);}"},ee=I,g=Math,ne=ee.Util.Image.crop,re=ee.Util.Image.pad,ie=ee.Util.Image.interpolate,ee.Create({name:"DimensionFilter",init:function(t,e,n,r,i){this.set(t,e,n,r,i)},path:ee.Path,mode:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!1,dispose:function(){return this.mode=null,this.$super("dispose"),this},serialize:function(){var t=this;return{mode:t.mode,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.mode,t.a,t.b,t.c,t.d),this},metaData:function(t){return this.meta},setMetaData:function(t,e){return this},set:function(t,e,n,r,i){var a=this;return t?(a.mode=String(t||"scale").toLowerCase(),a.a=e||0,a.b=n||0,a.c=r||0,a.d=i||0):(a.mode=null,a.a=0,a.b=0,a.c=0,a.d=0),a},reset:function(){return this.set(null)},_apply:function(t,e,n,r){var i=this,a=i.mode,o=i.a,l=i.b,s=i.c,u=i.d;if(i.meta=null,i.hasMeta=!1,a)switch(a){case"set":l=s&&u?(o=g.round(s*e),g.round(u*n)):(o=g.round(o),g.round(l)),t=new ee.ImArray(o*l<<2),i.meta={_IMG_WIDTH:o,_IMG_HEIGHT:l},i.hasMeta=!0;break;case"pad":o=g.round(o),l=g.round(l),s=g.round(s),u=g.round(u),t=re(t,e,n,s,u,o,l),i.meta={_IMG_WIDTH:l+u+n,_IMG_HEIGHT:o+s+e},i.hasMeta=!0;break;case"crop":o=g.round(o),l=g.round(l),s=g.round(s),u=g.round(u),t=ne(t,e,n,o,l,o+s-1,l+u-1),i.meta={_IMG_WIDTH:s,_IMG_HEIGHT:u},i.hasMeta=!0;break;default:l=s&&u?(o=g.round(s*e),g.round(u*n)):(o=g.round(o),g.round(l)),t=ie(t,e,n,o,l),i.meta={_IMG_WIDTH:o,_IMG_HEIGHT:l},i.hasMeta=!0}return t}}),_=(ae=I).CHANNEL,oe=ae.ColorTable,le=ae.Color.clampPixel,(e=Math).floor,se=e.pow,ue=e.exp,ce=1/255,fe=ae.Util.Array.typed,v=ae.Util.Filter.ct_eye,he=ae.Util.Filter.ct_multiply,me=ae.Util.GLSL,(e=ae.Create({name:"ColorTableFilter",init:function(t,e,n,r){var i=this;i.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,i.table[_.R]=t,i.table[_.G]=e,i.table[_.B]=n,i.table[_.A]=r},path:ae.Path,table:null,img:null,dispose:function(){return this.table=null,this.img=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[_.R],tableG:this.table[_.G],tableB:this.table[_.B],tableA:this.table[_.A]}},unserialize:function(t){var e=this;return e.table[_.R]=fe(t.tableR,oe),e.table[_.G]=fe(t.tableG,oe),e.table[_.B]=fe(t.tableB,oe),e.table[_.A]=fe(t.tableA,oe),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=v(t),e=e?v(e):t,n=n?v(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=v(0,0),n=v(0,0),r=v();break;case _.G:e=v(0,0),n=v(),r=v(0,0);break;default:_.R;e=v(),n=v(0,0),r=v(0,0)}return this.set(e,n,r)},redChannel:function(){return this.channel(_.R)},greenChannel:function(){return this.channel(_.G)},blueChannel:function(){return this.channel(_.B)},channelInvert:function(t){if(null==t)return this;var e,n,r;switch(t||_.R){case _.B:e=v(),n=v(),r=v(-1,255);break;case _.G:e=v(),n=v(-1,255),r=v();break;default:_.R;e=v(-1,255),n=v(),r=v()}return this.set(e,n,r)},redInvert:function(){return this.channelInvert(_.R)},greenInvert:function(){return this.channelInvert(_.G)},blueInvert:function(){return this.channelInvert(_.B)},invert:function(){return this.set(ae.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var r,i=(t=t.length?t:[t]).length,a=i+1,o=(e=e||t).length,l=o+1,s=(n=n||e).length,u=s+1,c=new oe(256),f=new oe(a),h=new oe(256),m=new oe(l),p=new oe(256),d=new oe(u),g=255/(a-1),_=255/(l-1),v=255/(u-1),C=0;C<a;++C)f[C]=g*C|0;for(t[0]=255*t[0]|0,C=1;C<i;++C)t[C]=t[C-1]+255*t[C]|0;for(C=0;C<l;++C)m[C]=_*C|0;for(e[0]=255*e[0]|0,C=1;C<o;++C)e[C]=e[C-1]+255*e[C]|0;for(C=0;C<u;++C)d[C]=v*C|0;for(n[0]=255*n[0]|0,C=1;C<s;++C)n[C]=n[C-1]+255*n[C]|0;for(C=0;C<256;++C){for(r=0;r<i&&C>t[r];)++r;for(c[C]=le(f[r]),r=0;r<o&&C>e[r];)++r;for(h[C]=le(m[r]),r=0;r<s&&C>n[r];)++r;p[C]=le(d[r])}return this.set(c,h,p)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){for(var e=new oe(t=(t=null==t?64:t)<2?2:t),n=255/(t-1),r=t/256,i=0;i<t;++i)e[i]=0|le(n*i);return this.set(v(function(t){return e[r*t|0]}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(v(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,r=255&t;return this.set(v(function(t){return t&e}),v(function(t){return t&n}),v(function(t){return t&r}))},replace:function(t,e){var n,r,i;return t==e?this:(n=v(),r=v(),i=v(),n[t>>>16&255]=e>>>16&255,r[t>>>8&255]=e>>>8&255,i[255&t]=255&e,this.set(n,r,i))},extract:function(t,e,n){if(!e||!e.length)return this;var r=v(0,(n=n||0)>>>16&255),i=v(0,n>>>8&255),a=v(0,255&n);switch(t||_.R){case _.B:for(s=e[0],f=e[1];s<=f;++s)a[s]=le(s);break;case _.G:for(s=e[0],f=e[1];s<=f;++s)i[s]=le(s);break;default:_.R;for(s=e[0],f=e[1];s<=f;++s)r[s]=le(s)}return this.set(r,i,a)},gammaCorrection:function(e,n,r){return e=e||1,n=n||e,r=r||n,e=1/e,n=1/n,r=1/r,this.set(v(function(t){return 255*se(ce*t,e)}),v(function(t){return 255*se(ce*t,n)}),v(function(t){return 255*se(ce*t,r)}))},exposure:function(e){return null==e&&(e=1),this.set(v(function(t){return 255*(1-ue(-e*t*ce))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(v(t+=1,128*(1-t)),v(e,128*(1-e)),v(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(v(1,t),v(1,e),v(1,n))},quickContrastCorrection:function(t){return this.set(v(null==t?1.2:+t))},set:function(t,e,n,r){var i,a,o,l,s=this;return t&&(a=(i=s.table)[_.R]||v(),e||n?(e=e||t,n=n||e,o=i[_.G]||a,l=i[_.B]||o,i[_.R]=he(t,a),i[_.G]=he(e,o),i[_.B]=he(n,l)):(i[_.R]=he(t,a),i[_.G]=i[_.R],i[_.B]=i[_.R]),s.img=null,s._glsl=null),s},reset:function(){return this.table=[null,null,null,null],this.img=null,this._glsl=null,this},getGLSL:function(){return(i=this).table&&i.table[_.R]?{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform int hasAlpha;","void main(void) {","   vec4 col = texture2D(img, pix);","   if (1 == hasAlpha) gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,texture2D(map, vec2(col.a, 0.0)).a);","   else gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,col.a);","}"].join("\n"),textures:function(t,e,n,r){me.uploadTexture(t,i.getImage(),256,1,1)},vars:function(t,e,n,r){t.uniform1i(r.uniform.map,1),t.uniform1i(r.uniform.hasAlpha,i.table[_.A]?1:0)}}:{instance:i,shader:me.DEFAULT};var i},combineWith:function(t){return this.set(t.getTable(_.R),t.getTable(_.G),t.getTable(_.B))},getTable:function(t){return this.table[t||_.R]||null},setTable:function(t,e){return this.table[e||_.R]=t||null,this.img=null,this},getImage:function(){var t=this.table;if(t&&t[_.R]&&!this.img){for(var e=t[_.R],n=t[_.G]||e,r=t[_.B]||n,i=t[_.A],a=new ae.Array8U(1024),o=0,l=0;o<1024;o+=4,++l)a[o]=e[l],a[o+1]=n[l],a[o+2]=r[l],a[o+3]=i?i[l]:255;this.img=a}return this.img},_apply:function(t,e,n){var r=this.table;if(r&&r[_.R]){var i,a,o=t.length,l=(15&o>>>2)<<2,s=r[0],u=r[1],c=r[2],f=r[3];if(f){for(i=0;i<l;i+=4)t[i]=s[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]],t[i+3]=f[t[i+3]];for(a=l;a<o;a+=64)t[i=a]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]],t[i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[i]=f[t[i++]]}else{for(i=0;i<l;i+=4)t[i]=s[t[i]],t[i+1]=u[t[i+1]],t[i+2]=c[t[i+2]];for(a=l;a<o;a+=64)t[i=a]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],t[++i]=s[t[i++]],t[i]=u[t[i++]],t[i]=c[t[i++]],++i}}return t},canRun:function(){return this._isOn&&this.table&&this.table[_.R]}})).prototype.posterize=e.prototype.levels=e.prototype.quantize,ae.TableLookupFilter=ae.ColorTableFilter,C=(l=I).CHANNEL,pe=l.ColorMatrix,de=l.Array8U,E=Math,ge=E.sin,_e=E.cos,ve=l.CONST.toRad,l.CONST.toDeg,Ce=l.Util.Array.typed,E=l._notSupportClamp,y=l.Util.Filter.cm_rechannel,ye=l.Util.Filter.cm_combine,xe=l.Util.Filter.cm_multiply,be=l.Util.GLSL,(E=l.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new pe(t):null},path:l.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=Ce(t.matrix,pe),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=C.A===(t=t||0)||e?1:0;return n[5*C.R+t]=C.R===t?1:e,n[5*C.G+t]=C.G===t?1:e,n[5*C.B+t]=C.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(C.R,t)},greenChannel:function(t){return this.channel(C.G,t)},blueChannel:function(t){return this.channel(C.B,t)},alphaChannel:function(t){return this.channel(C.A,!0)},maskChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return C.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(C.R)},invertGreen:function(){return this.invertChannel(C.G)},invertBlue:function(){return this.invertChannel(C.B)},invertAlpha:function(){return this.invertChannel(C.A)},invert:function(){return this.set(y([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},desaturate:function(t){t=t||l.LUMA;return this.set(y([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},grayscale:null,saturate:function(t,e){var e=e||l.LUMA,n=1-t,r=n*e[0],i=n*e[1],n=n*e[2];return this.set(y([r+t,i,n,0,0,r,i+t,n,0,0,r,i,n+t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},colorize:function(t,e,n){var r,i,n=n||l.LUMA;return this.set(y([(i=1-(e=null==e?1:e))+e*(r=(t>>16&255)/255)*n[0],e*r*n[1],e*r*n[2],0,0,e*(r=(t>>8&255)/255)*n[0],i+e*r*n[1],e*r*n[2],0,0,e*(r=(255&t)/255)*n[0],e*r*n[1],i+e*r*n[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(y([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},brightness:function(t,e,n){return this.set(y([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},adjustHue:function(t,e){var n=_e(t*=ve),t=ge(t),e=e||l.LUMA;return this.set(y([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},rotateHue:null,average:function(t,e,n){return this.set(y([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},quickContrastCorrection:function(t){return this.set(y([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set(y([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||l.LUMA;return this.set(y([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},threshold:function(t,e,n){null==e&&(e=256);var r=n||l.LUMA;return this.set(y(!1!==n?[r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,r[0]*e,r[1]*e,r[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],C.R,C.G,C.B,C.A,C.R,C.G,C.B,C.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,r){null==n&&(n=256);var i=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=r||l.LUMA;return C.A===t?(i[5*t+t]=n,i[5*t+4]=-n*e):(!1!==r?(i[5*t+C.R]=a[0]*n,i[5*t+C.G]=a[1]*n,i[5*t+C.B]=a[2]*n):(i[5*t+C.R]=n,i[5*t+C.G]=n,i[5*t+C.B]=n),i[5*t+4]=-(n-1)*e),this.set(i)},thresholdRed:function(t,e,n){return this.thresholdChannel(C.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(C.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(C.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(C.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set(y([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.XX,C.YY,C.ZZ,C.A))},XYZ2RGB:function(){return this.set(y([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],C.XX,C.YY,C.ZZ,C.A,C.R,C.G,C.B,C.A))},RGB2YCbCr:function(){return this.set(y([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.CB,C.CR,C.A))},YCbCr2RGB:function(){return this.set(y([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],C.Y,C.CB,C.CR,C.A,C.R,C.G,C.B,C.A))},RGB2YIQ:function(){return this.set(y([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],C.R,C.G,C.B,C.A,C.Y,C.IP,C.Q,C.A))},YIQ2RGB:function(){return this.set(y([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],C.Y,C.IP,C.Q,C.A,C.R,C.G,C.B,C.A))},blend:function(t,e){return this.matrix=this.matrix?ye(this.matrix,t.matrix,1-e,e,pe):new pe(t.matrix),this},set:function(t){var e=this;return e.matrix=e.matrix?xe(e.matrix,t):new pe(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){return{instance:a=this,shader:a.matrix?["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform float cm[20];","void main(void) {","   vec4 col = texture2D(img, pix);","   gl_FragColor.r = clamp(cm[0 ]*col.r+cm[1 ]*col.g+cm[2 ]*col.b+cm[3 ]*col.a+cm[4 ],0.0,1.0);","   gl_FragColor.g = clamp(cm[5 ]*col.r+cm[6 ]*col.g+cm[7 ]*col.b+cm[8 ]*col.a+cm[9 ],0.0,1.0);","   gl_FragColor.b = clamp(cm[10]*col.r+cm[11]*col.g+cm[12]*col.b+cm[13]*col.a+cm[14],0.0,1.0);","   gl_FragColor.a = clamp(cm[15]*col.r+cm[16]*col.g+cm[17]*col.b+cm[18]*col.a+cm[19],0.0,1.0);","}"].join("\n"):be.DEFAULT,vars:a.matrix?function(t,e,n,r){var i=a.matrix;t.uniform1fv(r.uniform.cm,new l.Array32F([i[0],i[1],i[2],i[3],i[4]/255,i[5],i[6],i[7],i[8],i[9]/255,i[10],i[11],i[12],i[13],i[14]/255,i[15],i[16],i[17],i[18],i[19]/255]))}:null};var a},combineWith:function(t){return this.set(t.matrix)},_apply:E?function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new pe(32),l=new de(4),s=new pe(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],s[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],s[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],s[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],s[0]=s[0]<0?0:255<s[0]?255:s[0],s[1]=s[1]<0?0:255<s[1]?255:s[1],s[2]=s[2]<0?0:255<s[2]?255:s[2],s[3]=s[3]<0?0:255<s[3]?255:s[3],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<i;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[5]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[6]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[7]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[9]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[10]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[11]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[13]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[14]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[15]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[17]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[18]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[19]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[21]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[22]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[23]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[25]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[26]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[27]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[29]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[30]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[31]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],o[0]=o[0]<0?0:255<o[0]?255:o[0],o[1]=o[1]<0?0:255<o[1]?255:o[1],o[2]=o[2]<0?0:255<o[2]?255:o[2],o[3]=o[3]<0?0:255<o[3]?255:o[3],o[4]=o[4]<0?0:255<o[4]?255:o[4],o[5]=o[5]<0?0:255<o[5]?255:o[5],o[6]=o[6]<0?0:255<o[6]?255:o[6],o[7]=o[7]<0?0:255<o[7]?255:o[7],o[8]=o[8]<0?0:255<o[8]?255:o[8],o[9]=o[9]<0?0:255<o[9]?255:o[9],o[10]=o[10]<0?0:255<o[10]?255:o[10],o[11]=o[11]<0?0:255<o[11]?255:o[11],o[12]=o[12]<0?0:255<o[12]?255:o[12],o[13]=o[13]<0?0:255<o[13]?255:o[13],o[14]=o[14]<0?0:255<o[14]?255:o[14],o[15]=o[15]<0?0:255<o[15]?255:o[15],o[16]=o[16]<0?0:255<o[16]?255:o[16],o[17]=o[17]<0?0:255<o[17]?255:o[17],o[18]=o[18]<0?0:255<o[18]?255:o[18],o[19]=o[19]<0?0:255<o[19]?255:o[19],o[20]=o[20]<0?0:255<o[20]?255:o[20],o[21]=o[21]<0?0:255<o[21]?255:o[21],o[22]=o[22]<0?0:255<o[22]?255:o[22],o[23]=o[23]<0?0:255<o[23]?255:o[23],o[24]=o[24]<0?0:255<o[24]?255:o[24],o[25]=o[25]<0?0:255<o[25]?255:o[25],o[26]=o[26]<0?0:255<o[26]?255:o[26],o[27]=o[27]<0?0:255<o[27]?255:o[27],o[28]=o[28]<0?0:255<o[28]?255:o[28],o[29]=o[29]<0?0:255<o[29]?255:o[29],o[30]=o[30]<0?0:255<o[30]?255:o[30],o[31]=o[31]<0?0:255<o[31]?255:o[31],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t}:function(t,e,n){var r=this.matrix;if(r){for(var i=t.length,a=(7&i>>>2)<<2,o=new pe(32),l=new de(4),s=new pe(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],s[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],s[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],s[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<i;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[1]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[2]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[3]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[5]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[6]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[7]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[9]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[10]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[11]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[13]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[14]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[15]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[17]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[18]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[19]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[21]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[22]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[23]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[25]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[26]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[27]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=r[0]*l[0]+r[1]*l[1]+r[2]*l[2]+r[3]*l[3]+r[4],o[29]=r[5]*l[0]+r[6]*l[1]+r[7]*l[2]+r[8]*l[3]+r[9],o[30]=r[10]*l[0]+r[11]*l[1]+r[12]*l[2]+r[13]*l[3]+r[14],o[31]=r[15]*l[0]+r[16]*l[1]+r[17]*l[2]+r[18]*l[3]+r[19],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=E.prototype.desaturate,E.prototype.rotateHue=E.prototype.adjustHue,E.prototype.threshold_rgb=E.prototype.thresholdRGB,E.prototype.threshold_alpha=E.prototype.thresholdAlpha,Se=I,Re=Se.MODE,Ie=Se.Util.GLSL,Le=Se.Color,Se.ColorMatrix,Ee=Se.Util.Array.typed,we=Se._notSupportClamp,De=Se.Util.String.function_body,Te=Object.prototype.hasOwnProperty,(G=Se.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:Se.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:Re.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=Ee(t.thresholds,Array),e.quantizedColors=Ee(t.quantizedColors,Array),!t._map&&t._mapName&&Te.call(Ae,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&Te.call(Ae,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Ae[n._mapName],n._mapInit=Ae["init__"+n._mapName],n._apply=Ni(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=Ni(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t._glsl=null,t},getGLSL:function(){var n,t,r,l=this;return l._map?Te.call(Ae,l._mapName)?"quantize"===l._mapName?(n=Ie.formatFloat,t=l.thresholds||[],r=l.quantizedColors||[],{instance:l,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","#define HUE "+Re.HUE,"#define SATURATION "+Re.SATURATION,"#define INTENSITY "+Re.INTENSITY,"#define COLOR "+Re.COLOR,"uniform int mode;",Le.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","void main(void) {","vec4 i = texture2D(img, pix);","vec4 o = vec4(i.r, i.g, i.b, i.a);","float v;","int found = 0;","if (0.0 != i.a) {","if (mode == HUE) v = rgb2hue(i.r, i.g, i.b)/360.0;","else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","else v = col24(i.r, i.g, i.b);",t.map(function(t,e){return"if (0 == found && v <= "+(t=(t=t)||0,Re.COLOR===l.mode?n(100*(t>>16&255)/255+10*(t>>8&255)/255+(255&t)/255):n(t/255))+") {found = 1; o.rgb = "+(e<r.length?Le.rgb24GL(r[e]):"vec3(1.0,1.0,1.0)")+";}"}).join("\n"),"gl_FragColor = o;","} else {","gl_FragColor = i;","}","}"].join("\n")}):{instance:l,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","#define HUE "+Re.HUE,"#define SATURATION "+Re.SATURATION,"#define INTENSITY "+Re.INTENSITY,"#define COLOR "+Re.COLOR,"uniform vec4 color;","uniform float minval;","uniform float maxval;","uniform int mapping;","uniform int mode;",Le.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","vec4 mask(vec4 i, float minval, float maxval, vec4 color) {","    float v = 0.0;","    if (0.0 != i.a) {","        if (mode == HUE) v = rgb2hue(i.r, i.g, i.b);","        else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","        else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","        else v = col24(i.r, i.g, i.b);","        if (v < minval || v > maxval) return color;","        else return i;","    } else {","        return i;","    }","}","void main(void) {","vec4 c = texture2D(img, pix);","vec4 o = vec4(c.r, c.g, c.b, c.a);","float v;","if (1 == mapping) {o.xyz = rgb2hsv(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (2 == mapping) {o.rgb = hsv2rgb(c.r, c.g, c.b).rgb;}","else if (3 == mapping) {o.xyz = rgb2hsl(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (4 == mapping) {o.rgb = hsl2rgb(c.r, c.g, c.b).rgb;}","else if (5 == mapping) {o.xyz = rgb2hwb(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (6 == mapping) {o.rgb = hwb2rgb(c.r, c.g, c.b).rgb;}","else if (7 == mapping) {o.xyz = rgb2cmyk(c.r, c.g, c.b).xyz;}","else if (8 == mapping) {v=rgb2hue(c.r, c.g, c.b)/360.0; o=vec4(v,v,v,c.a);}","else if (9 == mapping) {v=rgb2sat(c.r, c.g, c.b, FORMAT_HSV); o=vec4(v,v,v,c.a);}","else if (10 == mapping) {o = mask(c, minval, maxval, color);}","gl_FragColor = o;","}"].join("\n"),vars:function(t,e,n,r){var i=l.thresholds||[0,0],a=(l.quantizedColors||[0])[0]||0,o=i[0]||0,i=i[1]||0;t.uniform4f(r.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255),t.uniform1f(r.uniform.minval,Re.COLOR===l.mode?100*(o>>16&255)/255+10*(o>>8&255)/255+(255&o)/255:o),t.uniform1f(r.uniform.maxval,Re.COLOR===l.mode?100*(i>>16&255)/255+10*(i>>8&255)/255+(255&i)/255:i),t.uniform1i(r.uniform.mapping,"rgb2hsv"===l._mapName?1:"hsv2rgb"===l._mapName?2:"rgb2hsl"===l._mapName?3:"hsl2rgb"===l._mapName?4:"rgb2hwb"===l._mapName?5:"hwb2rgb"===l._mapName?6:"rgb2cmyk"===l._mapName?7:"hue"===l._mapName?8:"saturation"===l._mapName?9:"mask"===l._mapName?10:0)}}:{instance:l,shader:l._map.shader,vars:l._map.vars,textures:l._map.textures}:{instance:l,shader:Ie.DEFAULT}},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=G.prototype.quantize,G.prototype.extract=G.prototype.mask,Ae={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},Me=(Ge=I).ImArray,Oe=Ge.AffineMatrix,Ne=Ge.Util.Array.typed,Fe=Ge.Util.GLSL,He=Ge.MODE,Ge.CONST.toRad,M=Math,Ue=M.sin,Be=M.cos,Ye=M.tan,ze=Ge.Util.Filter.am_multiply,(M=Ge.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new Oe(t):null},path:Ge.Path,matrix:null,mode:He.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=Ne(t.matrix,Oe),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=Ue(t),t=Be(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?Ye(t):0,0,0,e?Ye(e):0,1,0,0])},set:function(t){var e=this;return e.matrix=e.matrix?ze(e.matrix,t):new Oe(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){var o=this,t=o.matrix;return o.color,{instance:o,shader:t?["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform float am[6];","uniform vec4 color;","#define IGNORE "+He.IGNORE,"#define CLAMP "+He.CLAMP,"#define COLOR "+He.COLOR,"#define WRAP "+He.WRAP,"uniform int mode;","void main(void) {","   vec2 p = vec2(am[0]*pix.x+am[1]*pix.y+am[2], am[3]*pix.x+am[4]*pix.y+am[5]);","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (COLOR == mode) {gl_FragColor = color;}","       else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","       else if (WRAP == mode) {","           if (0.0 > p.x) p.x += 1.0;","           if (1.0 < p.x) p.x -= 1.0;","           if (0.0 > p.y) p.y += 1.0;","           if (1.0 < p.y) p.y -= 1.0;","           gl_FragColor = texture2D(img, p);","       }","       else {gl_FragColor = texture2D(img, pix);}","   } else {","       gl_FragColor = texture2D(img, p);","   }","}"].join("\n"):Fe.DEFAULT,vars:t?function(t,e,n,r){var i=o.matrix,a=o.color||0;t.uniform1fv(r.uniform.am,new Ge.Array32F([i[0],i[1],i[2]/e+i[3],i[4],i[5],i[6]/n+i[7]])),t.uniform4f(r.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255)}:null}},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this.matrix;if(!r)return t;var i,a,o,l,s,u,c,f,h,m,p,d=t.length,g=d>>>2,_=e-1,v=g-e,C=new Me(d),y=this.color||0,x=He.COLOR,b=(He.CLAMP,He.WRAP),S=He.IGNORE,A=r[0],R=r[1],I=r[2]+r[3]*_,L=r[4]*e,E=r[5],w=r[6]*e+r[7]*v,r=this.mode||S;if(x===r)for(p=y>>>24&255,f=y>>>16&255,h=y>>>8&255,m=255&y,u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),s=L*i+E*o+w,(l=A*i+R*a+I)<0||_<l||s<0||v<s?(C[u]=f,C[u+1]=h,C[u+2]=m,C[u+3]=p):(C[u]=t[c=(0|l)+(0|s)<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3]);else if(S===r)for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),C[u]=t[c=(0|(l=_<(l=A*i+R*a+I)||l<0?i:l))+(0|(s=v<(s=L*i+E*o+w)||s<0?o:s))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];else if(b===r)for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),C[u]=t[c=(0|(l=_<(l=A*i+R*a+I)?l-e:l<0?l+e:l))+(0|(s=v<(s=L*i+E*o+w)?s-g:s<0?s+g:s))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];else for(u=o=a=i=0;u<d;u+=4,++i)e<=i&&(i=0,++a,o+=e),C[u]=t[c=(0|(l=_<(l=A*i+R*a+I)?_:l<0?0:l))+(0|(s=v<(s=L*i+E*o+w)?v:s<0?0:s))<<2],C[u+1]=t[c+1],C[u+2]=t[c+2],C[u+3]=t[c+3];return C},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=M.prototype.translate,Xe=(Pe=I).MODE,ke=Pe.CHANNEL,Pe.Util.Array.typed,$e=Pe.Util.GLSL,n=Math,je=n.min,n.max,V=n.floor,Pe.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:Pe.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:Xe.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},getGLSL:function(){return t=(a=this).input("map"),o=a.color||0,t?{instance:a,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform vec2 mapSize;","uniform vec2 start;","uniform vec2 scale;","uniform vec4 color;","uniform ivec2 component;","#define IGNORE "+Xe.IGNORE,"#define CLAMP "+Xe.CLAMP,"#define COLOR "+Xe.COLOR,"#define WRAP "+Xe.WRAP,"#define RED "+ke.R,"#define GREEN "+ke.G,"#define BLUE "+ke.B,"#define ALPHA "+ke.A,"uniform int mode;","void main(void) {","   if (pix.x < start.x || pix.x > min(1.0,start.x+mapSize.x) || pix.y < start.y || pix.y > min(1.0,start.y+mapSize.y)) {","      gl_FragColor = texture2D(img, pix);","   } else {","       vec4 mc = texture2D(map, (pix-start)/mapSize);","       vec2 p = vec2(pix.x, pix.y);","       if (ALPHA == component.x) p.x += (mc.a - 0.5)*scale.x;","       else if (BLUE == component.x) p.x += (mc.b - 0.5)*scale.x;","       else if (GREEN == component.x) p.x += (mc.g - 0.5)*scale.x;","       else p.x += (mc.r - 0.5)*scale.x;","       if (ALPHA == component.y) p.y += (mc.a - 0.5)*scale.y;","       else if (BLUE == component.y) p.y += (mc.b - 0.5)*scale.y;","       else if (GREEN == component.y) p.y += (mc.g - 0.5)*scale.y;","       else p.y += (mc.r - 0.5)*scale.y;","       if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","           if (COLOR == mode) {gl_FragColor = color;}","           else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","           else if (WRAP == mode) {","               if (0.0 > p.x) p.x += 1.0;","               if (1.0 < p.x) p.x -= 1.0;","               if (0.0 > p.y) p.y += 1.0;","               if (1.0 < p.y) p.y -= 1.0;","               gl_FragColor = texture2D(img, p);","           }","           else {gl_FragColor = texture2D(img, pix);}","       } else {","           gl_FragColor = texture2D(img, p);","       }","   }","}"].join("\n"),textures:function(t,e,n,r){var i=a.input("map");$e.uploadTexture(t,i[0],i[1],i[2],1)},vars:function(t,e,n,r){var i=a.input("map");t.uniform1i(r.uniform.map,1),t.uniform2f(r.uniform.mapSize,i[1]/e,i[2]/n),t.uniform2f(r.uniform.scale,1.4*a.scaleX/255,1.4*a.scaleY/255),t.uniform2f(r.uniform.start,a.startX,a.startY),t.uniform2i(r.uniform.component,a.componentX,a.componentY),t.uniform4f(r.uniform.color,(o>>>16&255)/255,(o>>>8&255)/255,(255&o)/255,(o>>>24&255)/255)}}:{instance:a,shader:$e.DEFAULT};var a,t,o},_apply:function(t,e,n){var r=this,i=r.input("map");if(i){for(var F,H,U,B,a,o,l,s,u,c,f,h,m,p=r.color||0,d=e-1,g=n-1,_=.00390625*r.scaleX,v=.00390625*r.scaleY,C=r.componentX,y=r.componentY,Y=Xe.IGNORE,z=(Xe.CLAMP,Xe.COLOR),P=Xe.WRAP,X=r.mode||Y,k=(Pe.ImArray,Pe.Util.Array.copy),$=Pe.Array16I,x=i[0],b=i[1],i=i[2],j=x.length,W=j>>>2,S=je(b,e),A=S*je(i,n)<<2,R=(t.length,V(r.startX*d)),I=V(r.startY*g),L=I*e,E=-R,w=-I,D=d-R,T=g-I,G=new $(W<<1),M=k(t),q=(15&W)<<2,O=0,N=0;N<q;N+=4)G[O++]=V((x[N+C]-128)*_),G[O++]=V((x[N+y]-128)*v);for(N=q;N<j;N+=64)G[O++]=V((x[N+C]-128)*_),G[O++]=V((x[N+y]-128)*v),G[O++]=V((x[N+4+C]-128)*_),G[O++]=V((x[N+4+y]-128)*v),G[O++]=V((x[N+8+C]-128)*_),G[O++]=V((x[N+8+y]-128)*v),G[O++]=V((x[N+12+C]-128)*_),G[O++]=V((x[N+12+y]-128)*v),G[O++]=V((x[N+16+C]-128)*_),G[O++]=V((x[N+16+y]-128)*v),G[O++]=V((x[N+20+C]-128)*_),G[O++]=V((x[N+20+y]-128)*v),G[O++]=V((x[N+24+C]-128)*_),G[O++]=V((x[N+24+y]-128)*v),G[O++]=V((x[N+28+C]-128)*_),G[O++]=V((x[N+28+y]-128)*v),G[O++]=V((x[N+32+C]-128)*_),G[O++]=V((x[N+32+y]-128)*v),G[O++]=V((x[N+36+C]-128)*_),G[O++]=V((x[N+36+y]-128)*v),G[O++]=V((x[N+40+C]-128)*_),G[O++]=V((x[N+40+y]-128)*v),G[O++]=V((x[N+44+C]-128)*_),G[O++]=V((x[N+44+y]-128)*v),G[O++]=V((x[N+48+C]-128)*_),G[O++]=V((x[N+48+y]-128)*v),G[O++]=V((x[N+52+C]-128)*_),G[O++]=V((x[N+52+y]-128)*v),G[O++]=V((x[N+56+C]-128)*_),G[O++]=V((x[N+56+y]-128)*v),G[O++]=V((x[N+60+C]-128)*_),G[O++]=V((x[N+60+y]-128)*v);if(z===X)for(F=p>>>24&255,H=p>>>16&255,U=p>>>8&255,B=255&p,N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<w||T<o||a<E||D<a||(c=(u=a+R)+l+L<<2,h=u+G[O=a+s<<1],g<(m=o+I+G[O+1])||m<0||d<h||h<0?(t[c]=H,t[c+1]=U,t[c+2]=B,t[c+3]=F):(t[c]=M[f=h+m*e<<2],t[c+1]=M[f+1],t[c+2]=M[f+2],t[c+3]=M[f+3]));else if(Y===X)for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<w||T<o||a<E||D<a||(c=(u=a+R)+l+L<<2,h=u+G[O=a+s<<1],g<(m=o+I+G[O+1]))||m<0||d<h||h<0||(t[c]=M[f=h+m*e<<2],t[c+1]=M[f+1],t[c+2]=M[f+2],t[c+3]=M[f+3]);else if(P===X)for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<w||T<o||a<E||D<a||(h=(u=a+R)+G[O=a+s<<1],m=o+I+G[O+1],t[c=u+l+L<<2]=M[f=(h=d<h?h-e:h<0?h+e:h)+(m=g<m?m-n:m<0?m+n:m)*e<<2],t[c+1]=M[f+1],t[c+2]=M[f+2],t[c+3]=M[f+3]);else for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<w||T<o||a<E||D<a||(h=(u=a+R)+G[O=a+s<<1],m=o+I+G[O+1],t[c=u+l+L<<2]=M[f=(h=d<h?d:h<0?0:h)+(m=g<m?g:m<0?0:m)*e<<2],t[c+1]=M[f+1],t[c+2]=M[f+2],t[c+3]=M[f+3])}return t}}),Ve=(D=I).MODE,Ke=D.Util.String.function_body,r=Math,Ze=r.floor,Qe=r.round,Je=r.sqrt,tn=r.atan2,en=r.sin,nn=r.cos,rn=r.max,r.min,an=2*r.PI,on=D.Util.Math.clamp,D.POS.X,ln=D.POS.Y,sn=Object.prototype.hasOwnProperty,un=D.Util.GLSL,D.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:D.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,posX:0,posY:1,angle:0,radius:0,mode:Ve.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,posX:t.posX,posY:t.posY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.posX=t.posX,e.posY=t.posY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&sn.call(We,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},twirl:function(t,e,n,r){var i=this;return i.angle=t||0,i.radius=e||0,i.centerX=n||0,i.centerY=r||0,i.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},polar:function(t,e,n,r){var i=this;return i.centerX=t||0,i.centerY=e||0,i.posX=n||0,i.posY=r||0,i.set("polar")},cartesian:function(t,e,n,r){var i=this;return i.centerX=t||0,i.centerY=e||0,i.posX=n||0,i.posY=r||0,i.set("cartesian")},set:function(t,e){var n=this;return"polar"===t?(n._mapName="polar",n._map="polar",n._mapInit=null,n._apply=function(t,e,n){var r,i,a,o,l,s,u,c,f=this,h=t.length,m=e-1,p=n-1,d=f.centerX*m,g=f.centerY*p,_=f.posX,v=(f.posY,D.MODE.COLOR),C=D.MODE.CLAMP,y=D.MODE.WRAP,x=D.MODE.IGNORE,b=f.mode||x,x=f.color||0,S=x>>>24&255,A=x>>>16&255,R=x>>>8&255,I=255&x,L=an,E=Ze(rn(Je(d*d+g*g),Je((d-m)*(d-m)+g*g),Je(d*d+(g-p)*(g-p)),Je((d-m)*(d-m)+(g-p)*(g-p)))),w=new D.ImArray(h);for(a=o=u=0;u<h;++a,u+=4){if(e<=a&&(a=0,++o),_===ln?(i=Qe((s=E*o/p)*nn(l=L*a/m)+g),r=Qe(s*en(l)+d)):(r=Qe((s=E*a/m)*nn(l=L*o/p)+d),i=Qe(s*en(l)+g)),r<0||e<=r||i<0||n<=i){if(v===b){w[u]=A,w[u+1]=R,w[u+2]=I,w[u+3]=S;continue}if(y===b)r<0&&(r+=e),e<=r&&(r-=e),i<0&&(i+=n),n<=i&&(i-=n);else{if(C!==b)continue;r=on(r,0,m),i=on(i,0,p)}}c=r+i*e<<2,w[u]=t[c],w[u+1]=t[1+c],w[u+2]=t[2+c],w[u+3]=t[3+c]}return w}.bind(n),n._mapChanged=!1):"cartesian"===t?(n._mapName="cartesian",n._map="cartesian",n._mapInit=null,n._apply=function(t,e,n){var r,i,a,o,l,s,u,c=this,f=t.length,h=e-1,m=n-1,p=c.centerX*h,d=c.centerY*m,g=c.posX,_=(c.posY,D.MODE.COLOR),v=D.MODE.CLAMP,C=D.MODE.WRAP,y=D.MODE.IGNORE,x=c.mode||y,y=c.color||0,b=y>>>24&255,S=y>>>16&255,A=y>>>8&255,R=255&y,I=an,L=Ze(rn(Je(p*p+d*d),Je((p-h)*(p-h)+d*d),Je(p*p+(d-m)*(d-m)),Je((p-h)*(p-h)+(d-m)*(d-m)))),E=new D.ImArray(f);for(a=o=s=0;s<f;++a,s+=4){if(e<=a&&(a=0,++o),g===ln?(i=a-p,r=o-d):(r=a-p,i=o-d),u=Je(r*r+i*i),(l=tn(i,r))<0&&(l+=an),g===ln?(i=Qe(m*u/L),r=Qe(h*l/I)):(r=Qe(h*u/L),i=Qe(m*l/I)),r<0||e<=r||i<0||n<=i){if(_===x){E[s]=S,E[s+1]=A,E[s+2]=R,E[s+3]=b;continue}if(C===x)r<0&&(r+=e),e<=r&&(r-=e),i<0&&(i+=n),n<=i&&(i-=n);else{if(v!==x)continue;r=on(r,0,h),i=on(i,0,m)}}u=r+i*e<<2,E[s]=t[u],E[s+1]=t[1+u],E[s+2]=t[2+u],E[s+3]=t[3+u]}return E}.bind(n),n._mapChanged=!1):t&&sn.call(We,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=We[n._mapName],n._mapInit=We["init__"+n._mapName],n._apply=Fi(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=Fi(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t._glsl=null,t},getGLSL:function(){var u=this;return u._map?sn.call(qe,u._mapName)?{instance:u,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","#define TWOPI  6.283185307179586","#define IGNORE "+Ve.IGNORE,"#define CLAMP "+Ve.CLAMP,"#define COLOR "+Ve.COLOR,"#define WRAP "+Ve.WRAP,"uniform int mode;","uniform int swap;","uniform vec2 size;","uniform vec2 center;","uniform float angle;","uniform float radius;","uniform float radius2;","uniform float AMAX;","uniform float RMAX;","uniform vec4 color;","uniform int mapping;",qe.twirl,qe.sphere,qe.polar,qe.cartesian,"void main(void) {","vec2 p = pix;","if (1 == mapping) p = twirl(pix, center, radius, angle, size);","else if (2 == mapping) p = sphere(pix, center, radius2, size);","else if (3 == mapping) p = polar(pix, center, RMAX, AMAX, size, swap);","else if (4 == mapping) p = cartesian(pix, center, RMAX, AMAX, size, swap);","if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","if (COLOR == mode) {gl_FragColor = color;}","else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","else if (WRAP == mode) {","if (0.0 > p.x) p.x += 1.0;","if (1.0 < p.x) p.x -= 1.0;","if (0.0 > p.y) p.y += 1.0;","if (1.0 < p.y) p.y -= 1.0;","gl_FragColor = texture2D(img, p);","}","else {gl_FragColor = texture2D(img, pix);}","} else {","gl_FragColor = texture2D(img, p);","}","}"].join("\n"),vars:function(t,e,n,r){var i=u.color||0,a=u.centerX,o=u.centerY,l=(e-1)*(e-1),s=(n-1)*(n-1),l=rn(Je(l*+a*+a+s*+o*+o),Je(l*(a-1)*(a-1)+s*+o*+o),Je(l*+a*+a+s*(o-1)*(o-1)),Je(l*(a-1)*(a-1)+s*(o-1)*(o-1)));t.uniform4f(r.uniform.color,(i>>>16&255)/255,(i>>>8&255)/255,(255&i)/255,(i>>>24&255)/255),t.uniform2f(r.uniform.size,e,n),t.uniform2f(r.uniform.center,a,o),t.uniform1f(r.uniform.angle,u.angle),t.uniform1f(r.uniform.radius,u.radius),t.uniform1f(r.uniform.radius2,u.radius*u.radius),t.uniform1f(r.uniform.AMAX,an),t.uniform1f(r.uniform.RMAX,l),t.uniform1i(r.uniform.swap,u.posX===ln?1:0),t.uniform1i(r.uniform.mapping,"twirl"===u._mapName?1:"sphere"===u._mapName?2:"polar"===u._mapName?3:"cartesian"===u._mapName?4:0)}}:{instance:u,shader:u._map.shader,vars:u._map.vars,textures:u._map.textures}:{instance:u,shader:un.DEFAULT}},canRun:function(){return this._isOn&&this._map}}),We={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"},qe={twirl:["vec2 twirl(vec2 pix, vec2 center, float R, float angle, vec2 size) {","vec2 T = size*(pix - center);","float D = length(T);","if (D < R) {","float theta = atan(T.y, T.x) + (R-D)*angle/R;","pix = (size*center + vec2(D*cos(theta),  D*sin(theta)))/size;","}","return pix;","}"].join("\n"),sphere:["vec2 sphere(vec2 pix, vec2 center, float R2, vec2 size) {","vec2 T = size*(pix - center);","float TX2 = T.x*T.x; float TY2 = T.y*T.y;","float D2 = TX2 + TY2;","if (D2 < R2) {","D2 = R2 - D2;","float D = sqrt(D2);","float thetax = asin(T.x / sqrt(TX2 + D2)) * (1.0-0.555556);","float thetay = asin(T.y / sqrt(TY2 + D2)) * (1.0-0.555556);","pix = pix - vec2(D * tan(thetax), D * tan(thetay))/size;","}","return pix;","}"].join("\n"),polar:["vec2 polar(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","float r = 0.0;","float a = 0.0;","/*pix *= size;*/","if (1 == swap) {","r = pix.y*rMax;","a = pix.x*aMax;","return (size*center + vec2(r*sin(a), r*cos(a)))/size;","} else {","r = pix.x*rMax;","a = pix.y*aMax;","return (size*center + vec2(r*cos(a), r*sin(a)))/size;","}","}"].join("\n"),cartesian:["vec2 cartesian(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","vec2 xy = size* (pix - center);","float r = 0.0;","float a = 0.0;","if (1 == swap) {","xy = xy.yx;","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(a/aMax, r/rMax);","} else {","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(r/rMax, a/aMax);","}","}"].join("\n")},cn=(i=I).MODE,fn=i.ConvolutionMatrix,hn=i.ImArray,i.Array32F,mn=i.Array16I,i.Array8U,pn=i.Util.Filter.cm_convolve,dn=i.Util.Filter.cm_combine,gn=i.Util.Filter.integral_convolution,_n=i.Util.Filter.separable_convolution,vn=i.Util.Array.typed,Cn=i._notSupportClamp,yn=i.Util.GLSL,(xn=Math).SQRT2,bn=i.CONST.toRad,i.CONST.toDeg,Sn=xn.abs,An=xn.sqrt,Rn=xn.sin,In=xn.cos,Ln=xn.min,En=xn.max,wn=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(i=i.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,r){var i=this;i._coeff=new fn([1,0]),i.matrix2=null,i.dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,t&&t.length?i.set(t,An(t.length)+.5|0,e||1,n||0):(i.matrix=null,i.dim=0),i.mode=r||cn.RGB},path:i.Path,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_doIntegralSeparable:null,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,mode:cn.RGB,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._doIntegralSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}},unserialize:function(t){var e=this;return e.dim=t.dim,e.dim2=t.dim2,e.matrix=vn(t.matrix,fn),e.matrix2=vn(t.matrix2,fn),e._mat=vn(t._mat,fn),e._mat2=vn(t._mat2,fn),e._coeff=vn(t._coeff,fn),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=vn(t._indices,mn),e._indices2=vn(t._indices2,mn),e._indicesf=vn(t._indicesf,mn),e._indicesf2=vn(t._indicesf2,mn),e},functional:function(t,e){var t=Bi(e=null==e?3:1&e?e:e+1,t),n=1/Hi(t);return this.set(t,e,n,n,e,t),this._doSeparable=!0,this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set($i(e=null==e?3:1&e?e:e+1),e,1/(e*e),0),this._doIntegralSeparable=[Yi(e),e,1,1/e,0,Yi(e),1,e,1/e,0],this._doIntegral=t,this},lowPass:function(t){return this.set($i(t=null==t?3:1&t?t:t+1),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=null==e?1:e)/((t=null==t?3:1&t?t:t+1)*t);return this.set($i(t,e,1+e),t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=null==t?.5:t))},sharpen:function(t,e){return this.highPass(e,t=null==t?.5:t)},verticalBlur:function(t){return this.set(Yi(t=null==t?3:1&t?t:t+1),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(Yi(t=null==t?3:1&t?t:t+1),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,r){var i,a,o,l,s,u=t*t,c=t>>1,f=u>>1,h=new fn(u),m=new fn(u),p=1/t;u=1e-8<Sn(e)?(s=1,n/e):(s=e/n,1);l=o=i=0,a=u*t;for(;i<=c;)m[f+i]=f+o+l+.5|0,m[f-i]=f-o-l+.5|0,++i,o+=s,l+=a;i=0;for(;i<=c;)h[m[f+i]]=h[m[f-i]]=p,++i;return h[f]=r||1,h}(e=null==e?3:1&e?e:e+1,In(t*=bn),-Rn(t),1/e),e,1,0)},binomialLowPass:function(t){var e=Pi(t=null==t?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,n,n,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=Pi(t);return pn(t,t)}(t=null==t?3:1&t?t:t+1);return this.set(dn($i(t),e,1,-1/Hi(e)),t,1,0)},prewittX:function(t){return this.set(Yi(t=null==t?3:1&t?t:t+1),t,1,0,t,zi(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(zi(t=null==t?3:1&t?t:t+1,1),t,1,0,t,Yi(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=bn,this.set(dn(ki(e=null==e?3:1&e?e:e+1,0),ki(e,1),In(t),Rn(t)),e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(ki(t=null==t?3:1&t?t:t+1,0),t,1,0,t,ki(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(Pi(t=null==t?3:1&t?t:t+1),t,1,0,t,zi(t,0)),this._doSeparable=!0,this},sobelY:function(t){return this.set(zi(t=null==t?3:1&t?t:t+1,1),t,1,0,t,Pi(t)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=bn,this.set(dn(Xi(e=null==e?3:1&e?e:e+1,0),Xi(e,1),In(t),Rn(t)),e,1,0)},sobel:function(t){return this.set(Xi(t=null==t?3:1&t?t:t+1,0),t,1,0,t,Xi(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set($i(t=null==t?3:1&t?t:t+1,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=null==t?-.25*xn.PI:t*bn,this.set(function(t,e,n,r){var i,a,o,l,s,u=t*t,c=t>>>1,f=u>>>1,h=new fn(u);for(i=l=0;i<=c;++i,l+=e)for(o=s=a=0;o<=c;++o,a+=t,s+=n)h[f+i+a]=l+s,h[f-i-a]=-l-s,h[f-i+a]=-l+s,h[f+i-a]=l-s;return h[f]=r||1,h}(n=null==n?3:1&n?n:n+1,(e=e||1)*In(t),-e*Rn(t),1),n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r,i,a){var o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o._doIntegralSeparable=null,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new fn(t),o.dim=e,o._coeff[0]=n||1,o._coeff[1]=r||0,t=Ui(o.matrix,o.dim),o._indices=t[0],o._indicesf=t[1],o._mat=t[2],a?(o.matrix2=new fn(a),o.dim2=i,t=Ui(o.matrix2,o.dim2),o._indices2=t[0],o._indicesf2=t[1],o._mat2=t[2]):i&&(o.dim2=i),o._glsl=null,o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t._glsl=null,t},getGLSL:function(){var t=this;function e(t,e,n,r,i,a,o){for(var l,s,u=[],c=[],f=[],h="c0",m=t.length,p=n,d=p>>>1,g=r>>>1,_=0,v=0,C=0;C<m;)l=_-d,s=v-g,(t[C]||0===l&&0===s)&&(u.push("vec2 p"+C+"=vec2(pix.x"+y(l,1)+"*dp.x, pix.y"+y(s,1)+"*dp.y); vec4 c"+C+"=vec4(0.0); if (0.0 <= p"+C+".x && 1.0 >= p"+C+".x && 0.0 <= p"+C+".y && 1.0 >= p"+C+".y) c"+C+"=texture2D(img,  p"+C+");"),c.push(y(t[C],c.length)+"*c"+C),0===l)&&0===s&&(h="c"+C+".a"),++C,p<=++_&&(_=0,++v);if(e){for(C=v=_=0;C<m;)l=_-d,s=v-g,(e[C]||0===l&&0===s)&&(u.push("vec2 pp"+C+"=vec2(pix.x"+y(l,1)+"*dp.x, pix.y"+y(s,1)+"*dp.y); vec4 cc"+C+"=vec4(0.0); if (0.0 <= pp"+C+".x && 1.0 >= pp"+C+".x && 0.0 <= pp"+C+".y && 1.0 >= pp"+C+".y) cc"+C+"=texture2D(img,  pp"+C+");"),f.push(y(e[C],f.length)+"*cc"+C)),++C,p<=++_&&(_=0,++v);return o?(u.push("vec4 o1="+y(i)+"*("+c.join("")+");"),u.push("vec4 o2="+y(i)+"*("+f.join("")+");"),[u.join("\n"),"vec4(sqrt(o1.r*o1.r+o2.r*o2.r),sqrt(o1.g*o1.g+o2.g*o2.g),sqrt(o1.b*o1.b+o2.b*o2.b),"+h+")"]):(u.push("vec4 o1="+c.join("")+";"),u.push("vec4 o2="+f.join("")+";"),[u.join("\n"),"vec4(("+y(i)+"*o1"+y(a,1)+"*o2).rgb,"+h+")"])}return[u.join("\n"),"vec4(("+y(i)+"*("+c.join("")+")+vec4("+y(a)+")).rgb,"+h+")"]}var n,r,i,y=yn.formatFloat,a=t.matrix,o=t.matrix2;return a?(i=t._doIntegralSeparable)?(r=[],n=e(i[0],null,i[1],i[2],i[3],i[4],!1),r.push({instance:t,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),iterations:t._doIntegral||1}),n=e(i[5],null,i[6],i[7],i[8],i[9],!1),r.push({instance:t,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),iterations:t._doIntegral||1}),r):(t._doSeparable&&o&&(a=pn(a,o),o=null),n=e(a,o,t.dim,t.dim,t._coeff[0],t._coeff[1],t._isGrad),{instance:t,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",n[0],"gl_FragColor = "+n[1]+";","}"].join("\n"),iterations:t._doIntegral||1}):{instance:t,shader:yn.DEFAULT}},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(pn(e.matrix,t.matrix),e.dim*t.dim,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):e},_apply:function(t,e,n){var r=this,i=r.mode;if(!r.matrix)return t;if(r._doIntegral)return r.matrix2?gn(i,t,e,n,2,r.matrix,r.matrix2,r.dim,r.dim2,r._coeff[0],r._coeff[1],r._doIntegral):gn(i,t,e,n,2,r.matrix,null,r.dim,r.dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return _n(i,t,e,n,2,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I,L,E,w=t.length,n=w>>>2,D=new hn(w),T=e-1,G=n-e,M=r._coeff[0],O=r._coeff[1],N=r.matrix,F=r.matrix2,H=r._isGrad;if(cn.GRAY===i)if(F){for(A=r._indicesf.length,I=new mn(r._indicesf),c=0;c<A;c+=2)I[c+1]*=e;for(R=N.length,s=h=f=0;s<w;s+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=C=y=x=0;c<R;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||T<m||p<0||G<p||(b=N[c],g+=t[d=m+p<<2]*b,S=F[c],C+=t[d]*S);a=H?(g=Sn(g),C=Sn(C),(E=En(g,C))?E*(1+.43*(L=Ln(g,C))/E*L/E):0):M*g+O*C,D[s]=0|(a=Cn?a<0?0:255<a?255:a:a),D[s+1]=0|a,D[s+2]=0|a,D[s+3]=t[s+3]}}else{for(A=r._indices.length,I=new mn(r._indices),c=0;c<A;c+=2)I[c+1]*=e;for(R=(N=r._mat).length,s=h=f=0;s<w;s+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=0;c<R;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||T<m||p<0||G<p||(b=N[c],g+=t[d=m+p<<2]*b);a=M*g+O,D[s]=0|(a=Cn?a<0?0:255<a?255:a:a),D[s+1]=0|a,D[s+2]=0|a,D[s+3]=t[s+3]}}else if(F){for(A=r._indicesf.length,I=new mn(r._indicesf),c=0;c<A;c+=2)I[c+1]*=e;for(R=N.length,s=h=f=0;s<w;s+=4,++f){for(e<=f&&(f=0,h+=e),u=c=g=_=v=C=y=x=0;c<R;++c,u+=2)m=f+I[u],p=h+I[u+1],m<0||T<m||p<0||G<p||(b=N[c],g+=t[d=m+p<<2]*b,_+=t[d+1]*b,v+=t[d+2]*b,S=F[c],C+=t[d]*S,y+=t[d+1]*S,x+=t[d+2]*S);l=H?(g=Sn(g),C=Sn(C),a=(E=En(g,C))?E*(1+.43*(L=Ln(g,C))/E*L/E):0,_=Sn(_),y=Sn(y),o=(E=En(_,y))?E*(1+.43*(L=Ln(_,y))/E*L/E):0,v=Sn(v),x=Sn(x),(E=En(v,x))?E*(1+.43*(L=Ln(v,x))/E*L/E):0):(a=M*g+O*C,o=M*_+O*y,M*v+O*x),Cn&&(a=a<0?0:255<a?255:a,o=o<0?0:255<o?255:o,l=l<0?0:255<l?255:l),D[s]=0|a,D[s+1]=0|o,D[s+2]=0|l,D[s+3]=t[s+3]}}else{for(A=r._indices.length,I=new mn(r._indices),c=0;c<A;c+=2)I[c+1]*=e;for(R=(N=r._mat).length,s=h=f=0;s<w;s+=4,f++){for(e<=f&&(f=0,h+=e),u=c=g=_=v=0;c<R;c++,u+=2)m=f+I[u],p=h+I[u+1],m<0||T<m||p<0||G<p||(b=N[c],g+=t[d=m+p<<2]*b,_+=t[d+1]*b,v+=t[d+2]*b);a=M*g+O,o=M*_+O,l=M*v+O,Cn&&(a=a<0?0:255<a?255:a,o=o<0?0:255<o?255:o,l=l<0?0:255<l?255:l),D[s]=0|a,D[s+1]=0|o,D[s+2]=0|l,D[s+3]=t[s+3]}}return D}})).prototype.gradX=i.prototype.prewittX,i.prototype.gradY=i.prototype.prewittY,i.prototype.gradDirectional=i.prototype.prewittDirectional,i.prototype.grad=i.prototype.prewitt,i.prototype.bump=i.prototype.emboss,i.prototype.boxBlur=i.prototype.lowPass,i.prototype.gaussBlur=i.prototype.binomialLowPass,Gn=(Dn=I).MODE,Mn=Dn.ImArray,On=Dn.Util.Array.copy,Nn=Dn.Util.GLSL,Fn=Dn.Array8U,x=Dn.Array32I,Hn=Math.sqrt,Un=Dn.Util.Array.typed,Dn.Util.Filter.primitive_morphology_operator,Bn=ji(3),Dn.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=Gn.RGB},path:Dn.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:Gn.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_dim2:t._dim2,_iter:t._iter,_structureElement:t._structureElement,_indices:t._indices,_structureElement2:t._structureElement2,_indices2:t._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=Un(t._structureElement,Fn),e._indices=Un(t._indices,x),e._structureElement2=Un(t._structureElement2,Fn),e._indices2=Un(t._indices2,x),e._filterName=t._filterName,e._filterName&&Tn[e._filterName]&&(e._filter=Tn[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,r){var i=this,a=(i._dim2=0,i._structureElement2=null,i._indices2=null,i._iter=0|r||1,i._filterName=t,i._filter=Tn[t],e&&e.length?(i._structureElement=new Fn(e),i._dim=Hn(i._structureElement.length)+.5|0):e&&e===+e?(i._structureElement=ji(e),i._dim=e):(i._structureElement=Bn,i._dim=3),n&&n.length?(i._structureElement2=new Fn(n),i._dim2=Hn(i._structureElement2.length)+.5|0):n&&n===+n&&(i._structureElement2=ji(n),i._dim2=n),[]),o=(e=i._structureElement).length,l=(f=i._dim)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));if(i._indices=new x(a),i._structureElement2){var s,u,c,f,a=[],o=(e=i._structureElement2).length,l=(f=i._dim2)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));i._indices2=new x(a)}return i._glsl=null,i},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t._glsl=null,t},getGLSL:function(){var i=this;function a(t,e,n,r,i){var a,o,l,s,u,c=[],f=t.length,h=e,m=h>>>1;for(c.push("int apply=1;"),c.push("vec4 res=vec4("+r+");"),c.push("float alpha=1.0;"),l=o=a=0,i=i||"img";l<f;)s=a-m,u=o-m,(t[l]||0==s&&0==u)&&c.push("if (1==apply){vec2 p"+l+"=vec2(pix.x"+p(s,1)+"*dp.x, pix.y"+p(u,1)+"*dp.y); vec4 c"+l+"=vec4(0.0); if (0.0 <= p"+l+".x && 1.0 >= p"+l+".x && 0.0 <= p"+l+".y && 1.0 >= p"+l+".y) {c"+l+"=texture2D("+i+",p"+l+");} else {apply=0;} res="+n+"(res, c"+l+");"+(0==s&&0==u?" alpha=c"+l+".a;":"")+"}"),++l,h<=++a&&(a=0,++o);return c.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D("+i+",pix);"),c.join("\n")}function t(t,e,n,r){return{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D "+(n||"img")+";","uniform vec2 dp;","void main(void) {","dilate"===e?a(t,i._dim,"max","0.0",n):a(t,i._dim,"min","1.0",n),"}"].join("\n"),iterations:i._iter||1,_usesPrev:!!r}}var e,p=Nn.formatFloat;if(!i._dim)return{instance:i,shader:Nn.DEFAULT};switch(i._filterName){case"dilate":e=t(i._structureElement,"dilate");break;case"erode":e=t(i._structureElement,"erode");break;case"open":e=[t(i._structureElement,"erode"),t(i._structureElement,"dilate")];break;case"close":e=[t(i._structureElement,"dilate"),t(i._structureElement,"erode")];break;case"gradient":e=[t(i._structureElement,"dilate"),t(i._structureElement,"erode","_img_prev",!0),{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D _img_prev;","void main(void) {","vec4 dilate = texture2D(_img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate-erode)*0.5).rgb, erode.a);","}"].join("\n"),_usesPrev:!0}];break;case"laplacian":e=[t(i._structureElement,"dilate"),t(i._structureElement,"erode","_img_prev",!0),{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D _img_prev;","uniform sampler2D _img_prev_prev;","void main(void) {","vec4 original = texture2D(_img_prev_prev, pix);","vec4 dilate = texture2D(_img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate+erode-2.0*original)*0.5).rgb, original.a);","}"].join("\n"),_usesPrev:!0}];break;default:e={instance:i}}return e},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),Dn.Util.Filter.primitive_morphology_operator=Wi,Tn={dilate:function(t,e,n,r){for(var i=null,a=new Mn(e.length),o=t._indices,l=o.length,s=new x(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,i=new x(l),u=0;u<l;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;return Wi(t.mode,e,a,n,0,2,s,i,Math.max,0,t._iter),a},erode:function(t,e,n,r){for(var i=null,a=new Mn(e.length),o=t._indices,l=o.length,s=new x(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,i=new x(l),u=0;u<l;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;return Wi(t.mode,e,a,n,0,2,s,i,Math.min,255,t._iter),a},open:function(t,e,n,r){for(var i=null,a=new Mn(e.length),o=t._indices,l=o.length,s=new x(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,i=new x(l),u=0;u<l;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;Wi(t.mode,e,a,n,0,2,s,i,Math.min,255,t._iter);var c=e;return Wi(t.mode,e=a,a=c,n,0,2,s,i,Math.max,0,t._iter),a},close:function(t,e,n,r){for(var i=null,a=new Mn(e.length),o=t._indices,l=o.length,s=new x(coverArea2),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,i=new x(l),u=0;u<l;u+=2)i[u]=o[u],i[u+1]=o[u+1]*n;Wi(t.mode,e,a,n,0,2,s,i,Math.max,0,t._iter);var c=e;return Wi(t.mode,e=a,a=c,n,0,2,s,i,Math.min,255,t._iter),a},gradient:function(t,e,n,r){for(var i,a=null,o=e.length,l=new Mn(o),s=t._indices,u=s.length,c=new x(u),f=0;f<u;f+=2)c[f]=s[f],c[f+1]=s[f+1]*n;if(t._indices2)for(u=(s=t._indices2).length,a=new x(u),f=0;f<u;f+=2)a[f]=s[f],a[f+1]=s[f+1]*n;for(i=On(e),Wi(t.mode,i,l,n,0,2,c,a,Math.max,0,t._iter),Wi(t.mode,e,i,n,0,2,c,a,Math.min,255,t._iter),f=0;f<o;f+=4)l[f]=(l[f]-i[f])/2|0,l[f+1]=(l[f+1]-i[f+1])/2|0,l[f+2]=(l[f+2]-i[f+2])/2|0;return l},laplacian:function(t,e,n,r){for(var i,a=null,o=e.length,l=new Mn(o),s=new Mn(o),u=t._indices,c=u.length,f=new x(c),h=0;h<c;h+=2)f[h]=u[h],f[h+1]=u[h+1]*n;if(t._indices2)for(c=(u=t._indices2).length,a=new x(c),h=0;h<c;h+=2)a[h]=u[h],a[h+1]=u[h+1]*n;for(i=On(e),Wi(t.mode,i,s,n,0,2,f,a,Math.max,0,t._iter),i=On(e),Wi(t.mode,i,l,n,0,2,f,a,Math.min,255,t._iter),h=0;h<o;h+=4)l[h]=(l[h]+s[h]-2*e[h])/2|0,l[h+1]=(l[h+1]+s[h+1]-2*e[h+1])/2|0,l[h+2]=(l[h+2]+s[h+2]-2*e[h+2])/2|0;return l}},zn=(A=I).MODE,Pn=A.ImArray,Xn=A.Array32I,kn=A.Array32U,$n=A.Util.GLSL,jn=A.Util.Array.typed,Wn=Math,qn=Wn.min,Vn=Wn.max,(A=A.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=zn.RGB},path:A.Path,d:0,k:0,_filter:null,_indices:null,mode:zn.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=jn(t._indices,Xn),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||0,n.k=e=qn(1,Vn(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";for(var r=t*t<<1,i=t>>>1,a=new Xn(r),o=0,l=0,s=0;s<r;s+=2,++o)t<=o&&(o=0,++l),a[s]=o-i,a[s+1]=l-i;return n._indices=a,n._glsl=null,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t._glsl=null,t},getGLSL:function(){return i=this,v=$n.formatFloat,C=$n.staticSort,i.d?(e=i._filter,{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform int isColored;","void main(void) {","1th"===e?t(i.d,"max","0.0"):"0th"===e?t(i.d,"min","1.0"):function(t,e){var n=[],r=[],i=[],a=[],o="c0",l,s,u,c,f,h,m,p,d=t*t,g=t,_=g>>>1,l=0,s=0,u=0;while(u<d){c=l-_;f=s-_;n.push("vec2 p"+u+"=vec2(pix.x"+v(c,1)+"*dp.x, pix.y"+v(f,1)+"*dp.y); vec4 c"+u+"=vec4(0.0); if (0.0 <= p"+u+".x && 1.0 >= p"+u+".x && 0.0 <= p"+u+".y && 1.0 >= p"+u+".y) c"+u+"=texture2D(img,  p"+u+"); float c"+u+"r=c"+u+".r; float c"+u+"g=c"+u+".g; float c"+u+"b=c"+u+".b;");r.push("c"+u+"r");i.push("c"+u+"g");a.push("c"+u+"b");if(0===c&&0===f)o="c"+u+".a";++u;++l;if(l>=g){l=0;++s}}return n.push("float t=0.0;"),n.push(C(r,"t").join("\n")),n.push("if (1==isColored) {"),n.push(C(i,"t").join("\n")),n.push(C(a,"t").join("\n")),n.push("}"),n.push("float rkth=c"+Wn.round(e*(d-1))+"r;"),n.push("float gkth=rkth;"),n.push("float bkth=rkth;"),n.push("if (1==isColored) {"),n.push("gkth=c"+Wn.round(e*(d-1))+"g;"),n.push("bkth=c"+Wn.round(e*(d-1))+"b;"),n.push("}"),n.push("gl_FragColor = vec4(rkth,gkth,bkth,"+o+");"),n.join("\n")}(i.d,i.k),"}"].join("\n"),vars:function(t,e,n,r){t.uniform1i(r.uniform.isColored,zn.GRAY!==i.mode?1:0)}}):{instance:i,shader:$n.DEFAULT};function t(t,e,n){var r,i,a,o,l,s=[],u=t*t,c=t,f=c>>>1;for(s.push("int apply=1;"),s.push("vec4 res=vec4("+n+");"),s.push("float alpha=1.0;"),a=i=r=0;a<u;)l=i-f,s.push("if (1==apply){vec2 p"+a+"=vec2(pix.x"+v(o=r-f,1)+"*dp.x, pix.y"+v(l,1)+"*dp.y); vec4 c"+a+"=vec4(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) {c"+a+"=texture2D(img,p"+a+");} else {apply=0;} res="+e+"(res, c"+a+");"+(0==o&&0==l?" alpha=c"+a+".a;":"")+"}"),++a,c<=++r&&(r=0,++i);return s.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D(img,pix);"),s.join("\n")}var i,e,v,C},_apply:function(t,e,n){var r=this;return r.d?"0th"===r._filter||"1th"===r._filter?Yn["01th"](r,t,e,n):Yn[r._filter](r,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=A.prototype.minimum,A.prototype.dilate=A.prototype.maximum,Yn={"01th":function(t,e,n,r){t.d;for(var i,a,o,l,s,u,c,f,h,m,p,d,g,_=e.length,v=_>>>2,C=new Pn(_),y=n-1,x=v-n,b=t._indices,S=b.length,A=new Xn(S),R="0th"===t._filter?(g=qn,255):(g=Vn,0),I=0;I<S;I+=2)A[I]=b[I],A[I+1]=b[I+1]*n;if(zn.GRAY===t.mode)for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),p=R,I=0;I<S;I+=2)l=a+A[I],s=o+A[I+1],l<0||y<l||s<0||x<s||(p=g(e[u=l+s<<2],p));C[i]=p,C[i+1]=p,C[i+2]=p,C[i+3]=e[i+3]}else for(o=a=i=0;i<_;i+=4,++a){for(n<=a&&(a=0,o+=n),m=p=d=R,I=0;I<S;I+=2)l=a+A[I],s=o+A[I+1],l<0||y<l||s<0||x<s||(c=e[u=l+s<<2],f=e[u+1],h=e[u+2],m=g(c,m),p=g(f,p),d=g(h,d));C[i]=m,C[i+1]=p,C[i+2]=d,C[i+3]=e[i+3]}return C},kth:function(t,e,n,F){t.d;for(var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R,I=t.k,L=e.length,E=L>>>2,w=new Pn(L),D=n-1,T=E-n,G=t._indices,M=G.length,E=M>>>1,O=new Xn(M),N=0;N<M;N+=2)O[N]=G[N],O[N+1]=G[N+1]*n;if(zn.GRAY===t.mode)for(g=new Pn(E),b=new kn(256),a=i=r=0;r<L;r+=4,++i){for(n<=i&&(i=0,a+=n),N=C=A=0;N<M;N+=2)o=i+O[N],l=a+O[N+1],o<0||D<o||l<0||T<l||(++A,++b[c=e[s=o+l<<2]],1===b[c]&&qi(g,C++,c));for(A*=I,R=0,m=-1,N=C;0<N;--N)R+=b[c=Vi(g,N)],m<(b[c]=0)&&A<=R&&(m=c);w[r]=m,w[r+1]=m,w[r+2]=m,w[r+3]=e[r+3]}else for(d=new Pn(E),g=new Pn(E),_=new Pn(E),x=new kn(256),b=new kn(256),S=new kn(256),a=i=r=0;r<L;r+=4,++i){for(n<=i&&(i=0,a+=n),N=v=C=y=A=0;N<M;N+=2)o=i+O[N],l=a+O[N+1],o<0||D<o||l<0||T<l||(u=e[s=o+l<<2],c=e[s+1],f=e[s+2],++x[u],++b[c],++S[f],++A,1===x[u]&&qi(d,v++,u),1===b[c]&&qi(g,C++,c),1===S[f]&&qi(_,y++,f));for(A*=I,R=0,h=-1,N=v;0<N;--N)R+=x[u=Vi(d,N)],h<(x[u]=0)&&A<=R&&(h=u);for(R=0,m=-1,N=C;0<N;--N)R+=b[c=Vi(g,N)],m<(b[c]=0)&&A<=R&&(m=c);for(R=0,p=-1,N=y;0<N;--N)R+=S[f=Vi(_,N)],p<(S[f]=0)&&A<=R&&(p=f);w[r]=h,w[r+1]=m,w[r+2]=p,w[r+3]=e[r+3]}return w}},Zn=(Kn=I).Util.GLSL,Qn=Object.prototype.hasOwnProperty,Kn.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:Kn.Path,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_filter:!1!==t._filter&&(t._changed&&t._filter?(t._filter.filter||t._filter).toString():null),_params:t._params};return t._changed=!1,e},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(Kn)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)Qn.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},set:function(t,e){var n=this;return!1===t?(n._filter=!1,n._changed=!0,n._glsl=null):(!t||"function"!=typeof t&&"function"!=typeof t.filter||(n._filter=t,n._changed=!0,n._glsl=null),e&&n.params(e)),n},getGLSL:function(){var t=this._filter;return t&&t.shader?{instance:this,shader:t.shader,textures:t.textures,vars:t.vars}:{instance:this,shader:t?null:Zn.DEFAULT}},_apply:function(t,e,n,r){var i=this._filter;return i?(i="function"==typeof i.filter?i.filter:i)(this._params,t,e,n,r):t},canRun:function(){return this._isOn&&this._filter}}),Kn.CustomFilter=Kn.InlineFilter,Jn=I._notSupportClamp,(tr=I.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:I.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f=tr.random,h=this.max-this.min,m=this.min,p=t.length;if(Jn)for(r=0;r<p;r+=4)a=t[r],o=t[r+1],l=t[r+2],(s=a+(i=h*f()+m))<0?s=0:255<s&&(s=255),(u=o+i)<0?u=0:255<u&&(u=255),(c=l+i)<0?c=0:255<c&&(c=255),t[r]=0|s,t[r+1]=0|u,t[r+2]=0|c;else for(r=0;r<p;r+=4)a=t[r],o=t[r+1],l=t[r+2],u=o+(i=h*f()+m),c=l+i,t[r]=0|(s=a+i),t[r+1]=0|u,t[r+2]=0|c;return t}})).random=Math.random,er=(R=I).MODE,R.Create({name:"PerlinNoiseFilter",mode:er.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:R.Path,init:function(t,e,n,r,i,a,o,l){var s=this;s.mode=er.GRAY,s._baseX=t||1,s._baseY=e||1,s._seed=o||0,s._stitch=!!r,s._fractal=!1!==i,s._perlin=!!l,s.octaves(n||1,a)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){var n=this;for(n._octaves=t||1,n._offsets=e?e.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?er.COLOR:er.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var t=this;return{_baseX:t._baseX,_baseY:t._baseY,_octaves:t._octaves,_offsets:t._offsets,_seed:t._seed||0,_stitch:t._stitch,_fractal:t._fractal,_perlin:t._perlin}},unserialize:function(t){var e=this;return e._baseX=t._baseX,e._baseY=t._baseY,e._octaves=t._octaves,e._offsets=t._offsets,e._seed=t._seed||0,e._stitch=t._stitch,e._fractal=t._fractal,e._perlin=t._perlin,e},apply:function(t,e,n){var r=this;return r._seed&&(ia.seed(r._seed),r._seed=0),ia(t,e,n,r._stitch,er.COLOR!==r.mode,r._baseX,r._baseY,r._octaves,r._offsets,1,.5,r._perlin)}}),t=Math,nr=t.floor,t.sin,t.cos,R.CONST.PI2,t=R.Array8U,rr=new t([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),b=new t(rr),ia.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=nr(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?rr[n]^255&t:rr[n]^t>>8&255,b[n]=b[n+256]=e},e=Math,ir=e.min,ar=e.floor,or=I.Util.GLSL,sr=I.MODE,I.Create({name:"ChannelCopyFilter",srcChannel:(lr=I.CHANNEL).R,dstChannel:lr.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:I.Path,init:function(t,e,n,r,i){this.srcChannel=t||lr.R,this.dstChannel=e||lr.R,this.centerX=n||0,this.centerY=r||0,this.color=i||0},dispose:function(){return this.srcChannel=null,this.dstChannel=null,this.centerX=null,this.centerY=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{srcChannel:this.srcChannel,dstChannel:this.dstChannel,centerX:this.centerX,centerY:this.centerY,color:this.color}},unserialize:function(t){return this.srcChannel=t.srcChannel,this.dstChannel=t.dstChannel,this.centerX=t.centerX,this.centerY=t.centerY,this.color=t.color,this},getGLSL:function(){var o=this;return o.color,o.input("source")?{instance:o,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform sampler2D src;","uniform vec2 srcSize;","uniform vec2 center;","uniform vec4 color;","uniform int sC;","uniform int tC;","#define COLOR32 "+sr.COLOR32,"#define COLOR8 "+sr.COLOR8,"#define MASK32 "+sr.COLORMASK32,"#define MASK8 "+sr.COLORMASK8,"#define RED "+lr.R,"#define GREEN "+lr.G,"#define BLUE "+lr.B,"#define ALPHA "+lr.A,"uniform int mode;","void main(void) {","   vec4 tCol = texture2D(img, pix);","   vec2 p = (pix - (center - 0.5*srcSize))/srcSize;","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (MASK32 == mode) {tCol *= color;}","       else if (COLOR32 == mode) {tCol = color;}","       else if (MASK8 == mode) {","           if (ALPHA == tC) tCol.a *= color.a;","           else if (BLUE == tC) tCol.b *= color.b;","           else if (GREEN == tC) tCol.g *= color.g;","           else tCol.r *= color.r;","       }","       else if (COLOR8 == mode) {","           if (ALPHA == tC) tCol.a = color.a;","           else if (BLUE == tC) tCol.b = color.b;","           else if (GREEN == tC) tCol.g = color.g;","           else tCol.r = color.r;","       }","   } else {","       vec4 sCol = texture2D(src, p);","       if (ALPHA == sC) {","           if (ALPHA == tC) tCol.a = sCol.a;","           else if (BLUE == tC) tCol.b = sCol.a;","           else if (GREEN == tC) tCol.g = sCol.a;","           else tCol.r = sCol.a;","       } else if (BLUE == sC) {","           if (ALPHA == tC) tCol.a = sCol.b;","           else if (BLUE == tC) tCol.b = sCol.b;","           else if (GREEN == tC) tCol.g = sCol.b;","           else tCol.r = sCol.b;","       } else if (GREEN == sC) {","           if (ALPHA == tC) tCol.a = sCol.g;","           else if (BLUE == tC) tCol.b = sCol.g;","           else if (GREEN == tC) tCol.g = sCol.g;","           else tCol.r = sCol.g;","       } else {","           if (ALPHA == tC) tCol.a = sCol.r;","           else if (BLUE == tC) tCol.b = sCol.r;","           else if (GREEN == tC) tCol.g = sCol.r;","           else tCol.r = sCol.r;","       }","   }","   gl_FragColor = tCol;","}"].join("\n"),textures:function(t,e,n,r){var i=o.input("source");or.uploadTexture(t,i[0],i[1],i[2],1)},vars:function(t,e,n,r){var i=o.input("source"),a=o.color||0;t.uniform1i(r.uniform.src,1),t.uniform2f(r.uniform.srcSize,i[1]/e,i[2]/n),t.uniform2f(r.uniform.center,o.centerX,o.centerY),t.uniform1i(r.uniform.sC,o.srcChannel),t.uniform1i(r.uniform.tC,o.dstChannel),sr.COLOR8===o.mode||sr.MASK8===o.mode?t.uniform4f(r.uniform.color,a=(255&a)/255,a,a,a):t.uniform4f(r.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255)}}:{instance:o,shader:or.DEFAULT}},apply:function(t,e,n){var r=this.input("source");if(r){var i,a,o,l,s,u,c,f,h,m=r[0],p=r[1],r=r[2],d=t.length,g=(m.length,this.srcChannel),_=this.dstChannel,v=this.centerX||0,C=this.centerY||0,y=p>>>1,x=r>>>1,b=ir(e,p),S=ir(n,r),A=this.color||0,R=this.mode,I=sr.COLOR32,L=sr.COLOR8,E=sr.COLORMASK32,w=sr.COLORMASK8;for(I===R||E===R?(h=A>>>24&255,u=A>>>16&255,c=A>>>8&255,f=255&A):L!==R&&w!==R||(A&=255),v=ar(v*(e-1))-y,C=ar(C*(n-1))-x,i=o=a=0;i<d;i+=4,++a)e<=a&&(a=0,++o),s=o-C,(l=a-v)<0||b<=l||s<0||S<=s?I===R?(t[i]=u,t[i+1]=c,t[i+2]=f,t[i+3]=h):E===R?(t[i]=u&t[i],t[i+1]=c&t[i+1],t[i+2]=f&t[i+2],t[i+3]=h&t[i+3]):L===R?t[i+_]=A:w===R&&(t[i+_]=A&t[i+g]):t[i+_]=m[(l+s*p<<2)+g]}return t}});var aa=I,oa=aa._notSupportClamp,la=aa.CHANNEL,sa=aa.MODE,ua=aa.Util.Filter,E=(aa.Array32F,Math),ca=E.pow,G=(E.min,E.max,aa.Create({name:"ThresholdFilter",path:aa.Path,hasMeta:!0,mode:sa.INTENSITY,color0:0,color1:null,channel:0,init:function(t,e,n,r){this.mode=t||sa.INTENSITY,this.color0=e||0,null!=n&&(this.color1=n),this.channel=r||0},serialize:function(){return{color0:this.color0,color1:this.color1,channel:this.channel}},unserialize:function(t){return this.color0=t.color0,this.color1=t.color1,this.channel=t.channel,this},metaData:function(t){return t&&aa.isWorker?TypedObj(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?TypedObj(t,1):t,this},_apply_rgb:function(t,e,n){var r,i,a,o,l,s,u,c,f,h=this.color0||0,m=h>>>16&255,p=h>>>8&255,d=255&h,g=this.color1,_=t.length;for(null!=g&&(s=g>>>16&255,u=g>>>8&255,c=255&g),h=ua.histogram(t,la.R),r=ua.histogram(t,la.G),i=ua.histogram(t,la.B),a=ua.otsu(h.bin,h.total,h.min,h.max),o=ua.otsu(r.bin,r.total,r.min,r.max),l=ua.otsu(i.bin,i.total,i.min,i.max),f=0;f<_;f+=4)t[f]<a?t[f]=m:null!=g&&(t[f]=s),t[f+1]<o?t[f+1]=p:null!=g&&(t[f+1]=u),t[f+2]<l?t[f+2]=d:null!=g&&(t[f+2]=c);return this.meta=[a,o,l],t},apply:function(t,e,n){if(sa.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,a,o,l,s,u,c,f,h,m,p,e=this.color0||0,d=e>>>16&255,g=e>>>8&255,_=255&e,v=this.color1,C=t.length,y=this.channel||0,n=this.mode;if(null!=v&&(u=v>>>16&255,c=v>>>8&255,f=255&v),sa.GRAY===n||sa.CHANNEL===n)h=ua.histogram(t,y);else{for(m=0;m<C;m+=4)o=0+.299*(r=t[m])+.587*(i=t[m+1])+.114*(a=t[m+2])|0,l=128-.168736*r-.331264*i+.5*a|0,s=128+.5*r-.418688*i-.081312*a|0,oa&&(s=s<0?0:255<s?255:s,o=o<0?0:255<o?255:o,l=l<0?0:255<l?255:l),t[m]=s,t[m+1]=o,t[m+2]=l;h=ua.histogram(t,la.G)}if(p=ua.otsu(h.bin,h.total,h.min,h.max),sa.GRAY===n)for(m=0;m<C;m+=4)t[m+y]<p?(t[m]=d,t[m+1]=g,t[m+2]=_):null!=v&&(t[m]=u,t[m+1]=c,t[m+2]=f);else if(sa.CHANNEL===n)for(m=0;m<C;m+=4)t[m+y]<p?t[m+y]=2===y?_:1===y?g:d:null!=v&&(t[m+y]=2===y?f:1===y?c:u);else for(m=0;m<C;m+=4)s=t[m],o=t[m+1],l=t[m+2],o<p?(t[m]=d,t[m+1]=g,t[m+2]=_):null!=v?(t[m]=u,t[m+1]=c,t[m+2]=f):(r=o+1.402*(s-128)|0,i=o-.34414*(l-128)-.71414*(s-128)|0,a=o+1.772*(l-128)|0,oa&&(r=r<0?0:255<r?255:r,i=i<0?0:255<i?255:i,a=a<0?0:255<a?255:a),t[m]=r,t[m+1]=i,t[m+2]=a);return this.meta=[p],t}}),ua.otsu=function(t,e,n,r){var i,a,o,l,s,u,c,f,h;for(null==r&&(r=255),o=0,f=n=null==n?0:n;f<=r;++f)o+=f*t[f]/e;for(u=t[h=n],c=n*t[n]/e,l=(i=u/e)*(a=1-i)*ca((o-c)/a-c/i,2),f=n+1;f<=r;++f)u+=t[f],c+=f*t[f]/e,l<(s=(i=u/e)*(a=1-i)*ca((o-c)/a-c/i,2))&&(l=s,h=f);return h},I),fa=G._notSupportClamp,ha=G.CHANNEL,ma=G.MODE,pa=G.Util.Filter,M=(G.Array32F,Math);function da(t,e,n,r,i,a){r|=0,i|=0,a|=0;var o=new Hr(256);return o[0]=(S(+n)<=a?r:i)<<2|(S(+e)<=a?r:i)<<1|(S(+t)<=a?r:i)<<0,o[1]=(S(n-1)<=a?r:i)<<2|(S(e-1)<=a?r:i)<<1|(S(t-1)<=a?r:i)<<0,o[2]=(S(n-2)<=a?r:i)<<2|(S(e-2)<=a?r:i)<<1|(S(t-2)<=a?r:i)<<0,o[3]=(S(n-3)<=a?r:i)<<2|(S(e-3)<=a?r:i)<<1|(S(t-3)<=a?r:i)<<0,o[4]=(S(n-4)<=a?r:i)<<2|(S(e-4)<=a?r:i)<<1|(S(t-4)<=a?r:i)<<0,o[5]=(S(n-5)<=a?r:i)<<2|(S(e-5)<=a?r:i)<<1|(S(t-5)<=a?r:i)<<0,o[6]=(S(n-6)<=a?r:i)<<2|(S(e-6)<=a?r:i)<<1|(S(t-6)<=a?r:i)<<0,o[7]=(S(n-7)<=a?r:i)<<2|(S(e-7)<=a?r:i)<<1|(S(t-7)<=a?r:i)<<0,o[8]=(S(n-8)<=a?r:i)<<2|(S(e-8)<=a?r:i)<<1|(S(t-8)<=a?r:i)<<0,o[9]=(S(n-9)<=a?r:i)<<2|(S(e-9)<=a?r:i)<<1|(S(t-9)<=a?r:i)<<0,o[10]=(S(n-10)<=a?r:i)<<2|(S(e-10)<=a?r:i)<<1|(S(t-10)<=a?r:i)<<0,o[11]=(S(n-11)<=a?r:i)<<2|(S(e-11)<=a?r:i)<<1|(S(t-11)<=a?r:i)<<0,o[12]=(S(n-12)<=a?r:i)<<2|(S(e-12)<=a?r:i)<<1|(S(t-12)<=a?r:i)<<0,o[13]=(S(n-13)<=a?r:i)<<2|(S(e-13)<=a?r:i)<<1|(S(t-13)<=a?r:i)<<0,o[14]=(S(n-14)<=a?r:i)<<2|(S(e-14)<=a?r:i)<<1|(S(t-14)<=a?r:i)<<0,o[15]=(S(n-15)<=a?r:i)<<2|(S(e-15)<=a?r:i)<<1|(S(t-15)<=a?r:i)<<0,o[16]=(S(n-16)<=a?r:i)<<2|(S(e-16)<=a?r:i)<<1|(S(t-16)<=a?r:i)<<0,o[17]=(S(n-17)<=a?r:i)<<2|(S(e-17)<=a?r:i)<<1|(S(t-17)<=a?r:i)<<0,o[18]=(S(n-18)<=a?r:i)<<2|(S(e-18)<=a?r:i)<<1|(S(t-18)<=a?r:i)<<0,o[19]=(S(n-19)<=a?r:i)<<2|(S(e-19)<=a?r:i)<<1|(S(t-19)<=a?r:i)<<0,o[20]=(S(n-20)<=a?r:i)<<2|(S(e-20)<=a?r:i)<<1|(S(t-20)<=a?r:i)<<0,o[21]=(S(n-21)<=a?r:i)<<2|(S(e-21)<=a?r:i)<<1|(S(t-21)<=a?r:i)<<0,o[22]=(S(n-22)<=a?r:i)<<2|(S(e-22)<=a?r:i)<<1|(S(t-22)<=a?r:i)<<0,o[23]=(S(n-23)<=a?r:i)<<2|(S(e-23)<=a?r:i)<<1|(S(t-23)<=a?r:i)<<0,o[24]=(S(n-24)<=a?r:i)<<2|(S(e-24)<=a?r:i)<<1|(S(t-24)<=a?r:i)<<0,o[25]=(S(n-25)<=a?r:i)<<2|(S(e-25)<=a?r:i)<<1|(S(t-25)<=a?r:i)<<0,o[26]=(S(n-26)<=a?r:i)<<2|(S(e-26)<=a?r:i)<<1|(S(t-26)<=a?r:i)<<0,o[27]=(S(n-27)<=a?r:i)<<2|(S(e-27)<=a?r:i)<<1|(S(t-27)<=a?r:i)<<0,o[28]=(S(n-28)<=a?r:i)<<2|(S(e-28)<=a?r:i)<<1|(S(t-28)<=a?r:i)<<0,o[29]=(S(n-29)<=a?r:i)<<2|(S(e-29)<=a?r:i)<<1|(S(t-29)<=a?r:i)<<0,o[30]=(S(n-30)<=a?r:i)<<2|(S(e-30)<=a?r:i)<<1|(S(t-30)<=a?r:i)<<0,o[31]=(S(n-31)<=a?r:i)<<2|(S(e-31)<=a?r:i)<<1|(S(t-31)<=a?r:i)<<0,o[32]=(S(n-32)<=a?r:i)<<2|(S(e-32)<=a?r:i)<<1|(S(t-32)<=a?r:i)<<0,o[33]=(S(n-33)<=a?r:i)<<2|(S(e-33)<=a?r:i)<<1|(S(t-33)<=a?r:i)<<0,o[34]=(S(n-34)<=a?r:i)<<2|(S(e-34)<=a?r:i)<<1|(S(t-34)<=a?r:i)<<0,o[35]=(S(n-35)<=a?r:i)<<2|(S(e-35)<=a?r:i)<<1|(S(t-35)<=a?r:i)<<0,o[36]=(S(n-36)<=a?r:i)<<2|(S(e-36)<=a?r:i)<<1|(S(t-36)<=a?r:i)<<0,o[37]=(S(n-37)<=a?r:i)<<2|(S(e-37)<=a?r:i)<<1|(S(t-37)<=a?r:i)<<0,o[38]=(S(n-38)<=a?r:i)<<2|(S(e-38)<=a?r:i)<<1|(S(t-38)<=a?r:i)<<0,o[39]=(S(n-39)<=a?r:i)<<2|(S(e-39)<=a?r:i)<<1|(S(t-39)<=a?r:i)<<0,o[40]=(S(n-40)<=a?r:i)<<2|(S(e-40)<=a?r:i)<<1|(S(t-40)<=a?r:i)<<0,o[41]=(S(n-41)<=a?r:i)<<2|(S(e-41)<=a?r:i)<<1|(S(t-41)<=a?r:i)<<0,o[42]=(S(n-42)<=a?r:i)<<2|(S(e-42)<=a?r:i)<<1|(S(t-42)<=a?r:i)<<0,o[43]=(S(n-43)<=a?r:i)<<2|(S(e-43)<=a?r:i)<<1|(S(t-43)<=a?r:i)<<0,o[44]=(S(n-44)<=a?r:i)<<2|(S(e-44)<=a?r:i)<<1|(S(t-44)<=a?r:i)<<0,o[45]=(S(n-45)<=a?r:i)<<2|(S(e-45)<=a?r:i)<<1|(S(t-45)<=a?r:i)<<0,o[46]=(S(n-46)<=a?r:i)<<2|(S(e-46)<=a?r:i)<<1|(S(t-46)<=a?r:i)<<0,o[47]=(S(n-47)<=a?r:i)<<2|(S(e-47)<=a?r:i)<<1|(S(t-47)<=a?r:i)<<0,o[48]=(S(n-48)<=a?r:i)<<2|(S(e-48)<=a?r:i)<<1|(S(t-48)<=a?r:i)<<0,o[49]=(S(n-49)<=a?r:i)<<2|(S(e-49)<=a?r:i)<<1|(S(t-49)<=a?r:i)<<0,o[50]=(S(n-50)<=a?r:i)<<2|(S(e-50)<=a?r:i)<<1|(S(t-50)<=a?r:i)<<0,o[51]=(S(n-51)<=a?r:i)<<2|(S(e-51)<=a?r:i)<<1|(S(t-51)<=a?r:i)<<0,o[52]=(S(n-52)<=a?r:i)<<2|(S(e-52)<=a?r:i)<<1|(S(t-52)<=a?r:i)<<0,o[53]=(S(n-53)<=a?r:i)<<2|(S(e-53)<=a?r:i)<<1|(S(t-53)<=a?r:i)<<0,o[54]=(S(n-54)<=a?r:i)<<2|(S(e-54)<=a?r:i)<<1|(S(t-54)<=a?r:i)<<0,o[55]=(S(n-55)<=a?r:i)<<2|(S(e-55)<=a?r:i)<<1|(S(t-55)<=a?r:i)<<0,o[56]=(S(n-56)<=a?r:i)<<2|(S(e-56)<=a?r:i)<<1|(S(t-56)<=a?r:i)<<0,o[57]=(S(n-57)<=a?r:i)<<2|(S(e-57)<=a?r:i)<<1|(S(t-57)<=a?r:i)<<0,o[58]=(S(n-58)<=a?r:i)<<2|(S(e-58)<=a?r:i)<<1|(S(t-58)<=a?r:i)<<0,o[59]=(S(n-59)<=a?r:i)<<2|(S(e-59)<=a?r:i)<<1|(S(t-59)<=a?r:i)<<0,o[60]=(S(n-60)<=a?r:i)<<2|(S(e-60)<=a?r:i)<<1|(S(t-60)<=a?r:i)<<0,o[61]=(S(n-61)<=a?r:i)<<2|(S(e-61)<=a?r:i)<<1|(S(t-61)<=a?r:i)<<0,o[62]=(S(n-62)<=a?r:i)<<2|(S(e-62)<=a?r:i)<<1|(S(t-62)<=a?r:i)<<0,o[63]=(S(n-63)<=a?r:i)<<2|(S(e-63)<=a?r:i)<<1|(S(t-63)<=a?r:i)<<0,o[64]=(S(n-64)<=a?r:i)<<2|(S(e-64)<=a?r:i)<<1|(S(t-64)<=a?r:i)<<0,o[65]=(S(n-65)<=a?r:i)<<2|(S(e-65)<=a?r:i)<<1|(S(t-65)<=a?r:i)<<0,o[66]=(S(n-66)<=a?r:i)<<2|(S(e-66)<=a?r:i)<<1|(S(t-66)<=a?r:i)<<0,o[67]=(S(n-67)<=a?r:i)<<2|(S(e-67)<=a?r:i)<<1|(S(t-67)<=a?r:i)<<0,o[68]=(S(n-68)<=a?r:i)<<2|(S(e-68)<=a?r:i)<<1|(S(t-68)<=a?r:i)<<0,o[69]=(S(n-69)<=a?r:i)<<2|(S(e-69)<=a?r:i)<<1|(S(t-69)<=a?r:i)<<0,o[70]=(S(n-70)<=a?r:i)<<2|(S(e-70)<=a?r:i)<<1|(S(t-70)<=a?r:i)<<0,o[71]=(S(n-71)<=a?r:i)<<2|(S(e-71)<=a?r:i)<<1|(S(t-71)<=a?r:i)<<0,o[72]=(S(n-72)<=a?r:i)<<2|(S(e-72)<=a?r:i)<<1|(S(t-72)<=a?r:i)<<0,o[73]=(S(n-73)<=a?r:i)<<2|(S(e-73)<=a?r:i)<<1|(S(t-73)<=a?r:i)<<0,o[74]=(S(n-74)<=a?r:i)<<2|(S(e-74)<=a?r:i)<<1|(S(t-74)<=a?r:i)<<0,o[75]=(S(n-75)<=a?r:i)<<2|(S(e-75)<=a?r:i)<<1|(S(t-75)<=a?r:i)<<0,o[76]=(S(n-76)<=a?r:i)<<2|(S(e-76)<=a?r:i)<<1|(S(t-76)<=a?r:i)<<0,o[77]=(S(n-77)<=a?r:i)<<2|(S(e-77)<=a?r:i)<<1|(S(t-77)<=a?r:i)<<0,o[78]=(S(n-78)<=a?r:i)<<2|(S(e-78)<=a?r:i)<<1|(S(t-78)<=a?r:i)<<0,o[79]=(S(n-79)<=a?r:i)<<2|(S(e-79)<=a?r:i)<<1|(S(t-79)<=a?r:i)<<0,o[80]=(S(n-80)<=a?r:i)<<2|(S(e-80)<=a?r:i)<<1|(S(t-80)<=a?r:i)<<0,o[81]=(S(n-81)<=a?r:i)<<2|(S(e-81)<=a?r:i)<<1|(S(t-81)<=a?r:i)<<0,o[82]=(S(n-82)<=a?r:i)<<2|(S(e-82)<=a?r:i)<<1|(S(t-82)<=a?r:i)<<0,o[83]=(S(n-83)<=a?r:i)<<2|(S(e-83)<=a?r:i)<<1|(S(t-83)<=a?r:i)<<0,o[84]=(S(n-84)<=a?r:i)<<2|(S(e-84)<=a?r:i)<<1|(S(t-84)<=a?r:i)<<0,o[85]=(S(n-85)<=a?r:i)<<2|(S(e-85)<=a?r:i)<<1|(S(t-85)<=a?r:i)<<0,o[86]=(S(n-86)<=a?r:i)<<2|(S(e-86)<=a?r:i)<<1|(S(t-86)<=a?r:i)<<0,o[87]=(S(n-87)<=a?r:i)<<2|(S(e-87)<=a?r:i)<<1|(S(t-87)<=a?r:i)<<0,o[88]=(S(n-88)<=a?r:i)<<2|(S(e-88)<=a?r:i)<<1|(S(t-88)<=a?r:i)<<0,o[89]=(S(n-89)<=a?r:i)<<2|(S(e-89)<=a?r:i)<<1|(S(t-89)<=a?r:i)<<0,o[90]=(S(n-90)<=a?r:i)<<2|(S(e-90)<=a?r:i)<<1|(S(t-90)<=a?r:i)<<0,o[91]=(S(n-91)<=a?r:i)<<2|(S(e-91)<=a?r:i)<<1|(S(t-91)<=a?r:i)<<0,o[92]=(S(n-92)<=a?r:i)<<2|(S(e-92)<=a?r:i)<<1|(S(t-92)<=a?r:i)<<0,o[93]=(S(n-93)<=a?r:i)<<2|(S(e-93)<=a?r:i)<<1|(S(t-93)<=a?r:i)<<0,o[94]=(S(n-94)<=a?r:i)<<2|(S(e-94)<=a?r:i)<<1|(S(t-94)<=a?r:i)<<0,o[95]=(S(n-95)<=a?r:i)<<2|(S(e-95)<=a?r:i)<<1|(S(t-95)<=a?r:i)<<0,o[96]=(S(n-96)<=a?r:i)<<2|(S(e-96)<=a?r:i)<<1|(S(t-96)<=a?r:i)<<0,o[97]=(S(n-97)<=a?r:i)<<2|(S(e-97)<=a?r:i)<<1|(S(t-97)<=a?r:i)<<0,o[98]=(S(n-98)<=a?r:i)<<2|(S(e-98)<=a?r:i)<<1|(S(t-98)<=a?r:i)<<0,o[99]=(S(n-99)<=a?r:i)<<2|(S(e-99)<=a?r:i)<<1|(S(t-99)<=a?r:i)<<0,o[100]=(S(n-100)<=a?r:i)<<2|(S(e-100)<=a?r:i)<<1|(S(t-100)<=a?r:i)<<0,o[101]=(S(n-101)<=a?r:i)<<2|(S(e-101)<=a?r:i)<<1|(S(t-101)<=a?r:i)<<0,o[102]=(S(n-102)<=a?r:i)<<2|(S(e-102)<=a?r:i)<<1|(S(t-102)<=a?r:i)<<0,o[103]=(S(n-103)<=a?r:i)<<2|(S(e-103)<=a?r:i)<<1|(S(t-103)<=a?r:i)<<0,o[104]=(S(n-104)<=a?r:i)<<2|(S(e-104)<=a?r:i)<<1|(S(t-104)<=a?r:i)<<0,o[105]=(S(n-105)<=a?r:i)<<2|(S(e-105)<=a?r:i)<<1|(S(t-105)<=a?r:i)<<0,o[106]=(S(n-106)<=a?r:i)<<2|(S(e-106)<=a?r:i)<<1|(S(t-106)<=a?r:i)<<0,o[107]=(S(n-107)<=a?r:i)<<2|(S(e-107)<=a?r:i)<<1|(S(t-107)<=a?r:i)<<0,o[108]=(S(n-108)<=a?r:i)<<2|(S(e-108)<=a?r:i)<<1|(S(t-108)<=a?r:i)<<0,o[109]=(S(n-109)<=a?r:i)<<2|(S(e-109)<=a?r:i)<<1|(S(t-109)<=a?r:i)<<0,o[110]=(S(n-110)<=a?r:i)<<2|(S(e-110)<=a?r:i)<<1|(S(t-110)<=a?r:i)<<0,o[111]=(S(n-111)<=a?r:i)<<2|(S(e-111)<=a?r:i)<<1|(S(t-111)<=a?r:i)<<0,o[112]=(S(n-112)<=a?r:i)<<2|(S(e-112)<=a?r:i)<<1|(S(t-112)<=a?r:i)<<0,o[113]=(S(n-113)<=a?r:i)<<2|(S(e-113)<=a?r:i)<<1|(S(t-113)<=a?r:i)<<0,o[114]=(S(n-114)<=a?r:i)<<2|(S(e-114)<=a?r:i)<<1|(S(t-114)<=a?r:i)<<0,o[115]=(S(n-115)<=a?r:i)<<2|(S(e-115)<=a?r:i)<<1|(S(t-115)<=a?r:i)<<0,o[116]=(S(n-116)<=a?r:i)<<2|(S(e-116)<=a?r:i)<<1|(S(t-116)<=a?r:i)<<0,o[117]=(S(n-117)<=a?r:i)<<2|(S(e-117)<=a?r:i)<<1|(S(t-117)<=a?r:i)<<0,o[118]=(S(n-118)<=a?r:i)<<2|(S(e-118)<=a?r:i)<<1|(S(t-118)<=a?r:i)<<0,o[119]=(S(n-119)<=a?r:i)<<2|(S(e-119)<=a?r:i)<<1|(S(t-119)<=a?r:i)<<0,o[120]=(S(n-120)<=a?r:i)<<2|(S(e-120)<=a?r:i)<<1|(S(t-120)<=a?r:i)<<0,o[121]=(S(n-121)<=a?r:i)<<2|(S(e-121)<=a?r:i)<<1|(S(t-121)<=a?r:i)<<0,o[122]=(S(n-122)<=a?r:i)<<2|(S(e-122)<=a?r:i)<<1|(S(t-122)<=a?r:i)<<0,o[123]=(S(n-123)<=a?r:i)<<2|(S(e-123)<=a?r:i)<<1|(S(t-123)<=a?r:i)<<0,o[124]=(S(n-124)<=a?r:i)<<2|(S(e-124)<=a?r:i)<<1|(S(t-124)<=a?r:i)<<0,o[125]=(S(n-125)<=a?r:i)<<2|(S(e-125)<=a?r:i)<<1|(S(t-125)<=a?r:i)<<0,o[126]=(S(n-126)<=a?r:i)<<2|(S(e-126)<=a?r:i)<<1|(S(t-126)<=a?r:i)<<0,o[127]=(S(n-127)<=a?r:i)<<2|(S(e-127)<=a?r:i)<<1|(S(t-127)<=a?r:i)<<0,o[128]=(S(n-128)<=a?r:i)<<2|(S(e-128)<=a?r:i)<<1|(S(t-128)<=a?r:i)<<0,o[129]=(S(n-129)<=a?r:i)<<2|(S(e-129)<=a?r:i)<<1|(S(t-129)<=a?r:i)<<0,o[130]=(S(n-130)<=a?r:i)<<2|(S(e-130)<=a?r:i)<<1|(S(t-130)<=a?r:i)<<0,o[131]=(S(n-131)<=a?r:i)<<2|(S(e-131)<=a?r:i)<<1|(S(t-131)<=a?r:i)<<0,o[132]=(S(n-132)<=a?r:i)<<2|(S(e-132)<=a?r:i)<<1|(S(t-132)<=a?r:i)<<0,o[133]=(S(n-133)<=a?r:i)<<2|(S(e-133)<=a?r:i)<<1|(S(t-133)<=a?r:i)<<0,o[134]=(S(n-134)<=a?r:i)<<2|(S(e-134)<=a?r:i)<<1|(S(t-134)<=a?r:i)<<0,o[135]=(S(n-135)<=a?r:i)<<2|(S(e-135)<=a?r:i)<<1|(S(t-135)<=a?r:i)<<0,o[136]=(S(n-136)<=a?r:i)<<2|(S(e-136)<=a?r:i)<<1|(S(t-136)<=a?r:i)<<0,o[137]=(S(n-137)<=a?r:i)<<2|(S(e-137)<=a?r:i)<<1|(S(t-137)<=a?r:i)<<0,o[138]=(S(n-138)<=a?r:i)<<2|(S(e-138)<=a?r:i)<<1|(S(t-138)<=a?r:i)<<0,o[139]=(S(n-139)<=a?r:i)<<2|(S(e-139)<=a?r:i)<<1|(S(t-139)<=a?r:i)<<0,o[140]=(S(n-140)<=a?r:i)<<2|(S(e-140)<=a?r:i)<<1|(S(t-140)<=a?r:i)<<0,o[141]=(S(n-141)<=a?r:i)<<2|(S(e-141)<=a?r:i)<<1|(S(t-141)<=a?r:i)<<0,o[142]=(S(n-142)<=a?r:i)<<2|(S(e-142)<=a?r:i)<<1|(S(t-142)<=a?r:i)<<0,o[143]=(S(n-143)<=a?r:i)<<2|(S(e-143)<=a?r:i)<<1|(S(t-143)<=a?r:i)<<0,o[144]=(S(n-144)<=a?r:i)<<2|(S(e-144)<=a?r:i)<<1|(S(t-144)<=a?r:i)<<0,o[145]=(S(n-145)<=a?r:i)<<2|(S(e-145)<=a?r:i)<<1|(S(t-145)<=a?r:i)<<0,o[146]=(S(n-146)<=a?r:i)<<2|(S(e-146)<=a?r:i)<<1|(S(t-146)<=a?r:i)<<0,o[147]=(S(n-147)<=a?r:i)<<2|(S(e-147)<=a?r:i)<<1|(S(t-147)<=a?r:i)<<0,o[148]=(S(n-148)<=a?r:i)<<2|(S(e-148)<=a?r:i)<<1|(S(t-148)<=a?r:i)<<0,o[149]=(S(n-149)<=a?r:i)<<2|(S(e-149)<=a?r:i)<<1|(S(t-149)<=a?r:i)<<0,o[150]=(S(n-150)<=a?r:i)<<2|(S(e-150)<=a?r:i)<<1|(S(t-150)<=a?r:i)<<0,o[151]=(S(n-151)<=a?r:i)<<2|(S(e-151)<=a?r:i)<<1|(S(t-151)<=a?r:i)<<0,o[152]=(S(n-152)<=a?r:i)<<2|(S(e-152)<=a?r:i)<<1|(S(t-152)<=a?r:i)<<0,o[153]=(S(n-153)<=a?r:i)<<2|(S(e-153)<=a?r:i)<<1|(S(t-153)<=a?r:i)<<0,o[154]=(S(n-154)<=a?r:i)<<2|(S(e-154)<=a?r:i)<<1|(S(t-154)<=a?r:i)<<0,o[155]=(S(n-155)<=a?r:i)<<2|(S(e-155)<=a?r:i)<<1|(S(t-155)<=a?r:i)<<0,o[156]=(S(n-156)<=a?r:i)<<2|(S(e-156)<=a?r:i)<<1|(S(t-156)<=a?r:i)<<0,o[157]=(S(n-157)<=a?r:i)<<2|(S(e-157)<=a?r:i)<<1|(S(t-157)<=a?r:i)<<0,o[158]=(S(n-158)<=a?r:i)<<2|(S(e-158)<=a?r:i)<<1|(S(t-158)<=a?r:i)<<0,o[159]=(S(n-159)<=a?r:i)<<2|(S(e-159)<=a?r:i)<<1|(S(t-159)<=a?r:i)<<0,o[160]=(S(n-160)<=a?r:i)<<2|(S(e-160)<=a?r:i)<<1|(S(t-160)<=a?r:i)<<0,o[161]=(S(n-161)<=a?r:i)<<2|(S(e-161)<=a?r:i)<<1|(S(t-161)<=a?r:i)<<0,o[162]=(S(n-162)<=a?r:i)<<2|(S(e-162)<=a?r:i)<<1|(S(t-162)<=a?r:i)<<0,o[163]=(S(n-163)<=a?r:i)<<2|(S(e-163)<=a?r:i)<<1|(S(t-163)<=a?r:i)<<0,o[164]=(S(n-164)<=a?r:i)<<2|(S(e-164)<=a?r:i)<<1|(S(t-164)<=a?r:i)<<0,o[165]=(S(n-165)<=a?r:i)<<2|(S(e-165)<=a?r:i)<<1|(S(t-165)<=a?r:i)<<0,o[166]=(S(n-166)<=a?r:i)<<2|(S(e-166)<=a?r:i)<<1|(S(t-166)<=a?r:i)<<0,o[167]=(S(n-167)<=a?r:i)<<2|(S(e-167)<=a?r:i)<<1|(S(t-167)<=a?r:i)<<0,o[168]=(S(n-168)<=a?r:i)<<2|(S(e-168)<=a?r:i)<<1|(S(t-168)<=a?r:i)<<0,o[169]=(S(n-169)<=a?r:i)<<2|(S(e-169)<=a?r:i)<<1|(S(t-169)<=a?r:i)<<0,o[170]=(S(n-170)<=a?r:i)<<2|(S(e-170)<=a?r:i)<<1|(S(t-170)<=a?r:i)<<0,o[171]=(S(n-171)<=a?r:i)<<2|(S(e-171)<=a?r:i)<<1|(S(t-171)<=a?r:i)<<0,o[172]=(S(n-172)<=a?r:i)<<2|(S(e-172)<=a?r:i)<<1|(S(t-172)<=a?r:i)<<0,o[173]=(S(n-173)<=a?r:i)<<2|(S(e-173)<=a?r:i)<<1|(S(t-173)<=a?r:i)<<0,o[174]=(S(n-174)<=a?r:i)<<2|(S(e-174)<=a?r:i)<<1|(S(t-174)<=a?r:i)<<0,o[175]=(S(n-175)<=a?r:i)<<2|(S(e-175)<=a?r:i)<<1|(S(t-175)<=a?r:i)<<0,o[176]=(S(n-176)<=a?r:i)<<2|(S(e-176)<=a?r:i)<<1|(S(t-176)<=a?r:i)<<0,o[177]=(S(n-177)<=a?r:i)<<2|(S(e-177)<=a?r:i)<<1|(S(t-177)<=a?r:i)<<0,o[178]=(S(n-178)<=a?r:i)<<2|(S(e-178)<=a?r:i)<<1|(S(t-178)<=a?r:i)<<0,o[179]=(S(n-179)<=a?r:i)<<2|(S(e-179)<=a?r:i)<<1|(S(t-179)<=a?r:i)<<0,o[180]=(S(n-180)<=a?r:i)<<2|(S(e-180)<=a?r:i)<<1|(S(t-180)<=a?r:i)<<0,o[181]=(S(n-181)<=a?r:i)<<2|(S(e-181)<=a?r:i)<<1|(S(t-181)<=a?r:i)<<0,o[182]=(S(n-182)<=a?r:i)<<2|(S(e-182)<=a?r:i)<<1|(S(t-182)<=a?r:i)<<0,o[183]=(S(n-183)<=a?r:i)<<2|(S(e-183)<=a?r:i)<<1|(S(t-183)<=a?r:i)<<0,o[184]=(S(n-184)<=a?r:i)<<2|(S(e-184)<=a?r:i)<<1|(S(t-184)<=a?r:i)<<0,o[185]=(S(n-185)<=a?r:i)<<2|(S(e-185)<=a?r:i)<<1|(S(t-185)<=a?r:i)<<0,o[186]=(S(n-186)<=a?r:i)<<2|(S(e-186)<=a?r:i)<<1|(S(t-186)<=a?r:i)<<0,o[187]=(S(n-187)<=a?r:i)<<2|(S(e-187)<=a?r:i)<<1|(S(t-187)<=a?r:i)<<0,o[188]=(S(n-188)<=a?r:i)<<2|(S(e-188)<=a?r:i)<<1|(S(t-188)<=a?r:i)<<0,o[189]=(S(n-189)<=a?r:i)<<2|(S(e-189)<=a?r:i)<<1|(S(t-189)<=a?r:i)<<0,o[190]=(S(n-190)<=a?r:i)<<2|(S(e-190)<=a?r:i)<<1|(S(t-190)<=a?r:i)<<0,o[191]=(S(n-191)<=a?r:i)<<2|(S(e-191)<=a?r:i)<<1|(S(t-191)<=a?r:i)<<0,o[192]=(S(n-192)<=a?r:i)<<2|(S(e-192)<=a?r:i)<<1|(S(t-192)<=a?r:i)<<0,o[193]=(S(n-193)<=a?r:i)<<2|(S(e-193)<=a?r:i)<<1|(S(t-193)<=a?r:i)<<0,o[194]=(S(n-194)<=a?r:i)<<2|(S(e-194)<=a?r:i)<<1|(S(t-194)<=a?r:i)<<0,o[195]=(S(n-195)<=a?r:i)<<2|(S(e-195)<=a?r:i)<<1|(S(t-195)<=a?r:i)<<0,o[196]=(S(n-196)<=a?r:i)<<2|(S(e-196)<=a?r:i)<<1|(S(t-196)<=a?r:i)<<0,o[197]=(S(n-197)<=a?r:i)<<2|(S(e-197)<=a?r:i)<<1|(S(t-197)<=a?r:i)<<0,o[198]=(S(n-198)<=a?r:i)<<2|(S(e-198)<=a?r:i)<<1|(S(t-198)<=a?r:i)<<0,o[199]=(S(n-199)<=a?r:i)<<2|(S(e-199)<=a?r:i)<<1|(S(t-199)<=a?r:i)<<0,o[200]=(S(n-200)<=a?r:i)<<2|(S(e-200)<=a?r:i)<<1|(S(t-200)<=a?r:i)<<0,o[201]=(S(n-201)<=a?r:i)<<2|(S(e-201)<=a?r:i)<<1|(S(t-201)<=a?r:i)<<0,o[202]=(S(n-202)<=a?r:i)<<2|(S(e-202)<=a?r:i)<<1|(S(t-202)<=a?r:i)<<0,o[203]=(S(n-203)<=a?r:i)<<2|(S(e-203)<=a?r:i)<<1|(S(t-203)<=a?r:i)<<0,o[204]=(S(n-204)<=a?r:i)<<2|(S(e-204)<=a?r:i)<<1|(S(t-204)<=a?r:i)<<0,o[205]=(S(n-205)<=a?r:i)<<2|(S(e-205)<=a?r:i)<<1|(S(t-205)<=a?r:i)<<0,o[206]=(S(n-206)<=a?r:i)<<2|(S(e-206)<=a?r:i)<<1|(S(t-206)<=a?r:i)<<0,o[207]=(S(n-207)<=a?r:i)<<2|(S(e-207)<=a?r:i)<<1|(S(t-207)<=a?r:i)<<0,o[208]=(S(n-208)<=a?r:i)<<2|(S(e-208)<=a?r:i)<<1|(S(t-208)<=a?r:i)<<0,o[209]=(S(n-209)<=a?r:i)<<2|(S(e-209)<=a?r:i)<<1|(S(t-209)<=a?r:i)<<0,o[210]=(S(n-210)<=a?r:i)<<2|(S(e-210)<=a?r:i)<<1|(S(t-210)<=a?r:i)<<0,o[211]=(S(n-211)<=a?r:i)<<2|(S(e-211)<=a?r:i)<<1|(S(t-211)<=a?r:i)<<0,o[212]=(S(n-212)<=a?r:i)<<2|(S(e-212)<=a?r:i)<<1|(S(t-212)<=a?r:i)<<0,o[213]=(S(n-213)<=a?r:i)<<2|(S(e-213)<=a?r:i)<<1|(S(t-213)<=a?r:i)<<0,o[214]=(S(n-214)<=a?r:i)<<2|(S(e-214)<=a?r:i)<<1|(S(t-214)<=a?r:i)<<0,o[215]=(S(n-215)<=a?r:i)<<2|(S(e-215)<=a?r:i)<<1|(S(t-215)<=a?r:i)<<0,o[216]=(S(n-216)<=a?r:i)<<2|(S(e-216)<=a?r:i)<<1|(S(t-216)<=a?r:i)<<0,o[217]=(S(n-217)<=a?r:i)<<2|(S(e-217)<=a?r:i)<<1|(S(t-217)<=a?r:i)<<0,o[218]=(S(n-218)<=a?r:i)<<2|(S(e-218)<=a?r:i)<<1|(S(t-218)<=a?r:i)<<0,o[219]=(S(n-219)<=a?r:i)<<2|(S(e-219)<=a?r:i)<<1|(S(t-219)<=a?r:i)<<0,o[220]=(S(n-220)<=a?r:i)<<2|(S(e-220)<=a?r:i)<<1|(S(t-220)<=a?r:i)<<0,o[221]=(S(n-221)<=a?r:i)<<2|(S(e-221)<=a?r:i)<<1|(S(t-221)<=a?r:i)<<0,o[222]=(S(n-222)<=a?r:i)<<2|(S(e-222)<=a?r:i)<<1|(S(t-222)<=a?r:i)<<0,o[223]=(S(n-223)<=a?r:i)<<2|(S(e-223)<=a?r:i)<<1|(S(t-223)<=a?r:i)<<0,o[224]=(S(n-224)<=a?r:i)<<2|(S(e-224)<=a?r:i)<<1|(S(t-224)<=a?r:i)<<0,o[225]=(S(n-225)<=a?r:i)<<2|(S(e-225)<=a?r:i)<<1|(S(t-225)<=a?r:i)<<0,o[226]=(S(n-226)<=a?r:i)<<2|(S(e-226)<=a?r:i)<<1|(S(t-226)<=a?r:i)<<0,o[227]=(S(n-227)<=a?r:i)<<2|(S(e-227)<=a?r:i)<<1|(S(t-227)<=a?r:i)<<0,o[228]=(S(n-228)<=a?r:i)<<2|(S(e-228)<=a?r:i)<<1|(S(t-228)<=a?r:i)<<0,o[229]=(S(n-229)<=a?r:i)<<2|(S(e-229)<=a?r:i)<<1|(S(t-229)<=a?r:i)<<0,o[230]=(S(n-230)<=a?r:i)<<2|(S(e-230)<=a?r:i)<<1|(S(t-230)<=a?r:i)<<0,o[231]=(S(n-231)<=a?r:i)<<2|(S(e-231)<=a?r:i)<<1|(S(t-231)<=a?r:i)<<0,o[232]=(S(n-232)<=a?r:i)<<2|(S(e-232)<=a?r:i)<<1|(S(t-232)<=a?r:i)<<0,o[233]=(S(n-233)<=a?r:i)<<2|(S(e-233)<=a?r:i)<<1|(S(t-233)<=a?r:i)<<0,o[234]=(S(n-234)<=a?r:i)<<2|(S(e-234)<=a?r:i)<<1|(S(t-234)<=a?r:i)<<0,o[235]=(S(n-235)<=a?r:i)<<2|(S(e-235)<=a?r:i)<<1|(S(t-235)<=a?r:i)<<0,o[236]=(S(n-236)<=a?r:i)<<2|(S(e-236)<=a?r:i)<<1|(S(t-236)<=a?r:i)<<0,o[237]=(S(n-237)<=a?r:i)<<2|(S(e-237)<=a?r:i)<<1|(S(t-237)<=a?r:i)<<0,o[238]=(S(n-238)<=a?r:i)<<2|(S(e-238)<=a?r:i)<<1|(S(t-238)<=a?r:i)<<0,o[239]=(S(n-239)<=a?r:i)<<2|(S(e-239)<=a?r:i)<<1|(S(t-239)<=a?r:i)<<0,o[240]=(S(n-240)<=a?r:i)<<2|(S(e-240)<=a?r:i)<<1|(S(t-240)<=a?r:i)<<0,o[241]=(S(n-241)<=a?r:i)<<2|(S(e-241)<=a?r:i)<<1|(S(t-241)<=a?r:i)<<0,o[242]=(S(n-242)<=a?r:i)<<2|(S(e-242)<=a?r:i)<<1|(S(t-242)<=a?r:i)<<0,o[243]=(S(n-243)<=a?r:i)<<2|(S(e-243)<=a?r:i)<<1|(S(t-243)<=a?r:i)<<0,o[244]=(S(n-244)<=a?r:i)<<2|(S(e-244)<=a?r:i)<<1|(S(t-244)<=a?r:i)<<0,o[245]=(S(n-245)<=a?r:i)<<2|(S(e-245)<=a?r:i)<<1|(S(t-245)<=a?r:i)<<0,o[246]=(S(n-246)<=a?r:i)<<2|(S(e-246)<=a?r:i)<<1|(S(t-246)<=a?r:i)<<0,o[247]=(S(n-247)<=a?r:i)<<2|(S(e-247)<=a?r:i)<<1|(S(t-247)<=a?r:i)<<0,o[248]=(S(n-248)<=a?r:i)<<2|(S(e-248)<=a?r:i)<<1|(S(t-248)<=a?r:i)<<0,o[249]=(S(n-249)<=a?r:i)<<2|(S(e-249)<=a?r:i)<<1|(S(t-249)<=a?r:i)<<0,o[250]=(S(n-250)<=a?r:i)<<2|(S(e-250)<=a?r:i)<<1|(S(t-250)<=a?r:i)<<0,o[251]=(S(n-251)<=a?r:i)<<2|(S(e-251)<=a?r:i)<<1|(S(t-251)<=a?r:i)<<0,o[252]=(S(n-252)<=a?r:i)<<2|(S(e-252)<=a?r:i)<<1|(S(t-252)<=a?r:i)<<0,o[253]=(S(n-253)<=a?r:i)<<2|(S(e-253)<=a?r:i)<<1|(S(t-253)<=a?r:i)<<0,o[254]=(S(n-254)<=a?r:i)<<2|(S(e-254)<=a?r:i)<<1|(S(t-254)<=a?r:i)<<0,o[255]=(S(n-255)<=a?r:i)<<2|(S(e-255)<=a?r:i)<<1|(S(t-255)<=a?r:i)<<0,o}function ga(t,e,n,r,i,a,o,l){var s,u,c,f,h,m,p,d,g=t.length,_=g>>>(r|=0),v=1<<r,C=e<<r,y=g-C,x=e-1<<r,b=o,S=l,A=o,R=l,I=new Nr(Ur(_/32)),L=new Or(_<<2),E=0,w=o+l>>>r;if(I[w>>>5]|=1<<(31&w),0<=l+C&&l+C<=y&&(L[E]=l,L[E+1]=o,L[E+2]=o,L[E+3]=C,E+=4),L[E]=l+C,L[E+1]=o,L[E+2]=o,L[E+3]=-C,E+=4,r)for(;0<E;){for(C=L[(E-=4)+3],m=L[E]+C,f=L[E+1],h=L[E+2],S=Br(S,m),R=Yr(R,m),b=Br(b,f),A=Yr(A,h),c=f;0<=c&&(w=(u=c+m)>>>r,!((d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]])||I[w>>>5]&1<<(31&w)));c-=v)I[w>>>5]|=1<<(31&w),b=Br(b,c);if(f<=c){for(w=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||I[w>>>5]&1<<(31&w));)w=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(s=c)<=h}else(s=c+v)<f&&0+C<=m&&m<=y+C&&(L[E]=m,L[E+1]=s,L[E+2]=f-v,L[E+3]=-C,E+=4),c=f+v,p=!0;for(;p;){for(w=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=x&&!d&&!(I[w>>>5]&1<<(31&w));)I[w>>>5]|=1<<(31&w),A=Yr(A,c),w=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];for(0<=m+C&&m+C<=y&&(L[E]=m,L[E+1]=s,L[E+2]=c-v,L[E+3]=C,E+=4),h+v<c&&0<=m-C&&m-C<=y&&(L[E]=m,L[E+1]=h+v,L[E+2]=c-v,L[E+3]=-C,E+=4),w=(u=c+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];c<=h&&(d||I[w>>>5]&1<<(31&w));)w=(u=(c+=v)+m)>>>r,d=1&i[t[u]]|2&i[t[u+1]]|4&i[t[u+2]];p=(s=c)<=h}}else for(;0<E;){for(C=L[(E-=4)+3],m=L[E]+C,f=L[E+1],h=L[E+2],S=Br(S,m),R=Yr(R,m),b=Br(b,f),A=Yr(A,h),c=f;0<=c&&!(1&i[t[w=u=c+m]]||I[w>>>5]&1<<(31&w));c-=v)I[w>>>5]|=1<<(31&w),b=Br(b,c);if(f<=c){for(w=u=c+m;c<=h&&(1&i[t[u]]||I[w>>>5]&1<<(31&w));)w=u=(c+=v)+m;p=(s=c)<=h}else(s=c+v)<f&&0+C<=m&&m<=y+C&&(L[E]=m,L[E+1]=s,L[E+2]=f-v,L[E+3]=-C,E+=4),c=f+v,p=!0;for(;p;){for(w=u=c+m;c<=x&&!(1&i[t[u]])&&!(I[w>>>5]&1<<(31&w));)I[w>>>5]|=1<<(31&w),A=Yr(A,c),w=u=(c+=v)+m;for(0<=m+C&&m+C<=y&&(L[E]=m,L[E+1]=s,L[E+2]=c-v,L[E+3]=C,E+=4),h+v<c&&0<=m-C&&m-C<=y&&(L[E]=m,L[E+1]=h+v,L[E+2]=c-v,L[E+3]=-C,E+=4),w=u=c+m;c<=h&&(1&i[t[u]]||I[w>>>5]&1<<(31&w));)w=u=(c+=v)+m;p=(s=c)<=h}}return{mask:I,box:[b,S,A,R]}}function _a(t,e,n,r,i,a,o){var l,s,u=zr.MODE,c=zr.Color.hue,f=zr.Color.intensity,h=$r.cos,m=zr.CONST.toRad,p=(t.length,i.length);if(0<r)if(u.HUE===o||u.COLORIZEHUE===o)for(s=l=0;s<p;l+=4,++s)i[s]=0===t[l+3]?1e4:h(m*c(t[l],t[l+1],t[l+2]));else if(u.INTENSITY===o)for(a*=255,s=l=0;s<p;l+=4,++s)i[s]=0===t[l+3]?1e4:f(t[l],t[l+1],t[l+2]);else if(u.GRAY===o)for(a*=255,s=l=0;s<p;l+=4,++s)i[s]=0===t[l+3]?1e4:t[l];else for(a=1e4*a+1e3*a+100*a+10*a+a,s=l=0;s<p;l+=4,++s)i[s]=0===t[l+3]?1e5:1e4*(t[l]+t[l+1]+t[l+2])/3/255+1e3*(t[l]+t[l+1])/2/255+100*(t[l+1]+t[l+2])/2/255+10*(t[l]+t[l+2])/2/255+t[l]/255;else if(u.HUE===o||u.COLORIZEHUE===o)for(s=l=0;s<p;++l,++s)i[s]=h(m*t[l]);else for(a*=255,s=l=0;s<p;++l,++s)i[s]=t[l];return a}function va(t,e,n){this.id=-1,this.root=n||this}function Ca(t){for(;t!==t.root;)t=t.root;return t}function ya(t,e){(t=Ca(t))!==(e=Ca(e))&&(t.root=e)}function xa(t,e,n,r,i,a,o,l,s){var u,c,f,h,m,p,d,g,_,v=t.length,C=v>>>(r|=0),y=8===a,x=null,b=null!=l,S=2*o,A=new Array(C),x=b?new va:null;for(A[0]=b&&qr(o+i[0]-l)>S?x:new va,f=1;f<e;++f)A[f]=b&&qr(o+i[f]-l)>S?x:qr(o+i[f]-i[f-1])<=S?A[f-1]:new va;for(h=1,m=e;h<n;++h,m+=e)for(A[m]=b&&qr(o+i[m]-l)>S?x:qr(o+i[m]-i[m-e])<=S?A[m-e]:new va,f=1;f<e;++f)b&&qr(o+i[m+f]-l)>S?A[m+f]=x:(c=x!==A[m+f-1]&&qr(o+i[m+f]-i[m+f-1])<=S?A[m+f-1]:null,y&&x!==A[m-e+f-1]&&qr(o+i[m+f]-i[m-e+f-1])<=S&&(null!=c?ya(c,A[m-e+f-1]):c=A[m-e+f-1]),x!==A[m-e+f]&&qr(o+i[m+f]-i[m-e+f])<=S&&(null!=c?ya(c,A[m-e+f]):c=A[m-e+f]),A[m+f]=null!=c?c:new va,y&&x!==A[m+f-1]&&x!==A[m-e+f]&&qr(o+i[m+f-1]-i[m-e+f])<=S&&ya(A[m+f-1],A[m-e+f]));for(_=s?(g=-255,255):(g=255,0),p=null!=x?(x.id=0,1):0,f=0;f<C;++f)A[f]=Ca(A[f]),A[f].id<0&&(A[f].id=p++);if(r)for(u=f=0;u<v;u+=4,++f)d=_+g*A[f].id/p|0,t[u]=t[u+1]=t[u+2]=d;else for(f=0;f<v;++f)d=_+g*A[f].id/p|0,t[f]=d;return t}function ba(t,e,n){var r=e.width*n,n=e.height*n;return t.x>=e.x-r&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+r&&t.y+t.height<=e.y+e.height+n}function Sa(t,e){return e.area-t.area}return M.min,M.max,G.Create({name:"HistogramEqualizeFilter",path:G.Path,mode:ma.INTENSITY,channel:0,factor:1,init:function(t,e,n){this.mode=t||ma.INTENSITY,this.channel=e||0,null!=n&&(this.factor=+n)},serialize:function(){return{channel:this.channel,factor:this.factor}},unserialize:function(t){return this.channel=t.channel,this.factor=t.factor,this},_apply_rgb:function(t,e,n){var r,i,a,o,l,s,u,c=this.factor,f=t.length,h=pa.histogram(t,ha.R,!0),m=pa.histogram(t,ha.G,!0),p=pa.histogram(t,ha.B,!0),d=c*(h.max-h.min)/h.total,g=c*(m.max-m.min)/m.total,_=c*(p.max-p.min)/p.total;if(fa)for(u=0;u<f;u+=4)r=t[u],i=t[u+1],a=t[u+2],o=h.bin[r]*d+h.min,l=(l=m.bin[i]*g+m.min)<0?0:255<l?255:l,s=(s=p.bin[a]*_+p.min)<0?0:255<s?255:s,t[u]=0|(o=o<0?0:255<o?255:o),t[u+1]=0|l,t[u+2]=0|s;else for(u=0;u<f;u+=4)r=t[u],i=t[u+1],a=t[u+2],o=h.bin[r]*d+h.min,l=m.bin[i]*g+m.min,s=p.bin[a]*_+p.min,t[u]=0|o,t[u+1]=0|l,t[u+2]=0|s;return t},apply:function(t,e,n){if(ma.RGB===this.mode)return this._apply_rgb(t,e,n);var r,i,a,o,l,s,u,c,f,h=t.length,e=this.factor,m=this.channel||0,n=this.mode;if(ma.GRAY===n||ma.CHANNEL===n)c=pa.histogram(t,m,!0);else{for(f=0;f<h;f+=4)o=(o=0+.299*(r=t[f])+.587*(i=t[f+1])+.114*(a=t[f+2])|0)<0?0:255<o?255:o,l=(l=128-.168736*r-.331264*i+.5*a|0)<0?0:255<l?255:l,t[f]=s=(s=128+.5*r-.418688*i-.081312*a|0)<0?0:255<s?255:s,t[f+1]=o,t[f+2]=l;c=pa.histogram(t,ha.G,!0)}if(u=e*(c.max-c.min)/c.total,fa)if(ma.GRAY===n)for(f=0;f<h;f+=4)r=c.bin[t[f+m]]*u+c.min|0,t[f]=r=r<0?0:255<r?255:r,t[f+1]=r,t[f+2]=r;else if(ma.CHANNEL===n)for(f=0;f<h;f+=4)r=c.bin[t[f+m]]*u+c.min|0,t[f+m]=r=r<0?0:255<r?255:r;else for(f=0;f<h;f+=4)i=(i=(o=c.bin[t[f+1]]*u+c.min)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128))<0?0:255<i?255:i,a=(a=o+1.772*(l-128))<0?0:255<a?255:a,t[f]=0|(r=(r=o+1.402*(s-128))<0?0:255<r?255:r),t[f+1]=0|i,t[f+2]=0|a;else if(ma.GRAY===n)for(f=0;f<h;f+=4)r=c.bin[t[f+m]]*u+c.min|0,t[f]=r,t[f+1]=r,t[f+2]=r;else if(ma.CHANNEL===n)for(f=0;f<h;f+=4)r=c.bin[t[f+m]]*u+c.min|0,t[f+m]=r;else for(f=0;f<h;f+=4)i=(o=c.bin[t[f+1]]*u+c.min)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128),a=o+1.772*(l-128),t[f]=0|(r=o+1.402*(s-128)),t[f+1]=0|i,t[f+2]=0|a;return t}}),ur=I,n=Math,cr=ur.Util.Math.hypot,fr=n.sqrt,n.abs,hr=n.min,w=n.max,mr=n.floor,pr=n.ceil,dr=ur.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:ur.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},getGLSL:function(){return(i=this).scale<=1||!i.pattern||!dr[i.pattern]?{instance:i,shader:ur.Util.GLSL.DEFAULT}:{instance:i,shader:["precision mediump float;","varying vec2 pix;","uniform sampler2D img;","uniform vec2 imgSize;","uniform float tileSize;","uniform int pixelate;",dr.rectangular_glsl,dr.triangular_glsl,dr.rhomboidal_glsl,dr.hexagonal_glsl,"void main(void) {","vec2 p = pix;","if (1 == pixelate) p = triangular(p, imgSize, tileSize);","else if (2 == pixelate) p = rhomboidal(p, imgSize, tileSize);","else if (3 == pixelate) p = hexagonal(p, imgSize, tileSize);","else p = rectangular(p, imgSize, tileSize);","gl_FragColor = texture2D(img, p);","}"].join("\n"),vars:function(t,e,n,r){t.uniform2f(r.uniform.imgSize,e,n),t.uniform1f(r.uniform.tileSize,fr(e*n)*(i.scale||1)*.01),t.uniform1i(r.uniform.pixelate,"triangular"===i.pattern?1:"rhomboidal"===i.pattern?2:"hexagonal"===i.pattern?3:0)}};var i},apply:function(t,e,n){var r,i=this.pattern;return this.scale<=1||!i||!dr[i]?t:(100<this.scale&&(this.scale=100),r=new ur.ImArray(t.length),dr[i](this.scale,r,t,e,n),r)}}).PATTERN={rectangular:function(t,e,n,r,i){for(var a,o,l,s,u,c,f,h,m,p=n.length,d=p>>>2,g=r-1,_=d-r,v=(a=fr(d)*t*.01|0,(o=.5*a|0)*r),C=l=s=u=c=f=0;C<p;C+=4)m=s-f,h=w(0,hr(g,l-u+o)),m=w(0,hr(_,m+v)),e[C]=n[h=h+m<<2],e[C+1]=n[1+h],e[C+2]=n[2+h],e[C+3]=n[3+h],++u,r<=++l&&(l=u=0,f+=r,s+=r,a<=++c)&&(f=c=0),a<=u&&(u=0)},triangular:function(t,e,n,r,i){for(var a,o,l,s,u,c,f=n.length,h=f>>>2,m=r-1,p=h-r,d=fr(h)*t*.0125|0,g=.333*d|0,_=.666*d|0,v=(.5*d|0)*r,C=a=o=l=s=0,y=0;y<f;y+=4)u=C-o,c=a-s,u=d<o+l?w(0,hr(m,u+_))+w(0,hr(p,c+v))<<2:w(0,hr(m,u+g))+w(0,hr(p,c+v))<<2,e[y]=n[u],e[y+1]=n[u+1],e[y+2]=n[u+2],e[y+3]=n[u+3],++o,r<=++C&&(C=o=0,s+=r,a+=r,d<=++l)&&(s=l=0),d<=o&&(o=0)},rhomboidal:function(t,e,n,r,i){for(var a,o,l,s,u,c,f,h=n.length,m=h>>>2,p=r-1,d=m-r,g=fr(m)*t*.007|0,_=2*g,v=g*r,C=a=o=l=s=0,y=0,x=0;x<h;x+=4)f=y?_<o+l?(u=hr(p,C-o+g),a-s):g<o+g-l?(u=C-o,w(0,a-s-v)):(u=w(0,C-o-g),a-s):_<o+g-l?(u=hr(p,C-o+g),w(0,a-s-v)):g<o+l?(u=C-o,a-s):(u=w(0,C-o-g),w(0,a-s-v)),c=w(0,hr(p,u+g)),f=w(0,hr(d,f+v)),e[x]=n[c=c+f<<2],e[x+1]=n[1+c],e[x+2]=n[2+c],e[x+3]=n[3+c],++o,r<=++C&&(C=o=0,s+=r,a+=r,g<=++l)&&(s=l=0,y=1-y),_<=o&&(o=0)},hexagonal:function(t,e,n,r,i){var a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R=n.length,I=R>>>2,L=r-1,E=I-r;for(t=fr(I)*t*.01,a=o=l=0;a<R;a+=4)C=o/t,y=l/t,h=mr(C-=.5*(y/=.866025404)),f=mr(y),c=pr(C),m=pr(y),u=C+y-h-f<1?(s=h,f):(s=c,m),A=1-(x=c=c)-(b=f=f),g=1-(p=h=h)-(d=m=m),y=cr((_=C)-s,(v=y)-u,(C=1-C-y)-(1-s-u)),x=cr(_-x,v-b,C-A),b=cr(_-p,v-d,C-g),A=y<x?y<b?(S=s,u):(S=h,m):x<b?(S=c,f):(S=h,m),S+=.5*A,A=.866025404*A*t,_=w(0,hr(L,0|(S*=t)))+w(0,hr(E,(0|A)*r))<<2,e[a]=n[_],e[a+1]=n[1+_],e[a+2]=n[2+_],e[a+3]=n[3+_],r<=++o&&(o=0,++l)},rectangular_glsl:["vec2 rectangular(vec2 p, vec2 imgsize, float tilesize) {","    return clamp((tilesize*floor(imgsize * p / tilesize) + 0.5*tilesize)/imgsize, 0.0, 1.0);","}"].join("\n"),triangular_glsl:["vec2 triangular(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 1.25;","   vec2 tile = tilesize*floor(imgsize * p / tilesize);","   vec2 t = mod(imgsize * p, tilesize);","   if (t.x+t.y > tilesize) return clamp((tile + vec2(0.66*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","   else return clamp((tile + vec2(0.33*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),rhomboidal_glsl:["vec2 rhomboidal(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 0.7;","   vec2 xy = imgsize * p;","   vec2 xyi = floor(xy / tilesize);","   vec2 tile = tilesize*xyi;","   vec2 s = vec2(mod(xy.x, 2.0*tilesize), mod(xy.y, tilesize));","   vec2 a;","   if (0.0 < mod(xyi.y, 2.0)) {","       if (s.x+s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y);","       } else if (s.x+tilesize-s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y-tilesize);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y);","       }","   } else {","       if (s.x+tilesize-s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y-tilesize);","       } else if (s.x+s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y-tilesize);","       }","   }","   a = vec2(clamp(a.x, 0.0, imgsize.x), clamp(a.y, 0.0, imgsize.y));","   return clamp((a + vec2(tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),hexagonal_glsl:["vec2 hexagonal(vec2 p, vec2 imgsize, float tilesize) {","    vec2 t = imgsize * p / tilesize;","    t.y /= 0.866025404;","    t.x -= t.y * 0.5;","    vec2 it = vec2(floor(t.x), floor(t.y));","    vec2 ct = vec2(ceil(t.x), ceil(t.y));","    vec2 a;","    if (t.x + t.y - it.x - it.y < 1.0) a = it;","    else a = ct;","    vec2 b = vec2(ct.x, it.y);","    vec2 c = vec2(it.x, ct.y);","    vec3 T = vec3(t.x, t.y, 1.0 - t.x - t.y);","    vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);","    vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);","    vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);","    float alen = length(T - A);","    float blen = length(T - B);","    float clen = length(T - C);","    vec2 ch;","    if (alen < blen) {","        if (alen < clen) ch = a;","        else ch = c;","    } else {","        if (blen < clen) ch = b;","        else ch = c;","    }","    ch.x += ch.y * 0.5;","    ch.y *= 0.866025404;","    ch *= tilesize / imgsize;","    return clamp(ch, 0.0, 1.0);","}"].join("\n")},gr=I.MODE,_r=I.Array32F,vr=I.Color.clamp,Cr=I.Color.intensity,I.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:gr.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=vr(null==e?.4:e,0,1),this.mode=n||gr.GRAY},path:I.Path,threshold:function(t){return this.thresh=vr(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y=t.length,x=new _r(3*(y>>>2)),b=this.size,S=1/(b*b),A=255*this.thresh,R=gr.RGB===this.mode,I=b*e,L=0,E=0,w=0;L<n;){if(s=u=c=0,R){for(l=o=a=0;o<b;)s+=t[r=w+E+a+l<<2]+x[i=3*(w+E+a+l)],u+=t[r+1]+x[i+1],c+=t[r+2]+x[i+2],++a>=b&&(a=0,++o,l+=e);m=A<Cr(s*=S,u*=S,c*=S)?(f=0|s,h=0|u,0|c):h=f=0}else{for(l=o=a=0;o<b;)s+=t[r=w+E+a+l<<2]+x[i=3*(w+E+a+l)],++a>=b&&(a=0,++o,l+=e);m=h=f=A<s*S?255:0}if(p=t[r=w+E<<2]-f,d=t[r+1]-h,g=t[r+2]-m,w+b<e)for(_=7/16*p,v=7/16*d,C=7/16*g,a=b,l=o=0;o<b;)x[i=3*(w+E+a+l)]+=_,x[i+1]+=v,x[i+2]+=C,0<=++a&&(a=b,++o,l+=e);if(L+b<n&&b<w)for(_=3/16*p,v=3/16*d,C=3/16*g,a=-b,o=b,l=0;o<0;)x[i=3*(w+E+a+l)]+=_,x[i+1]+=v,x[i+2]+=C,0<=++a&&(a=-b,++o,l+=e);if(L+b<n)for(_=5/16*p,v=5/16*d,C=5/16*g,o=b,l=a=0;o<0;)x[i=3*(w+E+a+l)]+=_,x[i+1]+=v,x[i+2]+=C,++a>=b&&(a=0,++o,l+=e);if(L+b<n&&w+b<e)for(_=1/16*p,v=1/16*d,C=1/16*g,o=a=b,l=0;o<0;)x[i=3*(w+E+a+l)]+=_,x[i+1]+=v,x[i+2]+=C,0<=++a&&(a=b,++o,l+=e);for(l=o=a=0;o<b;)t[r=w+E+a+l<<2]=f,t[r+1]=h,t[r+2]=m,++a>=b&&(a=0,++o,l+=e);e<=(w+=b)&&(w=0,L+=b,E+=I)}return t}}),xr=(yr=I).MODE,br=new yr.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),Sr=Math,yr.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:yr.Path,init:function(t,e,n,r,i,a,o){this.offsetX=t||0,this.offsetY=e||0,this.color=n||0,this.opacity=null==r?1:+r,this.quality=0|(i||1),this.pad=null==a||!!a,this.onlyShadow=!!o},dispose:function(){return this.offsetX=null,this.offsetY=null,this.color=null,this.opacity=null,this.quality=null,this.pad=null,this.onlyShadow=null,this.$super("dispose"),this},serialize:function(){return{offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,opacity:this.opacity,quality:this.quality,pad:this.pad,onlyShadow:this.onlyShadow}},unserialize:function(t){return this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.color=t.color,this.opacity=t.opacity,this.quality=t.quality,this.pad=t.pad,this.onlyShadow=t.onlyShadow,this},apply:function(t,e,n){var r=this;if(r.hasMeta=!1,r._isOn){var i,a,o,l,s,u,c,f=Sr.max,h=r.color||0,m=r.opacity,p=r.quality,d=r.pad,g=r.onlyShadow,_=r.offsetX||0,v=r.offsetY||0,C=t.length,y=C>>>2,x=C,b=e;if(0!==(m=1<(m=m<0?0:m)?1:m)){i=h>>>16&255,a=h>>>8&255,o=255&h,3<(p=p<=0?1:p)&&(p=3);for(var S=new yr.ImArray(x),A=0,R=0,I=0,L=0,E=0;I<x;I+=4,++L)b<=L&&(L=0,++E),0<(c=t[I+3])&&(S[I]=i,S[I+1]=a,S[I+2]=o,S[I+3]=m*c|0,A=f(A,L),R=f(R,E));if(S=yr.Util.Filter.integral_convolution(i===a&&a===o?xr.GRAY:xr.RGB,S,e,n,2,br,null,3,3,1,0,p),A+=_,R+=v,d&&(e<=A||A<0||n<=R||R<0)&&(t=yr.Util.Image.pad(t,e,n,C=e<=A?A-e:0,h=n<=R?R-n:0,p=A<0?-A:0,d=R<0?-R:0),y=(e+=p+C)*(n+=d+h),r.hasMeta=!0,r.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}),v*=e,g)for(u=E=L=0;u<x;u+=4,++L)b<=L&&(L=0,E+=e),s=E+v,(l=L+_)<0||e<=l||s<0||y<=s||(t[I=l+s<<2]=S[u],t[I+1]=S[u+1],t[I+2]=S[u+2],t[I+3]=S[u+3]);else for(u=E=L=0;u<x;u+=4,++L)b<=L&&(L=0,E+=e),s=E+v,(l=L+_)<0||e<=l||s<0||y<=s||(c=t[(I=l+s<<2)+3],m=S[u+3],255!==c&&0!==m&&(i=t[I]+(S[u]-t[I])*(m/=255),a=t[I+1]+(S[u+1]-t[I+1])*m,o=t[I+2]+(S[u+2]-t[I+2])*m,t[I]=0|i,t[I+1]=0|a,t[I+2]=0|o))}}return t}}),(Ar=Math).sqrt,Ar.exp,Rr=Ar.log,Ir=Ar.abs,Lr=Ar.floor,Er=I._notSupportClamp,wr=I.Array32F,I.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,r){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==r?10:r},path:I.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S=t.length,A=this.centerX||0,R=this.centerY||0,I=this.radius,L=this.amount;if(!(L<=0)){for(0,b=(r=S>>>2)-e,A=Lr(A*(x=e-1)),R=Lr(R*(n-1)),s=(e<<1)+e,i=new wr((r<<1)+r),f=a=o=l=f=c=u=0;f<e;++f,u+=4,c+=3)a+=t[u],o+=t[u+1],l+=t[u+2],i[c]=a,i[c+1]=o,i[c+2]=l;for(a=o=l=f=c=0,u=u=s+e;u<S;u+=4,c+=3,++f)e<=f&&(a=o=l=f=0),a+=t[u],o+=t[u+1],l+=t[u+2],i[c+s]=i[c]+a,i[c+s+1]=i[c+1]+o,i[c+s+2]=i[c+2]+l;for(u=m=h=f=0;u<S;u+=4,++f)e<=f&&(f=0,++h,m+=e),y=Ir(f-A),v=Ir(h-R),d=Ar.max(y,v),y=Ar.min(y,v),0<(y=I<(v=d?d*(1+.43*y/d*y/d):0)?0|Rr((v-I)*L):v/I+.5|0)&&(d=f+y,g=m+(v=y*e),(p=f-y)<0?p=0:x<d&&(d=x),(v=m-v)<0?v=0:b<g&&(g=b),v=(y=.25/(y*y))*(i[_=((_=d+g)<<1)+_]-i[d=((d=d+v)<<1)+d]-i[g=((g=p+g)<<1)+g]+i[p=((p=p+v)<<1)+p]),C=y*(i[_+1]-i[d+1]-i[g+1]+i[p+1]),y=y*(i[_+2]-i[d+2]-i[g+2]+i[p+2]),Er&&(v=v<0?0:255<v?255:v,C=C<0?0:255<C?255:C,y=y<0?0:255<y?255:y),t[u]=0|v,t[u+1]=0|C,t[u+2]=0|y)}}return t}}),Dr=I,Tr=Math,Dr.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:Dr.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v=this.type,C=Dr.ImArray,y=Dr.Array8U,x=Dr.Util.Image.interpolate,b=Tr.sqrt;for(e!==n?t=x(t,e,n,p=n<e?e:n,p):p=e,d=Tr.round(p/2),g=p*p,r=new C(_=t.length),i=new C(_),a=new y(g),h=f=c=0;h<_;h+=4,++c)p<=c&&(c=0,++f),r[m=(c+d)%p+(f+d)%p*p<<2]=t[h],r[m+1]=t[h+1],r[m+2]=t[h+2],r[m+3]=t[h+3];if(0===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*b((c-d)*(c-d)+(f-d)*(f-d))/d,a[c+f*p]=u=u<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;else if(1===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),a[c+f*p]=u=(u=255-255*(d+f<d+c?(f-d)/d:(c-p/2)/d))<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;else for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*(d+f<d+c?b((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p):b((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p)),a[c+f*p]=u=u<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;for(c=f=0;f<p;++c)p<=c&&(c=0,++f),o=a[m=c+f*p],o/=s=o+(l=a[(c+d)%p+(f+d)%p*p]),i[m<<=2]=~~(o*t[m]+(l/=s)*r[m]),i[m+1]=~~(o*t[m+1]+l*r[m+1]),i[m+2]=~~(o*t[m+2]+l*r[m+2]),i[m+3]=t[m+3];return i=e!==n?x(i,p,p,e,n):i}}),Mr=(Gr=I).MODE,r=Math,i=Gr.Util.Filter,Gr.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:Mr.COLOR,path:Gr.Path,init:function(t,e,n,r,i){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==r?1e-6:+r,this.border=null!=i?i||0:null,this.mode=Mr.COLOR},serialize:function(){return{color:this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y,x,b,S,A,R=this.mode||Mr.COLOR,I=this.color||0,L=this.border,E=null!=L,w=this.x||0,D=this.y||0,T=Gr.Color.RGB2HSV,G=Gr.Color.HSV2RGB;if(!(w<0||e<=w||D<0||n<=D)){if(d=t[c=(w<<=2)+(D=D*e<<2)],g=t[c+1],_=t[c+2],y=0,x=1,h=I>>>16&255,m=I>>>8&255,p=255&I,E){if(E=L>>>8&255,v=255&L,d===(L=L>>>16&255)&&g===E&&_===v)return t;d=L,g=E,_=v,y=1,x=0}else if(Mr.COLOR===R&&d===h&&g===m&&_===p)return t;if(S=(L=ga(t,e,0,2,da(d,g,_,y,x,255*(1<=this.tolerance?.999:this.tolerance)),0,w,D)).mask,Mr.MASK===R||Mr.COLORMASK===R)for(A=Mr.MASK===R,c=i=r=0,f=t.length;c<f;c+=4,++r)e<=r&&(r=0,i+=e),S[(u=r+i)>>>5]&1<<(31&u)?A&&(t[c]=h,t[c+1]=m,t[c+2]=p):(t[c]=0,t[c+1]=0,t[c+2]=0);else if(Mr.HUE===R)for(a=(b=L.box)[0]>>>2,o=b[1]>>>2,l=b[2]>>2,s=b[3]>>>2,C=new Fr(3),r=a,i=o;i<=s;)S[(u=r+i)>>>5]&1<<(31&u)&&(C[0]=t[c=u<<2],C[1]=t[c+1],C[2]=t[c+2],T(C,0,1),C[0]=I,G(C,0,1),t[c]=0|C[0],t[c+1]=0|C[1],t[c+2]=0|C[2]),++r>l&&(r=a,i+=e);else for(a=(b=L.box)[0]>>>2,o=b[1]>>>2,l=b[2]>>2,s=b[3]>>>2,r=a,i=o;i<=s;)S[(u=r+i)>>>5]&1<<(31&u)&&(t[c=u<<2]=h,t[c+1]=m,t[c+2]=p),++r>l&&(r=a,i+=e)}return t}}),Gr.FloodFillFilter=Gr.ColorFillFilter,Gr.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:Mr.TILE,hasInputs:!0,path:Gr.Path,init:function(t,e,n,r,i,a,o){this.x=t||0,this.y=e||0,this.offsetX=r||0,this.offsetY=i||0,n&&this.setInput("pattern",n),this.tolerance=null==a?1e-6:+a,this.border=null!=o?o||0:null,this.mode=Mr.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var r=this.x||0,i=this.y||0;if(!(r<0||e<=r||i<0||n<=i)&&(L=this.input("pattern"))){var a,o,l,s,u,c,f,h,m,p,d,g,_,v,C,y=this.mode||Mr.TILE,x=this.border,b=L[0],S=L[1],A=L[2],R=this.offsetX||0,I=this.offsetY||0,L=t[u=(r<<=2)+(i=i*e<<2)],E=t[u+1],w=t[u+2],D=0,T=1;if(null!=x){if(_=x>>>8&255,a=255&x,L===(x=x>>>16&255)&&E===_&&w===a)return t;L=x,E=_,w=a,D=1,T=0}if(v=(x=ga(t,e,0,2,da(L,E,w,D,T,255*(1<=this.tolerance?.999:this.tolerance)),0,r,i)).mask,f=(_=x.box)[0]>>>2,h=_[1]>>>2,m=_[2]>>>2,p=_[3]>>>2,Mr.STRETCH===y)for(d=S/(m-f+1),g=A/(p-h+e),o=f,l=h;l<=p;)v[(s=o+l)>>>5]&1<<(31&s)&&(t[u=s<<2]=b[c=(d*(o-f)|0)+(g*(l-h)|0)*S<<2],t[u+1]=b[c+1],t[u+2]=b[c+2]),++o>m&&(o=f,l+=e);else{for(;R<0;)R+=S;for(;I<0;)I+=A;for(m=m-f+1,l=o=0,C=h;C<=p;)v[(s=o+f+C)>>>5]&1<<(31&s)&&(t[u=s<<2]=b[c=(o+R)%S+(l+I)%A*S<<2],t[u+1]=b[c+1],t[u+2]=b[c+2]),++o>=m&&(o=0,C+=e,++l)}}return t}}),Or=Gr.Array32I,Nr=Gr.Array32U,Fr=Gr.Array32F,Hr=Gr.Array8U,Ur=r.ceil,Br=r.min,Yr=r.max,S=r.abs,i.dissimilarity_rgb=da,i.floodRegion=ga,Pr=(zr=I).MODE,Xr=zr.Array32F,kr=zr.ImArray,A=zr.Util.Filter,$r=Math,jr=$r.min,Wr=$r.max,qr=$r.abs,Vr=$r.cos,Kr=zr.CONST.toRad,zr.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:Pr.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,r){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!r,this.mode=Pr.COLOR},path:zr.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var r,i,a,o,l,s,u,c,f,h,m=t.length,p=m>>>2,d=this.mode||Pr.COLOR,g=this.color,_=jr(.999,Wr(0,this.tolerance||0)),p=new Xr(p);if(null!=g&&(Pr.HUE===d||Pr.COLORIZEHUE===d?g=Vr(Kr*g):Pr.COLOR!==d&&Pr.COLORIZE!==d||(g=1e4*((c=(g>>>16&255)/255)+(f=(g>>>8&255)/255)+(h=(255&g)/255))/3+1e3*(c+f)/2+100*(f+h)/2+10*(c+h)/2+c)),_=_a(t,0,0,2,p,_,d),Pr.COLORIZE!==d&&Pr.COLORIZEHUE!==d)return xa(t,e,n,2,p,this.connectivity,_,g,this.invert);for(r=xa(new kr(m),e,n,2,p,this.connectivity,_,g,this.invert),l=new Xr(256),s=new Xr(256),u=new Xr(256),o=new Xr(256),i=0;i<m;i+=4)++o[a=r[i]],l[a]+=t[i],s[a]+=t[i+1],u[a]+=t[i+2];for(i=0;i<256;++i)o[i]&&(a=o[i],l[i]/=a,s[i]/=a,u[i]/=a);for(i=0;i<m;i+=4)a=r[i],t[i]=0|l[a],t[i+1]=0|s[a],t[i+2]=0|u[a];return t}}),va.prototype={constructor:va,id:0,root:null},A.dissimilarity_rgb_2=_a,A.connectedComponents=xa,Zr=I,Qr=Math.round,Zr.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,lowpass:!0,path:Zr.Path,init:function(t,e,n){this.low=arguments.length<1?2.5:+t,this.high=arguments.length<2?7.5:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},apply:function(t,e,n){return Zr.Util.Filter.gradient(t,e,n,2,0,this.lowpass,0,Qr(100*this.low),Qr(100*this.high),100,1e3,1e5)}}),Jr=I,R=Math,ti=R.abs,yt=R.max,xt=R.min,R.floor,ei=R.round,ni=R.sqrt,Jr.Util.Array.typed,ri=Jr.Util.Array.typed_obj,ii=Array.prototype.push,Jr.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,r,i,a,o){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==r?.5:+r,this.minNeighbors=null==i?1:+i,this.doCannyPruning=void 0===a||!!a,this.tolerance=null==o?.2:+o,this._haarchanged=!!this.haardata},path:Jr.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh};return t._haarchanged&&(e.haardata=ri(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=ri(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e},metaData:function(t){return t&&Jr.isWorker?ri(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?ri(t,1):t,this},apply:function(t,e,n,r){var i,a,o,l,s,u,c,f,h,m,p,d,g=this;return g.haardata&&(i=t.length>>>2,d=g.selection||null,a=Jr.Array32F,u=s=l=o=null,p=Jr.Util.Filter,d=d?(m=d[4]?(h=e-1,n-1):h=1,c=xt(e-1,yt(0,d[0]*h)),f=xt(n-1,yt(0,d[1]*m)),h=xt(e-1,yt(0,d[2]*h)),xt(n-1,yt(0,d[3]*m))):(f=c=0,h=e-1,n-1),r&&r.haarfilter_SAT?(o=r.haarfilter_SAT,l=r.haarfilter_SAT2,s=r.haarfilter_RSAT):(p.sat(t,e,n,2,0,o=new a(i),l=new a(i),s=new a(i)),r&&(r.haarfilter_SAT=o,r.haarfilter_SAT2=l,r.haarfilter_RSAT=s)),g.doCannyPruning&&(r&&r.haarfilter_GSAT?u=r.haarfilter_GSAT:(u=p.gradient(t,e,n,2,0,1,1),r&&(r.haarfilter_GSAT=u))),(m=new Array(10)).count=0,p.haar_detect(m,e,n,c,f,h,d,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,o,s,l,u,g.cannyLow,g.cannyHigh),m.length>m.count&&(m.length=m.count),g.meta={objects:p.merge_features(m,g.minNeighbors,g.tolerance)}),t}}),Jr.Util.Filter.haar_detect=function(t,e,F,H,U,B,Y,z,P,X,k,n,r,i,a,$,j){for(var W,q,o,l,s,u,V,K,Z,c,f,h,m,Q,J,p,d,g,_,tt,et,nt,rt,it,v,C,at,y,ot,lt,st,x,b,S,A,R,I,L,E,w,D,T,G,ut=null!=a,ct=B-H+1|0,ft=Y-U+1|0,ht=(B=e*F)-1,mt=z.stages,pt=mt.length,dt=z.size1,gt=z.size2,M=e-1,O=B-e,_t=0|H,vt=0|U,Ct=xt(e/dt,F/gt),N=P;N<=Ct;N*=X)for(W=(o=N*dt|0)*k|0,K=(l=N*gt|0)*e,Q=_t+ct-o,J=vt+ft-l,d=1/(o*l),V=(u=vt)*(Z=(q=l*k|0)*e);u<J;u+=q,V+=Z)for(s=_t;s<Q;s+=W)if(f=(c=s-1+V-e)+o,m=(h=c+K)+o,c=xt(ht,yt(0,c)),f=xt(ht,yt(0,f)),h=xt(ht,yt(0,h)),m=xt(ht,yt(0,m)),!(ut&&((_=d*(a[m]-a[h]-a[f]+a[c]))<$||j<_)||(_=d*(n[m]-n[h]-n[f]+n[c]),(g=d*(i[m]-i[h]-i[f]+i[c])-_*_)<=0))){for(g=ni(g),tt=!1,p=0;p<pt;++p){for(nt=(et=mt[p]).thres,it=(rt=et.trees).length,v=G=0;v<it;++v)for(at=rt[v].feats,C=0;;){if(lt=(ot=(y=at[C]).rects).length,st=y.thres,x=0,y.tilt)for(b=0;b<lt;++b)A=s+N*(S=ot[b])[0]|0,R=(u-1+N*S[1]|0)*e,I=s+N*(S[0]+S[2])|0,L=(u-1+N*(S[1]+S[2])|0)*e,E=s+N*(S[0]-S[3])|0,w=(u-1+N*(S[1]+S[3])|0)*e,D=s+N*(S[0]+S[2]-S[3])|0,T=(u-1+N*(S[1]+S[2]+S[3])|0)*e,A=xt(M,yt(0,A)),I=xt(M,yt(0,I)),E=xt(M,yt(0,E)),D=xt(M,yt(0,D)),R=xt(O,yt(0,R)),L=xt(O,yt(0,L)),w=xt(O,yt(0,w)),T=xt(O,yt(0,T)),x+=S[4]*(r[D+T]-r[E+w]-r[I+L]+r[A+R]);else for(b=0;b<lt;++b)A=s-1+N*(S=ot[b])[0]|0,I=s-1+N*(S[0]+S[2])|0,R=e*(u-1+N*S[1]|0),L=e*(u-1+N*(S[1]+S[3])|0),A=xt(M,yt(0,A)),I=xt(M,yt(0,I)),R=xt(O,yt(0,R)),L=xt(O,yt(0,L)),x+=S[4]*(n[I+L]-n[A+L]-n[I+R]+n[A+R]);if(x*d<st*g){if(y.has_l){G+=y.l_val;break}C=y.l_node}else{if(y.has_r){G+=y.r_val;break}C=y.r_node}}if(!(tt=nt<G))break}tt&&(t.count===t.length&&ii.apply(t,new Array(10)),t[t.count++]={x:s,y:u,width:o,height:l})}},Jr.Util.Filter.merge_features=function(t,e,n){for(var r,i,a,o,l,s,u,c,f,h,m,p,d=t.length,g=new Array(d),_=[],v=0,C=!1,y=0;y<d;++y)g[y]=0;for(y=0;y<d;++y){for(C=!1,a=0;a<y;++a)u=t[a],c=t[y],f=(f=n)*(xt(u.width,c.width)+xt(u.height,c.height))*.5,ti(u.x-c.x)<=f&&ti(u.y-c.y)<=f&&ti(u.x+u.width-c.x-c.width)<=f&&ti(u.y+u.height-c.y-c.height)<=f&&(C=!0,g[y]=g[a]);C||(g[y]=v,++v)}for(r=new Array(v),i=new Array(v),y=0;y<v;++y)r[y]=0,i[y]={x:0,y:0,width:0,height:0};for(y=0;y<d;++y)++r[s=g[y]],h=i[s],m=t[y],h.x+=m.x,h.y+=m.y,h.width+=m.width,h.height+=m.height;for(y=0;y<v;++y)e<=(o=r[y])&&(s={x:(l=1/(o+o))*(2*i[y].x+o),y:l*(2*i[y].y+o),width:l*(2*i[y].width+o),height:l*(2*i[y].height+o)},_.push(s));for(d=_.length,y=0;y<d;++y)for(a=y+1;a<d;++a)!_[y].isInside&&ba(_[y],_[a],n)&&(_[y].isInside=!0),!_[a].isInside&&ba(_[a],_[y],n)&&(_[a].isInside=!0);for(y=d;0<=--y;)_[y].isInside?_.splice(y,1):((p=_[y]).x=ei(p.x),p.y=ei(p.y),p.width=ei(p.width),p.height=ei(p.height),p.area=p.width*p.height);return _.sort(Sa)},I});
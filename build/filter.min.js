/**
*
*   FILTER.js
*   @version: 1.6.0
*   @built on 2023-08-17 10:55:43
*   @dependencies: Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"FILTER",function q(){"use strict";var a,F,H,U,B,i,z,Y,e,at,ot,lt,P,X,k,j,w,$,Q,J,Z,W,K,tt,et,nt,it,rt,st,ut,ct,u,ft,ht,mt,pt,dt,gt,_t,vt,xt,bt,St,At,Rt,It,wt,Lt,Et,c,Dt,o,Tt,Mt,h,Gt,Ot,Nt,Ft,Ht,Ut,m,p,Bt,zt,Yt,g,Pt,Xt,kt,jt,$t,Wt,qt,Vt,Kt,Zt,Qt,Jt,te,ee,ne,ie,_,re,ae,oe,le,v,se,ue,ce,fe,he,me,x,pe,de,l,y,ge,_e,ve,xe,ye,Ce,C,be,Se,Ae,Re,Ie,we,Le,Ee,De,Te,Me,Ge,Oe,Ne,Fe,He,Ue,Be,ze,Ye,Pe,Xe,ke,je,$e,We,qe,V,D,Ve,Ke,Ze,Qe,Je,tn,en,nn,rn,an,on,ln,sn,un,cn,fn,hn,mn,pn,dn,gn,_n,vn,xn,yn,Cn,bn,Sn,An,Rn,In,wn,Ln,En,Dn,Tn,Mn,Gn,On,Nn,Fn,Hn,Un,Bn,b,zn,Yn,Pn,Xn,kn,jn,$n,Wn,qn,Vn,Kn,Zn,Qn,Jn,ti,ei,ni,ii,ri,ai,oi,S,t,li,si,ui,ci,fi,hi,n,mi,pi,di,E,gi,_i,vi,xi,yi,Ci,bi,Si,Ai,Ri,Ii,wi,Li,Ei,Di,Ti,Mi,Gi,Oi,Ni,Fi,r,A,Hi,Ui,Bi,zi,Yi,Pi,Xi,R,ki,ji,$i,Wi,I,qi,Vi,Ki,Zi,Qi,Ji,tr,er,L,nr,yt,Ct,ir,rr,ar,or,M={VERSION:"1.6.0"};function lr(t,e,n){arguments.length<2&&(e=t,t=null),H.call(e,"__static__")&&(n=e.__static__,delete e.__static__);var i,r,a,o=H.call(e,"constructor")?e.constructor:function(){};for(i in t?(o[F]=Object.create(t[F]),o[F].$super=(r=t,a={},function(t,e){var n=":"+t;return 1===a[n]?(r[F].$super||U).call(this,t,e):(a[n]=1,t=("constructor"===t?r:r[F][t]||U).apply(this,e||[]),a[n]=0,t)})):o[F].$super=U,o[F].constructor=o,e)H.call(e,i)&&"constructor"!==i&&(o[F][i]=e[i]);if(n)for(i in n)H.call(n,i)&&(o[i]=n[i]);return o}function sr(t){t.preventDefault&&t.preventDefault()}function ur(t,e,n){return n<t?n:t<e?e:t}function cr(t,e,n,i,r){n=n||0,i=i||0;for(var a,o=r?r-i+1:e.length,l=31&o,s=0;s<l;++s)t[s+n]=e[i+s];for(a=l;a<o;a+=32)t[(s=a)+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],t[++s+n]=e[i+s],++s}function fr(t,e,n){for(var i=t>>>1,r=e>>>1,a=t*e,o=-1/(2*n*n),l=new lt(a),s=w.exp,u=0,c=-i,f=-r,h=0;h<a;++h,++c)i<c&&(c=-i,++f),l[h]=s(o*(c*c+f*f)),u+=l[h];for(h=0;h<a;++h)l[h]/=u;return l}function hr(t,e,n,i,F,r,H,U,B,a,z,Y){null==a&&(Y=(a=1)*(z=510));for(var o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,P,A,R,X,I,w,k,L,j,E,$,D,T,W=n.length,q=W>>>r,V=i-1,K=F-1,M=new lt(q),G=1,O=1,N=i;O<K&&!(V<=G&&(G=1,N+=i,K<=++O));++G)_=(s=G+N)-1,v=s+1,b=(d=s-i)-1,x=1+d,C=(g=s+i)-1,y=g+1,u=t[s],c=e[s],f=Z(u),h=Z(c),T=J(f,h),D=Q(f,h),m=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[d]),Z(e[d])),D=Q(Z(t[d]),Z(e[d])),d=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[g]),Z(e[g])),D=Q(Z(t[g]),Z(e[g])),g=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[_]),Z(e[_])),D=Q(Z(t[_]),Z(e[_])),_=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[v]),Z(e[v])),D=Q(Z(t[v]),Z(e[v])),v=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[x]),Z(e[x])),D=Q(Z(t[x]),Z(e[x])),x=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[y]),Z(e[y])),D=Q(Z(t[y]),Z(e[y])),y=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[C]),Z(e[C])),D=Q(Z(t[C]),Z(e[C])),C=T?T*(1+.43*D/T*D/T):0,T=J(Z(t[b]),Z(e[b])),D=Q(Z(t[b]),Z(e[b])),b=T?T*(1+.43*D/T*D/T):0,D=u*c<=0?h<=f?(p=f*m)>=Z(c*x-(u+c)*v)&&p>Z(c*C-(u+c)*_):(p=h*m)>=Z(u*x-(c+u)*d)&&p>Z(u*C-(c+u)*g):h<=f?(p=f*m)>=Z(c*y+(u-c)*v)&&p>Z(c*b+(u-c)*_):(p=h*m)>=Z(u*y+(c-u)*g)&&p>Z(u*b+(c-u)*d),M[s]=D?z<=m?Y:a*m:0;if(H){for(l=G=0;G<i;++G)l+=M[G],M[G]=l;for(G=i,l=N=0;G<q;++G,++N)i<=N&&(l=N=0),l+=M[G],M[G]=M[G-i]+l;return M}if(r)for(G=0;G<W;G+=4)n[G]=n[G+1]=n[G+2]=0;else for(G=0;G<W;++G)n[G]=0;for(N=o=O=G=0;o<q;N=++o<<r,++G)if(i<=G&&(G=0,++O),!(0<n[N]||M[o]<B)){S=G,R=O,E=N,0;do{for(n[E]=r?n[E+1]=n[E+2]=255:255,P=S===V?S:S+1,X=R===K?R:R+1,A=0===R?R:R-1,I=0===S?S:S-1,L=k=(w=A)*i,$=0;I<=P&&w<=X;){if(E=(j=I+L)<<r,(w!==R||I!==S)&&0===n[E]&&M[j]>=U){S=I,R=w,$=1;break}L+=i,X<++w&&(w=A,L=k,++I)}}while($)}return n}function mr(t,e,n){e=new RegExp("\\b"+e+"\\s+\\w+\\s+(\\w+)","ig");t.replace(ct,"").replace(e,function(t,e){return n[e]=0,t})}function pr(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),n}function dr(t,e){var n,i,r,a=this;if(-1===t.indexOf("precision ")&&(t=ut+"\n"+t),a.vertexSource=st,a.fragmentSource=t,a.uniform={},a.attribute={},t=pr(e,a.vertexSource,e.VERTEX_SHADER),n=pr(e,a.fragmentSource,e.FRAGMENT_SHADER),a.id=e.createProgram(),e.attachShader(a.id,t),e.attachShader(a.id,n),e.linkProgram(a.id),e.getProgramParameter(a.id,e.LINK_STATUS)||e.isContextLost()){for(i in mr(a.vertexSource,"attribute",a.attribute),mr(a.vertexSource,"uniform",a.uniform),mr(a.fragmentSource,"uniform",a.uniform),a.attribute)a.attribute[i]=e.getAttribLocation(a.id,i);for(r in a.uniform)a.uniform[r]=e.getUniformLocation(a.id,r)}else nt.error(e.getProgramInfoLog(a.id)),nt.error(e.getShaderInfoLog(t)),nt.error(e.getShaderInfoLog(n)),e.deleteShader(t),e.deleteShader(n),e.deleteProgram(a.id),a.id=null}function gr(t,e,n){var i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e&&n&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),i}function _r(t,e){e&&t.deleteTexture(e)}function vr(t,e,n){e=gr(t,e,n),n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{fbo:n,tex:e}}function xr(t,e){var n,i;e&&(n=t,(i=e.fbo)&&n.deleteFramebuffer(i),_r(t,e.tex))}function yr(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e||null,t.STATIC_DRAW),n}function Cr(t,e){e&&t.deleteBuffer(e)}function br(t,e,n,i,r,a,o){return o=o||gr(t,n,i),null!=r&&(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,o)),a?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,i,0,t.RGBA,t.UNSIGNED_BYTE,e),o}function Sr(t,e,n,i){return i=i||new nt.ImArray(e*n<<2),t.readPixels(0,0,e,n,t.RGBA,t.UNSIGNED_BYTE,i),i}function Ar(t,e,n,i){return"if ("+t+">"+e+") {"+n+"="+t+";"+t+"="+e+";"+e+"="+n+";}"}function Rr(){}function Ir(t){return t&&t.instance&&t.instance.isOn()}function wr(t,e,n){var i,r,a;return e/=100,e=(1-c.abs(2*(n/=100)-1))*e,i=c.floor((t=t/60)/2),i=e*(1-c.abs(t-2*i-1)),n=n-e/2,t=0<=t&&t<1?(r=e+n,a=i+n,0+n):1<=t&&t<2?(r=i+n,a=e+n,0+n):2<=t&&t<3?(r=0+n,a=e+n,i+n):3<=t&&t<4?(r=0+n,a=i+n,e+n):4<=t&&t<5?(r=i+n,a=0+n,e+n):(r=e+n,a=0+n,i+n),[h(c.round(255*r),0,255),h(c.round(255*a),0,255),h(c.round(255*t),0,255)]}function Lr(t,e,n){var e=(n/=100)*(1-e/200),i=c.min(e,1-e);return wr(t,0===i?0:100*(n-e)/i,100*e)}function Er(t,e,n){n=1-n/100;return Lr(t,100-e/n,100*n)}function Dr(t,e,n,i,r){var a,o,l,s,u;return i?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=i=c.max(t,e,n),s=l=c.min(t,e,n),u=1-i,n=0==(o=i-l)?0:a===t?60*(0+(e-n)/o):a===e?60*(2+(n-t)/o):60*(4+(t-e)/o),e=0==(t=(i+l)/2)||1==t?0:(a-t)/c.min(t,1-t),i=0===a?0:o/a,"hwb"===r?[h(c.round(n),0,360),h(100*s,0,100),h(100*u,0,100)]:"hsv"===r?[h(c.round(n),0,360),h(100*i,0,100),h(100*a,0,100)]:[h(c.round(n),0,360),h(100*e,0,100),h(100*t,0,100)]}function Tr(t,e,n,i){return Dr(t,e,n,i,"hsl")}function Mr(t,e,n,i){return Dr(t,e,n,i,"hsv")}function Gr(t,e,n,i){return Dr(t,e,n,i,"hwb")}function Or(t,e,n,i){return i&&(t=h(o(t*Ht),0,255),e=h(o(e*Ht),0,255),n=h(o(n*Ht),0,255)),0===t&&0===e&&0===n?[0,0,0,1]:[((i=1-t*Nt)-(e=Tt(i,t=1-e*Nt,i=1-n*Nt)))*(n=1/(1-e)),(t-e)*n,(i-e)*n,e]}function Nr(t,e,n,i){var r;return 0===t&&0===e&&0===n?[0,0,0]:(e=255*(1-(e=e*(r=1-i)+i)),n=255*(1-(n=n*r+i)),[h(o(255*(1-(t=t*r+i))),0,255),h(o(e),0,255),h(o(n),0,255)])}function Fr(t,e,n,i){2&(i=i||6)&&t.width!==e&&(t.width=e,t.oCanvas.width=+e,t._restorable)&&(t.iCanvas.width=t.oCanvas.width),4&i&&t.height!==n&&(t.height=n,t.oCanvas.height=+n,t._restorable)&&(t.iCanvas.height=t.oCanvas.height)}function Hr(t,e){var n=t.oCanvas.width,i=t.oCanvas.height;e=e||255,t._restorable&&1&e&&1&t._refresh&&(t.iData=t.iCanvas.getContext("2d").getImageData(0,0,n,i),t.iData||(t.iData=t.iCanvas.getContext("2d").createImageData(0,0,n,i)),t._refresh&=-2),2&e&&2&t._refresh&&(t.oData=t.oCanvas.getContext("2d").getImageData(0,0,n,i),t.oData||(t.oData=t.oCanvas.getContext("2d").createImageData(0,0,n,i)),t._refresh&=-3)}function Ur(t,e){var n,i,r,a,o,l,s;t.selection&&(n=t.selection,s=t.width-1,l=t.height-1,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4]?s:1,n=n[4]?l:1,i=+g(i*s),r=+g(r*n),l=(a=+g(a*s))-i+1,s=(o=+g(o*n))-r+1,e=e||255,t._restorable&&4&e&&4&t._refresh&&(t.iDataSel=t.iCanvas.getContext("2d").getImageData(i,r,l,s),t.iDataSel||(t.iDataSel=t.iCanvas.getContext("2d").createImageData(0,0,l,s)),t._refresh&=-5),8&e)&&8&t._refresh&&(t.oDataSel=t.oCanvas.getContext("2d").getImageData(i,r,l,s),t.oDataSel||(t.oDataSel=t.oCanvas.getContext("2d").createImageData(0,0,l,s)),t._refresh&=-9)}function Br(t,e){var e=e?Me(e):"",t=Me(t.filter||t),n=Te?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function(im, w, h){    var self = this;    if (!self._map) return im;    var x, y, i, i0, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+e+";        x=0; y=0;    for (i=0; i<rem; i+=4)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        if (++x>=w) {x=0; ++y;}    }    for (i0=rem; i0<imLen; i0+=32)    {        i=i0; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}        i+=4; c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+t+";        "+n+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; ++y;}    }    return im;};")(Re)}function zr(t,e){e=e?Qe(e):"",t=Qe(t.filter||t);return new Function("FILTER",'"use strict"; return function(im, w, h) {    var self = this;    if (!self._map) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+e+";        if (COLOR === mode)    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        if (0>t[0] || t[0]>bx || 0>t[1] || t[1]>by)            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (IGNORE === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if (WRAP === mode)    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if (CLAMP === mode)*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,++x)        {            if (x>=w) {x=0; ++y;}                        t[0] = x; t[1] = y;                        "+t+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(D)}function Yr(t,e,n){for(var i=[],r=[],a=[],o=t.length,l=e>>>1,s=-l,u=-((n=null==n?e:n)>>>1),c=0;c<o;)r.push(s),r.push(u),t[c]&&(i.push(s),i.push(u),a.push(t[c])),++c,l<++s&&(s=-l,++u);return[new dn(i),new dn(r),new mn(a)]}function Pr(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=1;return e}function Xr(t,e){var n,i=t>>>1,r=new Array(t);if(e)for(n=0;n<t;++n)r[t-1-n]=n-i;else for(n=0;n<t;++n)r[n]=n-i;return r}function kr(t){var e,n,i,r,a=Mn.length;if(--t<a)e=Mn[t];else for(e=Mn[a-1];a<=t;){for(n=e,(e=new Array(n.length+1))[0]=1,i=0,r=n.length-1;i<r;++i)e[i+1]=n[i]+n[i+1];e[n.length]=1,a<20&&Mn.push(e),++a}return e.slice()}function jr(t,e,n){for(var i=t>>>1,r=e>>>1,a=new Array(t*e),o=-i,l=-r,s=0;s<d;++s,++o)i<o&&(o=-i,++l),a[s]=n(o,l,t,e);return a}function $r(t,e){return 1===e?gn(Xr(t,1),kr(t)):gn(kr(t),Xr(t,0))}function Wr(t,e){return 1===e?gn(Xr(t,1),Pr(t)):gn(Pr(t),Xr(t,0))}function qr(t,e,n){e=e||1,n=n||e;for(var i=t*t,r=new mn(i),a=0;a<i;++a)r[a]=e;return r[i>>>1]=n,r}function Vr(t){for(var e=t*t,n=new Bn(e),i=0;i<e;++i)n[i]=1;return n}function Kr(t,e,n,i,r,a,o,l,s,u,c){var f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I=e.length,w=i-1,L=(I>>>a)-i,E=e;if(e=n,n=E,Gn.MODE.GRAY===t){for(R=o.length,f=0;f<c;++f)for(E=e,e=n,n=E,p=m=h=0;p<I;p+=4,++h){for(i<=h&&(h=0,m+=i),g=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||w<b||S<0||L<S||(g=s(x=e[A=b+S<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}if(l)for(R=(o=l).length,f=0;f<c;++f)for(E=e,e=n,n=E,p=m=h=0;p<I;p+=4,++h){for(i<=h&&(h=0,m+=i),g=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||w<b||S<0||L<S||(g=s(x=e[A=b+S<<2],g));n[p]=g,n[p+1]=g,n[p+2]=g,n[p+3]=e[p+3]}}else{for(R=o.length,f=0;f<c;++f)for(E=e,e=n,n=E,p=m=h=0;p<I;p+=4,++h){for(i<=h&&(h=0,m+=i),g=_=v=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||w<b||S<0||L<S||(x=e[A=b+S<<2],y=e[A+1],C=e[A+2],g=s(x,g),_=s(y,_),v=s(C,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}if(l)for(R=(o=l).length,f=0;f<c;++f)for(E=e,e=n,n=E,p=m=h=0;p<I;p+=4,++h){for(i<=h&&(h=0,m+=i),g=_=v=u,d=0;d<R;d+=2)b=h+o[d],S=m+o[d+1],b<0||w<b||S<0||L<S||(x=e[A=b+S<<2],y=e[A+1],C=e[A+2],g=s(x,g),_=s(y,_),v=s(C,v));n[p]=g,n[p+1]=_,n[p+2]=v,n[p+3]=e[p+3]}}}function Zr(t,e,n){t[e]=n,Jr(t,0,e)}function Qr(t,e){var n,i=t[e-1];if(e-1){n=t[0],t[0]=i;var r,a,o=t,l=0,s=t=e-1,t=l,e=o[l];for(r=2*l+1;r<s;)(a=r+1)<s&&o[r]>=o[a]&&(r=a),o[l]=o[r],r=2*(l=r)+1;return o[l]=e,Jr(o,t,l),n}return i}function Jr(t,e,n){for(var i,r,a=t[n];e<n&&a<(r=t[i=n-1>>>1]);)t[n]=r,n=i;t[n]=a}function ta(t,e,n){var t=7&t,i=t<4?e:n,n=t<4?n:e;return(1&t?-i:i)+(2&t?-2*n:2*n)}function ea(t,e){var n=.211324865,i=.366025403*(t+e),r=e+i,i=ai(t+i),r=ai(r),a=(i+r)*n,t=t-(i-a),e=e-(r-a),a=e<t?(c=1,0):(c=0,1),o=t-c+n,l=e-a+n,s=t-1+2*n,n=e-1+2*n,i=255&i,r=255&r,u=.5-t*t-e*e,u=u<0?0:(u*=u)*u*ta(S[i+S[r]],t,e),t=.5-o*o-l*l,e=t<0?0:(t*=t)*t*ta(S[i+c+S[r+a]],o,l),t=.5-s*s-n*n,c=t<0?0:(t*=t)*t*ta(S[1+i+S[1+r]],s,n);return 40*(u+e+c)}function na(t){return t*t*t*(t*(6*t-15)+10)}function ia(t,e,n){return e+t*(n-e)}function ra(t,e){var n=ai(t),i=ai(e),t=t-n,e=e-i,r=t-1,a=e-1,o=n+1&255,l=i+1&255,s=na(e),u=na(t),n=ia(s,ta(S[(n&=255)+S[i&=255]],t,e),ta(S[n+S[l]],t,a)),t=ia(s,ta(S[o+S[i]],r,e),ta(S[o+S[l]],r,a));return.507*ia(u,n,t)}function aa(t,e,n,i,r,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((i+c[_][0])%a)*l,p*((r+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=f=~~(255*(.5*m/g+.5)),t[e+1]=f,t[e+2]=f,t[e+3]=255}function oa(t,e,n,i,r,a,o,l,s,u,c,f,h){for(var m=0,p=f,d=1,g=0,_=0;_<u;++_)m+=n(p*((i+c[_][0])%a)*l,p*((r+c[_][1])%o)*s)*d,p*=2,g+=d,d*=h;t[e]=(f=~~(16777215*(.5*m/g+.5)))>>>16&255,t[e+1]=f>>>8&255,t[e+2]=255&f,t[e+3]=255}function la(t,e,n,i,r,a,o,l,s,u,c,f){var h,m,p,d,g,_,v=1/a,x=1/o,y=f?ra:ea,C=r?aa:oa,b=t.length,S=e>>>1,A=n>>>1;if(u=u||1,c=c||.5,l=l||1,s=s||[[0,0]],i)for(g=m=h=0;g<b;g+=4,++h)e<=h&&(h=0,++m),d=A<m?n-1-m:m,(p=S<h?e-1-h:h)<h||d<m?(t[g]=t[_=d*e+p<<2],t[g+1]=t[1+_],t[g+2]=t[2+_],t[g+3]=255):C(t,g,y,p,d,e,n,v,x,l,s,u,c);else for(g=m=h=0;g<b;g+=4,++h)e<=h&&(h=0,++m),C(t,g,y,h,m,e,n,v,x,l,s,u,c);return t}!function(t,F,y){function e(){}function n(t,e){return t&&P?P.createObjectURL(new Blob(t.push?t:[t],e||{type:"text/javascript"})):t}function i(t){var e;return S?{file:__filename,path:__dirname}:R||I?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:U&&t?{file:e=t,path:e.split("/").slice(0,-1).join("/")}:w&&(e=document.getElementsByTagName("script"))&&e.length?((i.link=i.link?i.link:document.createElement("a")).href=e[e.length-1].src,{file:e=i.link.href,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}}var l,r="prototype",a=Object,o=Array,s=Function[r],a=a[r],o=o[r],H=(JSON.parse,JSON.stringify),u=a.hasOwnProperty,c=function(t,e){return function(){return t(e)}},f=s.call.bind(o.slice),s=a.toString,C=function(t){return"function"==typeof t},h=function(t,e){return t instanceof e},m=setTimeout,p=clearTimeout,o=y,d=60,g=0,_=1,v=2,x=3,b=4,a="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import,S="undefined"!=typeof global&&"[object global]"===s.call(global),A=S&&void 0!==process.send,R=!a&&!S&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,I=!a&&!S&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,w=!(a||S||I||R||"undefined"==typeof navigator||"undefined"==typeof document),U=(w&&window.opener,w&&(window.self,window.top),"function"==typeof define&&define.amd),B=S||"function"==typeof Worker||"function"==typeof SharedWorker,L=S?t:R||I?self||t:window||t,z=S?module.$deps:R||I?self||this:window||this,Y=(S?global:R||I?self:window,A||R||I),E=A&&0===process.listenerCount("message")||R&&!L.onconnect||I&&!L.onmessage,D=E?function t(e){t.handler&&t.handler(A?e:e.data)}:e,T=null,M={},P=(S&&require("os").cpus().length,S?null:void 0!==L.webkitURL?L.webkitURL:void 0!==L.URL?L.URL:null),X=i(q.moduleUri).file,k=function(t,e){if(t=t||{},e)for(var n in e)u.call(e,n)&&(t[n]=e[n]);return t},j=0;M[X]=1,S?((l=function(t){var e=this;e.process=require("child_process").fork(t),e.process.on("message",function(t){e.onmessage&&e.onmessage(t)}),e.process.on("error",function(t){e.onerror&&e.onerror(t)})}).Shared=l)[r]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.send(t),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}:(((l=function(t){var e=this;e.process=new Worker(t),e.process.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.onerror=function(t){e.onerror&&e.onerror(t)}}).Shared=l)[r]={constructor:l,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.postMessage(t),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(l.Shared=function(t){var e=this;e.process=new SharedWorker(t),e.process.port.start(),e.process.port.onmessage=function(t){e.onmessage&&e.onmessage(t.data)},e.process.port.onerror=e.process.onerror=function(t){e.onerror&&e.onerror(t)}},l.Shared[r]={constructor:l.Shared,process:null,onmessage:null,onerror:null,postMessage:function(t){return this.process&&this.process.port.postMessage(t),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),E&&(R?(L.close=e,L.postMessage=e,L.onconnect=function(t){var e=t.ports[0];L.close=function(){e.close()},L.postMessage=function(t){e.postMessage(t)},e.addEventListener("message",D),e.start()}):I?L.onmessage=D:A&&(L.close=function(){process.exit()},L.postMessage=function(t){process.send(t)},L.importScripts=function(t){try{new Function("",require("fs").readFileSync(t).toString()).call(z)}catch(t){throw t}},process.on("message",D)));function G(t){if(!(this instanceof G))return new G(t);this.$id=(++j).toString(16),this.options=k({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},t)}G[r]={constructor:G,options:null,$id:null,$window:null,dispose:function(){var t=this;return t.$window&&t.close(),t.$window=null,t.$id=null,t.options=null,t},close:function(){var t=this;return t.$window&&(t.$window.closed||t.$window.close(),t.$window=null),t},ready:function(e,n){var i=this;return setTimeout(function t(){!i.$window||e&&!i.$window[e]?setTimeout(t,60):n()},0),i},open:function(t){var e=this;return!e.$window&&t&&(e.$window=window.open(t.push?n(["\ufeff"].concat(t),{type:"text/html;charset=utf-8"}):t,e.$id,function(t){var e,n=[];if(t)for(e in t)u.call(t,e)&&n.push(e+"="+(!0===t[e]||1===t[e]?"yes":!1===t[e]||0===t[e]?"no":t[e]));return n.join(",")}(e.options))),e},write:function(t){return this.$window&&t&&this.$window.document.write(t),this}};var O=function t(e){var i,n,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x;return e instanceof t?e:this instanceof t?(f=c=u=s=l=o=!1,m=0,p=1,_=g=d=h=a=r=n=null,v=y,(i=this).queue=function(t){return arguments.length?(n=t,i):n},i.jumpNext=function(t){n&&n.jumpNext(!1,t)},i.abort=function(t){n&&(n.abort(!1),t)&&(n.dispose(),n=null)},i.dispose=function(){n&&(n.dispose(),n=null)},i.task=function(t){return r=t,i},e&&i.task(e),i.run=x=function(){return r.jumpNext=i.jumpNext,r.abort=i.abort,r.dispose=i.dispose,v=r(),o=!0,r.jumpNext=null,r.abort=null,r.dispose=null,v},i.runWithArgs=function(t){return r.jumpNext=i.jumpNext,r.abort=i.abort,r.dispose=i.dispose,v=r.apply(null,t),o=!0,r.jumpNext=null,r.abort=null,r.dispose=null,v},i.canRun=function(){return!!r&&!!(!o||l||s||u||c||f)&&!((l||s)&&d<=m||s&&!h||(u||c)&&v===g)},i.iif=function(t,e,n){return(t=C(t)?t():t)?i.task(e):2<arguments.length&&i.task(n),i},i.until=function(t){return v=y,g=t,u=s=l=f=!(c=!(h=null)),i.run=x,i},i.untilNot=function(t){return v=y,_=t,u=s=l=c=!(f=!(h=null)),i.run=x,i},i.loop=function(t,e,n){return v=y,m=e||0,p=n||1,d=t,u=s=f=c=!(l=!(h=null)),i.run=function(){var t=r(m);return m+=p,o=!0,v=t},i},i.each=function(t){return v=y,m=0,p=1,d=(h=t)&&t.length||0,u=l=f=c=!(s=!0),i.run=function(){var t=r(h[m],m);return++m,o=!0,v=t},i},i.recurse=function(t,e){return v=t,g=e,s=l=f=c=!(u=!(h=null)),i.run=function(){var t=r(v);return o=!0,v=t},i},i.isFinished=function(){var t=!o||f||c||l||s||u;return!(t=(t=(t=t&&(c||u)&&v===g?!1:t)&&f&&v!==_?!1:t)&&(l||s)&&d<=m?!1:t)},i.onComplete=function(t){return a=t||null,i},void(i.complete=function(){return a&&C(a)&&a(),i})):new t(e)};function $(t,e){var n,i=t.$queue,r=0;if(t.$runmode=_,i&&i.length){for(t.$running=!0;r<i.length;)(n=i[r])&&n.canRun()?(e?n.runWithArgs(e):n.run(),n.isFinished()?(i.shift(),n.complete()):++r):i.shift();t.$running=!1,t.$timer=m(c($,t),t.$interval)}}function W(t,e){var n,i=t.$queue;t.$runmode=b,i&&i.length&&((n=i[0])&&n.canRun()?(t.$running=!0,e?n.runWithArgs(e):n.run(),n.isFinished()&&(i.shift(),n.complete())):i.shift(),t.$running=!1,t.$timer=m(c(W,t),t.$interval))}function N(t,e){var n;return h(t,O)?t:C(t)?new O(t):h(this,N)?((n=this).$interval=arguments.length&&parseInt(t,10)||d,n.$timer=null,n.$runmode=g,n.$running=!1,n.$queue=[],void(E&&!1!==e&&n.initThread())):new N(t,e)}N.VERSION="0.5.2",N.Thread=l,N.Task=O,N.BrowserWindow=G,N.MODE={NONE:g,INTERLEAVE:_,LINEAR:v,PARALLEL:x,SEQUENCE:b},N.Platform={UNDEFINED:o,UNKNOWN:0,NODE:1,BROWSER:2},N.supportsMultiThreading=function(){return B},N.isPlatform=function(t){return 1===t?S:2===t?w:void 0},N.isThread=function(t,e){return e=!0!==e||E,1===t?e&&A:2===t?e&&(R||I):e&&Y},N.path=i,N.blob=n,N.load=function(t,e,n){if(t){e&&e.length&&N.importScripts(e.join?e.join(","):e),t=t.split(".");for(var i=z;t.length;)t[0]&&t[0].length&&i[t[0]]&&(i=i[t[0]]),t.shift();return i&&L!==i?C(i)?!1!==n?new i:i():i:void 0}return null},N.listen=E?function(t){D.handler=t}:e,N.send=E?function(t){L.postMessage(t)}:e,N.importScripts=E?function(t){if(t&&t.length)for(var e=0,n=(t=t.split?t.split(","):t).length;e<n;++e){var i=t[e];i&&i.length&&1!==M[i]&&(L.importScripts(i),M[i]=1)}}:e,N.close=E?function(){L.close()}:e,N.log="undefined"!=typeof console?function(t){console.log(t||"")}:e,N.serialize=function(i){i=i||new N(0,!1);function t(n){function t(){var t=this,e=arguments;i.step(function(){n.apply(t,e)}),i.$running||i.run(v)}return t.free=function(){return n},t}return t.free=function(){i&&i.dispose(),i=null},t},N[r]={constructor:N,$interval:d,$timer:null,$queue:null,$thread:null,$events:null,$runmode:g,$running:!1,dispose:function(t){var e=this;return e.unfork(!0),e.$timer&&p(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=g,e.$running=!1,E&&!0===t&&N.close(),e},empty:function(){var t=this;return t.$timer&&p(t.$timer),t.$timer=null,t.$queue=[],t.$runmode=g,t.$running=!1,t},interval:function(t){return arguments.length?(this.$interval=parseInt(t,10)||this.$interval,this):this.$interval},fork:function(t,e,n,i){var r,a,o=this;if(!o.$thread){if(!B)throw o.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");a=S?(r="Asynchronous: Thread (Process): ","Asynchronous: Thread (Process) Error: "):(r="Asynchronous: Thread (Worker): ","Asynchronous: Thread (Worker) Error: "),o.$events=o.$events||{},(i=o.$thread=new(!0===i?l.Shared:l)(X)).onmessage=function(t){var e;t.event&&(e=t.event,t=t.data||null,o.$events&&o.$events[e]?o.$events[e](t):"console.log"!==e&&"console.error"!==e||N.log(("console.error"===e?a:r)+(t||"")))},i.onerror=function(t){if(!o.$events||!o.$events.error)throw new Error(a+t.toString());o.$events.error(t)},o.send("initThread",{component:t||null,asInstance:!1!==n,imports:e?[].concat(e).join(","):null})}return o},unfork:function(t){var e=this;return e.$thread&&(!0===t?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return E&&(n.$events={},N.listen(function(t){var e=t.event,t=t.data||null;e&&n.$events[e]?n.$events[e](t):"dispose"===e&&(n.dispose(),N.close())})),n},listen:function(t,e){return t&&C(e)&&this.$events&&(this.$events[t]=e),this},unlisten:function(t,e){return t&&this.$events&&this.$events[t]&&(arguments.length<2||e===this.$events[t])&&delete this.$events[t],this},send:function(t,e){return t&&(E?N.send({event:t,data:e||null}):this.$thread&&this.$thread.postMessage({event:t,data:e||null})),this},task:function(t){return h(t,O)?t:C(t)?O(t):void 0},iif:function(){var t=arguments,e=new O;return e.iif.apply(e,t)},until:function(){var t=f(arguments),e=new O(t.pop());return e.until.apply(e,t)},untilNot:function(){var t=f(arguments),e=new O(t.pop());return e.untilNot.apply(e,t)},loop:function(){var t=f(arguments),e=new O(t.pop());return e.loop.apply(e,t)},each:function(){var t=f(arguments),e=new O(t.pop());return e.each.apply(e,t)},recurse:function(){var t=f(arguments),e=new O(t.pop());return e.recurse.apply(e,t)},step:function(t){return t&&this.$queue.push(this.task(t).queue(this)),this},steps:function(){for(var t=arguments,e=t.length,n=0;n<e;++n)this.step(t[n]);return this},jumpNext:function(t,e){var n=this,i=n.$queue;return e=e||0,!1!==t?function(){return e<i.length&&(0<e&&i.splice(0,e),n.run(n.$runmode)),n}:(e<i.length&&(0<e&&i.splice(0,e),n.run(n.$runmode)),n)},jumpNextWithArgs:function(t,e,n){var i=this,r=i.$queue;return e=e||0,!1!==t?function(){return e<r.length&&(0<e&&r.splice(0,e),i.run(i.$runmode,arguments)),i}:(e<r.length&&(0<e&&r.splice(0,e),i.run(i.$runmode,n)),i)},abort:function(t,e){var n=this;return!1!==t?function(){return e&&0<e?m(function(){n.empty()},e):n.empty(),n}:(e&&0<e?m(function(){n.empty()},e):n.empty(),n)},run:function(t,e){var n=this;if(arguments.length?n.$runmode=t:t=n.$runmode,e=e||null,b===t)W(n,e);else if(_===t)$(n,e);else if(v===t){var i,r=n,a=r.$queue;if(r.$runmode=v,a){for(;a.length&&(!a[0]||!a[0].canRun());)a.shift();a.length?(r.$running=!0,i=a.shift(),e?i.runWithArgs(e):i.run(),i.complete()):r.$running=!1}}else x===t&&((e=n).$runmode=x,e.$running=!1);return n}},E&&(N.log=function(t){N.send({event:"console.log",data:"string"!=typeof t?H(t):t})},N.listen(function(t){var e=t.event,n=t.data||null;switch(e){case"initThread":n&&n.component&&(T&&(C(T.dispose)&&T.dispose(),T=null),T=N.load(n.component,n.imports,n.asInstance));break;case"dispose":T&&(C(T.dispose)&&T.dispose(),T=null),N.close()}})),F.Asynchronous=N}(this,M),a=M,F="prototype",H=Object[F].hasOwnProperty,Object[F].toString,Object.defineProperty,N=Math,U=function(){},B=0,lr.Merge=function(){for(var t,e,n=arguments.length,i=n?arguments[0]:null,r=1;r<n;++r)for(t in e=arguments[r])H.call(e,t)&&(i[t]=e[t]);return i},a.Class=lr,a.Path=a.Asynchronous.path(q.moduleUri),a.uuid=function(t){return[t||"filter",(new Date).getTime(),++B].join("_")},a.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},t=a.Asynchronous,G=t.isPlatform(t.Platform.NODE),i=t.isPlatform(t.Platform.BROWSER),L=t.supportsMultiThreading(),I=t.isThread(null,!0),O=t.isThread(),r="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",n="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",A="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",(G=a.Browser={isNode:G,isBrowser:i,isWorker:I,isInsideWorker:O,supportsWorker:L,isPhantom:/PhantomJS/.test(r),isOpera:i&&/Opera|OPR\//.test(r),isFirefox:i&&/Firefox\//.test(r),isChrome:i&&/Chrome\//.test(r),isSafari:i&&/Apple Computer/.test(A),isKhtml:i&&/KHTML\//.test(r),isIE:i&&(/MSIE \d/.test(r)||/Trident\/\d/.test(r)),isEdge:i&&/Edg/.test(r),isGecko:i&&/gecko\/\d/i.test(r),isWebkit:i&&/WebKit\//.test(r),isMac_geLion:i&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(r),isMac_geMountainLion:i&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(r),isMobile:!1,isIOS:/AppleWebKit/.test(r)&&/Mobile\/\w+/.test(r),isWin:/windows/i.test(n),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1}).isMobile=G.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(r),G.isMac=G.isIOS||/Mac/.test(n),G.isIE_lt8=G.isIE&&!O&&(null==document.documentMode||document.documentMode<8),G.isIE_lt9=G.isIE&&!O&&(null==document.documentMode||document.documentMode<9),G.isQtWebkit=G.isWebkit&&/Qt\/\d+\.\d+/.test(r),a.getPath=t.path,a.log=I?t.log:"undefined"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},a.warning=function(t){a.log("WARNING: "+t)},a.error=function(t,e){if(a.log("ERROR: "+t),e)throw new Error(String(t))},a.devicePixelRatio=(i&&!O?window.devicePixelRatio:1)||1,a._notSupportClamp="undefined"==typeof Uint8ClampedArray||G.isOpera,a.Array=Array,a.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,a.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,a.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,a.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,a.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,a.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,a.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,a.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,a.ColorTable=a.ImArray=a._notSupportClamp?a.Array8U:Uint8ClampedArray,a.AffineMatrix=a.ColorMatrix=a.ConvolutionMatrix=a.Array32F,a.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,HSL:19,HWB:27,CMY:13,CMYK:13,XYZ:28,ILL:29,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,NONLINEAR:20,STATISTICAL:21,ADAPTIVE:22,THRESHOLD:23,HISTOGRAM:24,MONO:25,MASK:26,COLORIZE:30,COLORIZEHUE:31,CHANNEL:32},a.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,IP:0,Q:2,INPHASE:0,QUADRATURE:2,H:0,S:2,V:1,L:1,I:1,U:2,WH:1,BL:2,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3,XX:0,YY:1,ZZ:2,ILL1:0,ILL2:1,ILL3:2},a.POS={X:0,Y:1},a.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},a.LUMA=a.LUMA_YUV=a.LUMA_YIQ=new a.Array32F([.2126,.7152,.0722]),a.LUMA_YCbCr=new a.Array32F([.299,.587,.114]),a.LUMA_GREEN=new a.Array32F([0,1,0]),a.CONSTANTS=a.CONST={X:0,Y:1,Z:2,PI:N.PI,PI2:2*N.PI,PI_2:N.PI/2,toRad:N.PI/180,toDeg:180/N.PI},a.FORMAT={IMAGE:1024,DATA:2048},a.Util={String:{},Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[F].set,hasSubarray:"function"==typeof a.Array32F[F].subarray},Math:{},Filter:{},Image:{},GLSL:{}},a.Canvas=function(t,e){var n=document.createElement("canvas");return e=e||0,n.width=+(t=t||0),n.height=+e,n},a.Canvas.Image=function(){return new Image},a.Canvas.ImageData=function(t,e,n){return"undefined"!=typeof ImageData?new ImageData(t,e,n):{data:t,width:e,height:n}},Y=z=null,a.supportsGLSL=function(){if(null==z){var t,e=null,n=null,i=["webgl","experimental-webgl"],r=null;try{e=a.Canvas(1,1)}catch(t){e=null}if(e)for(t=0;t<i.length;++t){r=i[t],n=null;try{n=e.getContext(r)}catch(t){n=null}if(n)break}(z=!!n)&&(Y=r),e=n=null}return z},a.setGLDimensions=function(t,e,n){return t&&t.gl&&(t.gl.width!==e&&(t.gl.width=e),t.gl.height!==n)&&(t.gl.height=n),t},a.getGL=function(t,e,n){if(t&&a.supportsGLSL())return t.gl||(t.gl=a.Canvas(e,n),i&&t.gl&&t.gl.addEventListener&&t.gl.addEventListener("webglcontextlost",sr,!1)),a.setGLDimensions(t,e,n),t.gl.getContext(Y)},a.disposeGL=function(t){t&&t.gl&&i&&t.gl.removeEventListener&&t.gl.removeEventListener("webglcontextlost",sr,!1)},at=(e=M).MODE,L=e._notSupportClamp,ot=e.ImArray,lt=e.Array32F,e.Array64F,e.Array32I,P=e.Array16I,e.Array8U,X=e.ColorTable,k=e.ColorMatrix,j=e.AffineMatrix,e.ConvolutionMatrix,A=e.Util.Array=e.Util.Array||{},n=e.Util.String=e.Util.String||{},r=e.Util.Math=e.Util.Math||{},I=e.Util.Image=e.Util.Image||{},t=e.Util.Filter=e.Util.Filter||{},(w=Math).exp,$=w.sqrt,w.pow,w.ceil,w.floor,w.log,w.sin,w.cos,Q=w.min,J=w.max,Z=w.abs,w.PI,w.log2,W=/([.*+?^${}()|\[\]\/\\\-])/g,K=/^\s+|\s+$/g,tt=/^function[^{]+{([\s\S]*)}$/,A.copy=A.hasArrayset?function(t){var e=new t.constructor(t.length);return e.set(t,0),e}:function(t){var e=new t.constructor(t.length);return cr(e,t,0,0,t.length-1),e},et=fr(5,5,1.4),A.typed=e.Browser.isNode?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},A.typed_obj=e.Browser.isNode?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t},A.arrayset_shim=cr,A.arrayset=A.hasArrayset?function(t,e,n){t.set(e,n||0)}:cr,A.subarray=A.hasSubarray?function(t,e,n){return t.subarray(e,n)}:function(t,e,n){return t.slice(e,n)},r.clamp=ur,r.hypot=function(t,e,n){var i=J(t,e=e||0,n=n||0);return i?(i=Z(i))*$((t/=i)*t+(e/=i)*e+(n/=i)*n):0},n.esc=function(t){return t.replace(W,"\\$1")},n.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(K,"")},n.function_body=function(t){return t.toString().match(tt)[1]||""},I.crop=A.hasArrayset?function(t,e,n,i,r,a,o){a=Q(a,e-1),o=Q(o,n-1);for(var l,s=new ot((n=a-i+1)*(o-r+1)<<2),u=n<<2,c=r,f=r*e,h=0;c<=o;++c,f+=e,h+=u)s.set(t.subarray(l=f+i<<2,l+u),h);return s}:function(t,e,n,i,r,a,o){a=Q(a,e-1),o=Q(o,n-1);for(var l,s=new ot((n=a-i+1)*(o-r+1)<<2),u=n<<2,c=r,f=r*e,h=0;c<=o;++c,f+=e,h+=u)cr(s,t,h,l=f+i<<2,l+u);return s},I.pad=A.hasArrayset?function(t,e,n,i,r,a,o){for(var l,i=e+(a=a||0)+(i=i||0),s=new ot(i*(n+(o=o||0)+(r=r||0))<<2),u=e<<2,c=i<<2,f=a<<2,h=0,m=0,p=o*c;h<n;++h,m+=e,p+=c)s.set(t.subarray(l=m<<2,l+u),f+p);return s}:function(t,e,n,i,r,a,o){for(var l,i=e+(a=a||0)+(i=i||0),s=new ot(i*(n+(o=o||0)+(r=r||0))<<2),u=e<<2,c=i<<2,f=a<<2,h=0,m=0,p=o*c;h<n;++h,m+=e,p+=c)cr(s,t,f+p,l=m<<2,l+u);return s},I.interpolate=function(t,e,n,i,r){for(var a,o,l,s,u,c,f,h,m,p,d=i*r<<2,g=new ot(d),_=(e-1)/i,v=(n-1)/r,x=e<<2,y=w.round,C=0,b=0,S=0,A=0,R=0,I=0;I<d;I+=4,++C,b+=_)i<=C&&(R=(S+=v)-(p=(b=C=0)|S),A=p*e),a=t[h=A+(p=0|b)<<2],o=t[4+h],l=t[h+x],s=t[h+x+4],g[I]=ur(y(a*(u=(1-(m=b-p))*(1-R))+o*(c=m*(1-R))+l*(f=R*(1-m))+s*(m=m*R)),0,255),a=t[1+h],o=t[5+h],l=t[h+x+1],s=t[h+x+5],g[I+1]=ur(y(a*u+o*c+l*f+s*m),0,255),a=t[2+h],o=t[6+h],l=t[h+x+2],s=t[h+x+6],g[I+2]=ur(y(a*u+o*c+l*f+s*m),0,255),a=t[3+h],o=t[7+h],l=t[h+x+3],s=t[h+x+7],g[I+3]=ur(y(a*u+o*c+l*f+s*m),0,255);return g},t.ct_eye=function(t,e){null==e&&(e=0),null==t&&(t=1);var n,i=new X(256);if("function"==typeof t)for(n=0;n<256;++n)i[n]=0|ur(t(n),0,255);else for(n=0;n<256;++n)i[n]=0|ur(e+t*n,0,255);return i},t.ct_multiply=function(t,e){for(var n=new X(256),i=0;i<256;++i)n[i]=ur(t[ur(e[i],0,255)],0,255);return n},t.cm_eye=function(){return new k([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},t.cm_multiply=function(t,e){for(var n=new k(20),i=0;i<20;i+=5)n[i+0]=e[i]*t[0]+e[i+1]*t[5]+e[i+2]*t[10]+e[i+3]*t[15],n[i+1]=e[i]*t[1]+e[i+1]*t[6]+e[i+2]*t[11]+e[i+3]*t[16],n[i+2]=e[i]*t[2]+e[i+1]*t[7]+e[i+2]*t[12]+e[i+3]*t[17],n[i+3]=e[i]*t[3]+e[i+1]*t[8]+e[i+2]*t[13]+e[i+3]*t[18],n[i+4]=e[i]*t[4]+e[i+1]*t[9]+e[i+2]*t[14]+e[i+3]*t[19]+e[i+4];return n},t.cm_rechannel=function(t,e,n,i,r,a,o,l,s){var u=new k(20),o=5*o,l=5*l,s=5*s;return u[(a=5*a)+e]=t[0],u[a+n]=t[1],u[a+i]=t[2],u[a+r]=t[3],u[4+a]=t[4],u[o+e]=t[5],u[o+n]=t[6],u[o+i]=t[7],u[o+r]=t[8],u[4+o]=t[9],u[l+e]=t[10],u[l+n]=t[11],u[l+i]=t[12],u[l+r]=t[13],u[4+l]=t[14],u[s+e]=t[15],u[s+n]=t[16],u[s+i]=t[17],u[s+r]=t[18],u[4+s]=t[19],u},t.am_eye=function(){return new j([1,0,0,0,0,1,0,0])},t.am_multiply=function(t,e){var n=new j(8);return n[0]=t[0]*e[0]+t[1]*e[4],n[1]=t[0]*e[1]+t[1]*e[5],n[2]=t[0]*e[2]+t[1]*e[6]+t[2],n[3]=t[0]*e[3]+t[1]*e[7]+t[3],n[4]=t[4]*e[0]+t[5]*e[4],n[5]=t[4]*e[1]+t[5]*e[5],n[6]=t[4]*e[2]+t[5]*e[6]+t[6],n[7]=t[4]*e[3]+t[5]*e[7]+t[7],n},t.cm_combine=function(t,e,n,i,r){r=r||Array,n=n||1,i=i||1;for(var a=0,o=t.length,l=new r(o);a<o;++a)l[a]=n*t[a]+i*e[a];return l},t.cm_convolve=function(t,e,n){n=n||Array;for(var i=t.length,r=(e=e===+e?[e]:e).length,a=new n(i*r),o=0,l=0;o<i;)a[o*r+l]=t[o]*e[l],++l>=r&&(l=0,++o);return a},t.gaussian=fr,t.integral_convolution=L?function(F,t,e,H,U,n,B,z,Y,P,X,i,r,k){var a,o,l,s,u,c,f,h,m,p,d,g,j,_,v,x,y,C,b,S,A,R,I,w,L,$,W,q,E,D,T=t.length,V=T>>>U,K=e<<U,M=1<<U,U=z*Y,Z=-(z=z>>>1)-1,Q=-(Y=e*(Y>>>1))-e,J=z,tt=Y,z=P*X,et=-(Y=P>>>1)-1,nt=-(P=e*(X>>>1))-e,it=Y,rt=P,G=e-1,O=V-e,N=t;if(t=new ot(T),k=k||1,at.GRAY===F)if(u=e,a=new lt(V),B)for(p=n[0],d=n[U>>>1]-p,g=B[0],j=B[z>>>1]-g,E=0;E<k;++E){for(D=t,t=N,N=D,h=o=f=c=0;h<e;h++,c+=M,++f)o+=t[c],a[f]=o;for(o=h=f=0,c=K;c<T;c+=M,++f,++h)e<=h&&(o=h=0),o+=t[c],a[f+u]=a[f]+o;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=(x=G<(x=h+J)?G:x)+(y=O<(y=m+tt)?O:y)]-a[b=x+(v=(v=m+Q)<0?0:v)]-a[S=(_=(_=h+Z)<0?0:_)+y]+a[C=_+v])+d*t[c],q=g*(a[A=(x=G<(x=h+it)?G:x)+(y=O<(y=m+rt)?O:y)]-a[b=x+(v=(v=m+nt)<0?0:v)]-a[S=(_=(_=h+et)<0?0:_)+y]+a[C=_+v])+j*t[c],N[c]=0|(R=(R=i*L+r*q)<0?0:255<R?255:R),N[c+1]=0|R,N[c+2]=0|R,N[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,E=0;E<k;++E){for(D=t,t=N,N=D,h=o=f=c=0;h<e;h++,c+=M,++f)o+=t[c],a[f]=o;for(o=h=f=0,c=K;c<T;c+=M,++f,++h)e<=h&&(o=h=0),o+=t[c],a[f+u]=a[f]+o;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=(x=G<(x=h+J)?G:x)+(y=O<(y=m+tt)?O:y)]-a[b=x+(v=(v=m+Q)<0?0:v)]-a[S=(_=(_=h+Z)<0?0:_)+y]+a[C=_+v])+d*t[c],N[c]=0|(R=(R=i*L+r)<0?0:255<R?255:R),N[c+1]=0|R,N[c+2]=0|R,N[c+3]=t[c+3]}else if(u=(e<<1)+e,a=new lt((V<<1)+V),B)for(p=n[0],d=n[U>>>1]-p,g=B[0],j=B[z>>>1]-g,E=0;E<k;++E){for(D=t,t=N,N=D,h=o=l=s=f=c=0;h<e;++h,c+=M,f+=3)o+=t[c],l+=t[c+1],s+=t[c+2],a[f]=o,a[f+1]=l,a[f+2]=s;for(o=l=s=h=f=0,c=K;c<T;c+=M,f+=3,++h)e<=h&&(o=l=s=h=0),o+=t[c],l+=t[c+1],s+=t[c+2],a[f+u]=a[f]+o,a[f+u+1]=a[f+1]+l,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=((A=(x=G<(x=h+J)?G:x)+(y=O<(y=m+tt)?O:y))<<1)+A]-a[b=((b=x+(v=(v=m+Q)<0?0:v))<<1)+b]-a[S=((S=(_=(_=h+Z)<0?0:_)+y)<<1)+S]+a[C=((C=_+v)<<1)+C])+d*t[c],$=p*(a[A+1]-a[b+1]-a[S+1]+a[C+1])+d*t[c+1],W=p*(a[A+2]-a[b+2]-a[S+2]+a[C+2])+d*t[c+2],q=g*(a[A=((A=(x=G<(x=h+it)?G:x)+(y=O<(y=m+rt)?O:y))<<1)+A]-a[b=((b=x+(v=(v=m+nt)<0?0:v))<<1)+b]-a[S=((S=(_=(_=h+et)<0?0:_)+y)<<1)+S]+a[C=((C=_+v)<<1)+C])+j*t[c],I=(I=i*$+r*(g*(a[A+1]-a[b+1]-a[S+1]+a[C+1])+j*t[c+1]))<0?0:255<I?255:I,w=(w=i*W+r*(g*(a[A+2]-a[b+2]-a[S+2]+a[C+2])+j*t[c+2]))<0?0:255<w?255:w,N[c]=0|(R=(R=i*L+r*q)<0?0:255<R?255:R),N[c+1]=0|I,N[c+2]=0|w,N[c+3]=t[c+3]}else for(p=n[0],d=n[U>>>1]-p,E=0;E<k;++E){for(D=t,t=N,N=D,h=o=l=s=f=c=0;h<e;++h,c+=M,f+=3)o+=t[c],l+=t[c+1],s+=t[c+2],a[f]=o,a[f+1]=l,a[f+2]=s;for(o=l=s=h=f=0,c=K;c<T;c+=M,f+=3,++h)e<=h&&(o=l=s=h=0),o+=t[c],l+=t[c+1],s+=t[c+2],a[f+u]=a[f]+o,a[f+u+1]=a[f+1]+l,a[f+u+2]=a[f+2]+s;for(c=m=h=0;c<T;c+=M,++h)e<=h&&(h=0,m+=e),L=p*(a[A=((A=(x=G<(x=h+J)?G:x)+(y=O<(y=m+tt)?O:y))<<1)+A]-a[b=((b=x+(v=(v=m+Q)<0?0:v))<<1)+b]-a[S=((S=(_=(_=h+Z)<0?0:_)+y)<<1)+S]+a[C=((C=_+v)<<1)+C])+d*t[c],I=(I=i*($=p*(a[A+1]-a[b+1]-a[S+1]+a[C+1])+d*t[c+1])+r)<0?0:255<I?255:I,w=(w=i*(W=p*(a[A+2]-a[b+2]-a[S+2]+a[C+2])+d*t[c+2])+r)<0?0:255<w?255:w,N[c]=0|(R=(R=i*L+r)<0?0:255<R?255:R),N[c+1]=0|I,N[c+2]=0|w,N[c+3]=t[c+3]}return N}:function(F,t,e,H,n,i,r,U,B,z,Y,a,o,P){var l,s,u,c,f,h,m,p,d,g,_,v,X,x,y,C,b,S,A,R,I,w,k,j,L,$,W,q,E,D,T=t.length,V=T>>>n,K=e<<n,M=1<<n,n=U*B,Z=-(U=U>>>1)-1,Q=-(B=e*(B>>>1))-e,J=U,tt=B,U=z*Y,et=-(B=z>>>1)-1,nt=-(z=e*(Y>>>1))-e,it=B,rt=z,G=e-1,O=V-e,N=t;if(t=new ot(T),P=P||1,at.GRAY===F)if(f=e,l=new lt(V),r)for(g=i[0],_=i[n>>>1]-g,v=r[0],X=r[U>>>1]-v,E=0;E<P;++E){for(D=t,t=N,N=D,p=s=m=h=0;p<e;++p,h+=M,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=K;h<T;h+=M,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[I=(C=G<(C=p+J)?G:C)+(b=O<(b=d+tt)?O:b)]-l[A=C+(y=(y=d+Q)<0?0:y)]-l[R=(x=(x=p+Z)<0?0:x)+b]+l[S=x+y])+_*t[h],q=v*(l[I=(C=G<(C=p+it)?G:C)+(b=O<(b=d+rt)?O:b)]-l[A=C+(y=(y=d+nt)<0?0:y)]-l[R=(x=(x=p+et)<0?0:x)+b]+l[S=x+y])+X*t[h],N[h]=0|(w=a*L+o*q),N[h+1]=0|w,N[h+2]=0|w,N[h+3]=t[h+3]}else for(g=i[0],_=i[n>>>1]-g,E=0;E<P;++E){for(D=t,t=N,N=D,p=s=m=h=0;p<e;p++,h+=M,++m)s+=t[h],l[m]=s;for(s=p=m=0,h=K;h<T;h+=M,++m,++p)e<=p&&(s=p=0),s+=t[h],l[m+f]=l[m]+s;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[I=(C=G<(C=p+J)?G:C)+(b=O<(b=d+tt)?O:b)]-l[A=C+(y=(y=d+Q)<0?0:y)]-l[R=(x=(x=p+Z)<0?0:x)+b]+l[S=x+y])+_*t[h],N[h]=0|(w=a*L+o),N[h+1]=0|w,N[h+2]=0|w,N[h+3]=t[h+3]}else if(f=(e<<1)+e,l=new lt((V<<1)+V),r)for(g=i[0],_=i[n>>>1]-g,v=r[0],X=r[U>>>1]-v,E=0;E<P;++E){for(D=t,t=N,N=D,p=s=u=c=m=h=0;p<e;++p,h+=M,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=K;h<T;h+=M,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[I=((I=(C=G<(C=p+J)?G:C)+(b=O<(b=d+tt)?O:b))<<1)+I]-l[A=((A=C+(y=(y=d+Q)<0?0:y))<<1)+A]-l[R=((R=(x=(x=p+Z)<0?0:x)+b)<<1)+R]+l[S=((S=x+y)<<1)+S])+_*t[h],$=g*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+_*t[h+1],W=g*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+_*t[h+2],q=v*(l[I=((I=(C=G<(C=p+it)?G:C)+(b=O<(b=d+rt)?O:b))<<1)+I]-l[A=((A=C+(y=(y=d+nt)<0?0:y))<<1)+A]-l[R=((R=(x=(x=p+et)<0?0:x)+b)<<1)+R]+l[S=((S=x+y)<<1)+S])+X*t[h],k=a*$+o*(v*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+X*t[h+1]),j=a*W+o*(v*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+X*t[h+2]),N[h]=0|(w=a*L+o*q),N[h+1]=0|k,N[h+2]=0|j,N[h+3]=t[h+3]}else for(g=i[0],_=i[n>>>1]-g,E=0;E<P;++E){for(D=t,t=N,N=D,p=s=u=c=m=h=0;p<e;++p,h+=M,m+=3)s+=t[h],u+=t[h+1],c+=t[h+2],l[m]=s,l[m+1]=u,l[m+2]=c;for(s=u=c=p=m=0,h=K;h<T;h+=M,m+=3,++p)e<=p&&(s=u=c=p=0),s+=t[h],u+=t[h+1],c+=t[h+2],l[m+f]=l[m]+s,l[m+f+1]=l[m+1]+u,l[m+f+2]=l[m+2]+c;for(h=d=p=0;h<T;h+=M,++p)e<=p&&(p=0,d+=e),L=g*(l[I=((I=(C=G<(C=p+J)?G:C)+(b=O<(b=d+tt)?O:b))<<1)+I]-l[A=((A=C+(y=(y=d+Q)<0?0:y))<<1)+A]-l[R=((R=(x=(x=p+Z)<0?0:x)+b)<<1)+R]+l[S=((S=x+y)<<1)+S])+_*t[h],k=a*($=g*(l[I+1]-l[A+1]-l[R+1]+l[S+1])+_*t[h+1])+o,j=a*(W=g*(l[I+2]-l[A+2]-l[R+2]+l[S+2])+_*t[h+2])+o,N[h]=0|(w=a*L+o),N[h+1]=0|k,N[h+2]=0|j,N[h+3]=t[h+3]}return N},t.separable_convolution=L?function(F,t,e,H,n,U,i,r,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I,w,L,E,D=t.length,T=1<<n,M=e-1,G=(D>>>n)-e,z=new P(r),O=0,N=r.length;O<N;O+=2)z[O+1]*=e;for(h=new P(a),O=0,N=a.length;O<N;O+=2)h[O+1]*=e;if(L=2,s=U,u=r,w=B,f=z,c=t,t=new ot(D),at.GRAY===F)for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<D;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=A=R=I=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=M&&0<=v&&v<=G&&(S=s[O],A+=t[x=_+v<<2]*S);c[m]=0|(y=(y=w*A)<0?0:255<y?255:y),c[m+1]=0|y,c[m+2]=0|y,c[m+3]=t[m+3]}s=i,u=a,w=o,f=h}else for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<D;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=A=R=I=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=M&&0<=v&&v<=G&&(S=s[O],A+=t[x=_+v<<2]*S,R+=t[x+1]*S,I+=t[x+2]*S);C=(C=w*R)<0?0:255<C?255:C,b=(b=w*I)<0?0:255<b?255:b,c[m]=0|(y=(y=w*A)<0?0:255<y?255:y),c[m+1]=0|C,c[m+2]=0|b,c[m+3]=t[m+3]}s=i,u=a,w=o,f=h}return c}:function(F,t,e,H,n,U,i,r,a,B,o){for(var l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I,w,L,E,D=t.length,T=1<<n,M=e-1,G=(D>>>n)-e,z=new P(r),O=0,N=r.length;O<N;O+=2)z[O+1]*=e;for(h=new P(a),O=0,N=a.length;O<N;O+=2)h[O+1]*=e;if(L=2,s=U,u=r,w=B,f=z,c=t,t=new ot(D),at.GRAY===F)for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<D;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=A=R=I=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=M&&0<=v&&v<=G&&(S=s[O],A+=t[x=_+v<<2]*S);c[m]=0|(y=w*A),c[m+1]=0|y,c[m+2]=0|y,c[m+3]=t[m+3]}s=i,u=a,w=o,f=h}else for(;L--;){for(E=t,t=c,c=E,l=s.length,N=u.length,m=g=d=0;m<D;m+=T,++d){for(e<=d&&(d=0,g+=e),p=O=A=R=I=0;O<l;++O,p+=2)_=d+f[p],v=g+f[p+1],0<=_&&_<=M&&0<=v&&v<=G&&(S=s[O],A+=t[x=_+v<<2]*S,R+=t[x+1]*S,I+=t[x+2]*S);C=w*R,b=w*I,c[m]=0|(y=w*A),c[m+1]=0|C,c[m+2]=0|b,c[m+3]=t[m+3]}s=i,u=a,w=o,f=h}return c},t.gradient=function(t,e,n,i,r,a,o,l,s,u,c,f){var h,m,p,d,g,_,v,x,y,C,b,S,A=i,R=t.length>>>i,I=e-1,w=n-1,L=1<<i,E=L<<1,D=e<<i,T=new lt(R),M=new lt(R);if(a){for(g=e-2,_=n-2,a=e<<1,S=new lt(R),b=et,p=m=2,d=a;p<_&&!(g<=m&&(m=2,d+=e,_<=++p));++m)v=(h=m+d)<<i,0<i&&0===t[v+3]?S[h]=0:S[h]=b[0]*t[(C=(y=(v+=r)-D)-D)-E]+b[1]*t[C-L]+b[2]*t[C]+b[3]*t[C+L]+b[4]*t[C+E]+b[5]*t[y-E]+b[6]*t[y-L]+b[7]*t[y]+b[8]*t[y+L]+b[9]*t[y+E]+b[10]*t[v-E]+b[11]*t[v-L]+b[12]*t[v]+b[13]*t[v+L]+b[14]*t[v+E]+b[15]*t[(x=v+D)-E]+b[16]*t[x-L]+b[17]*t[x]+b[18]*t[x+L]+b[19]*t[x+E]+b[20]*t[(C=x+D)-E]+b[21]*t[C-L]+b[22]*t[C]+b[23]*t[C+L]+b[24]*t[C+E];L=1,E=2,D=e,r=i=0}else S=t;for(p=m=1,d=e;p<w&&!(I<=m&&(m=1,d+=e,w<=++p));++m)T[h=d+m]=S[(y=(v=(h<<i)+r)-D)+L]-S[y-L]+2*(S[v+L]-S[v-L])+(S[(x=v+D)+L]-S[x-L]),M[h]=S[y-L]-S[x-L]+2*(S[y]-S[x])+(S[y+L]-S[x+L]);return hr(T,M,t,e,n,A,o,l,s,u,c,f)},t.optimum_gradient=hr,t.gradient_glsl=function(){function t(t,e){return n(et[t],!e)}var n=e.Util.GLSL.formatFloat;return{lowpass:["vec4 lowpass(sampler2D img, vec2 pix, vec2 dp) {","   float a = texture2D(img, pix).a;","   if (0.0 == a || 0.0 > pix.x-2.0*dp.x || 0.0 > pix.y-2.0*dp.y || 1.0 < pix.x+2.0*dp.x || 1.0 < pix.y+2.0*dp.y) return vec4(0.0, 0.0, 0.0, a);","   return vec4("+t(0,1)+"*texture2D(img, pix+vec2(-2.0,-2.0)*dp).rgb"+t(1)+"*texture2D(img, pix+vec2(-1.0,-2.0)*dp).rgb"+t(2)+"*texture2D(img, pix+vec2(0.0,-2.0)*dp).rgb"+t(3)+"*texture2D(img, pix+vec2(1.0,-2.0)*dp).rgb"+t(4)+"*texture2D(img, pix+vec2(2.0,-2.0)*dp).rgb"+t(5)+"*texture2D(img, pix+vec2(-2.0,-1.0)*dp).rgb"+t(6)+"*texture2D(img, pix+vec2(-1.0,-1.0)*dp).rgb"+t(7)+"*texture2D(img, pix+vec2(0.0,-1.0)*dp).rgb"+t(8)+"*texture2D(img, pix+vec2(1.0,-1.0)*dp).rgb"+t(9)+"*texture2D(img, pix+vec2(2.0,-1.0)*dp).rgb"+t(10)+"*texture2D(img, pix+vec2(-2.0,0.0)*dp).rgb"+t(11)+"*texture2D(img, pix+vec2(-1.0,0.0)*dp).rgb"+t(12)+"*texture2D(img, pix+vec2(0.0,0.0)*dp).rgb"+t(13)+"*texture2D(img, pix+vec2(1.0,0.0)*dp).rgb"+t(14)+"*texture2D(img, pix+vec2(2.0,0.0)*dp).rgb"+t(15)+"*texture2D(img, pix+vec2(-2.0,1.0)*dp).rgb"+t(16)+"*texture2D(img, pix+vec2(-1.0,1.0)*dp).rgb"+t(17)+"*texture2D(img, pix+vec2(0.0,1.0)*dp).rgb"+t(18)+"*texture2D(img, pix+vec2(1.0,1.0)*dp).rgb"+t(19)+"*texture2D(img, pix+vec2(2.0,1.0)*dp).rgb"+t(20)+"*texture2D(img, pix+vec2(-2.0,2.0)*dp).rgb"+t(21)+"*texture2D(img, pix+vec2(-1.0,2.0)*dp).rgb"+t(22)+"*texture2D(img, pix+vec2(0.0,2.0)*dp).rgb"+t(23)+"*texture2D(img, pix+vec2(1.0,2.0)*dp).rgb"+t(24)+"*texture2D(img, pix+vec2(2.0,2.0)*dp).rgb, a);","}"].join("\n"),gradient:["vec2 sobel_gradient(sampler2D i, vec2 p, vec2 d) {","   if (0.0 > pix.x-d.x || 0.0 > pix.y-d.y || 1.0 < pix.x+d.x || 1.0 < pix.y+d.y) return vec2(0.0);","    return vec2(","    (texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,-1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(1.0,0.0)*d).r-texture2D(i, p+vec2(-1.0,0.0)*d).r)","    +(texture2D(i, p+vec2(1.0,1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    ,","    (texture2D(i, p+vec2(-1.0,-1.0)*d).r-texture2D(i, p+vec2(-1.0,1.0)*d).r)","    +2.0*(texture2D(i, p+vec2(0.0,-1.0)*d).r-texture2D(i, p+vec2(0.0,1.0)*d).r)","    +(texture2D(i, p+vec2(1.0,-1.0)*d).r-texture2D(i, p+vec2(1.0,1.0)*d).r)","    );","}","float gradient_suppressed(sampler2D img, vec2 pix, vec2 dp, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    vec2 g = sobel_gradient(img, pix, dp);","    vec2 gn = sobel_gradient(img, pix+vec2(0.0,-1.0)*dp, dp);","    vec2 gs = sobel_gradient(img, pix+vec2(0.0,1.0)*dp, dp);","    vec2 gw = sobel_gradient(img, pix+vec2(-1.0,0.0)*dp, dp);","    vec2 ge = sobel_gradient(img, pix+vec2(1.0,0.0)*dp, dp);","    vec2 gnw = sobel_gradient(img, pix+vec2(-1.0,-1.0)*dp, dp);","    vec2 gne = sobel_gradient(img, pix+vec2(1.0,-1.0)*dp, dp);","    vec2 gsw = sobel_gradient(img, pix+vec2(-1.0,1.0)*dp, dp);","    vec2 gse = sobel_gradient(img, pix+vec2(1.0,1.0)*dp, dp);","    float gM = length(g);","    float gnM = length(gn);","    float gsM = length(gs);","    float gwM = length(gw);","    float geM = length(ge);","    float gnwM = length(gnw);","    float gneM = length(gne);","    float gswM = length(gsw);","    float gseM = length(gse);","    float gg = 0.0; float tmp;","    if (g.x*g.y <= 0.0)","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gneM - (g.x + g.y) * geM) && tmp > abs(g.y * gswM - (g.x + g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gneM - (g.y + g.x) * gnM) && tmp > abs(g.x * gswM - (g.y + g.x) * gsM))","            {","                gg = 1.0;","            }","        }","    }","    else","    {","        if (abs(g.x) >= abs(g.y))","        {","            tmp = abs(g.x)*gM;","            if (tmp >= abs(g.y * gseM + (g.x - g.y) * geM) && tmp > abs(g.y * gnwM + (g.x - g.y) * gwM))","            {","                gg = 1.0;","            }","        }","        else","        {","            tmp = abs(g.y)*gM;","            if (tmp >= abs(g.x * gseM + (g.y - g.x) * gsM)","                && tmp > abs(g.x * gnwM + (g.y - g.x) * gnM))","            {","                gg = 1.0;","            }","        }","    }","    if (0.0 < gg)","    {","        if (gM >= magnitude_limit)","        {","            gg = magnitude_max;","        }","        else","        {","            gg = magnitude_scale * gM;","        }","    }","    return gg;","}","vec4 gradient(sampler2D img, vec2 pix, vec2 dp, float low, float high, float magnitude_scale, float magnitude_limit, float magnitude_max) {","    float a = texture2D(img, pix).a;","    if (0.0 == a) return vec4(0.0);","    float g = gradient_suppressed(img, pix, dp, magnitude_scale, magnitude_limit, magnitude_max);","    if (g >= high)","        return vec4(vec3(1.0), a);","    else if (g < low)","        return vec4(vec3(0.0), a);","    else if (gradient_suppressed(img, pix+vec2(-1.0,-1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(-1.0,0.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        gl_FragColor = vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(-1.0,1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        gl_FragColor = vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(0.0,-1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(0.0,1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(1.0,-1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(1.0,0.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else if (gradient_suppressed(img, pix+vec2(1.0,1.0), dp, magnitude_scale, magnitude_limit, magnitude_max) >= high)","        return vec4(vec3(1.0), a);","    else","        return vec4(vec3(clamp((g-low)/(high-low)-0.1, 0.0, 0.9)/0.9), a);","}"].join("\n")}},t.sat=function(t,e,n,i,r,a,o,l){for(var s,u,c,f,h,m=t.length,p=e<<i,d=(31&e)<<i,g=32<<i,_=1<<i,v=s=0,x=0,y=r;y<d;y+=_)v+=u=t[y],a[x]=v,s+=(l[x]=u)*u,o[x]=s,++x;for(c=d+r;c<p;c+=g)v+=u=t[y=c],a[x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,v+=u=t[y+=_],a[++x]=v,s+=(l[x]=u)*u,o[x]=s,++x;for(h=1,s=v=x=f=0,d+=p,y=p+r;y<d;y+=_)v+=u=t[y],a[x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++x,++f>=e&&(++h,v=s=f=0);for(c=d+r;c<m;c+=g)v+=u=t[y=c],a[x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++f>=e&&(++h,v=s=f=0),v+=u=t[y+=_],a[++x+e]=a[x]+v,o[x+e]=o[x]+(s+=u*u),l[x+e]=l[x+1-e]+(u+t[x-e<<i])+(1<h?l[x-e-e]:0)+(0<f?l[x-1-e]:0),++x,++f>=e&&(++h,v=s=f=0)},t.histogram=function(t,e,n){e=e||0;for(var i,r=new lt(256),a=t.length,o=0,l=255,s=0,u=0;u<a;u+=4)++r[i=t[u+e]],l=Q(i,l),s=J(i,s);if(n)for(u=0;u<256;)o+=r[u],r[u++]=o,o+=r[u],r[u++]=o,o+=r[u],r[u++]=o,o+=r[u],r[u++]=o;return{bin:r,channel:e,min:l,max:s,total:a>>>2}},nt=M,it=Math,rt=nt.Util.String.trim,O=nt.Util.GLSL||{},st=rt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","attribute vec2 pos;","attribute vec2 uv;","uniform vec2 resolution;","uniform float flipY;","varying vec2 pix;","void main(void) {","vec2 zeroToOne = pos / resolution;","vec2 zeroToTwo = zeroToOne * 2.0;","vec2 clipSpace = zeroToTwo - 1.0;","gl_Position = vec4(clipSpace * vec2(1.0, flipY), 0.0, 1.0);","pix = uv;","}"].join("\n")),G=rt(["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","varying vec2 pix;","uniform sampler2D img;","void main(void) {","gl_FragColor = texture2D(img, pix);","}"].join("\n")),ut=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif"].join("\n"),ct=/\/\*.*?\*\//gim,O.DEFAULT=G,dr.prototype={constructor:dr,id:null,uniform:null,attribute:null,vertexSource:null,fragmentSource:null},O.run=function(t,e,n,i,r,a){g=t,v=r,null==(_=i)&&null==v&&(v=g.selection?(C=g.selection,y=g.width-1,x=g.height-1,b=C[0],S=C[1],A=C[2],R=C[3],y=C[4]?y:1,C=C[4]?x:1,b=+it.floor(b*y),S=+it.floor(S*C),_=(A=+it.floor(A*y))-b+1,(R=+it.floor(R*C))-S+1):(_=g.oCanvas.width,g.oCanvas.height));var o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I,w,L,E=nt.getGL(g,_,v),D=null,T=null,M=e.length,G=[null,null],O=[null,null];if(first=-1,last=-1,fromshader=!1,flipY=!1,E){if(p=function(){Cr(E,s),Cr(E,u),_r(E,D),xr(E,T),_r(E,G[1]),_r(E,G[0]),xr(E,O[0]),xr(E,O[1]),xr(E,c),xr(E,f),f=c=O=G=T=D=u=s=null},d=function(){p(),t.cache={},nt.log("GL context lost on #"+t.id)},E.isContextLost&&E.isContextLost())return d();for(o=0;o<M&&(e[o].shader&&first<0&&(first=o),e[M-1-o].shader&&last<0&&(last=M-1-o),!(0<=first&&0<=last));++o);for(h=t.cache,s=yr(E,new nt.Array32F([0,0,i,0,0,r,0,r,i,0,i,r])),u=yr(E,new nt.Array32F([0,0,1,0,0,1,0,1,1,0,1,1])),E.viewport(0,0,i,r),last>first&&(c=vr(E,i,r),f=vr(E,i,r)),o=0;o<M;++o)if(m=!1,m=(l=e[o]).shader&&(I=E,L=h,w=rt((w=l).shader),L=L[w]||(L[w]=new dr(w,I)))&&L.id?!0:m){if(o+1<M&&e[o+1].shader&&e[o+1]._usesPrev&&(_r(E,G[1]),G[1]=G[0],fromshader?G[0]=br(E,Sr(E,i,r),i,r):G[0]=br(E,n,i,r)),w=o===first?{fbo:null,tex:D=D||br(E,n,i,r,0)}:c,I=o===last?T=T||vr(E,i,r):f,!fromshader&&o>first&&br(E,n,i,r,0,0,w.tex),function(t,e,n,i,r,a,o,l,s,u,c,f){var h,m,p,d=n.iterations||1,g=!1,_=d-1;if(t.isContextLost&&t.isContextLost())return!0;t.useProgram(e.id),"pos"in e.attribute&&(t.enableVertexAttribArray(e.attribute.pos),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(e.attribute.pos,2,t.FLOAT,!1,0,0)),"uv"in e.attribute&&(t.enableVertexAttribArray(e.attribute.uv),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(e.attribute.uv,2,t.FLOAT,!1,0,0)),"resolution"in e.uniform&&t.uniform2f(e.uniform.resolution,i,r),"dp"in e.uniform&&t.uniform2f(e.uniform.dp,1/i,1/r),n.instance&&"mode"in e.uniform&&t.uniform1i(e.uniform.mode,n.instance.mode),"_img_prev_prev"in e.uniform&&u[1]&&(t.activeTexture(t.TEXTURE0+1+1),t.bindTexture(t.TEXTURE_2D,u[1]),t.uniform1i(e.uniform._img_prev_prev,2)),"_img_prev"in e.uniform&&u[0]&&("img"in e.uniform?(t.activeTexture(t.TEXTURE0+1+0),t.bindTexture(t.TEXTURE_2D,u[0]),t.uniform1i(e.uniform._img_prev,1)):l={fbo:null,tex:u[0]}),n.vars&&n.vars(t,i,r,e),n.textures&&n.textures(t,i,r,e),0<_&&(c[0]=c[0]||vr(t,i,r),c[1]=c[1]||vr(t,i,r));for(h=0;h<d;++h){if(t.isContextLost&&t.isContextLost())return!0;p=0===h?l:c[0],h===_?(m=s,g=f):m=c[1],"_img_prev"in e.uniform&&!("img"in e.uniform)?(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,p.tex),t.uniform1i(e.uniform._img_prev,0)):"img"in e.uniform&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,p.tex),t.uniform1i(e.uniform.img,0)),t.uniform1f(e.uniform.flipY,g?-1:1),t.bindFramebuffer(t.FRAMEBUFFER,m.fbo),t.viewport(0,0,i,r),t.drawArrays(t.TRIANGLES,0,6),p=c[0],c[0]=c[1],c[1]=p,g=!1}}(E,L,l,i,r,s,u,w,I,G,O,!1)||E.isContextLost&&E.isContextLost())return d();m=c,c=f,f=m,fromshader=!0}else l.instance&&(l._apply||l.instance._apply)&&(m=fromshader?Sr(E,i,r):n,n=(l._apply?l:l.instance)._apply(m,i,r,a),l.instance.hasMeta&&(null!=l.instance.meta._IMG_WIDTH&&i!==l.instance.meta._IMG_WIDTH||null!=l.instance.meta._IMG_HEIGHT&&r!==l.instance.meta._IMG_HEIGHT)&&(i=l.instance.meta._IMG_WIDTH,r=l.instance.meta._IMG_HEIGHT,nt.setGLDimensions(t,i,r),Cr(E,s),s=yr(E,new nt.Array32F([0,0,i,0,0,r,0,r,i,0,i,r])),E.viewport(0,0,i,r),xr(E,c),xr(E,f),xr(E,O[0]),xr(E,O[1]),O=[null,null],last>first)&&(c=vr(E,i,r),f=vr(E,i,r)),fromshader=!1);return fromshader&&Sr(E,i,r,n),p(),n}},O.uploadTexture=br,O.getPixels=Sr,O.formatFloat=function(t,e){var n=t.toString();return(!e||t<0?"":"+")+n+(-1===n.indexOf(".")?".0":"")},O.formatInt=function(t,e){return t=it.floor(t),(!e||t<0?"":"+")+t.toString()},O.staticSort=function(t,e,n){e=e||"temp",n=n||Ar;for(var i,r,a,o,l,s,u=t.length,c=[],f=1;f<u;f<<=1)for(i=f<<1,r=f;1<=r;r>>>=1)for(a=r<<1,o=r%f;o<=u-1-r;o+=a)for(l=0,s=it.min(r-1,u-o-r-1);l<=s;++l)it.floor((l+o)/i)===it.floor((l+o+r)/i)&&c.push(n(t[l+o],t[l+o+r],e));return c},nt.Util.GLSL=O,u=M,ft="prototype",N=Object[ft],ht=Function[ft],mt=Array[ft],pt=N.hasOwnProperty,dt=Object.keys,N=Math,gt=u.Asynchronous,_t=gt.isPlatform(gt.Platform.NODE),gt.isPlatform(gt.Platform.BROWSER),gt.supportsMultiThreading(),vt=gt.isThread(null,!0),xt=gt.isThread(),bt=u.Path,St=u.Class.Merge,At=u.Util.GLSL,u._notSupportClamp,u.log,Rt=N.min,It=N.max,wt=0,N=u.FilterThread=u.Class(gt,{path:bt,name:null,_listener:null,_rand:null,constructor:function(){var n=this,i=null;vt&&n.initThread().listen("load",function(t){t&&t.filter&&(i&&(i.dispose(!0),i=null),i=gt.load("FILTER."+t.filter))}).listen("import",function(t){t&&t.import&&t.import.length&&gt.importScripts(t.import.join?t.import.join(","):t.import)}).listen("apply",function(t){var e;i&&t&&t.im?((e=t.im)[0]=u.Util.Array.typed(e[0],u.ImArray),t.params&&i.unserializeFilter(t.params),t.inputs&&i.unserializeInputs(t.inputs,e),e=i._apply(e[0],e[1],e[2]),n.send("apply",{im:!!i._update&&e,meta:i.hasMeta?i.metaData(!0):null})):n.send("apply",{im:null})}).listen("dispose",function(t){i&&(i.dispose(!0),i=null),n.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",[t]),e},thread:function(t,e){var n=this;return(t=!!(t=arguments.length?t:!0))&&!n.$thread?(null===n._rand&&(n._rand=_t?"":(-1===n.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),n.fork("FILTER.FilterThread",bt.file!==n.path.file?[bt.file,n.path.file+n._rand]:n.path.file+n._rand),e&&e.length&&n.send("import",{import:e.join?e.join(","):e}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function t(e){t.cb&&t.cb(e)})):!t&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(arguments.length){var t=arguments[0]instanceof Array?arguments[0]:mt.slice.call(arguments);if(t.length){for(var e=[],n=0;n<t.length;++n)e.push(gt.blob("function"==typeof t[n]?ht.toString.call(t[n]):t[n]));this.send("import",{import:e.join(",")})}}return this},scripts:function(){var t;return arguments.length&&(t=arguments[0]instanceof Array?arguments[0]:mt.slice.call(arguments)).length&&this.send("import",{import:t.join(",")}),this}}),Lt=u.Filter=u.Class(N,{name:"Filter",constructor:function(){this.id=++wt,this.inputs={},this.meta=null},_isOn:!0,_isGLSL:!1,_glsl:null,_update:!0,id:null,onComplete:null,mode:0,selection:null,inputs:null,hasInputs:!1,meta:null,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._isGLSL=null,t._update=null,t.onComplete=null,t.mode=null,t.selection=null,t.inputs=null,t.hasInputs=null,t.meta=null,t.hasMeta=null,t._glsl=null,t.$super("dispose"),t},worker:N[ft].thread,getParam:function(t){if(t&&"_"!==t.charAt(0)&&pt.call(this.constructor[ft],t))return this[t]},setParam:function(t,e){return t&&"_"!==t.charAt(0)&&pt.call(this.constructor[ft],t)&&(this[t]=e),this},metaData:function(t,e){return this.meta},getMetaData:function(t,e){return this.metaData(t,e)},setMetaData:function(t,e){return this.meta=t,this},setInput:function(t,e){var n=this;return t=String(t),null===e?n.inputs[t]&&(delete n.inputs[t],n._glsl=null):(n.inputs[t]=[null,e,e.nref],n._glsl=null),n},unsetInput:function(t){return t=String(t),this.inputs[t]&&(delete this.inputs[t],this._glsl=null),this},delInput:null,resetInputs:function(){return this.inputs={},this},input:function(t){t=this.inputs[String(t)];return t&&((null==t[0]||t[1]&&t[2]!==t[1].nref)&&(t[2]=t[1].nref,t[0]=t[1].getSelectedData(1)),t[0])||null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,n,i,r=this.inputs,a=dt(r),o=a.length;if(!o)return null;for(i={},n=0;n<o;++n)(null==(e=r[a[n]])[0]||e[1]&&e[2]!==e[1].nref)&&(e[2]=e[1].nref,i[a[n]]=t===e[1]||e[1].getSelectedData(1));return i},unserializeInputs:function(t,e){if(t&&this.hasInputs)for(var n,i=this.inputs,r=dt(t),a=r.length,o=u.ImArray,l=u.Util.Array.typed,s=0;s<a;++s)(n=t[r[s]])&&(!0===n?n=e:n[0]=l(n[0],o),i[r[s]]=[n,null,0]);return this},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn)&&t.params&&e.unserialize(t.params),e},select:function(t,e,n,i,r){return this.selection=!1===t?null:r?[It(0,t||0),It(0,e||0),It(0,n||0),It(0,i||0),0]:[Rt(1,It(0,t||0)),Rt(1,It(0,e||0)),Rt(1,It(0,n||0)),Rt(1,It(0,i||0)),1],this},deselect:function(){return this.select(!1)},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},isGLSL:function(){return this._isGLSL},update:function(t){return this._update=!!(t=arguments.length?t:!0),this},turnOn:function(t){return this._isOn=!!(t=arguments.length?t:!0),this},toggle:function(){return this._isOn=!this._isOn,this},makeGLSL:function(t){return this._isGLSL=!!(t=arguments.length?t:!0),this},GLSLCode:function(){return null==this._glsl&&(this._glsl=this.getGLSL()),this._glsl},getGLSL:function(){return{instance:this}},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},combineWith:function(t){return this},_apply:function(t,e,n,i){return t},apply_:function(t,e,n,i,r){var a,o=this;return o.canRun()?o.$thread?(o._listener.cb=function(t){o._listener.cb=null,t&&t.im&&(e=u.Util.Array.typed(t.im,u.ImArray)),r(e,o)},o.send("apply",{im:[e,n,i,2],params:o.serializeFilter(),inputs:o.serializeInputs(t)})):(!xt&&o.isGLSL()&&u.supportsGLSL()?(a=o.GLSLCode())&&(a=(a=a.push||a.pop?a:[a]).filter(Ir)).length&&(a=At.run(t,a,e,n,i,{src:t,dst:t}))&&(e=a):e=o._apply(e,n,i,{src:t,dst:t}),r(e,o)):r(e,o),o},apply:function(t,e,n){var i,r,a,o,l,s=this;return s.canRun()&&(arguments.length<3&&(e&&e.setSelectedData?n=null:"function"==typeof e?(n=e,e=t):(e=t,n=null)),t)&&e&&(n=n||s.onComplete,i=t.getSelectedData(),a=i[1],o=i[2],s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMetaData(t.meta,!0),t.im)&&s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(u.Util.Array.typed(t.im,u.ImArray))),n&&n.call(s)},s.send("apply",{im:i,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(!xt&&s.isGLSL()&&u.supportsGLSL()?(l=s.GLSLCode())&&(l=(l=l.push||l.pop?l:[l]).filter(Ir)).length&&(r=At.run(e,l,i[0],a,o,{src:t,dst:e}),s._update)&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),r)&&e.setSelectedData(r):(r=s._apply(i[0],a,o,{src:t,dst:e}),s._update&&(s.hasMeta&&(null!=s.meta._IMG_WIDTH&&a!==s.meta._IMG_WIDTH||null!=s.meta._IMG_HEIGHT&&o!==s.meta._IMG_HEIGHT)&&e.dimensions(s.meta._IMG_WIDTH,s.meta._IMG_HEIGHT),e.setSelectedData(r))),n&&n.call(s))),t},toString:function(){return"[FILTER: "+this.name+"("+this.id+")]"}}),u.Filter[ft].getInput=u.Filter[ft].input,u.Filter[ft].delInput=u.Filter[ft].unsetInput,u.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){for(var e,n=(t=t.split(".")).length,i=u,r=0;r<n;++r){if(!i[e=t[r]])return null;i=i[e]}return i}return u[t]||null},u.Create=function(t){var e,n=(t=St({init:Rr,name:"PluginFilter"},t)).name;return t.constructor=(e=t.init,function t(){if(!(this instanceof t))return arguments.length?(arguments.__arguments__=!0,new t(arguments)):new t;this.$super("constructor"),e.apply(this,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)}),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.metaData&&t.metaData!==Lt[ft].metaData?t.getMetaData=t.metaData:"function"==typeof t.getMetaData&&t.getMetaData!==Lt[ft].getMetaData&&(t.metaData=t.getMetaData),delete t.init,pt.call(t,"apply")&&delete t.apply,u[n]=u.Class(Lt,t)},Et=M,c=Math,Dt=c.sqrt,o=c.round,c.floor,Tt=c.min,Mt=c.max,c.abs,c.sin,c.cos,c.PI,h=Et.Util.Math.clamp,Et.Util.String.esc,Gt=Et.Util.String.trim,Ot=Et.LUMA,Et.CHANNEL,Nt=1/255,Ft=100/255,Ht=2.55,Ut=["#define FORMAT_HWB 3","#define FORMAT_HSV 2","#define FORMAT_HSL 1","vec4 hsl2rgb(float h, float s, float l) {","   float c = (1.0 - abs(2.0*l - 1.0))*s;","   float hp = h/60.0;","   float d = float(floor(hp / 2.0));","   float x = c*(1.0 - abs(hp - 2.0*d - 1.0));","   float m = l - c/2.0;","   vec4 rgb = vec4(0.0,0.0,0.0,1.0);","   if (hp >= 0.0 && hp < 1.0) {","       rgb.r = c + m;","       rgb.g = x + m;","       rgb.b = m;","   } else if (hp >= 1.0 && hp < 2.0) {","       rgb.r = x + m;","       rgb.g = c + m;","       rgb.b = m;","   } else if (hp >= 2.0 && hp < 3.0) {","       rgb.r = m;","       rgb.g = c + m;","       rgb.b = x + m;","   } else if (hp >= 3.0 && hp < 4.0) {","       rgb.r = m;","       rgb.g = x + m;","       rgb.b = c + m;","   } else if (hp >= 4.0 && hp < 5.0) {","       rgb.r = x + m;","       rgb.g = m;","       rgb.b = c + m;","   } else {","       rgb.r = c + m;","       rgb.g = m;","       rgb.b = x + m;","   }","   return clamp(rgb, 0.0, 1.0);","}","vec4 hsv2rgb(float h, float s, float v) {","    float l = v*(1.0 - s/2.0);","    float lm = min(l, 1.0-l);","    if (0.0 == lm) return hsl2rgb(h, 0.0, l);","    else return hsl2rgb(h, (v-l)/lm, l);","}","vec4 hwb2rgb(float h, float w, float b) {","    float b1 = 1.0 - b;","    return hsv2rgb(h, 1.0 - w/b1, b1);","}","vec4 rgb2hslvwb(float r, float g, float b, int type) {","    float xmax = max(r, max(g, b));","    float xmin = min(r, min(g, b));","    float v = xmax;","    float c = xmax - xmin;","    float l = clamp((xmax + xmin)/2.0, 0.0, 1.0);","    float wh = clamp(xmin, 0.0, 1.0);","    float bl = clamp(1.0 - xmax, 0.0, 1.0);","    float h = 0.0;","    if (0.0 == c) {","        h = 0.0;","    } else if (v == r) {","        h = 60.0*((g - b)/c);","    } else if (v == g) {","        h = 60.0*(2.0 + (b - r)/c);","    } else {","        h = 60.0*(4.0 + (r - g)/c);","    }","    h = clamp(h, 0.0, 360.0);","   float sl; float sv;","    if (0.0 == l || 1.0 == l) {","        sl = 0.0;","    } else {","        sl = clamp((v - l)/min(l, 1.0 - l), 0.0, 1.0);","    }","    if (0.0 == v) {","        sv = 0.0;","    } else {","        sv = clamp(c/v, 0.0, 1.0);","    }","    v = clamp(v, 0.0, 1.0);","    if (FORMAT_HWB == type) return vec4(h, wh, bl, 1.0);","    else if (FORMAT_HSV == type) return vec4(h, sv, v, 1.0);","    return vec4(h, sl, l, 1.0);","}","vec4 rgb2hsl(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL);","}","vec4 rgb2hsv(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSV);","}","vec4 rgb2hwb(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HWB);","}","vec4 rgb2cmyk(float r, float g, float b) {","    if (0.0 == r && 0.0 == g && 0.0 == b) {","       return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float c = 1.0 - r;","    float m = 1.0 - g;","    float y = 1.0 - b;","    float minCMY = min(c, min(m, y));","    float invCMY = 1.0 / (1.0 - minCMY);","    return vec4(","        (c - minCMY) * invCMY,","        (m - minCMY) * invCMY,","        (y - minCMY) * invCMY,","        minCMY","    );","}","vec4 cmyk2rgb(float c, float m, float y, float k) {","    if (0.0 == c && 0.0 == m && 0.0 == y) {","        return vec4(0.0, 0.0, 0.0, 1.0);","    }","    float minCMY = k;","    float invCMY = 1.0 - minCMY;","    c = c*invCMY + minCMY;","    m = m*invCMY + minCMY;","    y = y*invCMY + minCMY;","    return vec4(","        1.0 - c,","        1.0 - m,","        1.0 - y,","        1.0","    );","}","vec4 rgb2ycbcr(float r, float g, float b) {","    return clamp(vec4(","    0.0 + 0.299*r    + 0.587*g     + 0.114*b,","    0.5 - 0.168736*r - 0.331264*g  + 0.5*b,","    0.5 + 0.5*r      - 0.418688*g  - 0.081312*b,","    1.0","    ), 0.0, 1.0);","}","vec4 ycbcr2rgb(float y, float cb, float cr) {","    return clamp(vec4(","    y                      + 1.402   * (cr-0.5),","    y - 0.34414 * (cb-0.5) - 0.71414 * (cr-0.5),","    y + 1.772   * (cb-0.5),","    1.0","    ), 0.0, 1.0);","}","float rgb2hue(float r, float g, float b) {","    return rgb2hslvwb(r, g, b, FORMAT_HSL).x;","}","float rgb2sat(float r, float g, float b, int type) {","    return rgb2hslvwb(r, g, b, type).y;","}","float intensity(float r, float g, float b) {","    return clamp("+Ot[0]+"*r + "+Ot[1]+"*g + "+Ot[2]+"*b, 0.0, 1.0);","}"].join("\n"),(m=Et.Color=Et.Class({__static__:{GLSLCode:function(){return Ut},clamp:h,clampPixel:function(t){return Tt(255,Mt(t,0))},color24:function(t,e,n){return(255&t)<<16|(255&e)<<8|255&n},color32:function(t,e,n,i){return(255&i)<<24|(255&t)<<16|(255&e)<<8|255&n},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},rgb24GL:function(t){var e=Et.Util.GLSL.formatFloat;return"vec3("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255)].join(",")+");"},rgba32GL:function(t){var e=Et.Util.GLSL.formatFloat;return"vec4("+[e((t>>>16&255)/255),e((t>>>8&255)/255),e((255&t)/255),e((t>>>24&255)/255)].join(",")+");"},intensity:function(t,e,n){return~~(Ot[0]*t+Ot[1]*e+Ot[2]*n)},hue:function(t,e,n){return t=t,e=e,n=n,i?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),r=i=c.max(t,e,n),a=c.min(t,e,n),h(c.round(0==(i=i-a)?0:r===t?60*(0+(e-n)/i):r===e?60*(2+(n-t)/i):60*(4+(t-e)/i)),0,360);var i,r,a},saturation:function(t,e,n){return 2.55*(t=t,e=e,n=n,(i=!(r="hsv"))?(t/=100,e/=100,n/=100):(t/=255,e/=255,n/=255),a=i=c.max(t,e,n),e=i-(t=c.min(t,e,n)),i=0==(n=(i+t)/2)||1==n?0:(a-n)/c.min(n,1-n),t=0===a?0:e/a,h("hsv"===r?100*t:100*i,0,100));var i,r,a},dist:function(t,e,n,i){var r=t[n+0]-e[i+0],a=t[n+1]-e[i+1],t=t[n+2]-e[i+2];return Dt(r*r+a*a+t*t)},RGB2Gray:function(t,e){var n=Ot[0]*t[e+0]+Ot[1]*t[e+1]+Ot[2]*t[e+2]|0;return t[e+0]=n,t[e+1]=n,t[e+2]=n,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,n){return e[n+0]=(t|=0)>>>16&255,e[n+1]=t>>>8&255,e[n+2]=255&t,e[n+3]=t>>>24&255,e},RGB2XYZ:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=.412453*n+.35758*i+.180423*r|0,t[e+1]=.212671*n+.71516*i+.072169*r|0,t[e+2]=.019334*n+.119193*i+.950227*r|0,t},XYZ2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=3.240479*n-1.53715*i-.498535*r|0,t[e+1]=-.969256*n+1.875992*i+.041556*r|0,t[e+2]=.055648*n-.204043*i+1.057311*r|0,t},RGB2ILL:function(t,e){var n=t[e+0]/255,i=t[e+1]/255,r=t[e+2]/255,a=Math.log,o=.412453*n+.35758*i+.180423*r,l=.212671*n+.71516*i+.072169*r,n=.019334*n+.119193*i+.950227*r,i=a(.9465229*o+.2946927*l-.1313419*n),r=a(-.1179179*o+.992996*l+.007371554*n),a=a(.09230461*o-.04645794*l+.9946464*n);return t[e+0]=27.07439*i-22.80783*r-1.806681*a,t[e+1]=-5.646736*i-7.722125*r+12.86503*a,t[e+2]=-4.163133*i-4.579428*r-4.576049*a,t},ILL2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2],a=Math.exp,o=a(.021547742011105847*n-.021969518919866274*i-.07027206572176435*r),l=a(-.018152109501074376*n-.03004415376911152*i-.07729896865586937*r),a=a(-.0014378861182725712*n+.050053456205559545*i-.07724195758868482*r),n=1.0068824301911365*o-.2924918682640871*l+.13512537828457516*a,i=.12021888110585245*o+.9717816461525606*l+.008672665360769691*a,r=-.08782494811157235*o+.07253363731909634*l+.9932476695469974*a;return t[e+0]=3.240479*n-1.53715*i-.498535*r|0,t[e+1]=-.969256*n+1.875992*i+.041556*r|0,t[e+2]=.055648*n-.204043*i+1.057311*r|0,t},RGB2YCbCr:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=0+.299*n+.587*i+.114*r|0,t[e+1]=128-.168736*n-.331264*i+.5*r|0,t[e+2]=128+.5*n-.418688*i-.081312*r|0,t},YCbCr2RGB:function(t,e){var n=t[e+0],i=t[e+1],r=t[e+2];return t[e+0]=n+1.402*(r-128)|0,t[e+1]=n-.34414*(i-128)-.71414*(r-128)|0,t[e+2]=n+1.772*(i-128)|0,t},RGB2HSV:function(t,e,n){var i=Mr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},RGB2HSL:function(t,e,n){var i=Tr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},RGB2HWB:function(t,e,n){var i=Gr(t[e+0],t[e+1],t[e+2]);return t[e+0]=n?i[0]:255*i[0]/360,t[e+1]=n?i[1]:2.55*i[1],t[e+2]=n?i[2]:2.55*i[2],t},HSV2RGB:function(t,e,n){n=Lr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HSL2RGB:function(t,e,n){n=wr(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},HWB2RGB:function(t,e,n){n=Er(t[e+0]*(n?1:360/255),t[e+1]*(n?1:100/255),t[e+2]*(n?1:100/255));return t[e+0]=n[0],t[e+1]=n[1],t[e+2]=n[2],t},RGB2CMYK:function(t,e){var n,i=t[e+0],r=t[e+1],a=t[e+2];return 0===i&&0===r&&0===a||(n=Tt(i=255-i,r=255-r,a=255-a),t[e+0]=(i-n)*(i=255===n?0:255/(255-n)),t[e+1]=(r-n)*i,t[e+2]=(a-n)*i),t},toString:function(){return"[FILTER: "+this.name+"]"},C2F:Nt,C2P:Ft,P2C:Ht,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*Ft+(e||"")},per2col:function(t){return t*Ht},rgb2hex:function(t,e,n,i,r){return r&&(t=h(o(t*Ht),0,255),e=h(o(e*Ht),0,255),n=h(o(n*Ht),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),i&&t[0]===t[1]&&e[0]===e[1]&&n[0]===n[1]?"#"+t[0]+e[0]+n[0]:"#"+t+e+n},rgb2hexIE:function(t,e,n,i,r){return r&&(t=h(o(t*Ht),0,255),e=h(o(e*Ht),0,255),n=h(o(n*Ht),0,255),i=h(o(i*Ht),0,255)),t=t<16?"0"+t.toString(16):t.toString(16),e=e<16?"0"+e.toString(16):e.toString(16),n=n<16?"0"+n.toString(16):n.toString(16),"#"+(i=i<16?"0"+i.toString(16):i.toString(16))+t+e+n},hex2rgb:function(t){return!t||t.length<3?[0,0,0]:t.length<6?[h(parseInt(t[0]+t[0],16),0,255),h(parseInt(t[1]+t[1],16),0,255),h(parseInt(t[2]+t[2],16),0,255)]:[h(parseInt(t[0]+t[1],16),0,255),h(parseInt(t[2]+t[3],16),0,255),h(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},hsl2rgb:wr,hsv2rgb:Lr,hwb2rgb:Er,rgb2hsl:Tr,rgb2hsv:Mr,rgb2hwb:Gr,rgb2cmyk:Or,cmyk2rgb:Nr,parse:function(t,e,n){var i,r,a,o,l,s,u,c,f=0,h=0;return"hsl"===e||!e&&(i=t.match(m.hslRE))?(c=(a=("hsl"===e?(o="hsla"===t[0].toLowerCase(),t[1]):(f=i[0].length,h=0,o="hsla"===i[1].toLowerCase(),i[2])).split(",").map(Gt))[0]||"0",t=a[1]||"0",l=a[2]||"0",u=o&&null!=a[3]?a[3]:"1",c=parseFloat(c,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*Ft,l="%"===l.slice(-1)?parseFloat(l,10):parseFloat(l,10)*Ft,u=parseFloat(u,10),c=(new m).fromHSL([c,t,l,u]),n?c:[c,0,f+h]):"rgb"===e||!e&&(i=t.match(m.rgbRE))?(l=(a=("rgb"===e?(o="rgba"===t[0].toLowerCase(),t[1]):(f=i[0].length,h=0,o="rgba"===i[1].toLowerCase(),i[2])).split(",").map(Gt))[0]||"0",s=a[1]||"0",r=a[2]||"0",u=o&&null!=a[3]?a[3]:"1",l="%"===l.slice(-1)?2.55*parseFloat(l,10):parseFloat(l,10),s="%"===s.slice(-1)?2.55*parseFloat(s,10):parseFloat(s,10),r="%"===r.slice(-1)?2.55*parseFloat(r,10):parseFloat(r,10),u=parseFloat(u,10),c=(new m).fromRGB([l,s,r,u]),n?c:[c,0,f+h]):"hex"===e||!e&&(i=t.match(m.hexRE))?(o=(a="hex"===e?m.hex2rgb(t[0]):(f=i[0].length,h=0,m.hex2rgb(i[1])))[0]||0,l=a[1]||0,s=a[2]||0,u=null!=a[3]?a[3]:255,c=(new m).fromHEX([o,l,s,u]),n?c:[c,0,f+h]):null},fromString:function(t,e){return m.parse(t,e,1)},fromRGB:function(t){return(new m).fromRGB(t)},fromHSL:function(t){return(new m).fromHSL(t)},fromHSV:function(t){return(new m).fromHSV(t)},fromHWB:function(t){return(new m).fromHWB(t)},fromCMYK:function(t){return(new m).fromCMYK(t)},fromHEX:function(t){return(new m).fromHEX(t)},fromPixel:function(t){return(new m).fromPixel(t)}},constructor:function t(e){if(!(this instanceof t))return new t(e);this.reset(),e&&this.set(e)},name:"Color",col:null,kword:null,clone:function(){var t=new m;return t.col=this.col.slice(),t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.kword=null,this},set:function(t){return t&&(null!=t[0]&&(this.col[0]=h(t[0],0,255)),null!=t[1]&&(this.col[1]=h(t[1],0,255)),null!=t[2]&&(this.col[2]=h(t[2],0,255)),null!=t[3]?this.col[3]=h(t[3],0,1):this.col[3]=1,this.kword=null),this},isTransparent:function(){return this.col[3]<1},fromPixel:function(t){return this.col=[h((t=t||0)>>16&255,0,255),h(t>>8&255,0,255),h(255&t,0,255),h((t>>24&255)*Nt,0,1)],this.kword=null,this},fromHEX:function(t){return this.col[0]=t[0]?h(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?h(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?h(parseInt(t[2],10),0,255):0,this.col[3]=null!=t[3]?h(parseInt(t[3],10)*Nt,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?h(o(t[0]),0,255):0,this.col[1]=t[1]?h(o(t[1]),0,255):0,this.col[2]=t[2]?h(o(t[2]),0,255):0,this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=Nr(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[4]?h(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=wr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHSV:function(t){var e=Lr(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},fromHWB:function(t){var e=Er(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=null!=t[3]?h(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?h(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,n){var i=Or(this.col[0],this.col[1],this.col[2]);return n?i:i.concat(this.col[3])},toHEX:function(t,e,n){return n?m.rgb2hexIE(this.col[0],this.col[1],this.col[2],h(o(255*this.col[3]),0,255)):m.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,n){var i=this.col[3];return t?(e&&(i=i<1&&0<i?i.toString().slice(1):i),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(i).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,n){var i=this.col[3],r=Tr(this.col[0],this.col[1],this.col[2]);return t?(e&&(r[1]=0==r[1]?r[1]:r[1]+"%",r[2]=0==r[2]?r[2]:r[2]+"%",i=i<1&&0<i?i.toString().slice(1):i),n||1==this.col[3]?"hsl("+[r[0],r[1],r[2]].join(",")+")":"hsla("+[r[0],r[1],r[2],i].join(",")+")"):n?r:r.concat(this.col[3])},toString:function(t,e){return"rgb"==(t=t?t.toLowerCase():"hex")||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):this.toHEX(1,!1!==e,"hexie"==t)}})).toGray=m.intensity,r="prototype",p=M,n=p.CHANNEL,p.Color,Bt=p.Util.Array.copy,p.Util.Array.subarray,zt=p.Util.Math.clamp,(Yt=Math).min,g=Yt.floor,Pt=0,n.R,n.G,n.B,n.A,(Xt=p.Image=p.Class({name:"Image",constructor:function t(e){var n=this;if(!(n instanceof t))return new t(e);n.id=++Pt,n.width=0,n.height=0,n.iCanvas=p.Canvas(0,0),n.oCanvas=p.Canvas(0,0),n.domElement=n.oCanvas,n.iData=null,n.iDataSel=null,n.oData=null,n.oDataSel=null,n._restorable=!0,n.gray=!1,n.selection=null,n._refresh=0,n.nref=0,n.cache={},n._refresh|=15,e&&n.image(e)},id:null,width:0,height:0,gray:!1,selection:null,iCanvas:null,oCanvas:null,gl:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_refresh:0,nref:0,cache:null,dispose:function(){var t=this;return p.disposeGL(t),t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.iCanvas=t.oCanvas=t.gl=null,t._restorable=null,t._refresh=t.nref=null,t.cache=null,t},clone:function(t){return new Xt(!0===t?this.iCanvas:this.oCanvas)},grayscale:function(t){return arguments.length?(this.gray=!!t,this):this.gray},restorable:function(t){return this._restorable=!!(t=arguments.length?t:!0),this},apply:function(t,e){return t.apply(this,this,e),this},apply2:function(t,e,n){return t.apply(this,e,n),this},select:function(t,e,n,i,r){var a=this,o=arguments.length;return!1===t?(a.selection=null,a.iDataSel=null,a.oDataSel=null,a._refresh&=-13):(o<1&&(t=0),o<2&&(e=0),o<3&&(n=1),o<4&&(i=1),a.selection=r?[t<0?0:t,e<0?0:e,n<0?0:n,i<0?0:i,0]:[t<0?0:1<t?1:t,e<0?0:1<e?1:e,n<0?0:1<n?1:n,i<0?0:1<i?1:i,1],a._refresh|=12),a.nref=(a.nref+1)%1e3,a},deselect:function(){return this.select(!1)},store:function(){var t=this;return t._restorable&&(t.iCanvas.getContext("2d").drawImage(t.oCanvas,0,0),t._refresh|=1,t.selection&&(t._refresh|=4),t.nref=(t.nref+1)%1e3),t},restore:function(){var t=this;return t._restorable&&(t.oCanvas.getContext("2d").drawImage(t.iCanvas,0,0),t._refresh|=2,t.selection&&(t._refresh|=8),t.nref=(t.nref+1)%1e3),t},dimensions:function(t,e){var n=this;return t===n.width&&e===n.height||(Fr(n,t,e,6),n._refresh|=3,n.selection&&(n._refresh|=12),n.nref=(n.nref+1)%1e3),n},setDimensions:null,scale:function(t,e){var n,i,r=this,a=r.width,o=r.height;return t=t||1,e=e||t,1===t&&1===e||((i=(n=p.Canvas(+a,+o)).getContext("2d")).scale(t,e),a=r.width=Yt.round(t*a),o=r.height=Yt.round(e*o),i.drawImage(r.oCanvas,0,0),r.oCanvas.width=+a,r.oCanvas.height=+o,r.oCanvas.getContext("2d").drawImage(n,0,0),r._restorable&&(i.drawImage(r.iCanvas,0,0),r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.iCanvas.getContext("2d").drawImage(n,0,0)),r._refresh|=3,r.selection&&(r._refresh|=12),r.nref=(r.nref+1)%1e3),r},flipHorizontal:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,n=p.Canvas(e,n),i=n.getContext("2d");return i.translate(e,0),i.scale(-1,1),i.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(n,0,0),t._restorable&&(i.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(n,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},flipVertical:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height,e=p.Canvas(e,n),i=e.getContext("2d");return i.translate(0,n),i.scale(1,-1),i.drawImage(t.oCanvas,0,0),t.oCanvas.getContext("2d").drawImage(e,0,0),t._restorable&&(i.drawImage(t.iCanvas,0,0),t.iCanvas.getContext("2d").drawImage(e,0,0)),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3,t},clear:function(){var t=this,e=t.oCanvas.width,n=t.oCanvas.height;return e&&n&&(t._restorable&&t.iCanvas.getContext("2d").clearRect(0,0,e,n),t.oCanvas.getContext("2d").clearRect(0,0,e,n),t._refresh|=3,t.selection&&(t._refresh|=12),t.nref=(t.nref+1)%1e3),t},crop:function(t,e,n,i){var r,a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height;if(arguments.length)l=n-(a=t)+1,s=i-(o=e)+1;else{if(!c)return u;n=c[4]?(r=f-1,h-1):r=1,a=g(c[0]*r),o=g(c[1]*n),l=g(c[2]*r)-a+1,s=g(c[3]*n)-o+1,c[0]=0,c[1]=0,c[2]=1,c[3]=1,c[4]=1}u.width=l,u.height=s,a*=1,o*=1;t=p.Canvas(l*=1,s*=1),i=t.getContext("2d");return i.drawImage(u.oCanvas,a,o,l,s,0,0,l,s),u.oCanvas.width=l,u.oCanvas.height=s,u.oCanvas.getContext("2d").drawImage(t,0,0),u._restorable&&(i.drawImage(u.iCanvas,a,o,l,s,0,0,l,s),u.iCanvas.width=u.oCanvas.width,u.iCanvas.height=u.oCanvas.height,u.iCanvas.getContext("2d").drawImage(t,0,0)),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},fill:function(t,e,n,i,r){var a,o,l,s,u=this,c=u.selection,f=u.width,h=u.height,f=((i&&!f||r&&!h)&&(Fr(u,e+i,n+r,6),f=u.width,h=u.height),s=c?(s=c[4]?(l=f-1,h-1):l=1,a=g(c[0]*l),o=g(c[1]*s),l=g(c[2]*l)-a+1,g(c[3]*s)-o+1):(o=a=0,l=f,h),null==n&&(n=o),l<(i=null==i?l:i)&&(i=l),s<(r=null==r?s:r)&&(r=s),e=zt(e=null==e?a:e,a,l),n=zt(n,o,s),u.oCanvas.getContext("2d")),h=u.iCanvas.getContext("2d");return e*=1,n*=1,i*=1,r*=1,t=t||0,u._restorable&&(h.fillStyle=t,h.fillRect(e,n,i,r)),f.fillStyle=t,f.fillRect(e,n,i,r),u._refresh|=3,c&&(u._refresh|=12),u.nref=(u.nref+1)%1e3,u},getData:function(t){var e=this,t=e._restorable&&!t?(1&e._refresh&&Hr(e,1),e.iData):(2&e._refresh&&Hr(e,2),e.oData);return Bt(t.data)},getSelectedData:function(t){var e=this,t=e.selection?e._restorable&&!t?(4&e._refresh&&Ur(e,4),e.iDataSel):(8&e._refresh&&Ur(e,8),e.oDataSel):e._restorable&&!t?(1&e._refresh&&Hr(e,1),e.iData):(2&e._refresh&&Hr(e,2),e.oData);return[Bt(t.data),t.width,t.height,2]},setData:function(t){var e=this;return e.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,e.oCanvas.width,e.oCanvas.height),0,0),e._refresh|=2,e.selection&&(e._refresh|=8),e.nref=(e.nref+1)%1e3,e},setSelectedData:function(t){var e,n,i,r,a=this,o=a.selection,l=a.width,s=a.height;return o?(r=o[4]?(i=l-1,s-1):i=1,e=g(o[0]*i),n=g(o[1]*r),i=g(o[2]*i)-e+1,o=g(o[3]*r)-n+1,a.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,i,o),+e,+n)):a.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,+l,+s),0,0),a._refresh|=2,a.selection&&(a._refresh|=8),a.nref=(a.nref+1)%1e3,a},getDataFromSelection:function(t,e,n,i,r){var a=this.width-1,o=this.height-1,a=r?1:a,r=r?1:o;return t=+g(t*a),e=+g(e*r),o=(n=+g(n*a))-t+1,a=(i=+g(i*r))-e+1,n=(n=this.oCanvas.getContext("2d").getImageData(t,e,o,a))||this.oCanvas.getContext("2d").createImageData(0,0,o,a),[Bt(n.data),n.width,n.height,2]},setDataToSelection:function(t,e,n,i,r,a){var o=this,l=o.width-1,s=o.height-1,l=a?1:l,a=a?1:s;return e=+g(e*l),n=+g(n*a),s=(i=+g(i*l))-e+1,l=(r=+g(r*a))-n+1,o.oCanvas.getContext("2d").putImageData(p.Canvas.ImageData(t,s,l),e,n),o._refresh|=2,o.selection&&(o._refresh|=8),o.nref=(o.nref+1)%1e3,o},mapReduce:function(o,l,s){var u=this,c=0,f=0;return o.forEach(function(t,n){var i,r,a,e;t&&t.filter?(i=t.from||{x:0,y:0},r=t.to||{x:u.width-1,y:u.height-1},a=t.absolute,e=u.getDataFromSelection(i.x,i.y,r.x,r.y,a),t.filter.apply_(u,e[0],e[1],e[2],function(t,e){++c,l(u,t,i,r,a,e,n),c+f===o.length&&s&&s(u)})):++f}),f===o.length&&s&&s(u),u},image:function(t){var e,n,i,r,a,o;return t?(e=this,t instanceof Xt&&(t=t.oCanvas),r="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,a=t instanceof e.oCanvas.constructor,o=t instanceof p.Canvas.Image().constructor,i=r?(n=t.videoWidth,t.videoHeight):(n=t.width,t.height),Fr(e,n,i,6),o||a||r?(e._restorable&&e.iCanvas.getContext("2d").drawImage(t,0,0,e.iCanvas.width,e.iCanvas.height),e.oCanvas.getContext("2d").drawImage(t,0,0,e.oCanvas.width,e.oCanvas.height)):(e._restorable&&e.iCanvas.getContext("2d").putImageData(t,0,0),e.oCanvas.getContext("2d").putImageData(t,0,0)),e._refresh|=3,e.selection&&(e._refresh|=12),e.nref=(e.nref+1)%1e3,e):this},setImage:null,toImage:function(n,i){function t(t){var e;"uri"!==i?((e=p.Canvas.Image()).src=t,n(e)):n(t)}var e=this.oCanvas.toDataURL("image/png");"function"==typeof e.then&&"function"==typeof e.catch?e.then(t).catch(function(){}):t(e)},toString:function(){return"[FILTER Image: "+this.name+"("+this.id+")]"}})).load=function(t,e){var n=p.Canvas.Image(),i=new Xt;return"onload"in n&&(n.onload=function(){i.image(n),"function"==typeof e&&e(i)}),n.src=t,i},Xt[r].setImage=Xt[r].image,Xt[r].setDimensions=Xt[r].dimensions,kt=M,Object.prototype,Function.prototype,A=Array.prototype,jt=A.slice,$t=A.splice,Wt=A.push,(A=kt.Create({name:"CompositeFilter",init:function(t){this.filters=t&&t.length?t:[]},path:kt.Path,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this.filters;if(!0===t)for(e=0;e<n.length;++e)n[e]&&n[e].dispose(t),n[e]=null;return this.filters=null,this.$super("dispose"),this},serializeInputs:function(t){for(var e,n=this.filters,i=[],r=!1,a=0,o=n.length;a<o;++a)i.push(e=n[a].serializeInputs(t)),e&&(r=!0);return r?i:null},unserializeInputs:function(t,e){if(t)for(var n=this.filters,i=0,r=n.length;i<r;++i)t[i]&&n[i].unserializeInputs(t[i],e);return this},serialize:function(){for(var t=this.filters,e=[],n=0,i=t.length;n<i;++n)e.push(t[n].serializeFilter());return{_stable:this._stable,filters:e}},unserialize:function(t){var e,n,i,r,a,o=this,l=o.filters;if(o._stable=t._stable,(n=(r=t.filters||[]).length)===(i=l.length)&&o._stable)for(e=0;e<n;++e)l[e].unserializeFilter(r[e]);else{for(e=0;e<i;++e)l[e]&&l[e].dispose(!0),l[e]=null;for(l=[],e=0;e<n;++e){if(!(a=r[e]&&r[e].filter?kt.Filter.get(r[e].filter):null))throw new Error('Filter "'+r[e].filter+'" could not be created');l.push((new a).unserializeFilter(r[e]))}o.filters=l}return o},setMetaData:function(t,e){var n,i,r=this.filters;if(t&&t.filters&&(i=t.filters.length)&&r.length)for(n=0;n<i;++n)r[t.filters[n][0]].setMetaData(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(this.meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},this.hasMeta=!0),this},stable:function(t){return this._stable=!!(t=arguments.length?t:!0),this},set:function(t){return t&&t.length&&(this.filters=t),this._glsl=null,this},filter:function(t,e){return 1<arguments.length?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this._glsl=null,this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&Wt.apply(this.filters,arguments),this._glsl=null,this},concat:null,pop:function(){return this._glsl=null,this.filters.pop()},shift:function(){return this._glsl=null,this.filters.shift()},unshift:function(){return arguments.length&&$t.apply(this.filters,Wt.apply([0,0],arguments)),this._glsl=null,this},insertAt:function(t){var e=jt.call(arguments);e.length;return 1<argslen&&(e.shift(),$t.apply(this.filters,[t,0].concat(e)),this._glsl=null),this},removeAt:function(t){return this._glsl=null,this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;0<=--e;)t===this.filters[e]&&this.filters.splice(e,1);return this._glsl=null,this},reset:function(){return this.filters.length=0,this._glsl=null,this},empty:null,GLSLCode:function(){for(var t,e,n=this.filters,i=[],r=n.length,a=0;a<r;++a)(t=n[a])&&((e=t.GLSLCode())?e.push?i.push.apply(i,e):i.push(e):t._apply&&i.push({instance:t}));return i},_apply:function(t,e,n,i){var r=this,a=null,o=0,l=null,s=null;if(r.filters.length){i=i||{};for(var u,c=r.filters,f=c.length,a=new Array(f),h=0;h<f;++h)(u=c[h])&&u._isOn&&(i.container=r,i.index=h,t=u._apply(t,e,n,i),u.hasMeta)&&(a[o++]=[h,u=u.metaData()],null!=u._IMG_WIDTH)&&(l=e=u._IMG_WIDTH,s=n=u._IMG_HEIGHT)}return 0<o?(a.length>o&&(a.length=o),r.hasMeta=!0,r.meta={filters:a},null!=l&&(r.meta._IMG_WIDTH=l,r.meta._IMG_HEIGHT=s)):(r.hasMeta=!1,r.meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){for(var t=this.filters,e=[],n=t.length,i=0;i<n;++i)e.push("\t"+t[i].toString().split("\n").join("\n\t"));return["[FILTER: "+this.name+"]","[",e.join("\n"),"]",""].join("\n")}})).prototype.get=A.prototype.filter,A.prototype.empty=A.prototype.reset,A.prototype.concat=A.prototype.push,kt.CompositionFilter=kt.CompositeFilter,I=M,qt=I.Util.Array.copy,Vt=I.Util.GLSL,Kt=Math,Zt=Kt.min,Qt=Kt.round,Jt=I._notSupportClamp,te=I.Color.clampPixel,I.Create({name:"BlendFilter",init:function(t){this.set(t)},path:I.Path,matrix:null,hasInputs:!0,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=t.matrix,this},set:function(t){return t&&t.length&&(this.matrix=t),this._glsl=null,this},setInputValues:function(t,e){var n=this.matrix;return e&&(n=n||(this.matrix=["normal",0,0,1]),t=4*(t-1),null!=e.mode&&(n[t]=e.mode||"normal"),null!=e.startX&&(n[1+t]=+e.startX),null!=e.startY&&(n[2+t]=+e.startY),null!=e.enabled)&&(n[3+t]=!!e.enabled),this},reset:function(){return this.matrix=null,this.resetInputs(),this._glsl=null,this},getGLSL:function(){var u=this;if(!u.matrix||!u.matrix.length)return{instance:u,shader:Vt.DEFAULT};var t,e,n,c=["NORMAL","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLORDODGE","COLORBURN","HARDLIGHT","SOFTLIGHT","DIFFERENCE","EXCLUSION","AVERAGE","LINEARDODGE","LINEARBURN","NEGATION","LINEARLIGHT"],i=u.matrix,r="",a="";for(e=1,t=0;t<i.length;t+=4,++e)r+=(r.length?"\n":"")+"uniform sampler2D input"+e+";\nuniform vec2 inputSize"+e+";\nuniform int inputMode"+e+";\nuniform vec2 inputStart"+e+";\nuniform int inputEnabled"+e+";",a+=(a.length?"\n":"")+"col = doblend(col, pix, input"+e+", inputSize"+e+", inputStart"+e+", inputMode"+e+", inputEnabled"+e+");";return n=[c.map(function(t,e){return"LINEARDODGE"===t?"#define LINEARDODGE "+e+"\n#define ADD "+e:"LINEARBURN"===t?"#define LINEARBURN "+e+"\n#define SUBTRACT "+e:"#define "+t+" "+e}).join("\n"),Object.keys(ne).map(function(t){return ne[t]}).join("\n"),"float blend(int mode, float Dca, float Da, float Sca, float Sa) {","    if (MULTIPLY == mode) return multiply(Dca, Da, Sca, Sa);","    else if (SCREEN == mode) return screen(Dca, Da, Sca, Sa);","    else if (OVERLAY == mode) return overlay(Dca, Da, Sca, Sa);","    else if (DARKEN == mode) return darken(Dca, Da, Sca, Sa);","    else if (LIGHTEN == mode) return lighten(Dca, Da, Sca, Sa);","    else if (COLORDODGE == mode) return colordodge(Dca, Da, Sca, Sa);","    else if (COLORBURN == mode) return colorburn(Dca, Da, Sca, Sa);","    else if (HARDLIGHT == mode) return hardlight(Dca, Da, Sca, Sa);","    else if (SOFTLIGHT == mode) return softlight(Dca, Da, Sca, Sa);","    else if (DIFFERENCE == mode) return difference(Dca, Da, Sca, Sa);","    else if (EXCLUSION == mode) return exclusion(Dca, Da, Sca, Sa);","    else if (AVERAGE == mode) return average(Dca, Da, Sca, Sa);","    else if (LINEARDODGE == mode) return lineardodge(Dca, Da, Sca, Sa);","    else if (LINEARBURN == mode) return linearburn(Dca, Da, Sca, Sa);","    else if (NEGATION == mode) return negation(Dca, Da, Sca, Sa);","    else if (LINEARLIGHT == mode) return linearlight(Dca, Da, Sca, Sa);","    return normal(Dca, Da, Sca, Sa);","}","vec4 doblend(vec4 B, vec2 pix, sampler2D Atex, vec2 size, vec2 start, int mode, int enabled) {","    if (0 == enabled || pix.x < start.x || pix.y < start.y || pix.x > start.x+size.x || pix.y > start.y+size.y) return B;","    vec4 A = texture2D(Atex, (pix-start)/size);","    float a = 1.0;","    if (NORMAL != mode) a = clamp(A.a + B.a - A.a*B.a, 0.0, 1.0);","    else a = clamp(A.a + B.a*(1.0 - A.a), 0.0, 1.0);","    if (0.0 < a) return vec4(","        clamp(blend(mode, B.r*B.a, B.a, A.r*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.g*B.a, B.a, A.g*A.a, A.a)/a, 0.0, 1.0),","        clamp(blend(mode, B.b*B.a, B.a, A.b*A.a, A.a)/a, 0.0, 1.0),","        a","    );","    return vec4(0.0);","}","varying vec2 pix;","uniform sampler2D img;",r,"void main(void) {","vec4 col = texture2D(img, pix);",a,"gl_FragColor = col;","}"].join("\n"),{instance:u,shader:n,textures:function(t,e,n,i){for(var r,a=u.matrix,o=1,l=0;l<a.length;l+=4,++o)r=u.input(o),Vt.uploadTexture(t,r[0],r[1],r[2],o)},vars:function(t,e,n,i){for(var r,a=u.matrix,o={ADD:"LINEARDODGE",SUBTRACT:"LINEARBURN"},l=1,s=0;s<a.length;s+=4,++l)r=u.input(l),t.uniform1i(i.uniform["input"+l],l),t.uniform2f(i.uniform["inputSize"+l],r[1]/e,r[2]/n),o[r=(a[s]||"normal").toUpperCase().replace("-","")]&&(r=o[r]),t.uniform1i(i.uniform["inputMode"+l],c.indexOf(r)),t.uniform2f(i.uniform["inputStart"+l],a[s+1]/e,a[s+2]/n),t.uniform1i(i.uniform["inputEnabled"+l],a[s+3]?1:0)}}},_apply:function(t,e,n){var i=this.matrix;if(!i||!i.length)return t;for(var r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I,w,L,E,D,T,M,G,F=i.length,O=(t.length,qt(t)),N=0,H=1;N<F;N+=4,++H)if(i[N+3]&&(A=i[N]||"normal",S=ee[A])&&(p=this.input(H))&&(h=p[0],m=p[1],p=p[2],(o=i[N+1]||0)<(u=s=0)&&(s=-o,o=0),(l=i[N+2]||0)<0&&(u=-l,l=0),!(e<=o||n<=l||m<=s||p<=u||(o=Qt(o),l=Qt(l),s=Qt(s),u=Qt(u),c=Zt(e-o,m-s),f=Zt(n-l,p-u),c<=0)||f<=0)))if(y=l*e,b=u*m,d=(x=o)+c,g=(C=s)+c,Jt)for(_=0,v=f*c;_<v;++_)R=O[r=x+y<<2],I=O[r+1],w=O[r+2],L=O[r+3]/255,E=h[a=C+b<<2],D=h[a+1],T=h[a+2],M=h[a+3]/255,0<(G="normal"!==A?M+L-M*L:M+L*(1-M))?(O[r]=te(Qt(255*S(L*R/255,L,M*E/255,M)/G)),O[r+1]=te(Qt(255*S(L*I/255,L,M*D/255,M)/G)),O[r+2]=te(Qt(255*S(L*w/255,L,M*T/255,M)/G)),O[r+3]=te(Qt(255*G))):(O[r]=0,O[r+1]=0,O[r+2]=0,O[r+3]=0),++x>=d&&(x=o,y+=e),++C>=g&&(C=s,b+=m);else for(_=0,v=f*c;_<v;++_)R=O[r=x+y<<2],I=O[r+1],w=O[r+2],L=O[r+3]/255,E=h[a=C+b<<2],D=h[a+1],T=h[a+2],M=h[a+3]/255,0<(G="normal"!==A?M+L-M*L:M+L*(1-M))?(O[r]=Qt(255*S(L*R/255,L,M*E/255,M)/G),O[r+1]=Qt(255*S(L*I/255,L,M*D/255,M)/G),O[r+2]=Qt(255*S(L*w/255,L,M*T/255,M)/G),O[r+3]=Qt(255*G)):(O[r]=0,O[r+1]=0,O[r+2]=0,O[r+3]=0),++x>=d&&(x=o,y+=e),++C>=g&&(C=s,b+=m);return O}}),I.CombineFilter=I.BlendFilter,(ee=I.Color.Blend={normal:function(t,e,n,i){return n+t*(1-i)},multiply:function(t,e,n,i){return n*t+n*(1-e)+t*(1-i)},screen:function(t,e,n,i){return n+t-n*t},overlay:function(t,e,n,i){return 2*t<=e?2*n*t+n*(1-e)+t*(1-i):n*(1+e)+t*(1+i)-2*t*n-e*i},darken:function(t,e,n,i){return Kt.min(n*e,t*i)+n*(1-e)+t*(1-i)},lighten:function(t,e,n,i){return Kt.max(n*e,t*i)+n*(1-e)+t*(1-i)},"color-dodge":function(t,e,n,i){return n===i&&0===t?n*(1-e):n===i?i*e+n*(1-e)+t*(1-i):i*e*Kt.min(1,t/e*i/(i-n))+n*(1-e)+t*(1-i)},"color-burn":function(t,e,n,i){return 0===n&&t===e?i*e+t*(1-i):0===n?t*(1-i):i*e*(1-Kt.min(1,(1-(e?t/e:0))*i/n))+n*(1-e)+t*(1-i)},"hard-light":function(t,e,n,i){return 2*n<=i?2*n*t+n*(1-e)+t*(1-i):n*(1+e)+t*(1+i)-i*e-2*n*t},"soft-light":function(t,e,n,i){var r=e?t/e:0;return 2*n<=i?t*(i+(2*n-i)*(1-r))+n*(1-e)+t*(1-i):i<2*n&&4*t<=e?e*(2*n-i)*(16*Kt.pow(r,3)-12*Kt.pow(r,2)-3*r)+n-n*e+t:e*(2*n-i)*(Kt.pow(r,.5)-r)+n-n*e+t},difference:function(t,e,n,i){return n+t-2*Kt.min(n*e,t*i)},exclusion:function(t,e,n,i){return n*e+t*i-2*n*t+n*(1-e)+t*(1-i)},average:function(t,e,n,i){return(n+t)/2},add:function(t,e,n,i){return Kt.min(1,n+t)},subtract:function(t,e,n,i){return Kt.max(0,t+n-1)},negation:function(t,e,n,i){return 1-Kt.abs(1-n-t)},"linear-light":function(t,e,n,i){return n<.5?ee.subtract(t,e,2*n,i):ee.add(t,e,2*(1-n),i)}})["linear-dodge"]=ee.add,ee["linear-burn"]=ee.subtract,ne={normal:"float normal(float Dca, float Da, float Sca, float Sa){return Sca + Dca * (1.0 - Sa);}",multiply:"float multiply(float Dca, float Da, float Sca, float Sa){return Sca*Dca + Sca*(1.0 - Da) + Dca*(1.0 - Sa);}",screen:"float screen(float Dca, float Da, float Sca, float Sa){return Sca + Dca - Sca * Dca;}",overlay:"float overlay(float Dca, float Da, float Sca, float Sa){if (2.0*Dca <= Da) return (2.0*Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - 2.0 * Dca * Sca - Da * Sa);}",darken:"float darken(float Dca, float Da, float Sca, float Sa){return min(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",lighten:"float lighten(float Dca, float Da, float Sca, float Sa){return max(Sca * Da, Dca * Sa) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}","color-dodge":"float colordodge(float Dca, float Da, float Sca, float Sa){if (Sca == Sa && 0.0 == Dca) return (Sca * (1.0 - Da)); else if (Sca == Sa) return (Sa * Da + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sa * Da * min(1.0, Dca/Da * Sa/(Sa - Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","color-burn":"float colorburn(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (0.0 == Sca && Dca == Da) return (Sa * Da + Dca * (1.0 - Sa)); else if (0.0 == Sca) return (Dca * (1.0 - Sa)); else return (Sa * Da * (1.0 - min(1.0, (1.0 - m) * Sa/Sca)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa));}","hard-light":"float hardlight(float Dca, float Da, float Sca, float Sa){if (2.0 * Sca <= Sa) return (2.0 * Sca * Dca + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else return (Sca * (1.0 + Da) + Dca * (1.0 + Sa) - Sa * Da - 2.0 * Sca * Dca);}","soft-light":"float softlight(float Dca, float Da, float Sca, float Sa){float m = 0.0; if (0.0 != Da) m = Dca/Da; if (2.0 * Sca <= Sa) return (Dca * (Sa + (2.0 * Sca - Sa) * (1.0 - m)) + Sca * (1.0 - Da) + Dca * (1.0 - Sa)); else if (2.0 * Sca > Sa && 4.0 * Dca <= Da) return (Da * (2.0 * Sca - Sa) * (16.0 * pow(m, 3.0) - 12.0 * pow(m, 2.0) - 3.0 * m) + Sca - Sca * Da + Dca); else return (Da * (2.0 * Sca - Sa) * (pow(m, 0.5) - m) + Sca - Sca * Da + Dca);}",difference:"float difference(float Dca, float Da, float Sca, float Sa){return Sca + Dca - 2.0 * min(Sca * Da, Dca * Sa);}",exclusion:"float exclusion(float Dca, float Da, float Sca, float Sa){return (Sca * Da + Dca * Sa - 2.0 * Sca * Dca) + Sca * (1.0 - Da) + Dca * (1.0 - Sa);}",average:"float average(float Dca, float Da, float Sca, float Sa){return (Sca + Dca) / 2.0;}",add:"float lineardodge(float Dca, float Da, float Sca, float Sa){return min(1.0, Sca + Dca);}",subtract:"float linearburn(float Dca, float Da, float Sca, float Sa){return max(0.0, Dca + Sca - 1.0);}",negation:"float negation(float Dca, float Da, float Sca, float Sa){return 1.0 - abs(1.0 - Sca - Dca);}","linear-light":"float linearlight(float Dca, float Da, float Sca, float Sa){if (Sca < 0.5) return linearburn(Dca, Da, 2.0*Sca, Sa); else return lineardodge(Dca, Da, 2.0*(1.0 - Sca), Sa);}"},ie=M,_=Math,re=ie.Util.Image.crop,ae=ie.Util.Image.pad,oe=ie.Util.Image.interpolate,ie.Create({name:"DimensionFilter",init:function(t,e,n,i,r){this.set(t,e,n,i,r)},path:ie.Path,mode:null,a:0,b:0,c:0,d:0,meta:null,hasMeta:!1,dispose:function(){return this.mode=null,this.$super("dispose"),this},serialize:function(){var t=this;return{mode:t.mode,a:t.a,b:t.b,c:t.c,d:t.d}},unserialize:function(t){return this.set(t.mode,t.a,t.b,t.c,t.d),this},metaData:function(t){return this.meta},setMetaData:function(t,e){return this},set:function(t,e,n,i,r){var a=this;return t?(a.mode=String(t||"scale").toLowerCase(),a.a=e||0,a.b=n||0,a.c=i||0,a.d=r||0):(a.mode=null,a.a=0,a.b=0,a.c=0,a.d=0),a},reset:function(){return this.set(null)},_apply:function(t,e,n,i){var r=this,a=r.mode,o=r.a,l=r.b,s=r.c,u=r.d;if(r.meta=null,r.hasMeta=!1,a)switch(a){case"set":l=s&&u?(o=_.round(s*e),_.round(u*n)):(o=_.round(o),_.round(l)),t=new ie.ImArray(o*l<<2),r.meta={_IMG_WIDTH:o,_IMG_HEIGHT:l},r.hasMeta=!0;break;case"pad":o=_.round(o),l=_.round(l),s=_.round(s),u=_.round(u),t=ae(t,e,n,s,u,o,l),r.meta={_IMG_WIDTH:l+u+n,_IMG_HEIGHT:o+s+e},r.hasMeta=!0;break;case"crop":o=_.round(o),l=_.round(l),s=_.round(s),u=_.round(u),t=re(t,e,n,o,l,o+s-1,l+u-1),r.meta={_IMG_WIDTH:s,_IMG_HEIGHT:u},r.hasMeta=!0;break;default:l=s&&u?(o=_.round(s*e),_.round(u*n)):(o=_.round(o),_.round(l)),t=oe(t,e,n,o,l),r.meta={_IMG_WIDTH:o,_IMG_HEIGHT:l},r.hasMeta=!0}return t}}),v=(le=M).CHANNEL,se=le.ColorTable,ue=le.Color.clampPixel,(L=Math).floor,ce=L.pow,fe=L.exp,he=1/255,me=le.Util.Array.typed,x=le.Util.Filter.ct_eye,pe=le.Util.Filter.ct_multiply,de=le.Util.GLSL,(L=le.Create({name:"ColorTableFilter",init:function(t,e,n,i){var r=this;r.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,i=i||null,r.table[v.R]=t,r.table[v.G]=e,r.table[v.B]=n,r.table[v.A]=i},path:le.Path,table:null,img:null,dispose:function(){return this.table=null,this.img=null,this.$super("dispose"),this},serialize:function(){return{tableR:this.table[v.R],tableG:this.table[v.G],tableB:this.table[v.B],tableA:this.table[v.A]}},unserialize:function(t){var e=this;return e.table[v.R]=me(t.tableR,se),e.table[v.G]=me(t.tableG,se),e.table[v.B]=me(t.tableB,se),e.table[v.A]=me(t.tableA,se),e},functional:function(t,e,n){return"function"!=typeof t?this:(t=x(t),e=e?x(e):t,n=n?x(n):e,this.set(t,e,n))},channel:function(t){if(null==t)return this;var e,n,i;switch(t||v.R){case v.B:e=x(0,0),n=x(0,0),i=x();break;case v.G:e=x(0,0),n=x(),i=x(0,0);break;default:v.R;e=x(),n=x(0,0),i=x(0,0)}return this.set(e,n,i)},redChannel:function(){return this.channel(v.R)},greenChannel:function(){return this.channel(v.G)},blueChannel:function(){return this.channel(v.B)},channelInvert:function(t){if(null==t)return this;var e,n,i;switch(t||v.R){case v.B:e=x(),n=x(),i=x(-1,255);break;case v.G:e=x(),n=x(-1,255),i=x();break;default:v.R;e=x(-1,255),n=x(),i=x()}return this.set(e,n,i)},redInvert:function(){return this.channelInvert(v.R)},greenInvert:function(){return this.channelInvert(v.G)},blueInvert:function(){return this.channelInvert(v.B)},invert:function(){return this.set(le.Util.Filter.ct_eye(-1,255))},thresholds:function(t,e,n){for(var i,r=(t=t.length?t:[t]).length,a=r+1,o=(e=e||t).length,l=o+1,s=(n=n||e).length,u=s+1,c=new se(256),f=new se(a),h=new se(256),m=new se(l),p=new se(256),d=new se(u),g=255/(a-1),_=255/(l-1),v=255/(u-1),x=0;x<a;++x)f[x]=g*x|0;for(t[0]=255*t[0]|0,x=1;x<r;++x)t[x]=t[x-1]+255*t[x]|0;for(x=0;x<l;++x)m[x]=_*x|0;for(e[0]=255*e[0]|0,x=1;x<o;++x)e[x]=e[x-1]+255*e[x]|0;for(x=0;x<u;++x)d[x]=v*x|0;for(n[0]=255*n[0]|0,x=1;x<s;++x)n[x]=n[x-1]+255*n[x]|0;for(x=0;x<256;++x){for(i=0;i<r&&x>t[i];)++i;for(c[x]=ue(f[i]),i=0;i<o&&x>e[i];)++i;for(h[x]=ue(m[i]),i=0;i<s&&x>n[i];)++i;p[x]=ue(d[i])}return this.set(c,h,p)},threshold:function(t,e,n){return this.thresholds([t=null==t?.5:t],[e=null==e?t:e],[n=null==n?e:n])},quantize:function(t){for(var e=new se(t=(t=null==t?64:t)<2?2:t),n=255/(t-1),i=t/256,r=0;r<t;++r)e[r]=0|ue(n*r);return this.set(x(function(t){return e[i*t|0]}))},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(e,t){return null==e&&(e=.5),t=-1===(t=null==t?1:t)?(e*=256,function(t){return e<t?255-t:t}):(2===t&&(e=1-e),function(t){t=2*t/255;return t<e?255-255*t:255*t-255}),this.set(x(t))},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=t>>>16&255,n=t>>>8&255,i=255&t;return this.set(x(function(t){return t&e}),x(function(t){return t&n}),x(function(t){return t&i}))},replace:function(t,e){var n,i,r;return t==e?this:(n=x(),i=x(),r=x(),n[t>>>16&255]=e>>>16&255,i[t>>>8&255]=e>>>8&255,r[255&t]=255&e,this.set(n,i,r))},extract:function(t,e,n){if(!e||!e.length)return this;var i=x(0,(n=n||0)>>>16&255),r=x(0,n>>>8&255),a=x(0,255&n);switch(t||v.R){case v.B:for(s=e[0],f=e[1];s<=f;++s)a[s]=ue(s);break;case v.G:for(s=e[0],f=e[1];s<=f;++s)r[s]=ue(s);break;default:v.R;for(s=e[0],f=e[1];s<=f;++s)i[s]=ue(s)}return this.set(i,r,a)},gammaCorrection:function(e,n,i){return e=e||1,n=n||e,i=i||n,e=1/e,n=1/n,i=1/i,this.set(x(function(t){return 255*ce(he*t,e)}),x(function(t){return 255*ce(he*t,n)}),x(function(t){return 255*ce(he*t,i)}))},exposure:function(e){return null==e&&(e=1),this.set(x(function(t){return 255*(1-fe(-e*t*he))}))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),e+=1,n+=1,this.set(x(t+=1,128*(1-t)),x(e,128*(1-e)),x(n,128*(1-n)))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(x(1,t),x(1,e),x(1,n))},quickContrastCorrection:function(t){return this.set(x(null==t?1.2:+t))},set:function(t,e,n,i){var r,a,o,l,s=this;return t&&(a=(r=s.table)[v.R]||x(),e||n?(e=e||t,n=n||e,o=r[v.G]||a,l=r[v.B]||o,r[v.R]=pe(t,a),r[v.G]=pe(e,o),r[v.B]=pe(n,l)):(r[v.R]=pe(t,a),r[v.G]=r[v.R],r[v.B]=r[v.R]),s.img=null,s._glsl=null),s},reset:function(){return this.table=[null,null,null,null],this.img=null,this._glsl=null,this},getGLSL:function(){return(r=this).table&&r.table[v.R]?{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform int hasAlpha;","void main(void) {","   vec4 col = texture2D(img, pix);","   if (1 == hasAlpha) gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,texture2D(map, vec2(col.a, 0.0)).a);","   else gl_FragColor = vec4(texture2D(map, vec2(col.r, 0.0)).r,texture2D(map, vec2(col.g, 0.0)).g,texture2D(map, vec2(col.b, 0.0)).b,col.a);","}"].join("\n"),textures:function(t,e,n,i){de.uploadTexture(t,r.getImage(),256,1,1)},vars:function(t,e,n,i){t.uniform1i(i.uniform.map,1),t.uniform1i(i.uniform.hasAlpha,r.table[v.A]?1:0)}}:{instance:r,shader:de.DEFAULT};var r},combineWith:function(t){return this.set(t.getTable(v.R),t.getTable(v.G),t.getTable(v.B))},getTable:function(t){return this.table[t||v.R]||null},setTable:function(t,e){return this.table[e||v.R]=t||null,this.img=null,this},getImage:function(){var t=this.table;if(t&&t[v.R]&&!this.img){for(var e=t[v.R],n=t[v.G]||e,i=t[v.B]||n,r=t[v.A],a=new le.Array8U(1024),o=0,l=0;o<1024;o+=4,++l)a[o]=e[l],a[o+1]=n[l],a[o+2]=i[l],a[o+3]=r?r[l]:255;this.img=a}return this.img},_apply:function(t,e,n){var i=this.table;if(i&&i[v.R]){var r,a,o=t.length,l=(15&o>>>2)<<2,s=i[0],u=i[1],c=i[2],f=i[3];if(f){for(r=0;r<l;r+=4)t[r]=s[t[r]],t[r+1]=u[t[r+1]],t[r+2]=c[t[r+2]],t[r+3]=f[t[r+3]];for(a=l;a<o;a+=64)t[r=a]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]],t[r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[r]=f[t[r++]]}else{for(r=0;r<l;r+=4)t[r]=s[t[r]],t[r+1]=u[t[r+1]],t[r+2]=c[t[r+2]];for(a=l;a<o;a+=64)t[r=a]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],t[++r]=s[t[r++]],t[r]=u[t[r++]],t[r]=c[t[r++]],++r}}return t},canRun:function(){return this._isOn&&this.table&&this.table[v.R]}})).prototype.posterize=L.prototype.levels=L.prototype.quantize,le.TableLookupFilter=le.ColorTableFilter,y=(l=M).CHANNEL,ge=l.ColorMatrix,_e=l.Array8U,t=Math,ve=t.sin,xe=t.cos,ye=l.CONST.toRad,l.CONST.toDeg,Ce=l.Util.Array.typed,t=l._notSupportClamp,C=l.Util.Filter.cm_rechannel,be=l.Util.Filter.cm_combine,Se=l.Util.Filter.cm_multiply,Ae=l.Util.GLSL,(t=l.Create({name:"ColorMatrixFilter",init:function(t){this.matrix=t&&t.length?new ge(t):null},path:l.Path,matrix:null,dispose:function(){return this.matrix=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix}},unserialize:function(t){return this.matrix=Ce(t.matrix,ge),this},channel:function(t,e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],e=y.A===(t=t||0)||e?1:0;return n[5*y.R+t]=y.R===t?1:e,n[5*y.G+t]=y.G===t?1:e,n[5*y.B+t]=y.B===t?1:e,this.set(n)},redChannel:function(t){return this.channel(y.R,t)},greenChannel:function(t){return this.channel(y.G,t)},blueChannel:function(t){return this.channel(y.B,t)},alphaChannel:function(t){return this.channel(y.A,!0)},maskChannel:function(t){var e;return y.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,this.set(e))},swapChannels:function(t,e){var n;return t===e?this:((n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n))},invertChannel:function(t){var e;return y.A===(t=t||0)?this:((e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])[5*t+t]=-1,e[5*t+4]=255,this.set(e))},invertRed:function(){return this.invertChannel(y.R)},invertGreen:function(){return this.invertChannel(y.G)},invertBlue:function(){return this.invertChannel(y.B)},invertAlpha:function(){return this.invertChannel(y.A)},invert:function(){return this.set(C([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},desaturate:function(t){t=t||l.LUMA;return this.set(C([t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,t[0],t[1],t[2],0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},grayscale:null,saturate:function(t,e){var e=e||l.LUMA,n=1-t,i=n*e[0],r=n*e[1],n=n*e[2];return this.set(C([i+t,r,n,0,0,i,r+t,n,0,0,i,r,n+t,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},colorize:function(t,e,n){var i,r,n=n||l.LUMA;return this.set(C([(r=1-(e=null==e?1:e))+e*(i=(t>>16&255)/255)*n[0],e*i*n[1],e*i*n[2],0,0,e*(i=(t>>8&255)/255)*n[0],r+e*i*n[1],e*i*n[2],0,0,e*(i=(255&t)/255)*n[0],e*i*n[1],r+e*i*n[2],0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(C([t+=1,0,0,0,128*(1-t),0,e+=1,0,0,128*(1-e),0,0,n+=1,0,128*(1-n),0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},brightness:function(t,e,n){return this.set(C([1,0,0,0,t,0,1,0,0,e=null==e?t:e,0,0,1,0,n=null==n?t:n,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},adjustHue:function(t,e){var n=xe(t*=ye),t=ve(t),e=e||l.LUMA;return this.set(C([e[0]+n*(1-e[0])+t*-e[0],e[1]+n*-e[1]+t*-e[1],e[2]+n*-e[2]+t*(1-e[2]),0,0,e[0]+n*-e[0]+.143*t,e[1]+n*(1-e[1])+.14*t,e[2]+n*-e[2]+-.283*t,0,0,e[0]+n*-e[0]+t*-(1-e[0]),e[1]+n*-e[1]+t*e[1],e[2]+n*(1-e[2])+t*e[2],0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},rotateHue:null,average:function(t,e,n){return this.set(C([t=null==t?.3333:t,e=null==e?.3333:e,n=null==n?.3333:n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},quickContrastCorrection:function(t){return this.set(C([t=null==t?1.2:t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},sepia:function(t){return 1<(t=null==t?.5:t)?t=1:t<0&&(t=0),this.set(C([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},sepia2:function(t,e){100<(t=null==t?10:t)&&(t=100);e=e||l.LUMA;return this.set(C([e[0],e[1],e[2],0,40,e[0],e[1],e[2],0,20,e[0],e[1],e[2],0,-(t*=2.55),0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},threshold:function(t,e,n){null==e&&(e=256);var i=n||l.LUMA;return this.set(C(!1!==n?[i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,i[0]*e,i[1]*e,i[2]*e,0,-(e-1)*t,0,0,0,1,0]:[e,0,0,0,-(e-1)*t,0,e,0,0,-(e-1)*t,0,0,e,0,-(e-1)*t,0,0,0,1,0],y.R,y.G,y.B,y.A,y.R,y.G,y.B,y.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(t,e,n,i){null==n&&(n=256);var r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=i||l.LUMA;return y.A===t?(r[5*t+t]=n,r[5*t+4]=-n*e):(!1!==i?(r[5*t+y.R]=a[0]*n,r[5*t+y.G]=a[1]*n,r[5*t+y.B]=a[2]*n):(r[5*t+y.R]=n,r[5*t+y.G]=n,r[5*t+y.B]=n),r[5*t+4]=-(n-1)*e),this.set(r)},thresholdRed:function(t,e,n){return this.thresholdChannel(y.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(y.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(y.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(y.A,t,e,n)},threshold_alpha:null,RGB2XYZ:function(){return this.set(C([.412453,.35758,.180423,0,0,.212671,.71516,.072169,0,0,.019334,.119193,.950227,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.XX,y.YY,y.ZZ,y.A))},XYZ2RGB:function(){return this.set(C([3.240479,-1.53715,-.498535,0,0,-.969256,1.875992,.041556,0,0,.055648,-.204043,1.057311,0,0,0,0,0,1,0],y.XX,y.YY,y.ZZ,y.A,y.R,y.G,y.B,y.A))},RGB2YCbCr:function(){return this.set(C([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],y.R,y.G,y.B,y.A,y.Y,y.CB,y.CR,y.A))},YCbCr2RGB:function(){return this.set(C([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],y.Y,y.CB,y.CR,y.A,y.R,y.G,y.B,y.A))},RGB2YIQ:function(){return this.set(C([.299,.587,.114,0,0,.701,-.587,-.114,0,0,-.299,-.587,.886,0,0,0,0,0,1,0],y.R,y.G,y.B,y.A,y.Y,y.IP,y.Q,y.A))},YIQ2RGB:function(){return this.set(C([1,1,0,0,0,1,-.509,-.194,0,0,1,0,1,0,0,0,0,0,1,0],y.Y,y.IP,y.Q,y.A,y.R,y.G,y.B,y.A))},blend:function(t,e){return this.matrix=this.matrix?be(this.matrix,t.matrix,1-e,e,ge):new ge(t.matrix),this},set:function(t){var e=this;return e.matrix=e.matrix?Se(e.matrix,t):new ge(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){return{instance:a=this,shader:a.matrix?["varying vec2 pix;","uniform sampler2D img;","uniform float cm[20];","void main(void) {","   vec4 col = texture2D(img, pix);","   gl_FragColor.r = clamp(cm[0 ]*col.r+cm[1 ]*col.g+cm[2 ]*col.b+cm[3 ]*col.a+cm[4 ],0.0,1.0);","   gl_FragColor.g = clamp(cm[5 ]*col.r+cm[6 ]*col.g+cm[7 ]*col.b+cm[8 ]*col.a+cm[9 ],0.0,1.0);","   gl_FragColor.b = clamp(cm[10]*col.r+cm[11]*col.g+cm[12]*col.b+cm[13]*col.a+cm[14],0.0,1.0);","   gl_FragColor.a = clamp(cm[15]*col.r+cm[16]*col.g+cm[17]*col.b+cm[18]*col.a+cm[19],0.0,1.0);","}"].join("\n"):Ae.DEFAULT,vars:a.matrix?function(t,e,n,i){var r=a.matrix;t.uniform1fv(i.uniform.cm,new l.Array32F([r[0],r[1],r[2],r[3],r[4]/255,r[5],r[6],r[7],r[8],r[9]/255,r[10],r[11],r[12],r[13],r[14]/255,r[15],r[16],r[17],r[18],r[19]/255]))}:null};var a},combineWith:function(t){return this.set(t.matrix)},_apply:t?function(t,e,n){var i=this.matrix;if(i){for(var r=t.length,a=(7&r>>>2)<<2,o=new ge(32),l=new _e(4),s=new ge(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],s[1]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],s[2]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],s[3]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],s[0]=s[0]<0?0:255<s[0]?255:s[0],s[1]=s[1]<0?0:255<s[1]?255:s[1],s[2]=s[2]<0?0:255<s[2]?255:s[2],s[3]=s[3]<0?0:255<s[3]?255:s[3],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<r;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[1]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[2]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[3]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[5]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[6]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[7]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[9]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[10]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[11]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[13]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[14]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[15]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[17]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[18]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[19]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[21]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[22]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[23]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[25]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[26]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[27]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[29]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[30]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[31]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],o[0]=o[0]<0?0:255<o[0]?255:o[0],o[1]=o[1]<0?0:255<o[1]?255:o[1],o[2]=o[2]<0?0:255<o[2]?255:o[2],o[3]=o[3]<0?0:255<o[3]?255:o[3],o[4]=o[4]<0?0:255<o[4]?255:o[4],o[5]=o[5]<0?0:255<o[5]?255:o[5],o[6]=o[6]<0?0:255<o[6]?255:o[6],o[7]=o[7]<0?0:255<o[7]?255:o[7],o[8]=o[8]<0?0:255<o[8]?255:o[8],o[9]=o[9]<0?0:255<o[9]?255:o[9],o[10]=o[10]<0?0:255<o[10]?255:o[10],o[11]=o[11]<0?0:255<o[11]?255:o[11],o[12]=o[12]<0?0:255<o[12]?255:o[12],o[13]=o[13]<0?0:255<o[13]?255:o[13],o[14]=o[14]<0?0:255<o[14]?255:o[14],o[15]=o[15]<0?0:255<o[15]?255:o[15],o[16]=o[16]<0?0:255<o[16]?255:o[16],o[17]=o[17]<0?0:255<o[17]?255:o[17],o[18]=o[18]<0?0:255<o[18]?255:o[18],o[19]=o[19]<0?0:255<o[19]?255:o[19],o[20]=o[20]<0?0:255<o[20]?255:o[20],o[21]=o[21]<0?0:255<o[21]?255:o[21],o[22]=o[22]<0?0:255<o[22]?255:o[22],o[23]=o[23]<0?0:255<o[23]?255:o[23],o[24]=o[24]<0?0:255<o[24]?255:o[24],o[25]=o[25]<0?0:255<o[25]?255:o[25],o[26]=o[26]<0?0:255<o[26]?255:o[26],o[27]=o[27]<0?0:255<o[27]?255:o[27],o[28]=o[28]<0?0:255<o[28]?255:o[28],o[29]=o[29]<0?0:255<o[29]?255:o[29],o[30]=o[30]<0?0:255<o[30]?255:o[30],o[31]=o[31]<0?0:255<o[31]?255:o[31],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t}:function(t,e,n){var i=this.matrix;if(i){for(var r=t.length,a=(7&r>>>2)<<2,o=new ge(32),l=new _e(4),s=new ge(4),u=0;u<a;u+=4)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],s[0]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],s[1]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],s[2]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],s[3]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],t[u]=0|s[0],t[u+1]=0|s[1],t[u+2]=0|s[2],t[u+3]=0|s[3];for(u=a;u<r;u+=32)l[0]=t[u],l[1]=t[u+1],l[2]=t[u+2],l[3]=t[u+3],o[0]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[1]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[2]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[3]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+4],l[1]=t[u+5],l[2]=t[u+6],l[3]=t[u+7],o[4]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[5]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[6]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[7]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+8],l[1]=t[u+9],l[2]=t[u+10],l[3]=t[u+11],o[8]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[9]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[10]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[11]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+12],l[1]=t[u+13],l[2]=t[u+14],l[3]=t[u+15],o[12]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[13]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[14]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[15]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+16],l[1]=t[u+17],l[2]=t[u+18],l[3]=t[u+19],o[16]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[17]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[18]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[19]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+20],l[1]=t[u+21],l[2]=t[u+22],l[3]=t[u+23],o[20]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[21]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[22]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[23]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+24],l[1]=t[u+25],l[2]=t[u+26],l[3]=t[u+27],o[24]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[25]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[26]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[27]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],l[0]=t[u+28],l[1]=t[u+29],l[2]=t[u+30],l[3]=t[u+31],o[28]=i[0]*l[0]+i[1]*l[1]+i[2]*l[2]+i[3]*l[3]+i[4],o[29]=i[5]*l[0]+i[6]*l[1]+i[7]*l[2]+i[8]*l[3]+i[9],o[30]=i[10]*l[0]+i[11]*l[1]+i[12]*l[2]+i[13]*l[3]+i[14],o[31]=i[15]*l[0]+i[16]*l[1]+i[17]*l[2]+i[18]*l[3]+i[19],t[u]=0|o[0],t[u+1]=0|o[1],t[u+2]=0|o[2],t[u+3]=0|o[3],t[u+4]=0|o[4],t[u+5]=0|o[5],t[u+6]=0|o[6],t[u+7]=0|o[7],t[u+8]=0|o[8],t[u+9]=0|o[9],t[u+10]=0|o[10],t[u+11]=0|o[11],t[u+12]=0|o[12],t[u+13]=0|o[13],t[u+14]=0|o[14],t[u+15]=0|o[15],t[u+16]=0|o[16],t[u+17]=0|o[17],t[u+18]=0|o[18],t[u+19]=0|o[19],t[u+20]=0|o[20],t[u+21]=0|o[21],t[u+22]=0|o[22],t[u+23]=0|o[23],t[u+24]=0|o[24],t[u+25]=0|o[25],t[u+26]=0|o[26],t[u+27]=0|o[27],t[u+28]=0|o[28],t[u+29]=0|o[29],t[u+30]=0|o[30],t[u+31]=0|o[31]}return t},canRun:function(){return this._isOn&&this.matrix}})).prototype.grayscale=t.prototype.desaturate,t.prototype.rotateHue=t.prototype.adjustHue,t.prototype.threshold_rgb=t.prototype.thresholdRGB,t.prototype.threshold_alpha=t.prototype.thresholdAlpha,Re=M,we=Re.MODE,Le=Re.Util.GLSL,Ee=Re.Color,Re.ColorMatrix,De=Re.Util.Array.typed,Te=Re._notSupportClamp,Me=Re.Util.String.function_body,Ge=Object.prototype.hasOwnProperty,(G=Re.Create({name:"ColorMapFilter",init:function(t,e){t&&this.set(t,e)},path:Re.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:we.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,thresholds:t.thresholds,quantizedColors:t.quantizedColors};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.thresholds=De(t.thresholds,Array),e.quantizedColors=De(t.quantizedColors,Array),!t._map&&t._mapName&&Ge.call(Ie,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2HSL:function(){return this.set("rgb2hsl")},HSL2RGB:function(){return this.set("hsl2rgb")},RGB2HWB:function(){return this.set("rgb2hwb")},HWB2RGB:function(){return this.set("hwb2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){return this.thresholds=t,this.quantizedColors=e,this.set("quantize")},threshold:null,mask:function(t,e,n){return this.thresholds=[t,e],this.quantizedColors=[n||0],this.set("mask")},extract:null,set:function(t,e){var n=this;return t&&Ge.call(Ie,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Ie[n._mapName],n._mapInit=Ie["init__"+n._mapName],n._apply=Br(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=Br(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t._glsl=null,t},getGLSL:function(){var n,t,i,l=this;return l._map?Ge.call(Ie,l._mapName)?"quantize"===l._mapName?(n=Le.formatFloat,t=l.thresholds||[],i=l.quantizedColors||[],{instance:l,shader:["varying vec2 pix;","uniform sampler2D img;","#define HUE "+we.HUE,"#define SATURATION "+we.SATURATION,"#define INTENSITY "+we.INTENSITY,"#define COLOR "+we.COLOR,"uniform int mode;",Ee.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","void main(void) {","vec4 i = texture2D(img, pix);","vec4 o = vec4(i.r, i.g, i.b, i.a);","float v;","int found = 0;","if (0.0 != i.a) {","if (mode == HUE) v = rgb2hue(i.r, i.g, i.b)/360.0;","else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","else v = col24(i.r, i.g, i.b);",t.map(function(t,e){return"if (0 == found && v <= "+(t=(t=t)||0,we.COLOR===l.mode?n(100*(t>>16&255)/255+10*(t>>8&255)/255+(255&t)/255):n(t/255))+") {found = 1; o.rgb = "+(e<i.length?Ee.rgb24GL(i[e]):"vec3(1.0,1.0,1.0)")+";}"}).join("\n"),"gl_FragColor = o;","} else {","gl_FragColor = i;","}","}"].join("\n")}):{instance:l,shader:["varying vec2 pix;","uniform sampler2D img;","#define HUE "+we.HUE,"#define SATURATION "+we.SATURATION,"#define INTENSITY "+we.INTENSITY,"#define COLOR "+we.COLOR,"uniform vec4 color;","uniform float minval;","uniform float maxval;","uniform int mapping;","uniform int mode;",Ee.GLSLCode(),"float col24(float r, float g, float b) {","   return 100.0*r + 10.0*g + 1.0*b;","}","vec4 mask(vec4 i, float minval, float maxval, vec4 color) {","    float v = 0.0;","    if (0.0 != i.a) {","        if (mode == HUE) v = rgb2hue(i.r, i.g, i.b);","        else if (mode == SATURATION) v = rgb2sat(i.r, i.g, i.b, FORMAT_HSV);","        else if (mode == INTENSITY) v = intensity(i.r, i.g, i.b);","        else v = col24(i.r, i.g, i.b);","        if (v < minval || v > maxval) return color;","        else return i;","    } else {","        return i;","    }","}","void main(void) {","vec4 c = texture2D(img, pix);","vec4 o = vec4(c.r, c.g, c.b, c.a);","float v;","if (1 == mapping) {o.xyz = rgb2hsv(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (2 == mapping) {o.rgb = hsv2rgb(c.r, c.g, c.b).rgb;}","else if (3 == mapping) {o.xyz = rgb2hsl(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (4 == mapping) {o.rgb = hsl2rgb(c.r, c.g, c.b).rgb;}","else if (5 == mapping) {o.xyz = rgb2hwb(c.r, c.g, c.b).xyz; o.x /= 360.0;}","else if (6 == mapping) {o.rgb = hwb2rgb(c.r, c.g, c.b).rgb;}","else if (7 == mapping) {o.xyz = rgb2cmyk(c.r, c.g, c.b).xyz;}","else if (8 == mapping) {v=rgb2hue(c.r, c.g, c.b)/360.0; o=vec4(v,v,v,c.a);}","else if (9 == mapping) {v=rgb2sat(c.r, c.g, c.b, FORMAT_HSV); o=vec4(v,v,v,c.a);}","else if (10 == mapping) {o = mask(c, minval, maxval, color);}","gl_FragColor = o;","}"].join("\n"),vars:function(t,e,n,i){var r=l.thresholds||[0,0],a=(l.quantizedColors||[0])[0]||0,o=r[0]||0,r=r[1]||0;t.uniform4f(i.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255),t.uniform1f(i.uniform.minval,we.COLOR===l.mode?100*(o>>16&255)/255+10*(o>>8&255)/255+(255&o)/255:o),t.uniform1f(i.uniform.maxval,we.COLOR===l.mode?100*(r>>16&255)/255+10*(r>>8&255)/255+(255&r)/255:r),t.uniform1i(i.uniform.mapping,"rgb2hsv"===l._mapName?1:"hsv2rgb"===l._mapName?2:"rgb2hsl"===l._mapName?3:"hsl2rgb"===l._mapName?4:"rgb2hwb"===l._mapName?5:"hwb2rgb"===l._mapName?6:"rgb2cmyk"===l._mapName?7:"hue"===l._mapName?8:"saturation"===l._mapName?9:"mask"===l._mapName?10:0)}}:{instance:l,shader:l._map.shader,vars:l._map.vars,textures:l._map.textures}:{instance:l,shader:Le.DEFAULT}},canRun:function(){return this._isOn&&this._map}})).prototype.threshold=G.prototype.quantize,G.prototype.extract=G.prototype.mask,Ie={rgb2hsv:"function() {        if (0 !== c[3])        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",rgb2hsl:"function() {        if (0 !== c[3])        {            RGB2HSL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CL] = C2;        }    }",init__rgb2hsl:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, RGB2HSL = FILTER.Color.RGB2HSL;    }",rgb2hwb:"function() {        if (0 !== c[3])        {            RGB2HWB(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CW] = C1; c[CB] = C2;        }    }",init__rgb2hwb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, RGB2HWB = FILTER.Color.RGB2HWB;    }",hsv2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",hsl2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CL];            c[0] = C0; c[1] = C1; c[2] = C2;            HSL2RGB(c, 0);        }    }",init__hsl2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CL = FILTER.CHANNEL.L, HSL2RGB = FILTER.Color.HSL2RGB;    }",hwb2rgb:"function() {        if (0 !== c[3])        {            C0 = c[CH]; C1 = c[CW]; C2 = c[CB];            c[0] = C0; c[1] = C1; c[2] = C2;            HWB2RGB(c, 0);        }    }",init__hwb2rgb:"function() {        var C0, C1, C2, CH = FILTER.CHANNEL.H, CW = FILTER.CHANNEL.WH, CB = FILTER.CHANNEL.BL, HWB2RGB = FILTER.Color.HWB2RGB;    }",rgb2cmyk:"function() {        if (0 !== c[3])        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function() {        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",rgb2ill:"function() {        if (0 !== c[3])        {            RGB2ILL(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[ILL1] = min(255, max(0, 255-127*C0)); c[ILL2] = min(255, max(0, 255-127*C1)); c[ILL3] = min(255, max(0, 255-127*C2));        }    }",init__rgb2ill:"function() {        var C0, C1, C2, ILL1 = FILTER.CHANNEL.ILL1, ILL2 = FILTER.CHANNEL.ILL2, ILL3 = FILTER.CHANNEL.ILL3, RGB2ILL = FILTER.Color.RGB2ILL, min = Math.min, max = Math.max;    }",hue:"function() {        if (0 !== c[3])        {            HHH = HUE(c[0], c[1], c[2])*0.7083333333333333/*255/360*/;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function() {        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function() {        if (0 !== c[3])        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function() {        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function() {        if (0 !== c[3])        {            J = 0; V = VALUE(c[0], c[1], c[2])*FACTOR;            while (J<THRESH_LEN && V>THRESH[J]) ++J;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function() {        var FACTOR = 1, VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;        //if (FILTER.MODE.HUE === self.mode) FACTOR = 0.7083333333333333/*255/360*/;    }",mask:"function() {        if (0 !== c[3])        {            V = VALUE(c[0], c[1], c[2]);            if ((V < MIN_VALUE) || (V > MAX_VALUE))            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function() {        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"},Ne=(Oe=M).ImArray,Fe=Oe.AffineMatrix,He=Oe.Util.Array.typed,Ue=Oe.Util.GLSL,Be=Oe.MODE,Oe.CONST.toRad,O=Math,ze=O.sin,Ye=O.cos,Pe=O.tan,Xe=Oe.Util.Filter.am_multiply,(O=Oe.Create({name:"AffineMatrixFilter",init:function(t){this.matrix=t&&t.length?new Fe(t):null},path:Oe.Path,matrix:null,mode:Be.CLAMP,color:0,dispose:function(){return this.matrix=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{matrix:this.matrix,color:this.color}},unserialize:function(t){return this.matrix=He(t.matrix,Fe),this.color=t.color,this},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=ze(t),t=Ye(t);return this.set([t,-e,0,0,e,t,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?Pe(t):0,0,0,e?Pe(e):0,1,0,0])},set:function(t){var e=this;return e.matrix=e.matrix?Xe(e.matrix,t):new Fe(t),e._glsl=null,e},reset:function(){return this.matrix=null,this._glsl=null,this},getGLSL:function(){var o=this,t=o.matrix;return o.color,{instance:o,shader:t?["varying vec2 pix;","uniform sampler2D img;","uniform float am[6];","uniform vec4 color;","#define IGNORE "+Be.IGNORE,"#define CLAMP "+Be.CLAMP,"#define COLOR "+Be.COLOR,"#define WRAP "+Be.WRAP,"uniform int mode;","void main(void) {","   vec2 p = vec2(am[0]*pix.x+am[1]*pix.y+am[2], am[3]*pix.x+am[4]*pix.y+am[5]);","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (COLOR == mode) {gl_FragColor = color;}","       else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","       else if (WRAP == mode) {","           if (0.0 > p.x) p.x += 1.0;","           if (1.0 < p.x) p.x -= 1.0;","           if (0.0 > p.y) p.y += 1.0;","           if (1.0 < p.y) p.y -= 1.0;","           gl_FragColor = texture2D(img, p);","       }","       else {gl_FragColor = texture2D(img, pix);}","   } else {","       gl_FragColor = texture2D(img, p);","   }","}"].join("\n"):Ue.DEFAULT,vars:t?function(t,e,n,i){var r=o.matrix,a=o.color||0;t.uniform1fv(i.uniform.am,new Oe.Array32F([r[0],r[1],r[2]/e+r[3],r[4],r[5],r[6]/n+r[7]])),t.uniform4f(i.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255)}:null}},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var i=this.matrix;if(!i)return t;var r,a,o,l,s,u,c,f,h,m,p,d=t.length,g=d>>>2,_=e-1,v=g-e,x=new Ne(d),y=this.color||0,C=Be.COLOR,b=(Be.CLAMP,Be.WRAP),S=Be.IGNORE,A=i[0],R=i[1],I=i[2]+i[3]*_,w=i[4]*e,L=i[5],E=i[6]*e+i[7]*v,i=this.mode||S;if(C===i)for(p=y>>>24&255,f=y>>>16&255,h=y>>>8&255,m=255&y,u=o=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,o+=e),s=w*r+L*o+E,(l=A*r+R*a+I)<0||_<l||s<0||v<s?(x[u]=f,x[u+1]=h,x[u+2]=m,x[u+3]=p):(x[u]=t[c=(0|l)+(0|s)<<2],x[u+1]=t[c+1],x[u+2]=t[c+2],x[u+3]=t[c+3]);else if(S===i)for(u=o=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,o+=e),x[u]=t[c=(0|(l=_<(l=A*r+R*a+I)||l<0?r:l))+(0|(s=v<(s=w*r+L*o+E)||s<0?o:s))<<2],x[u+1]=t[c+1],x[u+2]=t[c+2],x[u+3]=t[c+3];else if(b===i)for(u=o=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,o+=e),x[u]=t[c=(0|(l=_<(l=A*r+R*a+I)?l-e:l<0?l+e:l))+(0|(s=v<(s=w*r+L*o+E)?s-g:s<0?s+g:s))<<2],x[u+1]=t[c+1],x[u+2]=t[c+2],x[u+3]=t[c+3];else for(u=o=a=r=0;u<d;u+=4,++r)e<=r&&(r=0,++a,o+=e),x[u]=t[c=(0|(l=_<(l=A*r+R*a+I)?_:l<0?0:l))+(0|(s=v<(s=w*r+L*o+E)?v:s<0?0:s))<<2],x[u+1]=t[c+1],x[u+2]=t[c+2],x[u+3]=t[c+3];return x},canRun:function(){return this._isOn&&this.matrix}})).prototype.shift=O.prototype.translate,je=(ke=M).MODE,$e=ke.CHANNEL,ke.Util.Array.typed,We=ke.Util.GLSL,N=Math,qe=N.min,N.max,V=N.floor,ke.Create({name:"DisplacementMapFilter",init:function(t){t&&this.setInput("map",t)},path:ke.Path,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:je.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},getGLSL:function(){return t=(a=this).input("map"),o=a.color||0,t?{instance:a,shader:["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D map;","uniform vec2 mapSize;","uniform vec2 start;","uniform vec2 scale;","uniform vec4 color;","uniform ivec2 component;","#define IGNORE "+je.IGNORE,"#define CLAMP "+je.CLAMP,"#define COLOR "+je.COLOR,"#define WRAP "+je.WRAP,"#define RED "+$e.R,"#define GREEN "+$e.G,"#define BLUE "+$e.B,"#define ALPHA "+$e.A,"uniform int mode;","void main(void) {","   if (pix.x < start.x || pix.x > min(1.0,start.x+mapSize.x) || pix.y < start.y || pix.y > min(1.0,start.y+mapSize.y)) {","      gl_FragColor = texture2D(img, pix);","   } else {","       vec4 mc = texture2D(map, (pix-start)/mapSize);","       vec2 p = vec2(pix.x, pix.y);","       if (ALPHA == component.x) p.x += (mc.a - 0.5)*scale.x;","       else if (BLUE == component.x) p.x += (mc.b - 0.5)*scale.x;","       else if (GREEN == component.x) p.x += (mc.g - 0.5)*scale.x;","       else p.x += (mc.r - 0.5)*scale.x;","       if (ALPHA == component.y) p.y += (mc.a - 0.5)*scale.y;","       else if (BLUE == component.y) p.y += (mc.b - 0.5)*scale.y;","       else if (GREEN == component.y) p.y += (mc.g - 0.5)*scale.y;","       else p.y += (mc.r - 0.5)*scale.y;","       if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","           if (COLOR == mode) {gl_FragColor = color;}","           else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","           else if (WRAP == mode) {","               if (0.0 > p.x) p.x += 1.0;","               if (1.0 < p.x) p.x -= 1.0;","               if (0.0 > p.y) p.y += 1.0;","               if (1.0 < p.y) p.y -= 1.0;","               gl_FragColor = texture2D(img, p);","           }","           else {gl_FragColor = texture2D(img, pix);}","       } else {","           gl_FragColor = texture2D(img, p);","       }","   }","}"].join("\n"),textures:function(t,e,n,i){var r=a.input("map");We.uploadTexture(t,r[0],r[1],r[2],1)},vars:function(t,e,n,i){var r=a.input("map");t.uniform1i(i.uniform.map,1),t.uniform2f(i.uniform.mapSize,r[1]/e,r[2]/n),t.uniform2f(i.uniform.scale,1.4*a.scaleX/255,1.4*a.scaleY/255),t.uniform2f(i.uniform.start,a.startX,a.startY),t.uniform2i(i.uniform.component,a.componentX,a.componentY),t.uniform4f(i.uniform.color,(o>>>16&255)/255,(o>>>8&255)/255,(255&o)/255,(o>>>24&255)/255)}}:{instance:a,shader:We.DEFAULT};var a,t,o},_apply:function(t,e,n){var i=this,r=i.input("map");if(r){for(var F,H,U,B,a,o,l,s,u,c,f,h,m,p=i.color||0,d=e-1,g=n-1,_=.00390625*i.scaleX,v=.00390625*i.scaleY,x=i.componentX,y=i.componentY,z=je.IGNORE,Y=(je.CLAMP,je.COLOR),P=je.WRAP,X=i.mode||z,k=(ke.ImArray,ke.Util.Array.copy),j=ke.Array16I,C=r[0],b=r[1],r=r[2],$=C.length,W=$>>>2,S=qe(b,e),A=S*qe(r,n)<<2,R=(t.length,V(i.startX*d)),I=V(i.startY*g),w=I*e,L=-R,E=-I,D=d-R,T=g-I,M=new j(W<<1),G=k(t),q=(15&W)<<2,O=0,N=0;N<q;N+=4)M[O++]=V((C[N+x]-128)*_),M[O++]=V((C[N+y]-128)*v);for(N=q;N<$;N+=64)M[O++]=V((C[N+x]-128)*_),M[O++]=V((C[N+y]-128)*v),M[O++]=V((C[N+4+x]-128)*_),M[O++]=V((C[N+4+y]-128)*v),M[O++]=V((C[N+8+x]-128)*_),M[O++]=V((C[N+8+y]-128)*v),M[O++]=V((C[N+12+x]-128)*_),M[O++]=V((C[N+12+y]-128)*v),M[O++]=V((C[N+16+x]-128)*_),M[O++]=V((C[N+16+y]-128)*v),M[O++]=V((C[N+20+x]-128)*_),M[O++]=V((C[N+20+y]-128)*v),M[O++]=V((C[N+24+x]-128)*_),M[O++]=V((C[N+24+y]-128)*v),M[O++]=V((C[N+28+x]-128)*_),M[O++]=V((C[N+28+y]-128)*v),M[O++]=V((C[N+32+x]-128)*_),M[O++]=V((C[N+32+y]-128)*v),M[O++]=V((C[N+36+x]-128)*_),M[O++]=V((C[N+36+y]-128)*v),M[O++]=V((C[N+40+x]-128)*_),M[O++]=V((C[N+40+y]-128)*v),M[O++]=V((C[N+44+x]-128)*_),M[O++]=V((C[N+44+y]-128)*v),M[O++]=V((C[N+48+x]-128)*_),M[O++]=V((C[N+48+y]-128)*v),M[O++]=V((C[N+52+x]-128)*_),M[O++]=V((C[N+52+y]-128)*v),M[O++]=V((C[N+56+x]-128)*_),M[O++]=V((C[N+56+y]-128)*v),M[O++]=V((C[N+60+x]-128)*_),M[O++]=V((C[N+60+y]-128)*v);if(Y===X)for(F=p>>>24&255,H=p>>>16&255,U=p>>>8&255,B=255&p,N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<E||T<o||a<L||D<a||(c=(u=a+R)+l+w<<2,h=u+M[O=a+s<<1],g<(m=o+I+M[O+1])||m<0||d<h||h<0?(t[c]=H,t[c+1]=U,t[c+2]=B,t[c+3]=F):(t[c]=G[f=h+m*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]));else if(z===X)for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<E||T<o||a<L||D<a||(c=(u=a+R)+l+w<<2,h=u+M[O=a+s<<1],g<(m=o+I+M[O+1]))||m<0||d<h||h<0||(t[c]=G[f=h+m*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]);else if(P===X)for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<E||T<o||a<L||D<a||(h=(u=a+R)+M[O=a+s<<1],m=o+I+M[O+1],t[c=u+l+w<<2]=G[f=(h=d<h?h-e:h<0?h+e:h)+(m=g<m?m-n:m<0?m+n:m)*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3]);else for(N=s=l=o=a=0;N<A;N+=4,++a)S<=a&&(a=0,++o,l+=e,s+=b),o<E||T<o||a<L||D<a||(h=(u=a+R)+M[O=a+s<<1],m=o+I+M[O+1],t[c=u+l+w<<2]=G[f=(h=d<h?d:h<0?0:h)+(m=g<m?g:m<0?0:m)*e<<2],t[c+1]=G[f+1],t[c+2]=G[f+2],t[c+3]=G[f+3])}return t}}),Ze=(D=M).MODE,Qe=D.Util.String.function_body,n=Math,Je=n.floor,tn=n.round,en=n.sqrt,nn=n.atan2,rn=n.sin,an=n.cos,on=n.max,n.min,ln=2*n.PI,sn=D.Util.Math.clamp,D.POS.X,un=D.POS.Y,cn=Object.prototype.hasOwnProperty,fn=D.Util.GLSL,D.Create({name:"GeometricMapFilter",init:function(t,e){t&&this.set(t,e)},path:D.Path,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,posX:0,posY:1,angle:0,radius:0,mode:Ze.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t=this,e={_mapName:t._mapName||null,_map:"generic"===t._mapName&&t._map&&t._mapChanged?(t._map.filter||t._map).toString():null,_mapInit:"generic"===t._mapName&&t._mapInit&&t._mapChanged?t._mapInit.toString():null,color:t.color,centerX:t.centerX,centerY:t.centerY,posX:t.posX,posY:t.posY,angle:t.angle,radius:t.radius};return t._mapChanged=!1,e},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.posX=t.posX,e.posY=t.posY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&cn.call(Ve,t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},twirl:function(t,e,n,i){var r=this;return r.angle=t||0,r.radius=e||0,r.centerX=n||0,r.centerY=i||0,r.set("twirl")},sphere:function(t,e,n){return this.radius=t||0,this.centerX=e||0,this.centerY=n||0,this.set("sphere")},polar:function(t,e,n,i){var r=this;return r.centerX=t||0,r.centerY=e||0,r.posX=n||0,r.posY=i||0,r.set("polar")},cartesian:function(t,e,n,i){var r=this;return r.centerX=t||0,r.centerY=e||0,r.posX=n||0,r.posY=i||0,r.set("cartesian")},set:function(t,e){var n=this;return"polar"===t?(n._mapName="polar",n._map="polar",n._mapInit=null,n._apply=function(t,e,n){var i,r,a,o,l,s,u,c,f=this,h=t.length,m=e-1,p=n-1,d=f.centerX*m,g=f.centerY*p,_=f.posX,v=(f.posY,D.MODE.COLOR),x=D.MODE.CLAMP,y=D.MODE.WRAP,C=D.MODE.IGNORE,b=f.mode||C,C=f.color||0,S=C>>>24&255,A=C>>>16&255,R=C>>>8&255,I=255&C,w=ln,L=Je(on(en(d*d+g*g),en((d-m)*(d-m)+g*g),en(d*d+(g-p)*(g-p)),en((d-m)*(d-m)+(g-p)*(g-p)))),E=new D.ImArray(h);for(a=o=u=0;u<h;++a,u+=4){if(e<=a&&(a=0,++o),_===un?(r=tn((s=L*o/p)*an(l=w*a/m)+g),i=tn(s*rn(l)+d)):(i=tn((s=L*a/m)*an(l=w*o/p)+d),r=tn(s*rn(l)+g)),i<0||e<=i||r<0||n<=r){if(v===b){E[u]=A,E[u+1]=R,E[u+2]=I,E[u+3]=S;continue}if(y===b)i<0&&(i+=e),e<=i&&(i-=e),r<0&&(r+=n),n<=r&&(r-=n);else{if(x!==b)continue;i=sn(i,0,m),r=sn(r,0,p)}}c=i+r*e<<2,E[u]=t[c],E[u+1]=t[1+c],E[u+2]=t[2+c],E[u+3]=t[3+c]}return E}.bind(n),n._mapChanged=!1):"cartesian"===t?(n._mapName="cartesian",n._map="cartesian",n._mapInit=null,n._apply=function(t,e,n){var i,r,a,o,l,s,u,c=this,f=t.length,h=e-1,m=n-1,p=c.centerX*h,d=c.centerY*m,g=c.posX,_=(c.posY,D.MODE.COLOR),v=D.MODE.CLAMP,x=D.MODE.WRAP,y=D.MODE.IGNORE,C=c.mode||y,y=c.color||0,b=y>>>24&255,S=y>>>16&255,A=y>>>8&255,R=255&y,I=ln,w=Je(on(en(p*p+d*d),en((p-h)*(p-h)+d*d),en(p*p+(d-m)*(d-m)),en((p-h)*(p-h)+(d-m)*(d-m)))),L=new D.ImArray(f);for(a=o=s=0;s<f;++a,s+=4){if(e<=a&&(a=0,++o),g===un?(r=a-p,i=o-d):(i=a-p,r=o-d),u=en(i*i+r*r),(l=nn(r,i))<0&&(l+=ln),g===un?(r=tn(m*u/w),i=tn(h*l/I)):(i=tn(h*u/w),r=tn(m*l/I)),i<0||e<=i||r<0||n<=r){if(_===C){L[s]=S,L[s+1]=A,L[s+2]=R,L[s+3]=b;continue}if(x===C)i<0&&(i+=e),e<=i&&(i-=e),r<0&&(r+=n),n<=r&&(r-=n);else{if(v!==C)continue;i=sn(i,0,h),r=sn(r,0,m)}}u=i+r*e<<2,L[s]=t[u],L[s+1]=t[1+u],L[s+2]=t[2+u],L[s+3]=t[3+u]}return L}.bind(n),n._mapChanged=!1):t&&cn.call(Ve,String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=Ve[n._mapName],n._mapInit=Ve["init__"+n._mapName],n._apply=zr(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=zr(n._map,n._mapInit),n._mapChanged=!0),n._glsl=null,n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t._glsl=null,t},getGLSL:function(){var u=this;return u._map?cn.call(Ke,u._mapName)?{instance:u,shader:["varying vec2 pix;","uniform sampler2D img;","#define TWOPI  6.283185307179586","#define IGNORE "+Ze.IGNORE,"#define CLAMP "+Ze.CLAMP,"#define COLOR "+Ze.COLOR,"#define WRAP "+Ze.WRAP,"uniform int mode;","uniform int swap;","uniform vec2 size;","uniform vec2 center;","uniform float angle;","uniform float radius;","uniform float radius2;","uniform float AMAX;","uniform float RMAX;","uniform vec4 color;","uniform int mapping;",Ke.twirl,Ke.sphere,Ke.polar,Ke.cartesian,"void main(void) {","vec2 p = pix;","if (1 == mapping) p = twirl(pix, center, radius, angle, size);","else if (2 == mapping) p = sphere(pix, center, radius2, size);","else if (3 == mapping) p = polar(pix, center, RMAX, AMAX, size, swap);","else if (4 == mapping) p = cartesian(pix, center, RMAX, AMAX, size, swap);","if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","if (COLOR == mode) {gl_FragColor = color;}","else if (CLAMP == mode) {gl_FragColor = texture2D(img, vec2(clamp(p.x, 0.0, 1.0),clamp(p.y, 0.0, 1.0)));}","else if (WRAP == mode) {","if (0.0 > p.x) p.x += 1.0;","if (1.0 < p.x) p.x -= 1.0;","if (0.0 > p.y) p.y += 1.0;","if (1.0 < p.y) p.y -= 1.0;","gl_FragColor = texture2D(img, p);","}","else {gl_FragColor = texture2D(img, pix);}","} else {","gl_FragColor = texture2D(img, p);","}","}"].join("\n"),vars:function(t,e,n,i){var r=u.color||0,a=u.centerX,o=u.centerY,l=(e-1)*(e-1),s=(n-1)*(n-1),l=on(en(l*+a*+a+s*+o*+o),en(l*(a-1)*(a-1)+s*+o*+o),en(l*+a*+a+s*(o-1)*(o-1)),en(l*(a-1)*(a-1)+s*(o-1)*(o-1)));t.uniform4f(i.uniform.color,(r>>>16&255)/255,(r>>>8&255)/255,(255&r)/255,(r>>>24&255)/255),t.uniform2f(i.uniform.size,e,n),t.uniform2f(i.uniform.center,a,o),t.uniform1f(i.uniform.angle,u.angle),t.uniform1f(i.uniform.radius,u.radius),t.uniform1f(i.uniform.radius2,u.radius*u.radius),t.uniform1f(i.uniform.AMAX,ln),t.uniform1f(i.uniform.RMAX,l),t.uniform1i(i.uniform.swap,u.posX===un?1:0),t.uniform1i(i.uniform.mapping,"twirl"===u._mapName?1:"sphere"===u._mapName?2:"polar"===u._mapName?3:"cartesian"===u._mapName?4:0)}}:{instance:u,shader:u._map.shader,vars:u._map.vars,textures:u._map.textures}:{instance:u,shader:fn.DEFAULT}},canRun:function(){return this._isOn&&this._map}}),Ve={twirl:"function() {        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if (D < R)        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function() {        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function() {        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if (D2 < R2)        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function() {        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"},Ke={twirl:["vec2 twirl(vec2 pix, vec2 center, float R, float angle, vec2 size) {","vec2 T = size*(pix - center);","float D = length(T);","if (D < R) {","float theta = atan(T.y, T.x) + (R-D)*angle/R;","pix = (size*center + vec2(D*cos(theta),  D*sin(theta)))/size;","}","return pix;","}"].join("\n"),sphere:["vec2 sphere(vec2 pix, vec2 center, float R2, vec2 size) {","vec2 T = size*(pix - center);","float TX2 = T.x*T.x; float TY2 = T.y*T.y;","float D2 = TX2 + TY2;","if (D2 < R2) {","D2 = R2 - D2;","float D = sqrt(D2);","float thetax = asin(T.x / sqrt(TX2 + D2)) * (1.0-0.555556);","float thetay = asin(T.y / sqrt(TY2 + D2)) * (1.0-0.555556);","pix = pix - vec2(D * tan(thetax), D * tan(thetay))/size;","}","return pix;","}"].join("\n"),polar:["vec2 polar(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","float r = 0.0;","float a = 0.0;","/*pix *= size;*/","if (1 == swap) {","r = pix.y*rMax;","a = pix.x*aMax;","return (size*center + vec2(r*sin(a), r*cos(a)))/size;","} else {","r = pix.x*rMax;","a = pix.y*aMax;","return (size*center + vec2(r*cos(a), r*sin(a)))/size;","}","}"].join("\n"),cartesian:["vec2 cartesian(vec2 pix, vec2 center, float rMax, float aMax, vec2 size, int swap) {","vec2 xy = size* (pix - center);","float r = 0.0;","float a = 0.0;","if (1 == swap) {","xy = xy.yx;","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(a/aMax, r/rMax);","} else {","r = length(xy);","a = atan(xy.y, xy.x);","if (0.0 > a) a += TWOPI;","return vec2(r/rMax, a/aMax);","}","}"].join("\n")},hn=(r=M).MODE,mn=r.ConvolutionMatrix,pn=r.ImArray,r.Array32F,dn=r.Array16I,r.Array8U,gn=r.Util.Filter.cm_convolve,_n=r.Util.Filter.cm_combine,vn=r.Util.Filter.gaussian,xn=r.Util.Filter.integral_convolution,yn=r.Util.Filter.separable_convolution,Cn=r.Util.Array.typed,bn=r._notSupportClamp,Sn=r.Util.GLSL,(An=Math).SQRT2,Rn=r.CONST.toRad,r.CONST.toDeg,In=An.abs,wn=An.sqrt,Ln=An.sin,En=An.cos,Dn=An.min,Tn=An.max,Mn=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],(r=r.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,i){var r;this._coeff=new mn([1,0]),t&&t.length&&(r=wn(t.length)+.5|0,this.set(t,r,r,e||1,n||0)),this.mode=i||hn.RGB},path:r.Path,dimx:0,dimy:0,dimx2:0,dimy2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_doIntegralSeparable:null,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_w:null,mode:hn.RGB,dispose:function(){var t=this;return t.dimx=t.dimy=null,t.dimx2=t.dimy2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._doIntegralSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._w=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dimx:t.dimx,dimy:t.dimy,dimx2:t.dimx2,dimy2:t.dimy2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_w:t._w}},unserialize:function(t){var e=this;return e.dimx=t.dimx,e.dimy=t.dimy,e.dimx2=t.dimx2,e.dimy2=t.dimy2,e.matrix=Cn(t.matrix,mn),e.matrix2=Cn(t.matrix2,mn),e._mat=Cn(t._mat,mn),e._mat2=Cn(t._mat2,mn),e._coeff=Cn(t._coeff,mn),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=Cn(t._indices,dn),e._indices2=Cn(t._indices2,dn),e._indicesf=Cn(t._indicesf,dn),e._indicesf2=Cn(t._indicesf2,dn),e._w=t._w?[Cn(t._w[0],mn),+t._w[1],+t._w[2],+t._w[3]]:null,e},functional:function(t,e,n){return e=null==e?3:1&e?e:e+1,n?(this.set(jr(e,1,t),e,1,1,1,1,e,jr(1,e,t)),this._doSeparable=!0):this.set(jr(e,e,t),e,e,1,0),this},fastGauss:function(t,e){return(t=0|(t||1))<1?t=1:7<t&&(t=7),this.set(qr(e=null==e?3:1&e?e:e+1),e,e,1/(e*e),0),this._doIntegralSeparable=[Pr(e),e,1,1/e,0,Pr(e),1,e,1/e,0],this._doIntegral=t,this},gauss:function(t,e){return this.set(vn(e=null==e?3:1&e?e:e+1,1,t),e,1,1,1,1,e,vn(1,e,t)),this._doSeparable=!0,this},lowPass:function(t){return this.set(qr(t=null==t?3:1&t?t:t+1),t,t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,e){e=-(e=null==e?1:e)/((t=null==t?3:1&t?t:t+1)*t);return this.set(qr(t,e,1+e),t,t,1,0),this._doIntegral=1,this},glow:function(t,e){return this.highPass(e,-(t=null==t?.5:t))},sharpen:function(t,e){return this.highPass(e,t=null==t?.5:t)},verticalBlur:function(t){return this.set(Pr(t=null==t?3:1&t?t:t+1),1,t,1/t,0),this._doIntegral=1,this},horizontalBlur:function(t){return this.set(Pr(t=null==t?3:1&t?t:t+1),t,1,1/t,0),this._doIntegral=1,this},directionalBlur:function(t,e){return this.set(function(t,e,n,i){var r,a,o,l,s,u=t*t,c=t>>1,f=u>>1,h=new mn(u),m=new mn(u),p=1/t;u=1e-8<In(e)?(s=1,n/e):(s=e/n,1);l=o=r=0,a=u*t;for(;r<=c;)m[f+r]=f+o+l+.5|0,m[f-r]=f-o-l+.5|0,++r,o+=s,l+=a;r=0;for(;r<=c;)h[m[f+r]]=h[m[f-r]]=p,++r;return h[f]=i||1,h}(e=null==e?3:1&e?e:e+1,En(t*=Rn),-Ln(t),1/e),e,e,1,0)},binomialLowPass:function(t){var e=kr(t=null==t?3:1&t?t:t+1),n=1/(1<<t-1);return this.set(e,t,1,n,n,1,t,e),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){var e=function(t){t=kr(t);return gn(t,t)}(t=null==t?3:1&t?t:t+1);return this.set(_n(qr(t),e,1,-1/function(t){for(var e=0,n=0,i=t.length;n<i;++n)e+=t[n];return e}(e)),t,t,1,0)},prewittX:function(t){return this.set(Xr(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,Pr(t)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return this.set(Pr(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,Xr(t,1)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,e){return t*=Rn,this.set(_n(Wr(e=null==e?3:1&e?e:e+1,0),Wr(e,1),En(t),Ln(t)),e,e,1,0)},gradDirectional:null,prewitt:function(t){return this.set(Wr(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,Wr(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return this.set(Xr(t=null==t?3:1&t?t:t+1,1),t,1,1,1,1,t,kr(t)),this._doSeparable=!0,this},sobelY:function(t){return this.set(kr(t=null==t?3:1&t?t:t+1),t,1,1,1,1,t,Xr(t,1)),this._doSeparable=!0,this},sobelDirectional:function(t,e){return t*=Rn,this.set(_n($r(e=null==e?3:1&e?e:e+1,0),$r(e,1),En(t),Ln(t)),e,e,1,0)},sobel:function(t){return this.set($r(t=null==t?3:1&t?t:t+1,0),t,t,1,0,t,t,$r(t,1)),this._isGrad=!0,this},laplace:function(t){return this.set(qr(t=null==t?3:1&t?t:t+1,-1,t*t-1),t,t,1,0),this._doIntegral=1,this},emboss:function(t,e,n){return t=null==t?-.25*An.PI:t*Rn,this.set(function(t,e,n,i){var r,a,o,l,s,u=t*t,c=t>>>1,f=u>>>1,h=new mn(u);for(r=l=0;r<=c;++r,l+=e)for(o=s=a=0;o<=c;++o,a+=t,s+=n)h[f+r+a]=l+s,h[f-r-a]=-l-s,h[f-r+a]=-l+s,h[f+r-a]=l-s;return h[f]=i||1,h}(n=null==n?3:1&n?n:n+1,(e=e||1)*En(t),-e*Ln(t),1),n,n,1,0)},bump:null,edges:function(t){return this.set([0,t=t||1,0,t,-4*t,t,0,t,0],3,3,1,0)},bilateral:function(t,e,n){t=null==t?3:1&t?t:t+1;return this.set(qr(t),t,t,1,0),this._w=(n=n||1,[vn(t,t,t=e||1),-1/(2*n*n),t,n]),this},set:function(t,e,n,i,r,a,o,l){var s=this;return s._isGrad=!1,s._doIntegral=0,s._doSeparable=!1,s._doIntegralSeparable=null,s.matrix2=null,s.dimx2=s.dimy2=0,s._indices2=s._indicesf2=null,s._mat2=s._w=null,s.matrix=new mn(t),null==n&&(n=e),s.dimx=e,s.dimy=n,null==i&&(i=1,r=0),s._coeff[0]=i,s._coeff[1]=r||0,t=Yr(s.matrix,s.dimx,s.dimy),s._indices=t[0],s._indicesf=t[1],s._mat=t[2],l?(s.matrix2=new mn(l),s.dimx2=a,s.dimy2=o,t=Yr(s.matrix2,s.dimx2,s.dimy2),s._indices2=t[0],s._indicesf2=t[1],s._mat2=t[2]):null!=a&&(s.dimx2=a,s.dimy2=o),s._glsl=null,s},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dimx=t.dimy=t.dimx2=t.dimy2=0,t._mat=t._mat2=t._w=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t._doIntegralSeparable=null,t._glsl=null,t},getGLSL:function(){var r=this;function t(t,e,n,i,r,a,o,l,s){var u,c,f,h=[],m=[],p=[],d=t.length,g=n>>>1,n=i>>>1;for(h.push("vec4 col=texture2D(img,  pix);"),c=-g,f=-n,u=0;u<d;)t[u]&&(h.push("vec2 p"+u+"=vec2(pix.x"+_(c,1)+"*dp.x, pix.y"+_(f,1)+"*dp.y); vec3 c"+u+"=vec3(0.0); if (0.0 <= p"+u+".x && 1.0 >= p"+u+".x && 0.0 <= p"+u+".y && 1.0 >= p"+u+".y) c"+u+"=texture2D(img,  p"+u+").rgb;"),m.push(_(t[u],m.length)+"*c"+u)),++u,g<++c&&(c=-g,++f);if(e){for(d=e.length,c=-(g=r>>>1),f=-(a>>>1),u=0;u<d;)e[u]&&(h.push("vec2 pp"+u+"=vec2(pix.x"+_(c,1)+"*dp.x, pix.y"+_(f,1)+"*dp.y); vec3 cc"+u+"=vec3(0.0); if (0.0 <= pp"+u+".x && 1.0 >= pp"+u+".x && 0.0 <= pp"+u+".y && 1.0 >= pp"+u+".y) cc"+u+"=texture2D(img,  pp"+u+").rgb;"),p.push(_(e[u],p.length)+"*cc"+u)),++u,g<++c&&(c=-g,++f);return s?(h.push("vec3 o1="+_(o)+"*("+m.join("")+");"),h.push("vec3 o2="+_(o)+"*("+p.join("")+");"),[h.join("\n"),"vec4(sqrt(o1.x*o1.x+o2.x*o2.x),sqrt(o1.y*o1.y+o2.y*o2.y),sqrt(o1.z*o1.z+o2.z*o2.z),col.a)"]):(h.push("vec3 o1="+m.join("")+";"),h.push("vec3 o2="+p.join("")+";"),[h.join("\n"),"vec4(("+_(o)+"*o1"+_(l,1)+"*o2),col.a)"])}return[h.join("\n"),"vec4(("+_(o)+"*("+m.join("")+")+vec3("+_(l)+")),col.a)"]}var e,n,i,_=Sn.formatFloat,a=r.matrix,o=r.matrix2;return a?r._w?(e=function(t){var e,n,i,r=[],a=[],o=t*t,l=t>>>1;for(r.push("vec4 col=texture2D(img,  pix);"),r.push("float f=0.0; float w; vec3 o=vec3(0.0);"),i=n=-l,e=0;e<o;)r.push(0===n&&0===i?"vec3 c"+e+"=col.rgb;":"vec2 p"+e+"=vec2(pix.x"+_(n,1)+"*dp.x, pix.y"+_(i,1)+"*dp.y); vec3 c"+e+"=col.rgb; if (0.0 <= p"+e+".x && 1.0 >= p"+e+".x && 0.0 <= p"+e+".y && 1.0 >= p"+e+".y) c"+e+"=texture2D(img,  p"+e+").rgb;"),a.push("float wS"+e+"=wS["+e+"]; float wC"+e+"=wC(c"+e+".x-c0.x,c"+e+".y-c0.y,c"+e+".z-c0.z); w = wS"+e+"*wC"+e+"; f += w; o += w*c"+e+";"),++e,l<++n&&(n=-l,++i);return[r.join("\n")+"\n"+a.join("\n"),"vec4(o/f,col.a)"]}(r.dimx),{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform float wS["+r.matrix.length+"];","uniform float fC;","float wC(float r, float g, float b) {return exp(fC*(r*r+g*g+b*b));}","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),vars:function(t,e,n,i){t.uniform1fv(i.uniform.wS,r._w[0]),t.uniform1f(i.uniform.fC,255*r._w[1]*255)}}):(i=r._doIntegralSeparable)?(n=[],e=t(i[0],null,i[1],i[2],i[1],i[2],i[3],i[4],!1),n.push({instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),iterations:r._doIntegral||1}),e=t(i[5],null,i[6],i[7],i[6],i[7],i[8],i[9],!1),n.push({instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),iterations:r._doIntegral||1}),n):r._doSeparable&&o?(n=[],e=t(a,null,r.dimx,r.dimy,r.dimx,r.dimy,r._coeff[0],0,!1),n.push({instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),iterations:1}),e=t(o,null,r.dimx2,r.dimy2,r.dimx2,r.dimy2,r._coeff[1],0,!1),n.push({instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),iterations:1}),n):(e=t(a,o,r.dimx,r.dimy,r.dimx2,r.dimy2,r._coeff[0],r._coeff[1],r._isGrad),{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","void main(void) {",e[0],"gl_FragColor = "+e[1]+";","}"].join("\n"),iterations:r._doIntegral||1}):{instance:r,shader:Sn.DEFAULT}},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(gn(e.matrix,t.matrix),e.dimx*t.dimx,e.dimy*t.dimy,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dimx,t.dimy,t._coeff[0],t._coeff[1]):e},_apply_weighted:function(t,e,n,i,r,a){for(var o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C=t.length,b=new pn(C),S=e-1,A=n-1,R=i>>>1,I=i*i,w=An.exp,L=(hn.GRAY,this.mode,0),E=0,D=0,T=0;T<C;T+=4,++L){for(e<=L&&(L=0,++E,D+=e),u=t[T],c=t[T+1],f=t[T+2],s=(l=o=-R)*e,v=g=d=p=y=0;v<I;++v,++o)R<o&&(o=-R,++l,s+=e),_=L+o<0||S<L+o||E+l<0||A<E+l?(h=u,m=c,f):(h=t[_=L+o+D+s<<2],m=t[1+_],t[2+_]),y+=x=r[v]*w(a*((x=h-u)*x+(x=m-c)*x+(x=_-f)*x)),p+=x*h,d+=x*m,g+=x*_;p/=y,d/=y,g/=y,bn&&(p=p<0?0:255<p?255:p,d=d<0?0:255<d?255:d,g=g<0?0:255<g?255:g),b[T]=0|p,b[T+1]=0|d,b[T+2]=0|g,b[T+3]=t[T+3]}return b},_apply:function(t,e,F){var n=this,H=n.mode;if(!n.matrix)return t;if(n._w)return n._apply_weighted(t,e,F,n.dimx,n._w[0],n._w[1]);if(n._doIntegral)return n.matrix2?xn(H,t,e,F,2,n.matrix,n.matrix2,n.dimx,n.dimy,n.dimx2,n.dimy2,n._coeff[0],n._coeff[1],n._doIntegral):xn(H,t,e,F,2,n.matrix,null,n.dimx,n.dimy,n.dimx,n.dimy,n._coeff[0],n._coeff[1],n._doIntegral);if(n._doSeparable)return yn(H,t,e,F,2,n._mat,n._mat2,n._indices,n._indices2,n._coeff[0],n._coeff[1]);var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,U,S,A,R,B,I,w,z,L=t.length,F=L>>>2,E=new pn(L),D=e-1,T=F-e,M=n._coeff[0],G=n._coeff[1],O=n._mat,N=n._mat2,Y=n._isGrad;if(hn.GRAY===H)if(N){for(S=n._indices.length,R=new dn(n._indices),s=0;s<S;s+=2)R[s+1]*=e;for(A=O.length,B=n._indices2.length,w=new dn(n._indices2),s=0;s<B;s+=2)w[s+1]*=e;for(I=N.length,c=u=0,z=Tn(A,I),o=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=v=x=y=C=0;s<z;++s,l+=2)s<A&&(m=u+R[l],p=c+R[l+1],0<=m)&&m<=D&&0<=p&&p<=T&&(b=O[s],g+=t[d=m+p<<2]*b),s<I&&(m=u+w[l],p=c+w[l+1],0<=m)&&m<=D&&0<=p&&p<=T&&(b=N[s],x+=t[d=m+p<<2]*b);i=Y?(g=In(g),x=In(x),(h=Tn(g,x))?h*(1+.43*(f=Dn(g,x))/h*f/h):0):M*g+G*x,E[o]=0|(i=bn?i<0?0:255<i?255:i:i),E[o+1]=0|i,E[o+2]=0|i,E[o+3]=t[o+3]}}else{for(S=n._indices.length,R=new dn(n._indices),s=0;s<S;s+=2)R[s+1]*=e;for(A=O.length,o=c=u=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=v=0;s<A;++s,l+=2)m=u+R[l],p=c+R[l+1],m<0||D<m||p<0||T<p||(b=O[s],g+=t[d=m+p<<2]*b);i=M*g+G,E[o]=0|(i=bn?i<0?0:255<i?255:i:i),E[o+1]=0|i,E[o+2]=0|i,E[o+3]=t[o+3]}}else if(N){for(S=n._indices.length,R=new dn(n._indices),s=0;s<S;s+=2)R[s+1]*=e;for(A=O.length,B=n._indices2.length,w=new dn(n._indices2),s=0;s<B;s+=2)w[s+1]*=e;for(I=N.length,c=u=0,z=Tn(A,I),o=0;o<L;o+=4,++u){for(e<=u&&(u=0,c+=e),l=s=g=_=v=x=y=C=0;s<z;++s,l+=2)s<A&&(m=u+R[l],p=c+R[l+1],0<=m)&&m<=D&&0<=p&&p<=T&&(b=O[s],g+=t[d=m+p<<2]*b,_+=t[d+1]*b,v+=t[d+2]*b),s<I&&(m=u+w[l],p=c+w[l+1],0<=m)&&m<=D&&0<=p&&p<=T&&(U=N[s],x+=t[d=m+p<<2]*U,y+=t[d+1]*U,C+=t[d+2]*U);a=Y?(g=In(g),x=In(x),i=(h=Tn(g,x))?h*(1+.43*(f=Dn(g,x))/h*f/h):0,_=In(_),y=In(y),r=(h=Tn(_,y))?h*(1+.43*(f=Dn(_,y))/h*f/h):0,v=In(v),C=In(C),(h=Tn(v,C))?h*(1+.43*(f=Dn(v,C))/h*f/h):0):(i=M*g+G*x,r=M*_+G*y,M*v+G*C),bn&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),E[o]=0|i,E[o+1]=0|r,E[o+2]=0|a,E[o+3]=t[o+3]}}else{for(S=n._indices.length,R=new dn(n._indices),s=0;s<S;s+=2)R[s+1]*=e;for(A=O.length,o=c=u=0;o<L;o+=4,u++){for(e<=u&&(u=0,c+=e),l=s=g=_=v=0;s<A;s++,l+=2)m=u+R[l],p=c+R[l+1],m<0||D<m||p<0||T<p||(b=O[s],g+=t[d=m+p<<2]*b,_+=t[d+1]*b,v+=t[d+2]*b);i=M*g+G,r=M*_+G,a=M*v+G,bn&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),E[o]=0|i,E[o+1]=0|r,E[o+2]=0|a,E[o+3]=t[o+3]}}return E}})).prototype.gradX=r.prototype.prewittX,r.prototype.gradY=r.prototype.prewittY,r.prototype.gradDirectional=r.prototype.prewittDirectional,r.prototype.grad=r.prototype.prewitt,r.prototype.bump=r.prototype.emboss,r.prototype.boxBlur=r.prototype.lowPass,r.prototype.gaussBlur=r.prototype.gauss,Nn=(Gn=M).MODE,Fn=Gn.ImArray,Hn=Gn.Util.Array.copy,Un=Gn.Util.GLSL,Bn=Gn.Array8U,b=Gn.Array32I,zn=Math.sqrt,Yn=Gn.Util.Array.typed,Gn.Util.Filter.primitive_morphology_operator,Pn=Vr(3),Gn.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.mode=Nn.RGB},path:Gn.Path,_filterName:null,_filter:null,_dim:0,_dim2:0,_iter:1,_structureElement:null,_indices:null,_structureElement2:null,_indices2:null,mode:Nn.RGB,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._dim2=null,t._iter=null,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_dim2:t._dim2,_iter:t._iter,_structureElement:t._structureElement,_indices:t._indices,_structureElement2:t._structureElement2,_indices2:t._indices2}},unserialize:function(t){var e=this;return e._dim=t._dim,e._dim2=t._dim2,e._iter=t._iter,e._structureElement=Yn(t._structureElement,Bn),e._indices=Yn(t._indices,b),e._structureElement2=Yn(t._structureElement2,Bn),e._indices2=Yn(t._indices2,b),e._filterName=t._filterName,e._filterName&&On[e._filterName]&&(e._filter=On[e._filterName]),e},erode:function(t,e,n){return this.set("erode",t,e||null,n)},dilate:function(t,e,n){return this.set("dilate",t,e||null,n)},opening:function(t,e,n){return this.set("open",t,e||null,n)},closing:function(t,e,n){return this.set("close",t,e||null,n)},gradient:function(t){return this.set("gradient",t)},laplacian:function(t){return this.set("laplacian",t)},set:function(t,e,n,i){var r=this,a=(r._dim2=0,r._structureElement2=null,r._indices2=null,r._iter=0|i||1,r._filterName=t,r._filter=On[t],e&&e.length?(r._structureElement=new Bn(e),r._dim=zn(r._structureElement.length)+.5|0):e&&e===+e?(r._structureElement=Vr(e),r._dim=e):(r._structureElement=Pn,r._dim=3),n&&n.length?(r._structureElement2=new Bn(n),r._dim2=zn(r._structureElement2.length)+.5|0):n&&n===+n&&(r._structureElement2=Vr(n),r._dim2=n),[]),o=(e=r._structureElement).length,l=(f=r._dim)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));if(r._indices=new b(a),r._structureElement2){var s,u,c,f,a=[],o=(e=r._structureElement2).length,l=(f=r._dim2)>>>1;for(s=c=u=0;s<o;++s,++u)f<=u&&(u=0,++c),e[s]&&(a.push(u-l),a.push(c-l));r._indices2=new b(a)}return r._glsl=null,r},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._dim2=0,t._iter=1,t._structureElement=null,t._indices=null,t._structureElement2=null,t._indices2=null,t._glsl=null,t},getGLSL:function(){var r=this;function a(t,e,n,i,r){var a,o,l,s,u,c=[],f=t.length,h=e,m=h>>>1;for(c.push("int apply=1;"),c.push("vec4 res=vec4("+i+");"),c.push("float alpha=1.0;"),l=o=a=0,r=r||"img";l<f;)s=a-m,u=o-m,(t[l]||0==s&&0==u)&&c.push("if (1==apply){vec2 p"+l+"=vec2(pix.x"+p(s,1)+"*dp.x, pix.y"+p(u,1)+"*dp.y); vec4 c"+l+"=vec4(0.0); if (0.0 <= p"+l+".x && 1.0 >= p"+l+".x && 0.0 <= p"+l+".y && 1.0 >= p"+l+".y) {c"+l+"=texture2D("+r+",p"+l+");} else {apply=0;} res="+n+"(res, c"+l+");"+(0==s&&0==u?" alpha=c"+l+".a;":"")+"}"),++l,h<=++a&&(a=0,++o);return c.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D("+r+",pix);"),c.join("\n")}function t(t,e,n,i){return{instance:r,shader:["varying vec2 pix;","uniform sampler2D "+(n||"img")+";","uniform vec2 dp;","void main(void) {","dilate"===e?a(t,r._dim,"max","0.0",n):a(t,r._dim,"min","1.0",n),"}"].join("\n"),iterations:r._iter||1,_usesPrev:!!i}}var e,p=Un.formatFloat;if(!r._dim)return{instance:r,shader:Un.DEFAULT};switch(r._filterName){case"dilate":e=t(r._structureElement,"dilate");break;case"erode":e=t(r._structureElement,"erode");break;case"open":e=[t(r._structureElement,"erode"),t(r._structureElement,"dilate")];break;case"close":e=[t(r._structureElement,"dilate"),t(r._structureElement,"erode")];break;case"gradient":e=[t(r._structureElement,"dilate"),t(r._structureElement,"erode","_img_prev",!0),{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D _img_prev;","void main(void) {","vec4 dilate = texture2D(_img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate-erode)*0.5).rgb, erode.a);","}"].join("\n"),_usesPrev:!0}];break;case"laplacian":e=[t(r._structureElement,"dilate"),t(r._structureElement,"erode","_img_prev",!0),{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D _img_prev;","uniform sampler2D _img_prev_prev;","void main(void) {","vec4 original = texture2D(_img_prev_prev, pix);","vec4 dilate = texture2D(_img_prev, pix);","vec4 erode = texture2D(img, pix);","gl_FragColor = vec4(((dilate+erode-2.0*original)*0.5).rgb, original.a);","}"].join("\n"),_usesPrev:!0}];break;default:e={instance:r}}return e},_apply:function(t,e,n){return this._dim&&this._filter?this._filter(this,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),Gn.Util.Filter.primitive_morphology_operator=Kr,On={dilate:function(t,e,n,i){for(var r=null,a=new Fn(e.length),o=t._indices,l=o.length,s=new b(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,r=new b(l),u=0;u<l;u+=2)r[u]=o[u],r[u+1]=o[u+1]*n;return Kr(t.mode,e,a,n,0,2,s,r,Math.max,0,t._iter),a},erode:function(t,e,n,i){for(var r=null,a=new Fn(e.length),o=t._indices,l=o.length,s=new b(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,r=new b(l),u=0;u<l;u+=2)r[u]=o[u],r[u+1]=o[u+1]*n;return Kr(t.mode,e,a,n,0,2,s,r,Math.min,255,t._iter),a},open:function(t,e,n,i){for(var r=null,a=new Fn(e.length),o=t._indices,l=o.length,s=new b(l),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,r=new b(l),u=0;u<l;u+=2)r[u]=o[u],r[u+1]=o[u+1]*n;Kr(t.mode,e,a,n,0,2,s,r,Math.min,255,t._iter);var c=e;return Kr(t.mode,e=a,a=c,n,0,2,s,r,Math.max,0,t._iter),a},close:function(t,e,n,i){for(var r=null,a=new Fn(e.length),o=t._indices,l=o.length,s=new b(coverArea2),u=0;u<l;u+=2)s[u]=o[u],s[u+1]=o[u+1]*n;if(t._indices2)for(l=(o=t._indices2).length,r=new b(l),u=0;u<l;u+=2)r[u]=o[u],r[u+1]=o[u+1]*n;Kr(t.mode,e,a,n,0,2,s,r,Math.max,0,t._iter);var c=e;return Kr(t.mode,e=a,a=c,n,0,2,s,r,Math.min,255,t._iter),a},gradient:function(t,e,n,i){for(var r,a=null,o=e.length,l=new Fn(o),s=t._indices,u=s.length,c=new b(u),f=0;f<u;f+=2)c[f]=s[f],c[f+1]=s[f+1]*n;if(t._indices2)for(u=(s=t._indices2).length,a=new b(u),f=0;f<u;f+=2)a[f]=s[f],a[f+1]=s[f+1]*n;for(r=Hn(e),Kr(t.mode,r,l,n,0,2,c,a,Math.max,0,t._iter),Kr(t.mode,e,r,n,0,2,c,a,Math.min,255,t._iter),f=0;f<o;f+=4)l[f]=(l[f]-r[f])/2|0,l[f+1]=(l[f+1]-r[f+1])/2|0,l[f+2]=(l[f+2]-r[f+2])/2|0;return l},laplacian:function(t,e,n,i){for(var r,a=null,o=e.length,l=new Fn(o),s=new Fn(o),u=t._indices,c=u.length,f=new b(c),h=0;h<c;h+=2)f[h]=u[h],f[h+1]=u[h+1]*n;if(t._indices2)for(c=(u=t._indices2).length,a=new b(c),h=0;h<c;h+=2)a[h]=u[h],a[h+1]=u[h+1]*n;for(r=Hn(e),Kr(t.mode,r,s,n,0,2,f,a,Math.max,0,t._iter),r=Hn(e),Kr(t.mode,r,l,n,0,2,f,a,Math.min,255,t._iter),h=0;h<o;h+=4)l[h]=(l[h]+s[h]-2*e[h])/2|0,l[h+1]=(l[h+1]+s[h+1]-2*e[h+1])/2|0,l[h+2]=(l[h+2]+s[h+2]-2*e[h+2])/2|0;return l}},kn=(A=M).MODE,jn=A.ImArray,$n=A.Array32I,Wn=A.Array32U,qn=A.Util.GLSL,Vn=A.Util.Array.typed,Kn=Math,Zn=Kn.min,Qn=Kn.max,(A=A.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=kn.RGB},path:A.Path,d:0,k:0,_filter:null,_indices:null,mode:kn.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){return{d:this.d,k:this.k,_filter:this._filter,_indices:this._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=Vn(t._indices,$n),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||0,n.k=e=Zn(1,Qn(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";for(var i=t*t<<1,r=t>>>1,a=new $n(i),o=0,l=0,s=0;s<i;s+=2,++o)t<=o&&(o=0,++l),a[s]=o-r,a[s+1]=l-r;return n._indices=a,n._glsl=null,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t._glsl=null,t},getGLSL:function(){return r=this,v=qn.formatFloat,x=qn.staticSort,r.d?(e=r._filter,{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 dp;","uniform int isColored;","void main(void) {","1th"===e?t(r.d,"max","0.0"):"0th"===e?t(r.d,"min","1.0"):function(t,e){var n=[],i=[],r=[],a=[],o="c0",l,s,u,c,f,h,m,p,d=t*t,g=t,_=g>>>1,l=0,s=0,u=0;while(u<d){c=l-_;f=s-_;n.push("vec2 p"+u+"=vec2(pix.x"+v(c,1)+"*dp.x, pix.y"+v(f,1)+"*dp.y); vec4 c"+u+"=vec4(0.0); if (0.0 <= p"+u+".x && 1.0 >= p"+u+".x && 0.0 <= p"+u+".y && 1.0 >= p"+u+".y) c"+u+"=texture2D(img,  p"+u+"); float c"+u+"r=c"+u+".r; float c"+u+"g=c"+u+".g; float c"+u+"b=c"+u+".b;");i.push("c"+u+"r");r.push("c"+u+"g");a.push("c"+u+"b");if(0===c&&0===f)o="c"+u+".a";++u;++l;if(l>=g){l=0;++s}}return n.push("float t=0.0;"),n.push(x(i,"t").join("\n")),n.push("if (1==isColored) {"),n.push(x(r,"t").join("\n")),n.push(x(a,"t").join("\n")),n.push("}"),n.push("float rkth=c"+Kn.round(e*(d-1))+"r;"),n.push("float gkth=rkth;"),n.push("float bkth=rkth;"),n.push("if (1==isColored) {"),n.push("gkth=c"+Kn.round(e*(d-1))+"g;"),n.push("bkth=c"+Kn.round(e*(d-1))+"b;"),n.push("}"),n.push("gl_FragColor = vec4(rkth,gkth,bkth,"+o+");"),n.join("\n")}(r.d,r.k),"}"].join("\n"),vars:function(t,e,n,i){t.uniform1i(i.uniform.isColored,kn.GRAY!==r.mode?1:0)}}):{instance:r,shader:qn.DEFAULT};function t(t,e,n){var i,r,a,o,l,s=[],u=t*t,c=t,f=c>>>1;for(s.push("int apply=1;"),s.push("vec4 res=vec4("+n+");"),s.push("float alpha=1.0;"),a=r=i=0;a<u;)l=r-f,s.push("if (1==apply){vec2 p"+a+"=vec2(pix.x"+v(o=i-f,1)+"*dp.x, pix.y"+v(l,1)+"*dp.y); vec4 c"+a+"=vec4(0.0); if (0.0 <= p"+a+".x && 1.0 >= p"+a+".x && 0.0 <= p"+a+".y && 1.0 >= p"+a+".y) {c"+a+"=texture2D(img,p"+a+");} else {apply=0;} res="+e+"(res, c"+a+");"+(0==o&&0==l?" alpha=c"+a+".a;":"")+"}"),++a,c<=++i&&(i=0,++r);return s.push("if (1==apply) gl_FragColor = vec4(res.rgb,alpha); else gl_FragColor = texture2D(img,pix);"),s.join("\n")}var r,e,v,x},_apply:function(t,e,n){var i=this;return i.d?"0th"===i._filter||"1th"===i._filter?Xn["01th"](i,t,e,n):Xn[i._filter](i,t,e,n):t},canRun:function(){return this._isOn&&this.d}})).prototype.erode=A.prototype.minimum,A.prototype.dilate=A.prototype.maximum,Xn={"01th":function(t,e,n,i){t.d;for(var r,a,o,l,s,u,c,f,h,m,p,d,g,_=e.length,v=_>>>2,x=new jn(_),y=n-1,C=v-n,b=t._indices,S=b.length,A=new $n(S),R="0th"===t._filter?(g=Zn,255):(g=Qn,0),I=0;I<S;I+=2)A[I]=b[I],A[I+1]=b[I+1]*n;if(kn.GRAY===t.mode)for(o=a=r=0;r<_;r+=4,++a){for(n<=a&&(a=0,o+=n),p=R,I=0;I<S;I+=2)l=a+A[I],s=o+A[I+1],l<0||y<l||s<0||C<s||(p=g(e[u=l+s<<2],p));x[r]=p,x[r+1]=p,x[r+2]=p,x[r+3]=e[r+3]}else for(o=a=r=0;r<_;r+=4,++a){for(n<=a&&(a=0,o+=n),m=p=d=R,I=0;I<S;I+=2)l=a+A[I],s=o+A[I+1],l<0||y<l||s<0||C<s||(c=e[u=l+s<<2],f=e[u+1],h=e[u+2],m=g(c,m),p=g(f,p),d=g(h,d));x[r]=m,x[r+1]=p,x[r+2]=d,x[r+3]=e[r+3]}return x},kth:function(t,e,n,F){t.d;for(var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I=t.k,w=e.length,L=w>>>2,E=new jn(w),D=n-1,T=L-n,M=t._indices,G=M.length,L=G>>>1,O=new $n(G),N=0;N<G;N+=2)O[N]=M[N],O[N+1]=M[N+1]*n;if(kn.GRAY===t.mode)for(g=new jn(L),b=new Wn(256),a=r=i=0;i<w;i+=4,++r){for(n<=r&&(r=0,a+=n),N=x=A=0;N<G;N+=2)o=r+O[N],l=a+O[N+1],o<0||D<o||l<0||T<l||(++A,++b[c=e[s=o+l<<2]],1===b[c]&&Zr(g,x++,c));for(A*=I,R=0,m=-1,N=x;0<N;--N)R+=b[c=Qr(g,N)],m<(b[c]=0)&&A<=R&&(m=c);E[i]=m,E[i+1]=m,E[i+2]=m,E[i+3]=e[i+3]}else for(d=new jn(L),g=new jn(L),_=new jn(L),C=new Wn(256),b=new Wn(256),S=new Wn(256),a=r=i=0;i<w;i+=4,++r){for(n<=r&&(r=0,a+=n),N=v=x=y=A=0;N<G;N+=2)o=r+O[N],l=a+O[N+1],o<0||D<o||l<0||T<l||(u=e[s=o+l<<2],c=e[s+1],f=e[s+2],++C[u],++b[c],++S[f],++A,1===C[u]&&Zr(d,v++,u),1===b[c]&&Zr(g,x++,c),1===S[f]&&Zr(_,y++,f));for(A*=I,R=0,h=-1,N=v;0<N;--N)R+=C[u=Qr(d,N)],h<(C[u]=0)&&A<=R&&(h=u);for(R=0,m=-1,N=x;0<N;--N)R+=b[c=Qr(g,N)],m<(b[c]=0)&&A<=R&&(m=c);for(R=0,p=-1,N=y;0<N;--N)R+=S[f=Qr(_,N)],p<(S[f]=0)&&A<=R&&(p=f);E[i]=h,E[i+1]=m,E[i+2]=p,E[i+3]=e[i+3]}return E}},ti=(Jn=M).Util.GLSL,ei=Object.prototype.hasOwnProperty,Jn.Create({name:"InlineFilter",init:function(t,e){this._params={},this.set(t,e)},path:Jn.Path,_filter:null,_params:null,_changed:!1,dispose:function(){return this._filter=null,this._params=null,this._changed=null,this.$super("dispose"),this},serialize:function(){var t={_filter:!1!==this._filter&&(this._changed&&this._filter?(this._filter.filter||this._filter).toString():null),_params:this._params};return this._changed=!1,t},unserialize:function(t){return null!=t._filter&&(this._filter=!1===t._filter?null:new Function("FILTER",'"use strict"; return '+t._filter+";")(Jn)),this._params=t._params||{},this},params:function(t){if(arguments.length){for(var e in t)ei.call(t,e)&&(this._params[e]=t[e]);return this}return this._params},set:function(t,e){return!1===t?(this._filter=!1,this._changed=!0,this._glsl=null):(!t||"function"!=typeof t&&"function"!=typeof t.filter||(this._filter=t,this._changed=!0,this._glsl=null),e&&this.params(e)),this},getGLSL:function(){var t=this._filter;return t&&t.shader?{instance:this,shader:t.shader,textures:t.textures,vars:t.vars}:{instance:this,shader:t?null:ti.DEFAULT}},_apply:function(t,e,n,i){var r=this._filter;return r?(r="function"==typeof r.filter?r.filter:r)(this._params,t,e,n,i):t},canRun:function(){return this._isOn&&this._filter}}),Jn.CustomFilter=Jn.InlineFilter,ni=M._notSupportClamp,(ii=M.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){null==e&&(e=127),this.min=(t=null==t?-127:t)||0,this.max=e||0},path:M.Path,serialize:function(){return{min:this.min,max:this.max}},unserialize:function(t){return this.min=t.min,this.max=t.max,this},apply:function(t,e,n){var i,r,a,o,l,s,u,c,f=ii.random,h=this.max-this.min,m=this.min,p=t.length;if(ni)for(i=0;i<p;i+=4)a=t[i],o=t[i+1],l=t[i+2],(s=a+(r=h*f()+m))<0?s=0:255<s&&(s=255),(u=o+r)<0?u=0:255<u&&(u=255),(c=l+r)<0?c=0:255<c&&(c=255),t[i]=0|s,t[i+1]=0|u,t[i+2]=0|c;else for(i=0;i<p;i+=4)a=t[i],o=t[i+1],l=t[i+2],u=o+(r=h*f()+m),c=l+r,t[i]=0|(s=a+r),t[i+1]=0|u,t[i+2]=0|c;return t}})).random=Math.random,ri=(I=M).MODE,I.Create({name:"PerlinNoiseFilter",mode:ri.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:I.Path,init:function(t,e,n,i,r,a,o,l){this.mode=ri.GRAY,this._baseX=t||1,this._baseY=e||1,this._seed=o||0,this._stitch=!!i,this._fractal=!1!==r,this._perlin=!!l,this.octaves(n||1,a)},seed:function(t){return this._seed=t||0,this},octaves:function(t,e){for(this._octaves=t||1,this._offsets=e?e.slice(0):[];this._offsets.length<this._octaves;)this._offsets.push([0,0]);return this},seamless:function(t){return this._stitch=!!(t=arguments.length?t:!0),this},colors:function(t){return this.mode=(t=arguments.length?t:!0)?ri.COLOR:ri.GRAY,this},turbulence:function(t){return this._fractal=!(t=arguments.length?t:!0),this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){return{_baseX:this._baseX,_baseY:this._baseY,_octaves:this._octaves,_offsets:this._offsets,_seed:this._seed||0,_stitch:this._stitch,_fractal:this._fractal,_perlin:this._perlin}},unserialize:function(t){return this._baseX=t._baseX,this._baseY=t._baseY,this._octaves=t._octaves,this._offsets=t._offsets,this._seed=t._seed||0,this._stitch=t._stitch,this._fractal=t._fractal,this._perlin=t._perlin,this},apply:function(t,e,n){var i=this;return i._seed&&(la.seed(i._seed),i._seed=0),la(t,e,n,i._stitch,ri.COLOR!==i.mode,i._baseX,i._baseY,i._octaves,i._offsets,1,.5,i._perlin)}}),L=Math,ai=L.floor,L.sin,L.cos,I.CONST.PI2,L=I.Array8U,oi=new L([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),S=new L(oi),la.seed=function(t){var e,n;for(0<t&&t<1&&(t*=65536),(t=ai(t))<256&&(t|=t<<8),n=0;n<256;++n)e=1&n?oi[n]^255&t:oi[n]^t>>8&255,S[n]=S[n+256]=e},t=Math,li=t.min,si=t.floor,ui=M.Util.GLSL,fi=M.MODE,M.Create({name:"ChannelCopyFilter",srcChannel:(ci=M.CHANNEL).R,dstChannel:ci.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:M.Path,init:function(t,e,n,i,r){this.srcChannel=t||ci.R,this.dstChannel=e||ci.R,this.centerX=n||0,this.centerY=i||0,this.color=r||0},dispose:function(){return this.srcChannel=null,this.dstChannel=null,this.centerX=null,this.centerY=null,this.color=null,this.$super("dispose"),this},serialize:function(){return{srcChannel:this.srcChannel,dstChannel:this.dstChannel,centerX:this.centerX,centerY:this.centerY,color:this.color}},unserialize:function(t){return this.srcChannel=t.srcChannel,this.dstChannel=t.dstChannel,this.centerX=t.centerX,this.centerY=t.centerY,this.color=t.color,this},getGLSL:function(){var o=this;return o.color,o.input("source")?{instance:o,shader:["varying vec2 pix;","uniform sampler2D img;","uniform sampler2D src;","uniform vec2 srcSize;","uniform vec2 center;","uniform vec4 color;","uniform int sC;","uniform int tC;","#define COLOR32 "+fi.COLOR32,"#define COLOR8 "+fi.COLOR8,"#define MASK32 "+fi.COLORMASK32,"#define MASK8 "+fi.COLORMASK8,"#define RED "+ci.R,"#define GREEN "+ci.G,"#define BLUE "+ci.B,"#define ALPHA "+ci.A,"uniform int mode;","void main(void) {","   vec4 tCol = texture2D(img, pix);","   vec2 p = (pix - (center - 0.5*srcSize))/srcSize;","   if (0.0 > p.x || 1.0 < p.x || 0.0 > p.y || 1.0 < p.y) {","       if (MASK32 == mode) {tCol *= color;}","       else if (COLOR32 == mode) {tCol = color;}","       else if (MASK8 == mode) {","           if (ALPHA == tC) tCol.a *= color.a;","           else if (BLUE == tC) tCol.b *= color.b;","           else if (GREEN == tC) tCol.g *= color.g;","           else tCol.r *= color.r;","       }","       else if (COLOR8 == mode) {","           if (ALPHA == tC) tCol.a = color.a;","           else if (BLUE == tC) tCol.b = color.b;","           else if (GREEN == tC) tCol.g = color.g;","           else tCol.r = color.r;","       }","   } else {","       vec4 sCol = texture2D(src, p);","       if (ALPHA == sC) {","           if (ALPHA == tC) tCol.a = sCol.a;","           else if (BLUE == tC) tCol.b = sCol.a;","           else if (GREEN == tC) tCol.g = sCol.a;","           else tCol.r = sCol.a;","       } else if (BLUE == sC) {","           if (ALPHA == tC) tCol.a = sCol.b;","           else if (BLUE == tC) tCol.b = sCol.b;","           else if (GREEN == tC) tCol.g = sCol.b;","           else tCol.r = sCol.b;","       } else if (GREEN == sC) {","           if (ALPHA == tC) tCol.a = sCol.g;","           else if (BLUE == tC) tCol.b = sCol.g;","           else if (GREEN == tC) tCol.g = sCol.g;","           else tCol.r = sCol.g;","       } else {","           if (ALPHA == tC) tCol.a = sCol.r;","           else if (BLUE == tC) tCol.b = sCol.r;","           else if (GREEN == tC) tCol.g = sCol.r;","           else tCol.r = sCol.r;","       }","   }","   gl_FragColor = tCol;","}"].join("\n"),textures:function(t,e,n,i){var r=o.input("source");ui.uploadTexture(t,r[0],r[1],r[2],1)},vars:function(t,e,n,i){var r=o.input("source"),a=o.color||0;t.uniform1i(i.uniform.src,1),t.uniform2f(i.uniform.srcSize,r[1]/e,r[2]/n),t.uniform2f(i.uniform.center,o.centerX,o.centerY),t.uniform1i(i.uniform.sC,o.srcChannel),t.uniform1i(i.uniform.tC,o.dstChannel),fi.COLOR8===o.mode||fi.MASK8===o.mode?t.uniform4f(i.uniform.color,a=(255&a)/255,a,a,a):t.uniform4f(i.uniform.color,(a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255,(a>>>24&255)/255)}}:{instance:o,shader:ui.DEFAULT}},apply:function(t,e,n){var i=this.input("source");if(i){var r,a,o,l,s,u,c,f,h,m=i[0],p=i[1],d=i[2],g=t.length,_=(m.length,this.srcChannel),v=this.dstChannel,x=this.centerX||0,y=this.centerY||0,i=p>>>1,C=d>>>1,b=(li(e,p),li(n,d),this.color||0),S=this.mode,A=fi.COLOR32,R=fi.COLOR8,I=fi.COLORMASK32,w=fi.COLORMASK8;for(A===S||I===S?(h=b>>>24&255,u=b>>>16&255,c=b>>>8&255,f=255&b):R!==S&&w!==S||(b&=255),x=si(x*(e-1))-i,y=si(y*(n-1))-C,r=o=a=0;r<g;r+=4,++a)e<=a&&(a=0,++o),s=o-y,(l=a-x)<0||p<=l||s<0||d<=s?A===S?(t[r]=u,t[r+1]=c,t[r+2]=f,t[r+3]=h):I===S?(t[r]=u&t[r],t[r+1]=c&t[r+1],t[r+2]=f&t[r+2],t[r+3]=h&t[r+3]):R===S?t[r+v]=b:w===S&&(t[r+v]=b&t[r+_]):t[r+v]=m[(l+s*p<<2)+_]}return t}});var sa=M,ua=sa._notSupportClamp,ca=sa.CHANNEL,fa=sa.MODE,ha=sa.Util.Filter,G=(sa.Array32F,Math),ma=G.pow,O=(G.min,G.max,sa.Create({name:"ThresholdFilter",path:sa.Path,hasMeta:!0,mode:fa.INTENSITY,color0:0,color1:null,channel:0,init:function(t,e,n,i){this.mode=t||fa.INTENSITY,this.color0=e||0,null!=n&&(this.color1=n),this.channel=i||0},serialize:function(){return{color0:this.color0,color1:this.color1,channel:this.channel}},unserialize:function(t){return this.color0=t.color0,this.color1=t.color1,this.channel=t.channel,this},metaData:function(t){return t&&sa.isWorker?TypedObj(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?TypedObj(t,1):t,this},_apply_rgb:function(t,e,n){var i,r,a,o,l,s,u,c,f,h=this.color0||0,m=h>>>16&255,p=h>>>8&255,d=255&h,g=this.color1,_=t.length;for(null!=g&&(s=g>>>16&255,u=g>>>8&255,c=255&g),h=ha.histogram(t,ca.R),i=ha.histogram(t,ca.G),r=ha.histogram(t,ca.B),a=ha.otsu(h.bin,h.total,h.min,h.max),o=ha.otsu(i.bin,i.total,i.min,i.max),l=ha.otsu(r.bin,r.total,r.min,r.max),f=0;f<_;f+=4)t[f]<a?t[f]=m:null!=g&&(t[f]=s),t[f+1]<o?t[f+1]=p:null!=g&&(t[f+1]=u),t[f+2]<l?t[f+2]=d:null!=g&&(t[f+2]=c);return this.meta=[a,o,l],t},apply:function(t,e,n){if(fa.RGB===this.mode)return this._apply_rgb(t,e,n);var i,r,a,o,l,s,u,c,f,h,m,p,e=this.color0||0,d=e>>>16&255,g=e>>>8&255,_=255&e,v=this.color1,x=t.length,y=this.channel||0,n=this.mode;if(null!=v&&(u=v>>>16&255,c=v>>>8&255,f=255&v),fa.GRAY===n||fa.CHANNEL===n)h=ha.histogram(t,y);else{for(m=0;m<x;m+=4)o=0+.299*(i=t[m])+.587*(r=t[m+1])+.114*(a=t[m+2])|0,l=128-.168736*i-.331264*r+.5*a|0,s=128+.5*i-.418688*r-.081312*a|0,ua&&(s=s<0?0:255<s?255:s,o=o<0?0:255<o?255:o,l=l<0?0:255<l?255:l),t[m]=s,t[m+1]=o,t[m+2]=l;h=ha.histogram(t,ca.G)}if(p=ha.otsu(h.bin,h.total,h.min,h.max),fa.GRAY===n)for(m=0;m<x;m+=4)t[m+y]<p?(t[m]=d,t[m+1]=g,t[m+2]=_):null!=v&&(t[m]=u,t[m+1]=c,t[m+2]=f);else if(fa.CHANNEL===n)for(m=0;m<x;m+=4)t[m+y]<p?t[m+y]=2===y?_:1===y?g:d:null!=v&&(t[m+y]=2===y?f:1===y?c:u);else for(m=0;m<x;m+=4)s=t[m],o=t[m+1],l=t[m+2],o<p?(t[m]=d,t[m+1]=g,t[m+2]=_):null!=v?(t[m]=u,t[m+1]=c,t[m+2]=f):(i=o+1.402*(s-128)|0,r=o-.34414*(l-128)-.71414*(s-128)|0,a=o+1.772*(l-128)|0,ua&&(i=i<0?0:255<i?255:i,r=r<0?0:255<r?255:r,a=a<0?0:255<a?255:a),t[m]=i,t[m+1]=r,t[m+2]=a);return this.meta=[p],t}}),ha.otsu=function(t,e,n,i){var r,a,o,l,s,u,c,f,h;for(null==i&&(i=255),o=0,f=n=null==n?0:n;f<=i;++f)o+=f*t[f]/e;for(u=t[h=n],c=n*t[n]/e,l=(r=u/e)*(a=1-r)*ma((o-c)/a-c/r,2),f=n+1;f<=i;++f)u+=t[f],c+=f*t[f]/e,l<(s=(r=u/e)*(a=1-r)*ma((o-c)/a-c/r,2))&&(l=s,h=f);return h},M),pa=O._notSupportClamp,da=O.CHANNEL,ga=O.MODE,_a=O.Util.Filter,N=(O.Array32F,Math);function va(t,e,n,i,r,a){i|=0,r|=0,a|=0;var o=new zi(256);return o[0]=(R(+n)<=a?i:r)<<2|(R(+e)<=a?i:r)<<1|(R(+t)<=a?i:r)<<0,o[1]=(R(n-1)<=a?i:r)<<2|(R(e-1)<=a?i:r)<<1|(R(t-1)<=a?i:r)<<0,o[2]=(R(n-2)<=a?i:r)<<2|(R(e-2)<=a?i:r)<<1|(R(t-2)<=a?i:r)<<0,o[3]=(R(n-3)<=a?i:r)<<2|(R(e-3)<=a?i:r)<<1|(R(t-3)<=a?i:r)<<0,o[4]=(R(n-4)<=a?i:r)<<2|(R(e-4)<=a?i:r)<<1|(R(t-4)<=a?i:r)<<0,o[5]=(R(n-5)<=a?i:r)<<2|(R(e-5)<=a?i:r)<<1|(R(t-5)<=a?i:r)<<0,o[6]=(R(n-6)<=a?i:r)<<2|(R(e-6)<=a?i:r)<<1|(R(t-6)<=a?i:r)<<0,o[7]=(R(n-7)<=a?i:r)<<2|(R(e-7)<=a?i:r)<<1|(R(t-7)<=a?i:r)<<0,o[8]=(R(n-8)<=a?i:r)<<2|(R(e-8)<=a?i:r)<<1|(R(t-8)<=a?i:r)<<0,o[9]=(R(n-9)<=a?i:r)<<2|(R(e-9)<=a?i:r)<<1|(R(t-9)<=a?i:r)<<0,o[10]=(R(n-10)<=a?i:r)<<2|(R(e-10)<=a?i:r)<<1|(R(t-10)<=a?i:r)<<0,o[11]=(R(n-11)<=a?i:r)<<2|(R(e-11)<=a?i:r)<<1|(R(t-11)<=a?i:r)<<0,o[12]=(R(n-12)<=a?i:r)<<2|(R(e-12)<=a?i:r)<<1|(R(t-12)<=a?i:r)<<0,o[13]=(R(n-13)<=a?i:r)<<2|(R(e-13)<=a?i:r)<<1|(R(t-13)<=a?i:r)<<0,o[14]=(R(n-14)<=a?i:r)<<2|(R(e-14)<=a?i:r)<<1|(R(t-14)<=a?i:r)<<0,o[15]=(R(n-15)<=a?i:r)<<2|(R(e-15)<=a?i:r)<<1|(R(t-15)<=a?i:r)<<0,o[16]=(R(n-16)<=a?i:r)<<2|(R(e-16)<=a?i:r)<<1|(R(t-16)<=a?i:r)<<0,o[17]=(R(n-17)<=a?i:r)<<2|(R(e-17)<=a?i:r)<<1|(R(t-17)<=a?i:r)<<0,o[18]=(R(n-18)<=a?i:r)<<2|(R(e-18)<=a?i:r)<<1|(R(t-18)<=a?i:r)<<0,o[19]=(R(n-19)<=a?i:r)<<2|(R(e-19)<=a?i:r)<<1|(R(t-19)<=a?i:r)<<0,o[20]=(R(n-20)<=a?i:r)<<2|(R(e-20)<=a?i:r)<<1|(R(t-20)<=a?i:r)<<0,o[21]=(R(n-21)<=a?i:r)<<2|(R(e-21)<=a?i:r)<<1|(R(t-21)<=a?i:r)<<0,o[22]=(R(n-22)<=a?i:r)<<2|(R(e-22)<=a?i:r)<<1|(R(t-22)<=a?i:r)<<0,o[23]=(R(n-23)<=a?i:r)<<2|(R(e-23)<=a?i:r)<<1|(R(t-23)<=a?i:r)<<0,o[24]=(R(n-24)<=a?i:r)<<2|(R(e-24)<=a?i:r)<<1|(R(t-24)<=a?i:r)<<0,o[25]=(R(n-25)<=a?i:r)<<2|(R(e-25)<=a?i:r)<<1|(R(t-25)<=a?i:r)<<0,o[26]=(R(n-26)<=a?i:r)<<2|(R(e-26)<=a?i:r)<<1|(R(t-26)<=a?i:r)<<0,o[27]=(R(n-27)<=a?i:r)<<2|(R(e-27)<=a?i:r)<<1|(R(t-27)<=a?i:r)<<0,o[28]=(R(n-28)<=a?i:r)<<2|(R(e-28)<=a?i:r)<<1|(R(t-28)<=a?i:r)<<0,o[29]=(R(n-29)<=a?i:r)<<2|(R(e-29)<=a?i:r)<<1|(R(t-29)<=a?i:r)<<0,o[30]=(R(n-30)<=a?i:r)<<2|(R(e-30)<=a?i:r)<<1|(R(t-30)<=a?i:r)<<0,o[31]=(R(n-31)<=a?i:r)<<2|(R(e-31)<=a?i:r)<<1|(R(t-31)<=a?i:r)<<0,o[32]=(R(n-32)<=a?i:r)<<2|(R(e-32)<=a?i:r)<<1|(R(t-32)<=a?i:r)<<0,o[33]=(R(n-33)<=a?i:r)<<2|(R(e-33)<=a?i:r)<<1|(R(t-33)<=a?i:r)<<0,o[34]=(R(n-34)<=a?i:r)<<2|(R(e-34)<=a?i:r)<<1|(R(t-34)<=a?i:r)<<0,o[35]=(R(n-35)<=a?i:r)<<2|(R(e-35)<=a?i:r)<<1|(R(t-35)<=a?i:r)<<0,o[36]=(R(n-36)<=a?i:r)<<2|(R(e-36)<=a?i:r)<<1|(R(t-36)<=a?i:r)<<0,o[37]=(R(n-37)<=a?i:r)<<2|(R(e-37)<=a?i:r)<<1|(R(t-37)<=a?i:r)<<0,o[38]=(R(n-38)<=a?i:r)<<2|(R(e-38)<=a?i:r)<<1|(R(t-38)<=a?i:r)<<0,o[39]=(R(n-39)<=a?i:r)<<2|(R(e-39)<=a?i:r)<<1|(R(t-39)<=a?i:r)<<0,o[40]=(R(n-40)<=a?i:r)<<2|(R(e-40)<=a?i:r)<<1|(R(t-40)<=a?i:r)<<0,o[41]=(R(n-41)<=a?i:r)<<2|(R(e-41)<=a?i:r)<<1|(R(t-41)<=a?i:r)<<0,o[42]=(R(n-42)<=a?i:r)<<2|(R(e-42)<=a?i:r)<<1|(R(t-42)<=a?i:r)<<0,o[43]=(R(n-43)<=a?i:r)<<2|(R(e-43)<=a?i:r)<<1|(R(t-43)<=a?i:r)<<0,o[44]=(R(n-44)<=a?i:r)<<2|(R(e-44)<=a?i:r)<<1|(R(t-44)<=a?i:r)<<0,o[45]=(R(n-45)<=a?i:r)<<2|(R(e-45)<=a?i:r)<<1|(R(t-45)<=a?i:r)<<0,o[46]=(R(n-46)<=a?i:r)<<2|(R(e-46)<=a?i:r)<<1|(R(t-46)<=a?i:r)<<0,o[47]=(R(n-47)<=a?i:r)<<2|(R(e-47)<=a?i:r)<<1|(R(t-47)<=a?i:r)<<0,o[48]=(R(n-48)<=a?i:r)<<2|(R(e-48)<=a?i:r)<<1|(R(t-48)<=a?i:r)<<0,o[49]=(R(n-49)<=a?i:r)<<2|(R(e-49)<=a?i:r)<<1|(R(t-49)<=a?i:r)<<0,o[50]=(R(n-50)<=a?i:r)<<2|(R(e-50)<=a?i:r)<<1|(R(t-50)<=a?i:r)<<0,o[51]=(R(n-51)<=a?i:r)<<2|(R(e-51)<=a?i:r)<<1|(R(t-51)<=a?i:r)<<0,o[52]=(R(n-52)<=a?i:r)<<2|(R(e-52)<=a?i:r)<<1|(R(t-52)<=a?i:r)<<0,o[53]=(R(n-53)<=a?i:r)<<2|(R(e-53)<=a?i:r)<<1|(R(t-53)<=a?i:r)<<0,o[54]=(R(n-54)<=a?i:r)<<2|(R(e-54)<=a?i:r)<<1|(R(t-54)<=a?i:r)<<0,o[55]=(R(n-55)<=a?i:r)<<2|(R(e-55)<=a?i:r)<<1|(R(t-55)<=a?i:r)<<0,o[56]=(R(n-56)<=a?i:r)<<2|(R(e-56)<=a?i:r)<<1|(R(t-56)<=a?i:r)<<0,o[57]=(R(n-57)<=a?i:r)<<2|(R(e-57)<=a?i:r)<<1|(R(t-57)<=a?i:r)<<0,o[58]=(R(n-58)<=a?i:r)<<2|(R(e-58)<=a?i:r)<<1|(R(t-58)<=a?i:r)<<0,o[59]=(R(n-59)<=a?i:r)<<2|(R(e-59)<=a?i:r)<<1|(R(t-59)<=a?i:r)<<0,o[60]=(R(n-60)<=a?i:r)<<2|(R(e-60)<=a?i:r)<<1|(R(t-60)<=a?i:r)<<0,o[61]=(R(n-61)<=a?i:r)<<2|(R(e-61)<=a?i:r)<<1|(R(t-61)<=a?i:r)<<0,o[62]=(R(n-62)<=a?i:r)<<2|(R(e-62)<=a?i:r)<<1|(R(t-62)<=a?i:r)<<0,o[63]=(R(n-63)<=a?i:r)<<2|(R(e-63)<=a?i:r)<<1|(R(t-63)<=a?i:r)<<0,o[64]=(R(n-64)<=a?i:r)<<2|(R(e-64)<=a?i:r)<<1|(R(t-64)<=a?i:r)<<0,o[65]=(R(n-65)<=a?i:r)<<2|(R(e-65)<=a?i:r)<<1|(R(t-65)<=a?i:r)<<0,o[66]=(R(n-66)<=a?i:r)<<2|(R(e-66)<=a?i:r)<<1|(R(t-66)<=a?i:r)<<0,o[67]=(R(n-67)<=a?i:r)<<2|(R(e-67)<=a?i:r)<<1|(R(t-67)<=a?i:r)<<0,o[68]=(R(n-68)<=a?i:r)<<2|(R(e-68)<=a?i:r)<<1|(R(t-68)<=a?i:r)<<0,o[69]=(R(n-69)<=a?i:r)<<2|(R(e-69)<=a?i:r)<<1|(R(t-69)<=a?i:r)<<0,o[70]=(R(n-70)<=a?i:r)<<2|(R(e-70)<=a?i:r)<<1|(R(t-70)<=a?i:r)<<0,o[71]=(R(n-71)<=a?i:r)<<2|(R(e-71)<=a?i:r)<<1|(R(t-71)<=a?i:r)<<0,o[72]=(R(n-72)<=a?i:r)<<2|(R(e-72)<=a?i:r)<<1|(R(t-72)<=a?i:r)<<0,o[73]=(R(n-73)<=a?i:r)<<2|(R(e-73)<=a?i:r)<<1|(R(t-73)<=a?i:r)<<0,o[74]=(R(n-74)<=a?i:r)<<2|(R(e-74)<=a?i:r)<<1|(R(t-74)<=a?i:r)<<0,o[75]=(R(n-75)<=a?i:r)<<2|(R(e-75)<=a?i:r)<<1|(R(t-75)<=a?i:r)<<0,o[76]=(R(n-76)<=a?i:r)<<2|(R(e-76)<=a?i:r)<<1|(R(t-76)<=a?i:r)<<0,o[77]=(R(n-77)<=a?i:r)<<2|(R(e-77)<=a?i:r)<<1|(R(t-77)<=a?i:r)<<0,o[78]=(R(n-78)<=a?i:r)<<2|(R(e-78)<=a?i:r)<<1|(R(t-78)<=a?i:r)<<0,o[79]=(R(n-79)<=a?i:r)<<2|(R(e-79)<=a?i:r)<<1|(R(t-79)<=a?i:r)<<0,o[80]=(R(n-80)<=a?i:r)<<2|(R(e-80)<=a?i:r)<<1|(R(t-80)<=a?i:r)<<0,o[81]=(R(n-81)<=a?i:r)<<2|(R(e-81)<=a?i:r)<<1|(R(t-81)<=a?i:r)<<0,o[82]=(R(n-82)<=a?i:r)<<2|(R(e-82)<=a?i:r)<<1|(R(t-82)<=a?i:r)<<0,o[83]=(R(n-83)<=a?i:r)<<2|(R(e-83)<=a?i:r)<<1|(R(t-83)<=a?i:r)<<0,o[84]=(R(n-84)<=a?i:r)<<2|(R(e-84)<=a?i:r)<<1|(R(t-84)<=a?i:r)<<0,o[85]=(R(n-85)<=a?i:r)<<2|(R(e-85)<=a?i:r)<<1|(R(t-85)<=a?i:r)<<0,o[86]=(R(n-86)<=a?i:r)<<2|(R(e-86)<=a?i:r)<<1|(R(t-86)<=a?i:r)<<0,o[87]=(R(n-87)<=a?i:r)<<2|(R(e-87)<=a?i:r)<<1|(R(t-87)<=a?i:r)<<0,o[88]=(R(n-88)<=a?i:r)<<2|(R(e-88)<=a?i:r)<<1|(R(t-88)<=a?i:r)<<0,o[89]=(R(n-89)<=a?i:r)<<2|(R(e-89)<=a?i:r)<<1|(R(t-89)<=a?i:r)<<0,o[90]=(R(n-90)<=a?i:r)<<2|(R(e-90)<=a?i:r)<<1|(R(t-90)<=a?i:r)<<0,o[91]=(R(n-91)<=a?i:r)<<2|(R(e-91)<=a?i:r)<<1|(R(t-91)<=a?i:r)<<0,o[92]=(R(n-92)<=a?i:r)<<2|(R(e-92)<=a?i:r)<<1|(R(t-92)<=a?i:r)<<0,o[93]=(R(n-93)<=a?i:r)<<2|(R(e-93)<=a?i:r)<<1|(R(t-93)<=a?i:r)<<0,o[94]=(R(n-94)<=a?i:r)<<2|(R(e-94)<=a?i:r)<<1|(R(t-94)<=a?i:r)<<0,o[95]=(R(n-95)<=a?i:r)<<2|(R(e-95)<=a?i:r)<<1|(R(t-95)<=a?i:r)<<0,o[96]=(R(n-96)<=a?i:r)<<2|(R(e-96)<=a?i:r)<<1|(R(t-96)<=a?i:r)<<0,o[97]=(R(n-97)<=a?i:r)<<2|(R(e-97)<=a?i:r)<<1|(R(t-97)<=a?i:r)<<0,o[98]=(R(n-98)<=a?i:r)<<2|(R(e-98)<=a?i:r)<<1|(R(t-98)<=a?i:r)<<0,o[99]=(R(n-99)<=a?i:r)<<2|(R(e-99)<=a?i:r)<<1|(R(t-99)<=a?i:r)<<0,o[100]=(R(n-100)<=a?i:r)<<2|(R(e-100)<=a?i:r)<<1|(R(t-100)<=a?i:r)<<0,o[101]=(R(n-101)<=a?i:r)<<2|(R(e-101)<=a?i:r)<<1|(R(t-101)<=a?i:r)<<0,o[102]=(R(n-102)<=a?i:r)<<2|(R(e-102)<=a?i:r)<<1|(R(t-102)<=a?i:r)<<0,o[103]=(R(n-103)<=a?i:r)<<2|(R(e-103)<=a?i:r)<<1|(R(t-103)<=a?i:r)<<0,o[104]=(R(n-104)<=a?i:r)<<2|(R(e-104)<=a?i:r)<<1|(R(t-104)<=a?i:r)<<0,o[105]=(R(n-105)<=a?i:r)<<2|(R(e-105)<=a?i:r)<<1|(R(t-105)<=a?i:r)<<0,o[106]=(R(n-106)<=a?i:r)<<2|(R(e-106)<=a?i:r)<<1|(R(t-106)<=a?i:r)<<0,o[107]=(R(n-107)<=a?i:r)<<2|(R(e-107)<=a?i:r)<<1|(R(t-107)<=a?i:r)<<0,o[108]=(R(n-108)<=a?i:r)<<2|(R(e-108)<=a?i:r)<<1|(R(t-108)<=a?i:r)<<0,o[109]=(R(n-109)<=a?i:r)<<2|(R(e-109)<=a?i:r)<<1|(R(t-109)<=a?i:r)<<0,o[110]=(R(n-110)<=a?i:r)<<2|(R(e-110)<=a?i:r)<<1|(R(t-110)<=a?i:r)<<0,o[111]=(R(n-111)<=a?i:r)<<2|(R(e-111)<=a?i:r)<<1|(R(t-111)<=a?i:r)<<0,o[112]=(R(n-112)<=a?i:r)<<2|(R(e-112)<=a?i:r)<<1|(R(t-112)<=a?i:r)<<0,o[113]=(R(n-113)<=a?i:r)<<2|(R(e-113)<=a?i:r)<<1|(R(t-113)<=a?i:r)<<0,o[114]=(R(n-114)<=a?i:r)<<2|(R(e-114)<=a?i:r)<<1|(R(t-114)<=a?i:r)<<0,o[115]=(R(n-115)<=a?i:r)<<2|(R(e-115)<=a?i:r)<<1|(R(t-115)<=a?i:r)<<0,o[116]=(R(n-116)<=a?i:r)<<2|(R(e-116)<=a?i:r)<<1|(R(t-116)<=a?i:r)<<0,o[117]=(R(n-117)<=a?i:r)<<2|(R(e-117)<=a?i:r)<<1|(R(t-117)<=a?i:r)<<0,o[118]=(R(n-118)<=a?i:r)<<2|(R(e-118)<=a?i:r)<<1|(R(t-118)<=a?i:r)<<0,o[119]=(R(n-119)<=a?i:r)<<2|(R(e-119)<=a?i:r)<<1|(R(t-119)<=a?i:r)<<0,o[120]=(R(n-120)<=a?i:r)<<2|(R(e-120)<=a?i:r)<<1|(R(t-120)<=a?i:r)<<0,o[121]=(R(n-121)<=a?i:r)<<2|(R(e-121)<=a?i:r)<<1|(R(t-121)<=a?i:r)<<0,o[122]=(R(n-122)<=a?i:r)<<2|(R(e-122)<=a?i:r)<<1|(R(t-122)<=a?i:r)<<0,o[123]=(R(n-123)<=a?i:r)<<2|(R(e-123)<=a?i:r)<<1|(R(t-123)<=a?i:r)<<0,o[124]=(R(n-124)<=a?i:r)<<2|(R(e-124)<=a?i:r)<<1|(R(t-124)<=a?i:r)<<0,o[125]=(R(n-125)<=a?i:r)<<2|(R(e-125)<=a?i:r)<<1|(R(t-125)<=a?i:r)<<0,o[126]=(R(n-126)<=a?i:r)<<2|(R(e-126)<=a?i:r)<<1|(R(t-126)<=a?i:r)<<0,o[127]=(R(n-127)<=a?i:r)<<2|(R(e-127)<=a?i:r)<<1|(R(t-127)<=a?i:r)<<0,o[128]=(R(n-128)<=a?i:r)<<2|(R(e-128)<=a?i:r)<<1|(R(t-128)<=a?i:r)<<0,o[129]=(R(n-129)<=a?i:r)<<2|(R(e-129)<=a?i:r)<<1|(R(t-129)<=a?i:r)<<0,o[130]=(R(n-130)<=a?i:r)<<2|(R(e-130)<=a?i:r)<<1|(R(t-130)<=a?i:r)<<0,o[131]=(R(n-131)<=a?i:r)<<2|(R(e-131)<=a?i:r)<<1|(R(t-131)<=a?i:r)<<0,o[132]=(R(n-132)<=a?i:r)<<2|(R(e-132)<=a?i:r)<<1|(R(t-132)<=a?i:r)<<0,o[133]=(R(n-133)<=a?i:r)<<2|(R(e-133)<=a?i:r)<<1|(R(t-133)<=a?i:r)<<0,o[134]=(R(n-134)<=a?i:r)<<2|(R(e-134)<=a?i:r)<<1|(R(t-134)<=a?i:r)<<0,o[135]=(R(n-135)<=a?i:r)<<2|(R(e-135)<=a?i:r)<<1|(R(t-135)<=a?i:r)<<0,o[136]=(R(n-136)<=a?i:r)<<2|(R(e-136)<=a?i:r)<<1|(R(t-136)<=a?i:r)<<0,o[137]=(R(n-137)<=a?i:r)<<2|(R(e-137)<=a?i:r)<<1|(R(t-137)<=a?i:r)<<0,o[138]=(R(n-138)<=a?i:r)<<2|(R(e-138)<=a?i:r)<<1|(R(t-138)<=a?i:r)<<0,o[139]=(R(n-139)<=a?i:r)<<2|(R(e-139)<=a?i:r)<<1|(R(t-139)<=a?i:r)<<0,o[140]=(R(n-140)<=a?i:r)<<2|(R(e-140)<=a?i:r)<<1|(R(t-140)<=a?i:r)<<0,o[141]=(R(n-141)<=a?i:r)<<2|(R(e-141)<=a?i:r)<<1|(R(t-141)<=a?i:r)<<0,o[142]=(R(n-142)<=a?i:r)<<2|(R(e-142)<=a?i:r)<<1|(R(t-142)<=a?i:r)<<0,o[143]=(R(n-143)<=a?i:r)<<2|(R(e-143)<=a?i:r)<<1|(R(t-143)<=a?i:r)<<0,o[144]=(R(n-144)<=a?i:r)<<2|(R(e-144)<=a?i:r)<<1|(R(t-144)<=a?i:r)<<0,o[145]=(R(n-145)<=a?i:r)<<2|(R(e-145)<=a?i:r)<<1|(R(t-145)<=a?i:r)<<0,o[146]=(R(n-146)<=a?i:r)<<2|(R(e-146)<=a?i:r)<<1|(R(t-146)<=a?i:r)<<0,o[147]=(R(n-147)<=a?i:r)<<2|(R(e-147)<=a?i:r)<<1|(R(t-147)<=a?i:r)<<0,o[148]=(R(n-148)<=a?i:r)<<2|(R(e-148)<=a?i:r)<<1|(R(t-148)<=a?i:r)<<0,o[149]=(R(n-149)<=a?i:r)<<2|(R(e-149)<=a?i:r)<<1|(R(t-149)<=a?i:r)<<0,o[150]=(R(n-150)<=a?i:r)<<2|(R(e-150)<=a?i:r)<<1|(R(t-150)<=a?i:r)<<0,o[151]=(R(n-151)<=a?i:r)<<2|(R(e-151)<=a?i:r)<<1|(R(t-151)<=a?i:r)<<0,o[152]=(R(n-152)<=a?i:r)<<2|(R(e-152)<=a?i:r)<<1|(R(t-152)<=a?i:r)<<0,o[153]=(R(n-153)<=a?i:r)<<2|(R(e-153)<=a?i:r)<<1|(R(t-153)<=a?i:r)<<0,o[154]=(R(n-154)<=a?i:r)<<2|(R(e-154)<=a?i:r)<<1|(R(t-154)<=a?i:r)<<0,o[155]=(R(n-155)<=a?i:r)<<2|(R(e-155)<=a?i:r)<<1|(R(t-155)<=a?i:r)<<0,o[156]=(R(n-156)<=a?i:r)<<2|(R(e-156)<=a?i:r)<<1|(R(t-156)<=a?i:r)<<0,o[157]=(R(n-157)<=a?i:r)<<2|(R(e-157)<=a?i:r)<<1|(R(t-157)<=a?i:r)<<0,o[158]=(R(n-158)<=a?i:r)<<2|(R(e-158)<=a?i:r)<<1|(R(t-158)<=a?i:r)<<0,o[159]=(R(n-159)<=a?i:r)<<2|(R(e-159)<=a?i:r)<<1|(R(t-159)<=a?i:r)<<0,o[160]=(R(n-160)<=a?i:r)<<2|(R(e-160)<=a?i:r)<<1|(R(t-160)<=a?i:r)<<0,o[161]=(R(n-161)<=a?i:r)<<2|(R(e-161)<=a?i:r)<<1|(R(t-161)<=a?i:r)<<0,o[162]=(R(n-162)<=a?i:r)<<2|(R(e-162)<=a?i:r)<<1|(R(t-162)<=a?i:r)<<0,o[163]=(R(n-163)<=a?i:r)<<2|(R(e-163)<=a?i:r)<<1|(R(t-163)<=a?i:r)<<0,o[164]=(R(n-164)<=a?i:r)<<2|(R(e-164)<=a?i:r)<<1|(R(t-164)<=a?i:r)<<0,o[165]=(R(n-165)<=a?i:r)<<2|(R(e-165)<=a?i:r)<<1|(R(t-165)<=a?i:r)<<0,o[166]=(R(n-166)<=a?i:r)<<2|(R(e-166)<=a?i:r)<<1|(R(t-166)<=a?i:r)<<0,o[167]=(R(n-167)<=a?i:r)<<2|(R(e-167)<=a?i:r)<<1|(R(t-167)<=a?i:r)<<0,o[168]=(R(n-168)<=a?i:r)<<2|(R(e-168)<=a?i:r)<<1|(R(t-168)<=a?i:r)<<0,o[169]=(R(n-169)<=a?i:r)<<2|(R(e-169)<=a?i:r)<<1|(R(t-169)<=a?i:r)<<0,o[170]=(R(n-170)<=a?i:r)<<2|(R(e-170)<=a?i:r)<<1|(R(t-170)<=a?i:r)<<0,o[171]=(R(n-171)<=a?i:r)<<2|(R(e-171)<=a?i:r)<<1|(R(t-171)<=a?i:r)<<0,o[172]=(R(n-172)<=a?i:r)<<2|(R(e-172)<=a?i:r)<<1|(R(t-172)<=a?i:r)<<0,o[173]=(R(n-173)<=a?i:r)<<2|(R(e-173)<=a?i:r)<<1|(R(t-173)<=a?i:r)<<0,o[174]=(R(n-174)<=a?i:r)<<2|(R(e-174)<=a?i:r)<<1|(R(t-174)<=a?i:r)<<0,o[175]=(R(n-175)<=a?i:r)<<2|(R(e-175)<=a?i:r)<<1|(R(t-175)<=a?i:r)<<0,o[176]=(R(n-176)<=a?i:r)<<2|(R(e-176)<=a?i:r)<<1|(R(t-176)<=a?i:r)<<0,o[177]=(R(n-177)<=a?i:r)<<2|(R(e-177)<=a?i:r)<<1|(R(t-177)<=a?i:r)<<0,o[178]=(R(n-178)<=a?i:r)<<2|(R(e-178)<=a?i:r)<<1|(R(t-178)<=a?i:r)<<0,o[179]=(R(n-179)<=a?i:r)<<2|(R(e-179)<=a?i:r)<<1|(R(t-179)<=a?i:r)<<0,o[180]=(R(n-180)<=a?i:r)<<2|(R(e-180)<=a?i:r)<<1|(R(t-180)<=a?i:r)<<0,o[181]=(R(n-181)<=a?i:r)<<2|(R(e-181)<=a?i:r)<<1|(R(t-181)<=a?i:r)<<0,o[182]=(R(n-182)<=a?i:r)<<2|(R(e-182)<=a?i:r)<<1|(R(t-182)<=a?i:r)<<0,o[183]=(R(n-183)<=a?i:r)<<2|(R(e-183)<=a?i:r)<<1|(R(t-183)<=a?i:r)<<0,o[184]=(R(n-184)<=a?i:r)<<2|(R(e-184)<=a?i:r)<<1|(R(t-184)<=a?i:r)<<0,o[185]=(R(n-185)<=a?i:r)<<2|(R(e-185)<=a?i:r)<<1|(R(t-185)<=a?i:r)<<0,o[186]=(R(n-186)<=a?i:r)<<2|(R(e-186)<=a?i:r)<<1|(R(t-186)<=a?i:r)<<0,o[187]=(R(n-187)<=a?i:r)<<2|(R(e-187)<=a?i:r)<<1|(R(t-187)<=a?i:r)<<0,o[188]=(R(n-188)<=a?i:r)<<2|(R(e-188)<=a?i:r)<<1|(R(t-188)<=a?i:r)<<0,o[189]=(R(n-189)<=a?i:r)<<2|(R(e-189)<=a?i:r)<<1|(R(t-189)<=a?i:r)<<0,o[190]=(R(n-190)<=a?i:r)<<2|(R(e-190)<=a?i:r)<<1|(R(t-190)<=a?i:r)<<0,o[191]=(R(n-191)<=a?i:r)<<2|(R(e-191)<=a?i:r)<<1|(R(t-191)<=a?i:r)<<0,o[192]=(R(n-192)<=a?i:r)<<2|(R(e-192)<=a?i:r)<<1|(R(t-192)<=a?i:r)<<0,o[193]=(R(n-193)<=a?i:r)<<2|(R(e-193)<=a?i:r)<<1|(R(t-193)<=a?i:r)<<0,o[194]=(R(n-194)<=a?i:r)<<2|(R(e-194)<=a?i:r)<<1|(R(t-194)<=a?i:r)<<0,o[195]=(R(n-195)<=a?i:r)<<2|(R(e-195)<=a?i:r)<<1|(R(t-195)<=a?i:r)<<0,o[196]=(R(n-196)<=a?i:r)<<2|(R(e-196)<=a?i:r)<<1|(R(t-196)<=a?i:r)<<0,o[197]=(R(n-197)<=a?i:r)<<2|(R(e-197)<=a?i:r)<<1|(R(t-197)<=a?i:r)<<0,o[198]=(R(n-198)<=a?i:r)<<2|(R(e-198)<=a?i:r)<<1|(R(t-198)<=a?i:r)<<0,o[199]=(R(n-199)<=a?i:r)<<2|(R(e-199)<=a?i:r)<<1|(R(t-199)<=a?i:r)<<0,o[200]=(R(n-200)<=a?i:r)<<2|(R(e-200)<=a?i:r)<<1|(R(t-200)<=a?i:r)<<0,o[201]=(R(n-201)<=a?i:r)<<2|(R(e-201)<=a?i:r)<<1|(R(t-201)<=a?i:r)<<0,o[202]=(R(n-202)<=a?i:r)<<2|(R(e-202)<=a?i:r)<<1|(R(t-202)<=a?i:r)<<0,o[203]=(R(n-203)<=a?i:r)<<2|(R(e-203)<=a?i:r)<<1|(R(t-203)<=a?i:r)<<0,o[204]=(R(n-204)<=a?i:r)<<2|(R(e-204)<=a?i:r)<<1|(R(t-204)<=a?i:r)<<0,o[205]=(R(n-205)<=a?i:r)<<2|(R(e-205)<=a?i:r)<<1|(R(t-205)<=a?i:r)<<0,o[206]=(R(n-206)<=a?i:r)<<2|(R(e-206)<=a?i:r)<<1|(R(t-206)<=a?i:r)<<0,o[207]=(R(n-207)<=a?i:r)<<2|(R(e-207)<=a?i:r)<<1|(R(t-207)<=a?i:r)<<0,o[208]=(R(n-208)<=a?i:r)<<2|(R(e-208)<=a?i:r)<<1|(R(t-208)<=a?i:r)<<0,o[209]=(R(n-209)<=a?i:r)<<2|(R(e-209)<=a?i:r)<<1|(R(t-209)<=a?i:r)<<0,o[210]=(R(n-210)<=a?i:r)<<2|(R(e-210)<=a?i:r)<<1|(R(t-210)<=a?i:r)<<0,o[211]=(R(n-211)<=a?i:r)<<2|(R(e-211)<=a?i:r)<<1|(R(t-211)<=a?i:r)<<0,o[212]=(R(n-212)<=a?i:r)<<2|(R(e-212)<=a?i:r)<<1|(R(t-212)<=a?i:r)<<0,o[213]=(R(n-213)<=a?i:r)<<2|(R(e-213)<=a?i:r)<<1|(R(t-213)<=a?i:r)<<0,o[214]=(R(n-214)<=a?i:r)<<2|(R(e-214)<=a?i:r)<<1|(R(t-214)<=a?i:r)<<0,o[215]=(R(n-215)<=a?i:r)<<2|(R(e-215)<=a?i:r)<<1|(R(t-215)<=a?i:r)<<0,o[216]=(R(n-216)<=a?i:r)<<2|(R(e-216)<=a?i:r)<<1|(R(t-216)<=a?i:r)<<0,o[217]=(R(n-217)<=a?i:r)<<2|(R(e-217)<=a?i:r)<<1|(R(t-217)<=a?i:r)<<0,o[218]=(R(n-218)<=a?i:r)<<2|(R(e-218)<=a?i:r)<<1|(R(t-218)<=a?i:r)<<0,o[219]=(R(n-219)<=a?i:r)<<2|(R(e-219)<=a?i:r)<<1|(R(t-219)<=a?i:r)<<0,o[220]=(R(n-220)<=a?i:r)<<2|(R(e-220)<=a?i:r)<<1|(R(t-220)<=a?i:r)<<0,o[221]=(R(n-221)<=a?i:r)<<2|(R(e-221)<=a?i:r)<<1|(R(t-221)<=a?i:r)<<0,o[222]=(R(n-222)<=a?i:r)<<2|(R(e-222)<=a?i:r)<<1|(R(t-222)<=a?i:r)<<0,o[223]=(R(n-223)<=a?i:r)<<2|(R(e-223)<=a?i:r)<<1|(R(t-223)<=a?i:r)<<0,o[224]=(R(n-224)<=a?i:r)<<2|(R(e-224)<=a?i:r)<<1|(R(t-224)<=a?i:r)<<0,o[225]=(R(n-225)<=a?i:r)<<2|(R(e-225)<=a?i:r)<<1|(R(t-225)<=a?i:r)<<0,o[226]=(R(n-226)<=a?i:r)<<2|(R(e-226)<=a?i:r)<<1|(R(t-226)<=a?i:r)<<0,o[227]=(R(n-227)<=a?i:r)<<2|(R(e-227)<=a?i:r)<<1|(R(t-227)<=a?i:r)<<0,o[228]=(R(n-228)<=a?i:r)<<2|(R(e-228)<=a?i:r)<<1|(R(t-228)<=a?i:r)<<0,o[229]=(R(n-229)<=a?i:r)<<2|(R(e-229)<=a?i:r)<<1|(R(t-229)<=a?i:r)<<0,o[230]=(R(n-230)<=a?i:r)<<2|(R(e-230)<=a?i:r)<<1|(R(t-230)<=a?i:r)<<0,o[231]=(R(n-231)<=a?i:r)<<2|(R(e-231)<=a?i:r)<<1|(R(t-231)<=a?i:r)<<0,o[232]=(R(n-232)<=a?i:r)<<2|(R(e-232)<=a?i:r)<<1|(R(t-232)<=a?i:r)<<0,o[233]=(R(n-233)<=a?i:r)<<2|(R(e-233)<=a?i:r)<<1|(R(t-233)<=a?i:r)<<0,o[234]=(R(n-234)<=a?i:r)<<2|(R(e-234)<=a?i:r)<<1|(R(t-234)<=a?i:r)<<0,o[235]=(R(n-235)<=a?i:r)<<2|(R(e-235)<=a?i:r)<<1|(R(t-235)<=a?i:r)<<0,o[236]=(R(n-236)<=a?i:r)<<2|(R(e-236)<=a?i:r)<<1|(R(t-236)<=a?i:r)<<0,o[237]=(R(n-237)<=a?i:r)<<2|(R(e-237)<=a?i:r)<<1|(R(t-237)<=a?i:r)<<0,o[238]=(R(n-238)<=a?i:r)<<2|(R(e-238)<=a?i:r)<<1|(R(t-238)<=a?i:r)<<0,o[239]=(R(n-239)<=a?i:r)<<2|(R(e-239)<=a?i:r)<<1|(R(t-239)<=a?i:r)<<0,o[240]=(R(n-240)<=a?i:r)<<2|(R(e-240)<=a?i:r)<<1|(R(t-240)<=a?i:r)<<0,o[241]=(R(n-241)<=a?i:r)<<2|(R(e-241)<=a?i:r)<<1|(R(t-241)<=a?i:r)<<0,o[242]=(R(n-242)<=a?i:r)<<2|(R(e-242)<=a?i:r)<<1|(R(t-242)<=a?i:r)<<0,o[243]=(R(n-243)<=a?i:r)<<2|(R(e-243)<=a?i:r)<<1|(R(t-243)<=a?i:r)<<0,o[244]=(R(n-244)<=a?i:r)<<2|(R(e-244)<=a?i:r)<<1|(R(t-244)<=a?i:r)<<0,o[245]=(R(n-245)<=a?i:r)<<2|(R(e-245)<=a?i:r)<<1|(R(t-245)<=a?i:r)<<0,o[246]=(R(n-246)<=a?i:r)<<2|(R(e-246)<=a?i:r)<<1|(R(t-246)<=a?i:r)<<0,o[247]=(R(n-247)<=a?i:r)<<2|(R(e-247)<=a?i:r)<<1|(R(t-247)<=a?i:r)<<0,o[248]=(R(n-248)<=a?i:r)<<2|(R(e-248)<=a?i:r)<<1|(R(t-248)<=a?i:r)<<0,o[249]=(R(n-249)<=a?i:r)<<2|(R(e-249)<=a?i:r)<<1|(R(t-249)<=a?i:r)<<0,o[250]=(R(n-250)<=a?i:r)<<2|(R(e-250)<=a?i:r)<<1|(R(t-250)<=a?i:r)<<0,o[251]=(R(n-251)<=a?i:r)<<2|(R(e-251)<=a?i:r)<<1|(R(t-251)<=a?i:r)<<0,o[252]=(R(n-252)<=a?i:r)<<2|(R(e-252)<=a?i:r)<<1|(R(t-252)<=a?i:r)<<0,o[253]=(R(n-253)<=a?i:r)<<2|(R(e-253)<=a?i:r)<<1|(R(t-253)<=a?i:r)<<0,o[254]=(R(n-254)<=a?i:r)<<2|(R(e-254)<=a?i:r)<<1|(R(t-254)<=a?i:r)<<0,o[255]=(R(n-255)<=a?i:r)<<2|(R(e-255)<=a?i:r)<<1|(R(t-255)<=a?i:r)<<0,o}function xa(t,e,n,i,r,a,o,l){var s,u,c,f,h,m,p,d,g=t.length,_=g>>>(i|=0),v=1<<i,x=e<<i,y=g-x,C=e-1<<i,b=o,S=l,A=o,R=l,I=new Ui(Yi(_/32)),w=new Hi(_<<2),L=0,E=o+l>>>i;if(I[E>>>5]|=1<<(31&E),0<=l+x&&l+x<=y&&(w[L]=l,w[L+1]=o,w[L+2]=o,w[L+3]=x,L+=4),w[L]=l+x,w[L+1]=o,w[L+2]=o,w[L+3]=-x,L+=4,i)for(;0<L;){for(x=w[(L-=4)+3],m=w[L]+x,f=w[L+1],h=w[L+2],S=Pi(S,m),R=Xi(R,m),b=Pi(b,f),A=Xi(A,h),c=f;0<=c&&(E=(u=c+m)>>>i,!((d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]])||I[E>>>5]&1<<(31&E)));c-=v)I[E>>>5]|=1<<(31&E),b=Pi(b,c);if(f<=c){for(E=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=h&&(d||I[E>>>5]&1<<(31&E));)E=(u=(c+=v)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];p=(s=c)<=h}else(s=c+v)<f&&0+x<=m&&m<=y+x&&(w[L]=m,w[L+1]=s,w[L+2]=f-v,w[L+3]=-x,L+=4),c=f+v,p=!0;for(;p;){for(E=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=C&&!d&&!(I[E>>>5]&1<<(31&E));)I[E>>>5]|=1<<(31&E),A=Xi(A,c),E=(u=(c+=v)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];for(0<=m+x&&m+x<=y&&(w[L]=m,w[L+1]=s,w[L+2]=c-v,w[L+3]=x,L+=4),h+v<c&&0<=m-x&&m-x<=y&&(w[L]=m,w[L+1]=h+v,w[L+2]=c-v,w[L+3]=-x,L+=4),E=(u=c+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];c<=h&&(d||I[E>>>5]&1<<(31&E));)E=(u=(c+=v)+m)>>>i,d=1&r[t[u]]|2&r[t[u+1]]|4&r[t[u+2]];p=(s=c)<=h}}else for(;0<L;){for(x=w[(L-=4)+3],m=w[L]+x,f=w[L+1],h=w[L+2],S=Pi(S,m),R=Xi(R,m),b=Pi(b,f),A=Xi(A,h),c=f;0<=c&&!(1&r[t[E=u=c+m]]||I[E>>>5]&1<<(31&E));c-=v)I[E>>>5]|=1<<(31&E),b=Pi(b,c);if(f<=c){for(E=u=c+m;c<=h&&(1&r[t[u]]||I[E>>>5]&1<<(31&E));)E=u=(c+=v)+m;p=(s=c)<=h}else(s=c+v)<f&&0+x<=m&&m<=y+x&&(w[L]=m,w[L+1]=s,w[L+2]=f-v,w[L+3]=-x,L+=4),c=f+v,p=!0;for(;p;){for(E=u=c+m;c<=C&&!(1&r[t[u]])&&!(I[E>>>5]&1<<(31&E));)I[E>>>5]|=1<<(31&E),A=Xi(A,c),E=u=(c+=v)+m;for(0<=m+x&&m+x<=y&&(w[L]=m,w[L+1]=s,w[L+2]=c-v,w[L+3]=x,L+=4),h+v<c&&0<=m-x&&m-x<=y&&(w[L]=m,w[L+1]=h+v,w[L+2]=c-v,w[L+3]=-x,L+=4),E=u=c+m;c<=h&&(1&r[t[u]]||I[E>>>5]&1<<(31&E));)E=u=(c+=v)+m;p=(s=c)<=h}}return{mask:I,box:[b,S,A,R]}}function ya(t,e,n,i,r,a,o){var l,s,u=ki.MODE,c=ki.Color.hue,f=ki.Color.intensity,h=qi.cos,m=ki.CONST.toRad,p=(t.length,r.length);if(0<i)if(u.HUE===o||u.COLORIZEHUE===o)for(s=l=0;s<p;l+=4,++s)r[s]=0===t[l+3]?1e4:h(m*c(t[l],t[l+1],t[l+2]));else if(u.INTENSITY===o)for(a*=255,s=l=0;s<p;l+=4,++s)r[s]=0===t[l+3]?1e4:f(t[l],t[l+1],t[l+2]);else if(u.GRAY===o)for(a*=255,s=l=0;s<p;l+=4,++s)r[s]=0===t[l+3]?1e4:t[l];else for(a=1e4*a+1e3*a+100*a+10*a+a,s=l=0;s<p;l+=4,++s)r[s]=0===t[l+3]?1e5:1e4*(t[l]+t[l+1]+t[l+2])/3/255+1e3*(t[l]+t[l+1])/2/255+100*(t[l+1]+t[l+2])/2/255+10*(t[l]+t[l+2])/2/255+t[l]/255;else if(u.HUE===o||u.COLORIZEHUE===o)for(s=l=0;s<p;++l,++s)r[s]=h(m*t[l]);else for(a*=255,s=l=0;s<p;++l,++s)r[s]=t[l];return a}function Ca(t,e,n){this.id=-1,this.root=n||this}function ba(t){for(;t!==t.root;)t=t.root;return t}function Sa(t,e){(t=ba(t))!==(e=ba(e))&&(t.root=e)}function Aa(t,e,n,i,r,a,o,l,s){var u,c,f,h,m,p,d,g,_,v=t.length,x=v>>>(i|=0),y=8===a,C=null,b=null!=l,S=2*o,A=new Array(x),C=b?new Ca:null;for(A[0]=b&&Zi(o+r[0]-l)>S?C:new Ca,f=1;f<e;++f)A[f]=b&&Zi(o+r[f]-l)>S?C:Zi(o+r[f]-r[f-1])<=S?A[f-1]:new Ca;for(h=1,m=e;h<n;++h,m+=e)for(A[m]=b&&Zi(o+r[m]-l)>S?C:Zi(o+r[m]-r[m-e])<=S?A[m-e]:new Ca,f=1;f<e;++f)b&&Zi(o+r[m+f]-l)>S?A[m+f]=C:(c=C!==A[m+f-1]&&Zi(o+r[m+f]-r[m+f-1])<=S?A[m+f-1]:null,y&&C!==A[m-e+f-1]&&Zi(o+r[m+f]-r[m-e+f-1])<=S&&(null!=c?Sa(c,A[m-e+f-1]):c=A[m-e+f-1]),C!==A[m-e+f]&&Zi(o+r[m+f]-r[m-e+f])<=S&&(null!=c?Sa(c,A[m-e+f]):c=A[m-e+f]),A[m+f]=null!=c?c:new Ca,y&&C!==A[m+f-1]&&C!==A[m-e+f]&&Zi(o+r[m+f-1]-r[m-e+f])<=S&&Sa(A[m+f-1],A[m-e+f]));for(_=s?(g=-255,255):(g=255,0),p=null!=C?(C.id=0,1):0,f=0;f<x;++f)A[f]=ba(A[f]),A[f].id<0&&(A[f].id=p++);if(i)for(u=f=0;u<v;u+=4,++f)d=_+g*A[f].id/p|0,t[u]=t[u+1]=t[u+2]=d;else for(f=0;f<v;++f)d=_+g*A[f].id/p|0,t[f]=d;return t}function Ra(t,e,n){var i=e.width*n,n=e.height*n;return t.x>=e.x-i&&t.y>=e.y-n&&t.x+t.width<=e.x+e.width+i&&t.y+t.height<=e.y+e.height+n}function Ia(t,e){return e.area-t.area}return N.min,N.max,O.Create({name:"HistogramEqualizeFilter",path:O.Path,mode:ga.INTENSITY,channel:0,factor:1,init:function(t,e,n){this.mode=t||ga.INTENSITY,this.channel=e||0,null!=n&&(this.factor=+n)},serialize:function(){return{channel:this.channel,factor:this.factor}},unserialize:function(t){return this.channel=t.channel,this.factor=t.factor,this},_apply_rgb:function(t,e,n){var i,r,a,o,l,s,u,c=this.factor,f=t.length,h=_a.histogram(t,da.R,!0),m=_a.histogram(t,da.G,!0),p=_a.histogram(t,da.B,!0),d=c*(h.max-h.min)/h.total,g=c*(m.max-m.min)/m.total,_=c*(p.max-p.min)/p.total;if(pa)for(u=0;u<f;u+=4)i=t[u],r=t[u+1],a=t[u+2],o=h.bin[i]*d+h.min,l=(l=m.bin[r]*g+m.min)<0?0:255<l?255:l,s=(s=p.bin[a]*_+p.min)<0?0:255<s?255:s,t[u]=0|(o=o<0?0:255<o?255:o),t[u+1]=0|l,t[u+2]=0|s;else for(u=0;u<f;u+=4)i=t[u],r=t[u+1],a=t[u+2],o=h.bin[i]*d+h.min,l=m.bin[r]*g+m.min,s=p.bin[a]*_+p.min,t[u]=0|o,t[u+1]=0|l,t[u+2]=0|s;return t},apply:function(t,e,n){if(ga.RGB===this.mode)return this._apply_rgb(t,e,n);var i,r,a,o,l,s,u,c,f,h=t.length,e=this.factor,m=this.channel||0,n=this.mode;if(ga.GRAY===n||ga.CHANNEL===n)c=_a.histogram(t,m,!0);else{for(f=0;f<h;f+=4)o=(o=0+.299*(i=t[f])+.587*(r=t[f+1])+.114*(a=t[f+2])|0)<0?0:255<o?255:o,l=(l=128-.168736*i-.331264*r+.5*a|0)<0?0:255<l?255:l,t[f]=s=(s=128+.5*i-.418688*r-.081312*a|0)<0?0:255<s?255:s,t[f+1]=o,t[f+2]=l;c=_a.histogram(t,da.G,!0)}if(u=e*(c.max-c.min)/c.total,pa)if(ga.GRAY===n)for(f=0;f<h;f+=4)i=c.bin[t[f+m]]*u+c.min|0,t[f]=i=i<0?0:255<i?255:i,t[f+1]=i,t[f+2]=i;else if(ga.CHANNEL===n)for(f=0;f<h;f+=4)i=c.bin[t[f+m]]*u+c.min|0,t[f+m]=i=i<0?0:255<i?255:i;else for(f=0;f<h;f+=4)r=(r=(o=c.bin[t[f+1]]*u+c.min)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128))<0?0:255<r?255:r,a=(a=o+1.772*(l-128))<0?0:255<a?255:a,t[f]=0|(i=(i=o+1.402*(s-128))<0?0:255<i?255:i),t[f+1]=0|r,t[f+2]=0|a;else if(ga.GRAY===n)for(f=0;f<h;f+=4)i=c.bin[t[f+m]]*u+c.min|0,t[f]=i,t[f+1]=i,t[f+2]=i;else if(ga.CHANNEL===n)for(f=0;f<h;f+=4)i=c.bin[t[f+m]]*u+c.min|0,t[f+m]=i;else for(f=0;f<h;f+=4)r=(o=c.bin[t[f+1]]*u+c.min)-.34414*((l=t[f+2])-128)-.71414*((s=t[f])-128),a=o+1.772*(l-128),t[f]=0|(i=o+1.402*(s-128)),t[f+1]=0|r,t[f+2]=0|a;return t}}),hi=M,n=Math,mi=hi.Util.Math.hypot,pi=n.sqrt,n.abs,di=n.min,E=n.max,gi=n.floor,_i=n.ceil,vi=hi.Create({name:"PixelateFilter",scale:1,pattern:"rectangular",init:function(t,e){this.scale=t||1,this.pattern=e||"rectangular"},path:hi.Path,serialize:function(){return{scale:this.scale,pattern:this.pattern}},unserialize:function(t){return this.scale=t.scale,this.pattern=t.pattern,this},getGLSL:function(){return(r=this).scale<=1||!r.pattern||!vi[r.pattern]?{instance:r,shader:hi.Util.GLSL.DEFAULT}:{instance:r,shader:["varying vec2 pix;","uniform sampler2D img;","uniform vec2 imgSize;","uniform float tileSize;","uniform int pixelate;",vi.rectangular_glsl,vi.triangular_glsl,vi.rhomboidal_glsl,vi.hexagonal_glsl,"void main(void) {","vec2 p = pix;","if (1 == pixelate) p = triangular(p, imgSize, tileSize);","else if (2 == pixelate) p = rhomboidal(p, imgSize, tileSize);","else if (3 == pixelate) p = hexagonal(p, imgSize, tileSize);","else p = rectangular(p, imgSize, tileSize);","gl_FragColor = texture2D(img, p);","}"].join("\n"),vars:function(t,e,n,i){t.uniform2f(i.uniform.imgSize,e,n),t.uniform1f(i.uniform.tileSize,pi(e*n)*(r.scale||1)*.01),t.uniform1i(i.uniform.pixelate,"triangular"===r.pattern?1:"rhomboidal"===r.pattern?2:"hexagonal"===r.pattern?3:0)}};var r},apply:function(t,e,n){var i,r=this.pattern;return this.scale<=1||!r||!vi[r]?t:(100<this.scale&&(this.scale=100),i=new hi.ImArray(t.length),vi[r](this.scale,i,t,e,n),i)}}).PATTERN={rectangular:function(t,e,n,i,r){for(var a,o,l,s,u,c,f,h,m,p=n.length,d=p>>>2,g=i-1,_=d-i,v=(a=pi(d)*t*.01|0,(o=.5*a|0)*i),x=l=s=u=c=f=0;x<p;x+=4)m=s-f,h=E(0,di(g,l-u+o)),m=E(0,di(_,m+v)),e[x]=n[h=h+m<<2],e[x+1]=n[1+h],e[x+2]=n[2+h],e[x+3]=n[3+h],++u,i<=++l&&(l=u=0,f+=i,s+=i,a<=++c)&&(f=c=0),a<=u&&(u=0)},triangular:function(t,e,n,i,r){for(var a,o,l,s,u,c,f=n.length,h=f>>>2,m=i-1,p=h-i,d=pi(h)*t*.0125|0,g=.333*d|0,_=.666*d|0,v=(.5*d|0)*i,x=a=o=l=s=0,y=0;y<f;y+=4)u=x-o,c=a-s,u=d<o+l?E(0,di(m,u+_))+E(0,di(p,c+v))<<2:E(0,di(m,u+g))+E(0,di(p,c+v))<<2,e[y]=n[u],e[y+1]=n[u+1],e[y+2]=n[u+2],e[y+3]=n[u+3],++o,i<=++x&&(x=o=0,s+=i,a+=i,d<=++l)&&(s=l=0),d<=o&&(o=0)},rhomboidal:function(t,e,n,i,r){for(var a,o,l,s,u,c,f,h=n.length,m=h>>>2,p=i-1,d=m-i,g=pi(m)*t*.007|0,_=2*g,v=g*i,x=a=o=l=s=0,y=0,C=0;C<h;C+=4)f=y?_<o+l?(u=di(p,x-o+g),a-s):g<o+g-l?(u=x-o,E(0,a-s-v)):(u=E(0,x-o-g),a-s):_<o+g-l?(u=di(p,x-o+g),E(0,a-s-v)):g<o+l?(u=x-o,a-s):(u=E(0,x-o-g),E(0,a-s-v)),c=E(0,di(p,u+g)),f=E(0,di(d,f+v)),e[C]=n[c=c+f<<2],e[C+1]=n[1+c],e[C+2]=n[2+c],e[C+3]=n[3+c],++o,i<=++x&&(x=o=0,s+=i,a+=i,g<=++l)&&(s=l=0,y=1-y),_<=o&&(o=0)},hexagonal:function(t,e,n,i,r){var a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R=n.length,I=R>>>2,w=i-1,L=I-i;for(t=pi(I)*t*.01,a=o=l=0;a<R;a+=4)x=o/t,y=l/t,h=gi(x-=.5*(y/=.866025404)),f=gi(y),c=_i(x),m=_i(y),u=x+y-h-f<1?(s=h,f):(s=c,m),A=1-(C=c=c)-(b=f=f),g=1-(p=h=h)-(d=m=m),y=mi((_=x)-s,(v=y)-u,(x=1-x-y)-(1-s-u)),C=mi(_-C,v-b,x-A),b=mi(_-p,v-d,x-g),A=y<C?y<b?(S=s,u):(S=h,m):C<b?(S=c,f):(S=h,m),S+=.5*A,A=.866025404*A*t,_=E(0,di(w,0|(S*=t)))+E(0,di(L,(0|A)*i))<<2,e[a]=n[_],e[a+1]=n[1+_],e[a+2]=n[2+_],e[a+3]=n[3+_],i<=++o&&(o=0,++l)},rectangular_glsl:["vec2 rectangular(vec2 p, vec2 imgsize, float tilesize) {","    return clamp((tilesize*floor(imgsize * p / tilesize) + 0.5*tilesize)/imgsize, 0.0, 1.0);","}"].join("\n"),triangular_glsl:["vec2 triangular(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 1.25;","   vec2 tile = tilesize*floor(imgsize * p / tilesize);","   vec2 t = mod(imgsize * p, tilesize);","   if (t.x+t.y > tilesize) return clamp((tile + vec2(0.66*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","   else return clamp((tile + vec2(0.33*tilesize, 0.5*tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),rhomboidal_glsl:["vec2 rhomboidal(vec2 p, vec2 imgsize, float tilesize) {","   tilesize *= 0.7;","   vec2 xy = imgsize * p;","   vec2 xyi = floor(xy / tilesize);","   vec2 tile = tilesize*xyi;","   vec2 s = vec2(mod(xy.x, 2.0*tilesize), mod(xy.y, tilesize));","   vec2 a;","   if (0.0 < mod(xyi.y, 2.0)) {","       if (s.x+s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y);","       } else if (s.x+tilesize-s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y-tilesize);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y);","       }","   } else {","       if (s.x+tilesize-s.y > 2.0*tilesize) {","           a = vec2(xy.x-s.x+tilesize, xy.y-s.y-tilesize);","       } else if (s.x+s.y > tilesize) {","           a = vec2(xy.x-s.x, xy.y-s.y);","       } else {","           a = vec2(xy.x-s.x-tilesize, xy.y-s.y-tilesize);","       }","   }","   a = vec2(clamp(a.x, 0.0, imgsize.x), clamp(a.y, 0.0, imgsize.y));","   return clamp((a + vec2(tilesize))/imgsize, 0.0, 1.0);","}"].join("\n"),hexagonal_glsl:["vec2 hexagonal(vec2 p, vec2 imgsize, float tilesize) {","    vec2 t = imgsize * p / tilesize;","    t.y /= 0.866025404;","    t.x -= t.y * 0.5;","    vec2 it = vec2(floor(t.x), floor(t.y));","    vec2 ct = vec2(ceil(t.x), ceil(t.y));","    vec2 a;","    if (t.x + t.y - it.x - it.y < 1.0) a = it;","    else a = ct;","    vec2 b = vec2(ct.x, it.y);","    vec2 c = vec2(it.x, ct.y);","    vec3 T = vec3(t.x, t.y, 1.0 - t.x - t.y);","    vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);","    vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);","    vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);","    float alen = length(T - A);","    float blen = length(T - B);","    float clen = length(T - C);","    vec2 ch;","    if (alen < blen) {","        if (alen < clen) ch = a;","        else ch = c;","    } else {","        if (blen < clen) ch = b;","        else ch = c;","    }","    ch.x += ch.y * 0.5;","    ch.y *= 0.866025404;","    ch *= tilesize / imgsize;","    return clamp(ch, 0.0, 1.0);","}"].join("\n")},xi=M.MODE,yi=M.Array32F,Ci=M.Color.clamp,bi=M.Color.intensity,M.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:xi.GRAY,init:function(t,e,n){this.size=t||1,this.thresh=Ci(null==e?.4:e,0,1),this.mode=n||xi.GRAY},path:M.Path,threshold:function(t){return this.thresh=Ci(t,0,1),this},serialize:function(){return{size:this.size,thresh:this.thresh}},unserialize:function(t){return this.size=t.size,this.thresh=t.thresh,this},apply:function(t,e,n){for(var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y=t.length,C=new yi(3*(y>>>2)),b=this.size,S=1/(b*b),A=255*this.thresh,R=xi.RGB===this.mode,I=b*e,w=0,L=0,E=0;w<n;){if(s=u=c=0,R){for(l=o=a=0;o<b;)s+=t[i=E+L+a+l<<2]+C[r=3*(E+L+a+l)],u+=t[i+1]+C[r+1],c+=t[i+2]+C[r+2],++a>=b&&(a=0,++o,l+=e);m=A<bi(s*=S,u*=S,c*=S)?(f=0|s,h=0|u,0|c):h=f=0}else{for(l=o=a=0;o<b;)s+=t[i=E+L+a+l<<2]+C[r=3*(E+L+a+l)],++a>=b&&(a=0,++o,l+=e);m=h=f=A<s*S?255:0}if(p=t[i=E+L<<2]-f,d=t[i+1]-h,g=t[i+2]-m,E+b<e)for(_=7/16*p,v=7/16*d,x=7/16*g,a=b,l=o=0;o<b;)C[r=3*(E+L+a+l)]+=_,C[r+1]+=v,C[r+2]+=x,0<=++a&&(a=b,++o,l+=e);if(w+b<n&&b<E)for(_=3/16*p,v=3/16*d,x=3/16*g,a=-b,o=b,l=0;o<0;)C[r=3*(E+L+a+l)]+=_,C[r+1]+=v,C[r+2]+=x,0<=++a&&(a=-b,++o,l+=e);if(w+b<n)for(_=5/16*p,v=5/16*d,x=5/16*g,o=b,l=a=0;o<0;)C[r=3*(E+L+a+l)]+=_,C[r+1]+=v,C[r+2]+=x,++a>=b&&(a=0,++o,l+=e);if(w+b<n&&E+b<e)for(_=1/16*p,v=1/16*d,x=1/16*g,o=a=b,l=0;o<0;)C[r=3*(E+L+a+l)]+=_,C[r+1]+=v,C[r+2]+=x,0<=++a&&(a=b,++o,l+=e);for(l=o=a=0;o<b;)t[i=E+L+a+l<<2]=f,t[i+1]=h,t[i+2]=m,++a>=b&&(a=0,++o,l+=e);e<=(E+=b)&&(E=0,w+=b,L+=I)}return t}}),Ai=(Si=M).MODE,Ri=new Si.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]),Ii=Math,Si.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,pad:!0,onlyShadow:!1,path:Si.Path,init:function(t,e,n,i,r,a,o){this.offsetX=t||0,this.offsetY=e||0,this.color=n||0,this.opacity=null==i?1:+i,this.quality=0|(r||1),this.pad=null==a||!!a,this.onlyShadow=!!o},dispose:function(){return this.offsetX=null,this.offsetY=null,this.color=null,this.opacity=null,this.quality=null,this.pad=null,this.onlyShadow=null,this.$super("dispose"),this},serialize:function(){return{offsetX:this.offsetX,offsetY:this.offsetY,color:this.color,opacity:this.opacity,quality:this.quality,pad:this.pad,onlyShadow:this.onlyShadow}},unserialize:function(t){return this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.color=t.color,this.opacity=t.opacity,this.quality=t.quality,this.pad=t.pad,this.onlyShadow=t.onlyShadow,this},apply:function(t,e,n){var i=this;if(i.hasMeta=!1,i._isOn){var r,a,o,l,s,u,c,f=Ii.max,h=i.color||0,m=i.opacity,p=i.quality,d=i.pad,g=i.onlyShadow,_=i.offsetX||0,v=i.offsetY||0,x=t.length,y=x>>>2,C=x,b=e;if(0!==(m=1<(m=m<0?0:m)?1:m)){r=h>>>16&255,a=h>>>8&255,o=255&h,3<(p=p<=0?1:p)&&(p=3);for(var S=new Si.ImArray(C),A=0,R=0,I=0,w=0,L=0;I<C;I+=4,++w)b<=w&&(w=0,++L),0<(c=t[I+3])&&(S[I]=r,S[I+1]=a,S[I+2]=o,S[I+3]=m*c|0,A=f(A,w),R=f(R,L));if(S=Si.Util.Filter.integral_convolution(r===a&&a===o?Ai.GRAY:Ai.RGB,S,e,n,2,Ri,null,3,3,1,0,p),A+=_,R+=v,d&&(e<=A||A<0||n<=R||R<0)&&(t=Si.Util.Image.pad(t,e,n,x=e<=A?A-e:0,h=n<=R?R-n:0,p=A<0?-A:0,d=R<0?-R:0),y=(e+=p+x)*(n+=d+h),i.hasMeta=!0,i.meta={_IMG_WIDTH:e,_IMG_HEIGHT:n}),v*=e,g)for(u=L=w=0;u<C;u+=4,++w)b<=w&&(w=0,L+=e),s=L+v,(l=w+_)<0||e<=l||s<0||y<=s||(t[I=l+s<<2]=S[u],t[I+1]=S[u+1],t[I+2]=S[u+2],t[I+3]=S[u+3]);else for(u=L=w=0;u<C;u+=4,++w)b<=w&&(w=0,L+=e),s=L+v,(l=w+_)<0||e<=l||s<0||y<=s||(c=t[(I=l+s<<2)+3],m=S[u+3],255!==c&&0!==m&&(r=t[I]+(S[u]-t[I])*(m/=255),a=t[I+1]+(S[u+1]-t[I+1])*m,o=t[I+2]+(S[u+2]-t[I+2])*m,t[I]=0|r,t[I+1]=0|a,t[I+2]=0|o))}}return t}}),(wi=Math).sqrt,wi.exp,Li=wi.log,Ei=wi.abs,Di=wi.floor,Ti=M._notSupportClamp,Mi=M.Array32F,M.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,n,i){this.centerX=t||0,this.centerY=e||0,this.radius=null==n?10:n,this.amount=null==i?10:i},path:M.Path,serialize:function(){return{centerX:this.centerX,centerY:this.centerY,radius:this.radius,amount:this.amount}},unserialize:function(t){return this.centerX=t.centerX,this.centerY=t.centerY,this.radius=t.radius,this.amount=t.amount,this},apply:function(t,e,n){if(this._isOn){var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S=t.length,A=this.centerX||0,R=this.centerY||0,I=this.radius,w=this.amount;if(!(w<=0)){for(0,b=(i=S>>>2)-e,A=Di(A*(C=e-1)),R=Di(R*(n-1)),s=(e<<1)+e,r=new Mi((i<<1)+i),f=a=o=l=f=c=u=0;f<e;++f,u+=4,c+=3)a+=t[u],o+=t[u+1],l+=t[u+2],r[c]=a,r[c+1]=o,r[c+2]=l;for(a=o=l=f=c=0,u=u=s+e;u<S;u+=4,c+=3,++f)e<=f&&(a=o=l=f=0),a+=t[u],o+=t[u+1],l+=t[u+2],r[c+s]=r[c]+a,r[c+s+1]=r[c+1]+o,r[c+s+2]=r[c+2]+l;for(u=m=h=f=0;u<S;u+=4,++f)e<=f&&(f=0,++h,m+=e),y=Ei(f-A),v=Ei(h-R),d=wi.max(y,v),y=wi.min(y,v),0<(y=I<(v=d?d*(1+.43*y/d*y/d):0)?0|Li((v-I)*w):v/I+.5|0)&&(d=f+y,g=m+(v=y*e),(p=f-y)<0?p=0:C<d&&(d=C),(v=m-v)<0?v=0:b<g&&(g=b),v=(y=.25/(y*y))*(r[_=((_=d+g)<<1)+_]-r[d=((d=d+v)<<1)+d]-r[g=((g=p+g)<<1)+g]+r[p=((p=p+v)<<1)+p]),x=y*(r[_+1]-r[d+1]-r[g+1]+r[p+1]),y=y*(r[_+2]-r[d+2]-r[g+2]+r[p+2]),Ti&&(v=v<0?0:255<v?255:v,x=x<0?0:255<x?255:x,y=y<0?0:255<y?255:y),t[u]=0|v,t[u+1]=0|x,t[u+2]=0|y)}}return t}}),Gi=M,Oi=Math,Gi.Create({name:"SeamlessTileFilter",type:2,init:function(t){this.type=null==t?2:t||0},path:Gi.Path,serialize:function(){return{type:this.type}},unserialize:function(t){return this.type=t.type,this},apply:function(t,e,n){var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v=this.type,x=Gi.ImArray,y=Gi.Array8U,C=Gi.Util.Image.interpolate,b=Oi.sqrt;for(e!==n?t=C(t,e,n,p=n<e?e:n,p):p=e,d=Oi.round(p/2),g=p*p,i=new x(_=t.length),r=new x(_),a=new y(g),h=f=c=0;h<_;h+=4,++c)p<=c&&(c=0,++f),i[m=(c+d)%p+(f+d)%p*p<<2]=t[h],i[m+1]=t[h+1],i[m+2]=t[h+2],i[m+3]=t[h+3];if(0===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*b((c-d)*(c-d)+(f-d)*(f-d))/d,a[c+f*p]=u=u<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;else if(1===v)for(f=c=0;c<d;++f)d<=f&&(f=0,++c),a[c+f*p]=u=(u=255-255*(d+f<d+c?(f-d)/d:(c-p/2)/d))<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;else for(f=c=0;c<d;++f)d<=f&&(f=0,++c),u=255-255*(d+f<d+c?b((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p):b((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p)),a[c+f*p]=u=u<1?1:255<u?255:u,a[c+(p-1-f)*p]=u,a[p-1-c+f*p]=u,a[p-1-c+(p-1-f)*p]=u;for(c=f=0;f<p;++c)p<=c&&(c=0,++f),o=a[m=c+f*p],o/=s=o+(l=a[(c+d)%p+(f+d)%p*p]),r[m<<=2]=~~(o*t[m]+(l/=s)*i[m]),r[m+1]=~~(o*t[m+1]+l*i[m+1]),r[m+2]=~~(o*t[m+2]+l*i[m+2]),r[m+3]=t[m+3];return r=e!==n?C(r,p,p,e,n):r}}),Fi=(Ni=M).MODE,r=Math,A=Ni.Util.Filter,Ni.Create({name:"ColorFillFilter",x:0,y:0,color:null,border:null,tolerance:1e-6,mode:Fi.COLOR,path:Ni.Path,init:function(t,e,n,i,r){this.x=t||0,this.y=e||0,this.color=n||0,this.tolerance=null==i?1e-6:+i,this.border=null!=r?r||0:null,this.mode=Fi.COLOR},serialize:function(){var t="function"==typeof this.color;return{isfunc:t,color:t?this.color.toString():this.color,border:this.border,x:this.x,y:this.y,tolerance:this.tolerance}},unserialize:function(t){return t.isfunc?this.color=new Function("FILTER","return "+t.color+";")(Ni):this.color=t.color,this.border=t.border,this.x=t.x,this.y=t.y,this.tolerance=t.tolerance,this},apply:function(t,e,n){var i,r,a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y,C,b,S,A,R,I,w,L=this.mode||Fi.COLOR,E=this.color||0,D=this.border,T=null!=D,M=this.x||0,G=this.y||0,O=Ni.Color.RGB2HSV,F=Ni.Color.HSV2RGB,N="function"==typeof E;if(!(M<0||e<=M||G<0||n<=G)){if(N||(m=E>>>16&255,p=E>>>8&255,d=255&E),_=t[f=(M<<=2)+(G=G*e<<2)],v=t[f+1],x=t[f+2],b=0,S=1,T){if(T=D>>>8&255,y=255&D,_===(D=D>>>16&255)&&v===T&&x===y)return t;_=D,v=T,x=y,b=1,S=0}else if(Fi.COLOR===L&&!N&&_===m&&v===p&&x===d)return t;if(R=(D=xa(t,e,0,2,va(_,v,x,b,S,255*(1<=this.tolerance?.999:this.tolerance)),0,M,G)).mask,Fi.MASK===L||Fi.COLORMASK===L)for(I=Fi.MASK===L,f=r=a=i=0,h=t.length;f<h;f+=4,++i)e<=i&&(i=0,++a,r+=e),R[(c=i+r)>>>5]&1<<(31&c)?I&&(g=N&&(m=(w=E(i,a))[0],p=w[1],d=w[2],3<w.length)?w[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g):(t[f]=0,t[f+1]=0,t[f+2]=0);else if(Fi.HUE===L)for(o=(A=D.box)[0]>>>2,l=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,C=new Bi(3),i=o,a=(r=l)/e;r<=u;)R[(c=i+r)>>>5]&1<<(31&c)&&(C[0]=t[f=c<<2],C[1]=t[f+1],C[2]=t[f+2],O(C,0,1),w=N?E(i,a):E,C[0]=w,F(C,0,1),t[f]=0|C[0],t[f+1]=0|C[1],t[f+2]=0|C[2]),++i>s&&(i=o,++a,r+=e);else for(o=(A=D.box)[0]>>>2,l=A[1]>>>2,s=A[2]>>2,u=A[3]>>>2,i=o,a=(r=l)/e;r<=u;)R[(c=i+r)>>>5]&1<<(31&c)&&(f=c<<2,g=N&&(m=(w=E(i,a))[0],p=w[1],d=w[2],3<w.length)?w[3]:t[f+3],t[f]=m,t[f+1]=p,t[f+2]=d,t[f+3]=g),++i>s&&(i=o,++a,r+=e)}return t}}),Ni.FloodFillFilter=Ni.ColorFillFilter,Ni.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:1e-6,border:null,mode:Fi.TILE,hasInputs:!0,path:Ni.Path,init:function(t,e,n,i,r,a,o){this.x=t||0,this.y=e||0,this.offsetX=i||0,this.offsetY=r||0,n&&this.setInput("pattern",n),this.tolerance=null==a?1e-6:+a,this.border=null!=o?o||0:null,this.mode=Fi.TILE},dispose:function(){return this.x=null,this.y=null,this.offsetX=null,this.offsetY=null,this.tolerance=null,this.border=null,this.$super("dispose"),this},serialize:function(){return{x:this.x,y:this.y,offsetX:this.offsetX,offsetY:this.offsetY,tolerance:this.tolerance,border:this.border}},unserialize:function(t){return this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.tolerance=t.tolerance,this.border=t.border,this},apply:function(t,e,n){var i=this.x||0,r=this.y||0;if(!(i<0||e<=i||r<0||n<=r)&&(w=this.input("pattern"))){var a,o,l,s,u,c,f,h,m,p,d,g,_,v,x,y=this.mode||Fi.TILE,C=this.border,b=w[0],S=w[1],A=w[2],R=this.offsetX||0,I=this.offsetY||0,w=t[u=(i<<=2)+(r=r*e<<2)],L=t[u+1],E=t[u+2],D=0,T=1;if(null!=C){if(_=C>>>8&255,a=255&C,w===(C=C>>>16&255)&&L===_&&E===a)return t;w=C,L=_,E=a,D=1,T=0}if(v=(C=xa(t,e,0,2,va(w,L,E,D,T,255*(1<=this.tolerance?.999:this.tolerance)),0,i,r)).mask,f=(_=C.box)[0]>>>2,h=_[1]>>>2,m=_[2]>>>2,p=_[3]>>>2,Fi.STRETCH===y)for(d=S/(m-f+1),g=A/(p-h+e),o=f,l=h;l<=p;)v[(s=o+l)>>>5]&1<<(31&s)&&(t[u=s<<2]=b[c=(d*(o-f)|0)+(g*(l-h)|0)*S<<2],t[u+1]=b[c+1],t[u+2]=b[c+2]),++o>m&&(o=f,l+=e);else{for(;R<0;)R+=S;for(;I<0;)I+=A;for(m=m-f+1,l=o=0,x=h;x<=p;)v[(s=o+f+x)>>>5]&1<<(31&s)&&(t[u=s<<2]=b[c=(o+R)%S+(l+I)%A*S<<2],t[u+1]=b[c+1],t[u+2]=b[c+2]),++o>=m&&(o=0,x+=e,++l)}}return t}}),Hi=Ni.Array32I,Ui=Ni.Array32U,Bi=Ni.Array32F,zi=Ni.Array8U,Yi=r.ceil,Pi=r.min,Xi=r.max,R=r.abs,A.dissimilarity_rgb=va,A.floodRegion=xa,ji=(ki=M).MODE,$i=ki.Array32F,Wi=ki.ImArray,I=ki.Util.Filter,qi=Math,Vi=qi.min,Ki=qi.max,Zi=qi.abs,Qi=qi.cos,Ji=ki.CONST.toRad,ki.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:1e-6,mode:ji.COLOR,color:null,invert:!1,box:null,init:function(t,e,n,i){this.connectivity=8===t?8:4,this.tolerance=null==e?1e-6:+e,this.color=null==n?null:+n,this.invert=!!i,this.mode=ji.COLOR},path:ki.Path,serialize:function(){return{connectivity:this.connectivity,tolerance:this.tolerance,color:this.color,invert:this.invert}},unserialize:function(t){return this.connectivity=t.connectivity,this.tolerance=t.tolerance,this.color=t.color,this.invert=t.invert,this},apply:function(t,e,n){var i,r,a,o,l,s,u,c,f,h,m=t.length,p=m>>>2,d=this.mode||ji.COLOR,g=this.color,_=Vi(.999,Ki(0,this.tolerance||0)),p=new $i(p);if(null!=g&&(ji.HUE===d||ji.COLORIZEHUE===d?g=Qi(Ji*g):ji.COLOR!==d&&ji.COLORIZE!==d||(g=1e4*((c=(g>>>16&255)/255)+(f=(g>>>8&255)/255)+(h=(255&g)/255))/3+1e3*(c+f)/2+100*(f+h)/2+10*(c+h)/2+c)),_=ya(t,0,0,2,p,_,d),ji.COLORIZE!==d&&ji.COLORIZEHUE!==d)return Aa(t,e,n,2,p,this.connectivity,_,g,this.invert);for(i=Aa(new Wi(m),e,n,2,p,this.connectivity,_,g,this.invert),l=new $i(256),s=new $i(256),u=new $i(256),o=new $i(256),r=0;r<m;r+=4)++o[a=i[r]],l[a]+=t[r],s[a]+=t[r+1],u[a]+=t[r+2];for(r=0;r<256;++r)o[r]&&(a=o[r],l[r]/=a,s[r]/=a,u[r]/=a);for(r=0;r<m;r+=4)a=i[r],t[r]=0|l[a],t[r+1]=0|s[a],t[r+2]=0|u[a];return t}}),Ca.prototype={constructor:Ca,id:0,root:null},I.dissimilarity_rgb_2=ya,I.connectedComponents=Aa,(tr=M).Create({name:"CannyEdgesFilter",low:25,high:75,lowpass:!0,path:tr.Path,init:function(t,e,n){this.low=arguments.length<1?25:+t,this.high=arguments.length<2?75:+e,this.lowpass=arguments.length<3||!!n},thresholds:function(t,e,n){return this.low=+t,this.high=+e,2<arguments.length&&(this.lowpass=!!n),this},serialize:function(){return{low:this.low,high:this.high,lowpass:this.lowpass}},unserialize:function(t){return this.low=t.low,this.high=t.high,this.lowpass=t.lowpass,this},getGLSL:function(){var r=this,t=tr.Util.Filter.gradient_glsl(),e=[];return r.lowpass&&e.push({instance:r,shader:["varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;",t.lowpass,"void main(void) {","    gl_FragColor = lowpass(img, pix, dp);","}"].join("\n")}),e.push({instance:r,shader:["#define MAGNITUDE_SCALE 1.0","#define MAGNITUDE_LIMIT 510.0","#define MAGNITUDE_MAX 510.0","varying vec2 pix;","uniform vec2 dp;","uniform sampler2D img;","uniform float low;","uniform float high;",t.gradient,"void main(void) {","    gl_FragColor = gradient(img, pix, dp, low, high, MAGNITUDE_SCALE, MAGNITUDE_LIMIT, MAGNITUDE_MAX);","}"].join("\n"),vars:function(t,e,n,i){t.uniform1f(i.uniform.low,+r.low/255),t.uniform1f(i.uniform.high,+r.high/255)}}),e},apply:function(t,e,n){return tr.Util.Filter.gradient(t,e,n,2,0,this.lowpass,0,+this.low,+this.high,1,510,510)}}),er=M,L=Math,nr=L.abs,yt=L.max,Ct=L.min,L.floor,ir=L.round,rr=L.sqrt,er.Util.Array.typed,ar=er.Util.Array.typed_obj,or=Array.prototype.push,er.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(t,e,n,i,r,a,o){this.haardata=t||null,this.baseScale=null==e?1:+e,this.scaleIncrement=null==n?1.25:+n,this.stepIncrement=null==i?.5:+i,this.minNeighbors=null==r?1:+r,this.doCannyPruning=void 0===a||!!a,this.tolerance=null==o?.2:+o,this._haarchanged=!!this.haardata},path:er.Path,dispose:function(){return this.haardata=null,this.$super("dispose"),this},haar:function(t){return this.haardata=t,this._haarchanged=!0,this},params:function(t){var e=this;return t&&(t.haardata&&(e.haardata=t.haardata,e._haarchanged=!0),null!=t.baseScale&&(e.baseScale=+t.baseScale),null!=t.scaleIncrement&&(e.scaleIncrement=+t.scaleIncrement),null!=t.stepIncrement&&(e.stepIncrement=+t.stepIncrement),null!=t.minNeighbors&&(e.minNeighbors=+t.minNeighbors),void 0!==t.doCannyPruning&&(e.doCannyPruning=!!t.doCannyPruning),null!=t.tolerance&&(e.tolerance=+t.tolerance),null!=t.cannyLow&&(e.cannyLow=+t.cannyLow),null!=t.cannyHigh&&(e.cannyHigh=+t.cannyHigh),null!=t.selection)&&(e.selection=t.selection||null),e},serialize:function(){var t=this,e={baseScale:t.baseScale,scaleIncrement:t.scaleIncrement,stepIncrement:t.stepIncrement,minNeighbors:t.minNeighbors,doCannyPruning:t.doCannyPruning,tolerance:t.tolerance,cannyLow:t.cannyLow,cannyHigh:t.cannyHigh};return t._haarchanged&&(e.haardata=ar(t.haardata),t._haarchanged=!1),e},unserialize:function(t){var e=this;return t.haardata&&(e.haardata=ar(t.haardata,1)),e.baseScale=t.baseScale,e.scaleIncrement=t.scaleIncrement,e.stepIncrement=t.stepIncrement,e.minNeighbors=t.minNeighbors,e.doCannyPruning=t.doCannyPruning,e.tolerance=t.tolerance,e.cannyLow=t.cannyLow,e.cannyHigh=t.cannyHigh,e},metaData:function(t){return t&&er.isWorker?ar(this.meta):this.meta},setMetaData:function(t,e){return this.meta=e&&"string"==typeof t?ar(t,1):t,this},apply:function(t,e,n,i){var r,a,o,l,s,u,c,f,h,m,p,d,g=this;return g.haardata&&(r=t.length>>>2,d=g.selection||null,a=er.Array32F,u=s=l=o=null,p=er.Util.Filter,d=d?(m=d[4]?(h=e-1,n-1):h=1,c=Ct(e-1,yt(0,d[0]*h)),f=Ct(n-1,yt(0,d[1]*m)),h=Ct(e-1,yt(0,d[2]*h)),Ct(n-1,yt(0,d[3]*m))):(f=c=0,h=e-1,n-1),i&&i.haarfilter_SAT?(o=i.haarfilter_SAT,l=i.haarfilter_SAT2,s=i.haarfilter_RSAT):(p.sat(t,e,n,2,0,o=new a(r),l=new a(r),s=new a(r)),i&&(i.haarfilter_SAT=o,i.haarfilter_SAT2=l,i.haarfilter_RSAT=s)),g.doCannyPruning&&(i&&i.haarfilter_GSAT?u=i.haarfilter_GSAT:(u=p.gradient(t,e,n,2,0,1,1),i&&(i.haarfilter_GSAT=u))),(m=new Array(10)).count=0,p.haar_detect(m,e,n,c,f,h,d,g.haardata,g.baseScale,g.scaleIncrement,g.stepIncrement,o,s,l,u,g.cannyLow,g.cannyHigh),m.length>m.count&&(m.length=m.count),g.meta={objects:p.merge_features(m,g.minNeighbors,g.tolerance)}),t}}),er.Util.Filter.haar_detect=function(t,e,F,H,U,B,z,Y,P,X,k,n,i,r,a,j,$){for(var W,q,o,l,s,u,V,K,Z,c,f,h,m,Q,J,p,d,g,_,tt,et,nt,it,rt,v,x,at,y,ot,lt,st,C,b,S,A,R,I,w,L,E,D,T,M,ut=null!=a,ct=B-H+1|0,ft=z-U+1|0,ht=(B=e*F)-1,mt=Y.stages,pt=mt.length,dt=Y.size1,gt=Y.size2,G=e-1,O=B-e,_t=0|H,vt=0|U,xt=Ct(e/dt,F/gt),N=P;N<=xt;N*=X)for(W=(o=N*dt|0)*k|0,K=(l=N*gt|0)*e,Q=_t+ct-o,J=vt+ft-l,d=1/(o*l),V=(u=vt)*(Z=(q=l*k|0)*e);u<J;u+=q,V+=Z)for(s=_t;s<Q;s+=W)if(f=(c=s-1+V-e)+o,m=(h=c+K)+o,c=Ct(ht,yt(0,c)),f=Ct(ht,yt(0,f)),h=Ct(ht,yt(0,h)),m=Ct(ht,yt(0,m)),!(ut&&((_=d*(a[m]-a[h]-a[f]+a[c]))<j||$<_)||(_=d*(n[m]-n[h]-n[f]+n[c]),(g=d*(r[m]-r[h]-r[f]+r[c])-_*_)<=0))){for(g=rr(g),tt=!1,p=0;p<pt;++p){for(nt=(et=mt[p]).thres,rt=(it=et.trees).length,v=M=0;v<rt;++v)for(at=it[v].feats,x=0;;){if(lt=(ot=(y=at[x]).rects).length,st=y.thres,C=0,y.tilt)for(b=0;b<lt;++b)A=s+N*(S=ot[b])[0]|0,R=(u-1+N*S[1]|0)*e,I=s+N*(S[0]+S[2])|0,w=(u-1+N*(S[1]+S[2])|0)*e,L=s+N*(S[0]-S[3])|0,E=(u-1+N*(S[1]+S[3])|0)*e,D=s+N*(S[0]+S[2]-S[3])|0,T=(u-1+N*(S[1]+S[2]+S[3])|0)*e,A=Ct(G,yt(0,A)),I=Ct(G,yt(0,I)),L=Ct(G,yt(0,L)),D=Ct(G,yt(0,D)),R=Ct(O,yt(0,R)),w=Ct(O,yt(0,w)),E=Ct(O,yt(0,E)),T=Ct(O,yt(0,T)),C+=S[4]*(i[D+T]-i[L+E]-i[I+w]+i[A+R]);else for(b=0;b<lt;++b)A=s-1+N*(S=ot[b])[0]|0,I=s-1+N*(S[0]+S[2])|0,R=e*(u-1+N*S[1]|0),w=e*(u-1+N*(S[1]+S[3])|0),A=Ct(G,yt(0,A)),I=Ct(G,yt(0,I)),R=Ct(O,yt(0,R)),w=Ct(O,yt(0,w)),C+=S[4]*(n[I+w]-n[A+w]-n[I+R]+n[A+R]);if(C*d<st*g){if(y.has_l){M+=y.l_val;break}x=y.l_node}else{if(y.has_r){M+=y.r_val;break}x=y.r_node}}if(!(tt=nt<M))break}tt&&(t.count===t.length&&or.apply(t,new Array(10)),t[t.count++]={x:s,y:u,width:o,height:l})}},er.Util.Filter.merge_features=function(t,e,n){for(var i,r,a,o,l,s,u,c,f,h,m,p,d=t.length,g=new Array(d),_=[],v=0,x=!1,y=0;y<d;++y)g[y]=0;for(y=0;y<d;++y){for(x=!1,a=0;a<y;++a)u=t[a],c=t[y],f=(f=n)*(Ct(u.width,c.width)+Ct(u.height,c.height))*.5,nr(u.x-c.x)<=f&&nr(u.y-c.y)<=f&&nr(u.x+u.width-c.x-c.width)<=f&&nr(u.y+u.height-c.y-c.height)<=f&&(x=!0,g[y]=g[a]);x||(g[y]=v,++v)}for(i=new Array(v),r=new Array(v),y=0;y<v;++y)i[y]=0,r[y]={x:0,y:0,width:0,height:0};for(y=0;y<d;++y)++i[s=g[y]],h=r[s],m=t[y],h.x+=m.x,h.y+=m.y,h.width+=m.width,h.height+=m.height;for(y=0;y<v;++y)e<=(o=i[y])&&(s={x:(l=1/(o+o))*(2*r[y].x+o),y:l*(2*r[y].y+o),width:l*(2*r[y].width+o),height:l*(2*r[y].height+o)},_.push(s));for(d=_.length,y=0;y<d;++y)for(a=y+1;a<d;++a)!_[y].isInside&&Ra(_[y],_[a],n)&&(_[y].isInside=!0),!_[a].isInside&&Ra(_[a],_[y],n)&&(_[a].isInside=!0);for(y=d;0<=--y;)_[y].isInside?_.splice(y,1):((p=_[y]).x=ir(p.x),p.y=ir(p.y),p.width=ir(p.width),p.height=ir(p.height),p.area=p.width*p.height);return _.sort(Ia)},M});
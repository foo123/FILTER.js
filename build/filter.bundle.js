/**
*
*   Classy.js
*   @version: 0.9.3
*   @built on 2015-04-26 17:56:03
*
*   Object-Oriented micro-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,n,t){"use strict";var i,r="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;r?module.exports=(module.$deps=module.$deps||{})[n]=module.$deps[n]||t.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(n,i,r){return t.call(e,{AMD:r})}):n in e||(e[n]=i=t.call(e,{})||1)&&l&&define(n,[],function(){return i})}(this,"Classy",function(e){return!function(e,n){"use strict";var t="constructor",i="prototype",r="__proto__",l="__static__",u="__private__",a="$super",o="$static",f="$latestatic",c="$class",s=2,b=4,m=8,d=256,p=Object,v=p[i],g=Function,h=g[i],y=String,x=Number,w=RegExp,E=Array,j=v.toString,_=(h.call.bind(h.toString),"hasOwnProperty"),q="propertyIsEnumerable",I=p.keys,$=p.defineProperty,A=function(e){return typeof e},C=function(e){throw new TypeError(e)},M=2,N=3,O=4,P=8,S=9,T=16,R=32,D=64,F=128,L=256,V=512,k=1024,B={"[object Array]":T,"[object RegExp]":F,"[object Number]":M,"[object String]":P,"[object Function]":D,"[object Object]":R},U=function(e){var t;return null===e?L:!0===e||!1===e?O:n===e?V:(t=j.call(e),t=B[t]||k,M===t||e instanceof x?isNaN(e)?N:M:P===t||e instanceof y?1===e.length?S:P:T===t||e instanceof E?T:F===t||e instanceof w?F:D===t||e instanceof g?D:R===t?R:k)},z=function(e,n){var t,i=n.length,r=[].concat(e);for(t=0;i>t;t++)-1<r.indexOf(n[t])||r.push(n[t]);return r},G=function(e,n){R!==U(e)&&C("bad desc");var t={};if(e[_]("enumerable")&&(t.enumerable=!!n.enumerable),e[_]("configurable")&&(t.configurable=!!n.configurable),e[_]("value")&&(t.value=n.value),e[_]("writable")&&(t.writable=!!e.writable),e[_]("get")){var i=e.get;D!==U(i)&&"undefined"!==i&&C("bad get"),t.get=i}if(e[_]("set")){var r=e.set;D!==U(r)&&"undefined"!==r&&C("bad set"),t.set=r}return("get"in t||"set"in t)&&("value"in t||"writable"in t)&&C("identity-confused descriptor"),t},H=p.defineProperties||function(e,n){("object"!==A(e)||null===e)&&C("bad obj"),n=p(n);for(var t=I(n),i=[],r=0;r<t.length;r++)i.push([t[r],G(n[t[r]],e)]);for(var r=0;r<i.length;r++)$(e,i[r][0],i[r][1]);return e},J=function(){},K=p.create||function(e,n){var t,l=function(){};return l[i]=e,t=new l,t[r]=e,"object"===A(n)&&H(t,n),t},Q=function(){var e,n,t,i,r,l,u,a=arguments;for(n=a[0]||{},e=a.length,l=1;e>l;l++)if(t=a[l],R===U(t))for(r in t)t[_](r)&&t[q](r)&&(i=t[r],u=U(i),n[r]=M&u?0+i:(P|T)&u?i.slice(0):i);return n},W=function(e,n,i){var r,l,u=!!n;if(u||i)if(r={},n=u?n+"$":n,i&&D===U(i))for(l in e)e[_](l)&&(t!==l?(u&&D===U(e[l])&&(r[n+l]=e[l]),r[i(l,e[l])]=e[l]):r[l]=e[l]);else for(l in e)e[_](l)&&(t!==l?(u&&D===U(e[l])&&(r[n+l]=e[l]),i&&l in i?r[i[l]]=e[l]:r[l]=e[l]):r[l]=e[l]);else r=e;return r},X=function(e){var n=e[a]||J,t=e[a+"v"]||J,i=null;return[function(t,r,l,u,a,o,f,c,s,b,m){var d,p;return i===t?d=n.call(this,t,r,l,u,a,o,f,c,s,b,m):(p=e[t])&&(i=t,d=p.call(this,r,l,u,a,o,f,c,s,b,m),i=null),d},function(n,r){var l,u;return i===n?l=t.call(this,n,r):(u=e[n])&&(i=n,l=r&&r.length?u.apply(this,r):u.call(this),i=null),l}]},Y=function(e,n){return this instanceof Y?(this.factory=e,void(this.qualifier=(M===U(n)?n:0)|s)):new Y(e,n)},Z=function(e,n){return this instanceof Z?(this.prop=e,void(this.qualifier=(M===U(n)?n:0)|s)):new Z(e,n)},en=function(e,r,s,v){e=e||p,r=r||{};var g,h,y,x,w,E,j,q,$,A,C=e[o]||null,N=e[f]||{},O=e[i],S=null,F=Q({},N),L=null,V={};r[_](t)||(r[t]=function(){}),g=r[t],r[_](u)&&(V=r[u]||{},delete r[u]),r[_](l)&&(S=r[l],L=I(S),delete r[l]);for($ in r)if(r[_]($)){if(A=r[$],A instanceof Y){if(m&A.qualifier){d&A.qualifier?F[$]=A:((S=S||{})[$]=A.factory(e,V,g),(L=L||[]).push($)),delete r[$];continue}if(b&A.qualifier){V[$]=A,delete r[$];continue}A=r[$]=A.factory(O,V,g)}D===U(A)&&(A[a]=O[$]||J)}for($ in V)V[_]($)&&(A=V[$],A instanceof Y&&(A=V[$]=A.factory(O,V,g)),D!==U(A)&&delete V[$]);if(g[i]=W(K(O),s,v),g[i]=Q(g[i],r),h=X(O),w={},w[c]=w[t]={value:g,enumerable:!1,writable:!0,configurable:!0},w[a]={value:h[0],enumerable:!1,writable:!0,configurable:!0},w[a+"v"]={value:h[1],enumerable:!1,writable:!0,configurable:!0},H(g[i],w),w={},C||L)for(C=z(C||[],L||[]),x=C.length,y=0;x>y;y++){if(E=C[y],j=null,S&&n!==S[E]){if((A=S[E])instanceof Y){if((m|d)&A.qualifier){F[E]=A;continue}j=A.factory(e,V,g)}else{if(F[_](E))continue;j=S[E]}D===U(j)&&(j[a]=e[E]||J)}else n!==e[E]&&(q=U(e[E]),j=R===q?Q(null,e[E]):(P|T)&q?e[E].slice(0):M&q?0+e[E]:e[E]);w[E]={value:j,enumerable:!1,writable:!0,configurable:!0}}for(E in F)F[_](E)&&(j=F[E].factory(e,V,g),w[E]={value:j,enumerable:!1,writable:!0,configurable:!0});return w[o]={value:C,enumerable:!1,writable:!0,configurable:!0},w[f]={value:F,enumerable:!1,writable:!0,configurable:!0},w[a]={value:e,enumerable:!1,writable:!0,configurable:!0},H(g,w),g},nn=Q,tn=Q,rn=function(e){var t,r,l,u;if(D===U(e)){if(a in e&&(e[a]=n),c in e&&(e[c]=n),f in e&&(e[f]=n),o in e){for(l=e[o],t=0,r=l.length;r>t;t++)u=l[t],u in e&&(D===U(e[u])&&e[u][a]&&(e[u][a]=n),e[u]=n);e[o]=n}l=e[i];for(u in l)D===U(l[u])&&(l[u][a]&&(l[u][a]=n),l[u]=n);l[a]=n,l[a+"v"]=n}},ln=function(){var e=arguments,n=e.length,t=null;if(m===e[0])return e[1]||{};if(n>=2){var r=U(e[0]);r=D===r?{Extends:e[0]}:R===r?e[0]:{Extends:p};var l,u,a=e[1]||{},o={},f=r[_]("Extends")?r.Extends:r[_]("extends")?r["extends"]:p,c=r[_]("Implements")?r.Implements:r[_]("implements")?r["implements"]:null,s=r[_]("Mixin")?r.Mixin:r[_]("mixin")?r.mixin:null,b=null;if(c=c?[].concat(c):null,s=s?[].concat(s):null)for(l=0,u=s.length;u>l;l++)R===U(s[l])?s[l][_]("mixin")&&s[l].mixin&&s[l].mixin[i]&&(b=W(s[l].mixin[i],s[l].namespace||null,s[l].as||null),o=tn(o,b)):s[l][i]&&(b=s[l][i],o=tn(o,b));if(c)for(l=0,u=c.length;u>l;l++)R===U(c[l])?c[l][_]("implements")&&c[l]["implements"]&&c[l]["implements"][i]&&(b=W(c[l].implements[i],c[l].namespace||null,c[l].as||null),o=nn(o,b)):c[l][i]&&(b=c[l][i],o=nn(o,b));t=R===U(f)?en(f.extends||p,Q(o,a),f.namespace||null,f.as||null):en(f,Q(o,a))}else t=en(p,e[0]);return t};e.Classy={VERSION:"0.9.3",PUBLIC:s,STATIC:m,LATE:d,PRIVATE:b,Type:U,Create:K,Merge:Q,Alias:W,Implements:nn,Mixin:tn,Extends:en,Dispose:rn,Method:Y,Prop:Z,Class:ln}}(e),e.Classy});
/**
*
*   Asynchronous.js
*   @version: 0.4.5
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/!function(n,e,t){"use strict";var r,o="object"==typeof module&&module.exports,s="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[e]=module.$deps[e]||t.call(n,{NODE:module})||1:s&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["require","exports","module"],function(e,r,o){return t.call(n,{AMD:o})}):e in n||(n[e]=r=t.call(n,{})||1)&&s&&define(e,[],function(){return r})}(this,"Asynchronous",function(exports){return!function(root,exports,undef){"use strict";function formatOptions(n){var e,t=[];if(n)for(e in n)t.push(e+"="+n[e]);return t.join(",")}function runParallelised(n){n.$runmode=PARALLELISED,n.$running=!1}function runLinearised(n,e){var t,r=n,o=r.$queue;if(r.$runmode=LINEARISED,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(r.$running=!0,t=o.shift(),e?t.runWithArgs(e):t.run(),t.complete()):r.$running=!1}}function runInterleaved(n,e){var t,r=n,o=r.$queue,s=0;if(r.$runmode=INTERLEAVED,o&&o.length){for(r.$running=!0;s<o.length;)t=o[s],t&&t.canRun()?(e?t.runWithArgs(e):t.run(),t.isFinished()?(o.shift(),t.complete()):s++):o.shift();r.$running=!1,r.$timer=SetTime(curry(runInterleaved,r),r.$interval)}}function runSequenced(n,e){var t,r=n,o=r.$queue;r.$runmode=SEQUENCED,o&&o.length&&(t=o[0],t&&t.canRun()?(r.$running=!0,e?t.runWithArgs(e):t.run(),t.isFinished()&&(o.shift(),t.complete())):o.shift(),r.$running=!1,r.$timer=SetTime(curry(runSequenced,r),r.$interval))}var PROTO="prototype",HAS="hasOwnProperty",Obj=Object,Arr=Array,Func=Function,FP=Func[PROTO],OP=Obj[PROTO],AP=Arr[PROTO],slice=FP.call.bind(AP.slice),toString=OP.toString,is_function=function(n){return"function"==typeof n},is_instance=function(n,e){return n instanceof e},SetTime=setTimeout,ClearTime=clearTimeout,UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isNode="undefined"!=typeof global&&"[object global]"===toString.call(global),isNodeProcess=!(!isNode||!process.env.NODE_UNIQUE_ID),isBrowser=!isNode&&"undefined"!=typeof navigator,isWebWorker=isBrowser&&"function"==typeof importScripts&&is_instance(navigator,WorkerNavigator),isBrowserWindow=isBrowser&&!isWebWorker&&!!root.opener,isAMD="function"==typeof define&&define.amd,supportsMultiThread=isNode||"function"==typeof Worker,isThread=isNodeProcess||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,curry=function(n,e){return function(){return n(e)}},URL="undefined"!=typeof root.webkitURL?root.webkitURL:"undefined"!=typeof root.URL?root.URL:null,blobURL=function(n,e){return n&&URL?URL.createObjectURL(new Blob(n.push?n:[n],e||{type:"text/javascript"})):n},path=function(n){var e;return isNode?{file:__filename,path:__dirname}:isWebWorker?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:isAMD&&n&&n.uri?{file:e=n.uri,path:e.split("/").slice(0,-1).join("/")}:isBrowser&&(e=document.getElementsByTagName("script"))&&e.length?{file:e=e[e.length-1].src,path:e.split("/").slice(0,-1).join("/")}:{path:null,file:null}},thisPath=path(exports.AMD),tpf=thisPath.file,notThisPath=function(n){return!(!n||!n.length||n===tpf)},extend=function(n,e){if(n=n||{},e)for(var t in e)e[HAS](t)&&(n[t]=e[t]);return n},_uuid=0;if(onMessage=isWebWorker?function(n){n&&(onmessage=n)}:isNodeProcess?function(n){n&&process.on("message",function(e){n(fromJSON(e))})}:function(){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(n){process.send(toJSON({data:n}))},root.importScripts=function(scripts){if(scripts&&(scripts=scripts.split(",")).length)for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}},Thread=function(n){var e=this;e.process=ps.fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(fromJSON(n))}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},Thread[PROTO]={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(toJSON({data:n})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=root.Worker;var BrowserWindow=function(n){var e=this;return e instanceof BrowserWindow?(e.$id=(++_uuid).toString(16),void(e.options=extend({width:400,height:400,toolbar:"no",location:"no",directories:"no",status:"no",menubar:"no",scrollbars:"yes",resizable:"yes"},n))):new BrowserWindow(n)};BrowserWindow[PROTO]={constructor:BrowserWindow,options:null,$id:null,$window:null,dispose:function(){var n=this;return n.$window&&n.close(),n.$window=null,n.$id=null,n.options=null,n},close:function(){var n=this;return n.$window&&(n.$window.closed||n.$window.close(),n.$window=null),n},ready:function(n,e){var t=this,r=function o(){!t.$window||n&&!t.$window[n]?setTimeout(o,40):e()};return setTimeout(r,0),t},open:function(n){var e=this;return!e.$window&&n&&(e.$window=window.open(n.push?blobURL(["ï»¿"].concat(n),{type:"text/html;charset=utf-8"}):n,e.$id,formatOptions(e.options))),e},write:function(n){var e=this;return e.$window&&n&&e.$window.document.write(n),e}};var Task=function(n){if(n instanceof Task)return n;if(!(this instanceof Task))return new Task(n);var e,t=this,r=null,o=null,s=null,i=!1,u=!1,a=!1,l=!1,c=!1,f=!1,p=null,d=0,h=1,m=null,$=null,v=null,g=undef;t.queue=function(n){return arguments.length?(r=n,t):r},t.jumpNext=function(n){r&&r.jumpNext(!1,n)},t.abort=function(n){r&&(r.abort(!1),n&&(r.dispose(),r=null))},t.dispose=function(){r&&(r.dispose(),r=null)},t.task=function(n){return o=n,t},n&&t.task(n),t.run=e=function(){return o.jumpNext=t.jumpNext,o.abort=t.abort,o.dispose=t.dispose,g=o(),i=!0,o.jumpNext=null,o.abort=null,o.dispose=null,g},t.runWithArgs=function(n){return o.jumpNext=t.jumpNext,o.abort=t.abort,o.dispose=t.dispose,g=o.apply(null,n),i=!0,o.jumpNext=null,o.abort=null,o.dispose=null,g},t.canRun=function(){return o&&(!i||u||a||l||c||f)?(u||a)&&d>=m?!1:a&&!p?!1:(l||c)&&g===$?!1:!0:!1},t.iif=function(n,e,r){return n?t.task(e):arguments.length>2&&t.task(r),t},t.until=function(n){return g=undef,p=null,$=n,c=!0,f=!1,u=!1,a=!1,l=!1,t.run=e,t},t.untilNot=function(n){return g=undef,p=null,v=n,f=!0,c=!1,u=!1,a=!1,l=!1,t.run=e,t},t.loop=function(n,e,r){return g=undef,p=null,d=e||0,h=r||1,m=n,u=!0,c=!1,f=!1,a=!1,l=!1,t.run=function(){var n;return n=o(d),d+=h,g=n,i=!0,n},t},t.each=function(n){return g=undef,p=n,d=0,h=1,m=n?n.length||0:0,a=!0,c=!1,f=!1,u=!1,l=!1,t.run=function(){var n;return n=o(p[d],d),d++,g=n,i=!0,n},t},t.recurse=function(n,e){return p=null,g=n,$=e,l=!0,c=!1,f=!1,u=!1,a=!1,t.run=function(){var n;return n=o(g),g=n,i=!0,n},t},t.isFinished=function(){var n=!i||f||c||u||a||l;return n&&(c||l)&&g===$&&(n=!1),n&&f&&g!==v&&(n=!1),n&&(u||a)&&d>=m&&(n=!1),!n},t.onComplete=function(n){return s=n||null,t},t.complete=function(){return s&&is_function(s)&&s(),t}},Asynchronous=exports.Asynchronous=function(n,e){if(is_instance(n,Task))return n;if(is_function(n))return new Task(n);if(!is_instance(this,Asynchronous))return new Asynchronous(n);var t=this;t.$interval=arguments.length?parseInt(n,10):DEFAULT_INTERVAL,t.$timer=null,t.$runmode=NONE,t.$running=!1,t.$queue=[],isThread&&!1!==e&&t.initThread()};if(Asynchronous.VERSION="0.4.5",Asynchronous.Thread=Thread,Asynchronous.Task=Task,Asynchronous.BrowserWindow=BrowserWindow,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(n){return NODE===n?isNode:BROWSER===n?isBrowser:undef},Asynchronous.isThread=function(n){return NODE===n?isNodeProcess:BROWSER===n?isWebWorker:isThread},Asynchronous.path=path,Asynchronous.blob=blobURL,Asynchronous.load=function(n,e,t){if(n){var r=function(){n=n.split(".");for(var e=root;n.length;)n[0]&&n[0].length&&e[n[0]]&&(e=e[n[0]]),n.shift();return e&&root!==e?is_function(e)?!1!==t?new e:e():e:void 0};return e&&e.length&&(e=e.filter(notThisPath),e.length&&importScripts(e.join(","))),r()}return null},Asynchronous.serialize=function(n){n=n||new Asynchronous;var e=function(e){var t=function(){var t=this,r=arguments;n.step(function(){e.apply(t,r)}),n.$running||n.run(LINEARISED)};return t.free=function(){return e},t};return e.free=function(){n&&n.dispose(),n=null},e},Asynchronous[PROTO]={constructor:Asynchronous,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$runmode:NONE,$running:!1,dispose:function(){var n=this;return n.unfork(!0),n.$timer&&ClearTime(n.$timer),n.$thread=null,n.$timer=null,n.$interval=null,n.$queue=null,n.$runmode=NONE,n.$running=!1,n},empty:function(){var n=this;return n.$timer&&ClearTime(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=NONE,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10),this):this.$interval},fork:function(n,e,t){var r,o,s,i=this;if(!i.$thread){if(!supportsMultiThread)throw i.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(o="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(o="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),i.$events=i.$events||{},r=i.$thread=new Thread(tpf),r.onmessage=function(n){if(n.data.event){var e=n.data.event,t=n.data.data||null;i.$events&&i.$events[e]?i.$events[e](t):("console.log"===e||"console.error"===e)&&console.log(o+(t.output||""))}},r.onerror=function(n){if(!i.$events||!i.$events.error)throw new Error(s+n.message+" file: "+n.filename+" line: "+n.lineno);i.$events.error(n)},i.send("initThread",{component:n||null,asInstance:!1!==t,imports:e?[].concat(e):null})}return i},unfork:function(n){var e=this;return e.$thread&&(e.send("dispose"),!0===n&&e.$thread.terminate()),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return isThread&&(n.$events={},onMessage(function(e){var t=e.data.event,r=e.data.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),close())})),n},listen:function(n,e){return n&&is_function(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(isThread?postMessage({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return is_instance(n,Task)?n:is_function(n)?Task(n):void 0},iif:function(){var n=arguments,e=new Task;return e.iif.apply(e,n)},until:function(){var n=slice(arguments),e=new Task(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=slice(arguments),e=new Task(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=slice(arguments),e=new Task(n.pop());return e.loop.apply(e,n)},each:function(){var n=slice(arguments),e=new Task(n.pop());return e.each.apply(e,n)},recurse:function(){var n=slice(arguments),e=new Task(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,t=this,r=arguments;for(e=r.length,n=0;e>n;n++)t.step(r[n]);return t},jumpNext:function(n,e){var t=this,r=t.$queue;return e=e||0,!1!==n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t)},jumpNextWithArgs:function(n,e,t){var r=this,o=r.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,t)),r)},abort:function(n,e){var t=this;return!1!==n?function(){return e&&e>0?SetTime(function(){t.empty()},e):t.empty(),t}:(e&&e>0?SetTime(function(){t.empty()},e):t.empty(),t)},run:function(n,e){var t=this;return arguments.length?t.$runmode=n:n=t.$runmode,e=e||null,SEQUENCED===n?runSequenced(t,e):INTERLEAVED===n?runInterleaved(t,e):LINEARISED===n?runLinearised(t,e):PARALLELISED===n&&runParallelised(t,e),t}},isThread){var Component=null;root.console={log:function(n){postMessage({event:"console.log",data:{output:n||""}})},error:function(n){postMessage({event:"console.error",data:{output:n||""}})}},onMessage(function(n){var e=n.data.event,t=n.data.data||null;switch(e){case"initThread":t&&t.component&&(Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),Component=Asynchronous.load(t.component,t.imports,t.asInstance));break;case"dispose":default:Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),close()}})}}(this,exports),exports.Asynchronous});
/**
*
*   FILTER.js
*   @version: 0.7-alpha2
*   @built on 2015-05-06 00:06:48
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n,r){"use strict";function i(e,t,n,r,i){var a;return e?{file:__filename,path:__dirname}:t?{file:a=self.location.href,path:a.split("/").slice(0,-1).join("/")}:n&&i&&i.uri?{file:a=i.uri,path:a.split("/").slice(0,-1).join("/")}:r&&(a=document.getElementsByTagName("script"))&&a.length?{file:a=a[a.length-1].src,path:a.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function a(e,t,n,r,i){var a,s=e.length,o=new Array(s);for(a=0;s>a;a++)o[a]=1===r?n[e[a]]||i(t[a]):2===r?i(e[a]):n[e[a]];return o}function s(e,t,n,r,i,a){var s,o,l,u,c,h,f,d=n.length;if(a){for(s=0;d>s;s++)n[s]in e||importScripts(t+r[s]);return i()}h=document.getElementsByTagName("head")[0],f=document.createElement("a"),o=/^\./,l=0,s=0,u=function(e,n){var r=0,i=document.createElement("script");i.type="text/javascript",i.language="javascript",i.onload=i.onreadystatechange=function(){r||i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(r=1,i.onload=i.onreadystatechange=null,n(),h.removeChild(i),i=null)},o.test(e)&&(f.href=t+e,e=f.protocol+"//"+f.host+f.pathname+f.search+f.hash),i.src=e,h.appendChild(i)},c=function(){n[s]in e?++s>=d?i():n[s]in e?c():u(r[s],c):++l<30?setTimeout(c,30):(l=0,s++,c())};for(;d>s&&n[s]in e;)s++;d>s?u(r[s],c):i()}n=n||[[],[]];var o,l,u,c="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),h=!c&&"undefined"!=typeof navigator,f=!c&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,m=c&&"object"==typeof module&&module.exports,p=f?self:e,_=i(c,f,d,h),g=[].concat(n[0]),v=[].concat(n[1]),w=g.length,y=/\.js$/i;if(m)module.$deps=module.$deps||{},module.exports=module.$deps[t]=r.apply(e,[{NODE:module}].concat(a(g,v,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)){if(!require.defined(t)){for(u={},l=0;w>l;l++)require.specified(g[l])||(u[g[l]]=v[l].replace(y,""));require.config({paths:u}),define(t,["require","exports","module"].concat(g),function(t,n,i){return r.apply(e,[{AMD:i}].concat(a(g,v,arguments,2,t)))})}}else t in p||s(p,_.path+"/",g,v,function(){p[t]=o=r.apply(e,[{}].concat(a(g,v,p)))||1,d&&define(t,["require"],function(){return o})},f)}(this,"FILTER",[["Classy","Asynchronous"],["./classy.js","./asynchronous.js"]],function(exports,Classy,Asynchronous){var FILTER=exports.FILTER=Classy.Merge({Classy:Classy,Asynchronous:Asynchronous,Path:Asynchronous.path(exports.AMD)},Classy);return FILTER.VERSION="0.7-alpha2",!function(e,t){"use strict";var n,r="prototype",i=Object[r],a=Function[r],s=Array[r],o=a.call.bind(s.slice),l=(a.call.bind(i.toString),s.splice,s.concat,t.Path),u=t.Merge,c=t.Asynchronous,h=c.isPlatform(c.Platform.NODE),f=c.isPlatform(c.Platform.BROWSER),d=c.supportsMultiThreading(),m=c.isThread(),p=navigator?navigator.userAgent:"",_=t.devicePixelRatio=e.devicePixelRatio||1,g=t._notSupportClamp="undefined"==typeof Uint8ClampedArray,v=function(){return"[FILTER Plugin: "+this.name+"]"},w=function(e){return e},y=function(){},b=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},A=0,C=t.Browser={isNode:h,isBrowser:f,isWorker:m,supportsWorker:d,isPhantom:/PhantomJS/.test(p),isOpera:f&&/Opera|OPR\//.test(p),isFirefox:f&&/Firefox\//.test(p),isChrome:f&&/Chrome\//.test(p),isSafari:f&&/Apple Computer/.test(navigator.vendor),isKhtml:f&&/KHTML\//.test(p),isIE:f&&(/MSIE \d/.test(p)||/Trident\/\d/.test(p)),isGecko:f&&/gecko\/\d/i.test(p),isWebkit:f&&/WebKit\//.test(p),isMac_geLion:f&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(p),isMac_geMountainLion:f&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(p),isMobile:!1,isIOS:/AppleWebKit/.test(p)&&/Mobile\/\w+/.test(p),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};if(C.isMobile=C.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(p),C.isMac=C.isIOS||/Mac/.test(navigator.platform),C.isIE_lt8=C.isIE&&!m&&(null==document.documentMode||document.documentMode<8),C.isIE_lt9=C.isIE&&!m&&(null==document.documentMode||document.documentMode<9),C.isQtWebkit=C.isWebkit&&/Qt\/\d+\.\d+/.test(p),t.getPath=c.path,t.getCanvas=t.createCanvas=function(e,t){var n=document.createElement("canvas");return e=e||0,t=t||0,n.style.width=e+"px",n.style.height=t+"px",n.width=e*_,n.height=t*_,n},t.uuid=function(e){return[e||"filter",(new Date).getTime(),++A].join("_")},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.ImArray=g?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=C.isOpera?t.Array8U:t.ImArray,g&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray[r].set){var R=function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n];return this};CanvasPixelArray[r].set=R}g=t._notSupportClamp=g||C.isOpera,t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,PI_2:.5*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1,DATA:4,PNG:8,JPG:16,GIF:32},t.MIME={PNG:"image/png",JPG:"image/jpeg",GIF:"image/gif"},t.FORMAT.JPEG=t.FORMAT.JPG,t.MIME.JPEG=t.MIME.JPG,n=t.log=console&&console.log?console.log:function(){},t.warning=function(e){n("WARNING: "+e)},t.error=function(e,t){if(n("ERROR: "+e),t)throw new Error(e)};var E=t.FilterThread=t.Class(c,{path:t.getPath(exports.AMD),name:null,constructor:function(){var e=this,t=null;m&&e.initThread().listen("load",function(e){e&&e.filter&&(t&&(t.dispose(!0),t=null),t=c.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&importScripts(e["import"])}).listen("params",function(e){t&&t.unserialize(e)}).listen("apply",function(n){t&&n&&n.im?(n.params&&t.unserialize(n.params),e.send("apply",{im:t._apply(n.im[0],n.im[1],n.im[2])})):e.send("apply",{im:null})}).listen("dispose",function(){t&&(t.dispose(!0),t=null),e.dispose(!0),close()})},thread:function(e){var t=this;return arguments.length||(e=!0),e=!!e,e&&!t.$thread?(t.fork("FILTER.FilterThread",l.file!==t.path.file?[l.file,t.path.file]:t.path.file),t.send("load",{filter:t.name})):!e&&t.$thread&&t.unfork(),t},sources:function(){var e=o(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)n.push("function"==typeof e[t]?c.blob(e[t].toString()):c.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=o(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),I=t.Filter=t.Class(E,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_onComplete:null,dispose:function(){var e=this;return e.$super("dispose"),e._onComplete=null,e},worker:E[r].thread,complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},combineWith:function(){return this},_apply:function(e){return e},apply:function(e,t,n){var r,i=this;return i.canRun()?(arguments.length<3&&(t&&t.setSelectedData?n=null:"function"==typeof t?(n=t,t=e):(t=e,n=null)),e&&t&&(n=n||i._onComplete,r=e.getSelectedData(),i.$thread?i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),n&&n.call(i)}).send("apply",{im:r,params:i.serialize()}):(t.setSelectedData(i._apply(r[0],r[1],r[2],e)),n&&n.call(i))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=u({init:y,name:"PluginFilter",toString:v,apply:w},e),e.constructor=b(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(I,e)}}(this,FILTER),!function(e){"use strict";var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,s=(Math.abs,function(e,t,n){return a(r(e,n),t)}),o=function(e){return e.replace(/([.*+?^${}()|\[\]\/\\\-])/g,"\\$1")},l=function(e){return e.replace(/^\s+/gm,"").replace(/\s+$/gm,"")},u=1/255,c=100/255,h=2.55,f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},d=e.Color=e.Class({__static__:{clamp:s,clampPixel:function(e){return r(255,a(e,0))},ubyteToFloat:function(e){return.00392156862745098*e},ubyteColorToFloatColor:function(e){var t=e.length,n=new Array(t);for(i=0;t>i;i++)n[i]=.00392156862745098*e[i];return n},hexColorToFloatColor:function(e){var t,n,r,i;return t=e>>16&255,n=e>>8&255,r=255&e,i=e>>24&255,[.00392156862745098*t,.00392156862745098*n,.00392156862745098*r,.00392156862745098*i]},blend:function(e,t,n){return{r:e.r-~~((e.r-t.r)*n+.5),g:e.g-~~((e.g-t.g)*n+.5),b:e.b-~~((e.b-t.b)*n+.5)}},toGray:function(t,n,r){var i=e.LUMA;return~~(i[0]*t+i[1]*n+i[2]*r)},distance:function(e,n){var r=e.r-n.r,i=e.g-n.g,a=e.b-n.b;return t(r*r+i*i+a*a)},RGB2Color:function(e){return e.r<<16|e.g<<8|255&e.b},RGBA2Color:function(e){return e.a<<24|e.r<<16|e.g<<8|255&e.b},Color2RGBA:function(e){return e=~~e,{r:e>>>16&255,g:e>>>8&255,b:255&e,a:e>>>24&255}},RGB2YCbCr:function(e){var t,n,r,i=e.r,a=e.g,s=e.b;return t=~~(0+.299*i+.587*a+.114*s),n=~~(128-.168736*i-.331264*a+.5*s),r=~~(128+.5*i-.418688*a-.081312*s),{y:t,cb:n,cr:r}},YCbCr2RGB:function(e){var t,n,r,i=e.y,a=e.cb,s=e.cr;return t=~~(i+1.402*(s-128)),n=~~(i-.34414*(a-128)-.71414*(s-128)),r=~~(i+1.772*(a-128)),{r:t,g:n,b:r}},RGB2HSV:function(e){var t,n,i,s,o,l,u,c,h;return s=e.r,o=e.g,l=e.b,t=r(s,o,l),n=a(s,o,l),i=n-t,h=n,0==n?(c=0,u=0,{h:u,s:c,v:h}):(c=i/n,u=s==n?(o-l)/i:o==n?2+(l-s)/i:4+(s-o)/i,u*=60,0>u&&(u+=360),{h:u,s:c,v:h})},HSV2RGB:function(e){var t,n,r,i,a,s,o,l,u,c,h;if(u=e.h,c=e.s,h=e.v,0==c)return s=o=l=h,{r:s,g:o,b:l};switch(u/=60,t=~~u,n=u-t,r=h*(1-c),i=h*(1-c*n),a=h*(1-c*(1-n)),t){case 0:s=h,o=a,l=r;break;case 1:s=i,o=h,l=r;break;case 2:s=r,o=h,l=a;break;case 3:s=r,o=i,l=h;break;case 4:s=a,o=r,l=h;break;default:s=h,o=r,l=i}return{r:s,g:o,b:l}},toString:function(){return"[FILTER: "+this.name+"]"},C2F:u,C2P:c,P2C:h,Keywords:f,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(f).map(o).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*c+(t||"")},per2col:function(e){return e*h},rgb2cmyk:function(e,t,i,a){var o,l,c=0,f=0,d=0,m=0;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),i=s(n(i*h),0,255)),0==e&&0==t&&0==i?(m=1,[0,0,0,1]):(c=1-e*u,f=1-t*u,d=1-i*u,o=r(c,f,d),l=1/(1-o),c=(c-o)*l,f=(f-o)*l,d=(d-o)*l,m=o,[c,f,d,m])},cmyk2rgb:function(e,t,r,i){var a,o,l=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(a=i,o=1-a,e=e*o+a,t=t*o+a,r=r*o+a,l=255*(1-e),u=255*(1-t),c=255*(1-r),[s(n(l),0,255),s(n(u),0,255),s(n(c),0,255)])},rgb2hex:function(e,t,r,i,a){var o;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),r=s(n(r*h),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o=i&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,i,a){var o;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),r=s(n(r*h),0,255),i=s(n(i*h),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),i=16>i?"0"+i.toString(16):i.toString(16),o="#"+i+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[s(parseInt(e[0]+e[0],16),0,255),s(parseInt(e[1]+e[1],16),0,255),s(parseInt(e[2]+e[2],16),0,255)]:[s(parseInt(e[0]+e[1],16),0,255),s(parseInt(e[2]+e[3],16),0,255),s(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var i,a,o,l,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(i=1,a=1,o=1):(u=.5>r?r*(1+t):r+t-r*t,l=2*r-u,i=d.hue2rgb(l,u,e+1/3),a=d.hue2rgb(l,u,e),o=d.hue2rgb(l,u,e-1/3)),[s(n(255*i),0,255),s(n(255*a),0,255),s(n(255*o),0,255)]},rgb2hsl:function(e,t,i,o){var l,c,h,f,d,m;return o?(e*=.01,t*=.01,i*=.01):(e*=u,t*=u,i*=u),c=a(e,t,i),l=r(e,t,i),d=.5*(c+l),c==l?h=f=0:(m=c-l,f=d>.5?m/(2-a-r):m/(a+r),h=c==e?(t-i)/m+(i>t?6:0):c==t?(i-e)/m+2:(e-t)/m+4,h/=6),[n(360*h)%360,s(100*f,0,100),s(100*d,0,100)]},parse:function(e,t,n,r){var i,a,s,o,u,h=0,f=0;if("hsl"==n||!n&&(i=e.match(d.hslRE))){if("hsl"==n){u="hsla"==e[0].toLowerCase();var m=e[1].split(",").map(l)}else{h=i[0].length,f=0,u="hsla"==i[1].toLowerCase();var m=i[2].split(",").map(l)}var p=m[0]?m[0]:"0",e=m[1]?m[1]:"0",_=m[2]?m[2]:"0",g=u&&null!=m[3]?m[3]:"1";return p=parseFloat(p,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*c,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*c,g=parseFloat(g,10),o=(new d).fromHSL([p,e,_,g]),t&&(s=e.substr(h),(a=s.match(d.colorstopRE))&&(o.colorStop(a[1]),f=a[0].length)),r?o:[o,0,h+f]}if("rgb"==n||!n&&(i=e.match(d.rgbRE))){if("rgb"==n){u="rgba"==e[0].toLowerCase();var m=e[1].split(",").map(l)}else{h=i[0].length,f=0,u="rgba"==i[1].toLowerCase();var m=i[2].split(",").map(l)}var v=m[0]?m[0]:"0",w=m[1]?m[1]:"0",y=m[2]?m[2]:"0",g=u&&null!=m[3]?m[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),g=parseFloat(g,10),o=(new d).fromRGB([v,w,y,g]),t&&(s=e.substr(h),(a=s.match(d.colorstopRE))&&(o.colorStop(a[1]),f=a[0].length)),r?o:[o,0,h+f]}if("hex"==n||!n&&(i=e.match(d.hexRE))){if("hex"==n)var m=d.hex2rgb(e[0]);else{h=i[0].length,f=0;var m=d.hex2rgb(i[1])}var b=m[0]?m[0]:0,A=m[1]?m[1]:0,C=m[2]?m[2]:0,g=null!=m[3]?m[3]:255;return o=(new d).fromHEX([b,A,C,g]),t&&(s=e.substr(h),(a=s.match(d.colorstopRE))&&(o.colorStop(a[1]),f=a[0].length)),r?o:[o,0,h+f]}if("keyword"==n||!n&&(i=e.match(d.keywordRE))){if("keyword"==n)var m=e[0];else{h=i[0].length,f=0;var m=i[1]}return o=(new d).fromKeyword(m),t&&(s=e.substr(h),(a=s.match(d.colorstopRE))&&(o.colorStop(a[1]),f=a[0].length)),r?o:[o,0,h+f]}return null},fromString:function(e,t,n){return d.parse(e,t,n,1)},fromRGB:function(e){return(new d).fromRGB(e)},fromHSL:function(e){return(new d).fromHSL(e)},fromCMYK:function(e){return(new d).fromCMYK(e)},fromHEX:function(e){return(new d).fromHEX(e)},fromKeyword:function(e){return(new d).fromKeyword(e)},fromPixel:function(e){return(new d).fromPixel(e)}},constructor:function(e,t){return this instanceof d?(this.reset(),void(e&&this.set(e,t))):new d(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new d;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=s(e[0],0,255)),undef!==e[1]&&(this.col[1]=s(e[1],0,255)),undef!==e[2]&&(this.col[2]=s(e[2],0,255)),this.col[3]=undef!==e[3]?s(e[3],0,1):1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return this.kword?!0:!1},fromPixel:function(e){return e=e||0,this.col=[s(e>>16&255,0,255),s(e>>8&255,0,255),s(255&e,0,255),s((e>>24&255)*u,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),d.Keywords[e]&&(this.col=d.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?s(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?s(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?s(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?s(parseInt(e[3],10)*u,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?s(n(e[0]),0,255):0,this.col[1]=e[1]?s(n(e[1]),0,255):0,this.col[2]=e[2]?s(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?s(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=d.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?s(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=d.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?s(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?s(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=d.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?d.rgb2hexIE(this.col[0],this.col[1],this.col[2],s(n(255*this.col[3]),0,255)):d.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],i=d.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(FILTER),!function(e){"use strict";function t(e){var t=e.width,n=e.height,r=h(t,n);return r.width=t*o,r.height=n*o,r}function n(e,t,n,r){return r=r||C,r&b&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*o,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&A&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*o,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function r(e){var t,n,r,i,a,s,o,l,u,h=e.width,f=(e.height,h<<2),d=e.getPixelData().data,m=d.length,p=m>>2;for(t=new c(p),n=new c(p),r=new c(p),l=0,o=0,i=a=s=0,u=0;h>u;u++,o+=4,l++)i+=d[o],a+=d[o+1],s+=d[o+2],t[l]=i,n[l]=a,r[l]=s;for(o=f,u=0,l=0,i=a=s=0,o=f;m>o;o+=4,l++,u++)u>=h&&(u=0,i=a=s=0),i+=d[o],a+=d[o+1],s+=d[o+2],t[l+h]=t[l]+i,n[l+h]=n[l]+a,r[l+h]=r[l]+s;return e._integral=[t,n,r],e._needsRefresh&=L,e}function i(e){var t,n,r,i,a,s,o,l,u,h,f=e.getPixelData().data,d=f.length,m=0,p=0,_=0,g=255,v=255,w=255,y=1/(d>>2);for(t=new c(256),n=new c(256),r=new c(256),h=0;256>h;h+=4)t[h]=0,n[h]=0,r[h]=0,t[h+1]=0,n[h+1]=0,r[h+1]=0,t[h+2]=0,n[h+2]=0,r[h+2]=0,t[h+3]=0,n[h+3]=0,r[h+3]=0;for(h=0;d>h;h+=4)i=f[h],a=f[h+1],s=f[h+2],t[i]+=y,n[a]+=y,r[s]+=y,i>m?m=i:g>i&&(g=i),a>p?p=a:v>a&&(v=a),s>_?_=s:w>s&&(w=s);for(o=l=u=0,h=0;256>h;h+=4)o+=t[h],t[h]=o,l+=n[h],n[h]=l,u+=r[h],r[h]=u,o+=t[h+1],t[h+1]=o,l+=n[h+1],n[h+1]=l,u+=r[h+1],r[h+1]=u,o+=t[h+2],t[h+2]=o,l+=n[h+2],n[h+2]=l,u+=r[h+2],r[h+2]=u,o+=t[h+3],t[h+3]=o,l+=n[h+3],n[h+3]=l,u+=r[h+3],r[h+3]=u;return e._histogram=[t,n,r],e._needsRefresh&=M,e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&p&&e._needsRefresh&p&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~p),t&_&&e._needsRefresh&_&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~_),e}function s(e,t){if(e.selection){var n=e.selection,r=e.width-1,i=e.height-1,a=f(n[0]*r),s=f(n[1]*i),o=f(n[2]*r)-a+1,l=f(n[3]*i)-s+1;t=t||255,e._restorable&&t&g&&e._needsRefresh&g&&(e.iDataSel=e.ictx.getImageData(a,s,o,l),e._needsRefresh&=~g),t&v&&e._needsRefresh&v&&(e.oDataSel=e.octx.getImageData(a,s,o,l),e._needsRefresh&=~v)}return e}var o=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,c=e.Array32F,h=e.createCanvas,f=(e._notSupportTypedArrays,Math.min,Math.floor),d=e.FORMAT,m=e.MIME,p=1,_=2,g=4,v=8,w=16,y=32,b=2,A=4,C=b|A,R=g|v,E=p|_,I=~R,M=~w,L=~y,x=e.Image=e.Class({name:"Image",constructor:function(e){var t=this,n=0,r=0;return t instanceof x?(t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=h(n,r),t.oCanvas=h(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=null,t._integral=null,t.selection=null,t._needsRefresh=0,t._restorable=!0,void(e&&t.setImage(e))):new x(e)},width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_needsRefresh:0,_restorable:!0,dispose:function(){var e=this;return e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._needsRefresh=null,e._restorable=null,e},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var i=this,a=arguments.length;return 1>a&&(e=0),2>a&&(t=0),3>a&&(n=1),4>a&&(r=1),i.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],i._needsRefresh|=R,i},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=I,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=p,e.selection&&(e._needsRefresh|=g)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=_|w|y,e.selection&&(e._needsRefresh|=v)),e},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=E|w|y,e.selection&&(e._needsRefresh|=R)),e},fill:function(e,t,n,r,i){var a=this,s=a.width,o=a.height;if(!r&&s&&!i&&o)return a;r&&!s&&i&&!o&&a.createImageData(r,i);var l=a.ictx,u=a.octx;return e=e||0,t=t||0,n=n||0,r=r||s,i=i||o,a._restorable&&(l.fillStyle=e,l.fillRect(t,n,r,i)),u.fillStyle=e,u.fillRect(t,n,r,i),a._needsRefresh|=E|w|y,a.selection&&(a._needsRefresh|=R),a},setDimensions:function(e,t){var r=this;return n(r,e,t,C),r._needsRefresh|=E|w|y,r.selection&&(r._needsRefresh|=R),r},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&p&&a(t,p),e=t.iData):(t._needsRefresh&_&&a(t,_),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&g&&s(t,g),e=t.iDataSel):(t._needsRefresh&v&&s(t,v),e=t.oDataSel):t._restorable?(t._needsRefresh&p&&a(t,p),e=t.iData):(t._needsRefresh&_&&a(t,_),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&_&&a(e,_),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&v&&s(t,v),e=t.oDataSel):(t._needsRefresh&_&&a(t,_),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&_&&a(t,_),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=w|y,t.selection&&(t._needsRefresh|=v),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,i=t.height-1,o=f(n[0]*r),l=f(n[1]*i);t._needsRefresh&v&&s(t,v),t.oDataSel.data.set(e),t.octx.putImageData(t.oDataSel,o,l),t._needsRefresh|=_}else t._needsRefresh&_&&a(t,_),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=w|y,t},createImageData:function(e,t){var r,i,a=this;return n(a,e,t,C),a._restorable&&(r=a.ictx=a.iCanvas.getContext("2d"),r.createImageData(e,t)),i=a.octx=a.oCanvas.getContext("2d"),i.createImageData(e,t),a._needsRefresh|=E,a.selection&&(a._needsRefresh|=R),a},setImage:function(e){if(!e)return this;var t,r,i,s,o,l,u,c,h=this;return o=e instanceof x,o&&(e=e.oCanvas),l=e instanceof HTMLVideoElement,u=e instanceof HTMLCanvasElement,c=e instanceof Image,l?(i=e.videoWidth,s=e.videoHeight):(i=e.width,s=e.height),c||u||l?(n(h,i,s,C),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),t.drawImage(e,0,0)),r=h.octx=h.oCanvas.getContext("2d"),r.drawImage(e,0,0),h._needsRefresh|=E):(h.oData||(h.createImageData(i,s),a(h,E)),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),h.iData.data.set(e.data),t.putImageData(h.iData,0,0)),r=h.octx=h.oCanvas.getContext("2d"),h.oData.data.set(e.data),r.putImageData(h.oData,0,0)),h._needsRefresh|=w|y,h.selection&&(h._needsRefresh|=R),h},getPixel:function(e,t){var n=this;n._needsRefresh&_&&a(n,_);var r=~~(t*n.width+e+.5),i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,i,a){var s=this,o=new l([255&n,255&r,255&i,255&a]);return s.octx.putImageData(o,e,t),s._needsRefresh|=_|w|y,s.selection&&(s._needsRefresh|=v),s},getPixelData:function(){return this._needsRefresh&_&&a(this,_),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=_|w|y,t.selection&&(t._needsRefresh|=v),t},clone:function(e){return new x(!0===e?this.iCanvas:this.oCanvas)},scale:function(e,n){var r=this;if(e=e||1,n=n||e,1==e&&1==n)return r;r.tmpCanvas=r.tmpCanvas||t(r);var i=r.tmpCanvas.getContext("2d"),a=r.width,s=r.height;return i.scale(e,n),a=r.width=~~(e*a+.5),s=r.height=~~(n*s+.5),i.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=a+"px",r.oCanvas.style.height=s+"px",r.oCanvas.width=a*o,r.oCanvas.height=s*o,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(i.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=E|w|y,r.selection&&(r._needsRefresh|=R),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||t(e);var n=e.tmpCanvas.getContext("2d");return n.translate(e.width,0),n.scale(-1,1),n.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(n.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=E|w|y,e.selection&&(e._needsRefresh|=R),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||t(e);var n=e.tmpCanvas.getContext("2d");return n.translate(0,e.height),n.scale(1,-1),n.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(n.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=E|w|y,e.selection&&(e._needsRefresh|=R),e},draw:function(){return this},integral:function(){return this._needsRefresh&y&&r(this),this._integral},histogram:function(){return this._needsRefresh&w&&i(this),this._histogram},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=e&d.JPG?n.toDataURL(m.JPG,r):e&d.GIF?n.toDataURL(m.GIF,r):n.toDataURL(m.PNG,r),e&d.IMAGE){var i=new Image;return i.src=t,i}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}}),N=e.ScaledImage=e.Class(x,{name:"ScaledImage",constructor:function(e,t,n){var r=this;return r instanceof N?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new N(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){return new N(this.scaleX,this.scaleY,!0===e?this.iCanvas:this.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},setImage:function(e){if(!e)return this;var t,r,i,a,s,o,l,u,c,h,f=this,d=f.scaleX,m=f.scaleY;
return l=e instanceof x,l&&(e=e.oCanvas),u=e instanceof HTMLVideoElement,c=e instanceof HTMLCanvasElement,h=e instanceof Image,u?(i=e.videoWidth,a=e.videoHeight):(i=e.width,a=e.height),(h||c||u)&&(s=~~(d*i+.5),o=~~(m*a+.5),n(f,s,o,C),f._restorable&&(t=f.ictx=f.iCanvas.getContext("2d"),t.drawImage(e,0,0,i,a,0,0,s,o)),r=f.octx=f.oCanvas.getContext("2d"),r.drawImage(e,0,0,i,a,0,0,s,o),f._needsRefresh|=E|w|y,f.selection&&(f._needsRefresh|=R)),f}})}(FILTER),!function(e){"use strict";var t=e.Image,n=e.Class,r="addEventListener",i=e.Loader=n({name:"Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r,i){return(new n).load(e,t,r,i)}},e.LATE|e.STATIC)},constructor:function s(){return this instanceof s?void 0:new s},dispose:function(){return this},load:function(){return null},_crossOrigin:null,_responseType:null,responseType:function(e){return arguments.length?(this._responseType=e,this):this._responseType},crossOrigin:function(e){return arguments.length?(this._crossOrigin=e,this):this._crossOrigin}}),a=e.XHRLoader=n(i,{name:"XHRLoader",constructor:function o(){return this instanceof o?void 0:new o},load:function(e,t,n,i){var a=this,s=new XMLHttpRequest;return s.open("GET",e,!0),s[r]("load",function(){t&&t(this.response)},!1),"function"==typeof n&&s[r]("progress",n,!1),"function"==typeof i&&s[r]("error",i,!1),a._crossOrigin&&(s.crossOrigin=a._crossOrigin),a._responseType&&(s.responseType=a._responseType),s.send(null),a}});e.BinaryLoader=n(i,{name:"BinaryLoader",constructor:function l(){return this instanceof l?void 0:new l},_parser:null,load:function(e,n,r,i){var s,o=this,l=new t;return"function"==typeof o._parser&&(s=(new a).responseType(o._responseType||"arraybuffer").load(e,function(e){var t=o._parser(e);t&&(l.setImage(t),"function"==typeof n&&n(l,t))},r,i)),l}})}(FILTER),!function(e){"use strict";var t=e.Image;e.HTMLImageLoader=e.Class(e.Loader,{name:"HTMLImageLoader",constructor:function n(){return this instanceof n?void this.$super("constructor"):new n},load:function(e,n,r,i){var a,s=this,o=new t;return a=new Image,a.onload=function(){o.setImage(a),"function"==typeof n&&n(o,a)},a.onerror=function(){"function"==typeof i&&i(o,a)},a.crossOrigin=s._crossOrigin?s._crossOrigin:"",a.src=e,o}})}(FILTER),!function(e){"use strict";var t=Object.prototype,n=Function.prototype,r=Array.prototype,i=n.call.bind(r.slice),a=(n.call.bind(t.toString),r.splice),s=r.concat,o=e.CompositeFilter=e.Class(e.Filter,{name:"CompositeFilter",constructor:function(e){var t=this;t.$super("constructor"),t._stack=e&&e.length?e.slice():[]},_stack:null,_stable:!0,dispose:function(e){var t,n=this,r=n._stack;if(n.$super("dispose"),!0===e)for(t=0;t<r.length;t++)r[t]&&r[t].dispose(e),r[t]=null;return n._stack=null,n},serialize:function(){var e,t=this,n={filter:t.name,_isOn:!!t._isOn,_stable:!!t._stable,filters:[]},r=t._stack;for(e=0;e<r.length;e++)n.filters.push(r[e].serialize());return n},unserialize:function(t){var n,r,i,a,s,o=this,l=o._stack;if(t&&o.name===t.filter){if(o._isOn=!!t._isOn,o._stable=!!t._stable,a=t.filters||[],r=a.length,i=l.length,r===i&&o._stable)for(n=0;r>n;n++)l[n]=l[n].unserialize(a[n]);else{for(n=0;i>n;n++)l[n]&&l[n].dispose(!0),l[n]=null;for(l=[],n=0;r>n;n++){if(s=a[n]&&a[n].filter?e[a[n].filter]:null,!s)throw new Error('Filter "'+a[n].filter+'" could not be created');l.push((new s).unserialize(a[n]))}}o._stack=l}return o},stable:function(e){return arguments.length||(e=!0),this._stable=!!e,this},filters:function(e){return arguments.length?(this._stack=e.slice(),this):this._stack.slice()},push:function(){var e=i(arguments),t=e.length;return t&&(this._stack=s.apply(this._stack,e)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var e=i(arguments),t=e.length;return t&&a.apply(this._stack,[0,0].concat(e)),this},getAt:function(e){return this._stack.length>e?this._stack[e]:null},setAt:function(e,t){return this._stack.length>e?this._stack[e]=t:this._stack.push(t),this},insertAt:function(e){{var t=i(arguments);t.length}return argslen>1&&(t.shift(),a.apply(this._stack,[e,0].concat(t))),this},removeAt:function(e){return this._stack.splice(e,1)},remove:function(e){for(var t=this._stack.length;--t>=0;)e===this._stack[t]&&this._stack.splice(t,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(e,t,n,r){var i=this;if(i._isOn&&i._stack.length){var a,s,o=i._stack,l=o.length;for(a=0;l>a;a++)s=o[a],s&&s._isOn&&(e=s._apply(e,t,n,r))}return e},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var e,t=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=t+t,r=this._stack,i=[],a=r.length;for(e=0;a>e;e++)i.push(r[e].toString(n));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});o.prototype.empty=o.prototype.reset,o.prototype.concat=o.prototype.push}(FILTER),!function(e){"use strict";e.CustomFilter=e.Class(e.Filter,{name:"CustomFilter",constructor:function(e){var t=this;t.$super("constructor"),t._handler=e&&"function"==typeof e?e:null},_handler:null,dispose:function(){var e=this;return e.$super("dispose"),e._handler=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_handler:e._handler?e._handler.toString():null}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._handler=null,t._handler&&(n._handler=new Function("",'"use strict"; return '+t._handler+";")())),n},_apply:function(e,t,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,e,t,n,r):e},canRun:function(){return this._isOn&&this._handler}})}(FILTER),!function(e,t){"use strict";function n(e,t){var n,r,i,a,o,l=new s(20);return n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],l[0]=n*e[0]+r*e[5]+i*e[10]+a*e[15],l[1]=n*e[1]+r*e[6]+i*e[11]+a*e[16],l[2]=n*e[2]+r*e[7]+i*e[12]+a*e[17],l[3]=n*e[3]+r*e[8]+i*e[13]+a*e[18],l[4]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+o,n=t[5],r=t[6],i=t[7],a=t[8],o=t[9],l[5]=n*e[0]+r*e[5]+i*e[10]+a*e[15],l[6]=n*e[1]+r*e[6]+i*e[11]+a*e[16],l[7]=n*e[2]+r*e[7]+i*e[12]+a*e[17],l[8]=n*e[3]+r*e[8]+i*e[13]+a*e[18],l[9]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+o,n=t[10],r=t[11],i=t[12],a=t[13],o=t[14],l[10]=n*e[0]+r*e[5]+i*e[10]+a*e[15],l[11]=n*e[1]+r*e[6]+i*e[11]+a*e[16],l[12]=n*e[2]+r*e[7]+i*e[12]+a*e[17],l[13]=n*e[3]+r*e[8]+i*e[13]+a*e[18],l[14]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+o,n=t[15],r=t[16],i=t[17],a=t[18],o=t[19],l[15]=n*e[0]+r*e[5]+i*e[10]+a*e[15],l[16]=n*e[1]+r*e[6]+i*e[11]+a*e[16],l[17]=n*e[2]+r*e[7]+i*e[12]+a*e[17],l[18]=n*e[3]+r*e[8]+i*e[13]+a*e[18],l[19]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+o,l}function r(e,t,n){var r=1-n,i=new s(20);return i[0]=r*e[0]+n*t[0],i[1]=r*e[1]+n*t[1],i[2]=r*e[2]+n*t[2],i[3]=r*e[3]+n*t[3],i[4]=r*e[4]+n*t[4],i[5]=r*e[5]+n*t[5],i[6]=r*e[6]+n*t[6],i[7]=r*e[7]+n*t[7],i[8]=r*e[8]+n*t[8],i[9]=r*e[9]+n*t[9],i[10]=r*e[10]+n*t[10],i[11]=r*e[11]+n*t[11],i[12]=r*e[12]+n*t[12],i[13]=r*e[13]+n*t[13],i[14]=r*e[14]+n*t[14],i[15]=r*e[15]+n*t[15],i[16]=r*e[16]+n*t[16],i[17]=r*e[17]+n*t[17],i[18]=r*e[18]+n*t[18],i[19]=r*e[19]+n*t[19],i}var i=Math.sin,a=Math.cos,s=e.Array32F,o=e.CONSTANTS.toRad,l=(e.CONSTANTS.toDeg,e._notSupportClamp),u=e.ColorMatrixFilter=e.Class(e.Filter,{name:"ColorMatrixFilter",constructor:function(t){var n=this;n.$super("constructor"),n._matrix=t&&t.length?new s(t):null,e.useWebGL&&(n._webglInstance=e.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._matrix=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_matrix:e._matrix}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._matrix=t._matrix),n},channel:function(n,r){r=r===t?!1:r;var i=r?1:0;switch(n){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.set([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.set([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case e.CHANNEL.RED:default:return this.set([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(t){return this.channel(e.CHANNEL.RED,t)},greenChannel:function(t){return this.channel(e.CHANNEL.GREEN,t)},blueChannel:function(t){return this.channel(e.CHANNEL.BLUE,t)},alphaChannel:function(){return this.channel(e.CHANNEL.ALPHA,!0)},maskChannel:function(t){switch(t){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(t,n){switch(t){case e.CHANNEL.ALPHA:switch(n){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case e.CHANNEL.BLUE:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case e.CHANNEL.GREEN:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;case e.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case e.CHANNEL.RED:default:switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,0,0,0,1,0])},colorize:function(n,r){var i,a,s,o;return r===t&&(r=1),i=.00392156862745098*(n>>16&255),a=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),o=1-r,this.set([o+r*i*e.LUMA[0],r*i*e.LUMA[1],r*i*e.LUMA[2],0,0,r*a*e.LUMA[0],o+r*a*e.LUMA[1],r*a*e.LUMA[2],0,0,r*s*e.LUMA[0],r*s*e.LUMA[1],o+r*s*e.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(t){var n,r,i,a;return n=1-t,r=n*e.LUMA[0],i=n*e.LUMA[1],a=n*e.LUMA[2],this.set([r+t,i,a,0,0,r,i+t,a,0,0,r,i,a+t,0,0,0,0,0,1,0])},contrast:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),e+=1,n+=1,r+=1,this.set([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),this.set([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(t){t*=o;var n=a(t),r=i(t);return this.set([e.LUMA[0]+n*(1-e.LUMA[0])+r*-e.LUMA[0],e.LUMA[1]+n*-e.LUMA[1]+r*-e.LUMA[1],e.LUMA[2]+n*-e.LUMA[2]+r*(1-e.LUMA[2]),0,0,e.LUMA[0]+n*-e.LUMA[0]+.143*r,e.LUMA[1]+n*(1-e.LUMA[1])+.14*r,e.LUMA[2]+n*-e.LUMA[2]+r*-.283,0,0,e.LUMA[0]+n*-e.LUMA[0]+r*-(1-e.LUMA[0]),e.LUMA[1]+n*-e.LUMA[1]+r*e.LUMA[1],e.LUMA[2]+n*(1-e.LUMA[2])+r*e.LUMA[2],0,0,0,0,0,1,0])},average:function(e,n,r){return e===t&&(e=.3333),n===t&&(n=.3333),r===t&&(r=.3334),this.set([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){return e===t&&(e=1.2),this.set([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){return e===t&&(e=.5),e>1?e=1:0>e&&(e=0),this.set([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0])},sepia2:function(n){return n===t&&(n=10),n>100&&(n=100),n*=2.55,this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,40,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,20,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,-n,0,0,0,1,0])},threshold:function(n,r){return r===t&&(r=256),this.set([e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(e,n){return n===t&&(n=256),this.set([n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0])},threshold_alpha:function(e,n){return e===t&&(e=.5),n===t&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*e])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,t){return this._matrix=this._matrix?r(this._matrix,e.getMatrix(),t):new s(e.getMatrix()),this},set:function(e){return this._matrix=this._matrix?n(this._matrix,new s(e)):new s(e),this},reset:function(){return this._matrix=null,this},combineWith:function(e){return this.set(e.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(e){return this._matrix=new s(e),this},_apply:function(e){var t=this;if(t._isOn&&t._matrix){var n,r,i,a,s,o,l,u,c,h,f,d,m,p,_,g,v,w,y,b,A,C=e.length,R=t._matrix,E=(C>>2)%4;for(n=0;C>n;n+=16)w=e[n],y=e[n+1],b=e[n+2],A=e[n+3],r=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],i=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],a=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],s=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+4],y=e[n+5],b=e[n+6],A=e[n+7],o=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],l=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],u=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],c=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+8],y=e[n+9],b=e[n+10],A=e[n+11],h=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],f=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],d=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],m=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+12],y=e[n+13],b=e[n+14],A=e[n+15],p=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],_=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],g=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],v=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~d,e[n+11]=~~m,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(E)for(E<<=2,n=C-E;C>n;n+=4)w=e[n],y=e[n+1],b=e[n+2],A=e[n+3],r=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],i=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],a=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],s=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s}return e},canRun:function(){return this._isOn&&this._matrix}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha,l&&(u.prototype._apply=function(e){var t=this;if(t._isOn&&t._matrix){var n,r,i,a,s,o,l,u,c,h,f,d,m,p,_,g,v,w,y,b,A,C=e.length,R=t._matrix,E=(C>>2)%4;for(n=0;C>n;n+=16)w=e[n],y=e[n+1],b=e[n+2],A=e[n+3],r=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],i=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],a=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],s=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+4],y=e[n+5],b=e[n+6],A=e[n+7],o=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],l=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],u=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],c=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+8],y=e[n+9],b=e[n+10],A=e[n+11],h=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],f=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],d=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],m=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],w=e[n+12],y=e[n+13],b=e[n+14],A=e[n+15],p=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],_=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],g=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],v=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],r=0>r?0:r>255?255:r,i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~d,e[n+11]=~~m,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(E)for(E<<=2,n=C-E;C>n;n+=4)w=e[n],y=e[n+1],b=e[n+2],A=e[n+3],r=R[0]*w+R[1]*y+R[2]*b+R[3]*A+R[4],i=R[5]*w+R[6]*y+R[7]*b+R[8]*A+R[9],a=R[10]*w+R[11]*y+R[12]*b+R[13]*A+R[14],s=R[15]*w+R[16]*y+R[17]*b+R[18]*A+R[19],r=0>r?0:r>255?255:r,i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s}return e})}(FILTER),!function(e,t){"use strict";var n=e.ImArrayCopy,r=e.Color.clampPixel,i=function(e){var t=new n(256),r=0;if(e)for(;256>r;)t[r]=255-r,r++;else for(;256>r;)t[r]=r,r++;return t},a=function(e){for(var t=new n(256),r=0;256>r;)t[r]=e,r++;return t},s=function(e){return e?new n(e):null},o=Math.pow,l=Math.exp,u=1/255,c=i(),h=i(1),f=e.TableLookupFilter=e.Class(e.Filter,{name:"TableLookupFilter",constructor:function(e,t,n,r){var i=this;i.$super("constructor"),i._tableR=e||null,i._tableG=t||i._tableR,i._tableB=n||i._tableG,i._tableA=r||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var e=this;return e.$super("dispose"),e._tableR=null,e._tableG=null,e._tableB=null,e._tableA=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_tableR:e._tableR,_tableG:e._tableG,_tableB:e._tableB,_tableA:e._tableA}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._tableR=t._tableR,n._tableG=t._tableG,n._tableB=t._tableB,n._tableA=t._tableA),n},thresholds:function(e,t,i){e.length||(e=[e]),t||(t=e),i||(i=t);var a,s,o=e.length,l=o+1,u=t.length,c=u+1,h=i.length,f=h+1,d=new n(256),m=new n(l),p=new n(256),_=new n(c),g=new n(256),v=new n(f),w=255/(l-1),y=255/(c-1),b=255/(f-1);for(a=0;l>a;)m[a]=~~(w*a),a++;for(e[0]=~~(255*e[0]),a=1;o>a;)e[a]=e[a-1]+~~(255*e[a]),a++;for(a=0;c>a;)_[a]=~~(y*a),a++;for(t[0]=~~(255*t[0]),a=1;u>a;)t[a]=t[a-1]+~~(255*t[a]),a++;for(a=0;f>a;)v[a]=~~(b*a),a++;for(i[0]=~~(255*i[0]),a=1;h>a;)i[a]=i[a-1]+~~(255*i[a]),a++;for(a=0;256>a;){for(s=0;o>s&&a>e[s];)s++;for(d[a]=r(m[s]),s=0;u>s&&a>t[s];)s++;for(p[a]=r(_[s]),s=0;h>s&&a>i[s];)s++;g[a]=r(v[s]),a++}return this.set(d,p,g)},threshold:function(e,t,n){return e=e||.5,t=t||e,n=n||t,this.thresholds([e],[t],[n])},quantize:function(e){e===t&&(e=64),2>e&&(e=2);var i,a=new n(256),s=new n(e),o=255/(e-1),l=e/256;for(i=0;e>i;)s[i]=~~(o*i),i++;for(i=0;256>i;)a[i]=r(s[~~(l*i)]),i++;return this.set(a)},binarize:function(){return this.quantize(2)},solarize:function(e){e===t&&(e=.5);var i,a,s=0,o=new n(256),l=2/255;for(s=0;256>s;)i=l*s,a=i>e?255-255*i:255*i-255,o[s]=~~r(a),s++;return this.set(o)},solarize2:function(e){e===t&&(e=.5),e=1-e;var i,a,s=0,o=new n(256),l=2/255;for(s=0;256>s;)i=l*s,a=e>i?255-255*i:255*i-255,o[s]=~~r(a),s++;return this.set(o)},solarizeInverse:function(e){e===t&&(e=.5),e*=256;var r=0,i=new n(256);for(r=0;256>r;)i[r]=r>e?255-r:r,r++;return this.set(i)},invert:function(){return this.set(h)},mask:function(e){var t=0,i=e>>16&255,a=e>>8&255,s=255&e;for(tR=new n(256),tG=new n(256),tB=new n(256),t=0;256>t;)tR[t]=r(t&i),tG[t]=r(t&a),tB[t]=r(t&s),t++;return this.set(tR,tG,tB)},replace:function(e,t){if(e==t)return this;var n=e>>16&255,r=e>>8&255,i=255&e,a=t>>16&255,o=t>>8&255,l=255&t,u=s(c),h=s(c),f=s(c);return u[n]=a,h[r]=o,f[i]=l,this.set(u,h,f)},extract:function(t,n,i){if(!n||!n.length)return this;i=i||0;var s,o,l=i>>16&255,u=i>>8&255,c=255&i,h=a(l),f=a(u),d=a(c);switch(t){case e.CHANNEL.BLUE:for(s=n[0],o=n[1];o>=s;)d[s]=r(s),s++;break;case e.CHANNEL.GREEN:for(s=n[0],o=n[1];o>=s;)f[s]=r(s),s++;break;case e.CHANNEL.RED:default:for(s=n[0],o=n[1];o>=s;)h[s]=r(s),s++}return this.set(h,f,d)},gammaCorrection:function(e,t,i){e=e||1,t=t||e,i=i||t,e=1/e,t=1/t,i=1/i;for(var a=new n(256),s=new n(256),l=new n(256),c=0;256>c;)a[c]=r(~~(255*o(u*c,e))),s[c]=r(~~(255*o(u*c,t))),l[c]=r(~~(255*o(u*c,i))),c++;return this.set(a,s,l)},exposure:function(e){e===t&&(e=1);var i=0,a=new n(256);for(i=0;256>i;)a[i]=r(~~(255*(1-l(-e*i*u)))),i++;return this.set(a)},set:function(e,t,n){if(!e)return this;t=t||e,n=n||t;var a,o,l,u,c,h=this._tableR||i(),f=s(h);if(t&&n){for(a=this._tableG||s(h),o=this._tableB||s(a),l=s(a),u=s(o),c=0;256>c;)h[c]=r(e[r(f[c])]),a[c]=r(t[r(l[c])]),o[c]=r(n[r(u[c])]),c++;this._tableR=h,this._tableG=a,this._tableB=o}else{for(c=0;256>c;)h[c]=r(e[r(f[c])]),c++;this._tableR=h,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(e){return this.set(e.getTable(0),e.getTable(1),e.getTable(2))},getTable:function(t){switch(t=t||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA;case e.CHANNEL.BLUE:return this._tableB;case e.CHANNEL.GREEN:return this._tableG;case e.CHANNEL.RED:default:return this._tableR}},setTable:function(t,n){switch(n=n||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA=t,this;case e.CHANNEL.BLUE:return this._tableB=t,this;case e.CHANNEL.GREEN:return this._tableG=t,this;case e.CHANNEL.RED:default:return this._tableR=t,this}},_apply:function(e){var t=this;if(!t._isOn||!t._tableR)return e;var n,r,i,a,s,o=e.length,l=(o>>2)%4,u=t._tableR,c=t._tableG,h=t._tableB,f=t._tableA;if(f){for(n=0;o>n;n+=16)r=e[n],i=e[n+1],a=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],e[n+3]=f[s],r=e[n+4],i=e[n+5],a=e[n+6],s=e[n+7],e[n+4]=u[r],e[n+5]=c[i],e[n+6]=h[a],e[n+7]=f[s],r=e[n+8],i=e[n+9],a=e[n+10],s=e[n+11],e[n+8]=u[r],e[n+9]=c[i],e[n+10]=h[a],e[n+11]=f[s],r=e[n+12],i=e[n+13],a=e[n+14],s=e[n+15],e[n+12]=u[r],e[n+13]=c[i],e[n+14]=h[a],e[n+15]=f[s];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],i=e[n+1],a=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],e[n+3]=f[s]}else{for(n=0;o>n;n+=16)r=e[n],i=e[n+1],a=e[n+2],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],r=e[n+4],i=e[n+5],a=e[n+6],e[n+4]=u[r],e[n+5]=c[i],e[n+6]=h[a],r=e[n+8],i=e[n+9],a=e[n+10],e[n+8]=u[r],e[n+9]=c[i],e[n+10]=h[a],r=e[n+12],i=e[n+13],a=e[n+14],e[n+12]=u[r],e[n+13]=c[i],e[n+14]=h[a];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],i=e[n+1],a=e[n+2],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a]}return e},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(e){"use strict";{var t=(e.ImArray,e.ImArrayCopy),n=e.Array16I,r=Math.min,i=(Math.max,Math.floor);e.DisplacementMapFilter=e.Class(e.Filter,{name:"DisplacementMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.setMap(e)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:e.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e.map=null,e.scaleX=null,e.scaleY=null,e.startX=null,e.startY=null,e.componentX=null,e.componentY=null,e.color=null,e.red=null,e.green=null,e.blue=null,e.alpha=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_map:e._map,scaleX:e.scaleX,scaleY:e.scaleY,startX:e.startX,startY:e.startY,componentX:e.componentX,componentY:e.componentY,color:e.color,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,mode:e.mode}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n.map=null,n._map=t._map,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n.mode=t.mode),n},reset:function(){var e=this;return e._map=null,e.map=null,e},getMap:function(){return this.map},setMap:function(e){var t=this;return e&&(t.map=e,t._map={data:e.getData(),width:e.width,height:e.height}),t},setColor:function(e){var t=this;return t.color=e,t.alpha=e>>24&255,t.red=e>>16&255,t.green=e>>8&255,t.blue=255&e,t},_apply:function(a,s,o){var l=this;if(!l._isOn||!l._map)return a;var u,c,h,f,d,m,p,_,g,v,w,y,b,A,C,R,E,I,M,L,x,N,O,S,F,T,k,D,P,G,H,U=.00390625*l.scaleX,X=.00390625*l.scaleY,Y=l.componentX,B=l.componentY,W=l.alpha,z=l.red,q=l.green,$=l.blue,j=l.mode,K=e.MODE.IGNORE,J=(e.MODE.CLAMP,e.MODE.COLOR),Q=e.MODE.WRAP;for(u=l._map.data,c=l._map.width,h=l._map.height,f=u.length>>2,m=r(c,s),p=r(h,o),D=a.length,T=m*p<<2,k=D>>2,g=i(l.startX*(s-1)),_=i(l.startY*(o-1)),v=_*s,w=-g,y=-_,b=s-g-1,A=o-_-1,d=new n(f<<1),P=new t(a),R=0,E=0,I=0,M=0,C=0;f>C;C++,R+=2,E++)E>=c&&(E=0,I++,M+=c),O=E+M<<2,d[R]=i((u[O+Y]-128)*U),d[R+1]=i((u[O+B]-128)*X);for(E=0,I=0,M=0,L=0,C=0;T>C;C+=4,E++)if(E>=m&&(E=0,I++,M+=s,L+=c),!(y>I||I>A||w>E||E>b)){if(N=E+g,x=I+_,S=N+M+v<<2,R=E+L<<1,G=N+d[R],H=x+d[R+1],H>=o||0>H||G>=s||0>G){if(j==K)continue;if(j==J){a[S]=z,a[S+1]=q,a[S+2]=$,a[S+3]=W;continue}j==Q?(H>A?H-=o:0>H&&(H+=o),G>b?G-=s:0>G&&(G+=s)):(H>A?H=A:0>H&&(H=0),G>b?G=b:0>G&&(G=0))}F=G+H*s<<2,a[S]=P[F],a[S+1]=P[F+1],a[S+2]=P[F+2],a[S+3]=P[F+3]}return a},canRun:function(){return this._isOn&&(this._map||this.map)}})}}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.generic(e)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e._mapName=null,e.inverseTransform=null,e.matrix=null,e.centerX=null,e.centerY=null,e.dx=null,e.dy=null,e.angle=null,e.radius=null,e.wavelength=null,e.amplitude=null,e.phase=null,e.xAmplitude=null,e.yAmplitude=null,e.xWavelength=null,e.yWavelength=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_mapName:e._mapName,inverseTransform:e.inverseTransform?e.inverseTransform.toString():null,matrix:e.matrix,centerX:e.centerX,centerY:e.centerY,dx:e.dx,dy:e.dy,angle:e.angle,radius:e.radius,wavelength:e.wavelength,amplitude:e.amplitude,phase:e.phase,xAmplitude:e.xAmplitude,yAmplitude:e.yAmplitude,xWavelength:e.xWavelength,yWavelength:e.yWavelength,mode:e.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.dx=params.dx,self.dy=params.dy,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(e){var t=this;return e&&(t.inverseTransform=e,t._mapName="generic",t._map=Maps.generic),t},affine:function(e){var t=this;return e&&(t.matrix=e,t._mapName="affine",t._map=Maps.affine),t},flipX:function(){var e=this;return e._mapName="flipX",e._map=Maps.flipX,e},flipY:function(){var e=this;return e._mapName="flipY",e._map=Maps.flipY,e},flipXY:function(){var e=this;return e._mapName="flipXY",e._map=Maps.flipXY,e},rotateCW:function(){var e=this;return e._mapName="rotateCW",e._map=Maps.rotateCW,e},rotateCCW:function(){var e=this;return e._mapName="rotateCCW",e._map=Maps.rotateCCW,e},polar:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="polar",n._map=Maps.polar,n},cartesian:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="cartesian",n._map=Maps.cartesian,n},twirl:function(e,t,n,r){var i=this;return i.angle=e||0,i.radius=t||0,i.centerX=n||0,i.centerY=r||0,i._mapName="twirl",i._map=Maps.twirl,i},sphere:function(e,t,n){var r=this;return r.radius=e||0,r.centerX=t||0,r.centerY=n||0,r._mapName="sphere",r._map=Maps.sphere,r},ripple:function(e,t,n,r,i,a){var s=this;return s.radius=e!==undef?e:50,s.centerX=i||0,s.centerY=a||0,s.wavelength=t!==undef?t:16,s.amplitude=n!==undef?n:10,s.phase=r||0,s._mapName="ripple",s._map=Maps.ripple,s},shift:function(e,t){var n=this;return n.dx=e!==undef?e:0,n.dy=t!==undef?t:n.dx,n._mapName="shift",n._map=Maps.shift,n},reset:function(){var e=this;return e._mapName=null,e._map=null,e},getMap:function(){return this._map},setMap:function(e){var t=this;return t._mapName=null,t._map=e,t},_apply:function(e,t,n,r){var i=this;return i._isOn&&i._map?i._map(i,e,t,n,r):e},canRun:function(){return this._isOn&&this._map}});GeometricMapFilter.prototype.translate=GeometricMapFilter.prototype.shift,Maps={generic:function(e,t,n,r){var i,a,s,o,l,u,c,h=t.length,f=new IMG(h),d=e.inverseTransform,m=e.mode,p=FILTER.MODE.CLAMP,_=FILTER.MODE.WRAP;for(i=0,a=0,s=0;h>s;s+=4,i++){if(i>=n&&(i=0,a++),l=d([i,a],n,r),u=~~l[0],c=~~l[1],0>u||u>=n||0>c||c>=r)switch(m){case _:c>=r?c-=r:0>c&&(c+=r),u>=n?u-=n:0>u&&(u+=n);break;case p:default:c>=r?c=r-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}o=u+c*n<<2,f[s]=t[o],f[s+1]=t[o+1],f[s+2]=t[o+2],f[s+3]=t[o+3]}return f},affine:function(e,t,n){var r,i,a,s,o,l,u,c,h,f=t.length,d=f>>2,m=new IMG(f),p=e.matrix,_=p[0],g=p[1],v=p[3],w=p[4],y=p[2],b=p[5],A=e.mode,C=FILTER.MODE.CLAMP,R=FILTER.MODE.WRAP,E=n-1,I=d-n;for(r=0,i=0,o=b*n,l=v*n,u=w*n,a=0;f>a;a+=4,r++){if(r>=n&&(r=0,i++),c=~~(_*r+g*i+y),h=~~(l*r+u*i+o),0>c||c>E||0>h||h>I)switch(A){case R:h>I?h-=d:0>h&&(h+=d),c>=n?c-=n:0>c&&(c+=n);break;case C:default:h>I?h=I:0>h&&(h=0),c>E?c=E:0>c&&(c=0)}s=c+h<<2,m[a]=t[s],m[a+1]=t[s+1],m[a+2]=t[s+2],m[a+3]=t[s+3]}return m},shift:function(e,t,n,r){var i,a,s,o,l,u=t.length,c=new IMG(u),h=-e.dx,f=-e.dy;for(0>h&&(h+=n),0>f&&(f+=r),i=0,a=0,s=0,o=0;u>o;o+=4,i++)i>=n&&(i=0,a++,s+=n),l=(i+h)%n+(a+f)%r*n<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipX:function(e,t,n){var r,i,a,s,o,l=t.length,u=new IMG(l);for(r=0,i=0,a=0,s=0;l>s;s+=4,r++)r>=n&&(r=0,i++,a+=n),o=n-1-r+a<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},flipY:function(e,t,n,r){var i,a,s,o,l,u=t.length,c=new IMG(u);for(i=0,a=0,s=(r-1)*n,o=0;u>o;o+=4,i++)i>=n&&(i=0,a++,s-=n),l=i+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipXY:function(e,t,n,r){var i,a,s,o,l,u,c=t.length,h=new IMG(c);for(i=0,a=0,o=(r-1)*n,l=0;c>l;l+=4,i++)i>=n&&(i=0,a++,s+=n,o-=n),u=n-1-i+o<<2,h[l]=t[u],h[l+1]=t[u+1],h[l+2]=t[u+2],h[l+3]=t[u+3];return h},rotateCW:function(e,t,n){var r,i,a,s,o,l=t.length,u=new IMG(l),c=l>>2;for(r=0,i=0,a=c-1,s=0;l>s;s+=4,r++,a-=n)r>=n&&(r=0,a=c-1,i++),o=i+a<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},rotateCCW:function(e,t,n){var r,i,a,s,o,l=t.length,u=new IMG(l);for(r=0,i=0,a=0,s=0;l>s;s+=4,r++,a+=n)r>=n&&(r=0,a=0,i++),o=n-1-i+a<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},twirl:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,o,l,u,c,h,f=t.length,d=new IMGcopy(t),m=e.centerX,p=e.centerY,_=e.angle,g=e.radius,v=e.mode,w=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,b=_/g,A=n-1,C=r-1;for(m=Floor(m*(n-1)),p=Floor(p*(r-1)),i=0,a=0,s=0;f>s;s+=4,i++)if(i>=n&&(i=0,a++),u=i-m,c=a-p,l=Sqrt(u*u+c*c),g>l){if(h=Atan2(c,u)+b*(g-l),u=~~(m+l*Cos(h)),c=~~(p+l*Sin(h)),0>u||u>A||0>c||c>C)switch(v){case y:c>C?c-=r:0>c&&(c+=r),u>A?u-=n:0>u&&(u+=n);break;case w:default:c>C?c=C:0>c&&(c=0),u>A?u=A:0>u&&(u=0)}o=u+c*n<<2,t[s]=d[o],t[s+1]=d[o+1],t[s+2]=d[o+2],t[s+3]=d[o+3]}return t},sphere:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,o,l,u,c,h,f,d,m,p,_,g=t.length,v=new IMGcopy(t),w=e.centerX,y=e.centerY,b=e.radius,A=e.mode,C=FILTER.MODE.CLAMP,R=FILTER.MODE.WRAP,E=b*b,I=.555556,M=1-I,L=n-1,x=r-1;
for(w=Floor(w*(n-1)),y=Floor(y*(r-1)),i=0,a=0,s=0;g>s;s+=4,i++)if(i>=n&&(i=0,a++),l=i-w,u=a-y,p=l*l,_=u*u,c=p+_,E>c){if(d=E-c,m=Sqrt(d),h=Asin(l/Sqrt(p+d))*M,f=Asin(u/Sqrt(_+d))*M,l=~~(i-m*Tan(h)),u=~~(a-m*Tan(f)),0>l||l>L||0>u||u>x)switch(A){case R:u>x?u-=r:0>u&&(u+=r),l>L?l-=n:0>l&&(l+=n);break;case C:default:u>x?u=x:0>u&&(u=0),l>L?l=L:0>l&&(l=0)}o=l+u*n<<2,t[s]=v[o],t[s+1]=v[o+1],t[s+2]=v[o+2],t[s+3]=v[o+3]}return t},ripple:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,o,l,u,c,h,f,d,m,p=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,w=n-1,y=r-1,b=e.centerX,A=e.centerY,C=e.radius,R=e.mode,E=C*C,I=e.wavelength,M=e.amplitude,L=e.phase;for(b=Floor(b*(n-1)),A=Floor(A*(r-1)),i=0,a=0,s=0;p>s;s+=4,i++)if(i>=n&&(i=0,a++),u=i-b,c=a-A,d=u*u,m=c*c,f=d+m,E>f){if(l=Sqrt(f),h=M*Sin(l/I*Math.PI*2-L),h*=(C-l)/C,l&&(h*=I/l),u=~~(i+u*h),c=~~(a+c*h),0>u||u>w||0>c||c>y)switch(R){case v:c>y?c-=r:0>c&&(c+=r),u>w?u-=n:0>u&&(u+=n);break;case g:default:c>y?c=y:0>c&&(c=0),u>w?u=w:0>u&&(u=0)}o=u+c*n<<2,t[s]=_[o],t[s+1]=_[o+1],t[s+2]=_[o+2],t[s+3]=_[o+3]}return t},polar:function(e,t,n,r){var i,a,s,o,l,u,c,h,f,d,m,p,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,y=n-1,b=r-1,A=0,C=e.mode;for(m=~~(.5*n+.5),p=~~(.5*r+.5),d=Max(p,m),i=0,a=0,s=0;_>s;s+=4,i++){if(i>=n&&(i=0,a++),o=i-m,l=a-p,f=0,o>=0?l>0?(f=PI-Atan(o/l),A=Sqrt(o*o+l*l)):0>l?(f=Atan(o/l),A=Sqrt(o*o+l*l)):(f=HalfPI,A=o):0>o&&(0>l?(f=DoublePI-Atan(o/l),A=Sqrt(o*o+l*l)):l>0?(f=PI+Atan(o/l),A=Sqrt(o*o+l*l)):(f=ThreePI2,A=-o)),u=n-1-(n-1)/DoublePI*f,c=r*A/d,0>u||u>y||0>c||c>b)switch(C){case w:c>b?c-=r:0>c&&(c+=r),u>y?u-=n:0>u&&(u+=n);break;case v:default:c>b?c=b:0>c&&(c=0),u>y?u=y:0>u&&(u=0)}h=~~(u+.5)+~~(c+.5)*n<<2,t[s]=g[h],t[s+1]=g[h+1],t[s+2]=g[h+2],t[s+3]=g[h+3]}return t},cartesian:function(e,t,n,r){var i,a,s,o,l,u,c,h,f,d,m,p,_,g=t.length,v=new IMGcopy(t),w=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,b=n-1,A=r-1,C=0,R=e.mode;for(p=~~(.5*n+.5),_=~~(.5*r+.5),m=Max(_,p),i=0,a=0,s=0;g>s;s+=4,i++){if(i>=n&&(i=0,a++),f=i/n*DoublePI,d=f>=ThreePI2?DoublePI-f:f>=PI?f-PI:f>=HalfPI?PI-f:f,C=m*(a/r),c=-C*Sin(d),h=C*Cos(d),f>=ThreePI2?(o=p-c,l=_-h):f>=PI?(o=p-c,l=_+h):f>=HalfPI?(o=p+c,l=_+h):(o=p+c,l=_-h),0>o||o>b||0>l||l>A)switch(R){case y:l>A?l-=r:0>l&&(l+=r),o>b?o-=n:0>o&&(o+=n);break;case w:default:l>A?l=A:0>l&&(l=0),o>b?o=b:0>o&&(o=0)}u=~~(o+.5)+~~(l+.5)*n<<2,t[s]=v[u],t[s+1]=v[u+1],t[s+2]=v[u+2],t[s+3]=v[u+3]}return t}}}(FILTER),!function(e,t){"use strict";function n(e,t,n,r){var i,a=e.length,s=new y(e.length);for(n=n||1,r=r||1,i=0;a>i;)s[i]=n*e[i]+r*t[i],i++;return s}function r(e,t){var n,r,i,a=e.length,s=[],o=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=e[n]*t[r],o+=i,s.push(i);return{kernel:s,sum:o}}function i(e){var t,n=new Array(e);for(t=0;e>t;)n[t]=1,t++;return n}function a(e){var t,n,r,i,a=E.length;if(e--,a>e)t=new y(E[e]);else for(t=new y(E[a-1]);e>=a;){for(n=t,t=new y(n.length+1),t[0]=1,r=0,i=n.length-1;i>r;r++)t[r+1]=n[r]+n[r+1];t[n.length]=1,40>a&&E.push(new Array(t)),a++}return t}function s(e){var t,n=e>>1,r=-n,i=new Array(e);for(t=0;e>t;)i[t]=r,r++,t++;return i}function o(e){var t=a(e);return r(t,t)}function l(e,t){var n=a(e),i=s(e);return 1==t?r(i.reverse(),n):r(n,i)}function u(e,t){var n=i(e),a=s(e);return 1==t?r(a.reverse(),n):r(n,a)}function c(e,t,n){t=t||1,n=n||t;var r,i=e*e,a=i>>1,s=new y(i);for(r=0;i>r;)s[r]=t,r++;return s[a]=n,s}function h(e,t,n,r){var i,a,s,o,l,u=e*e,c=e>>1,h=u>>1,f=new y(u);for(o=0,i=0;c>=i;i++){for(a=0,l=0,s=0;c>=s;s++)f[h+i+a]=o+l,f[h-i-a]=-o-l,f[h-i+a]=-o+l,f[h+i-a]=o-l,a+=e,l+=n;o+=t}return f[h]=r||1,f}function f(e,t,n,r){var i,a,s,o,l,u,c=e*e,h=e>>1,f=c>>1,d=new y(c),m=new y(c),p=1/e,g=1e-8;for(_(t)>g?(l=1,u=n/t):(l=t/n,u=1),i=0,s=0,o=0,a=u*e;h>=i;)m[f+i]=~~(f+s+o+.5),m[f-i]=~~(f-s-o+.5),i++,s+=l,o+=a;for(i=0;h>=i;)d[m[f+i]]=d[m[f-i]]=p,i++;return d[f]=r||1,d}function d(e,t,n,r,i,a,s,o,l,u){var c,h,f,d,m,p,_,g,v,w,y,C,E,I,M,L,x,N,O,S,F,T,k,D,P,G,H,U,X,Y,B,W,z,q,$,j,K,J,Q,V,Z,et,tt,nt,rt,it,at,st=e.length,ot=st>>2,lt=a,ut=s;if(g=lt*ut,p=lt>>1,_=t*(ut>>1),y=-p-1,E=-_-t,C=p,I=_,Y=0,W=t-1,B=0,z=ot-t,h=(ot<<1)+ot,w=(t<<1)+t,u=u||1,at=0,i)for(S=r[0],F=r[g>>1],T=F-S,k=i[0],D=i[g>>1],P=D-k;u>at;){for(v=new b(st),c=new A(h),M=0,L=0,f=d=m=0,x=0;t>x;x++,M+=4,L+=3)f+=e[M],d+=e[M+1],m+=e[M+2],c[L]=f,c[L+1]=d,c[L+2]=m;for(L=0,x=0,f=d=m=0,M=w+t;st>M;M+=4,L+=3,x++)x>=t&&(x=0,f=d=m=0),f+=e[M],d+=e[M+1],m+=e[M+2],c[L+w]=c[L]+f,c[L+w+1]=c[L+1]+d,c[L+w+2]=c[L+2]+m;for(x=0,N=0,O=0,M=0;st>M;M+=4,x++)x>=t&&(x=0,N++,O+=t),G=x+y,H=O+E,U=x+C,X=O+I,G=Y>G?Y:G,U=U>W?W:U,H=B>H?B:H,X=X>z?z:X,q=G+H,K=U+X,$=U+H,j=G+X,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=S*(c[K]-c[$]-c[j]+c[q])+T*e[M],et=S*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+T*e[M+1],tt=S*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+T*e[M+2],nt=k*(c[K]-c[$]-c[j]+c[q])+P*e[M],rt=k*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+P*e[M+1],it=k*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+P*e[M+2],J=o*Z+l*nt,Q=o*et+l*rt,V=o*tt+l*it,R&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[M]=~~J,v[M+1]=~~Q,v[M+2]=~~V,v[M+3]=e[M+3];e=v,at++}else for(S=r[0],F=r[g>>1],T=F-S;u>at;){for(v=new b(st),c=new A(h),M=0,L=0,f=d=m=0,x=0;t>x;x++,M+=4,L+=3)f+=e[M],d+=e[M+1],m+=e[M+2],c[L]=f,c[L+1]=d,c[L+2]=m;for(L=0,x=0,f=d=m=0,M=w+t;st>M;M+=4,L+=3,x++)x>=t&&(x=0,f=d=m=0),f+=e[M],d+=e[M+1],m+=e[M+2],c[L+w]=c[L]+f,c[L+w+1]=c[L+1]+d,c[L+w+2]=c[L+2]+m;for(x=0,N=0,O=0,M=0;st>M;M+=4,x++)x>=t&&(x=0,N++,O+=t),G=x+y,H=O+E,U=x+C,X=O+I,G=Y>G?Y:G,U=U>W?W:U,H=B>H?B:H,X=X>z?z:X,q=G+H,K=U+X,$=U+H,j=G+X,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=S*(c[K]-c[$]-c[j]+c[q])+T*e[M],et=S*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+T*e[M+1],tt=S*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+T*e[M+2],J=o*Z+l,Q=o*et+l,V=o*tt+l,R&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[M]=~~J,v[M+1]=~~Q,v[M+2]=~~V,v[M+3]=e[M+3];e=v,at++}return v}function m(e,t,n,r,i,a,s,o,l){var u,c,h,f,d,m,p,_,g,v,w,y,A,E,I,M,L,x,N,O,S,F,T,k,D,P,G,H=e.length,U=H>>2;for(u=[i,r],c=[s,a],D=[l,o],M=t-1,L=U-t,G=2;G--;){for(p=new b(H),f=u[G],d=c[G],h=f.length,m=d.length,P=D[G],_=new C(d),w=0;m>w;w+=2)_[w+1]*=t;if(R)for(y=0,A=0,g=0;H>g;g+=4,y++){for(y>=t&&(y=0,A+=t),F=0,T=0,k=0,w=0,v=0;h>w;w++,v+=2)E=y+_[v],I=A+_[v+1],E>=0&&M>=E&&I>=0&&L>=I&&(srcOff=E+I<<2,S=f[w],F+=e[srcOff]*S,T+=e[srcOff+1]*S,k+=e[srcOff+2]*S);x=P*F,N=P*T,O=P*k,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,O=0>O?0:O>255?255:O,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~O,p[g+3]=e[g+3]}else for(y=0,A=0,g=0;H>g;g+=4,y++){for(y>=t&&(y=0,A+=t),F=0,T=0,k=0,w=0,v=0;h>w;w++,v+=2)E=y+_[v],I=A+_[v+1],E>=0&&M>=E&&I>=0&&L>=I&&(srcOff=E+I<<2,S=f[w],F+=e[srcOff]*S,T+=e[srcOff+1]*S,k+=e[srcOff+2]*S);x=P*F,N=P*T,O=P*k,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~O,p[g+3]=e[g+3]}e=p}return p}var p=(e.CONSTANTS.SQRT2,e.CONSTANTS.toRad),_=(e.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,w=Math.cos,y=e.Array32F,b=e.ImArray,A=e.Array32F,C=e.Array16I,R=(e.Array8U,e._notSupportClamp),E=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],I=e.ConvolutionMatrixFilter=e.Class(e.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,n,r){var i=this;i.$super("constructor"),i._coeff=new y([1,0]),t&&t.length?i.set(t,~~(g(t.length)+.5),n||1,r||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,e.useWebGL&&(i._webglInstance=e.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._dim=null,e._dim2=null,e._matrix=null,e._matrix2=null,e._mat=null,e._mat2=null,e._coeff=null,e._isGrad=null,e._doIntegral=null,e._doSeparable=null,e._indices=null,e._indices2=null,e._indicesf=null,e._indicesf2=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_dim:e._dim,_dim2:e._dim2,_matrix:e._matrix,_matrix2:e._matrix2,_mat:e._mat,_mat2:e._mat2,_coeff:e._coeff,_isGrad:e._isGrad,_doIntegral:e._doIntegral,_doSeparable:e._doSeparable,_indices:e._indices,_indices2:e._indices2,_indicesf:e._indicesf,_indicesf2:e._indicesf2}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._dim=t._dim,n._dim2=t._dim2,n._matrix=t._matrix,n._matrix2=t._matrix2,n._mat=t._mat,n._mat2=t._mat2,n._coeff=t._coeff,n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=t._indices,n._indices2=t._indices2,n._indicesf=t._indicesf,n._indicesf2=t._indicesf2),n},lowPass:function(e){return e=e===t?3:e%2?e:e+1,this.set(c(e),e,1/(e*e),0),this._doIntegral=1,this},highPass:function(e,n){e=e===t?3:e%2?e:e+1,n=n===t?1:n;var r=e*e,i=-n/r,a=c(e,i,1+i);return this.set(a,e,1,0),this._doIntegral=1,this},glow:function(e,n){return e=e===t?.5:e,this.highPass(n,-e)},sharpen:function(e,n){return e=e===t?.5:e,this.highPass(n,e)},verticalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(i(e),1,1/e,0),this._dim2=e,this._doIntegral=1,this},horizontalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(i(e),e,1/e,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(e,n){n=n===t?3:n%2?n:n+1,e*=p;var r=w(e),i=-v(e),a=f(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(e,n){return n=n===t?3:n%2?n:n+1,e=~~(e||1),1>e?e=1:e>3&&(e=3),this.set(c(n),n,1/(n*n),0),this._doIntegral=e,this},binomialLowPass:function(e){e=e===t?3:e%2?e:e+1;var n=a(e),r=1<<e-1,i=1/r;this.set(n,e,i,i),this._matrix2=new y(n);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(e){e=e===t?3:e%2?e:e+1;var r=o(e);return this.set(n(c(e),new y(r.kernel),1,-1/r.sum),e,1,0)},prewittX:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0);return this.set(n.kernel,e,1,0)},prewittY:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,1);return this.set(n.kernel,e,1,0)},prewittDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var i=w(e),a=v(e),s=u(r,0),o=u(r,1);return this.set(n(new y(s.kernel),new y(o.kernel),i,a),r,1,0)},prewitt:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0),r=u(e,1);this.set(n.kernel,e,1,0),this._isGrad=!0,this._matrix2=new y(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0);return this.set(n.kernel,e,1,0)},sobelY:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,1);return this.set(n.kernel,e,1,0)},sobelDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var i=w(e),a=v(e),s=l(r,0),o=l(r,1);return this.set(n(new y(s.kernel),new y(o.kernel),i,a),r,1,0)},sobel:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0),r=l(e,1);this.set(n.kernel,e,1,0),this._matrix2=new y(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(e){e=e===t?3:e%2?e:e+1;var n=e*e,r=c(e,-1,n-1);return this.set(r,e,1,0),this._doIntegral=1,this},emboss:function(e,n,r){r=r===t?3:r%2?r:r+1,e=e===t?-.25*Math.PI:e*p,n=n||1;var i=n*w(e),a=-n*v(e),s=h(r,i,a,1);return this.set(s,r,1,0)},edges:function(e){return e=e||1,this.set([0,e,0,e,-4*e,e,0,e,0],3,1,0)},set:function(e,t,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new y(e),i._dim=t,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(e,t){var n,r,i,a=[],s=[],o=[],l=e.length,u=t,c=u>>1;for(r=0,i=0,n=0;l>n;)s.push(r-c),s.push(i-c),e[n]&&(a.push(r-c),a.push(i-c),o.push(e[n])),n++,r++,r>=u&&(r=0,i++);return[new C(a),new C(s),new y(o)]},reset:function(){var e=this;return e._matrix=e._matrix2=null,e._mat=e._mat2=null,e._dim=e._dim2=0,e._indices=e._indices2=e._indicesf=e._indicesf2=null,e._isGrad=!1,e._doIntegral=0,e._doSeparable=!1,e},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(e,t){return this.set(e,t)},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._matrix)return e;if(r._doIntegral)return r._matrix2?d(e,t,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):d(e,t,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return m(e,t,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var i,a,s,o,l,u,c,h,f,p,g,v,w,y,A,E,I,M,L,x,N,O,S=e.length,F=S>>2,T=new b(S),k=t-1,D=F-t,P=r._coeff[0],G=r._coeff[1],H=r._matrix,U=r._matrix2,X=r._isGrad;if(U){for(x=r._indicesf.length,O=new C(r._indicesf),u=0;x>u;u+=2)O[u+1]*=t;for(N=H.length,c=0,h=0,o=0;S>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,w=0,y=0,A=0,E=0,I=0,u=0,l=0;N>u;u++,l+=2)f=c+O[l],p=h+O[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,M=H[u],v+=e[g]*M,w+=e[g+1]*M,y+=e[g+2]*M,L=U[u],A+=e[g]*L,E+=e[g+1]*L,I+=e[g+2]*L);X?(i=_(v)+_(A),a=_(w)+_(E),s=_(y)+_(I)):(i=P*v+G*A,a=P*w+G*E,s=P*y+G*I),R&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),T[o]=~~i,T[o+1]=~~a,T[o+2]=~~s,T[o+3]=e[o+3]}}else{for(x=r._indices.length,O=new C(r._indices),u=0;x>u;u+=2)O[u+1]*=t;for(H=r._mat,N=H.length,c=0,h=0,o=0;S>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,w=0,y=0,u=0,l=0;N>u;u++,l+=2)f=c+O[l],p=h+O[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,M=H[u],v+=e[g]*M,w+=e[g+1]*M,y+=e[g+2]*M);i=P*v+G,a=P*w+G,s=P*y+G,R&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),T[o]=~~i,T[o+1]=~~a,T[o+2]=~~s,T[o+3]=e[o+3]}}return T},canRun:function(){return this._isOn&&this._matrix}});I.prototype.bump=I.prototype.emboss,I.prototype.boxBlur=I.prototype.lowPass,I.prototype.gaussBlur=I.prototype.binomialLowPass,I.prototype.gradX=I.prototype.prewittX,I.prototype.gradY=I.prototype.prewittY,I.prototype.gradDirectional=I.prototype.prewittDirectional,I.prototype.grad=I.prototype.prewitt}(FILTER),!function(e){"use strict";{var t,n=e.ImArray,r=e.Array8U,i=e.Array32I,a=Math.sqrt,s=function(e){var t,n=e*e,i=new r(n);for(t=0;n>t;t++)i[t]=1;return i},o=s(3);e.MorphologicalFilter=e.Class(e.Filter,{name:"MorphologicalFilter",constructor:function(){var e=this;e.$super("constructor"),e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var e=this;return e.$super("dispose"),e._filterName=null,e._filter=null,e._dim=null,e._structureElement=null,e._indices=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_structureElement:e._structureElement,_indices:e._indices}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._dim=n._dim,r._structureElement=n._structureElement,r._indices=n._indices,r._filterName=n._filterName,r._filterName&&t[r._filterName]&&(r._filter=t[r._filterName])),r},erode:function(e){return this.set(e,"erode")},dilate:function(e){return this.set(e,"dilate")},opening:function(e){return this.set(e,"open")},closing:function(e){return this.set(e,"close")},set:function(e,n){var l=this;l._filterName=n,l._filter=t[n],e&&e.length?(l._structureElement=new r(e),l._dim=~~(a(l._structureElement.length)+.5)):e&&e===e-0?(l._structureElement=s(e),l._dim=e):(l._structureElement=o,l._dim=3);var u,c,h,f=[],e=l._structureElement,d=e.length,m=l._dim,p=m>>1;for(c=0,h=0,u=0;d>u;)e[u]&&(f.push(c-p),f.push(h-p)),u++,c++,c>=m&&(c=0,h++);return l._indices=new i(f),l},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim&&this._filter}})}t={dilate:function(e,t,r){var a,s,o,l,u,c,h,f,d,m,p,_,g,v,w=e._structureElement,y=(w.length,e._dim,new i(e._indices)),b=t.length,A=b>>2,C=new n(b),R=y.length,E=R>>1,I=r-1,M=A-r;for(o=0;R>o;o+=2)y[o+1]*=r;for(l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=0,g=0,v=0,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],d>_&&(_=d),m>g&&(g=m),p>v&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}return C},erode:function(e,t,r){var a,s,o,l,u,c,h,f,d,m,p,_,g,v,w=e._structureElement,y=(w.length,e._dim,new i(e._indices)),b=t.length,A=b>>2,C=new n(b),R=y.length,E=R>>1,I=r-1,M=A-r;for(o=0;R>o;o+=2)y[o+1]*=r;for(l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}return C},open:function(e,t,r){var a,s,o,l,u,c,h,f,d,m,p,_,g,v,w=e._structureElement,y=(w.length,e._dim,new i(e._indices)),b=t.length,A=b>>2,C=new n(b),R=y.length,E=R>>1,I=r-1,M=A-r;for(o=0;R>o;o+=2)y[o+1]*=r;for(l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}for(t=C,C=new n(b),l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}return C},close:function(e,t,r){var a,s,o,l,u,c,h,f,d,m,p,_,g,v,w=e._structureElement,y=(w.length,e._dim,new i(e._indices)),b=t.length,A=b>>2,C=new n(b),R=y.length,E=R>>1,I=r-1,M=A-r;for(o=0;R>o;o+=2)y[o+1]*=r;for(l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}for(t=C,C=new n(b),l=0,u=0,a=0;b>a;a+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;E>s;s+=2)c=l+y[s],h=u+y[s+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));C[a]=_,C[a+1]=g,C[a+2]=v,C[a+3]=t[a+3]}return C}}}(FILTER),!function(e,t){"use strict";var n,r=e.ImArray,i=e.Array32I,a=(Math.min,Math.max,e.StatisticalFilter=e.Class(e.Filter,{name:"StatisticalFilter",constructor:function(){var e=this;e.$super("constructor"),e._dim=0,e._indices=null,e._filterName=null,e._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var e=this;return e.$super("dispose"),e._dim=null,e._indices=null,e._filter=null,e._filterName=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},median:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"median")},minimum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"minimum")},maximum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"maximum")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],r._dim=e;var a,s,o,l=[],u=e*e,c=e,h=c>>1;for(s=0,o=0,a=0;u>a;)l.push(s-h),l.push(o-h),a++,s++,s>=c&&(s=0,o++);return r._indices=new i(l),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim}}));a.prototype.erode=a.prototype.minimum,a.prototype.dilate=a.prototype.maximum,n={median:function(e,t,n){var a,s,o,l,u,c,h,f,d,m,p,_,g,v,w,y,b,A,C=e._dim,R=C*C,E=new i(e._indices),I=t.length,M=I>>2,L=new r(I),x=R<<1,N=n-1,O=M-n;for(f=[],d=[],m=[],s=0;x>s;s+=2)E[s+1]*=n;for(a=0,o=0,l=0;I>a;){for(f.length=0,d.length=0,m.length=0,s=0;x>s;)u=o+E[s],c=l+E[s+1],u>=0&&N>=u&&c>=0&&O>=c&&(h=u+c<<2,p=t[h],_=t[h+1],g=t[h+2],f.push(p),d.push(_),m.push(g)),s+=2;f.sort(),d.sort(),m.sort(),b=f.length,A=b>>1,v=b%2?f[A+1]:~~(.5*(f[A]+f[A+1])),b=d.length,A=b>>1,w=b%2?d[A+1]:~~(.5*(d[A]+d[A+1])),b=m.length,A=b>>1,y=b%2?m[A+1]:~~(.5*(m[A]+m[A+1])),L[a]=v,L[a+1]=w,L[a+2]=y,L[a+3]=t[a+3],a+=4,o++,o>=n&&(o=0,l+=n)}return L},maximum:function(e,t,n){var a,s,o,l,u,c,h,f,d,m,p,_,g,v=e._dim,w=v*v,y=new i(e._indices),b=t.length,A=b>>2,C=new r(b),R=w<<1,E=n-1,I=A-n;for(s=0;R>s;s+=2)y[s+1]*=n;for(a=0,o=0,l=0;b>a;){for(p=0,_=0,g=0,s=0;R>s;)u=o+y[s],c=l+y[s+1],u>=0&&E>=u&&c>=0&&I>=c&&(h=u+c<<2,f=t[h],d=t[h+1],m=t[h+2],f>p&&(p=f),d>_&&(_=d),m>g&&(g=m)),s+=2;C[a]=p,C[a+1]=_,C[a+2]=g,C[a+3]=t[a+3],a+=4,o++,o>=n&&(o=0,l+=n)}return C},minimum:function(e,t,n){var a,s,o,l,u,c,h,f,d,m,p,_,g,v=e._dim,w=v*v,y=new i(e._indices),b=t.length,A=b>>2,C=new r(b),R=w<<1,E=n-1,I=A-n;for(s=0;R>s;s+=2)y[s+1]*=n;for(a=0,o=0,l=0;b>a;){for(p=255,_=255,g=255,s=0;R>s;)u=o+y[s],c=l+y[s+1],u>=0&&E>=u&&c>=0&&I>=c&&(h=u+c<<2,f=t[h],d=t[h+1],m=t[h+2],p>f&&(p=f),_>d&&(_=d),g>m&&(g=m)),s+=2;C[a]=p,C[a+1]=_,C[a+2]=g,C[a+3]=t[a+3],a+=4,o++,o>=n&&(o=0,l+=n)}return C}}}(FILTER),exports.FILTER});
/**
*
*   FILTER.js Plugins
*   @version: 0.7-alpha2
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e,n,t){"use strict";function a(r,e,n,t,a){var i;return r?{file:__filename,path:__dirname}:e?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:n&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:t&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(r,e,n,t,a){var i,o=r.length,s=new Array(o);for(i=0;o>i;i++)s[i]=1===t?n[r[i]]||a(e[i]):2===t?a(r[i]):n[r[i]];return s}function o(r,e,n,t,a,i){var o,s,l,u,h,f,c,d=n.length;if(i){for(o=0;d>o;o++)n[o]in r||importScripts(e+t[o]);return a()}f=document.getElementsByTagName("head")[0],c=document.createElement("a"),s=/^\./,l=0,o=0,u=function(r,n){var t=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){t||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(t=1,a.onload=a.onreadystatechange=null,n(),f.removeChild(a),a=null)},s.test(r)&&(c.href=e+r,r=c.protocol+"//"+c.host+c.pathname+c.search+c.hash),a.src=r,f.appendChild(a)},h=function(){n[o]in r?++o>=d?a():n[o]in r?h():u(t[o],h):++l<30?setTimeout(h,30):(l=0,o++,h())};for(;d>o&&n[o]in r;)o++;d>o?u(t[o],h):a()}n=n||[[],[]];var s,l,u,h="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),f=!h&&"undefined"!=typeof navigator,c=!h&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,p=h&&"object"==typeof module&&module.exports,m=c?self:r,g=a(h,c,d,f),v=[].concat(n[0]),_=[].concat(n[1]),M=v.length,b=/\.js$/i;if(p)module.$deps=module.$deps||{},module.exports=module.$deps[e]=t.apply(r,[{NODE:module}].concat(i(v,_,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)){if(!require.defined(e)){for(u={},l=0;M>l;l++)require.specified(v[l])||(u[v[l]]=_[l].replace(b,""));require.config({paths:u}),define(e,["require","exports","module"].concat(v),function(e,n,a){return t.apply(r,[{AMD:a}].concat(i(v,_,arguments,2,e)))})}}else e in m||o(m,g.path+"/",v,_,function(){m[e]=s=t.apply(r,[{}].concat(i(v,_,m)))||1,d&&define(e,["require"],function(){return s})},c)}(this,"FILTER_PLUGINS",[["FILTER"],["./filter.js"]],function(r,e){return r.FILTER_PLUGINS=e,!function(e){"use strict";var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var n=this;n.min=r||-127,n.max=e||127},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.min=e.min,n.max=e.max),n},apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u,h,f,c=e.max-e.min,d=e.min,p=r.length;if(n)for(a=0;p>a;a+=4)o=r[a],s=r[a+1],l=r[a+2],i=c*t()+d,u=o+i,h=s+i,f=l+i,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),r[a]=~~u,r[a+1]=~~h,r[a+2]=~~f;else for(a=0;p>a;a+=4)o=r[a],s=r[a+1],l=r[a+2],i=c*t()+d,u=o+i,h=s+i,f=l+i,r[a]=~~u,r[a+1]=~~h,r[a+2]=~~f;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.Create({name:"HistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var o,s,l,u,h,f,c,d,p,m,g,v=0,_=255,M=0,b=r.length,C=b>>2,y=1/C;for(h=new t(256),p=0;256>p;p+=4)h[p]=0,h[p+1]=0,h[p+2]=0,h[p+3]=0;for(p=0;b>p;p+=4)o=r[p],s=r[p+1],l=r[p+2],m=a({r:o,g:s,b:l}),o=r[p]=~~m.cr,s=r[p+1]=~~m.y,l=r[p+2]=~~m.cb,h[s]+=y,s>v?v=s:_>s&&(_=s);for(M=0,p=0;256>p;p+=4)M+=h[p],h[p]=M,M+=h[p+1],h[p+1]=M,M+=h[p+2],h[p+2]=M,M+=h[p+3],h[p+3]=M;if(u=v-_,n)for(p=0;b>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=h[m.y]*u+_,g=i(m),f=g.r,c=g.g,d=g.b,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d,r[p]=~~f,r[p+1]=~~c,r[p+2]=~~d;else for(p=0;b>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=h[m.y]*u+_,g=i(m),r[p]=~~g.r,r[p+1]=~~g.g,r[p+2]=~~g.b;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F;e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u=0,h=255,f=0,c=r.length,d=c>>2,p=1/d;for(s=new t(256),l=0;256>l;l+=4)s[l]=0,s[l+1]=0,s[l+2]=0,s[l+3]=0;for(l=0;c>l;l+=4)a=r[l],s[a]+=p,a>u?u=a:h>a&&(h=a);for(f=0,l=0;256>l;l+=4)f+=s[l],s[l]=f,f+=s[l+1],s[l+1]=f,f+=s[l+2],s[l+2]=f,f+=s[l+3],s[l+3]=f;if(o=u-h,n)for(l=0;c>l;l+=4)a=r[l],i=s[a]*o+h,i=0>i?0:i>255?255:i,i=~~i,r[l]=i,r[l+1]=i,r[l+2]=i;else for(l=0;c>l;l+=4)a=r[l],i=~~(s[a]*o+h),r[l]=i,r[l+1]=i,r[l+2]=i;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F;e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u,h,f,c,d,p,m,g,v,_,M,b=0,C=0,y=0,O=255,w=255,z=255,Y=r.length,X=Y>>2,A=1/X;for(h=new t(256),f=new t(256),c=new t(256),M=0;256>M;M+=4)h[M]=0,f[M]=0,c[M]=0,h[M+1]=0,f[M+1]=0,c[M+1]=0,h[M+2]=0,f[M+2]=0,c[M+2]=0,h[M+3]=0,f[M+3]=0,c[M+3]=0;for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],h[a]+=A,f[i]+=A,c[o]+=A,a>b?b=a:O>a&&(O=a),i>C?C=i:w>i&&(w=i),o>y?y=o:z>o&&(z=o);for(d=p=m=0,M=0;256>M;M+=4)d+=h[M],h[M]=d,p+=f[M],f[M]=p,m+=c[M],c[M]=m,d+=h[M+1],h[M+1]=d,p+=f[M+1],f[M+1]=p,m+=c[M+1],c[M+1]=m,d+=h[M+2],h[M+2]=d,p+=f[M+2],f[M+2]=p,m+=c[M+2],c[M+2]=m,d+=h[M+3],h[M+3]=d,p+=f[M+3],f[M+3]=p,m+=c[M+3],c[M+3]=m;if(s=b-O,l=C-w,u=y-z,n)for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],g=h[a]*s+O,v=f[i]*l+w,_=c[o]*u+z,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,r[M]=~~g,r[M+1]=~~v,r[M+2]=~~_;else for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],g=h[a]*s+O,v=f[i]*l+w,_=c[o]*u+z,r[M]=~~g,r[M+1]=~~v,r[M+2]=~~_;return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var o=this;if(!o._isOn||o.scale<=1)return r;o.scale>100&&(o.scale=100);var s,l,u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z=r.length,re=Z>>2,ee=(e<<1)+e;for(s=~~(n(re)*o.scale*.01),l=e*s,u=i%s,h=e%s,f=(u-1)*e,m=1/(s*s),g=1/(h*s),v=1/(u*s),_=1/(h*u),M=m,b=g,C=v,y=_,X=s-1,A=(s-1)*e,G=0,L=e-1,K=0,H=re-e,O=new a(3*re),I=0,x=0,F=0,w=z=Y=0,F=0;e>F;F++,I+=4,x+=3)w+=r[I],z+=r[I+1],Y+=r[I+2],O[x]=w,O[x+1]=z,O[x+2]=Y;for(x=0,F=0,w=z=Y=0,I=ee+e;Z>I;I+=4,x+=3,F++)F>=e&&(F=0,w=z=Y=0),w+=r[I],z+=r[I+1],Y+=r[I+2],O[x+ee]=O[x]+w,O[x+ee+1]=O[x+1]+z,O[x+ee+2]=O[x+2]+Y;for(F=0,S=0,k=0,R=F,D=k,E=R+X,B=D+A,E=E>L?L:E,B=B>H?H:B,j=R+D,U=E+B,W=E+D,$=R+B,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,U=(U<<1)+U,p=M,V=p*(O[U]-O[W]-O[$]+O[j]),Q=p*(O[U+1]-O[W+1]-O[$+1]+O[j+1]),J=p*(O[U+2]-O[W+2]-O[$+2]+O[j+2]),t&&(V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J),V=~~V,Q=~~Q,J=~~J,q=0,N=0,P=0,I=0;Z>I;I+=4)T=q+F+P+k<<2,r[T]=V,r[T+1]=Q,r[T+2]=J,q++,(q+F>=e||q>=s)&&(q=0,N++,P+=e),(N+S>=i||N>=s)&&(F+=s,F>=e&&(F=0,S+=s,k+=l),q=0,N=0,P=0,R=F,D=k,E=R+X,B=D+A,E=E>L?L:E,B=B>H?H:B,j=R+D,U=E+B,W=E+D,$=R+B,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,U=(U<<1)+U,c=0==E-R-h+1,d=0==B-D-f,p=c&&d?y:c?b:d?C:M,V=p*(O[U]-O[W]-O[$]+O[j]),Q=p*(O[U+1]-O[W+1]-O[$+1]+O[j+1]),J=p*(O[U+2]-O[W+2]-O[$+2]+O[j+2]),t&&(V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J),V=~~V,Q=~~Q,J=~~J);return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var o=this;if(!o._isOn||o.scale<=1)return r;o.scale>100&&(o.scale=100);var s,l,u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z,re,ee,ne,te,ae,ie,oe,se=r.length,le=se>>2,ue=(e<<1)+e;for(s=~~(n(le)*o.scale*.01),l=s>>1,u=s-1,h=e*s,f=i%s,c=e%s,d=(f-1)*e,v=1/(s*s),_=1/(c*s),M=1/(f*s),b=1/(c*f),C=2*v,y=2*_,O=2*M,w=2*b,I=u,x=u*e,L=0,j=e-1,H=0,W=le-e,z=new a(3*le),F=0,S=0,k=0,Y=X=A=0,k=0;e>k;k++,F+=4,S+=3)Y+=r[F],X+=r[F+1],A+=r[F+2],z[S]=Y,z[S+1]=X,z[S+2]=A;for(S=0,k=0,Y=X=A=0,F=ue+e;se>F;F+=4,S+=3,k++)k>=e&&(k=0,Y=X=A=0),Y+=r[F],X+=r[F+1],A+=r[F+2],z[S+ue]=z[S]+Y,z[S+ue+1]=z[S+1]+X,z[S+ue+2]=z[S+2]+A;for(k=0,q=0,N=0,E=k,B=N,G=k-l+I,K=N+x,G=G>j?j:G,K=K>W?W:K,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,g=C,ee=g*(z[Q]-z[U]-z[V]+z[$]),ne=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),te=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),E=k+l,G=k+I,G=G>j?j:G,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,ae=g*(z[Q]-z[U]-z[V]+z[$]),ie=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),oe=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),t&&(ee=0>ee?0:ee>255?255:ee,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,oe=0>oe?0:oe>255?255:oe),ee=~~ee,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,oe=~~oe,J=ee,Z=ne,re=te,P=0,T=0,R=0,F=0;se>F;F+=4)D=P+k+R+N<<2,r[D]=J,r[D+1]=Z,r[D+2]=re,P++,(P+k>=e||P>=s)&&(P=0,T++,R+=e,J=ee,Z=ne,re=te),P>u-T&&(J=ae,Z=ie,re=oe),(T+q>=i||T>=s)&&(k+=s,k>=e&&(k=0,q+=s,N+=h),P=0,T=0,R=0,E=k,B=N,G=k-l+I,K=N+x,G=G>j?j:G,K=K>W?W:K,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,p=0==G-E+l-c+1,m=0==K-B-d,g=p&&m?w:p?y:m?O:C,ee=g*(z[Q]-z[U]-z[V]+z[$]),ne=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),te=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),E=k+l,G=k+I,G=G>j?j:G,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,p=0==G-E+l-c+1,g=p&&m?w:p?y:m?O:C,ae=g*(z[Q]-z[U]-z[V]+z[$]),ie=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),oe=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),t&&(ee=0>ee?0:ee>255?255:ee,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,oe=0>oe?0:oe>255?255:oe),ee=~~ee,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,oe=~~oe,J=ee,Z=ne,re=te);return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Color.RGB2HSV,a=.7083333333333334;e.Create({name:"HSVConverterFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var i,o,s,l,u,h,f,c,d=r.length;if(n)for(l=0;d>l;l+=4)i=r[l],o=r[l+1],s=r[l+2],u=t({r:i,g:o,b:s}),h=u.h*a,c=255*u.s,f=u.v,0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),r[l]=~~h,r[l+1]=~~f,r[l+2]=~~c;else for(l=0;d>l;l+=4)i=r[l],o=r[l+1],s=r[l+2],u=t({r:i,g:o,b:s}),h=u.h*a,c=255*u.s,f=u.v,r[l]=~~h,r[l+1]=~~f,r[l+2]=~~c;return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),t=e.Color.RGB2HSV,a=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var n=this;n.range=r,n.background=e||0},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.range=e.range,n.background=e.background),n},apply:function(r){var e=this;if(!e._isOn||!e.range||!e.range.length)return r;var i,o,s,l,u,h,f,c,d,p,m=r.length,g=e.range[0],v=e.range[e.range.length-1];for(d=a(e.background||0),l=~~n(d.r),u=~~n(d.g),h=~~n(d.b),f=~~n(d.a),c=0;m>c;c+=4)i=r[c],o=r[c+1],s=r[c+2],p=t({r:i,g:o,b:s}).h,(g>p||p>v)&&(r[c]=l,r[c+1]=u,r[c+2]=h,r[c+3]=f);return r}})}(e),!function(e){"use strict";{var n=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA}e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(r,e,n,t,i){var o=this;o._srcImg=null,o.srcImg=null,o.srcChannel=e||a,o.dstChannel=n||a,o.centerX=t||0,o.centerY=i||0,r&&o.setSrc(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._srcImg=e._srcImg,n.centerX=e.centerX,n.centerY=e.centerY,n.srcChannel=e.srcChannel,n.dstChannel=e.dstChannel),n},setSrc:function(r){var e=this;return r&&(e.srcImg=r,e._srcImg={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._srcImg)return r;var o,s,l,u,h,f,c=i._srcImg.data,d=r.length,p=(c.length,i._srcImg.width),m=i._srcImg.height,g=i.srcChannel,v=i.dstChannel,_=n(e,p),M=n(a,m),b=i.centerX||0,C=i.centerY||0,y=p>>1,O=m>>1;for(b=t(b*(e-1))-y,C=t(C*(a-1))-O,o=0,s=0,l=0,o=0;d>o;o+=4,s++)s>=e&&(s=0,l++),h=s-b,f=l-C,h>=0&&_>h&&f>=0&&M>f&&(u=h+f*p<<2,r[o+v]=c[u+g]);return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(r,e,n){var t=this;t.centerX=e||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,r&&t.setMask(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._alphaMask=e._alphaMask,n.centerX=e.centerX,n.centerY=e.centerY),n},setMask:function(r){var e=this;return r&&(e.alphaMask=r,e._alphaMask={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var o,s,l,u,h,f,c=i._alphaMask.data,d=i._alphaMask.width,p=i._alphaMask.height,m=r.length,g=(c.length,n(e,d)),v=n(a,p),_=i.centerX||0,M=i.centerY||0,b=d>>1,C=p>>1;for(_=t(_*(e-1))-b,M=t(M*(a-1))-C,s=0,l=0,o=0;m>o;o+=4,s++)s>=e&&(s=0,l++),h=s-_,f=l-M,h>=0&&g>h&&f>=0&&v>f?(u=h+f*d<<2,r[o+3]=c[u+3]):r[o+3]=0;return r}})}(e),!function(e,n){"use strict";var t,a=Math.min,i=Math.max,o=Math.round,s=(Math.floor,Math.abs),l=e._notSupportClamp;e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(r,e,n){var t=this;t.startX=0,t.startY=0,t.amount=1,t._blendImage=null,t.blendImage=null,t._blendMode=null,t.blendMode=null,r&&t.setImage(r),e&&t.setMode(e,n)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._blendImage=e._blendImage,n.startX=e.startX,n.startY=e.startY,n.setMode(e._blendMode,e.amount)),n},setImage:function(r){var e=this;return r&&(e.blendImage=r,e._blendImage={data:r.getData(),width:r.width,height:r.height}),e},setMode:function(r,e){var o=this;return r?(o._blendMode=(""+r).toLowerCase(),o.blendMode=t[o._blendMode]||null,o.amount=i(0,a(1,n===e?1:e))):(o._blendMode=null,o.blendMode=null),o},reset:function(){var r=this;return r.startX=0,r.startY=0,r.amount=1,r._blendMode=null,r.blendMode=null,r},apply:function(r,e,n){var t=this;if(!t._isOn||!t.blendMode||!t._blendImage)return r;var i,s,l,u,h,f=t.startX||0,c=t.startY||0,d=0,p=0,m=t._blendImage,g=t.amount||1;return u=m.width,h=m.height,0>f&&(d=-f,f=0),0>c&&(p=-c,c=0),f>=e||c>=n?r:d>=u||p>=h?r:(f=o(f),c=o(c),d=o(d),p=o(p),i=a(e-f,u-d),s=a(n-c,h-p),0>=i||0>=s?r:(l=m.data,t.blendMode(r,e,n,l,u,h,f,c,d,p,i,s,g)))}}),t={normal:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=X,F=A,S=I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},lighten:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w>X?w:X,F=z>A?z:A,S=Y>I?Y:I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},darken:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w>X?X:w,F=z>A?A:z,S=Y>I?I:Y,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},multiply:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w*X*.003921568627451,F=z*A*.003921568627451,S=Y*I*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},average:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=.5*(w+X),F=.5*(z+A),S=.5*(Y+I),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},add:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w+X,F=z+A,S=Y+I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},subtract:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=255>w+X?0:w+X-255,F=255>z+A?0:z+A-255,S=255>Y+I?0:Y+I-255,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},difference:function(r,e,n,t,a,i,o,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=o,y=u*e,O=h,w=f*a,m=o+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=s(A-z),S=s(I-Y),k=s(x-X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=o,y+=e),O++,O>=g&&(O=h,w+=a);return r},negation:function(r,e,n,t,a,i,o,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=o,y=u*e,O=h,w=f*a,m=o+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255-s(255-A-z),S=255-s(255-I-Y),k=255-s(255-x-X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=o,y+=e),O++,O>=g&&(O=h,w+=a);return r},screen:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=255-((255-X)*(255-w)>>8),F=255-((255-A)*(255-z)>>8),S=255-((255-I)*(255-Y)>>8),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},exclusion:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=X+w-2*X*w*.003921568627451,F=A+z-2*A*z*.003921568627451,S=I+Y-2*I*Y*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},overlay:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>w?2*X*w*.003921568627451:255-2*(255-X)*(255-w)*.003921568627451,F=128>z?2*A*z*.003921568627451:255-2*(255-A)*(255-z)*.003921568627451,x=128>Y?2*I*Y*.003921568627451:255-2*(255-I)*(255-Y)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},softlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>w?2*((X>>1)+64)*.003921568627451*w:255-2*(255-((X>>1)+64))*(255-w)*.003921568627451,F=128>z?2*((A>>1)+64)*.003921568627451*z:255-2*(255-((A>>1)+64))*(255-z)*.003921568627451,S=128>Y?2*((I>>1)+64)*.003921568627451*Y:255-2*(255-((I>>1)+64))*(255-Y)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},hardlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>X?2*w*X*.003921568627451:255-2*(255-w)*(255-X)*.003921568627451,F=128>A?2*z*A*.003921568627451:255-2*(255-z)*(255-A)*.003921568627451,S=128>I?2*Y*I*.003921568627451:255-2*(255-Y)*(255-I)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},colordodge:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==z?z:a(255,(A<<8)/(255-z)),S=255==Y?Y:a(255,(I<<8)/(255-Y)),k=255==X?z:a(255,(x<<8)/(255-X)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},colorburn:function(r,e,n,t,a,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*a,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=0==z?z:i(0,255-(255-A<<8)/z),S=0==Y?Y:i(0,255-(255-I<<8)/Y),k=0==X?X:i(0,255-(255-x<<8)/X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=a);return r},linearlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;for(var q;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],128>w?(q=2*w,x=255>q+X?0:q+X-255):(q=2*(w-128),x=q+X),128>z?(q=2*z,F=255>q+A?0:q+A-255):(q=2*(z-128),F=q+A),128>Y?(q=2*Y,S=255>q+I?0:q+I-255):(q=2*(Y-128),S=q+I),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},reflect:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==z?z:a(255,A*A/(255-z)),S=255==Y?Y:a(255,I*I/(255-Y)),k=255==X?X:a(255,x*x/(255-X)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},glow:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==A?A:a(255,z*z/(255-A)),S=255==I?I:a(255,Y*Y/(255-I)),k=255==x?x:a(255,X*X/(255-x)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},phoenix:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;for(N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],S=a(I,Y)-i(I,Y)+255,k=a(x,X)-i(x,X)+255,q=a(F,A)-i(F,A)+255,Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r},vividlight:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;for(var P;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],128>Y?(P=2*Y,S=0==P?P:i(0,255-(255-I<<8)/P)):(P=2*(Y-128),S=255==P?P:a(255,(I<<8)/(255-P))),128>X?(P=2*X,k=0==P?P:i(0,255-(255-x<<8)/P)):(P=2*(X-128),k=255==P?P:a(255,(x<<8)/(255-P))),128>A?(P=2*A,q=0==P?P:i(0,255-(255-F<<8)/P)):(P=2*(X-128),q=255==P?P:a(255,(F<<8)/(255-P))),Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r},pinlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;for(var q;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],128>w?(q=2*w,x=q>X?q:X):(q=2*(w-128),x=q>X?X:q),128>z?(q=2*z,F=q>A?q:A):(q=2*(w-128),F=q>A?A:q),128>Y?(q=2*Y,S=q>I?q:I):(q=2*(Y-128),S=q>I?I:q),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},hardmix:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;for(var P;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],128>Y?(P=2*Y,S=0==P?P:i(0,255-(255-I<<8)/P)):(P=2*(Y-128),S=255==P?P:a(255,(I<<8)/(255-P))),S=128>S?0:255,128>X?(P=2*X,k=0==P?P:i(0,255-(255-x<<8)/P)):(P=2*(X-128),k=255==P?P:a(255,(x<<8)/(255-P))),k=128>k?0:255,128>A?(P=2*A,q=0==P?P:i(0,255-(255-F<<8)/P)):(P=2*(A-128),q=255==P?P:a(255,(F<<8)/(255-P))),q=128>q?0:255,Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r}},t.lineardodge=t.add,t.linearburn=t.subtract}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.Color.RGBA2Color),t=e.Color.Color2RGBA;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var n=this;n.thresholds=r,n.quantizedColors=e||null},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.thresholds=e.thresholds,n.quantizedColors=e.quantizedColors),n},apply:function(r){var e=this;if(!(e._isOn&&e.thresholds&&e.thresholds.length&&e.quantizedColors&&e.quantizedColors.length))return r;var a,i,o,s,l,u,h,f,c=r.length,d=e.thresholds,p=d.length,m=e.quantizedColors,g=m.length;for(h=0;c>h;h+=4){for(l=n({r:r[h],g:r[h+1],b:r[h+2],a:r[h+3]}),f=0;p>f&&l>d[f];)f++;l=g>f?m[f]:255,u=t(l),a=u.r,i=u.g,o=u.b,s=u.a,r[h]=a,r[h+1]=i,r[h+2]=o,r[h+3]=s}return r}})}(e),!function(e){"use strict";var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,o=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,n,t){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=n||10,a.amount=t||10},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.centerX=e.centerX,n.centerY=e.centerY,n.radius=e.radius,n.amount=e.amount),n},apply:function(r,e,s){var l=this;if(!l._isOn)return r;var u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G=r.length,K=l.centerX||0,L=l.centerY||0,H=l.radius,j=l.amount;if(0>=j)return r;for(u=G>>2,R=0,D=e-1,E=0,B=u-e,K=a(K*(e-1)),L=a(L*(s-1)),f=(u<<1)+u,m=(e<<1)+e,h=new o(f),g=0,v=0,_=0,c=d=p=0,_=0;e>_;_++,g+=4,v+=3)c+=r[g],d+=r[g+1],p+=r[g+2],h[v]=c,h[v+1]=d,h[v+2]=p;for(g=m+e,v=0,_=0,c=d=p=0,g=m+e;G>g;g+=4,v+=3,_++)_>=e&&(_=0,c=d=p=0),c+=r[g],d+=r[g+1],p+=r[g+2],h[v+m]=h[v]+c,h[v+m+1]=h[v+1]+d,h[v+m+2]=h[v+2]+p;for(_=0,M=0,b=0,g=0;G>g;g+=4,_++)_>=e&&(_=0,M++,b+=e),y=_-K,O=M-L,C=t(y)+t(O),w=C>H?~~n((C-H)*j):~~(C/H+.5),w>0&&(z=w*e,Y=.25/(w*w),X=_-w,A=b-z,I=_+w,x=b+z,R>X?X=R:I>D&&(I=D),E>A?A=E:x>B&&(x=B),F=X+A,q=I+x,S=I+A,k=X+x,F=(F<<1)+F,S=(S<<1)+S,k=(k<<1)+k,q=(q<<1)+q,N=Y*(h[q]-h[S]-h[k]+h[F]),P=Y*(h[q+1]-h[S+1]-h[k+1]+h[F+1]),T=Y*(h[q+2]-h[S+2]-h[k+2]+h[F+2]),i&&(N=0>N?0:N>255?255:N,P=0>P?0:P>255?255:P,T=0>T?0:T>255?255:T),r[g]=~~N,r[g+1]=~~P,r[g+2]=~~T);return r}})}(e),!function(e){"use strict";e.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:e.getPath(r.AMD),init:function(r,e,n,t){var a=this;a.x=r||0,a.y=e||0,a.color=n||[0,0,0],a.tolerance=t||0},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{color:r.color,x:r.x,y:r.y,tolerance:r.tolerance}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.color=e.color,n.x=e.x,n.y=e.y,n.tolerance=e.tolerance),n},apply:function(r,e){var n,t,a,i,o,s,l,u,h,f,c=this,d=~~(255*(c.tolerance>=1?.999:c.tolerance)),p=c.color,m=e<<2,g=c.x,v=c.y,_=r.length,M=0,b=_-m,C=0,y=e-1<<2,O=Math.abs;if(l=v*e<<2,g<<=2,C>g||g>y||M>l||l>b||r[g+l]===p[0]&&r[g+l+1]===p[1]&&r[g+l+2]===p[2])return r;for(n=[r[g+l],r[g+l+1],r[g+l+2]],u=[],l+m>=M&&b>=l+m&&u.push([l,g,g,m]),u.push([l+m,g,g,-m]);u.length;){for(h=u.pop(),l=h[0]+(m=h[3]),o=h[1],s=h[2],i=o;i>=C&&(a=i+l,O(n[0]-r[a])<=d&&O(n[1]-r[a+1])<=d&&O(n[2]-r[a+2])<=d);i-=4)r[a]=p[0],r[a+1]=p[1],r[a+2]=p[2];if(i>=o){for(;s>=i&&!(O(n[0]-r[i+l])<=d&&O(n[1]-r[i+l+1])<=d&&O(n[2]-r[i+l+2])<=d);)i+=4;t=i,f=s>=i}else t=i+4,o>t&&l-m>=M&&b>=l-m&&u.push([l,t,o-4,-m]),i=o+4,f=!0;for(;f;){for(a=i+l;y>=i&&O(n[0]-r[a])<=d&&O(n[1]-r[a+1])<=d&&O(n[2]-r[a+2])<=d;)r[a]=p[0],r[a+1]=p[1],r[a+2]=p[2],i+=4,a=i+l;for(l+m>=M&&b>=l+m&&u.push([l,t,i-4,m]),i>s+4&&l-m>=M&&b>=l-m&&u.push([l,s+4,i-4,-m]);s>=i&&!(O(n[0]-r[i+l])<=d&&O(n[1]-r[i+l+1])<=d&&O(n[2]-r[i+l+2])<=d);)i+=4;t=i,f=s>=i}}return r}})}(e),!function(e){"use strict";function n(r,e){return Math.exp(-(r*r)/(2*e))}function t(r,e,t,a,i,o){var s,l,f,g,v=r.length,_=new h(v),M=new h(v),b=new h(v),C=new h(v),y=new h(o),O=new h(o),w=i*i,z=2*Math.PI*w;for(s=0;o>s&&(l=n(s,w),!(c>=l&&s>=2));s++)f=n(s-.5,w),g=n(s+.5,w),y[s]=(l+f+g)/3/z,O[s]=g-f;var Y,X,A,I,x,F,S,k,q,N=s-1,P=e-(s-1),T=e*(s-1),R=e*(t-(s-1));for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e){for(A=Y+X,I=r[A]*y[0],x=I,F=1,S=e;s>F;)x+=y[F]*(r[A-S]+r[A+S]),I+=y[F]*(r[A-F]+r[A+F]),S+=e,F++;M[A]=x,_[A]=I}for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e){for(k=0,A=Y+X,q=1;s>q;q++)k+=O[q]*(M[A-q]-M[A+q]);
b[A]=k}for(Y=s;e-s>Y;Y++)for(X=T;R>X;X+=e){for(k=0,A=Y+X,S=e,q=1;s>q;q++)k+=O[q]*(_[A-S]-_[A+S]),S+=e;C[A]=k}N=s,P=e-s,T=e*s,R=e*(t-s);var D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z,re,ee,ne,te,ae;for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e)A=Y+X,D=A-e,E=A+e,G=A-1,B=A+1,K=D-1,L=D+1,H=E-1,j=E+1,W=b[A],$=C[A],U=u(W,$),Q=u(b[D],C[D]),J=u(b[E],C[E]),re=u(b[G],C[G]),Z=u(b[B],C[B]),ne=u(b[L],C[L]),ae=u(b[j],C[j]),te=u(b[H],C[H]),ee=u(b[K],C[K]),a[A]=(0>=W*$?Math.abs(W)>=Math.abs($)?(V=Math.abs(W*U))>=Math.abs($*ne-(W+$)*Z)&&V>Math.abs($*te-(W+$)*re):(V=Math.abs($*U))>=Math.abs(W*ne-($+W)*Q)&&V>Math.abs(W*te-($+W)*J):Math.abs(W)>=Math.abs($)?(V=Math.abs(W*U))>=Math.abs($*ae+(W-$)*Z)&&V>Math.abs($*ee+(W-$)*re):(V=Math.abs($*U))>=Math.abs(W*ae+($-W)*J)&&V>Math.abs(W*ee+($-W)*Q))?U>=p?m:Math.floor(d*U):0}function a(r,e,n,t,a,o){var s,l,u,h=0,f=r.length;for(s=0;f>s;s++)r[s]=0;for(u=0,l=0,h=0;f>h;h++,u++)u>=e&&(u=0,l++),0===r[h]&&t[h]>=o&&i(r,e,n,t,u,l,h,a)}function i(r,e,n,t,a,o,s,l){var u,h,f,c=0==a?a:a-1,d=a==e-1?a:a+1,p=0==o?o:o-1,m=o==n-1?o:o+1;for(r[s]=t[s],u=c,h=p;d>=u&&m>=h;){if(f=u+h*e,(h!=o||u!=a)&&0===r[f]&&t[f]>=l)return void i(r,e,n,t,u,h,f,l);h++,h>m&&(h=p,u++)}}function o(r,e){var n,t,a,i=r.length;for(n=0,t=0;i>n;n+=4,t++)a=e[t]>0?255:0,r[n]=r[n+1]=r[n+2]=a}function s(r,e){var n,t,a,i,o,s=r.length;for(n=0,t=0;s>n;n+=4,t++)a=r[n],i=r[n+1],o=r[n+2],e[t]=Math.round(.299*a+.587*i+.114*o)}function l(r){var e,n,t,a,i,o,s=new f(256),l=r.length;for(e=0;l>e;e++)s[r[e]]++;for(n=new f(256),t=0,a=0,e=0;256>e;e++){for(t+=s[e],o=255*t/l,i=a+1;o>=i;i++)n[i]=e;a=o}for(e=0;l>e;e++)r[e]=n[r[e]]}var u,h=e.Array32F,f=e.Array32I,c=.005,d=100,p=1e3,m=d*p;u=Math.hypot?Math.hypot:function(r,e){return Math.abs(r)+Math.abs(e)},e.Create({name:"CannyEdgesFilter",lowThreshold:2.5,highThreshold:7.5,gaussianKernelRadius:2,gaussianKernelWidth:16,contrastNormalized:!1,path:e.getPath(r.AMD),init:function(r,e,n,t,a){var i=this;i.lowThreshold=arguments.length<1?2.5:r,i.highThreshold=arguments.length<2?7.5:e,i.gaussianKernelRadius=arguments.length<3?2:n,i.gaussianKernelWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{lowThreshold:r.lowThreshold,highThreshold:r.highThreshold,gaussianKernelRadius:r.gaussianKernelRadius,gaussianKernelWidth:r.gaussianKernelWidth,contrastNormalized:r.contrastNormalized}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.lowThreshold=e.lowThreshold,n.highThreshold=e.highThreshold,n.gaussianKernelRadius=e.gaussianKernelRadius,n.gaussianKernelWidth=e.gaussianKernelWidth,n.contrastNormalized=e.contrastNormalized),n},apply:function(r,e,n){var i,u,h,c,p=this,m=r.length>>2;return h=new f(m),c=new f(m),i=Math.round(p.lowThreshold*d),u=Math.round(p.highThreshold*d),s(r,h),p.contrastNormalized&&l(h),t(h,e,n,c,p.gaussianKernelRadius,p.gaussianKernelWidth),a(h,e,n,c,i,u),o(r,h),r}})}(e),!function(e){"use strict";function n(r,e,n){var t=this;t.x=r,t.y=e,t.z=n}function t(r){r>0&&1>r&&(r*=65536),r=Math.floor(r),256>r&&(r|=r<<8);for(var e=0;256>e;e++){var n;n=1&e?h[e]^255&r:h[e]^r>>8&255,f[e]=f[e+256]=n,c[e]=c[e+256]=u[n%12]}}function a(r,e){var n,t,a,i,o,s=(r+e)*d,l=Math.floor(r+s),u=Math.floor(e+s),h=(l+u)*p,m=r-l+h,g=e-u+h;m>g?(i=1,o=0):(i=0,o=1);var v=m-i+p,_=g-o+p,M=m-1+2*p,b=g-1+2*p;l&=255,u&=255;var C=c[l+f[u]],y=c[l+i+f[u+o]],O=c[l+1+f[u+1]],w=.5-m*m-g*g;0>w?n=0:(w*=w,n=w*w*C.dot2(m,g));var z=.5-v*v-_*_;0>z?t=0:(z*=z,t=z*z*y.dot2(v,_));var Y=.5-M*M-b*b;return 0>Y?a=0:(Y*=Y,a=Y*Y*O.dot2(M,b)),70*(n+t+a)}function i(r){return r*r*r*(r*(6*r-15)+10)}function o(r,e,n){return(1-n)*r+n*e}function s(r,e){var n=Math.floor(r),t=Math.floor(e);r-=n,e-=t,n=255&n,t=255&t;var a=c[n+f[t]].dot2(r,e),s=c[n+f[t+1]].dot2(r,e-1),l=c[n+1+f[t]].dot2(r-1,e),u=c[n+1+f[t+1]].dot2(r-1,e-1),h=i(r);return o(o(a,l,h),o(s,u,h),i(e))}var l="prototype";n[l].dot2=function(r,e){return this.x*r+this.y*e},n[l].dot3=function(r,e,n){return this.x*r+this.y*e+this.z*n};var u=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],f=new Array(512),c=new Array(512),d=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6;e.Create({name:"PerlinNoiseFilter",baseX:1,baseY:1,offsetX:0,offsetY:0,seed:0,colors:null,perlin:!1,init:function(r,e,n,t,a,i,o){var s=this;s.baseX=r||1,s.baseY=e||1,s.offsetX=n||0,s.offsetY=t||0,s.seed=a||0,s.colors=i||null,s.perlin=!!o},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{baseX:r.baseX,baseY:r.baseY,offsetX:r.offsetX,offsetY:r.offsetY,seed:r.seed,colors:r.colors,perlin:r.perlin}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.baseX=e.baseX,n.baseY=e.baseY,n.offsetX=e.offsetX,n.offsetY=e.offsetY,n.seed=e.seed,n.colors=e.colors,n.perlin=e.perlin),n},apply:function(r,e,n){var i,o,l,u,h,f=this,c=f.baseX,d=f.baseY,p=f.offsetX,m=f.offsetY,g=f.colors,v=Math.floor,_=!g||!g.length,M=f.perlin,b=r.length;if(t(f.seed),i=0,o=0,l=0,M)for(i=0;b>i;i+=4,o++)o>=e&&(o=0,l++),u=.5*(1+s((o+p)%e/c,(l+m)%n/d)),_?r[i]=r[i+1]=r[i+2]=~~(255*u):(h=g[v(u*(g.length-1))],r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2]);else for(i=0;b>i;i+=4,o++)o>=e&&(o=0,l++),u=.5*(1+a((o+p)%e/c,(l+m)%n/d)),_?r[i]=r[i+1]=r[i+2]=~~(255*u):(h=g[v(u*(g.length-1))],r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2]);return r}})}(e),r.FILTER_PLUGINS});
